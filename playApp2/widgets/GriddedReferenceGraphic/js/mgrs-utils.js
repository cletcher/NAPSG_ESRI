// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/json ./constants ./geometry-utils ./geometryUtils ./mgrs ./NonPolarGridZone ./VisibleGridZone ./GridPolygon esri/geometry/geometryEngine esri/geometry/Point esri/geometry/Polygon".split(" "),function(z,l,b,G,m,I,J,H,u,C,D){Math.log10||(Math.log10=function(a){return Math.log(a)/Math.LN10});return{_ZonesDictionary:function(){var a,b,c,n="CDEFGHJKLMNPQRSTUVWX".split(""),r={},e=function(a,c){var b,f,e=a+n[c];if("32X"===e||"34X"===e||"36X"===e)return null;"31V"===e?b={xmin:0,ymin:56,xmax:3,
ymax:64,id:e}:"32V"===e?b={xmin:3,ymin:56,xmax:12,ymax:64,id:e}:"31X"===e?b={xmin:0,ymin:72,xmax:9,ymax:84,id:e}:"33X"===e?b={xmin:9,ymin:72,xmax:21,ymax:84,id:e}:"35X"===e?b={xmin:21,ymin:72,xmax:33,ymax:84,id:e}:"37X"===e?b={xmin:33,ymin:72,xmax:42,ymax:84,id:e}:(b=(a-1)*l.ZONE_WIDTH_DEGREES-180,a=a*l.ZONE_WIDTH_DEGREES-180,f=c*l.ZONE_HEIGHT_DEGREES+l.MIN_MGRS_LATITUDE,c=(c+1)*l.ZONE_HEIGHT_DEGREES+l.MIN_MGRS_LATITUDE,b=180===b?l.POSITIVE_180:b,b=-180===b?l.NEGATIVE_180:b,a=180===a?l.POSITIVE_180:
a,a=-180===a?l.NEGATIVE_180:a,80===c&&(c=l.MAX_MGRS_LATITUDE),b={xmin:b,ymin:f,xmax:a,ymax:c,id:e});return new I(b)};for(a=1;60>=a;a++)for(b=0;b<n.length;b++)(c=e(a,b))&&(r[c.id]=c);for(a=1;60>=a;a++){var m=[];for(b=0;b<n.length;b++)if(c=e(a,b))c=new D({rings:z.parse(z.stringify(c._rings))}),m.push(c);m=u.union(m);for(b=0;b<n.length;b++)(c=e(a,b))&&(r[c.id.fullZoneGeometry]=m)}return r}(),zonesFromExtent:function(a,m){var c,n,r,e,B,f,p,v,w,y=a.spatialReference.isWebMercator()?l.WEBMERCATOR_360:l.GEOGRAPHIC_360,
q="CDEFGHJKLMNPQRSTUVWX".split(""),d=[];if(a.xmax-a.xmin>y)return d;var y=b.extentToPolygon(a),y=b.toWebMercator(y),h=b.pointToGeographic(new C([a.xmin,a.ymin],a.spatialReference)),g=b.pointToGeographic(new C([a.xmax,a.ymax],a.spatialReference));a=h.y;r=g.y;v=h.offsetX;w=g.offsetX;for(var k=v;k<=w;k++)for(c=k>v?l.NEGATIVE_180:h.x,n=k<w?l.POSITIVE_180:g.x,e=Math.min(Math.max(Math.floor((a+80)/l.ZONE_HEIGHT_DEGREES),0),19),B=Math.min(Math.floor((r+80)/l.ZONE_HEIGHT_DEGREES),19),c=Math.floor((c+180)/
l.ZONE_WIDTH_DEGREES),n=Math.min(Math.floor((n+180)/l.ZONE_WIDTH_DEGREES)+2,60);c<=n;c++)for(var x=e;x<=B;x++)if(f=q[x],f=c+f,this._ZonesDictionary[f]){p=z.parse(z.stringify(this._ZonesDictionary[f]._rings));for(var t=0;t<p[0].length;t++)p[0][t][0]+=k*l.GEOGRAPHIC_360;p=new D({rings:p});(p=u.intersect(b.toWebMercator(p),y))&&d.push(new J({map:m,polygon:p,fullZoneGeometry:this._ZonesDictionary[f].fullZoneGeometry,offset:k,nonPolarGridZone:this._ZonesDictionary[f],utmZone:this._ZonesDictionary[f].utmZone,
latitudeBand:this._ZonesDictionary[f].latitudeZone}))}return d},processZonePolygons:function(a,l,c){var n=[];c=b.toWebMercator(c);for(var r=0;r<a.length;r++){var e=a[r];if(e)var u=e.nonPolarGridZone.latitudeZone,f=b.toGeographic(e.polygon.getExtent()),p=m.LLtoUTM(f.ymin,f.xmin,e.nonPolarGridZone.utmZone),v=m.LLtoUTM(f.ymin,f.xmax,e.nonPolarGridZone.utmZone),w=m.LLtoUTM(f.ymax,f.xmax,e.nonPolarGridZone.utmZone),f=m.LLtoUTM(f.ymax,f.xmin,e.nonPolarGridZone.utmZone),e={minE:Math.min(p[0],v[0],w[0],f[0]),
maxE:Math.max(p[0],v[0],w[0],f[0]),minN:Math.min(p[1],v[1],w[1],f[1]),maxN:Math.max(p[1],v[1],w[1],f[1]),utmZone:e.nonPolarGridZone.utmZone,latitudeZone:u,polygon:e.polygon,offset:e.offset,fullZoneGeometry:b.extentToPolygon(e.nonPolarGridZone.extent)},n=n.concat(this.handle100kGrids(e,l,c))}return n},handle100kGrids:function(a,E,c){var n=a.polygon,r=a.offset,e=a.utmZone,B=a.latitudeZone,f=a.fullZoneGeometry,p=a.minE,v=a.maxE,w=a.maxN,y=[],q,d,h,g,k;for(a=1E5*Math.floor(a.minN/1E5);a<w;a+=1E5)for(q=
1E5*Math.floor(p/1E5);q<v;q+=1E5){k=m.findGridLetters(e,0>a+5E4?1E7+(a+5E4):a+5E4,q+5E4);h=[];for(d=q;d<=q+1E5;d+=1E4)g=m.UTMtoLL(a,d,e),h.push([g.lon,g.lat]);for(d=a;d<a+1E5;d+=1E4)g=m.UTMtoLL(d,q+1E5,e),h.push([g.lon,g.lat]);for(d=q+1E5;d>=q;d-=1E4)g=m.UTMtoLL(a+1E5,d,e),h.push([g.lon,g.lat]);for(d=a+1E5;d>=a;d-=1E4)g=m.UTMtoLL(d,q,e),h.push([g.lon,g.lat]);for(d=0;d<h.length;d++)h[d][0]+=r*l.GEOGRAPHIC_360;d=new D([h]);h=G.getAngleBetweenPoints(d.getPoint(0,d.rings[0].length-1),d.getPoint(0,d.rings[0].length-
2));g=u.rotate(b.extentToPolygon(c),-1*h);h=u.intersect(b.toWebMercator(d),b.toWebMercator(n));g=u.intersects(g,b.toWebMercator(d));if(h||g){var x;g&&(x=u.intersect(b.toWebMercator(d),b.toWebMercator(f)));k={clippedPolygon:h,unclippedPolygon:d,clippedPolyToUTMZone:x,map:E,xmin:q,ymin:a,xmax:q+1E5,ymax:a+1E5,x:"",y:"",minMaxType:"utm",utmZone:e,latitudeZone:B,utmZonePoly:n,fullZoneGeometry:f,GZD:k,text:k};x&&(k=new H(k),y.push(k))}}return y},handleGridSquares:function(a,l,c,n){var r=[],e=a.utmZonePoly,
B=a.latitudeZone,f=a.utmZone,p=a.fullZoneGeometry,v=a.GZD,w=a.xmin,y=a.xmax,q=a.ymin;a=a.ymax;var d,h,g,k,x,t,A,z=!0,E=!0;n=b.toWebMercator(n);for(d=Math.floor(q/c)*c;d<a;d+=c)for(h=Math.floor(w/c)*c;h<y;h+=c){k=[];t=m.UTMtoLL(d,h,f);k.push([t.lon,t.lat]);g=m.UTMtoLL(d+c,h,f);k.push([g.lon,g.lat]);A=m.UTMtoLL(d+c,h+c,f);k.push([A.lon,A.lat]);A=m.UTMtoLL(d,h+c,f);k.push([A.lon,A.lat]);k.push([t.lon,t.lat]);k=new D([k]);A=u.intersect(b.toWebMercator(b.extentToPolygon(n)),b.toWebMercator(p));z&&E&&(x=
G.getAngleBetweenPoints(new C(t.lon,t.lat),new C(g.lon,g.lat)),x=u.rotate(A,-1*x));t=u.intersect(b.toWebMercator(k),e);g=u.intersects(x,b.toWebMercator(k));var F;if(t||g){g&&(F=u.intersect(b.toWebMercator(k),b.toWebMercator(p)));g=v+this._padZero(h%1E5/c,5-Math.log10(c)).toString()+this._padZero((0>q?1E7+d:d)%1E5/c,5-Math.log10(c)).toString();k={clippedPolygon:t,unclippedPolygon:k,fullZoneGeometry:p,clippedPolyToUTMZone:F,map:l,xmin:h,ymin:d,xmax:h+c,ymax:d+c,x:this._padZero(h%1E5/c,5-Math.log10(c)).toString(),
y:this._padZero((0>q?1E7+d:d)%1E5/c,5-Math.log10(c)).toString(),minMaxType:"utm",utmZone:f,latitudeZone:B,GZD:v,utmZonePoly:e,text:g};if(!F)continue;z=new H(k);r.push(z)}E=z=!1}return r},_padZero:function(a,b){for(a=a.toString();a.length<b;)a="0"+a;return a}}});