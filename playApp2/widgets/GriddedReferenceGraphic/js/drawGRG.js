// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("esri/geometry/Point esri/geometry/Polygon esri/geometry/geometryEngine esri/graphic esri/geometry/webMercatorUtils esri/SpatialReference esri/geometry/Circle esri/request dojo/json ./geometryUtils".split(" "),function(x,S,l,P,Q,T,V,G,K,n){var J={createGRG:function(a,b,d,m,E,f,D,k,p,y,c,q,F){var g,h,e,t,z,L,C,M,N,R,G,K=[],v=0,A=0,B=m/2/Math.cos(30*Math.PI/180),U,O=a;switch(D){case "upperLeft":"horizontal"===p?(g=b-1,h=-1,"numeric"!==k?e=0:(e=(b-1)*a,"hexagon"===y&&(e+=Math.floor(b/2)))):(g=
-1,h=b-1,"numeric"!==k&&(e=b));break;case "upperRight":"horizontal"===p?(g=b-1,h=a,"numeric"!==k?e=a+1:(e=b*a+1,"hexagon"===y&&(e+=Math.floor(b/2)))):(e="numeric"!==k?b:b*(a+1),g=a,h=b-1);break;case "lowerRight":"horizontal"===p?(g=0,h=a,e=a+1):(g=a,h=0,e=1);break;case "lowerLeft":"horizontal"===p?(e=g=0,h=-1):(g=-1,e=1,h=0)}var I=a*m/2,H;H="hexagon"===y?1===b%2?((b-1)/2*3*B+B)/2:(b/2*3*B-B/2)/2:b*E/2;for(var u=1;u<=b;u++){for(var w=1;w<=a;w++){if(q){var r=new S;if(1===u&&1===w)switch(102100===d.spatialReference.wkid&&
(d=Q.webMercatorToGeographic(d)),c){case "center":t=n.getDestinationPoint(d,180+f,H);t=n.getDestinationPoint(t,270+f,I);break;case "upperLeft":t=n.getDestinationPoint(d,180+f,2*H);break;case "upperRight":t=n.getDestinationPoint(d,180+f,2*H);t=n.getDestinationPoint(t,270+f,2*I);break;case "lowerRight":t=n.getDestinationPoint(d,270+f,2*I);break;case "lowerLeft":t=d}"default"===y?(L=n.getDestinationPoint(t,0+f,E),C=n.getDestinationPoint(L,90+f,m),z=n.getDestinationPoint(C,180+f,E),r.addRing([[t.x,t.y],
[L.x,L.y],[C.x,C.y],[z.x,z.y]]),t=z):(z=t,M=n.getDestinationPoint(z,0+f,B),N=n.getDestinationPoint(M,60+f,B),C=n.getDestinationPoint(N,120+f,B),R=n.getDestinationPoint(C,180+f,B),G=n.getDestinationPoint(R,240+f,B),r.addRing([[z.x,z.y],[M.x,M.y],[N.x,N.y],[C.x,C.y],[R.x,R.y],[G.x,G.y]]),t=n.getDestinationPoint(t,90+f,m));r=l.simplify(r);4326!==F.spatialReference.wkid&&(r=Q.geographicToWebMercator(r));r=new P(r);1===w&&(U="hexagon"===y?O===a?n.getDestinationPoint(M,300+f,B):N:L)}else{r=new S(new T({wkid:102100}));
4326===d.spatialReference.wkid&&(d=Q.geographicToWebMercator(d));switch(c){case "center":v=d.x-I;A=d.y-H;break;case "upperLeft":v=d.x;A=d.y-2*H;break;case "upperRight":v=d.x-2*I;A=d.y-2*H;break;case "lowerRight":v=d.x-2*I;A=d.y;break;case "lowerLeft":v=d.x,A=d.y}"default"===y?r.addRing([[v+(w-1)*m,A+(u-1)*E],[v+(w-1)*m,A+u*E],[v+w*m,A+u*E],[v+w*m,A+(u-1)*E],[v+(w-1)*m,A+(u-1)*E]]):(O===a?v=v+(w-1)*m+m/2:v+=(w-1)*m,A=A+B+1.5*(u-1)*B,z=new x([v,A],new T({wkid:102100})),C=new V(z,{radius:B,numberOfPoints:6}),
z=l.rotate(C,90,z),r.addRing(z.rings[0]));r=l.rotate(r,-1*f,d);102100!==F.spatialReference.wkid&&(r=Q.webMercatorToGeographic(r));r=new P(r)}switch(D){case "upperLeft":"horizontal"===p?(h+=1,e+=1):(g+=1,"numeric"===k&&(e=b*w-(u-1)));break;case "lowerLeft":"horizontal"===p?(h+=1,e+=1):(g+=1,"numeric"===k&&(e=b*(w-1)+u));break;case "upperRight":"horizontal"===p?(--e,--h):(--g,"numeric"===k&&(e-=a));break;case "lowerRight":"horizontal"===p?(--e,--h):(--g,"numeric"===k&&(e=b*(a-w)+u))}K.push(J.addGraphicLabel(r,
k,e,g,h))}t=U;"hexagon"===y&&(O===a?a++:a--);switch(D){case "upperLeft":"horizontal"===p?(--g,e="numeric"!==k?0:"hexagon"===y?e-2*O-1:e-2*a,h=-1):(g=-1,h=b-(u+1),"numeric"!==k&&(e=b-u));break;case "upperRight":"horizontal"===p?(--g,"numeric"!==k&&(e=a+1),h=a):(e="numeric"!==k?e-1:b*(a+1)-u,g=a,--h);break;case "lowerRight":"horizontal"===p?(g+=1,e="numeric"!==k?a+1:"hexagon"===y?e+2*O+1:e+2*a,h=a):(g=a,h+=1,e="numeric"!==k?e+1:a*u);break;case "lowerLeft":"horizontal"===p?(g+=1,"numeric"!==k&&(e=0),
h=-1):(g=-1,"numeric"!==k&&(e+=1),h=u)}}return K},convertNumberToLetters:function(a){for(var b="";0<=a;)b=String.fromCharCode(a%26+65)+b,a=Math.floor(a/26)-1;return b},checkGridSize:function(a,b){return 2E3>a*b},getFeatureServiceParams:function(a,b){return{name:a,serviceDescription:"",hasStaticData:!1,maxRecordCount:1E3,supportedQueryFormats:"JSON",capabilities:"Create,Delete,Query,Update,Editing",tags:"GRG",description:"",copyrightText:"",spatialReference:{wkid:102100},initialExtent:{xmin:b.extent.xmin,
ymin:b.extent.ymin,xmax:b.extent.xmax,ymax:b.extent.ymax,spatialReference:{wkid:102100}},allowGeometryUpdates:!0,units:"esriMeters",xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"}}},getLayerParams:function(a,b,d,m){return{layers:[{adminLayerInfo:{geometryField:{name:"Shape"},xssTrustedFields:""},id:0,name:a,type:"Feature Layer",displayField:"",description:"A GRG (Gridded Reference Graphic) is a grid overlay used for a commonreference point in many situations - from cordon and search operations to securityfor presidential inaugurations.",
tags:"GRG",copyrightText:"",defaultVisibility:!0,ownershipBasedAccessControlForFeatures:{allowOthersToQuery:!1,allowOthersToDelete:!1,allowOthersToUpdate:!1},relationships:[],isDataVersioned:!1,supportsCalculate:!0,supportsAttachmentsByUploadId:!0,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,supportsValidateSql:!0,supportsCoordinatesQuantization:!0,supportsApplyEditsWithGlobalIds:!0,advancedQueryCapabilities:{supportsPagination:!0,supportsQueryWithDistance:!0,
supportsReturningQueryExtent:!0,supportsStatistics:!0,supportsOrderBy:!0,supportsDistinct:!0,supportsQueryWithResultType:!0,supportsSqlExpression:!0,supportsReturningGeometryCentroid:!0},useStandardizedQueries:!1,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,extent:{xmin:b.extent.xmin,ymin:b.extent.ymin,xmax:b.extent.xmax,ymax:b.extent.ymax,spatialReference:{wkid:102100}},drawingInfo:{renderer:{type:"simple",symbol:m},transparency:0,labelingInfo:[{labelExpression:"[grid]",labelExpressionInfo:{value:"{grid}"},
format:null,fieldInfos:null,useCodedValues:!1,maxScale:0,minScale:0,where:null,sizeInfo:null,labelPlacement:"esriServerPolygonPlacementAlwaysHorizontal",symbol:d}]},allowGeometryUpdates:!0,hasAttachments:!1,htmlPopupType:"esriServerHTMLPopupTypeNone",hasM:!1,hasZ:!1,objectIdField:"OBJECTID",globalIdField:"",typeIdField:"",fields:[{name:"OBJECTID",type:"esriFieldTypeOID",actualType:"int",alias:"OBJECTID",sqlType:"sqlTypeOther",nullable:!1,editable:!1,domain:null,defaultValue:null},{name:"grid",type:"esriFieldTypeString",
alias:"grid",actualType:"nvarchar",nullable:!0,editable:!0,domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:256}],indexes:[],types:[],templates:[{name:"New Feature",description:"",drawingTool:"esriFeatureEditToolPolygon",prototype:{attributes:{grid:""}}}],supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:1E4,standardMaxRecordCount:4E3,tileMaxRecordCount:4E3,maxRecordCountFactor:1,exceedsLimitFactor:1,capabilities:"Query,Editing,Create,Update,Delete"}]}},isNameAvailable:function(a,
b,d){return G({url:a,content:{name:d,type:"Feature Service",token:b,f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},createFeatureService:function(a,b,d){return G({url:a,content:{f:"json",token:b,typeKeywords:"ArcGIS Server,Data,Feature Access,Feature Service,Service,Hosted Service",createParameters:K.stringify(d),outputType:"featureService"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},addDefinitionToService:function(a,b,d){return G({url:a,content:{token:b,addToDefinition:K.stringify(d),
f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},labelReferenceGrid:function(a,b,d,m){for(var n=-1,f=1,D,k=!0,p=null,y=[],c;0<a.length;)if(k){n++;"alphaNumeric"===b?f=1:"alphaAlpha"===b&&(D=0);var q=l.union(a);c=q.getExtent();var F;switch(d){case "lowerLeft":F=l.nearestCoordinate(q,new x(c.xmin,c.ymin,c.spatialReference));break;case "lowerRight":F=l.nearestCoordinate(q,new x(c.xmax,c.ymin,c.spatialReference));break;case "upperLeft":F=l.nearestCoordinate(q,new x(c.xmin,c.ymax,
c.spatialReference));break;case "upperRight":F=l.nearestCoordinate(q,new x(c.xmax,c.ymax,c.spatialReference))}for(c=0;c<a.length;c++)if(l.touches(a[c],F.coordinate)){p=a[c];y.push(J.addGraphicLabel(new P(a[c]),b,f,n,D));f++;D++;k=a.indexOf(a[c]);a.splice(k,1);k=!1;break}}else{k=!0;c=p.getExtent();var g;switch(d){case "lowerLeft":g=l.nearestCoordinate(p,new x(c.xmax,c.ymin,c.spatialReference));break;case "lowerRight":g=l.nearestCoordinate(p,new x(c.xmin,c.ymin,c.spatialReference));break;case "upperLeft":g=
l.nearestCoordinate(p,new x(c.xmax,c.ymax,c.spatialReference));break;case "upperRight":g=l.nearestCoordinate(p,new x(c.xmin,c.ymax,c.spatialReference))}for(q=0;q<a.length;q++){c=a[q].getExtent();var h;switch(d){case "lowerLeft":h=l.nearestCoordinate(a[q],new x(c.xmin,c.ymin,c.spatialReference));break;case "lowerRight":h=l.nearestCoordinate(a[q],new x(c.xmax,c.ymin,c.spatialReference));break;case "upperLeft":h=l.nearestCoordinate(a[q],new x(c.xmin,c.ymax,c.spatialReference));break;case "upperRight":h=
l.nearestCoordinate(a[q],new x(c.xmax,c.ymax,c.spatialReference))}c=l.buffer(h.coordinate,"UTM"===m?1E4:m/5,9001);if(l.contains(c,g.coordinate)){p=a[q];y.push(J.addGraphicLabel(new P(a[q]),b,f,n,D));f++;D++;k=a.indexOf(a[q]);a.splice(k,1);k=!1;break}}}return y},addGraphicLabel:function(a,b,d,m,l){m=J.convertNumberToLetters(m);l=J.convertNumberToLetters(l);var f={};switch(b){case "alphaNumeric":f.grid=m.toString()+d.toString();break;case "alphaAlpha":f.grid=m.toString()+"-"+l.toString();break;case "numeric":f.grid=
d.toString()}a.setAttributes(f);return a},checkPolarRegion:function(a){var b=new S({rings:[[[-180,84],[-180,90],[180,90],[180,84],[-180,84]],[[-180,-90],[-180,-80],[180,-80],[180,-90],[-180,-90]]],spatialReference:{wkid:4326}});return l.intersects(a,b)}};return J});