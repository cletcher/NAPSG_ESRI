// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/GroupFilter/LayersHandler":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/request".split(" "),function(u,p,n,l,m,g,r){return p([u],{declaredClass:"LayersHandler",layers:null,layerStore:[],fieldName:null,childList:null,validFieldTypes:"esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeDouble esriFieldTypeSingle esriFieldTypeString esriFieldTypeDate esriFieldTypeGeometry esriFieldTypeOID esriFieldTypeBlob esriFieldTypeGlobalID esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeXML".split(" "),
layersOnly:!1,constructor:function(d){p.safeMixin(this,d)},getAllMapLayers:function(){var d=[],h=new m,e;this.layerStore=[];l.forEach(this.layers,n.hitch(this,function(a){if(!a.featureCollection)if("undefined"===typeof a.originOperLayer||!a.originOperLayer.layerType||"ArcGISFeatureLayer"!==a.originOperLayer.layerType&&"ArcGISImageServiceLayer"!==a.originOperLayer.layerType)if(0<a.newSubLayers.length){if(this.childList=[],"undefined"===typeof a.originOperLayer.layerType||"ArcGISTiledMapServiceLayer"!==
a.originOperLayer.layerType&&"VectorTileLayer"!==a.originOperLayer.layerType)l.forEach(a.layerObject.layerInfos,n.hitch(this,function(f){f={label:f.name,id:a.id+"."+f.id,url:a.originOperLayer.url+"/"+f.id,type:"Layer",fieldName:this.fieldName,checked:!1,children:[],layer:a.layerObject};this.childList.push(f);d.push(this._getLayerInfo(f))})),e={label:a.title,id:a.id,url:a.originOperLayer.url,type:"Service",checked:!1,children:this.childList,layer:a.layerObject},this.layerStore.push(e)}else("undefined"===
typeof a.originOperLayer.layerType||"ArcGISTiledMapServiceLayer"!==a.originOperLayer.layerType&&"VectorTileLayer"!==a.originOperLayer.layerType)&&"ArcGISMapServiceLayer"===a.originOperLayer.layerType&&(this.childList=[],l.forEach(a.layerObject.layerInfos,n.hitch(this,function(f){f={label:f.name,id:a.id+"."+f.id,url:a.originOperLayer.url+"/"+f.id,type:"Layer",fieldName:this.fieldName,checked:!1,children:[],layer:a.layerObject};this.childList.push(f);d.push(this._getLayerInfo(f))})),e={label:a.title,
id:a.id,url:a.originOperLayer.url,type:"MapService",checked:!1,children:this.childList,layer:a.layerObject},this.layerStore.push(e));else"undefined"===typeof a.originOperLayer.featureCollection&&(e={label:a.title,id:a.id,url:a.url,fieldName:this.fieldName,type:"Feature Layer",checked:!1,children:[],layer:a.layerObject},d.push(this._getLayerInfo(e)),this.layerStore.push(e))}));g(d).then(n.hitch(this,function(){var a=this._controlComplete();this.emit("complete",a);h.resolve(a)}),n.hitch(this,function(){h.resolve(null)}));
return h.promise},_getLayerInfo:function(d){var h=new m;d.url?0===d.url.length?h.resolve():r({url:d.url,content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(e){if(e.hasOwnProperty("fields")&&!1===this.layersOnly){var a=l.map(e.fields,n.hitch(this,function(a){return{label:a.alias,id:d.id+"."+a.name,name:a.name,type:"Field",fieldType:a.type,checked:!1}})),a=l.filter(a,n.hitch(this,function(a){return 0<=l.indexOf(this.validFieldTypes,a.fieldType)}));d.children=a}d.geometryType=
e.geometryType;d.visible=!0;this.geometryTypes&&!l.some(this.geometryTypes,function(a){if(a===d.geometryType)return!0})&&(d.visible=!1);h.resolve(e)}),function(){h.resolve(null)}):h.resolve();return h.promise},_controlComplete:function(){l.forEach(this.layerStore,function(d){if(d.children&&0<d.children.length){var h=l.filter(d.children,function(d){return d.hasOwnProperty("visible")?d.visible:!0});d.children=h;0===d.children.length&&(d.visible=!1)}});return this.store={data:{identifier:"id",label:"label",
items:l.filter(this.layerStore,function(d){return d.hasOwnProperty("visible")?d.visible:!0})}}}})})},"widgets/GroupFilter/setting/presetValuePicker":function(){define("dojo/_base/declare jimu/BaseWidgetSetting jimu/dijit/FilterParameters dijit/_WidgetsInTemplateMixin dojo/on dojo/dom-construct dojo/dom-attr dojo/query dojo/_base/lang dojo/_base/array dijit/form/Select esri/layers/FeatureLayer dojo/text!./presetValuePicker.html".split(" "),function(u,p,n,l,m,g,r,d,h,e,a,f,t){return u([p,l],{baseClass:"jimu-widget-map-filter-preset",
templateString:t,layerList:null,map:null,nls:null,valueParam:null,postCreate:function(){this.inherited(arguments);this.startup()},startup:function(){this.inherited(arguments);this.createLayerSelection()},createLayerSelection:function(){var d=[];e.forEach(this.layerList,h.hitch(this,function(a){if(0<a.children.length)e.forEach(a.children,h.hitch(this,function(a){var c={};c.value=a.id;c.label=a.label;c.selected=!1;d.push(c)}));else{var c={};c.value=a.id;c.label=a.label;c.selected=!1;d.push(c)}}));var f=
(new a({options:d})).placeAt(this.layerLevel);f.startup();this.own(m(f,"change",h.hitch(this,function(a){this.createFieldSelection(a)})));this.createFieldSelection(f.value)},createFieldSelection:function(d){var f=[];e.forEach(this.layerList,h.hitch(this,function(a){0<a.children.length?e.forEach(a.children,h.hitch(this,function(a){a.id===d&&e.forEach(a.children,h.hitch(this,function(a){if(-1==="esriFieldTypeBlob,esriFieldTypeOID".indexOf(a.fieldType)){var c={};c.value=a.name;c.label=a.label;c.selected=
!1;f.push(c)}}))})):a.id===d&&e.forEach(a.layer.fields,h.hitch(this,function(a){if(-1==="esriFieldTypeBlob,esriFieldTypeOID".indexOf(a.type)){var c={};c.value=a.name;c.label=""===a.alias?a.name:a.alias;c.selected=!1;f.push(c)}}))}));g.empty(this.fieldLevel);var v=(new a({options:f})).placeAt(this.fieldLevel);v.startup();this.own(m(v,"change",h.hitch(this,function(a){this.createValueList(a,d)})));this.createValueList(v.value,d)},createValueList:function(a,l){g.empty(this.valueLevel);this.valueParam=
new n;this.valueParam.placeAt(this.valueLevel);this.valueParam.startup();setTimeout(function(){var a=d(".jimu-single-filter-parameter"),a=d("colgroup",a[0]);0<a.length&&r.set(a[0].childNodes[1],"width","0px")},200);e.forEach(this.layerList,h.hitch(this,function(g){0<g.children.length?e.forEach(g.children,h.hitch(this,function(c){c.id===l&&e.forEach(c.children,h.hitch(this,function(e){if("Shape"!==e.name&&e.name===a){var g=new f(c.url);this.own(m(g,"load",h.hitch(this,function(){var a=this._makefilterObject({name:e.name,
label:e.label,type:e.fieldType});this.valueParam.build(c.url,g,a);a=d(".jimu-single-filter-parameter");a=d("colgroup",a[0]);r.set(a[0].childNodes[1],"width","0px")})))}}))})):g.id===l&&e.forEach(g.layer.fields,h.hitch(this,function(c){c.name===a&&(c=this._makefilterObject({name:c.name,label:c.alias,type:c.type}),this.valueParam.build(g.layer.url,g.layer,c),c=d(".jimu-single-filter-parameter"),c=d("colgroup",c[0]),0<c.length&&r.set(c[0].childNodes[1],"width","0px"))}))}))},_makefilterObject:function(a){var d=
{},e=[],c={fieldObj:{}};c.fieldObj.name=a.name;c.fieldObj.label="undefined"===typeof a.alias?a.name:a.alias;c.fieldObj.shortType=a.type.replace("esriFieldType","").toLowerCase();if("guid"!==c.fieldObj.shortType||"globalid"!==c.fieldObj.shortType)c.fieldObj.shortType="string";"date"!==c.fieldObj.shortType&&"string"!==c.fieldObj.shortType&&(c.fieldObj.shortType="number");c.fieldObj.type=a.type;c.operator=c.fieldObj.shortType+"OperatorIs";c.valueObj={};c.valueObj.isValid=!0;c.valueObj.type="unique";
c.valueObj.value="";c.interactiveObj={};c.interactiveObj.prompt="";c.interactiveObj.hint="";c.caseSensitive=!1;e.push(c);d.logicalOperator="OR";d.expr="";d.parts=e;return d}})})},"widgets/GroupFilter/setting/_build-generate_module":function(){define(["dojo/text!./Setting.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/GroupFilter/setting/presetValuePicker.html":'\x3cdiv\x3e\r\n\t\x3cdiv\x3e\x3ch3\x3e${nls.picker.description}\x3c/h3\x3e\x3c/div\x3e\r\n\t\x3cbr\x3e\r\n\t\x3ctable width\x3d"100%" cellpadding\x3d"2" cellspacing\x3d"2"\x3e\r\n\t\t\x3ctr\x3e\r\n\t\t\t\x3ctd class\x3d"picker-cell"\x3e\r\n\t\t\t\t${nls.picker.layer}\x3cbr\x3e\r\n\t\t\t\t\x3cdiv class\x3d"" data-dojo-attach-point\x3d"layerLevel"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/td\x3e\r\n\t\t\x3c/tr\x3e\r\n\t\t\x3ctr\x3e\r\n\t\t\t\x3ctd class\x3d"picker-cell"\x3e\r\n\t\t\t\t${nls.picker.field}\x3cbr\x3e\r\n\t\t\t\t\x3cdiv class\x3d"" data-dojo-attach-point\x3d"fieldLevel"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/td\x3e\r\n\t\t\x3c/tr\x3e\r\n\t\t\x3ctr\x3e\r\n\t\t\t\x3ctd class\x3d"picker-cell"\x3e\r\n\t\t\t\t${nls.picker.value}\x3cbr\x3e\r\n\t\t\t\t\x3cdiv class\x3d"value-level" data-dojo-attach-point\x3d"valueLevel"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/td\x3e\r\n\t\t\x3c/tr\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/GroupFilter/setting/Setting.html":'\x3cdiv\x3e\r\n\t\x3clabel\x3e${nls.configText}\x3c/label\x3e\r\n\t\x3cdiv class\x3d"widget-intro" data-dojo-attach-point\x3d"widgetIntro"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"layer-Mapping-Block" data-dojo-attach-point\x3d"layerMappingBlock" id\x3d"layerMappingBlock"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"jimu-btn layer-Mapping-Block-add" data-dojo-attach-point\x3d"layerMappingBlockAdd" data-dojo-attach-event\x3d"click:createGroupBlock" title\x3d"${nls.buttons.addNewGroupTip}"\x3e${nls.buttons.addNewGroup}\x3c/div\x3e\r\n\t\x3chr\x3e\r\n\t\x3cdiv\x3e\r\n\t\t\x3ctable width\x3d"90%"\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox"  data-dojo-attach-point\x3d"chkSimpleMode" data-dojo-props\x3d"value:true,checked:false"/\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd title\x3d"${nls.inputs.simpleModeTip}"\x3e${nls.inputs.simpleMode}\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox"  data-dojo-attach-point\x3d"chkOptionsMode" data-dojo-props\x3d"value:true,checked:false"/\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd title\x3d"${nls.inputs.optionsModeTip}"\x3e${nls.inputs.optionsMode}\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox"  data-dojo-attach-point\x3d"chkWebmapAppendMode" data-dojo-props\x3d"value:true,checked:true"/\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd title\x3d"${nls.inputs.webmapAppendModeTip}"\x3e\r\n\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"slAppendChoice" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n\t\t\t\t\t    \x3coption value\x3d"OR"\x3e${nls.inputs.webmapAppendModeAny}\x3c/option\x3e\r\n\t\t\t\t\t    \x3coption value\x3d"AND"\x3e${nls.inputs.webmapAppendModeAll}\x3c/option\x3e\r\n\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox"  data-dojo-attach-point\x3d"chkZoomMode" data-dojo-props\x3d"value:true,checked:true"/\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd title\x3d"${nls.zoomTo} ${nls.allFeaturesTip}"\x3e${nls.zoomTo}\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox"  data-dojo-attach-point\x3d"chkPersistOnClose" data-dojo-props\x3d"value:true,checked:false"/\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd title\x3d"${nls.inputs.persistOnClose}"\x3e${nls.inputs.persistOnClose}\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/GroupFilter/setting/css/style.css":'.jimu-widget-map-filter input{margin-left: 10px;}.jimu-widget-map-filter .group-block {background-color: #FFFFFF; border-color: #e1e1e1; border-style: solid; border-width: 2px; border-radius: 5px; width: 100%; text-align: left; position: relative; margin-top: 10px;}.jimu-widget-map-filter .layer-Mapping-Block-add {margin-top: 10px; margin-bottom: 5px;}.jimu-widget-map-filter .group-setting-table {width: 100%; margin-left: 10px;}.jimu-widget-map-filter .group-block-item {position: relative; width: 90%;}.jimu-widget-map-filter .group-block-delete{padding-left: 10px; padding-right: 10px; cursor: pointer; cursor: hand; content: url("../../images/delete.png");}.jimu-widget-map-filter .group-block-delete:after{padding-left: 10px; padding-right: 10px; cursor: pointer; cursor: hand; content: url("../../images/delete.png");}.jimu-widget-map-filter .group-block-delete:hover{padding-left: 10px; padding-right: 10px; cursor: pointer; cursor: hand; content: url("../../images/delete_hover.png");}.jimu-widget-map-filter .group-block-layer-select {}.jimu-widget-map-filter .group-block-field-select {position: absolute; right: 0px; top: 0px;}.jimu-widget-map-filter .group-block-add-layer {margin-top: 5px; margin-bottom: 5px; margin-left: 10px; margin-right: 10px;}.jimu-widget-map-filter .groupName-textbox {margin-top: 5px; margin-bottom: 5px; margin-left: 0px; margin-right: 0px; width: 175px;}.jimu-widget-map-filter .groupName-Desctextbox {margin-top: 5px; margin-bottom: 5px; margin-left: 10px; margin-right: 10px; width: 400px;}.jimu-widget-map-filter .groupName-Defaulttextbox {margin-top: 5px; margin-bottom: 5px; margin-left: 10px; margin-right: 10px; width: 400px;}.jimu-widget-map-filter .groupName-defaultPicker {padding-left: 10px; padding-right: 10px; content: url("../../images/find.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .groupName-defaultPicker:after {padding-left: 10px; padding-right: 10px; content: url("../../images/find.png"); cursor: hand; cursor: pointer;}.jimu-widget-map-filter .layer-tables {margin-top: 5px; margin-bottom: 5px; width: 98%; margin-left: 10px;}.jimu-widget-map-filter .operator-select {font-size: 8pt;}.jimu-widget-map-filter .operator-append-select {font-size: 8pt; margin-top: 5px; margin-bottom: 5px; margin-left: 10px; margin-right: 10px;}.jimu-widget-map-filter-preset .picker-cell {padding-bottom: 15px;}.jimu-widget-map-filter-preset .value-level{margin-left: -3px; margin-right: -3px;}',
"*now":function(u){u(['dojo/i18n!*preload*widgets/GroupFilter/setting/nls/Setting*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare jimu/BaseWidgetSetting dijit/_WidgetsInTemplateMixin jimu/dijit/SimpleTable dojo/dom dojo/dom-construct dojo/dom-class dojo/on dojo/query dojo/dom-attr dojo/_base/lang dojo/_base/array dijit/form/Select dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/CheckBox jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/Popup dojox/html/entities ../LayersHandler ./presetValuePicker".split(" "),function(u,p,n,l,m,g,r,d,h,e,a,f,t,B,F,v,c,E,w,G,C,H,I){return u([p,
n],{baseClass:"jimu-widget-map-filter",groupCounter:0,groupLayerContainer:[],groupLayerName:[],groupLayerDesc:[],groupLayerOperator:[],groupLayerDefault:[],groupAppendSameConjunc:[],groupCaseSearch:[],layerCounter:0,layerList:null,postMixInProperties:function(){this.nls=a.mixin(this.nls,window.jimuNls.common);this.nls=a.mixin(this.nls,window.jimuNls.spatialFilterByFeatures)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this.setConfig(this.config)},
setConfig:function(a){this.config=a;this.groupLayerContainer=[];this.groupLayerName=[];this.groupLayerDesc=[];this.groupLayerOperator=[];this.groupLayerDefault=[];this.groupAppendSameConjunc=[];this.groupCaseSearch=[];this.chkSimpleMode.set("checked",this.config.simpleMode);this.chkOptionsMode.set("checked",this.config.optionsMode);this.chkWebmapAppendMode.set("checked",this.config.webmapAppendMode);this.slAppendChoice.set("value",this.config.slAppendChoice);this.chkZoomMode.set("checked",this.config.zoomMode);
this.chkPersistOnClose.set("checked",this.config.persistOnClose);this.createMapLayerList()},getConfig:function(){if(null===this.layerList)return new w({message:this.nls.errors.noLayers}),!1;if(0<this.layerList.length){var b=this.validateNoGroups(),k=this.validateNoGroupsName(),d=this.validateDuplicateGroupsName(),e=this.validateTableRows();return b&&k&&d&&e?(this.config.simpleMode=this.chkSimpleMode.checked,this.config.optionsMode=this.chkOptionsMode.checked,this.config.webmapAppendMode=this.chkWebmapAppendMode.checked,
this.config.slAppendChoice=this.slAppendChoice.get("value"),this.config.zoomMode=this.chkZoomMode.checked,this.config.persistOnClose=this.chkPersistOnClose.checked,this.config.groups=[],f.forEach(this.groupLayerName,a.hitch(this,function(b,d){if(null!==b&&null!==this.groupLayerContainer[d]){var k={};k.name=c.sanitizeHTML(b.value);k.desc=c.sanitizeHTML(this.groupLayerDesc[d].value);k.operator=c.sanitizeHTML(this.groupLayerOperator[d].value);k.defaultVal=c.sanitizeHTML(this.groupLayerDefault[d].value);
k.appendSameLayer=!0;k.appendSameLayerConjunc=this.groupAppendSameConjunc[d].value;k.caseSearch=this.groupCaseSearch[d].get("checked");k.layers=[];f.forEach(this.groupLayerContainer[d].getRows(),a.hitch(this,function(a){var b={},d=a.cells[2].childNodes[0];b.layer=a.layerCol.value;b.field=a.fieldCol.value;b.dataType=a.dataTypeCol.attr("displayedValue");b.useDomain=d.checked?d.checked:"";k.layers.push(b)}));this.config.groups.push(k)}})),this.config):!1}new w({message:this.nls.errors.noLayers});return!1},
createMapLayerList:function(){E.getInstance(this.map,this.map.itemInfo).then(a.hitch(this,function(b){b._layerInfos&&0<b._layerInfos.length&&(b=new H({layers:b._layerInfos}),this.own(d(b,"complete",a.hitch(this,function(b){this.layerList=b.data.items;0<this.config.groups.length?f.forEach(this.config.groups,a.hitch(this,function(a){this.createGroupBlock({group:a})})):this.createGroupBlock({group:null})}))),this.own(d(b,"error",a.hitch(this,function(){console.log("error")}))),b.getAllMapLayers())}))},
createGroupBlock:function(b){this.groupCounter++;var k=g.create("div",{id:"grpDiv_"+this.groupCounter,"class":"group-block"});g.place(k,this.layerMappingBlock);var c=g.create("table",{"class":"group-setting-table"});g.place(c,k);var f=c.insertRow(-1),h=f.insertCell(0);e.set(h,"title",this.nls.labels.groupNameTip);var l=f.insertCell(1),y=f.insertCell(2);e.set(y,"title",this.nls.labels.groupDescTip);var k=f.insertCell(3),f=f.insertCell(4),x=c.insertRow(-1),z=x.insertCell(0);e.set(z,"title",this.nls.labels.groupOperatorTip);
var J=x.insertCell(1),A=x.insertCell(2);e.set(A,"title",this.nls.labels.groupDefaultTip);var K=x.insertCell(3),x=x.insertCell(4),q=c.insertRow(-1),n=q.insertCell(0);e.set(n,"colspan","3");var u=q.insertCell(1);q.insertCell(2);e.set(q,"id","appendLayers_"+this.groupCounter);var q=c.insertRow(-1),t=q.insertCell(0);e.set(t,"colspan","3");c=q.insertCell(1);q.insertCell(2);e.set(q,"id","caseSearch_"+this.groupCounter);h.innerHTML=this.nls.labels.groupName;y.innerHTML=this.nls.labels.groupDesc;z.innerHTML=
this.nls.labels.groupOperator;A.innerHTML=this.nls.labels.groupDefault;n.innerHTML=this.nls.labels.sameLayerAppend;t.innerHTML=this.nls.labels.caseSearch;y=A=h=n=q="";z=!1;"undefined"!==typeof b.group&&null!==b.group&&(q=b.group.name,n=b.group.desc,h=b.group.operator,A=b.group.defaultVal,"undefined"!==typeof b.group.appendSameLayerConjunc&&(y=b.group.appendSameLayerConjunc),"undefined"!==typeof b.group.caseSearch&&(z=b.group.caseSearch));q=new F({name:"txtGroupName",value:q,"class":"groupName-textbox",
placeHolder:this.nls.inputs.groupName,required:"true"});g.place(q.domNode,l);this.groupLayerName.push(q);l=new B({name:"txtGroupDesc",value:n,"class":"groupName-Desctextbox",placeHolder:this.nls.inputs.groupDesc});g.place(l.domNode,k);this.groupLayerDesc.push(l);var p=new B({name:"txtGroupDefault",value:A,"class":"groupName-Defaulttextbox",placeHolder:this.nls.inputs.groupDefault});g.place(p.domNode,K);this.groupLayerDefault.push(p);k=g.create("div",{"class":"groupName-defaultPicker"});g.place(k,
x);this.own(d(k,"click",a.hitch(this,function(){this.presetPickerPopup(p)})));var r=g.create("div",{id:"addGroupDelete_"+this.groupCounter,"class":"group-block-delete"}),w=d(r,"click",a.hitch(this,function(){w.remove();this.removeGroup(r.id)}));g.place(r,f);this.createOperatorSelection({cell:J,value:h});this.createAppendConjunc({cell:u,value:y});this.createCaseSearch({cell:c,value:z});this.createTableObject(b);var v=g.create("div",{id:"addLyrDiv_"+this.groupCounter,"class":"jimu-btn group-block-add-layer",
title:this.nls.buttons.addLayerTip});this.own(d(v,"click",a.hitch(this,function(){this.addLayerRow(v.id)})));g.place(v,m.byId("grpDiv_"+this.groupCounter));m.byId("addLyrDiv_"+this.groupCounter).innerHTML=this.nls.buttons.addLayer},createOperatorSelection:function(a){var b=(new t({options:[{value:"",label:this.nls.inputs.optionNONE},{value:"\x3d",label:this.nls.inputs.optionEQUAL},{value:"\x3c\x3e",label:this.nls.inputs.optionNOTEQUAL},{value:"\x3e",label:this.nls.inputs.optionGREATERTHAN},{value:"\x3e\x3d",
label:this.nls.inputs.optionGREATERTHANEQUAL},{value:"\x3c",label:this.nls.inputs.optionLESSTHAN},{value:"\x3c\x3d",label:this.nls.inputs.optionLESSTHANEQUAL},{value:"START",label:this.nls.inputs.optionSTART},{value:"END",label:this.nls.inputs.optionEND},{value:"LIKE",label:this.nls.inputs.optionLIKE},{value:"NOT LIKE",label:this.nls.inputs.optionNOTLIKE},{value:"d\x3c\x3d",label:this.nls.inputs.optionONORBEFORE},{value:"d\x3e\x3d",label:this.nls.inputs.optionONORAFTER}],"class":"operator-select"})).placeAt(a.cell);
b.startup();b.set("value",C.decode(a.value));this.groupLayerOperator.push(b)},createAppendConjunc:function(a){var b=(new t({options:[{value:"OR",label:this.nls.inputs.sameLayerAny},{value:"AND",label:this.nls.inputs.sameLayerAll}],"class":"operator-append-select"})).placeAt(a.cell);b.startup();b.set("value",C.decode(a.value));this.groupAppendSameConjunc.push(b)},createCaseSearch:function(a){var b=(new v({"class":"operator-append-select"})).placeAt(a.cell);b.startup();b.set("checked",a.value);this.groupCaseSearch.push(b)},
createTableObject:function(b){var d=null,d=[{name:"layerCol",title:this.nls.tables.layer,"class":"label",type:"empty",width:"375px"},{name:"fieldCol",title:this.nls.tables.field,"class":"label",type:"empty",width:"350px"},{name:"domainCol",title:this.nls.tables.value,"class":"label",type:"radio",width:"100px"},{name:"actions",title:this.nls.tables.action,type:"actions",actions:["delete"],width:"100px"},{name:"dataTypeCol",type:"empty",hidden:!0,width:0}],d=new l({fields:d,"class":"layer-tables"});
d.placeAt(m.byId("grpDiv_"+this.groupCounter));this.groupLayerContainer.push(d);"undefined"!==typeof b.group&&null!==b.group?f.forEach(b.group.layers,a.hitch(this,function(a){this.addLayerRow(m.byId("grpDiv_"+this.groupCounter).id,a)})):this.addLayerRow(m.byId("grpDiv_"+this.groupCounter).id,b)},addLayerRow:function(b,c){b=b.substring(b.indexOf("_")+1);var k=this.groupLayerContainer[b-1].addRow({});if(k.success&&k.tr){k=k.tr;this.createLayerSelection(k,c,b);var f=k.cells[2].childNodes[0],e=f.checked;
this.own(d(f,"click",a.hitch(this,function(){e=e?f.checked=!1:f.checked=!0})))}},createLayerSelection:function(b,c,e){var k=[];f.forEach(this.layerList,a.hitch(this,function(b){if(0<b.children.length)f.forEach(b.children,a.hitch(this,function(a){var b={};b.value=a.id;b.label=a.label;b.selected=!1;k.push(b)}));else{var d={};d.value=b.id;d.label=b.label;d.selected=!1;k.push(d)}}));var g=h(".simple-table-cell",b)[0],l;g&&(l=(new t({options:k})).placeAt(g),l.startup(),b.layerCol=l,this.own(d(l,"change",
a.hitch(this,function(a){this.createFieldSelection(a,b,c,e)}))),"undefined"!==typeof c&&l.set("value",c.layer));this.createFieldSelection(l.value,b,c,e)},createFieldSelection:function(b,c,e,l){var k=[],n=[];f.forEach(this.layerList,a.hitch(this,function(c){0<c.children.length?f.forEach(c.children,a.hitch(this,function(c){c.id===b&&f.forEach(c.children,a.hitch(this,function(a){if(-1==="esriFieldTypeBlob,esriFieldTypeOID".indexOf(a.fieldType)){var b={};b.value=a.name;b.label=a.label;b.selected=!1;k.push(b);
b={};b.value=a.name;b.label=a.fieldType;b.selected=!1;n.push(b)}}))})):c.id===b&&f.forEach(c.layer.fields,a.hitch(this,function(a){if(-1==="esriFieldTypeBlob,esriFieldTypeOID".indexOf(a.type)){var b={};b.value=a.name;b.label=""===a.alias?a.name:a.alias;b.selected=!1;k.push(b);b={};b.value=a.name;b.label=a.type;b.selected=!1;n.push(b)}}))}));var m=h(".simple-table-cell",c)[1],D=h(".simple-table-cell",c)[4];if(m){g.empty(m);m=(new t({options:k})).placeAt(m);m.startup();c.fieldCol=m;g.empty(D);var p=
(new t({options:n})).placeAt(D);p.startup();c.dataTypeCol=p;this.own(d(m,"change",a.hitch(this,function(a){this.resetRadio({layer:b,field:a,row:c,param:e,counter:l});this.dataTypeSync({layer:b,field:a,row:c,param:e,select:p})})));"undefined"!==typeof e&&(this.resetRadio({layer:b,row:c,param:e,counter:l}),m.set("value",e.field),p.set("value",e.field))}},dataTypeSync:function(a){a.select.set("value",a.field)},resetRadio:function(a){var b=a.row.cells[2].childNodes[0];"undefined"!==typeof a.param&&(a.param.hasOwnProperty("useDomain")?
b.checked=""!==a.param.useDomain?!0:!1:b.checked=!1)},validateNoGroups:function(){var b=!1,c=this.nls.errors.noGroups;f.forEach(this.groupLayerName,a.hitch(this,function(a){null!==a&&(b=!0)}));if(b)return!0;new w({message:c});return!1},validateNoGroupsName:function(){var b=!0,c=this.nls.errors.noGroupName;f.forEach(this.groupLayerName,a.hitch(this,function(a){null!==a&&(a.get("value")||(b=!1))}));!1===b&&new w({message:c});return b},validateDuplicateGroupsName:function(){var b=!0,c=this.nls.errors.noDuplicates,
d=[];f.forEach(this.groupLayerName,a.hitch(this,function(a){null!==a&&a.get("value")&&d.push(a.get("value"))}));1<d.length&&d.sort().filter(function(a,b,c){return a!==c[b-1]}).length!==d.length&&(b=!1);!1===b&&new w({message:c});return b},validateTableRows:function(){var b=!0;f.forEach(this.groupLayerContainer,a.hitch(this,function(a){null!==a&&0>=a.getRows().length&&(b=!1)}));!1===b&&new w({message:this.nls.errors.noRows});return b},presetPickerPopup:function(b){var c=new I({map:this.map,nls:this.nls,
layerList:this.layerList}),d=new G({titleLabel:this.nls.popup.label,width:500,height:420,content:c,buttons:[{label:window.jimuNls.common.ok,onClick:a.hitch(this,function(){var a="";if("undefined"!==typeof c.valueParam&&null!==c.valueParam.getFilterExpr()){var e=c.valueParam.getValueProviders()[0].getValueObject();e&&(a=e.value);b.set("value",a)}d.close();d=null})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"]}]})},removeGroup:function(a){a=a.substring(a.indexOf("_")+1);this.groupLayerContainer[a-
1]=null;this.groupLayerName[a-1]=null;this.groupLayerDesc[a-1]=null;this.groupLayerOperator[a-1]=null;this.groupLayerDefault[a-1]=null;this.groupAppendSameConjunc[a-1]=null;g.destroy(m.byId("addGroupDelete_"+a));g.destroy(m.byId("addLyrDiv_"+a));g.destroy(m.byId("grpDiv_"+a))}})});