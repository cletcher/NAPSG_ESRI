// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Directions/setting/PresetDestinations.html":'\x3cdiv\x3e\r\n  \x3cspan class\x3d"title"\x3e${nls.presetDestinations}\x3c/span\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\r\n  \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd style\x3d"width:50%;"\x3e\r\n        \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n          \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd style\x3d"width:200px;"\x3e\r\n              \x3cspan class\x3d"impedance-attribute jimu-ellipsis"\x3e${nls.startPoint}\x3c/span\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd style\x3d"width:auto;"\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"startSearchDom" style\x3d"width:220px;"\x3e\x3c/span\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"startSearchResultsNode" class\x3d"searchResults arcgisSearch"\x3e\x3c/div\x3e\r\n              \x3c!--\x3cdiv data-dojo-attach-point\x3d"startSearchError" class\x3d"hide preset-des-error"\x3eNo Results\x3c/div\x3e--\x3e\r\n            \x3c/td\x3e\r\n\r\n            \x3ctd style\x3d"width:200px;"\x3e\r\n              \x3cspan class\x3d"impedance-attribute jimu-ellipsis"\x3e${nls.endPoint}\x3c/span\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd style\x3d"width:auto;"\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"endSearchDom" class\x3d"end-search" style\x3d"width:220px;"\x3e\x3c/span\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"endSearchResultsNode" class\x3d"searchResults arcgisSearch"\x3e\x3c/div\x3e\r\n              \x3c!--\x3cdiv data-dojo-attach-point\x3d"endSearchError" class\x3d"hide preset-des-error"\x3eNo Results\x3c/div\x3e--\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/on dojo/_base/html dojo/query esri/lang dojo/Deferred esri/tasks/locator jimu/utils ../searchUtil jimu/LayerInfos/LayerInfos dojo/when dojo/promise/all dojo/_base/array esri/layers/FeatureLayer dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PresetDestinations.html esri/dijit/Search jimu/dijit/RadioBtn".split(" "),function(w,e,g,f,m,x,t,u,n,q,y,z,A,r,B,C,D,E,F,v){return w([C,D,E],{templateString:F,_defaultLocations:null,
_startSearchResults:null,_endSearchResults:null,_isSearchResultsShown:!1,_ERROR_CLASS:"have-error",constructor:function(b){b&&(this._defaultLocations=[],this._defaultLocations=this._parseDefaultLocations(b.defaultLocations),this.nls=b.nls)},postCreate:function(){this.inherited(arguments)},startup:function(){this._getLayerInfos().then(e.hitch(this,function(){this.startSearch=new v({enableSuggestions:!1,enableButtonMode:!1,theme:"arcgisSearch"});this.startSearch.placeAt(this.startSearchDom);this.own(g(this.startSearch,
"search-results",e.hitch(this,"_onStartSearchResults")));this.own(g(this.startSearchResultsNode,"li:click",e.hitch(this,"_onSelectStartSearchResult")));this.own(g(this.startSearch.inputNode,"focus",e.hitch(this,"_onCleanStartError")));this.own(g(this.startSearch.inputNode,"blur",e.hitch(this,function(){!1===this._isSearchResultsShown&&this.startSearch&&this.startSearch.search&&this.startSearch.search()})));this.endSearch=new v({enableSuggestions:!1,enableButtonMode:!1,theme:"arcgisSearch"});this.endSearch.placeAt(this.endSearchDom);
this.own(g(this.endSearch,"search-results",e.hitch(this,"_onEndSearchResults")));this.own(g(this.endSearchResultsNode,"li:click",e.hitch(this,"_onSelectEndSearchResult")));this.own(g(this.endSearch.inputNode,"focus",e.hitch(this,"_onCleanEndError")));this.own(g(this.endSearch.inputNode,"blur",e.hitch(this,function(){!1===this._isSearchResultsShown&&this.endSearch&&this.endSearch.search&&this.endSearch.search()})));this.own(g(window.document,"click",e.hitch(this,function(a){f.isDescendant(a.target,
this.searchResultsNode)||this._hideResultMenu()})));if(this._defaultLocations&&this._defaultLocations.length&&0<this._defaultLocations.length)for(var b=0,a=this._defaultLocations.length;b<a;b++)0===b?this._setSearchValue(this.startSearch,this._defaultLocations[b]):1===b&&this._setSearchValue(this.endSearch,this._defaultLocations[b])}));this.inherited(arguments)},_setSearchValue:function(b,a){"string"===typeof a?b.set("value",a):a.name&&(b.set("selectedResult",a),b.set("value",a.name))},getValue:function(){var b=
[],a=this._getSearchRest(this.startSearch,this._defaultLocations[0]);b.push(a);a=this._getSearchRest(this.endSearch,this._defaultLocations[1]);b.push(a);return b},_getSearchRest:function(b,a){var c=b.selectedResult;if(c)c.feature&&(c.feature._layer&&(c.feature._layer=""),c.feature._sourceLayer&&(c.feature._sourceLayer=""));else if(b.value)c=!1,"string"===typeof a?c=a!==b.value:a.name&&(c=a.name!==b.value),c=c?b.value:a;else return"";return c},_parseDefaultLocations:function(b){for(var a=[],c=0,d=
b.length;c<d;c++)a.push(b[c]);return a},setValue:function(b){b&&0<b.length&&(this._defaultLocations=[],this._defaultLocations=this._parseDefaultLocations(b))},validate:function(){var b=!1;m(".searchLoading",this.domNode).forEach(e.hitch(this,function(){b=!0}));return!1!==b||f.hasClass(this.startSearch,this._ERROR_CLASS)||f.hasClass(this.endSearch,this._ERROR_CLASS)?!1:!0},setSources:function(b){if(b&&b.sources&&b.sources.length)this.shelter.show(),z(q.getConfigInfo(b)).then(e.hitch(this,function(a){return A(this._convertConfig(a)).then(function(a){return r.filter(a,
function(a){return a})})})).then(e.hitch(this,function(a){this.startSearch.set("sources",a);this.endSearch.set("sources",a);this.shelter.hide()}));else if(a&&a.url&&a.singleLineFieldName){var a={locator:new u(a.url||""),outFields:["*"],singleLineFieldName:a.singleLineFieldName};this.startSearch.set("sources",[a]);this.endSearch.set("sources",[a])}else this.startSearch.set("sources",[]),this.endSearch.set("sources",[])},_onCleanError:function(b){f.removeClass(b,this._ERROR_CLASS)},_onCleanStartError:function(){this._onCleanError(this.startSearch)},
_onCleanEndError:function(){this._onCleanError(this.endSearch)},_onStartSearchResults:function(b){this._onSearchResults(b,{searchDijit:this.startSearch,searchResultsNode:this.startSearchResultsNode,searchError:this.startSearchError,results:"start"})},_onEndSearchResults:function(b){this._onSearchResults(b,{searchDijit:this.endSearch,searchResultsNode:this.endSearchResultsNode,searchError:this.endSearchError,results:"end"})},_onSearchResults:function(b,a){var c=a.searchDijit.get("sources"),d=a.searchDijit.get("activeSourceIndex"),
e=a.searchDijit.get("value"),k="",l=b.results;if(""!==e)if(l&&0<b.numResults){"start"===a.results?this._startSearchResults=l:"end"===a.results&&(this._endSearchResults=l);var k=k+'\x3cdiv class\x3d"searchMenu searchResultsMenu" role\x3d"menu"\x3e',h;for(h in l)if(l[h]&&l[h].length){b=c[parseInt(h,10)].name;1<c.length&&"all"===d&&(k+='\x3cdiv title\x3d"'+b+'" class\x3d"menuHeader"\x3e'+b+"\x3c/div\x3e");k+="\x3cul\x3e";b=new RegExp("("+e+")","gi");for(var g=c[h].maxResults||5,p=0,m=l[h].length;p<m&&
p<g;p++)var n=x.isDefined(l[h][p].name)?l[h][p].name:this.nls.untitled,k=k+('\x3cli title\x3d"'+n+'" data-index\x3d"'+p+'" data-source-index\x3d"'+h+'" role\x3d"menuitem" tabindex\x3d"0"\x3e'+n.toString().replace(b,"\x3cstrong \x3e$1\x3c/strong\x3e")+"\x3c/li\x3e");k+="\x3c/url\x3e"}a.searchResultsNode.innerHTML=k+"\x3c/div\x3e";this._showResultMenu(a.searchDijit,a.searchResultsNode);this._resetSelectorPosition(a.searchDijit,".searchResultsMenu")}else f.addClass(a.searchDijit,this._ERROR_CLASS),this._resetSelectorPosition(a.searchDijit,
".noResultsMenu")},_onSelectStartSearchResult:function(b){this._onSelectSearchResult(b,this.startSearch,this._startSearchResults)},_onSelectEndSearchResult:function(b){this._onSelectSearchResult(b,this.endSearch,this._endSearchResults)},_onSelectSearchResult:function(b,a,c){for(b=b.target;!f.hasAttr(b,"data-source-index")||!f.getAttr(b,"data-index");)b=b.parentNode;var d=null,d=f.getAttr(b,"data-source-index");b=parseInt(f.getAttr(b,"data-index"),10);"all"!==d&&(d=parseInt(d,10));c&&c[d]&&c[d][b]&&
(d=c[d][b],a.select(d),d.name&&a.set("value",d.name))},_showResultMenu:function(b,a){f.setStyle(a,"display","block");m(".searchMenu",a).style("display","block");this._isSearchResultsShown=!0;if(b=m(".searchInputGroup",b.domNode)[0])b={width:f.getMarginBox(b).w+"px"},m(".searchMenu",a).style(b)},_resetSelectorPosition:function(b,a){var c=f.getMarginBox(this.domNode.offsetParent);m(a,this.domNode).forEach(e.hitch(this,function(d){var e=f.position(d),k=f.position(b.domNode),k=".noResultsMenu"===a?0:
k.h;e.y+e.h>c.h&&f.setStyle(d,"top",-(e.h+k)-4+"px")}))},_hideResultMenu:function(){m(".searchMenu",this.domNode).style("display","none");this._isSearchResultsShown=!1},_getLayerInfos:function(){var b=new t;y.getInstance(this.map,this.map.itemInfo).then(e.hitch(this,function(a){this.layerInfosObj=a;this.own(this.layerInfosObj.on("layerInfosFilterChanged",e.hitch(this,function(a){q.config.onLayerInfosFilterChanged(a,this.config)})));b.resolve()}));return b},_convertConfig:function(b){return r.map(b.sources,
e.hitch(this,function(a){var b=new t;if(a&&a.url&&"locator"===a.type){var d={locator:new u(a.url||""),outFields:["*"],singleLineFieldName:a.singleLineFieldName||"",name:n.stripHTML(a.name||""),placeholder:n.stripHTML(a.placeholder||""),countryCode:a.countryCode||"",maxSuggestions:a.maxSuggestions,useMapExtent:!!a.searchInCurrentMapExtent};a.enableLocalSearch&&(d.localSearchOptions={minScale:a.localSearchMinScale,distance:a.localSearchDistance});a.zoomScale&&(d.autoNavigate=!1);b.resolve(d)}else a&&
a.url&&"query"===a.type?(d=new B(a.url||null,{outFields:["*"]}),this.own(g(d,"load",e.hitch(this,function(c){var d=c.layer;c=this.map.getLayer(a.layerId);var f=this.layerInfosObj.getLayerInfoById(a.layerId);c?f=c=!1:f?f=c=!1:(c=!1,f=!0);var h=null;a.searchFields&&0<a.searchFields.length?h=a.searchFields:(h=[],r.forEach(d.fields,function(a){"esriFieldTypeOID"!==a.type&&a.name!==d.objectIdField&&"esriFieldTypeGeometry"!==a.type&&h.push(a.name)}));var g={featureLayer:d,outFields:["*"],searchFields:h,
autoNavigate:!1,displayField:a.displayField||"",exactMatch:!!a.exactMatch,name:n.stripHTML(a.name||""),placeholder:n.stripHTML(a.placeholder||""),maxSuggestions:a.maxSuggestions||6,useMapExtent:!!a.searchInCurrentMapExtent,showInfoWindowOnSelect:c,enableInfoWindow:f,_featureLayerId:a.layerId};g._featureLayerId&&(c=this.layerInfosObj.getLayerInfoById(g._featureLayerId))&&d.setDefinitionExpression(c.getFilter());q.config.getInfoTemplate(d,a,this.layerInfosObj).then(e.hitch(this,function(a){g.infoTemplate=
e.clone(a);b.resolve(g)}),e.hitch(this,function(){b.resolve(g)}))}))),this.own(g(d,"error",function(){b.resolve(null)}))):b.resolve(null);return b}))}})});