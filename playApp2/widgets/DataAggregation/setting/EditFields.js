// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/Evented dojo/dom-construct dojo/query dijit/form/TextBox dijit/_TemplatedMixin dijit/registry jimu/BaseWidgetSetting jimu/dijit/SimpleTable jimu/dijit/Popup ./LookupList".split(" "),function(h,c,e,k,l,m,f,n,p,q,r,t,g,u){return h([r,p,l],{baseClass:"jimu-widget-setting-fields-critical-facilities",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"fieldsTable"\x3e\x3c/div\x3e\x3c/div\x3e',_layerInfo:null,isRecognizedValues:null,
type:"",addressFields:null,postCreate:function(){this.inherited(arguments);this.nls=c.mixin(this.nls,window.jimuNls.common);this._initFieldsTable();"fieldInfos"===this.type?(this.popupTitle=this.nls.configureFields,this._setFieldsTable(this._layerInfo.fieldInfos)):this._setAddressFieldsTable(this.addressFields)},popupEditPage:function(){var a=new g({titleLabel:this.popupTitle,width:this.disableDuplicateOption?640:800,maxHeight:600,autoHeight:!0,content:this,buttons:[{label:this.nls.ok,onClick:c.hitch(this,
function(){this._resetFieldInfos();a.close();this.emit("edit-fields-popup-ok")})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:c.hitch(this,function(){a.close();this.emit("edit-fields-popup-cancel")})}],onClose:c.hitch(this,function(){this.emit("edit-fields-popup-close")})})},_initFieldsTable:function(){var a=[{name:"visible",title:this.nls.display,type:"checkbox","class":"display",width:"100px",hidden:"undefined"===typeof this.disableDisplayOption?!1:this.disableDisplayOption,
onChange:c.hitch(this,this._visibleChange)},{name:"fieldName",title:this.nls.name,type:"text",width:"190px"},{name:"label",title:this.nls.editpageAlias,type:"extension",hidden:!1,width:"190px",create:c.hitch(this,this._createTextBox),setValue:c.hitch(this,this._setTextValue),getValue:c.hitch(this,this._getTextValue)},{name:"actions",title:this.nls.actions,type:"actions",actions:["up","down","edit"],"class":"actions",width:"90px"},{name:"duplicate",title:this.nls.duplicate,type:"checkbox","class":"display",
width:"170px",hidden:"undefined"===typeof this.disableDuplicateOption?!1:this.disableDuplicateOption},{name:"type",title:"",type:"text",editable:!0,hidden:!0},{name:"isRecognizedValues",title:"",type:"extension",hidden:!0,create:c.hitch(this,this._create),setValue:c.hitch(this,this._setValue),getValue:c.hitch(this,this._getValue)}];this._fieldsTable=new t({fields:a,selectable:!1,autoHeight:!0,style:{height:"300px",maxHeight:"300px"}});this._fieldsTable.placeAt(this.fieldsTable);this._fieldsTable.startup();
this.own(k(this._fieldsTable,"actions-edit",c.hitch(this,this._onEditFieldsClick)))},_visibleChange:function(a,b){(a=this._getCheckboxByClassName(".duplicate",a))&&a.setStatus(b.getValue())},_createTextBox:function(a){var b=new n({style:{height:"85%",width:"100%"}});a.labelBox=b;m.place(b.domNode,a)},_setTextValue:function(a,b){a.labelBox.set("value",b)},_getTextValue:function(a){return a.labelBox.get("value")},_setValue:function(a,b){a._isRecognizedValues=b},_getValue:function(a){return a._isRecognizedValues},
_setFieldsTable:function(a){var b=["esriFieldTypeOID","esriFieldTypeGlobalID"];e.forEach(a,function(a){if(a.type&&-1===b.indexOf(a.type)){var d=[a.fieldName];a.fieldName!==a.label&&d.push(a.label);(a=this._fieldsTable.addRow({fieldName:a.fieldName,label:a.label,visible:a.visible,type:a.type,duplicate:a.duplicate,isRecognizedValues:a.isRecognizedValues||d}))&&a.tr&&(d=this._getCheckboxByClassName(".visible",a.tr))&&this._visibleChange(a.tr,d)}},this)},_getCheckboxByClassName:function(a,b){if((a=f(a,
b))&&a.hasOwnProperty("length")&&0<a.length)return q.byNode(f(".jimu-checkbox",a[0])[0])},_setAddressFieldsTable:function(a){e.forEach(a,function(a){var d=navigator.language.toLowerCase();if(a.hasOwnProperty("fieldName")&&a.hasOwnProperty("isRecognizedValues"))a=this._fieldsTable.addRow(a);else{var b=a.localizedNames&&a.hasOwnProperty(d);a=this._fieldsTable.addRow({fieldName:b?a.localizedNames[d]:a.name,label:b?a.localizedNames[d]:a.alias,visible:a.hasOwnProperty("visible")?a.visible:!1,type:"STRING",
duplicate:a.hasOwnProperty("duplicate")?a.duplicate:!0,isRecognizedValues:this._getIsRecognizedValues(a)})}a&&a.tr&&(d=this._getCheckboxByClassName(".visible",a.tr))&&this._visibleChange(a.tr,d)},this)},_getIsRecognizedValues:function(a){var b=navigator.language.toLowerCase(),d=a.recognizedNames&&a.recognizedNames.hasOwnProperty(b),c=a.isRecognizedValues;return c?c:d?a.recognizedNames[b]:[a.name]},_onIsRecognizedListChanged:function(a){var b=this._fieldsTable.getRowData(a);b.isRecognizedValues=this.isRecognizedValues;
this._fieldsTable.editRow(a,b)},_resetFieldInfos:function(){var a=[],b=this._fieldsTable.getData();e.forEach(b,function(b){a.push({fieldName:b.fieldName,label:""!==b.label?b.label:b.fieldName,visible:b.visible,type:b.type,duplicate:b.duplicate,isRecognizedValues:b.isRecognizedValues})});"fieldInfos"===this.type?this._layerInfo.fieldInfos=a:this.fieldInfos=a},_onEditFieldsClick:function(a){var b=this._fieldsTable.getRowData(a);a=new u({nls:this.nls,row:a,rowData:b});var d=new g({width:400,autoHeight:!0,
content:a,titleLabel:this.nls.lookupList+": "+b.fieldName,buttons:[{label:this.nls.ok,onClick:c.hitch(this,function(){var a=d.content.sourceList.getData();this.isRecognizedValues=[];e.forEach(a,c.hitch(this,function(a){-1===this.isRecognizedValues.indexOf(a.name)&&a.name!==this.nls.newNamePlaceholder&&this.isRecognizedValues.push(a.name)}));this._onIsRecognizedListChanged(d.content.row);d.close()})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:c.hitch(this,function(){d.close()})}],
onClose:c.hitch(this,function(){})})}})});