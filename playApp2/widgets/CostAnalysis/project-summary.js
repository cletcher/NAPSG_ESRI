// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/CostAnalysis/project-summary.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n    \x3cdiv class\x3d"esriCTCostEscalationTitle"\x3e\r\n      ${nls.costEscalation.costEscalationLabel}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCostEscalatioParent" data-dojo-attach-point\x3d"costEscalationTableNode"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3c!--Add/delete/reorder buttons--\x3e\r\n      \x3cdiv style\x3d"height: 30px;" class\x3d"esriCTStatisticsButtonParentDiv"\x3e\r\n        \x3cdiv class\x3d"esriCTAddStatisticsIcon esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnAddNode" title\x3d"${nls.costEscalation.addCostEscalationText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTDeleteStatisticsIconDisable esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnCrossNode" title\x3d"${nls.costEscalation.deleteCostEscalationText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsUpIconDisable esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnUpNode" title\x3d"${nls.costEscalation.moveCostEscalationUpText}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTStatisticsDownIconDisable esriCTStatisticsButtons" data-dojo-attach-point\x3d"btnDownNode" title\x3d"${nls.costEscalation.moveCostEscalationDownText}"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--Project Total and Gross Cost table--\x3e\r\n      \x3cdiv class\x3d"esriCTBoldFont" data-dojo-attach-point\x3d"totalProjectCost"\x3e\r\n        \x3ctable class\x3d"esriCTProjectCostTable" style\x3d"width: 100%;"\x3e\r\n          \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalCostLabel" data-dojo-attach-point\x3d"totalCostLabel"\x3e${nls.projectOverview.totalCostLabel}\x3c/td\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalCost" data-dojo-attach-point\x3d"totalCostDiv"\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalGrossLabel" data-dojo-attach-point\x3d"grossCostLabel"\x3e${nls.projectOverview.grossCostLabel}\x3c/td\x3e\r\n              \x3ctd class\x3d"esriCTProjectSummaryTotalGross" data-dojo-attach-point\x3d"grossCostDiv"\x3e\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd style\x3d"font-weight: normal; font-style: italic;" colspan\x3d"2" data-dojo-attach-point\x3d"roundingLabel"\x3e${nls.projectOverview.roundingLabel}\x3c/td\x3e\r\n            \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"okButton"\x3e${nls.common.ok}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"cancelButton"\x3e${nls.common.cancel}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare jimu/BaseWidget dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./project-summary.html dojo/_base/lang dojo/dom-attr dojo/on jimu/dijit/SimpleTable jimu/dijit/LoadingIndicator dojo/query dojo/dom-class dijit/form/ValidationTextBox dojo/dom-construct dijit/form/Select dijit/registry dojo/_base/array dojo/store/Memory dojo/_base/html dijit/focus esri/graphic".split(" "),function(u,v,w,x,y,d,p,h,z,A,k,e,q,m,B,l,f,C,r,t,n){return u([v,w,x],{templateString:y,baseClass:"jimu-widget-cost-analysis-project-summary",
_costFieldStore:null,totalCost:0,projectInfo:null,previouslyAddedEscalations:[],loadingProject:!1,postCreate:function(){this.inherited(arguments);this.totalCost=0;this.previouslyAddedEscalations=[];this._handleClickEvents();this._initLoadingIndicator()},_initLoadingIndicator:function(){this._loadingIndicator=new A({hidden:!0});this._loadingIndicator.placeAt(this.domNode.parentNode.parentNode.parentNode);this._loadingIndicator.startup()},_handleClickEvents:function(){this.own(h(this.btnAddNode,"click",
d.hitch(this,function(){e.contains(this.btnAddNode,"esriCTAddStatisticsIconDisable")||(this._addCostEscalationBtnClicked(),this._handleActionButtonVisibility())})));this.own(h(this.btnCrossNode,"click",d.hitch(this,function(){e.contains(this.btnCrossNode,"esriCTDeleteStatisticsIconDisable")||this._deleteLayerRow()})));this.own(h(this.btnUpNode,"click",d.hitch(this,this._upArrowClicked)));this.own(h(this.btnDownNode,"click",d.hitch(this,this._downArrowClicked)));this.own(h(this.okButton,"click",d.hitch(this,
function(){var a,b;a=!0;b=this._costEscalationTable.getRows();f.forEach(b,d.hitch(this,function(b){b.costLabelTextBox.isValid()||(a=!1,t.focus(b.costLabelTextBox));b.costValueLabelTextBox.isValid()||(a=!1,t.focus(b.costValueLabelTextBox))}));a?(this.calculateGrossCost(this.totalCost,!0),this.emit("onOkButtonClicked")):this.appUtils.showMessage(this.nls.costEscalation.invalidEntry)})));this.own(h(this.cancelButton,"click",d.hitch(this,function(){this.emit("onCancelButtonClicked");this._loadingIndicator.show();
this._costEscalationTable.clear();f.forEach(this.tableData,d.hitch(this,function(a){this._addCostEscalationLayerRow(a)}));this._updateGrossCost();this._loadingIndicator.hide()})))},_upArrowClicked:function(){if(!e.contains(this.btnUpNode,"esriCTStatisticsUpIconDisable")){var a,b;b=this._costEscalationTable.getRows();var c=this._costEscalationTable.getData();f.forEach(c,d.hitch(this,function(c,d){c.editable&&(a=b[d])}));this._costEscalationTable.onBeforeRowUp(a)&&(c=f.indexOf(b,a),0<c&&(c=b[c-1]))&&
(r.place(a,c,"before"),this._costEscalationTable.updateUI(),this._costEscalationTable.emit("row-up",a),this._updateGrossCost())}},_downArrowClicked:function(){if(!e.contains(this.btnDownNode,"esriCTStatisticsDownIconDisable")){var a,b;b=this._costEscalationTable.getRows();var c=this._costEscalationTable.getData();f.forEach(c,d.hitch(this,function(c,d){c.editable&&(a=b[d])}));this._costEscalationTable.onBeforeRowDown(a)&&(c=f.indexOf(b,a),c<b.length-1&&(c=b[c+1]))&&(r.place(a,c,"after"),this._costEscalationTable.updateUI(),
this._costEscalationTable.emit("row-down",a),this._updateGrossCost())}},startup:function(){this.inherited(arguments);this._init()},reset:function(a){this.projectInfo=a;this._costEscalationTable.clear();this.totalCost=0;this.previouslyAddedEscalations=[];this.tableData=[]},_init:function(){this._createCostEscalationFieldTable();this._createCostTypeFieldStore()},cloneTableData:function(){this.tableData=[];var a=[],b={};this._costEscalationTable&&this._costEscalationTable.getRows().length&&(f.forEach(this._costEscalationTable.getRows(),
d.hitch(this,function(c){b={};c.costLabelTextBox&&(b.label=c.costLabelTextBox.getValue());c.costTypeLabelDropdown&&(b.type=c.costTypeLabelDropdown.getValue());c.costValueLabelTextBox&&(b.costValue=c.costValueLabelTextBox.getValue());a.push(b)})),this.tableData=d.clone(a));this._handleActionButtonVisibility()},loadAdditionalCost:function(a){var b={};0<a.length?(a.sort(d.hitch(this,this._sortFeatureArray)),f.forEach(a,d.hitch(this,function(a){b={};b.label=a.attributes[this.config.projectMultiplierFields.DESCRIPTION];
b.type=a.attributes[this.config.projectMultiplierFields.TYPE];b.costValue=a.attributes[this.config.projectMultiplierFields.VALUE];if("+"===b.type||"*"===b.type||"_"===b.type||"%"===b.type)this.additionalCostTable&&this.loadingProject&&this._storeAsPreviouslyAdded(a.attributes[this.additionalCostTable.objectIdField]),this._addCostEscalationLayerRow(b)}))):f.forEach(this.config.projectCostSettings,d.hitch(this,function(a){b={};b.label=a.label;b.type=a.type;b.costValue=a.value;"+"!==b.type&&"*"!==b.type&&
"_"!==b.type&&"%"!==b.type||this._addCostEscalationLayerRow(b)}))},_sortFeatureArray:function(a,b){var c=this.config.projectMultiplierFields.COSTINDEX;return a.attributes[c]-b.attributes[c]},_createCostEscalationFieldTable:function(){this._costEscalationTable=new z({fields:[{name:"editable",title:this.nls.common.label,type:"checkbox",editable:!1,width:"40%"},{name:"field",title:this.nls.common.type,type:"empty",editable:!1,width:"30%"},{name:"field",title:this.nls.costEscalation.valueHeader,type:"empty",
editable:!0,width:"40%"}],selectable:!1,autoHeight:!0});this._costEscalationTable.placeAt(this.costEscalationTableNode);this._costEscalationTable.startup()},_handleCheckBoxClick:function(a){var b;b=k(".simple-table-title .jimu-checkbox",this.domNode)[0];a=k(".jimu-checkbox",a)[0];h(l.byNode(b),"change",d.hitch(this,function(){this._handleActionButtonVisibility()}));h(l.byNode(a),"change",d.hitch(this,function(){this._handleActionButtonVisibility()}))},_handleActionButtonVisibility:function(){var a,
b=!0,c=0,g;a=this._costEscalationTable.getRows();g=k(".simple-table-title .jimu-checkbox",this.domNode)[0];g=l.byNode(g);f.forEach(a,d.hitch(this,function(a){""===d.trim(a.costLabelTextBox.value)&&(b=!1);if(isNaN(a.costValueLabelTextBox.value)||""===d.trim(a.costValueLabelTextBox.value+"")||"0"===a.costValueLabelTextBox.value||0===a.costValueLabelTextBox.value)b=!1;a=k(".jimu-checkbox",a)[0];l.byNode(a).checked&&c++}));0===c?e.replace(this.btnCrossNode,"esriCTDeleteStatisticsIconDisable","esriCTDeleteStatisticsIcon"):
e.replace(this.btnCrossNode,"esriCTDeleteStatisticsIcon","esriCTDeleteStatisticsIconDisable");b||0===a.length?e.replace(this.btnAddNode,"esriCTAddStatisticsIcon","esriCTAddStatisticsIconDisable"):e.replace(this.btnAddNode,"esriCTAddStatisticsIconDisable","esriCTAddStatisticsIcon");b&&1===c&&1<a.length?(e.replace(this.btnUpNode,"esriCTStatisticsUpIcon","esriCTStatisticsUpIconDisable"),e.replace(this.btnDownNode,"esriCTStatisticsDownIcon","esriCTStatisticsDownIconDisable")):(e.replace(this.btnUpNode,
"esriCTStatisticsUpIconDisable","esriCTStatisticsUpIcon"),e.replace(this.btnDownNode,"esriCTStatisticsDownIconDisable","esriCTStatisticsDownIcon"));0===a.length?(g.set("status",!1),e.add(g.domNode,"jimu-state-disabled")):(g.set("status",!0),e.remove(g.domNode,"jimu-state-disabled"))},_addCostEscalationBtnClicked:function(){this._addCostEscalationLayerRow()},_addCostEscalationLayerRow:function(a){var b,c;b=this._costEscalationTable.addRow({});c=k(".simple-table-cell",b.tr);this._handleCheckBoxClick(b.tr);
c&&(b=b.tr,this._addCostLabelTextBox(c[0],b,a),this._addCostTypeLabelDropdown(c[1],b,a),this._addCostValueLabelTextBox(c[2],b,a))},_addCostLabelTextBox:function(a,b,c){a=m.create("div",{"class":"esriCTTextBoxContainer"},a);b.costLabelTextBox=new q({"class":"esriCTCostLabelTextbox esriCTAddLayerTableNode"},a);b.costLabelTextBox.startup();c&&c.label&&b.costLabelTextBox.set("value",c.label);b.costLabelTextBox.validator=d.hitch(this,this._validateCostEscalationLabelFields);this.own(h(b.costLabelTextBox,
"change",d.hitch(this,function(){this._handleActionButtonVisibility()})))},_validateCostEscalationLabelFields:function(a){return""===d.trim(a)?!1:!0},_addCostTypeLabelDropdown:function(a,b,c){a=m.create("div",{"class":"esriCTCostTypeDropDownContainer esriCTAddLayerTableNode"},a);b.costTypeLabelDropdown=new B({name:"layerSelect",store:this._costFieldStore,labelAttr:"name","class":"esriCTCostTypeDropdown"},a);c&&c.type&&(c=b.costTypeLabelDropdown.store.get(c.type),b.costTypeLabelDropdown.setValue(c.value));
this.own(h(b.costTypeLabelDropdown,"change",d.hitch(this,this._updateGrossCost)));b.costTypeLabelDropdown.startup()},_addCostValueLabelTextBox:function(a,b,c){a=m.create("div",{"class":"esriCTTextBoxContainer esriCTAddLayerTableNode"},a);b.costValueLabelTextBox=new q({"class":"esriCTCostLabelTextbox",trim:!0},a);b.costValueLabelTextBox.startup();c&&c.costValue&&b.costValueLabelTextBox.set("value",c.costValue);b.costValueLabelTextBox.validator=d.hitch(this,this._validateCostEscalationValueFields);
this.own(h(b.costValueLabelTextBox,"change",d.hitch(this,function(){this._updateGrossCost();this._handleActionButtonVisibility()})))},_validateCostEscalationValueFields:function(a){a=Number(a);return""===a||isNaN(a)||"0"===a||0===a?!1:!0},_getCostEscalationArray:function(){var a,b;a=this._costEscalationTable.getRows();b=[];f.forEach(a,d.hitch(this,function(a){b.push({label:a.costLabelTextBox.getValue(),type:a.costTypeLabelDropdown.getValue(),value:a.costValueLabelTextBox.getValue()})}));return b},
addConfiguredAdditionalCostArray:function(){var a,b,c;a=[];b=[];c=[];var g=this.totalCost;f.forEach(this.config.projectCostSettings,d.hitch(this,function(b){a.push({label:b.label,type:b.type,value:b.value})}));f.forEach(a,d.hitch(this,function(a,d){var e={},f;f=parseFloat(a.value);this.projectInfo&&this.projectInfo.projectId&&this.config.projectMultiplierFields&&(e[this.config.projectMultiplierFields.DESCRIPTION]=a.label,e[this.config.projectMultiplierFields.TYPE]=a.type,e[this.config.projectMultiplierFields.VALUE]=
f,e[this.config.projectMultiplierFields.COSTINDEX]=d+1,e[this.config.projectMultiplierFields.PROJECTGUID]=this.projectInfo.projectId,b.push(new n(null,null,e)));g=this._calculateGrossAdditionalCost(a.type,f,g);c.push({label:a.label,type:a.type,value:f})}));this.loadAdditionalCost(b);setTimeout(d.hitch(this,function(){this.calculateGrossCost(this.totalCost,!0)}),500)},_deleteLayerRow:function(){var a=this._costEscalationTable.getRows(),b=this._costEscalationTable.getData();f.forEach(b,d.hitch(this,
function(b,d){b.editable&&(this._costEscalationTable.deleteRow(a[d]),this._updateGrossCost())}));0===this._costEscalationTable.getRows().length&&(b=k("th .checkbox",this.costEscalationTableNode)[0],e.contains(b,"checked")&&e.remove(b,"checked"));this._handleActionButtonVisibility()},_createCostTypeFieldStore:function(){var a;a=[];a.push({name:"+",value:"+"});a.push({name:"*",value:"*"});a.push({name:"-",value:"_"});a.push({name:"%",value:"%"});this._costFieldStore=new C({idProperty:"value",data:a})},
_calculateGrossAdditionalCost:function(a,b,c){switch(a){case "+":c+=b;break;case "_":c-=b;break;case "*":c*=b;break;case "%":c+=c*b/100}return c},_updateGrossCost:function(){var a;if(!this.loadingProject){a=this._getCostEscalationArray();var b=this.totalCost,c=[],e=[];f.forEach(a,d.hitch(this,function(a,d){var f=parseFloat(a.value),g={};f&&(this.projectInfo&&this.projectInfo.projectId&&this.config.projectMultiplierFields&&(g[this.config.projectMultiplierFields.DESCRIPTION]=a.label,g[this.config.projectMultiplierFields.TYPE]=
a.type,g[this.config.projectMultiplierFields.VALUE]=f,g[this.config.projectMultiplierFields.COSTINDEX]=d+1,g[this.config.projectMultiplierFields.PROJECTGUID]=this.projectInfo.projectId,c.push(new n(null,null,g))),b=this._calculateGrossAdditionalCost(a.type,f,b),e.push({label:a.label,type:a.type,value:f}))}));a=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,this.totalCost);a=this.config.generalSettings.currency+" "+a;p.set(this.totalCostDiv,"innerHTML",a);a=this.appUtils.roundProjectCostValue(this.config.generalSettings.roundCostType,
b);a=this.config.generalSettings.currency+" "+a;p.set(this.grossCostDiv,"innerHTML",a);return{grossCost:b,features:c,additionalCostInfo:e}}},calculateGrossCost:function(a,b){this.totalCost=a;this.loadingProject||(a=this._updateGrossCost(),this.emit("grossCostUpdated",this.totalCost,a.grossCost,a.additionalCostInfo),b&&this._updateCostEscalationTable(a.features))},_updateCostEscalationTable:function(a){this.additionalCostTable&&(0<a.length||0<this.previouslyAddedEscalations.length)&&(this._loadingIndicator.show(),
this.additionalCostTable.applyEdits(a,null,this.previouslyAddedEscalations,d.hitch(this,function(a){var b=!1;this.previouslyAddedEscalations=[];a&&0<a.length&&(f.forEach(a,d.hitch(this,function(a){a.success?this._storeAsPreviouslyAdded(a.objectId):b=!0})),b&&this.appUtils.showMessage(this.nls.costEscalation.errorInSavingCostEscalation));this._loadingIndicator.hide()}),d.hitch(this,function(){this._loadingIndicator.hide();this.appUtils.showMessage(this.nls.costEscalation.errorInSavingCostEscalation)})))},
_storeAsPreviouslyAdded:function(a){var b={};b[this.additionalCostTable.objectIdField]=a;a=new n(null,null,b);this.previouslyAddedEscalations.push(a)}})});