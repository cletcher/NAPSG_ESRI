// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(g,e,u,t,n){return e("dijit.layout.TabContainer",u,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(e){var p=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?g.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":p,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},e)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?t:n)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(g,e,u,t,n,m,p,w){return g("dijit.layout._TabContainerBase",[n,p],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:w,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&t.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
e.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(e.add(this.domNode,"dijitTabContainerNested"),e.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),e.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),e.add(this.containerNode,"dijitTabPaneWrapperNested")):e.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(g){e.add(g.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(g){e.remove(g.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var e=this.selectedChildWidget;if(this.doLayout){var g=this.tabPosition.replace(/-h/,"");this.tablist.region=g;g=[this.tablist,{domNode:this.tablistSpacer,region:g},{domNode:this.containerNode,region:"center"}];m.layoutChildren(this.domNode,this._contentBox,g);this._containerContentBox=m.marginBox2contentBox(this.containerNode,g[2]);e&&
e.resize&&e.resize(this._containerContentBox)}else{if(this.tablist.resize){g=this.tablist.domNode.style;g.width="0";var h=u.getContentBox(this.domNode).w;g.width="";this.tablist.resize({w:h})}e&&e.resize&&e.resize()}}},destroy:function(e){this.tablist&&this.tablist.destroy(e);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(g,e,u,t,n,m,p,w,x,v,h,c,d,f){m("dijit-legacy-requires")&&x(0,function(){require(["dijit/layout/StackController"])});u=u("dijit.layout.StackContainer",f,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);t.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(w(this.domNode,"keydown",p.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var b=this.getChildren();g.forEach(b,this._setupChild,
this);this.persist?this.selectedChildWidget=c.byId(e(this.id+"_selectedChild")):g.some(b,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var d=this.selectedChildWidget;!d&&b[0]&&(d=this.selectedChildWidget=b[0],d.selected=!0);v.publish(this.id+"-startup",{children:b,selected:d,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var b=this.selectedChildWidget;b&&this._showChild(b)}this.inherited(arguments)},
_setupChild:function(b){var c=b.domNode,a=n.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",b.domNode,"replace"),d=b["aria-label"]||b.title||b.label;d&&a.setAttribute("aria-label",d);n.place(c,a);b._wrapper=a;this.inherited(arguments);"none"==c.style.display&&(c.style.display="block");b.domNode.removeAttribute("title")},addChild:function(b,c){this.inherited(arguments);this._started&&(v.publish(this.id+"-addChild",b,c),this.layout(),this.selectedChildWidget||
this.selectChild(b))},removeChild:function(b){var c=g.indexOf(this.getChildren(),b);this.inherited(arguments);n.destroy(b._wrapper);delete b._wrapper;this._started&&v.publish(this.id+"-removeChild",b);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===b&&(this.selectedChildWidget=void 0,this._started)){var a=this.getChildren();a.length&&this.selectChild(a[Math.max(c-1,0)])}this._started&&this.layout()}},selectChild:function(b,d){var a;b=c.byId(b);this.selectedChildWidget!=b&&(a=this._transition(b,
this.selectedChildWidget,d),this._set("selectedChildWidget",b),v.publish(this.id+"-selectChild",b,this._focused),this.persist&&e(this.id+"_selectedChild",this.selectedChildWidget.id));return h(a||!0)},_transition:function(b,c){c&&this._hideChild(c);c=this._showChild(b);b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize());return c},_adjacent:function(b){var c=this.getChildren(),a=g.indexOf(c,this.selectedChildWidget),a=a+(b?1:c.length-1);return c[a%c.length]},
forward:function(){return this.selectChild(this._adjacent(!0),!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(b){v.publish(this.id+"-containerKeyDown",{e:b,page:this})},layout:function(){var b=this.selectedChildWidget;b&&b.resize&&(this.doLayout?b.resize(this._containerContentBox||this._contentBox):b.resize())},_showChild:function(b){var c=this.getChildren();b.isFirstChild=b==c[0];b.isLastChild=b==c[c.length-1];b._set("selected",!0);b._wrapper&&t.replace(b._wrapper,
"dijitVisible","dijitHidden");return b._onShow&&b._onShow()||!0},_hideChild:function(b){b._set("selected",!1);b._wrapper&&t.replace(b._wrapper,"dijitHidden","dijitVisible");b.onHide&&b.onHide()},closeChild:function(b){if(!b.onClose||b.onClose(this,b))this.removeChild(b),b.destroyRecursive()},destroyDescendants:function(b){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;g.forEach(this.getChildren(),function(c){b||this.removeChild(c);c.destroyRecursive(b)},this);this._descendantsBeingDestroyed=
!1}});u.ChildWidgetProperties={selected:!1,disabled:!1,closable:!1,iconClass:"dijitNoIcon",showTitle:!0};p.extend(d,u.ChildWidgetProperties);return u})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(g,e,u,t,n,m,p,w,x,v,h,c){c=g("dijit.layout._TabButton"+(n("dojo-bidi")?"_NoBidi":
""),w.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},templateString:c,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);e.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var c=this.domNode;this.defer(function(){c.className=c.className},1)},_setCloseButtonAttr:function(c){this._set("closeButton",c);t.toggle(this.domNode,"dijitClosable",c);this.closeNode.style.display=c?"":"none";c&&(c=
m.getLocalization("dijit","common"),this.closeNode&&u.set(this.closeNode,"title",c.itemClose))},_setDisabledAttr:function(c){this.inherited(arguments);if(this.closeNode)if(c)u.remove(this.closeNode,"title");else{var d=m.getLocalization("dijit","common");u.set(this.closeNode,"title",d.itemClose)}},_setLabelAttr:function(c){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=p.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});n("dojo-bidi")&&(c=g("dijit.layout._TabButton",
c,{_setLabelAttr:function(c){this.inherited(arguments);this.applyTextDir(this.iconNode,this.iconNode.alt)}}));g=g("dijit.layout.TabController",w,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:c,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var c=new v({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,
textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(b){return t.contains(b,"dijitClosable")&&!t.contains(b,"dijitTabDisabled")}});this.own(c);var f=m.getLocalization("dijit","common"),b=this;c.addChild(new h({label:f.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(c){c=x.byNode(this.getParent().currentTarget);b.onCloseButtonClick(c.page)}}))}});g.TabButton=c;return g})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(g,e,u,t,n,m,p,w,x,v,h,c,d,f){t=e("dijit.layout._StackButton",f,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(b){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});e=e("dijit.layout.StackController",[h,c,d],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:t,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(b){return v.byId(this.id+
"_"+b)},postCreate:function(){this.inherited(arguments);this.own(w.subscribe(this.containerId+"-startup",m.hitch(this,"onStartup")),w.subscribe(this.containerId+"-addChild",m.hitch(this,"onAddChild")),w.subscribe(this.containerId+"-removeChild",m.hitch(this,"onRemoveChild")),w.subscribe(this.containerId+"-selectChild",m.hitch(this,"onSelectChild")),w.subscribe(this.containerId+"-containerKeyDown",m.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(p(this.containerNode,"click",
m.hitch(this,function(b){var c=v.getEnclosingWidget(b.target);if(c!=this.containerNode&&!c.disabled&&c.page)for(b=b.target;b!==this.containerNode;b=b.parentNode)if(u.contains(b,this.buttonWidgetCloseClass)){this.onCloseButtonClick(c.page);break}else if(b==c.domNode){this.onButtonClick(c.page);break}})))},onStartup:function(b){this.textDir=b.textDir;g.forEach(b.children,this.onAddChild,this);if(b.selected)this.onSelectChild(b.selected);var c=v.byId(this.containerId).containerNode,a=m.hitch(this,"pane2button");
b={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var d=function(b,d){return p(c,"attrmodified-"+b,function(b){var c=a(b.detail&&b.detail.widget&&b.detail.widget.id);c&&c.set(d,b.detail.newValue)})},f;for(f in b)this.own(d(f,b[f]))},destroy:function(b){this.destroyDescendants(b);this.inherited(arguments)},onAddChild:function(b,c){var a=new (m.isString(this.buttonWidget)?m.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+b.id,name:this.id+"_"+b.id,label:b.title,disabled:b.disabled,ownerDocument:this.ownerDocument,dir:b.dir,lang:b.lang,textDir:b.textDir||this.textDir,showLabel:b.showTitle,iconClass:b.iconClass,closeButton:b.closable,title:b.tooltip,page:b});this.addChild(a,c);b.controlButton=a;if(!this._currentChild)this.onSelectChild(b);c=b._wrapper.getAttribute("aria-labelledby")?b._wrapper.getAttribute("aria-labelledby")+" "+a.id:a.id;b._wrapper.removeAttribute("aria-label");b._wrapper.setAttribute("aria-labelledby",
c)},onRemoveChild:function(b){this._currentChild===b&&(this._currentChild=null);var c=this.pane2button(b.id);c&&(this.removeChild(c),c.destroy());delete b.controlButton},onSelectChild:function(b){if(b){if(this._currentChild){var c=this.pane2button(this._currentChild.id);c.set("checked",!1);c.focusNode.setAttribute("tabIndex","-1")}c=this.pane2button(b.id);c.set("checked",!0);this._currentChild=b;c.focusNode.setAttribute("tabIndex","0");v.byId(this.containerId)}},onButtonClick:function(b){var c=this.pane2button(b.id);
x.focus(c.focusNode);this._currentChild&&this._currentChild.id===b.id&&c.set("checked",!0);v.byId(this.containerId).selectChild(b)},onCloseButtonClick:function(b){v.byId(this.containerId).closeChild(b);this._currentChild&&(b=this.pane2button(this._currentChild.id))&&x.focus(b.focusNode||b.domNode)},adjacent:function(b){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(b=!b);var c=this.getChildren(),a=g.indexOf(c,this.pane2button(this._currentChild.id)),d=c[a],f;do a=(a+
(b?1:c.length-1))%c.length,f=c[a];while(f.disabled&&f!=d);return f},onkeydown:function(b,c){if(!this.disabled&&!b.altKey&&(c=null,b.ctrlKey||!b._djpage)){switch(b.keyCode){case n.LEFT_ARROW:case n.UP_ARROW:b._djpage||(c=!1);break;case n.PAGE_UP:b.ctrlKey&&(c=!1);break;case n.RIGHT_ARROW:case n.DOWN_ARROW:b._djpage||(c=!0);break;case n.PAGE_DOWN:b.ctrlKey&&(c=!0);break;case n.HOME:for(var a=this.getChildren(),d=0;d<a.length;d++){var f=a[d];if(!f.disabled){this.onButtonClick(f.page);break}}b.stopPropagation();
b.preventDefault();break;case n.END:a=this.getChildren();for(d=a.length-1;0<=d;d--)if(f=a[d],!f.disabled){this.onButtonClick(f.page);break}b.stopPropagation();b.preventDefault();break;case n.DELETE:case 87:this._currentChild.closable&&(b.keyCode==n.DELETE||b.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),b.stopPropagation(),b.preventDefault());break;case n.TAB:b.ctrlKey&&(this.onButtonClick(this.adjacent(!b.shiftKey).page),b.stopPropagation(),b.preventDefault())}null!==c&&(this.onButtonClick(this.adjacent(c).page),
b.stopPropagation(),b.preventDefault())}},onContainerKeyDown:function(b){b.e._djpage=b.page;this.onkeydown(b.e)}});e.StackButton=t;return e})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(g,e,u,t,n,m,p,w,x,v,h,c,d,f,b,l,a,r,y,B){c=e("dijit.layout.ScrollingTabController",[f,l],{baseClass:"dijitTabController dijitScrollingTabController",templateString:c,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",u.add(a,"tabStrip-disabled"));u.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);n.set(this.domNode,"visibility","");this._postStartup=!0;this.own(w(this.containerNode,"attrmodified-label, attrmodified-iconclass",p.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,b){this.inherited(arguments);n.set(this.containerNode,"width",n.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,b){var c=this.pane2button(a.id);this._selectedTab===c.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=x("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=t.getMarginSize(a).w,!0;n.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var b=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-b.offsetLeft}return 0},_enableBtn:function(a){var b=this._getTabsWidth();a=a||n.get(this.scrollNode,"width");return 0<b&&a<b},resize:function(a){this._dim=a;this.scrollNode.style.height="auto";var c=this._contentBox=b.marginBox2contentBox(this.domNode,{h:0,w:a.w});c.h=this.scrollNode.offsetHeight;t.setContentSize(this.domNode,c);c=this._enableBtn(this._contentBox.w);
this._buttons.style("display",c?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";b.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:a.w}},_getScroll:function(){return this.isLeftToRight()||8>v("ie")||v("trident")&&v("quirks")||v("webkit")?this.scrollNode.scrollLeft:n.get(this.containerNode,"width")-n.get(this.scrollNode,"width")+(v("trident")||v("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>v("ie")||v("trident")&&v("quirks")||v("webkit"))return a;var b=n.get(this.containerNode,"width")-n.get(this.scrollNode,"width");return(v("trident")||
v("edge")?-1:1)*(a-b)},onSelectChild:function(a,b){var c=this.pane2button(a.id);if(c){var d=c.domNode;if(d!=this._selectedTab&&(this._selectedTab=d,this._postResize)){var k=this._getScroll();k>d.offsetLeft||k+n.get(this.scrollNode,"width")<d.offsetLeft+n.get(d,"width")?(d=this.createSmoothScroll(),b&&(d.onEnd=function(){c.focus()}),d.play()):b&&c.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),b=n.get(this.scrollNode,"width"),c=n.get(this.containerNode,"width")-
b,d=this._getTabsWidth();if(a.length&&d>b)return{min:this.isLeftToRight()?0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-b:c};a=this.isLeftToRight()?0:c;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,b=n.get(this.scrollNode,"width"),c=this._getScrollBounds(),a=a.offsetLeft+n.get(a,"width")/2-b/2;return a=Math.min(Math.max(a,c.min),c.max)},createSmoothScroll:function(a){if(0<arguments.length){var b=
this._getScrollBounds();a=Math.min(Math.max(a,b.min),b.max)}else a=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var c=this,d=this.scrollNode,k=new m.Animation({beforeBegin:function(){this.curve&&delete this.curve;var b=d.scrollLeft,f=c._convertToScrollLeft(a);k.curve=new m._Line(b,f)},onAnimate:function(a){d.scrollLeft=a}});this._anim=k;this._setButtonClass(a);return k},_getBtnNode:function(a){for(a=a.target;a&&!u.contains(a,"tabStripButton");)a=a.parentNode;
return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,b){b&&u.contains(b,"dijitTabDisabled")||(a*=.75*n.get(this.scrollNode,"width"),a=this._getScroll()+a,this._setButtonClass(a),this.createSmoothScroll(a).play())},_setButtonClass:function(a){var b=this._getScrollBounds();this._leftBtn.set("disabled",a<=b.min);this._rightBtn.set("disabled",a>=b.max)}});d=e("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:d,tabIndex:"",isFocusable:function(){return!1}});e("dijit.layout._ScrollingTabControllerButton",[y,d]);e("dijit.layout._ScrollingTabControllerMenuButton",[y,B,d],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(b){this.dropDown=new a({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var c=h.byId(this.containerId);g.forEach(c.getChildren(),function(a){var b=
new r({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||c.textDir,onClick:function(){c.selectChild(a)}});this.dropDown.addChild(b)},this);b()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return c})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable ./utils jimu/LayerInfos/LayerInfos".split(" "),
function(g,e,u,t,n,m,p,w,x,v){return g(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,parent:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,relationshipInfoMapping:{},constructor:function(e){this.map=e&&e.map;this.nls=e&&e.nls;this.parent=e&&e.parent;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet={};this.relationshipTableSet=
{};this.currentRelationshipKey=null;this.relationshipInfoMapping={}},setConfig:function(h){this.config=e.clone(h||{})},setMap:function(e){this.map=e},updateLayerInfoResources:function(h){var c=new t;x.readConfigLayerInfosFromMap(this.map,!1,!0).then(e.hitch(this,function(d){this._layerInfosFromMap=d;this._processDelayedLayerInfos();h&&(0===this.config.layerInfos.length||this.config.syncWithLayers?(d=x.getConfigInfosFromLayerInfos(d),this.config.layerInfos=u.filter(d,function(c){return c.show})):this.config.layerInfos=
u.filter(e.delegate(this.config.layerInfos),e.hitch(this,function(c){var b=this._getLayerInfoById(c.id);return c.show&&b&&(c.name=b.name||b.title)})));c.resolve()}),function(d){c.reject(d)});return c},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return e.clone(this.config.layerInfos)},addLayerInfo:function(e){0===this._layerInfosFromMap.length?this._delayedLayerInfos.push(e):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(e.id)&&
this._layerInfosFromMap.push(e)},addConfigInfo:function(e){this._getConfigInfoById(e.id)||(e=x.getConfigInfoFromLayerInfo(e),this.config.layerInfos.push({id:e.id,name:e.name,layer:{url:e.layer.url,fields:e.layer.fields}}))},removeLayerInfo:function(e){e=this._getLayerInfoById(e);e=this._layerInfosFromMap.indexOf(e);this._layerInfosFromMap.splice(e,1)},removeConfigInfo:function(h){if(e.getObject("config.layerInfos",!1,this))for(var c=this.config.layerInfos.length,d=0;d<c;d++)if(this.config.layerInfos[d].id===
h){this.featureTableSet[h]&&(this.featureTableSet[h].destroy(),delete this.featureTableSet[h]);this.config.layerInfos.splice(d,1);break}},getQueryTable:function(h,c,d,f){var b=new t;this._activeLayerInfoId=h;this.featureTableSet[h]?b.resolve({isSupportQuery:!0,table:this.featureTableSet[h]}):this._getQueryTableInfo(h).then(e.hitch(this,function(l){if(l){var a=l.layerInfo,r=l.layerObject;l=l.tableInfo;if(this.featureTableSet[h])b.resolve({isSupportQuery:l.isSupportQuery,table:this.featureTableSet[h]});
else if(e.getObject("isSupportQuery",!1,l)){var y=this._getConfigInfoById(h);y||(this.addConfigInfo(a),y=this._getConfigInfoById(h));var B=e.getObject("layer.fields",!1,y),r=r&&r.fields,r=x.arcade.appendArcadeExpressionsToFields(r,a);y.layer.fields=this._clipValidFields(B,r);a=new w({map:this.map,matchingMap:c,hideExportButton:d,allowTextSelection:f,layerInfo:a,configedInfo:y,nls:this.nls,parent:this.parent});this.featureTableSet[h]=a;b.resolve({isSupportQuery:l.isSupportQuery,table:a})}else b.resolve({isSupportQuery:!1})}else b.resolve(null)}),
function(c){b.reject(c)});return b},getRelationTable:function(h,c,d,f,b){var l=new t,a=this.relationshipsSet[c];this._activeRelationshipKey=c;if(a){var r=this._getLayerInfoById(h);h=this.getRelationShipInfo(a);this.getQueryTable(h.id,d,f,b).then(e.hitch(this,function(b){if(b&&b.table){var c=b.table;c.set("relatedOriginalInfo",r);c.set("relationship",a)}l.resolve(b)}),e.hitch(function(){l.resolve(null)}))}else l.resolve(null);return l},removeRelationTable:function(e){this.relationshipTableSet[e]&&
(this.relationshipTableSet[e].destroy(),this.relationshipTableSet[e]=null)},getCurrentTable:function(e){return this.featureTableSet[e]||this.relationshipTableSet[e]},collectRelationShips:function(e,c){this._collectRelationShips(e,e.layerObject,c)},getConfigInfoById:function(e){return this._getConfigInfoById(e)},getLayerInfoById:function(e){return this._getLayerInfoById(e)},getVisivleLayerInfoIndexById:function(e){return this._getVisivleLayerInfoIndexById(e)},getRelationshipsByInfoId:function(e){var c=
[],d;for(d in this.relationshipsSet){var f=this.relationshipsSet[d];f._layerInfoId===e&&c.push(f)}return c},getRelationShipInfo:function(e){var c;if(e)for(relKey in this.relationshipInfoMapping)e._relKey===relKey&&(c=this.relationshipInfoMapping[relKey]);return c},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var e in this.relationshipsSet)this._removeRelationShipInfo(this.relationshipsSet[e]);this.relationshipsSet={};this.relationshipTableSet=
{};this.nls=this.map=this.config=this.currentRelationshipKey=null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(u.forEach(this._delayedLayerInfos,e.hitch(this,function(e){!this._getLayerInfoById(e&&e.id)&&this.map&&this.map.getLayer(e.id)&&this._layerInfosFromMap.push(e)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(e){for(var c=0,d=this._layerInfosFromMap.length;c<d;c++)if(this._layerInfosFromMap[c]&&this._layerInfosFromMap[c].id===e)return this._layerInfosFromMap[c]},
_getVisivleLayerInfoIndexById:function(e){for(var c=-1,d=0,f=this._layerInfosFromMap.length;d<f;d++)if(this._layerInfosFromMap[d]&&this._layerInfosFromMap[d].isShowInMap()&&(c++,this._layerInfosFromMap[d].id===e))return c},_getConfigInfoById:function(h){if(!e.getObject("layerInfos.length",!1,this.config))return null;for(var c=0,d=this.config.layerInfos.length;c<d;c++){var f=this.config.layerInfos[c];if(f&&f.id===h)return f}return null},_getQueryTableInfo:function(h){var c=new t,d=this._getLayerInfoById(h);
if(d){var f=[],b=d.getUrl();f.push(d.getLayerObject());f.push(d.getSupportTableInfo());b&&f.push(d.getRelatedTableInfoArray());n(f).then(e.hitch(this,function(f){if(this._activeLayerInfoId===h&&f){var a=f[0],e=f[1];f=b?f[2]:[];m.isDefined(f)&&m.isDefined(a)&&0<f.length&&this._collectRelationShips(d,a,f);c.resolve({layerInfo:d,layerObject:a,tableInfo:e})}else c.resolve(null)}),function(b){c.reject(b)})}else console.error("no activeLayerInfo!"),c.reject(Error());return c},_collectRelationShips:function(h,
c,d){var f=c.relationships;if(f&&0<f.length&&c&&c.url){var b=c.url.split("/");u.forEach(f,e.hitch(this,function(f){b[b.length-1]=f.relatedTableId;var a=b.join("/"),r=u.filter(d,e.hitch(this,function(b){b=b.getUrl();return m.isDefined(b)&&m.isDefined(a)&&p.removeProtocol(b.toString().toLowerCase())===p.removeProtocol(a.toString().toLowerCase())})),l=h.id+"_"+f.name+"_"+f.id;f._relKey=l;f._layerInfoId=h.id;r&&0<r.length&&this._setRelationShipInfo(f,r[0]);this.relationshipsSet[l]||(this.relationshipsSet[l]=
f,this.relationshipsSet[l].objectIdField=c.objectIdField)}))}},_setRelationShipInfo:function(e,c){e&&"_relKey"in e&&(this.relationshipInfoMapping[e._relKey]=c)},_removeRelationShipInfo:function(e){if(e&&"_relKey"in e)for(relKey in this.relationshipInfoMapping)e._relKey===relKey&&delete this.relationshipInfoMapping[relKey]},_getLayerInfoLabel:function(e){return e.name||e.title},_getLayerInfoId:function(e){return e&&e.id||""},_clipValidFields:function(h,c){if(!h||!h.length)return c||[];if(!c||!c.length)return h;
for(var d=[],f=[],b=0,l=c.length;b<l;b++){for(var a=c[b],r=0,y=h.length;r<y;r++){var B=h[r];if(B.name===a.name)break}r===y&&f.push(a)}b=0;for(l=h.length;b<l;b++)for(B=h[b],r=0,y=c.length;r<y;r++)if(a=c[r],a.name===B.name){d.push(B);break}d=d.concat(f);0===d.length&&0<h.length&&(h=e.clone(c),u.forEach(h,e.hitch(this,function(a){"esriFieldTypeGeometry"!==a.type&&(a.show=!0,d.push(a))})));return d}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dgrid/Keyboard dijit/Menu dijit/MenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/geometryEngine esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/dijit/Popup jimu/dijit/CheckBox jimu/SelectionManager jimu/CSVUtils jimu/utils ../utils dojo/query dojo/string dojo/topic dojo/keys".split(" "),
function(g,e,u,t,n,m,p,w,x,v,h,c,d,f,b,l,a,r,y,B,G,L,D,E,k,C,F,H,P,N,J,T,U,V,W,X,q,A,Y,z,Q,Z,aa,ba,ca,da,M,I,O,ea,R,S){return g([u,G],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",parent:null,map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,_dblClickResult:null,
actived:!1,showSelected:!1,tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,_normalizedExtent:null,constructor:function(a){a=a||{};this.set("parent",a.parent||null);this.set("map",a.map||null);this.set("matchingMap",!!a.matchingMap);this.set("layerInfo",a.layerInfo||null);this.set("layer",a.layer||null);this.set("configedInfo",a.configedInfo||null);this.set("relatedOriginalInfo",a.relatedOriginalInfo||null);this.set("relationship",a.relationship||
null);this.set("syncSelection",!!a.syncSelection||!0)},postCreate:function(){this.inherited(arguments);this._relatedQueryIds=[];this.createToolbar();this.loading=new Q;this.loading.placeAt(this.domNode);this.selectionManager=ca.getInstance();this._selectionResults=[];this.selectionRows=[];this._normalizedExtent=null;e.setAttr(this.domNode,"data-layerinfoid",q.getObject("layerInfo.id",!1,this));this.get("map")&&(this.own(A(this.map.root,L.release,q.hitch(this,function(){this._clickMap=!0}))),this.own(A(this.map,
"extent-change",q.hitch(this,"_onExtentChange"))));this.own(A(window,"resize",q.hitch(this,this._resize)))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(e.getStyle(this.toolbar.domNode,"height"),10)||0},setLayerDefinition:function(a){this._layerDefinition=a},getLayerDefinition:function(){return this._getLayerDifinition()},getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var a=q.clone(this._layerDefinition);return this._getFilterableFields(a.fields,
this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},setFilterObj:function(a){this._filterObj=a},showRefreshing:function(a){a?this._toggleLoading(!0):this._toggleLoading(!1)},active:function(){this.actived=!0},deactive:function(){this.actived=!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},
createToolbar:function(){var c=new f({},e.create("div")),k=new l;this.showSelectedRecordsMenuItem=new d({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:q.hitch(this,this.toggleSelectedRecords)});k.addChild(this.showSelectedRecordsMenuItem);this.showRelatedRecordsMenuItem=new d({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",onClick:q.hitch(this,this.onShowRelatedRecordsClick)});k.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=
new d({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:q.hitch(this,this.onFilterMenuItemClick)});k.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new d({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",onClick:q.hitch(this,this.onToggleColumnsClick)});k.addChild(this.toggleColumnsMenuItem);this.hideExportButton||(this.exportCSVMenuItem=new d({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:q.hitch(this,this.onExportCSVClick)}),
k.addChild(this.exportCSVMenuItem));this.selectionMenu=new r({label:this.nls.options,iconClass:"esriAttributeTableOptionsImage",dropDown:k});c.addChild(this.selectionMenu);this.matchingCheckBox=new a({checked:this.matchingMap?!0:!1,showLabel:!0,label:this.nls.filterByExtent,onChange:q.hitch(this,function(a){this.set("matchingMap",a);this._onMatchingCheckBoxChange(a)})});c.addChild(this.matchingCheckBox);this.zoomButton=new b({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:q.hitch(this,
this.zoomTo)});c.addChild(this.zoomButton);this.clearSelectionButton=new b({label:this.nls.clearSelection,iconClass:"esriAttributeTableClearImage",onClick:q.hitch(this,this.clearSelection,!0,!0)});c.addChild(this.clearSelectionButton);this.refreshButton=new b({label:this.nls.refresh,showLabel:!0,iconClass:"esriAttributeTableRefreshImage",onClick:q.hitch(this,this.refresh)});c.addChild(this.refreshButton);e.place(c.domNode,this.domNode);this.toolbar=c;this.own(A(this,"data-loaded,row-click,clear-selection",
q.hitch(this,"changeToolbarStatus")));this.parent&&R.publish(this.parent.id+"_toolbar_created",{toolbar:this.toolbar,context:this})},startQuery:function(a){this.cancelThread();this._requestStatus="processing";this._toggleLoading();a&&a.length?this.queryByStoreObjectIds=a:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=null);this._currentDef=this._getLayerObject();this._currentDef.then(q.hitch(this,function(b){this.domNode&&(this.layer=b,(b=!this.layerInfo.isTable&&this.matchingMap&&
this.map.extent||null)&&b.spatialReference&&b.spatialReference.isWebMercator()?(this._currentDef=W.normalizeCentralMeridian([b],null,q.hitch(this,function(a){return a[0]}))).then(q.hitch(this,function(b){this._doQuery(b,a);this._normalizedExtent=b}),q.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this._toggleLoading(!1)})):this._doQuery(b,a))}),q.hitch(this,function(a){console.error(a);this.changeToolbarStatus();this._toggleLoading(!1)}))},queryRecordsByRelationship:function(a){var b=
a&&a.layer,c=a&&a.selectedIds;a&&a.relationship&&this.set("relationship",a.relationship);a&&a.relatedOriginalInfo&&this.set("relatedOriginalInfo",a.relatedOriginalInfo);var d=this.relationship;b&&d&&c&&0<c.length&&!M.isEqual(this._relatedQueryIds,c)&&q.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this._toggleLoading(!0),this._requestStatus="processing",this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(q.hitch(this,
function(a){if(this.domNode){this.layer=a;var f=[],K=this.layer;z.forEach(K.fields,function(a){k.isDefined(a.show)&&!0!==a.show&&!("esriFieldTypeOID"===a.type||k.isDefined(K.objectIdField)&&a.name===K.objectIdField)||I.arcade.isArcadeExpressionField(a)||f.push(a.name)});a=new H;a.objectIds=c;a.outFields=f.length?f:["*"];a.relationshipId=d.id;a.returnGeometry="esriGeometryPoint"===this.layer.geometryType;(this._currentDef=b.queryRelatedFeatures(a,function(a){return a})).then(q.hitch(this,function(a){if(this.domNode){var b=
{displayFieldName:d.objectIdField,fields:K.fields,features:[],fieldAliases:null},k={},f=function(a){var c=a.attributes[this.layer.objectIdField];k[c]||(k[c]=!0,b.features.push(a))},r;for(r in a){var l=a[r];z.forEach(l&&l.features,f,this)}e.destroy(this.tipNode);0<b.features.length?(this.grid||(this._removeTable(),e.place(this.loading.domNode,this.domNode)),a=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(a,b.features.length,!1,b)):(this.tipNode=e.toDom("\x3cdiv\x3e"+
this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),e.place(this.tipNode,this.domNode),e.place(this.loading.domNode,this.domNode));this._relatedQueryIds=c;this.emit("data-loaded");this._toggleLoading(!1)}}),q.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);e.destroy(this.tipNode);this.tipNode=e.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e");this._removeTable();e.place(this.tipNode,this.domNode);e.place(this.loading.domNode,this.domNode);this._toggleLoading(!1);
this.changeToolbarStatus()}))}}),q.hitch(this,function(a){console.error(a);this._toggleLoading(!1);this.changeToolbarStatus()}))):this._toggleLoading(!1)},getSelectedRows:function(){return this.tableCreated?this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",
!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),
this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},onShowRelatedRecordsClick:function(){var a=this.getSelectedRows();0<a.length?this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:a}):this._getFeatureIds(this.layer&&this.layer.objectIdField,this.matchingMap&&this._normalizedExtent).then(q.hitch(this,function(a){console.log(a);this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:a})}))},onFilterMenuItemClick:function(){this.showRefreshing(!0);
this.getLayerDefinition().then(q.hitch(this,function(a){if(this.domNode){a=q.clone(a);var b=this.getFilterableFields();a.fields=b;var c=new n({noFilterTip:this.nls.noFilterTip,style:"width:100%;",featureLayerId:this.layerInfo.id,runtime:!0}),b=this._getFilterPopupSize();this._filterPopup=new aa({titleLabel:this.nls.filter,width:b.w,height:b.h,content:c,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:q.hitch(this,function(){var a=c.toJson();a&&a.expr?(this.setFilterObj(a),this.clearSelection(!1),
this.startQuery(),this._filterPopup.close(),this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:a.expr})):new t({message:this.nls.setFilterTip})})},{label:this.nls.cancel}]});c.startup();e.addClass(this._filterPopup.domNode,"widget-at-filter-popup");b=this.getFilterObj();c.build({url:this.layer.url,partsObj:b,layerDefinition:this.layer||a,featureLayerId:this.layer.id})}}),q.hitch(this,function(a){this.domNode&&console.error(a)})).always(q.hitch(this,function(){this.showRefreshing(!1)}));
this.emit("show-filter",{layerInfoId:this.layerInfo.id})},_getFilterPopupSize:function(){var a={w:720,h:485};window.appInfo.isRunInMobile&&(a={w:window.innerWidth,h:window.innerHeight});return a},_resize:function(){if(this._filterPopup){var a=this._getFilterPopupSize();this._filterPopup.resize(a)}},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var a=this._getRichTextFields(),b=this._getExportCSVPopupMessage(a),
c=new t({"class":this.baseClass+"-popup",message:b,titleLabel:this.nls.exportFiles,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:q.hitch(this,function(){var k=b._check;c.domNode&&(c.domNode.className+=" is-loading",(new Q).placeAt(c.domNode));this.exportToCSV(null,"undefined"===typeof k||k.checked?null:a).then(function(){c.close()},function(a){console.error("Error exporting CSV for Attribute Table");c.close()})})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},
_getExportCSVPopupMessage:function(a){var b=document.createElement("div");b.className="message-wrapper";b.appendChild(document.createTextNode(this.nls.exportMessage));if(a.length){var c=document.createElement("div");c.className="input-row";var k=new ba({label:this.nls.keepRichTextLabel,checked:!0}),d=document.createElement("a");d.className="hint-button";d.href="#";d.role="button";d.appendChild(document.createTextNode(this.nls.whatsThis));c.appendChild(k.domNode);c.appendChild(d);b.appendChild(c);
b._check=k;this.own(A(d,"click",q.hitch(this,function(b){b.preventDefault();b={"class":this.baseClass+"-popup",message:this._getRichTextMessage(a)};window.appInfo.isRunInMobile||(b.width=500);new t(b)})))}return b},_getRichTextMessage:function(a){if(!a||a.hasOwnProperty("length")&&!a.length)return"";for(var b=document.createElement("div"),c="",k=0,d=a.length;k<d;k++)c+="\x3cmark\x3e"+a[k].fieldName+"\x3c/mark\x3e";a=""+("\x3cp\x3e"+ea.substitute(this.nls.richTextMessage.explanatoryText.line1,{layerName:"\x3cstrong\x3e"+
this.layer.name+"\x3c/strong\x3e"})+"\x3c/p\x3e");a=a+('\x3cdiv class\x3d"tags"\x3e'+c+"\x3c/div\x3e")+("\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line2+"\x3c/p\x3e\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line3+"\x3c/p\x3e\x3ch3\x3e"+this.nls.richTextMessage.example.label+'\x3c/h3\x3e\x3cdiv class\x3d"example-block"\x3e\x3cpre\x3e\x3cfont color\x3d"#31aacd"\x3eWeb AppBuilder\x3c/font\x3e for \x3cu\x3eArcGIS\x3c/u\x3e\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.first+
'\x3cpre\x3e\x26ltfont color\x3d"#31aacd"\x26gtWeb AppBuilder\x26lt/font\x26gt for \x26ltu\x26gtArcGIS\x26lt/u\x26gt\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.second+"\x3cpre\x3eWeb AppBuilder for ArcGIS\x3c/pre\x3e\x3c/div\x3e");b.innerHTML=a;return b},_getRichTextFields:function(){var a=this.layerInfo&&this.layerInfo.getPopupInfo&&this.layerInfo.getPopupInfo(),a=a&&a.fieldInfos,b=[];if(a)for(var c=0,k=a.length;c<k;c++){var d=a[c];d.stringFieldOption&&"richtext"===d.stringFieldOption&&
b.push(d)}return b},onSelectionComplete:function(){var a=this.layer&&this.layer.getSelectedFeatures();a&&(0===a.length?this.clearSelection(!1,0<this._selectionResults.length):this._selectBySelf(a)||(this.clearSelection(!1),this._updateSelectRowsByFeatures(a)))},onSelectionClear:function(){this.clearSelection(!1,!0)},changeToolbarStatus:function(){if(this.tableCreated){var a=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",
this.nls.showSelectedRecords);this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&a&&0===a.length&&this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",
!0);if(this.layerInfo&&this.isSupportQueryToServer()&&this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel();var b=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=b;b.then(q.hitch(this,function(a){this.domNode&&this.tableCreated&&a&&0<a.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}))}this.tableCreated&&this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",
!0);this.matchingCheckBox.set("disabled",!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",!0);this.hideExportButton||(a&&0<a.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",!0));this.layerInfo.isShowInMap()?this.tableCreated&&a&&0<a.length?this.zoomButton.set("disabled",
!1):this.zoomButton.set("disabled",!0):this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",
!0),this.toggleColumnsMenuItem.set("disabled",!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var a=this.layer.objectIdField,b=this.getSelectedRows();0<b.length&&this.grid&&(this.grid.store instanceof D?this.grid.set("query",q.hitch(this,function(c){return"number"===typeof c&&-1<b.indexOf(c)||-1<b.indexOf(c[a])?!0:!1})):this.grid.set("query",function(){return b}))}},showAllSelectedRecords:function(){if(this.tableCreated&&
this.showSelected){this.grid.set("query",{});var a=this.getSelectedRows();this._updateSelectRowsByIds(a)}},clearSelection:function(a,b){this.tableCreated&&(this.grid.clearSelection(),this.selectionRows=[],a&&this.grid.set("query",{}),b&&(this._selectionResults=[],this.layer&&0<this.layer.getSelectedFeatures().length&&this.selectionManager.clearSelection(this.layer)),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},refresh:function(){this.grid&&this.grid.clearSelection();
this._relatedQuery||this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(a,b){if(!this.layerInfo||!this.layer||!this.tableCreated){var c=new y;c.reject();return c}return this.getSelectedRowsData().then(q.hitch(this,function(c){var k=this.layer.objectIdField,d=[],f=this.layer.fullExtent.spatialReference.equals(this.map.extent.spatialReference),e=this._hasArcadeExpressionFields(),r=I.getSortbyFields(this.grid,this.layer);if(f){var l=z.map(this._getTableSelectedIds(),
q.hitch(this,function(a){for(var b=0,d=c.length;b<d;b++)if(c[b]&&c[b][k]===a)return c[b];return{}}))||[];0===l.length&&this.isSelectionMode()&&l.push({});d=l;0===l.length&&this.grid.store instanceof D&&(d={},r&&r instanceof Array&&(d.sort=z.map(r,function(a){a=a.split(/\ +/);return{attribute:a[0],descending:"DESC"===a[1]}})),d=q.clone(this.grid.store.query({},d)));d.length&&this._appendXY(d)}var l={},K=this.getOutFields(!!d.length);l.datas=d;l.fromClient=!1;l.withGeometry="esriGeometryPoint"===this.layer.geometryType;
l.outFields=K;l.formatNumber=!1;l.formatDate=!0;l.formatCodedValue=!0;l.popupInfo=this.layerInfo.getPopupInfo();l.objectIds=!f&&this._getExportObjectIds();l.outSpatialReference=!f&&q.clone(this.layer.fullExtent.spatialReference);l.richTextFieldsToClear=b;e&&(l.arcadeExpressions={expressionInfos:this.layerInfo.getPopupInfo().expressionInfos,layerDefinition:M.getFeatureLayerDefinition(this.layer)});l.orderByFields=r;if(!l.objectIds||l.objectIds instanceof Array&&0===l.objectIds.length)this.matchingMap&&
this.layerInfo&&!this.layerInfo.isTable&&(l.geometry=this._currentExtent),l.start=0,l.num=this.layer.maxRecordCount||1E3;return da.exportCSVFromFeatureLayer(a||this.configedInfo.name,this.layer,l)}))},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(a){this.grid&&0<=a-this.toolbarHeight-this.footerHeight&&e.setStyle(this.grid.domNode,"height",a-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var a=this.layer&&"esri.layers.CSVLayer"===
this.layer.declaredClass,b=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return this.layer&&this.layer.url&&this.configedInfo.layer.url&&!a&&!b},isSupportQueryOnClient:function(){var a=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,b=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||a||b},destroy:function(){this._destroyed||(this.layer=this.configedInfo=this.layerInfo=null,this._selectionHandles&&
z.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()}),this._closePopup(),this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),this.inherited(arguments))},
_selectBySelf:function(a){a=a||[];if(a.length!==this._selectionResults.length)return!1;var b=this.layer.objectIdField;return z.every(this._selectionResults,function(c){return a.some(function(a){return c.attributes[b]===a.attributes[b]})})},_updateSelectRowsByFeatures:function(a){var b=z.map(a,q.hitch(this,function(a){return a.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(b);this._selectionResults=a},_updateSelectRowsByIds:function(a){this.grid&&this.tableCreated&&(this.selectionRows=
a,z.forEach(a,q.hitch(this,function(a){this.grid.select(a)})),this.setSelectedNumber(),this.changeToolbarStatus())},_removeTable:function(){this.grid&&this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(e.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(a){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&this.tableCreated&&
this._relatedQuery)if(a)this.queryByStoreObjectIds=z.map(this.grid.store.data,q.hitch(this,function(a){return a[this.layer.objectIdField]})),this.startQuery(this.queryByStoreObjectIds);else{var b=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:b})}a||(this._currentExtent=null)},_closePopup:function(){var a=this.map.infoWindow.getSelectedFeature(),b=a&&this._dblClickResult&&a===this._dblClickResult,a=a&&a._layer===
this.layer;this.domNode&&(b||a)&&(this.map.infoWindow.hide(),this._dblClickResult=null)},_getLayerObject:function(){function a(a){this._selectionHandles&&z.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()});this._selectionHandles=[];this._selectionHandles.push(A(a,"selection-complete",q.hitch(this,"onSelectionComplete")));this._selectionHandles.push(A(a,"selection-clear",q.hitch(this,"onSelectionClear")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(q.hitch(this,
function(b){var c=new y;"esri.layers.ArcGISImageServiceLayer"===b.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass?(b=new P(b.url),this.own(A(b,"load",q.hitch(this,function(b){q.hitch(this,a)(b.layer);c.resolve(b.layer)})))):(q.hitch(this,a)(b),c.resolve(b));return c}))},_getLayerDifinition:function(){return this._layerDefinition?B(q.clone(this._layerDefinition)):C({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(q.hitch(this,function(a){this.setLayerDefinition(a);
return this.getLayerDefinition()}))},_getFilterableFields:function(a,b){return z.filter(a,function(a){return z.some(b,function(b){return a.name===b.name&&(b.show||!k.isDefined(b.show))&&q.mixin(a,b)})})},_getExportObjectIds:function(){var a=this._getTableSelectedIds()||[];if(0===a.length&&this.grid.store instanceof D){var b=this.layer.objectIdField;this.grid.store.query(function(c){a.push(c[b])})}return a},_doQuery:function(a,b){if(this.layer){var c=this.layer.objectIdField;this.isSupportQueryToServer()?
this._queryToServer(a,c,b):this.isSupportQueryOnClient()&&this._queryOnClient(a,c,b)}},_queryOnClient:function(a,b,c){var d={};d.features="esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():z.filter(this.layer.graphics,q.hitch(this,function(a){return!a.wabIsTemp}));c&&0<c.length&&(d.features=z.filter(d.features,function(a){return-1<c.indexOf(a.attributes[this.layer.objectIdField])},this));var f=this.layer.fields,e=this.configedInfo.layer.fields;d.fields=e?z.filter(e,
q.hitch(this,function(a){k.isDefined(a.show)||(a.show=!0);a.name!==b||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);for(var c=0,d=f.length;c<d;c++)f[c].name!==a.name||a.type||(a.type=f[c].type);return a.show||a._pk})):z.filter(f,q.hitch(this,function(a){k.isDefined(a.show)||(a.show=!0);a.name!==b||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);return a.show||a._pk}));for(var e=[],l=d.features.length,r=0;r<l;r++)d&&d.features&&d.features[r]&&d.features[r].geometry&&
e.push(d.features[r].geometry);a&&E.defaults.geometryService&&0<e.length?a.spatialReference.equals(e[0].spatialReference)?(d.features=z.filter(d.features,q.hitch(this,function(b){if(b&&b.geometry)return V.intersects(a,b.geometry)})),this.queryExecute(d.fields,d.features.length,!1,d,a)):(l=new F,l.geometries1=e,l.geometries2=[a],l.relation=F.SPATIAL_REL_INTERSECTION,(this._currentDef=E.defaults.geometryService.relation(l,q.hitch(this,function(a){return a}))).then(q.hitch(this,function(b,c){for(var d=
c.length,k=[],f=0;f<d;f++)k.push(b.features[c[f].geometry1Index]);b.features=k;this.queryExecute(b.fields,b.features.length,!1,b,a)},d),q.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this._toggleLoading(!1)}))):this.queryExecute(d.fields,d.features.length,!1,d,a)},_queryToServer:function(a,b,c){this._getFeatureCount(a,c).then(q.hitch(this,function(d){if(this.domNode)if(c)this._queryFeatureLayer(a,b,d,!1,c);else{var f=this.layer,e=k.isDefined(f.maxRecordCount)?
f.maxRecordCount:1E3;this._batchCount=Math.min(e,this._defaultBatchCount);if(d<=e||!this.layer.objectIdField)this._queryFeatureLayer(a,b,d,!1);else{var l=this._getOutFieldsFromLayerInfos(b),r={fields:this.layer.fields};this.layer._recordCounts=d;f.advancedQueryCapabilities&&f.advancedQueryCapabilities.supportsPagination?this.queryExecute(l,d,!0,r,a):this._getFeatureIds(b,a).then(q.hitch(this,function(b){this.domNode&&(this.layer._objectIds=b,this.queryExecute(l,d,!0,r,a))}),q.hitch(this,function(a){console.error(a);
this.changeToolbarStatus()}))}}}),q.hitch(this,function(a){console.error(a);this.changeToolbarStatus()}))},_getFeatureCount:function(a,b){var c=new y,d=new N(this.configedInfo.layer.url),k=new J;k.returnGeometry=!1;k.where=this._getLayerFilterExpression();b&&(k.where+=" AND "+this.layer.objectIdField+" IN ("+b.join()+")");a&&(k.geometry=a);(this._currentDef=d.executeForCount(k,q.hitch(this,function(a){return a}))).then(q.hitch(this,function(a){c.resolve(a)}),q.hitch(this,function(a){a&&"Request canceled"!==
a.message&&(console.error(a),console.log("Could not get feature count."));this._toggleLoading(!1);c.reject(a)}));return c},_queryFeatureLayer:function(a,b,c,d,k){var f=new N(this.configedInfo.layer.url),e=new J;e.where=this._getLayerFilterExpression();k&&b&&(e.where+=" AND "+b+" IN ("+k.join()+")");var l=this._getOutFieldsFromLayerInfos(b),r=(k=this._hasArcadeExpressionFields())&&this._hasArcadeExpressionWithGeometry();if(0<l.length&&!k){var y=[];z.forEach(l,function(a){y.push(a.name)});e.outFields=
y}else e.outFields=["*"];a&&(e.geometry=a,e.spatialRelationship=J.SPATIAL_REL_INTERSECTS);e.outSpatialReference=q.clone(this.map.spatialReference);e.returnGeometry="esriGeometryPoint"===this.layer.geometryType||r;b&&(e.orderByFields=[b+" ASC"]);(this._currentDef=f.execute(e,q.hitch(this,function(a){return a}))).then(q.hitch(this,function(b){this.queryExecute(l,c,d,b,a)}),q.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this._toggleLoading(!1)}))},
_getFeatureIds:function(a,b){var c=new y,d=new N(this.configedInfo.layer.url),k=new J;k.returnGeometry=!1;k.returnIdsOnly=!0;k.where=this._getLayerFilterExpression();if(this.layer._orderByFields||a)k.orderByFields=this.layer._orderByFields||[a+" ASC"];b&&(k.geometry=b);(this._currentDef=d.executeForIds(k,q.hitch(this,function(a){return a}))).then(q.hitch(this,function(a){c.resolve(a)}),q.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature Ids"));
c.resolve([])}));return c},queryExecute:function(a,b,c,d,k){var f=[],f=null,l={};if(this.domNode){d.fields=this._processExecuteFields(this.layer.fields,a);c?f=I.generateCacheStore(this.layer,b,this._batchCount,this._getLayerFilterExpression(),k):(f=z.map(d.features,q.hitch(this,function(a){var b=q.clone(a.attributes);return q.mixin(b,{geometry:a.geometry})})),f=I.generateMemoryStore(f,this.layer.objectIdField));a=this.layer.typeIdField;var l=this.layer.types,r=q.getObject("advancedQueryCapabilities.supportsOrderBy",
!1,this.layer),y=q.getObject("advancedQueryCapabilities.supportsPagination",!1,this.layer),B=q.getObject("advancedQueryCapabilities.supportsStatistics",!1,this.layer),l=I.generateColumnsFromFields(this.grid&&this.grid.columns,this.layerInfo,d.fields,a,l,r&&y||!c,B,this.layer);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(l.attachmentsColumn=this.formatAttachmentsColumn());c=20+100*d.fields.length<e.getMarginBox(this.domNode).w;this.createTable(l,f,b,c);this._currentExtent=
k;b=this.layer.getSelectedFeatures();this.selectionRows&&0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):b&&0<b.length?this._updateSelectRowsByFeatures(b):this.grid.clearSelection();this.changeToolbarStatus();this.emit("data-loaded")}},formatAttachmentsColumn:function(){var a={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,statistics:!1}};a.renderCell=q.hitch(this,function(a,b,
c){var d=a[this.layer.objectIdField];this.layer.queryAttachmentInfos(d,q.hitch(this,function(a){var b=z.map(a,q.hitch(this,function(a){var b=a.name&&/\.(png|jpg|jpeg|gif)$/gi.test(a.name)?"image-type":"file-type",c=X.findCredential(this.layer.url);return'\x3cli class\x3d"'+b+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+d+"/attachments/"+a.id+(c?"?token\x3d"+c.token:""))+'"\x3e'+a.name+"\x3c/a\x3e\x3c/li\x3e"})),k="";0<a.length&&(k=" "+this.nls.files);k='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+
a.length+k+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+b.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+b.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";k=e.toDom(k);0<a.length&&(a=O(".show-attachments-div",k)[0],e.addClass(a,"has-attachments"));c.appendChild(k);this.own(A(c,"click",q.hitch(this,
function(a){a=a&&a.target;if(e.hasClass(a,"show-attachments-div")||e.hasClass(a,"show-attachments")||e.hasClass(a,"close")){a=this._visibleAttachmentPopup;var d=O(".attachment-popup",c)[0];d&&0<b.length&&e.toggleClass(d,"show");e.hasClass(d,"show")?this._visibleAttachmentPopup=d:this._visibleAttachmentPopup=null;a&&a!==d&&e.toggleClass(a,"show")}})))}),q.hitch(this,function(a){console.error(a)}))});return a},createTable:function(a,b,c,d){if(this.grid)this.grid.set("store",b),this.grid.set("columns",
a),this.grid.refresh();else{var k={};k.columns=a;k.store=b;k.keepScrollPosition=!0;k.pagingDelay=1E3;k.allowTextSelection=this.allowTextSelection;k.deselectOnRefresh=!1;this.layer.objectIdField||(k.minRowsPerPage=this.layer.maxRecordCount||1E3,k.maxRowsPerPage=this.layer.maxRecordCount||1E3,k.selectionMode="none");this.grid=new (g([m,p,w,x,v,h]))(k,e.create("div"));e.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&e.destroy(this.tipNode);this.own(A(this.ownerDocument,"keydown",
q.hitch(this,function(a){this.allowTextSelection&&this.grid&&this.grid.allowTextSelection&&a.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(A(this.ownerDocument,"keyup",q.hitch(this,function(){this.allowTextSelection&&this.grid&&!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.layer.objectIdField&&(this.own(A(this.grid,".dgrid-header .dgrid-cell:click",q.hitch(this,this._onHeaderClick))),this.own(A(this.grid,"dgrid-columnstatechange",q.hitch(this,this._onColumnStateChange))),
this.own(A(this.grid,".selection-handle-column:click",q.hitch(this,this._onSelectionHandleClick)),A(this.grid,".selection-handle-column:keydown",q.hitch(this,function(a){a.keyCode!==S.ENTER&&a.keyCode!==S.SPACE||this._onSelectionHandleClick()}))),this.own(A(this.grid,".dgrid-row:dblclick",q.hitch(this,this._onDblclickRow)),A(this.grid,"dgrid-sort",q.hitch(this,function(a){this.emit("sort",a)})),A(this.grid,"dgrid-refresh-complete",q.hitch(this,function(a){this.parent&&R.publish(this.parent.id+"_table_created",
{grid:a.grid,context:this})}))),a=this.map.getLayer(this.layer.id),this.syncSelection&&a&&this.own(A(a,"click",q.hitch(this,this._onFeaturelayerClick))))}this.grid.get("sort")[0]||(this.configedInfo&&this.configedInfo.sortField?this.grid.set("sort",this.configedInfo.sortField,this.configedInfo.isDescending):this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1));this.getParent()&&(a=O(".dgrid-scroller",this.grid.domNode)[0],k=O(".dgrid-header",this.grid.domNode)[0],b=e.getComputedStyle(a),
k=e.getMarginBox(k),b=parseInt(b.marginTop,10),isFinite(b)&&k&&b<k.h&&e.setStyle(a,"marginTop",k.h+"px"));d?e.addClass(this.domNode,"auto-width"):e.removeClass(this.domNode,"auto-width");this.footer?e.empty(this.footer):this.footer=e.create("div",{id:this.parent.id+"_"+this.id+"_footer","class":this.parent.baseClass+"-feature-table-footer",tabindex:"-1"},this.domNode);c=e.create("div",{"class":"dgrid-status self-footer",innerHTML:c+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+
"\x26nbsp;"},this.footer);this.selectedRowsLabel=e.create("div",{"class":"dgrid-status self-footer",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;",style:{display:this.layer.objectIdField?"":"none"}},c,"after");c=e.getStyle(this.domNode,"height");this.changeHeight(c);this._requestStatus="fulfilled";this.tableCreated=!0;e.place(this.loading.domNode,this.grid.domNode);this._toggleLoading(!1)},getSelectedRowsData:function(){var a=new y,b=this._getTableSelectedIds()||[];if(!this.grid||!b.length)return a.resolve(null),
a;this.grid.store instanceof D?(b=q.clone(this.grid.store.data),a.resolve(b)):this.grid.store.query(b,{_export_count:b.length}).then(q.hitch(this,function(b){b=b&&q.clone(this.grid.store._entityData||this.grid.store.data);a.resolve(b)}));return a},_appendXY:function(a){a&&"esriGeometryPoint"===this.layer.geometryType&&z.forEach(a,function(a){var b=a.geometry;b&&"point"===b.type&&("x"in a?a._x=b.x:a.x=b.x,"y"in a?a._y=b.y:a.y=b.y);delete a.geometry})},getOutFields:function(a){var b=null,b=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),
b=this._processExecuteFields(this.layer.fields,b),b=q.clone(b);a&&(a="",a=-1!==b.indexOf("x")?"_x":"x",b.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),a=-1!==b.indexOf("y")?"_y":"y",b.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));return b},setSelectedNumber:function(){if(this.selectedRowsLabel&&this.grid){var a=this.getSelectedRows(),b=0;if(this.grid.store instanceof D){var c=z.map(this.grid.store.data,
function(a){return a[this.layer.objectIdField]},this);z.forEach(a,function(a){-1<c.indexOf(a)&&b++})}else b=a.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+b+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},_setSelection:function(a){this._selectionResults=a=a||[];this.selectionManager.setSelection(this.layer,a)},_zoomToExtentByFeatures:function(a){return this.getExtent(a).then(q.hitch(this,function(a){if(a&&this.domNode){var b=null;if("point"===a.type){var c=this.map.getNumLevels(),d=this.map.getLevel(),
b=this.map.getMaxZoom();0<c?(d===b?c=d:(c=d+4,c>b&&(c=b)),b=this.map.centerAndZoom(a,c)):b=this.map.centerAndZoom(a,1/Math.pow(2,4)*2)}else b=this.map.setExtent(a.expand(2));return b.then(function(){return a})}}))},_showMapInfoWindowByFeatures:function(a,b){if(b&&0!==b.length&&this.domNode){var c=this.map.infoWindow,d=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(c&&c.setFeatures&&1===b.length&&d){z.forEach(b,q.hitch(this,function(a){a._layer=this.layerInfo.layerObject;a.setInfoTemplate(d)}));
c.setFeatures(b);var k=null,k="point"===a.type?b[0].geometry:a.getCenter();c.show(k,{closetFirst:!0});this._dblClickResult=b[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(a,b){if(b&&0<b.length){if("rowclick"===a||"selectall"===a)this._setSelection(b);else if("zoom"===a||"row-dblclick"===a){var c=M.graphicsExtent(b),d=M.toFeatureSet(b),k=A(this.map,"zoom-end, pan-end",q.hitch(this,function(){k.remove();"row-dblclick"===a&&this.domNode&&this._showMapInfoWindowByFeatures(c,
b)}));M.zoomToFeatureSet(this.map,d).then(null,function(a){a&&(console.error(a.message),k&&k.remove())})}this.setSelectedNumber()}else this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(a){var b=this.map.infoWindow,c=q.isArray(a)?a:[a];A.once(b,"hide",q.hitch(this,function(){d&&d.remove&&(d.remove(),d=null)}));var d=Y.after(b,"show",q.hitch(this,function(){var a=b.getSelectedFeature(),a=a&&c[0]===a,k=-1;b.features&&(k=b.features.indexOf(c[0]));!a&&-1<k?b.select(k):this.domNode&&
!a&&d&&d.remove&&(d.remove(),d=null)}))},getGraphicsFromLocalFeatureLayer:function(a){for(var b=[],c,d,k=a.length,f=this.layer.graphics.length,e=this.layer.objectIdField,l=0;l<k;l++)for(var r=0;r<f;r++)if(c=this.layer.graphics[r].attributes[e]+"",d=a[l]+"",c===d){b.push(this.layer.graphics[r]);break}return b},getExtent:function(a){var b=new y,c,d,k=a.length;if(1===k&&a[0].geometry&&"point"===a[0].geometry.type)c=a[0].geometry;else if(1!==k||a[0].geometry)for(var f=0;f<k;f++)a[f].geometry?"point"===
a[f].geometry.type?(d||(d=new U(a[f].geometry.spatialReference)),d.addPoint(a[f].geometry),f===k-1&&(c=d.getExtent())):c=c?c.union(a[f].geometry.getExtent()):a[f].geometry.getExtent():console.error("unable to get geometry of the reocord: ",a[f]);else return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),b;if(!c||!c.spatialReference)return b.reject(Error("AttributeTable.getExtent:: extent was not projected.")),b;a=this.map.spatialReference;c.spatialReference.equals(a)?b.resolve(c):
(d=new T,d.geometries=[c],d.outSR=a,E.defaults.geometryService.project(d,q.hitch(this,function(a){this.domNode&&(a&&a.length?b.resolve(a[0]):b.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),q.hitch(this,function(a){a||(a=Error("AttributeTable.getExtent:: extent was not projected."));b.reject(a)})));return b},_onFeaturelayerClick:function(a,b){if(this.actived){var c=q.getObject("graphic",!1,a),d=q.getObject("graphic.attributes",!1,a);d&&c&&c._layer===this.layer&&((c=this.map.infoWindow.getSelectedFeature())&&
c._layer===this.layer&&!b&&this.map.infoWindow.hide(),b=d[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(b).then(q.hitch(this,function(b){-1!==b&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*b}),this.map.infoWindow.features&&(b=this.map.infoWindow.features.indexOf(a.graphic),this.map.infoWindow.select(b)),A.once(this.map.infoWindow,"selection-change",q.hitch(this,function(){var b=this.map.infoWindow.getSelectedFeature(),c=q.getObject("_layer",
!1,b);b!==a.graphic&&c===this.layer&&this._onFeaturelayerClick({graphic:b},!0)})),this.syncWithMapInfowindow(a.graphic))})))}},_getIndexOfIdInGrid:function(a){var b=new y,c=-1,d=q.getObject("store.objectIds",!1,this.grid),c=null,c=this.grid.get("sort")[0];if(this._relatedQuery)return b.resolve(-1),b;if(this.grid.store instanceof D)a=this.grid.store.get(a),d=this.grid.store.data,a?c&&c.attribute&&k.isDefined(c.descending)?(d=q.clone(d),c=function(a,b){return function(c,d){return c[a]===d[a]?0:c[a]<
d[a]?b?1:-1:b?-1:1}}(c.attribute,c.descending),d.sort(c),d=z.map(d,function(a){return a[this.layer.objectIdField]},this),c=d.indexOf(a[this.layer.objectIdField])):c=d.indexOf(a):c=-1,b.resolve(c);else if(d&&0<d.length)c=d.indexOf(a),b.resolve(c);else{d=new J;d.returnGeometry=!1;d.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+" \x3c "+a;if(c&&(c.attribute!==this.layer.objectIdField||c.descending))return b.resolve(-1),b;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&
(d.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(d)).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,function(a){b.reject(a)}))}return b},_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var a=this.getSelectedRows();this._goToFeatures(a,"zoom")}},_goToFeatures:function(a,b){if(0!==a.length){var c=this.getGraphicsFromLocalFeatureLayer(a);this.isSupportQueryToServer()&&a.length!==c.length?this._queryFeaturesByIds(a,b):this.selectFeatures(b,c)}},_onDblclickRow:function(a){this.layerInfo&&
this.layerInfo.isShowInMap()&&(a=[this.grid.row(a).id],this._goToFeatures(a,"row-dblclick"))},_queryFeaturesByIds:function(a,b){var c=new J;c.objectIds=a;c.returnGeometry=!0;c.outSpatialReference=q.clone(this.map.spatialReference);c.outFields=["*"];a=this.layer;var d="esri.layers.CSVLayer"===a.declaredClass;a.url&&!d?(new N(a.url)).execute(c,q.hitch(this,function(a){this.selectFeatures(b,a.features)}),q.hitch(this,this._errorSelectFeatures)):a.selectFeatures(c,P.SELECTION_NEW,q.hitch(this,this.selectFeatures,
b),q.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(a){var b=this.grid.cell(a);this._showColumnMenu(b.column,b,a.target,{x:a.pageX,y:a.pageY})},_showColumnMenu:function(a,b,k,f){var l=q.getObject("_cache",!1,a);if(l&&(l.sortable||l.statistics)){var r=new c({});e.addClass(r.domNode,"jimu-widget-attributetable-feature-menu");var y=this;if(l.sortable){var B=["iconSortAscending","iconSortDescending"];z.forEach([this.nls.sortAsc,this.nls.sortDes],function(b,c){b=new d({label:b,iconClass:B[c],
baseClass:"menuItemClass",onClick:function(){0===c?y.grid.set("sort",a.field,!1):1===c&&y.grid.set("sort",a.field,!0)}});r.addChild(b)})}l.statistics&&(l=new d({label:this.nls.statistics,iconClass:"iconTableStatistics",baseClass:"menuItemClass",onClick:q.hitch(this,function(){var b={layer:this.layer,filterExpression:this._getLayerFilterExpression(),fieldNames:[a.field]};this.matchingMap&&(b.geometry=this._currentExtent);if(this.showSelected){var c=this._getSelectedIds();b.filterExpression+=" AND "+
this.layer.objectIdField+" IN ("+c.join()+")"}else this.queryByStoreObjectIds&&0<this.queryByStoreObjectIds.length&&(b.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");this.fieldStatistics=new Z;this.fieldStatistics.showContentAsPopup(b)})}),r.addChild(l));l=r.getChildren();r.startup();r._openMyself({target:k,delegatedTarget:b,iframe:null,coords:f});this.own(A(r,"Close",q.hitch(this,function(){var a=this.get("columnMenu");a&&(a.destroyRecursive(),this.set("columnMenu",
null))})));this.set("columnMenu",r);1>l.length&&A.emit(r,"Close")}},_onColumnStateChange:function(a){if(a&&a.grid&&a.grid.columns){var b=0,c;for(c in a.grid.columns)a.grid.columns[c].hidden||b++;20+100*b-1<e.getMarginBox(this.domNode).w?e.addClass(this.domNode,"auto-width"):e.removeClass(this.domNode,"auto-width")}},_onSelectionHandleClick:function(){var a=this._getSelectedIds();this.selectionRows=a;this._closePopup();this.layerInfo.isTable||(0<a.length?this._goToFeatures(a,"rowclick"):this._setSelection([]));
this.setSelectedNumber();this.emit("row-click",{table:this,selectedIds:a})},_onExtentChange:function(a){var b=q.getObject("delta.x",!1,a),c=q.getObject("delta.y",!1,a);a=this._clickMap&&!a.levelChange?isFinite(b)&&isFinite(c)&&(0<Math.abs(b)||0<Math.abs(c)):!0;this._clickMap=!1;a&&this.matchingMap&&this.actived&&this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var a=this.layerInfo.getFilter();return a?a:"1\x3d1"},_getOutFieldsFromLayerInfos:function(a){var b=
this.configedInfo.layer.fields,c=this.layerInfo.getPopupInfo(),d=c&&c.fieldInfos,f=[];b&&z.forEach(b,q.hitch(this,function(b){if(!k.isDefined(b.show)&&(b.show=!0,d))for(var c=0,e=d.length;c<e;c++){var l=d[c];l.fieldName===b.name&&(b.show=l.visible)}b.name!==a||"esriFieldTypeOID"!==b.type&&"esriFieldTypeInteger"!==b.type&&b.type||(b._pk=!0);(b.show||b._pk)&&f.push(b)}));return f},_processExecuteFields:function(a,b){if(a&&0<a.length){var c=[];if(!b.length)return a;for(var d=0,k=b.length;d<k;d++)for(var f=
0;f<a.length;f++)b[d].name!==a[f].name||b[d].type!==a[f].type&&b[d].type||(a[f]=q.mixin(a[f],b[d]),c.push(a[f]));return c}return b},_getSelectedIds:function(){var a=[],b=this.grid.selection,c;for(c in b)b[c]&&(isFinite(c)?a.push(parseInt(c,10)):a.push(c));return a},_getTableSelectedIds:function(){var a=[],b=this.getSelectedRows();if(this.grid)if(this.grid.store instanceof D){var c=z.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);z.forEach(b,function(b){-1<c.indexOf(b)&&
a.push(parseInt(b,10))})}else a=b;return a},isSelectionMode:function(){var a=this.getSelectedRows();return this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?!0:!1},_errorSelectFeatures:function(a){console.error(a)},_popupMessage:function(a){var b=new t({message:a,buttons:[{label:this.nls.ok,onClick:q.hitch(this,function(){b.close()})}]});this._toggleLoading(!1)},_hasArcadeExpressionFields:function(){return this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos&&
z.some(this.configedInfo.layer.fields,function(a){return I.arcade.isArcadeExpressionField(a)})},_hasArcadeExpressionWithGeometry:function(){var a=this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos,b=I.arcade.parseArcadeExpressions(a);return b?z.some(Object.keys(b),function(a){return b[a].usesGeometry}):!1},_toggleLoading:function(a){void 0===a?this.loading.hidden?this.loading.show():this.loading.hide():a?this.loading.show():this.loading.hide()}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(g,e,u,t,n,m,p,w,x){function v(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function h(a,b){var c=a.bodyNode,f=b?"text":21>n("ff")?"-moz-none":"none";d&&"msUserSelect"!==d?c.style[d]=f:n("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=t(c,"selectstart",function(a){var b=a.target&&
a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(v(c,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=m.after(a,"renderRow",function(a){v(a,!0);return a})}n.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});n.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});n.add("css-user-select",function(a,b,c){a=c.style;
b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});n.add("dom-selectstart","undefined"!==typeof document.onselectstart);var c=n("mac")?"metaKey":"ctrlKey",d=n("css-user-select"),f=(p=n("pointer"))&&"MS"===p.slice(0,2),b=p?p+(f?"Down":"down"):"mousedown",l=p?p+(f?"Up":"up"):"mouseup";"WebkitUserSelect"===d&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(d=!1);return e("dgrid.Selection",
null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",selectionEvents:b+","+l+",dgrid-cellfocusin",selectionTouchEvents:n("touch")?w.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=
this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){g.deprecated("setSelectionMode(...)",
'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?h(this,a):h(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==l||c==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&
a.type===b&&this.isSelected(c))this._waitForMouseUp=c;else this[this._selectionHandlerName](a,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a[c];this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var d=this._lastSelected,f=a.keyCode?a.ctrlKey:a[c],e;a.shiftKey||(e=f?null:!0,d=null);this.select(b,d,e);d||(this._lastSelected=b)},_extendedSelectionHandler:function(a,
b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:a[c])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,d=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};n("touch")&&!n("pointer")&&this.selectionTouchEvents?(t(b,w.selector(d,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),t(b,t.selector(d,
this.selectionEvents),function(b){a._ignoreMouseSelect!==this?a._handleSelect(b,this):b.type===l&&(a._ignoreMouseSelect=null)})):t(b,t.selector(d,this.selectionEvents),function(b){a._handleSelect(b,this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(b){b[c]&&65==b.keyCode&&!/\bdgrid-input\b/.test(b.target.className)&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&m.after(this,
"_setStore",function(){a._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,d){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[d](a,null,c)}var b=this,c=this.store,d,f;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=m.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),f=m.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();f.remove()}):
(d=m.before(this,"removeRow",function(a,b){b||(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];t.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,
b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,c){var d,f,e;"undefined"===typeof c&&(c=!0);a.element||(a=this.row(a));if(!1===c||this.allowSelect(a))if(d=this.selection,f=!!d[a.id],null===c&&(c=!f),e=a.element,c||this.allSelected?d[a.id]=c:delete this.selection[a.id],e&&(c?x(e,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):x(e,"!dgrid-selected!ui-state-active")),c!==f&&e&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),
b){if(b=b.element)for(d=this._determineSelectionDirection(e,b),d||(b=document.getElementById(b.id),d=this._determineSelectionDirection(e,b));a.element!=b&&(a=this[d](a));)this._select(a,null,c)}else this._lastSelected=e,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:n("dom-comparedocumentposition")?
function(a,b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);u.when(b,function(b){var c=a.selection,
d,f,e;for(d=0;d<b.length;d++)f=a.row(b[d]),(e=f.id in c?c[f.id]:a.allSelected)&&a._select(f,null,e);a._fireSelectionEvents()});return b}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(g,e,u,t,n,m){var p,w,x=e("ie"),v=x&&e("quirks"),h=8>x||v?"htmlFor":"for";return g("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,
i18nColumnHider:m,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var c=this.subRows,d=!0,f,b,e,a;delete this._columnHiderFirstCheckbox;e=0;for(f=c.length;e<f;e++)for(a=0,b=c[e].length;a<b;a++)this._renderHiderMenuEntry(c[e][a]),d&&(d=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[c[e][a].id])},_renderHiderMenuEntry:function(c){var d=c.id,f=t.escapeCssIdentifier(d,"-"),b,e;c.hidden&&(c.hidden=!1,this._hideColumn(d),c.hidden=
!0);c.unhidable||(b=n("div.dgrid-hider-menu-row"),e=this.domNode.id+"-hider-menu-check-"+f,d=this._columnHiderCheckboxes[d]=n(b,"input.dgrid-hider-menu-check.hider-menu-check-"+f+"[type\x3dcheckbox]"),d.id=e,n(b,"label.dgrid-hider-menu-label.hider-menu-label-"+f+"["+h+"\x3d"+e+"]",c.label||c.field||""),n(this.hiderMenuNode,b),c.hidden||(d.checked=!0))},renderHeader:function(){function c(a){a.stopPropagation()}var d=this,f=this.hiderMenuNode,b=this.hiderToggleNode,e;this.inherited(arguments);if(f){for(e in this._columnHiderRules)this._columnHiderRules[e].remove();
f.innerHTML=""}else b=this.hiderToggleNode=n(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(u(b,"click",function(a){d._toggleColumnHiderMenu(a)})),f=this.hiderMenuNode=n("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+"]"),f.id=this.id+"-hider-menu",this._listeners.push(u(f,"keyup",function(a){27===(a.charCode||a.keyCode)&&(d._toggleColumnHiderMenu(a),b.focus())})),
f.style.display="none",n(this.domNode,f),this._listeners.push(u(f,".dgrid-hider-menu-check:"+(9>x||v?"click":"change"),function(a){d._updateColumnHiddenState(a.target.id.substr(d.id.length+18),!a.target.checked)})),this._listeners.push(u(f,"mousedown",c),u(b,"mousedown",c)),w||(w=u.pausable(document,"mousedown",function(a){p&&p._toggleColumnHiderMenu(a)}),w.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);
for(var c in this._columnHiderRules)this._columnHiderRules[c].remove()},left:function(c,d){return this.right(c,-d)},right:function(c,d){c.element||(c=this.cell(c));for(var f=this.inherited(arguments),b=c;f.column.hidden;){f=this.inherited(arguments,[f,0<d?1:-1]);if(b.element===f.element)return c;b=f}return f},isColumnHidden:function(c){return!!this._columnHiderRules[c]},_toggleColumnHiderMenu:function(){var c=this._hiderMenuOpened,d=this.hiderMenuNode,f=this.domNode,b;d.style.display=c?"none":"";
c?d.style.height="":(d.offsetHeight>f.offsetHeight-12&&(d.style.height=f.offsetHeight-12+"px"),(b=this._columnHiderFirstCheckbox)&&b.focus());w[c?"pause":"resume"]();p=c?null:this;this._hiderMenuOpened=!c},_hideColumn:function(c){var d=this,f="#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",b;this._columnHiderRules[c]||(this._columnHiderRules[c]=t.addCssRule(f+t.escapeCssIdentifier(c,"-"),"display: none;"),8!==e("ie")&&10!==e("ie")||e("quirks")||(b=t.addCssRule(".dgrid-row-table","display: inline-table;"),
window.setTimeout(function(){b.remove();d.resize()},0)))},_showColumn:function(c){this._columnHiderRules[c]&&(this._columnHiderRules[c].remove(),delete this._columnHiderRules[c])},_updateColumnHiddenState:function(c,d){this[d?"_hideColumn":"_showColumn"](c);this.columns[c].hidden=d;u.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[c],hidden:d,bubbles:!0});this.resize()},toggleColumnHiddenState:function(c,d){"undefined"===typeof d&&(d=!this._columnHiderRules[c]);this._updateColumnHiddenState(c,
d);this._columnHiderCheckboxes[c].checked=!d}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(g,e,u,t,n,m,p,w,x){function v(b){for(var c=b.length,a=c,d=b[0].length,f=Array(c);c--;)f[c]=Array(d);for(var e={},c=0;c<a;c++)for(var h=f[c],g=b[c],p=0,m=0;p<d;p++){var k=g[m],C;if("undefined"==typeof h[p]){h[p]=
k.id;if(k.rowSpan&&1<k.rowSpan){C=f;for(var F=k.rowSpan,H=c,n=p,u=k.id,w=1;w<F;w++)C[H+w][n]=u}if(0<c&&k.colSpan&&1<k.colSpan)for(C=1;C<k.colSpan;C++)if(h[++p]=k.id,k.rowSpan&&1<k.rowSpan)for(var F=f,H=k.rowSpan,n=c,u=p,w=k.id,t=1;t<H;t++)F[n+t][u]=w;e[k.id]=b[0][p].id;m++}}return e}function h(b,c,a,d,f){if(!(0>=a)){var l=b.columns[c],r;if(l&&(r={grid:b,columnId:c,width:a,bubbles:!0,cancelable:!0},d&&(r.parentType=d),!b._resizedColumns||e.emit(b.headerNode,"dgrid-columnresize",r)))return"auto"===
a?delete l.width:(l.width=a,a+="px"),(d=b._columnSizes[c])?d.set("width",a):d=w.addCssRule("#"+w.escapeCssIdentifier(b.domNode.id)+" .dgrid-column-"+w.escapeCssIdentifier(c,"-"),"width: "+a+";"),b._columnSizes[c]=d,!1!==f&&b.resize(),!0}}var c,d=0,f={create:function(){c=x("div.dgrid-column-resizer")},destroy:function(){x(c,"!");c=null},show:function(b){b=m.position(b.domNode,!0);c.style.top=b.y+"px";c.style.height=b.h+"px";x(document.body,c)},move:function(b){c.style.left=b+"px"},hide:function(){c.parentNode.removeChild(c)}};
return g("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);d++||f.create()},destroy:function(){this.inherited(arguments);for(var b in this._columnSizes)this._columnSizes[b].remove();--d||f.destroy()},resizeColumnWidth:function(b,c){return h(this,b,c)},configStructure:function(){var b=this._oldColumnSizes=t.mixin({},this._columnSizes),c;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);
for(c in b)c in this._columnSizes||b[c].remove();delete this._oldColumnSizes},_configColumn:function(b){this.inherited(arguments);var c=b.id,a;"width"in b&&((a=this._oldColumnSizes[c])?a.set("width",b.width+"px"):a=w.addCssRule("#"+w.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+w.escapeCssIdentifier(c,"-"),"width: "+b.width+"px;"),this._columnSizes[c]=a)},renderHeader:function(){this.inherited(arguments);var b=this,c;if(this.columnSets&&this.columnSets.length)for(var a=this.columnSets.length;a--;)c=
t.mixin(c||{},v(this.columnSets[a]));else this.subRows&&1<this.subRows.length&&(c=v(this.subRows));for(var a=u(".dgrid-cell",b.headerNode),d=a.length;d--;){var f=a[d],h=f.columnId,g=b.columns[h],m=f.childNodes;if(g&&!1!==g.resizable){g=x("div.dgrid-resize-header-container");for(f.contents=g;0<m.length;)x(g,m[0]);x(f,g,"div.dgrid-resize-handle.resizeNode-"+w.escapeCssIdentifier(h,"-")).columnId=c&&c[h]||h}}b.mouseMoveListen||(e(b.headerNode,".dgrid-resize-handle:mousedown"+(p("touch")?",.dgrid-resize-handle:touchstart":
""),function(a){b._resizeMouseDown(a,this);b.mouseMoveListen.resume();b.mouseUpListen.resume()}),b._listeners.push(b.mouseMoveListen=e.pausable(document,"mousemove"+(p("touch")?",touchmove":""),w.throttleDelayed(function(a){b._updateResizerPosition(a)}))),b._listeners.push(b.mouseUpListen=e.pausable(document,"mouseup"+(p("touch")?",touchend":""),function(a){b._resizeMouseUp(a);b.mouseMoveListen.pause();b.mouseUpListen.pause()})),b.mouseMoveListen.pause(),b.mouseUpListen.pause())},_resizeMouseDown:function(b,
c){b.preventDefault();n.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(b);this._targetCell=u(".dgrid-column-"+w.escapeCssIdentifier(c.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(b);f.show(this)},_resizeMouseUp:function(b){var c=this._columnSizes,a,d,e;this.adjustLastColumn&&(e=this.headerNode.clientWidth-1);this._resizedColumns||(a=u(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?a=a.filter(function(a){return"0"==a.columnId.split("-")[0]&&
!(a.columnId in c)}):this.subRows&&1<this.subRows.length&&(a=a.filter(function(a){return"0"==a.columnId.charAt(0)&&!(a.columnId in c)})),d=a.map(function(a){return a.offsetWidth}),a.forEach(function(a,b){h(this,a.columnId,d[b],null,!1)},this),this._resizedColumns=!0);n.setSelectable(this.domNode,!0);a=this._targetCell;var g=this._getResizeMouseLocation(b)-this._startX,p=a.offsetWidth+g,m=this._getResizedColumnWidths(),t=m.totalWidth,m=m.lastColId,v=u(".dgrid-column-"+w.escapeCssIdentifier(m,"-"),
this.headerNode)[0].offsetWidth;p<this.minWidth&&(p=this.minWidth);h(this,a.columnId,p,b.type)&&a.columnId!=m&&this.adjustLastColumn&&(t+g<e?h(this,m,"auto",b.type):v-g<=this.minWidth&&h(this,m,this.minWidth,b.type));f.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(b){if(this._targetCell){b=this._getResizeMouseLocation(b);var c=this._targetCell.offsetWidth,a=b;c+(b-this._startX)<this.minWidth&&(a=this._startX-(c-this.minWidth));f.move(a)}},_getResizeMouseLocation:function(b){var c=
0;b.pageX?c=b.pageX:b.clientX&&(c=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return c},_getResizedColumnWidths:function(){var b=0,c=u((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),a=c.length;if(!a)return{};for(var d=c[a-1].columnId;a--;)b+=c[a].offsetWidth;return{totalWidth:b,lastColId:d}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),
function(g,e,u,t,n,m,p){function w(c,d){var f=d[2];c=c[f?"columnSets":"subRows"][d[1]];return f?c[d[2]]:c}function x(c,d,f){d[2]?c.columnSets[d[1]][d[2]]=f:c.subRows[d[1]]=f}function v(c,d){return d.slice(("dgrid-"+c+"-").length)}var h=/(\d+)(?:-(\d+))?$/;g=e(m,{copyState:function(){return!1},checkAcceptance:function(c,d){return c==this},_legalMouseDown:function(c){return-1<c.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(c){var d=this.grid,f=
h.exec(v(d.id,c[0].getAttribute("dndType"))),b=f[2]?"columnSets":"subRows",e=w(d,f),a=d.columns;this.inherited(arguments);f&&setTimeout(function(){var l=u.map(c[0].parentNode.childNodes,function(b){return a[b.columnId]});x(d,f,l);l={grid:d,subRow:l,column:a[c[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};l[b]=d[b];t.emit(d.domNode,"dgrid-columnreorder",l)?d.set(b,d[b]):(x(d,f,e),d.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});e=e("dgrid.extensions.ColumnReorder",
null,{columnDndConstructor:g,_initSubRowDnd:function(c,d){var f,b,e,a;b=0;for(e=c.length;b<e;b++)a=c[b],!1!==a.reorderable&&(a=a.headerNode,"TH"!=a.tagName&&(a=a.parentNode),p(a,".dojoDndItem[dndType\x3d"+d+"]"),f||(f=a.parentNode));f&&this._columnDndSources.push(new this.columnDndConstructor(f,{horizontal:!0,grid:this}))},renderHeader:function(){var c="dgrid-"+this.id+"-",d,f;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets)for(f=0,d=this.columnSets.length;f<d;f++)u.forEach(this.columnSets[f],
function(b,d){this._initSubRowDnd(b,c+f+"-"+d)},this);else u.forEach(this.subRows,function(b,d){this._initSubRowDnd(b,c+d)},this)},_destroyColumns:function(){this._columnDndSources&&u.forEach(this._columnDndSources,function(c){c.destroy()});this.inherited(arguments)}});e.ColumnDndSource=g;return e})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(g,e,u,t,n,m,
p,w){function x(a){a.preventDefault()}var v={checkbox:1,radio:1,button:1},h=/\bdgrid-cell\b/,c=/\bdgrid-row\b/,d=g("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=t.mixin({},d.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=t.mixin({},d.defaultHeaderKeyMap))},postCreate:function(){function a(a){var b=a.target;return b.type&&(!v[b.type]||32==a.keyCode)}function b(b){function k(){d._focusedHeaderNode&&
(d._focusedHeaderNode.tabIndex=-1);if(d.showHeader){if(f)for(var a=0,b,c=d.headerNode.getElementsByTagName("th");b=c[a];++a){if(l.test(b.className)){d._focusedHeaderNode=g=b;break}}else d._focusedHeaderNode=g=d.headerNode;g&&(g.tabIndex=d.tabIndex)}}var f=d.cellNavigation,l=f?h:c,r=b===d.headerNode,g=b;r?(k(),e.after(d,"renderHeader",k,!0)):e.after(d,"renderArray",function(a){return w.when(a,function(a){var c=d._focusedNode||g;if(l.test(c.className)&&p.contains(b,c))return a;for(var k=0,f=b.getElementsByTagName("*"),
e;e=f[k];++k)if(l.test(e.className)){c=d._focusedNode=e;break}c.tabIndex=d.tabIndex;return a})});d._listeners.push(u(b,"mousedown",function(b){a(b)||d._focusOnNode(b.target,r,b)}));d._listeners.push(u(b,"keydown",function(b){if(!b.metaKey&&!b.altKey){var c=d[r?"headerKeyMap":"keyMap"][b.keyCode];c&&!a(b)&&c.call(d,b)}}))}this.inherited(arguments);var d=this;this.tabableHeader&&(b(this.headerNode),u(this.headerNode,"dgrid-cellfocusin",function(){d.scrollTo({x:this.scrollLeft})}));b(this.contentNode);
this._debouncedEnsureRowScroll=p.debounce(this._ensureRowScroll,this)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);var b=this,c=document.activeElement===this._focusedNode,d=this[this.cellNavigation?"cell":"row"](this._focusedNode),k=d.row||d,f;a=a.element||a;a===k.element&&((f=this.down(k,!0))&&f.element!==a||(f=this.up(k,!0)),this._removedFocus={active:c,rowId:k.id,columnId:d.column&&d.column.id,siblingId:f&&f.element!==a?f.id:void 0},setTimeout(function(){b._removedFocus&&
b._restoreFocus(k.id)},0),this._focusedNode=null);this.inherited(arguments)},insertRow:function(a){var b=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(b);return b},_restoreFocus:function(a){var b=this._removedFocus,c;if((a=(a=a&&this.row(a))&&a.element&&a.id===b.rowId?a:"undefined"!==typeof b.siblingId&&this.row(b.siblingId))&&a.element){if(!a.element.parentNode.parentNode){b.wait=!0;return}"undefined"!==typeof b.columnId&&(c=this.cell(a,b.columnId))&&
c.element&&(a=c);b.active&&0!==a.element.offsetHeight?this._focusOnNode(a,!1,null):(m(a.element,".dgrid-focus"),a.element.tabIndex=this.tabIndex,this._focusedNode=a.element)}delete this._removedFocus},addKeyHandler:function(a,b,c){return e.after(this[c?"headerKeyMap":"keyMap"],a,b,!0)},_ensureRowScroll:function(a){var b=this.getScrollPosition().y;b>a.offsetTop?this.scrollTo({y:a.offsetTop}):b+this.contentNode.offsetHeight<a.offsetTop+a.offsetHeight&&this.scrollTo({y:a.offsetTop-this.contentNode.offsetHeight+
a.offsetHeight})},_focusOnNode:function(a,b,d){var f="_focused"+(b?"Header":"")+"Node",k=this[f],e=this.cellNavigation?"cell":"row",l=this[e](a),r,g,p,C,y;if(a=l&&l.element){if(this.cellNavigation)for(r=a.getElementsByTagName("input"),y=0,p=r.length;y<p;y++)if(g=r[y],(-1!=g.tabIndex||"_dgridLastValue"in g)&&!g.disabled){8>n("ie")&&(g.style.position="relative");g.focus();8>n("ie")&&(g.style.position="");C=!0;break}null!==d&&(d=t.mixin({grid:this},d),d.type&&(d.parentType=d.type),d.bubbles||(d.bubbles=
!0));k&&(m(k,"!dgrid-focus[!tabIndex]"),8>n("ie")&&(k.style.position=""),d&&(d[e]=this[e](k),u.emit(k,"dgrid-cellfocusout",d)));k=this[f]=a;d&&(d[e]=l);f=this.cellNavigation?h:c;!C&&f.test(a.className)&&(8>n("ie")&&(a.style.position="relative"),a.tabIndex=this.tabIndex,a.focus());m(a,".dgrid-focus");d&&u.emit(k,"dgrid-cellfocusin",d);this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!b&&this._debouncedEnsureRowScroll(l.row.element)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,
!0)},focus:function(a){(a=a||this._focusedNode)?this._focusOnNode(a,!1):this.contentNode.focus()}}),f=d.moveFocusVertical=function(a,b){var c=this.cellNavigation,d=this[c?"cell":"row"](a),d=c&&d.column.id;b=this.down(this._focusedNode,b,!0);c&&(b=this.cell(b,d));this._focusOnNode(b,!1,a);a.preventDefault()};g=d.moveFocusUp=function(a){f.call(this,a,-1)};var b=d.moveFocusDown=function(a){f.call(this,a,1)},l=d.moveFocusPageUp=function(a){f.call(this,a,-this.pageSkip)},a=d.moveFocusPageDown=function(a){f.call(this,
a,this.pageSkip)},r=d.moveFocusHorizontal=function(a,b){if(this.cellNavigation){var c=!this.row(a);this._focusOnNode(this.right(this["_focused"+(c?"Header":"")+"Node"],b),c,a);a.preventDefault()}},y=d.moveFocusLeft=function(a){r.call(this,a,-1)},B=d.moveFocusRight=function(a){r.call(this,a,1)},G=d.moveHeaderFocusEnd=function(a,b){var c;this.cellNavigation&&(c=this.headerNode.getElementsByTagName("th"),this._focusOnNode(c[b?0:c.length-1],!0,a));a.preventDefault()},L=d.moveHeaderFocusHome=function(a){G.call(this,
a,!0)},D=d.moveFocusEnd=function(a,b){var c=this,d=this.cellNavigation,f=this.contentNode,k=f.scrollTop+(b?0:f.scrollHeight),f=f[b?"firstChild":"lastChild"],l=-1<f.className.indexOf("dgrid-preload"),r=l?f[(b?"next":"previous")+"Sibling"]:f,g=r.offsetTop+(b?0:r.offsetHeight),h;if(l){for(;r&&0>r.className.indexOf("dgrid-row");)r=r[(b?"next":"previous")+"Sibling"];if(!r)return}!l||1>f.offsetHeight?(d&&(r=this.cell(r,this.cell(a).column.id)),this._focusOnNode(r,!1,a)):(n("dom-addeventlistener")||(a=t.mixin({},
a)),h=e.after(this,"renderArray",function(f){h.remove();return w.when(f,function(f){f=f[b?0:f.length-1];d&&(f=c.cell(f,c.cell(a).column.id));c._focusOnNode(f,!1,a)})}));k===g&&a.preventDefault()},E=d.moveFocusHome=function(a){D.call(this,a,!0)};d.defaultKeyMap={32:x,33:l,34:a,35:D,36:E,37:y,38:g,39:B,40:b};d.defaultHeaderKeyMap={32:x,35:G,36:L,37:y,39:B};return d})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(g,e,u,t,n,m,p,w){u("dijit-legacy-requires")&&n(0,function(){g(["dijit/ToolbarSeparator"])});return e("dijit.Toolbar",[m,w,p],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(g,e,u,t,n,m,p){g=g(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var e=u.map(this.geometries1,function(c){return c.toJson()}),g=u.map(this.geometries2,function(c){return c.toJson()}),m={},h=this.geometries1;h&&0<h.length&&(m.geometries1=t.toJson({geometryType:p.getJsonType(h[0]),geometries:e}),e=this.geometries1[0].spatialReference,m.sr=e.wkid?e.wkid:t.toJson(e.toJson()));(e=this.geometries2)&&0<e.length&&
(m.geometries2=t.toJson({geometryType:p.getJsonType(e[0]),geometries:g}));this.relation&&(m.relation=this.relation);this.relationParam&&(m.relationParam=this.relationParam);return m}});e.mixin(g,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});n("extend-esri")&&e.setObject("tasks.RelationParameters",g,m);return g})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),
function(g,e,u,t,n,m,p,w,x,v,h,c){function d(c){var b=e.clone(c.attributes);(c=c.geometry)&&"point"===c.type&&("x"in b?b._x=c.x:b.x=c.x,"y"in b?b._y=c.y:b.y=c.y);return b}g.exportCSV=function(c,b,d){return g._createCSVStr(b,d).then(function(a){return g._download(c+".csv",a)})};g.exportCSVFromFeatureLayer=function(c,b,d){d=d||{};return g._getExportData(b,{datas:d.datas,objectIds:d.objectIds,fromClient:d.fromClient,withGeometry:d.withGeometry,outFields:d.outFields,filterExpression:d.filterExpression,
outSpatialReference:d.outSpatialReference,arcadeExpressions:d.arcadeExpressions,geometry:d.geometry,orderByFields:d.orderByFields,start:d.start,num:d.num}).then(function(a){return g._formattedData(b,a,{formatNumber:d.formatNumber,formatDate:d.formatDate,formatCodedValue:d.formatCodedValue,richText:{clearFormat:d.richTextFieldsToClear&&!!d.richTextFieldsToClear.length,fieldsToClear:d.richTextFieldsToClear||[]},popupInfo:d.popupInfo}).then(function(a){return g.exportCSV(c,a.datas,a.columns)})})};g.exportCSVByAttributes=
function(c,b,d,a){a=e.mixin({},a);a.datas=d;return g.exportCSVFromFeatureLayer(c,b,a)};g.exportCSVByGraphics=function(c,b,d,a){d=u.map(d,function(a){return a.attributes});return g.exportCSVByAttributes(c,b,d,a)};g._createCSVStr=function(c,b){var d=new m,a="",f=0,e=0,g="",h="";try{b=u.map(b,function(a){return"string"===typeof a?{name:a}:a});u.forEach(b,function(b){b=b.alias||b.name;-1<b.toString().indexOf(",")&&(b='"'+b+'"');a=a+g+b;g=","});for(var a=a+"\r\n",f=c.length,e=b.length,p=0;p<f;p++){for(var g=
"",n=0;n<e;n++)(h=c[p][b[n].name])||"number"===typeof h||(h=""),h&&/[",\r\n]/g.test(h)&&(h='"'+h.replace(/(")/g,'""')+'"'),a=a+g+h,g=",";a+="\r\n"}d.resolve(a)}catch(E){console.error(E),d.resolve("")}return d};g._isIE11=function(){return 11===p.has("ie")};g._isEdge=function(){return p.has("edge")};g._getDownloadUrl=function(c){return window.Blob&&window.URL&&window.URL.createObjectURL?(c=new Blob(["\ufeff"+c],{type:"text/csv"}),URL.createObjectURL(c)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+
encodeURIComponent(c)};g._download=function(c,b){var d=new m;try{if(n("ie")&&10>n("ie")){var a=window.top.open("about:blank","_blank");a.document.write("sep\x3d,\r\n"+b);a.document.close();a.document.execCommand("SaveAs",!0,c);a.close()}else if(10===n("ie")||g._isIE11()||g._isEdge()){var f=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(f,c)}else{var e=t.create("a",{href:g._getDownloadUrl(b),target:"_blank",download:c},document.body);if(n("safari")){var h=document.createEvent("MouseEvents");
h.initEvent("click",!0,!0);e.dispatchEvent(h)}else e.click();t.destroy(e)}d.resolve()}catch(G){d.reject(G)}return d};g._getExportData=function(c,b){var f=new m,a=null,r=[],h=b.datas,p=b.withGeometry,n=!!b.arcadeExpressions,a=b.outFields;a&&a.length||(a=c.fields);a=e.clone(a);if(p&&!(h&&0<h.length)){n?(r=u.filter(c.fields,function(a){return-1===a.name.indexOf("expression/")}),r=e.clone(r)):r=e.clone(a);var t="",t=-1!==a.indexOf("x")?"_x":"x";a.push({name:t,alias:t,format:{digitSeparator:!1,places:6},
show:!0,type:"esriFieldTypeDouble"});t=-1!==a.indexOf("y")?"_y":"y";a.push({name:t,alias:t,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}h&&0<h.length?(n&&(h=g._getAttrsWithExpressionsBatch(h,b.arcadeExpressions)),f.resolve({data:h||[],outFields:a})):b.fromClient?(h=u.map(c.graphics,function(a){a=p?d(a):e.clone(a);return a=n?g._getAttrsWithExpressions(a,b.arcadeExpressions):a}),f.resolve({data:h||[],outFields:a})):g._getExportDataFromServer(c,r,b).then(function(c){n&&(c=
g._getAttrsWithExpressionsBatch(c,b.arcadeExpressions));f.resolve({data:c||[],outFields:a})});return f};g._getExportDataFromServer=function(c,b,e){var a=new m;if("esri.layers.FeatureLayer"!==c.declaredClass)return a.resolve([]),a;var f=new x(c.url),l=new v;l.where=e.filterExpression||c.getDefinitionExpression&&c.getDefinitionExpression()||"1\x3d1";0<b.length?(c=u.map(b,function(a){return a.name}),l.outFields=c):l.outFields=["*"];l.objectIds=e.objectIds;l.returnGeometry=e.withGeometry;l.outSR=e.spatialReference;
l.geometry=e.geometry;l.orderByFields=e.orderByFields;l.start=e.start;l.num=e.num;f.execute(l,function(b){b=u.map(b.features,function(a){return d(a)});a.resolve(b)},function(b){console.error(b);a.resolve([])});return a};g._formattedData=function(c,b,d){var a=new m,f=[],e=b.data;b=b.outFields;for(var l=0,h=e.length;l<h;l++){for(var p={},n=0;n<b.length;n++){var t=b[n];p[t.name]=g._getExportValue(e[l][t.name],t,c.objectIdField,c.typeIdField,e[l][c.typeIdField],c.types,d)}f.push(p)}c=u.map(b,function(a){return{alias:a.alias,
name:a.name}});a.resolve({datas:f,columns:c});return a};g._getExportValue=function(c,b,d,a,e,g,h){function f(a){if(r&&w.isDefined(r.fieldInfos))for(var b=0,c=r.fieldInfos.length;b<c;b++){var d=r.fieldInfos[b];if(d.fieldName===a)return d.format}return null}function l(a){for(var b=0,c=m.length;b<c;b++)if(m[b].fieldName===a)return!0;return!1}var r=h.popupInfo,m=h.richText.fieldsToClear,k=!!b.domain&&h.formatCodedValue,n="esriFieldTypeDate"===b.type&&h.formatDate,t=d&&b.name===d;a=a&&b.name===a;l="esriFieldTypeString"===
b.type&&h.richText.clearFormat&&l(b.name);return n?p.fieldFormatter.getFormattedDate(c,f(b.name)):a?p.fieldFormatter.getTypeName(c,g):k?p.fieldFormatter.getCodedValue(b.domain,c):l?c?(b=document.createElement("span"),b.innerHTML=c,b.textContent||b.innerText||""):c:k||n||t||a||l?c:(h=null,d&&g&&0<g.length&&(d=(d=u.filter(g,function(a){return a.id===e}))&&d[0])&&d.domains&&d.domains[b.name]&&d.domains[b.name].codedValues&&(h=p.fieldFormatter.getCodedValue(d.domains[b.name],c)),null!==h?h:c)};g._getAttrsWithExpressions=
function(d,b){var f=e.getObject("expressionInfos",!1,b);b=e.getObject("layerDefinition",!1,b);var a=new h(null,null,d);return c.customExpr.getAttributesFromCustomArcadeExpr(f,a,b)||d};g._getAttrsWithExpressionsBatch=function(c,b){var d=[];return d=u.map(c,function(a){return g._getAttrsWithExpressions(a,b)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),
function(g,e,u,t,n,m,p,w,x,v){var h={readExprInfo:{}};h.readExprInfo.getArcadeProfilesByType=function(c,d,f){c={map:c,layer:d};return"render"===f?h.readExprInfo._getArcadeRender(c):"label"===f?h.readExprInfo._getArcadeLabel(c):"infoTemplate"===f?h.readExprInfo._getArcadeInfoTemplate(c):h.readExprInfo._getAllArcade(c)};h.readExprInfo._getArcadeRender=function(c){return h.readExprInfo._lookupArcadeRender({layers:h.readExprInfo._checkPassInLayer(c)})};h.readExprInfo._getArcadeInfoTemplate=function(c){return h.readExprInfo._lookupArcadeInfoTemplate({layers:h.readExprInfo._checkPassInLayer(c)})};
h.readExprInfo._getArcadeLabel=function(c){return h.readExprInfo._lookupArcadeLabel({layers:h.readExprInfo._checkPassInLayer(c)})};h.readExprInfo._getAllArcade=function(c){var d=h.readExprInfo._getArcadeRender(c),f=h.readExprInfo._getArcadeInfoTemplate(c);c=h.readExprInfo._getArcadeLabel(c);return{render:d,infoTemplate:f,label:c}};h.readExprInfo._checkPassInLayer=function(c){var d=[];return d="undefined"!==typeof c?"undefined"!==typeof c.layer?null!==c.layer&&""!==c.layer?h.readExprInfo._getAllMapLayers(c):
h.readExprInfo._getAllMapLayers():h.readExprInfo._getAllMapLayers():h.readExprInfo._getAllMapLayers()};h.readExprInfo._getAllMapLayers=function(c){var d="",f=[],b=v.getInstance();c&&c.layer&&(d=c.layer.id);""!==d?(c=b.getNodeById(d))&&f.push(c._layerInfo.layerObject):b.traversal(function(b){"undefined"!==typeof b._layerInfo.layerObject.type?-1===b._layerInfo.layerObject.type.indexOf("tile")&&f.push(b._layerInfo.layerObject):f.push(b._layerInfo.layerObject)});return f};h.readExprInfo._lookupArcadeRender=
function(c){var d=[];0<c.layers.length&&g.forEach(c.layers,e.hitch(this,function(c){var b={};if("undefined"!==typeof c.renderer){var e=c.renderer;"undefined"!==typeof e.valueExpression&&(b.layer=c.id,b.valueExpression=e.valueExpression,b.valueExpressionTitle=e.valueExpressionTitle,"undefined"!==typeof e.values&&(b.values=e.values),"undefined"!==typeof e.visualVariables&&(b.visualVariables=e.visualVariables));1<Object.keys(b).length&&b.constructor===Object?d.push(b):d.push({layer:c.id,valueExpression:null,
valueExpressionTitle:null,values:null,visualVariables:null})}}));return d};h.readExprInfo._lookupArcadeInfoTemplate=function(c){var d=[];0<c.layers.length&&g.forEach(c.layers,e.hitch(this,function(c){var b={};if("undefined"!==typeof c.infoTemplate)"undefined"!==typeof c.infoTemplate.info.expressionInfos&&0<c.infoTemplate.info.expressionInfos.length&&(b.layer=c.id,b.expressionInfos=c.infoTemplate.info.expressionInfos);else if("undefined"!==typeof c.infoTemplates)for(var e in c.infoTemplates)if(c.infoTemplates.hasOwnProperty(e)&&
"undefined"!==typeof c.infoTemplates[e].infoTemplate.info.expressionInfos){var a=c.infoTemplates[e].infoTemplate;0<a.info.expressionInfos.length&&(b.layer=c.id,b.expressionInfos=a.info.expressionInfos)}1<Object.keys(b).length&&b.constructor===Object?d.push(b):d.push({layer:c.id,expressionInfos:null})}));return d};h.readExprInfo._lookupArcadeLabel=function(c){var d=[];0<c.layers.length&&g.forEach(c.layers,e.hitch(this,function(c){var b={};"undefined"!==typeof c.labelingInfo&&g.forEach(c.labelingInfo,
e.hitch(this,function(d){"undefined"!==typeof d.name&&(b.layer=c.id,b.name=d.name,b.labelingInfo=d,b.expression=d.labelExpressionInfo.expression)}));1<Object.keys(b).length&&b.constructor===Object?d.push(b):d.push({layer:c.id,name:null,labelingInfo:null,expression:null})}));return d};h.customExpr={};h.customExpr.getAttributesFromCustomArcadeExpr=function(c,d,e){c=h.InfoTemplate._parseArcadeExpressions(c);return h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(d,c,e)};h.customExpr.getAttributesValueFromCustomArcadeExprBatch=
function(c,d,e){var b=[],f;for(f in d)b.push(d[f]);d=h.InfoTemplate._parseArcadeExpressions(c);c=h.InfoTemplate._getExprNamesArrayFromPopupExprInfos(c);c.relationships=null;c.parsedExpressions=d;var a=new u;h.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(b,c,e).then(function(b){a.resolve(b)});return a};h.InfoTemplate={};h.InfoTemplate.getAttributesFromInfoTemplate=function(c,d,e){var b={fields:[]};d.layerObject&&d.layerObject.fields&&(b.fields=d.layerObject.fields);c=h.readExprInfo.getArcadeProfilesByType(c,
d,"infoTemplate")[0].expressionInfos;if(!c)return e.attributes;c=h.InfoTemplate._parseArcadeExpressions(c);return h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(e,c,b)};h.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(c,d,e){var b={fields:[]};d.layerObject&&d.layerObject.fields&&(b.fields=d.layerObject.fields);var f=[],a;for(a in e)f.push(e[a]);c=h.readExprInfo.getArcadeProfilesByType(c,d,"infoTemplate")[0].expressionInfos;var g=new u;if(!c)return g.resolve([]),g;
e=h.InfoTemplate._parseArcadeExpressions(c);a=null;a=d.getPopupInfo().description;null!==a?(a=h.InfoTemplate._convertPopupDescToFieldNamesArray(a),a.relationships=h.InfoTemplate._getRelationshipQueries(d)):(a=h.InfoTemplate._getExprNamesArrayFromPopupExprInfos(c),a.relationships=null);a.parsedExpressions=e;h.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(f,a,b).then(function(a){g.resolve(a)});return g};h.InfoTemplate._getRelationshipQueries=function(c){var d=!1,e={},b=/\d+/,h;if(h=c.getPopupInfo().description.match(/\{relationships\/\d+\//gm))d=
!0,g.forEach(h,function(a){var d=a.match(b)[0];e.hasOwnProperty(d)||(a=new w,a.outFields=["*"],a.relationshipId=d,a.returnGeometry=!1,e[d]={operLayer:c,relatedQuery:a})});return d?e:null};h.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(c){var d=[],e;for(e in c)d.push("${expression/"+c[e].name+"}");return d};h.InfoTemplate._convertPopupDescToFieldNamesArray=function(c){c=h.InfoTemplate._convertEndParasToEOLs(c);c=h.InfoTemplate._convertBreaksToEOLs(c);c=h.InfoTemplate._sanitizeNoTags(c).trim();
c=c.replace(/\{/gi,"${");c=c.replace(/\u00a0/gi," ");c=c.split("\n");return c=g.map(c,function(c){return c.trim()})};h.InfoTemplate._sanitizeNoTags=function(c){var d;d=x.sanitizeHTML(c);c=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var e;do e=d,d=d.replace(c,"");while(d!==e);return d=d.replace(/</g,"\x26lt;")};h.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=
function(c,d,e){var b=new u,f=[],a=[],r=0;d.relationships?(g.forEach(c,function(b){h.InfoTemplate._objEach(d.relationships,function(c,f){var r=new u,l=c.relatedQuery,p;a.push(r);p=b.attributes[c.operLayer.layerObject.objectIdField];l.objectIds=[p];c.operLayer.layerObject.queryRelatedFeatures(l,function(a){var c=[];a[p]&&a[p].features&&(a=a[p].features,g.forEach(a,function(a){var k=[],r,l,p;r=b.attributes;l="relationships/"+f+"/";h.InfoTemplate._objEach(a.attributes,function(a,b){p=l+b;r[p]=a});g.forEach(d,
function(a){k.push(n.substitute(a,h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,d.parsedExpressions,e),h.InfoTemplate._useEmptyStringForNull))});c.push(k)}));r.resolve(c)})})}),t(a).then(function(a){g.forEach(a,function(a){g.forEach(a,function(a){++r;f.push(a)})});console.log(r+" related address features found");b.resolve(f)})):(g.forEach(c,function(a){var b=[];g.forEach(d,function(c){b.push(n.substitute(c,h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,d.parsedExpressions,
e),h.InfoTemplate._useEmptyStringForNull))});f.push(b)}),b.resolve(f));return b};h.InfoTemplate._parseArcadeExpressions=function(c){var d;Array.isArray(c)&&0<c.length&&(d={},g.forEach(c,function(c){d[c.name]=m.parseScript(c.expression)}));return d};h.InfoTemplate._initArcadeContext=function(c,d){var e={vars:{}};e.vars.$feature=p.createFromGraphicLikeObject(c.geometry,c.attributes,d);return e};h.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(c,d,f){var b,g;b=e.mixin({},c.attributes);
if(d)for(g in c=h.InfoTemplate._initArcadeContext(c,f),d)f=m.executeScript(d[g],c),b["expression/"+g]=f?f.toString():"";return b};h.InfoTemplate._convertEndParasToEOLs=function(c){var d=c;c=c.match(/<\/p>/gi);g.forEach(c,function(c){d=d.replace(c,"\n")});return d};h.InfoTemplate._convertBreaksToEOLs=function(c){var d=c;c=c.match(/<br\s*\/?>/gi);g.forEach(c,function(c){d=d.replace(c,"\n")});return d};h.InfoTemplate._useEmptyStringForNull=function(c){return c?c:""};h.InfoTemplate._objEach=function(c,
d,e){for(var b in c)c.hasOwnProperty(b)&&d.call(e,c[b],b)};return h})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic dojo/i18n!./nls/strings".split(" "),function(g,e,u,t,n,m,p,w,x,v,h,c,d,f,b){function l(a,b){if(!a||!a.length)return b||[];if(!b||!b.length)return a;
for(var c=[],d=0,e=a.length;d<e;d++)for(var f=a[d],g=0,h=b.length;g<h;g++){var k=b[g];if(k.name===f.name){k.alias!==f.alias&&(f.alias=k.alias);c.push(f);break}}return c}m.readLayerInfosObj=function(a){return u.getInstance(a,a.itemInfo)};m.readLayerInfosFromMap=function(a,b,c){var d=new t;u.getInstance(a,a.itemInfo).then(g.hitch(this,function(a){var f=[];b?a.traversalLayerInfosOfWebmap(function(a){f.push(a)}):a.traversal(function(a){f.push(a)});if(c){var g=[],h=a.getMapNotesLayerInfoArray();e.forEach(h,
function(a){g.push(a.id);a.traversal(function(a){g.push(a.id)})});f=e.filter(f,function(a){return-1===g.indexOf(a.id)})}a=a.getTableInfoArray();f=f.concat(a);d.resolve(f)}),g.hitch(this,function(a){console.error(a);d.reject(a)}));return d.promise};m.generateColumnsFromFields=function(a,c,f,h,l,p,n,u){function k(a){if(r&&v.isDefined(r.fieldInfos))for(var b=0,c=r.fieldInfos.length;b<c;b++){var d=r.fieldInfos[b];if(d.fieldName===a)return d.format}return null}var r=c.getPopupInfo(),t={selectionHandle:{label:"",
className:"selection-handle-column",hidden:!1,unhidable:!0,field:null,sortable:!1,_cache:{sortable:!1,statistics:!1},renderCell:function(a,c,d){d.setAttribute("role","button");d.setAttribute("title",b.selectionHandleLabel)}}};e.forEach(f,g.hitch(m,function(b,f,r){f="field"+f;var C=!!b.domain,w="esriFieldTypeDate"===b.type,F=h&&b.name===h,x="esriFieldTypeDouble"===b.type||"esriFieldTypeSingle"===b.type||"esriFieldTypeInteger"===b.type||"esriFieldTypeSmallInteger"===b.type,y="esriFieldTypeString"===
b.type,H=0===b.name.indexOf("expression/"),q=b.alias||b.name,B;B=1===r.length?!1:a&&a[f]?a[f].hidden:b?!b.show&&v.isDefined(b.show):!1;t[f]={label:q,className:f,hidden:B,unhidable:1===r.length?!1:!b.show&&v.isDefined(b.show)&&b._pk,field:b.name,sortable:!1,_cache:{sortable:!!p,statistics:n&&!C&&x}};y?t[f].formatter=g.hitch(m,m.urlFormatter):w?t[f].formatter=g.hitch(m,m.dateFormatter,k(b.name)):x&&(t[f].formatter=g.hitch(m,m.numberFormatter,k(b.name)));C?t[f].get=g.hitch(m,function(a,b,c){return this.getCodeValue(a,
b.name,c)},u,b):F?t[f].get=g.hitch(m,function(a,b,c){return this.getTypeName(c[a.name],b)},b,l):H?(r=this.arcade.getExpressionInfosFromLayerInfo(c),C=d.getFeatureLayerDefinition(u),t[f]._cache.sortable=!1,t[f].get=g.hitch(m,function(a,b,c,d){return this.arcade.getAttributes(d,a,c)[b.name]||""},r,b,C)):C||w||F||H||(t[f].get=g.hitch(m,function(a,b,c,d,f){var k=null;c&&d&&0<d.length&&(d=(d=e.filter(d,g.hitch(m,function(a){return a.id===f[c]})))&&d[0]||null)&&d.domains&&d.domains[b.name]&&d.domains[b.name].codedValues&&
(k=this.getCodeValue(a,b.name,f));return(a=null!==k?k:f[b.name])||isFinite(a)?a:""},u,b,h,l))}));return t};m.getTypeName=function(a,b){return d.fieldFormatter.getTypeName(a,b)};m.getCodeValue=function(a,b,c){return(a=d.getDisplayValueForCodedValueOrSubtype(a,b,c))&&a.isCodedValueOrSubtype?a.displayValue||"":""};m.urlFormatter=function(a){return d.fieldFormatter.getFormattedUrl(a)};m.dateFormatter=function(a,b){return d.fieldFormatter.getFormattedDate(b,a)};m.numberFormatter=function(a,b){return d.fieldFormatter.getFormattedNumber(b,
a)};m.readLayerObjectsFromMap=function(a,b,c){var d=new t,f=[];this.readLayerInfosFromMap(a,b,c).then(g.hitch(this,function(a){e.forEach(a,g.hitch(this,function(a){f.push(a.getLayerObject())}));n(f).then(g.hitch(this,function(a){d.resolve(a)}),g.hitch(this,function(a){d.reject(a);console.error(a)}))}),g.hitch(this,function(a){d.reject(a)}));return d.promise};m.readSupportTableInfoFromLayerInfos=function(a){var b=new t,c=[];e.forEach(a,g.hitch(this,function(a){c.push(a.getSupportTableInfo())}));n(c).then(g.hitch(this,
function(c){c=g.clone(c);e.forEach(c,function(b,c){b.id=a[c].id});b.resolve(c)}),function(a){b.reject(a)});return b.promise};m.readConfigLayerInfosFromMap=function(a,b,c){var d=new t,f=[];this.readLayerInfosFromMap(a,b,c).then(g.hitch(this,function(a){var b=[];e.forEach(a,function(a){f.push(a.getSupportTableInfo())});n(f).then(g.hitch(this,function(c){e.forEach(c,g.hitch(this,function(c,d){c.isSupportedLayer&&(a[d].name=a[d].title,b.push(a[d]))}));d.resolve(b)}),g.hitch(this,function(a){d.reject(a)}))}),
g.hitch(this,function(a){d.reject(a)}));return d.promise};m.getConfigInfosFromLayerInfos=function(a){return e.map(a,function(a){return m.getConfigInfoFromLayerInfo(a)})};m.getConfigInfoFromLayerInfo=function(a){var b={};b.name=a.name||a.title;b.id=a.id;b.show=a.isShowInMap();b.layer={url:a.getUrl()};var c=a.getPopupInfo();c&&!c.description&&(b.layer.fields=e.map(c.fieldInfos,function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),a=g.getObject("layerObject.fields",!1,a),
b.layer.fields=l(b.layer.fields,a),e.some(b.layer.fields,function(a){return a.show})||(b.layer.fields&&0<b.layer.fields.length?b.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return b};m.generateCacheStore=function(a,b,c,d,e){a=new h({layer:a,objectIds:a._objectIds||null,totalCount:b,batchCount:c,where:d||"1\x3d1",spatialFilter:e});b=new x;return new w(a,b,{})};m.generateMemoryStore=function(a,b){return new p(new x({data:a||[],idProperty:b}))};m.merge=function(a,b,c,d){for(var f=
e.map(b,function(a){return a[c]}),g=0,h=a.length;g<h;g++){var l=f.indexOf(a[g][c]);-1<l&&d(a[g],b[l])}};m.syncOrderWith=function(a,b,c){function d(a,b){return e.map(a,function(a){return a[b]})}if(!g.isArray(b)||!c)return a;for(var f=d(a,c),h=[],l=0,p=b.length;l<p;l++){var k=f.indexOf(b[l][c]);-1<k&&(h=h.concat(a.splice(k,1)),f=d(a,c))}return h.concat(a)};m.arcade={};m.arcade.getExpressionInfosFromLayer=function(a,b){a=c.readExprInfo.getArcadeProfilesByType(a,b,"infoTemplate");return 0<a.length&&a[0].expressionInfos?
a[0].expressionInfos:[]};m.arcade.getExpressionInfosFromLayerInfo=function(a){return(a=a&&a.getPopupInfo())&&a.expressionInfos||[]};m.arcade.getAttributes=function(a,b,d){var e=new f(a.geometry,null,a);return c.customExpr.getAttributesFromCustomArcadeExpr(b,e,d)||a};m.arcade.appendArcadeExpressionsToFields=function(a,b){if(a){b=m.arcade.getExpressionInfosFromLayerInfo(b);if(0<b.length){var c=/^expression\//;e.forEach(b,function(b){e.some(a,function(a){if(c.test(a.name))return a=a.name.substr(11),
b.name===a})||a.push({name:"expression/"+b.name,alias:b.title,show:!0})})}return a}};m.arcade.isArcadeExpressionField=function(a){return a&&"string"===typeof a.name&&0===a.name.indexOf("expression/")};m.arcade.parseArcadeExpressions=function(a){return c.InfoTemplate._parseArcadeExpressions(a)};m.getSortbyFields=function(a,b){a=a&&a.get("sort")||[];b=b&&b.objectIdField;0<a.length?a=e.map(a,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}):b&&a.push(b+" ASC");return a}})},"dojo/store/Cache":function(){define(["../_base/lang",
"../when"],function(g,e){var u=function(t,n,m){m=m||{};return g.delegate(t,{query:function(e,g){e=t.query(e,g);e.forEach(function(e){m.isLoaded&&!m.isLoaded(e)||n.put(e)});return e},queryEngine:t.queryEngine||n.queryEngine,get:function(g,m){return e(n.get(g),function(p){return p||e(t.get(g,m),function(e){e&&n.put(e,{id:g});return e})})},add:function(g,m){return e(t.add(g,m),function(e){n.add(e&&"object"==typeof e?e:g,m);return e})},put:function(g,m){n.remove(m&&m.id||this.getIdentity(g));return e(t.put(g,
m),function(e){n.put(e&&"object"==typeof e?e:g,m);return e})},remove:function(g,m){return e(t.remove(g,m),function(e){return n.remove(g,m)})},evict:function(e){return n.remove(e)}})};g.setObject("dojo.store.Cache",u);return u})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(g,e,u,t,n,m){return g(null,{queryUrl:"",idProperty:"id",data:null,
_entityData:null,constructor:function(e){g.safeMixin(this,e);this.data=[];this._entityData=[];this.layer=e.layer;this.objectIds=e.objectIds;this.where=e.where;this.orderByFields=e.orderByFields;this.totalCount=e.totalCount;this.batchCount=e.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=e.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new n(this.layer.url))},get:function(e){return this.data[e]},getIdentity:function(e){return e[this.idProperty]},query:function(g,
n){var p=new t,v=n&&n.start||0,h=n._export_count||this.batchCount,c=null;"function"===typeof g?c=g(this._entityData):"[object Array]"===Object.prototype.toString.call(g)&&(c=g);this.objectIds?(c=c?c:this.objectIds,p.objectIds=c.length>=v+this.batchCount?c.slice(v,v+h):c.slice(v)):(c&&0<c.length?p.objectIds=c.length>=v+this.batchCount?c.slice(v,v+h):c.slice(v):(p.start=v,p.num=h,p.where=this.where,p.geometry=this.spatialFilter,p.spatialRelationship=t.SPATIAL_REL_INTERSECTS),(g=n.sort)&&0<g.length&&
(g=u.map(g,function(c){return c.attribute+" "+(c.descending?"DESC":"ASC")}),p.orderByFields=g));p.returnGeometry="esriGeometryPoint"===this.layer.geometryType;p.outFields=["*"];var d=this.totalCount;g=null;g=!p.where;if(!(p.objectIds&&0<p.objectIds.length)&&g)return new m([]);g=this.queryTask?this.queryTask.execute(p):this.layer.queryFeatures(p);g.total=g.then(e.hitch(this,function(c){var b=0,f=this.layer.objectIdField;if(this.objectIds){if(!f)for(b=0;b<c.fields.length;b++)if("esriFieldTypeOID"===
c.fields[b].type){f=c.fields[b].name;break}for(var a={},b=0;b<c.features.length;b++)a[c.features[b].attributes[f]]=c.features[b];c.features=u.map(p.objectIds,function(b){return a[b]})}for(b=0;b<c.features.length;b++)if(c.features[b]){var g=c.features[b];c.features[b]=e.mixin(e.clone(g.attributes),{geometry:g.geometry});this.data[c.features[b][f]]=c.features[b];this._entityData.push(c.features[b])}c=c.features;return d}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});
return new m(g)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(g,e,u,t){var n=function(m){function p(e){m[e]||(m[e]=function(){var g=arguments;return t.when(m,function(m){Array.prototype.unshift.call(g,m.features||m);return n(u[e].apply(u,g))})})}if(!m)return m;m.then&&(m=e.delegate(m));m.total||(m.total=t.when(m,function(e){return g._isDefined(e.total)?
e.total:e.length||0}));p("forEach");p("filter");p("map");p("some");p("every");return m};return n})},"widgets/AttributeTable/a11y/WidgetMixin":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/on dojo/aspect dojo/keys dijit/focus dojo/topic jimu/utils jimu/LayoutManager".split(" "),function(g,e,u,t,n,m,p,w,x,v,h){return g(null,{_layoutManager:null,_focusedTab:null,focusToDisplay:!1,hasBeenActivated:!1,postCreate:function(){this.inherited(arguments);this._layoutManager=
h.getInstance();this.focusToDisplay=!0;this.hasBeenActivated=this.config.initiallyExpand;this.own(n(this.domNode,"keydown",u.hitch(this,function(c){t.hasClass(c.target,this.baseClass)&&c.keyCode===p.ENTER&&(this.focusToDisplay=!1,this.hasBeenActivated=!0,this.showing||(this.widgetManager.activateWidget(this),this._switchTable()))})));this.own(n(this.domNode,"focus",u.hitch(this,function(){v.isInNavMode()&&this.focusToDisplay&&!this.showing&&(this.widgetManager.activateWidget(this),this._switchTable())})));
this.own(n(this.domNode,"blur",u.hitch(this,function(){v.isInNavMode()&&this.focusToDisplay&&this.showing&&(this.hasBeenActivated||this._switchTable());this.focusToDisplay=!0;this.showing||(this.hasBeenActivated=!1)})));this.own(x.subscribe(this.id+"_table_created",u.hitch(this,function(c){this._applyA11y2Grid(c&&c.grid,c&&c.context)})),x.subscribe(this.id+"_toolbar_created",u.hitch(this,function(c){this._applyA11y2Toolbar(c&&c.toolbar,c&&c.context)})))},applyA11y:function(){this._isOnlyTable()&&
t.removeAttr(this.domNode,"tabindex");this.switchBtn&&this.own(n(this.switchBtn,"keydown",u.hitch(this,function(c){c.keyCode===p.ENTER&&(this._switchTable(),this.focusToDisplay=this.showing,this.__focus2WidgetNode())})));this.tabContainer&&this.tabContainer.hasChildren()?this._applyA11y2TabContainer(this.tabContainer):this.NoTableMessageDiv&&(t.setAttr(this.NoTableMessageDiv,{tabindex:"0"}),v.initFirstFocusNode(this.domNode,this.NoTableMessageDiv),v.initLastFocusNode(this.domNode,this.NoTableMessageDiv),
this.own(n(this.NoTableMessageDiv,"keydown",u.hitch(this,function(c){c.keyCode===p.ESCAPE&&this.__escape2WidgetSwitch(c)}))),this._isOnlyTable()&&w.focus(this.NoTableMessageDiv))},_applyA11y2TabContainer:function(c){if(c){var d=this,f=function(a){a&&(e.forEach(c.tablist.getChildren(),function(b){!b.active&&b.closeButton&&b.id!==a.id&&t.setAttr(b.closeNode,"tabindex",-1)}),t.setAttr(a.closeNode,"tabindex",0))},b=c.tablist.onkeydown;c.tablist.onkeydown=function(a,c){var f=null,g=!1;switch(a.keyCode){case p.LEFT_ARROW:case p.UP_ARROW:a._djpage||
(f=!1);break;case p.PAGE_UP:a.ctrlKey&&(f=!1);break;case p.RIGHT_ARROW:case p.DOWN_ARROW:a._djpage||(f=!0);break;case p.PAGE_DOWN:a.ctrlKey&&(f=!0);break;case p.HOME:for(var h=this.getChildren(),l=0;l<h.length;l++){var m=h[l];if(!m.disabled){w.focus(m.focusNode);d._focusedTab=m;break}}a.stopPropagation();a.preventDefault();break;case p.END:h=this.getChildren();for(l=h.length-1;0<=l;l--)if(m=h[l],!m.disabled){w.focus(m.focusNode);d._focusedTab=m;break}a.stopPropagation();a.preventDefault();break;case p.DELETE:case 87:this._currentChild.closable&&
(a.keyCode==p.DELETE||a.ctrlKey)&&(a.stopPropagation(),a.preventDefault());break;case p.ENTER:case p.SPACE:d.tabForwardStep=0;break;case p.ESCAPE:"Close"===a.target.title?d._focusedTab&&w.focus(d._focusedTab.focusNode):d.__escape2WidgetSwitch(a);a.stopPropagation();a.preventDefault();break;case p.TAB:if(d.isLoading()){a.stopPropagation();a.preventDefault();return}break;default:g=!0}if(null!==f){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(f=!f);var h=this.getChildren(),
l=e.indexOf(h,this.pane2button(d._focusedTab?d._focusedTab.page&&d._focusedTab.page.id:this._currentChild.id)),m=h[l],n;do l=(l+(f?1:h.length-1))%h.length,n=h[l];while(n.disabled&&n!==m);d._focusedTab=n;w.focus(d._focusedTab.focusNode);a.stopPropagation();a.preventDefault()}g&&b.apply(this,arguments)};if(c.hasChildren()){e.forEach(c.getChildren(),u.hitch(this,function(a){a.controlButton.checked||t.setAttr(a.controlButton.focusNode,"aria-selected","false");a.closable&&t.setAttr(a.controlButton.closeNode,
"role","button")}));var g=c.tablist.getChildren()[0];this._focusedTab=g;v.initFirstFocusNode(this.domNode,g.focusNode);g.closeNode&&f(g);!this._isOnlyTable()||"LaunchpadTheme"!==this.appConfig.theme.name&&"BillboardTheme"!==this.appConfig.theme.name||w.focus(g)}this.own(m.after(c,"selectChild",function(){var a=u.getObject("controlButton",!1,this.selectedChildWidget);a&&(v.initFirstFocusNode(d.domNode,a.focusNode),a.closeNode&&f(a));d._focusedTab=a}),n(c.tablist,"blur",u.hitch(this,function(){this._focusedTab=
null})))}},_applyA11y2Toolbar:function(c,d){c&&(u.mixin(c,{_onLeftArrow:function(){},_onRightArrow:function(){}}),this.own(n(c,"keydown",u.hitch(this,function(d){if(d.keyCode===p.TAB){if(d.shiftKey){if(d.target.id===c._getFirstFocusableChild().id)return}else if(d.target.id===c._getLastFocusableChild().id)return;d.shiftKey?c.focusPrev():c.focusNext();d.stopPropagation();d.preventDefault()}else d.keyCode===p.ESCAPE&&this.__escape2ActiveTab(d)}))),d&&d.toggleColumnsMenuItem&&this.own(n(d.toggleColumnsMenuItem,
"click",u.hitch(this,function(c){v.isInNavMode()&&this.__applyA11y2GridHiderMenu(this._activeTable&&this._activeTable.grid)}))))},_applyA11y2Grid:function(c,d){if(c&&c.hiderToggleNode&&c.hiderMenuNode){var e=c.hiderToggleNode,b=c.hiderMenuNode;v.initLastFocusNode(this.domNode,e);c._customEvtHandlersInitialized||(this.own(n(c,"keydown",u.hitch(this,function(b){b.keyCode===p.ESCAPE&&this.__escape2ActiveTab(b)})),n(e,"keydown",u.hitch(this,function(b){if(b.keyCode===p.SPACE||b.keyCode===p.ENTER)c._toggleColumnHiderMenu(),
this.__applyA11y2GridHiderMenu(c),b.stopPropagation(),b.preventDefault()})),n(b,"keydown",u.hitch(this,function(b){b.keyCode===p.ESCAPE&&(e.focus(),c._hiderMenuOpened&&c._toggleColumnHiderMenu(b),b.stopPropagation(),b.preventDefault())}))),c._customEvtHandlersInitialized=!0);this._focusedTab&&this._focusedTab.checked&&d&&t.setAttr(this._focusedTab.focusNode,"aria-labelledby",this._focusedTab.focusNode.id+" "+this.id+"_"+d.id+"_footer")}},__escape2WidgetSwitch:function(c){this.switchBtn?this.switchBtn.focus():
v.isDomFocusable(this.domNode)?this.__focus2WidgetNode():this._controllerDiv&&this._controllerDiv.focus();if(this.closeable&&this._isOnlyTable()&&this.widgetManager){var d;e.some(this._layoutManager&&this._layoutManager.layoutManager&&this._layoutManager.layoutManager.onScreenWidgetIcons,u.hitch(this,function(c){if(c&&c.widgetConfig&&c.widgetConfig.id===this.id)return d=c,!0}));d?d.domNode.focus():this.widgetManager.closeWidget(this)}c&&(c.stopPropagation(),c.preventDefault())},__focus2WidgetNode:function(){this.domNode.focus()},
__escape2ActiveTab:function(c){v.focusFirstFocusNode(this.domNode);c&&(c.stopPropagation(),c.preventDefault())},__applyA11y2GridHiderMenu:function(c){if(c&&c._hiderMenuOpened&&(c=c.hiderMenuNode,c.children&&0<c.children.length)){var d=c.children[0],e=c.children[c.children.length-1],b=d.querySelector("input");v.initFirstFocusNode(c,d.querySelector("input"));v.initLastFocusNode(c,e.querySelector("input"));b&&b.focus()}}})})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css",
"dojo/i18n!./nls/strings"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; right: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.has-webkit.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {left: 6px;}.dj_edge.jimu-rtl .jimu-widget-attributetable .dgrid-header-row {left: 16px; right: 0;}.dj_edge.jimu-rtl .dgrid-header-scroll,.dj_edge.jimu-rtl .dgrid-hider-toggle {right: auto; left: 0;}.dj_edge.jimu-rtl .dgrid-hider-menu {left: 17px; right: auto;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-header.dgrid-scrollbar-width {min-width: 16px;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-right-color: transparent;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child .dgrid-resize-handle {display: none;}.jimu-rtl .jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-left-color: transparent;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 4px; background: white; width: 100%;}.widget-at-filter-popup .content-absolute{left: 0; right: 0;}.jimu-widget-attributetable-feature-table-popup p {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup strong {font-family: "Avenir Medium";}.jimu-widget-attributetable-feature-table-popup mark {display: inline-block; color: #596679; background: #f1f1f1; border-bottom: 1px solid #ddd; margin: 5px; padding: 5px; font-size: 12px;}.jimu-widget-attributetable-feature-table-popup pre {padding: 5px; white-space: normal; font-size: 13px; color: #595959; background-color: #f8f8f8; border: 1px solid #efefef; margin: 10px 0 15px;}.jimu-widget-attributetable-feature-table-popup .tags {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup .example-block {margin-top: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row {margin: 20px auto; color: #596679;}.jimu-widget-attributetable-feature-table-popup .input-row \x3e * {vertical-align: top;}.jimu-widget-attributetable-feature-table-popup .input-row a {color: #485566; cursor: pointer; line-height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-attributetable-feature-table-popup .input-row a {margin-left: auto; margin-right: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button {font-size: 12px; color: #999;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button:hover {color: #595959;}.jimu-widget-attributetable-feature-table-popup.is-loading \x3e *:not(.jimu-loading-indicator) {opacity: .35;}.jimu-widget-attributetable-notable {color: #999; line-height: 1.5; position: absolute; top: 50%; left: 50%; text-align: center; max-width: 400px; transform: translate(-50%, -50%);}.jimu-widget-attributetable-notable.hidden {display: none;}.closed .jimu-widget-attributetable-notable {display: none;}.sr-only {position: absolute; width: 1px; height: 1px; padding: 0; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;}',
"*now":function(g){g(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils ./a11y/WidgetMixin".split(" "),function(g,e,u,t,n,m,p,w,x,v,h,c,d,f,b,l,a,r,y,B,G,L,D,E){g=g([t,u,E],{name:"AttributeTable",
baseClass:"jimu-widget-attributetable",normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);e.setAttr(this.domNode,"aria-label",this.nls._widgetLabel);p.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.NoTableMessageDiv=this.AttributeTableDiv=
this._loadInfoDef=null;this._delayedLayerInfos=[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=G.getInstance();this._createUtilitiesUI();this._resourceManager=new L({map:this.map,nls:this.nls,
parent:this});this._resourceManager.setConfig(this.config);this.own(l.subscribe("changeMapPosition",d.hitch(this,this._onMapPositionChange)));D.readLayerInfosObj(this.map).then(d.hitch(this,function(a){this.domNode&&a&&(this.own(f(a,"layerInfosIsShowInMapChanged",d.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(a.on("layerInfosChanged",d.hitch(this,this.onLayerInfosChanged))),this.own(a.on("layerInfosFilterChanged",d.hitch(this,this.onLayerInfosFilterChanged))))}))},_createUtilitiesUI:function(){this._createSwitchUI();
this._createBarUI()},_createBarUI:function(){this.arrowDiv=e.create("div");e.addClass(this.arrowDiv,"jimu-widget-attributetable-move");e.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);e.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var a=e.getMarginBox(this.arrowDiv);this.arrowDivHeight=a&&a.h?a.h:7}this.own(f(this.arrowDiv,"mousedown",d.hitch(this,this._onDragStart)));this.own(f(this.arrowDiv,b.press,d.hitch(this,this._onDragStart)))},_isOnlyTable:function(){return this.closeable||
!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||(this.switchBtn=e.create("div",{className:"jimu-widget-attributetable-switch",tabindex:"0",role:"button"},this.domNode),this.own(f(this.switchBtn,"click",d.hitch(this,function(){this._switchTable();this.hasBeenActivated=this.showing;this.focusToDisplay=!this.showing}))))},_processOpenBarUI:function(){this._isOnlyTable()||(e.removeClass(this.switchBtn,"close"),e.addClass(this.switchBtn,"open"),e.setAttr(this.switchBtn,"title",this.nls.closeTableTip),
e.setAttr(this.switchBtn,"aria-label",this.nls.closeTableTip))},_processCloseBarUI:function(){this._isOnlyTable()||(e.removeClass(this.switchBtn,"open"),e.addClass(this.switchBtn,"close"),e.setAttr(this.switchBtn,"title",this.nls.openTableTip),e.setAttr(this.switchBtn,"aria-label",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():this._openTable()},_openTable:function(){e.removeClass(this.domNode,"closed");this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&
(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&this._activeTable.active()):(this._loadInfoDef=new x,this.own(this._loadInfoDef),this.loading||(this.loading=new B),this.loading.placeAt(this.domNode),this._toggleLoading(!0),this._resourceManager.updateLayerInfoResources(!0).then(d.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),d.hitch(this,function(a){console.error(a);this._loadInfoDef.reject(a)})));this._changeHeight(this.openHeight);
this._processOpenBarUI();return this._loadInfoDef},_onCloseBtnClicked:function(){this.showing&&this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){e.addClass(this.domNode,"closed");this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();this.showing=!1;e.setStyle(this.arrowDiv,"display","none");e.setStyle(this.domNode,"overflow",
"hidden");setTimeout(d.hitch(this,function(){this.domNode&&(e.setStyle(this.domNode,"overflow","visible"),e.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(f(window.document,"mouseup",d.hitch(this,this._onDragEnd)));this.own(f(window.document,"mousemove",d.hitch(this,this._onDraging)));this.own(f(window.document,b.move,d.hitch(this,this._onDraging)));this.own(f(window.document,b.release,d.hitch(this,this._onDragEnd)))},
_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(r.forEach(this._delayedLayerInfos,d.hitch(this,function(a){this._resourceManager.addLayerInfo(a)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(a){this._activeTable&&this._activeTable.changeToolbarStatus();this.config.syncWithLayers&&r.forEach(a,d.hitch(this,function(a){if(!a.getSubLayers().length){var b=a.isShowInMap(),c=D.getConfigInfoFromLayerInfo(a),e=this.getExistLayerTabPage(c.id);if(b)if(e)e.closable&&
e.set("closable",!1);else{var f=this._resourceManager.getVisivleLayerInfoIndexById(a.id),b=this._resourceManager.getLayerInfoById(a.id),k={layer:a,closeable:!1,isActive:!1,index:f};b?this._addLayerToTable(k):this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){f=this._resourceManager.getVisivleLayerInfoIndexById(a.id);k.index=f;this._addLayerToTable(k)}))}else e&&this.layerTabPageClose(c.id,!0)}}))},onLayerInfosChanged:function(a,b,c){c&&a&&("added"===b?c.getSupportTableInfo().then(d.hitch(this,
function(a){a.isSupportedLayer&&this._resourceManager.addLayerInfo(c)})):"removed"===b&&(a=c.id,this.getExistLayerTabPage(a)&&this.layerTabPageClose(a,!0),this._resourceManager.getLayerInfoById(a)&&this._resourceManager.removeLayerInfo(a),this._resourceManager.getConfigInfoById(a)&&this._resourceManager.removeConfigInfo(a)))},onLayerInfosFilterChanged:function(a){r.some(a,d.hitch(this,function(a){if(this._activeTable&&a.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),
!0}))},destroy:function(){if(!this._destroyed){var a,b;if(this.layerTabPages&&0<this.layerTabPages.length){a=this.layerTabPages.length;for(b=0;b<a;b++){var e=this.layerTabPages[b].paneId,f=d.getObject("_resourceManager.featureTableSet."+e,!1,this);f&&(f=f.getFilterObj())&&c.isDefined(f.expr)&&this.filterManager.applyWidgetFilter(e,this.id,"");this.layerTabPages[b].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=
this.AttributeTableDiv=null;this._resourceManager&&this._resourceManager.empty();this.inherited(arguments)}},onOpen:function(){!this.showing&&this._isOnlyTable()&&(this._openTable(),this.hasBeenActivated=!0)},onClose:function(){this.showing&&(this._closeTable(),this.hasBeenActivated=!1)},_changeHeight:function(a){e.setStyle(this.domNode,"height",a+"px");this.tabContainer&&this.tabContainer.domNode&&0<=a-this.arrowDivHeight&&e.setStyle(this.tabContainer.domNode,"height",a-this.arrowDivHeight+"px");
this._activeTable&&this._activeTable.changeHeight(a-this.noGridHeight);l.publish("changeMapPosition",{bottom:a+this.bottomPosition});this.publishData({changeMapPosition:{bottom:a+this.bottomPosition}});0!==a&&(this.openHeight=a>=this.arrowDivHeight?a:this.normalHeight)},_onMapPositionChange:function(a){isFinite(a.left)&&"number"===typeof a.left&&(window.isRTL?e.setStyle(this.domNode,"right",parseFloat(a.left)+"px"):e.setStyle(this.domNode,"left",parseFloat(a.left)+"px"));isFinite(a.right)&&"number"===
typeof a.right&&(window.isRTL?e.setStyle(this.domNode,"left",parseFloat(a.right)+"px"):e.setStyle(this.domNode,"right",parseFloat(a.right)+"px"));this.tabContainer&&this.tabContainer.resize()},setPosition:function(a){this.position=a;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in a?parseInt(a.bottom,10):0;this.domNode.parentNode&&this.domNode.parentNode.id===window.jimuConfig.layoutId||(e.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(a),this.showRefreshing(!1));
e.setStyle(this.domNode,"bottom",this.bottomPosition+"px");this._resourceManager.isEmpty()||setTimeout(d.hitch(this,function(){var a=this._getGridTopSectionHeight(),b=e.getStyle(this.domNode,"height");0<a&&(this.noGridHeight=a);0<b&&this._changeHeight(b)}),20)},_startQueryOnLayerTab:function(a,b){var c=this._resourceManager.getLayerInfoById(a),f=this.getExistLayerTabPage(a);c&&f&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(a,this.config.filterByMapExtent,this.config.hideExportButton,
this.config.allowTextSelection).then(d.hitch(this,function(c){this._activeLayerInfoId===a&&c&&(f=this.getExistLayerTabPage(a),c.isSupportQuery?(c=c.table,c.getParent()!==f&&c.placeAt(f),this.setActiveTable(c,{h:this.openHeight-this.noGridHeight,featureSet:b})):(c=e.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),f.set("content",c),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),d.hitch(this,function(a){new w({message:a.message||a});this.showRefreshing(!1)})))},
_startQueryOnRelationTab:function(a,b,c,f){var k=this._resourceManager.getLayerInfoById(f),g=this.getExistLayerTabPage(a);k&&k.layerObject&&g&&this._resourceManager.getRelationTable(f,b,!1,this.config.hideExportButton,this.config.allowTextSelection).then(d.hitch(this,function(b){this._activeLayerInfoId===a&&b&&(g=this.getExistLayerTabPage(a),b.isSupportQuery?(b=b.table,b.getParent()!==g&&b.placeAt(g),this.setActiveTable(b,{h:this.openHeight-this.noGridHeight,layer:k.layerObject,selectedIds:c})):(b=
e.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),g.set("content",b),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},tabChanged:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var a=this.tabContainer.selectedChildWidget.params,b=a.layerType,c=a.paneId,d=a.relKey;b===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==c||a.oids||a.featureSet)?
(this.setActiveTable(null),delete a.oids,this._activeLayerInfoId=c,this._startQueryOnLayerTab(c,a.featureSet)):b===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),b=a.oids,a=a.originalInfoId,this._activeLayerInfoId=c,this._startQueryOnRelationTab(c,d,b,a))}},showRefreshing:function(a){this.loading&&this._toggleLoading(a)},_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=e.getStyle(this.domNode,"height");e.addClass(this.arrowDiv,"draging");this._dragingHandlers=
this._dragingHandlers.concat([f(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),f(this.ownerDocumentBody,"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},_onDraging:function(a){this.moveMode&&125<=a.clientY&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},_onDragEnd:function(){this.moveMode=!1;e.removeClass(this.arrowDiv,"draging");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_getNormalHeight:function(){var a=
document.body.clientHeight;return window.appInfo.isRunInMobile?a/2:a/3},setInitialPosition:function(){var a=e.getStyle(this.domNode,"left"),b=e.getStyle(this.domNode,"right");a||e.setStyle(this.domNode,"left","0px");b||e.setStyle(this.domNode,"right","0px");e.setStyle(this.domNode,"top","auto");e.setStyle(this.domNode,"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var a=this;a._activeTable&&
(a._activeTableHandles.push(f(a._activeTable,"show-related-records",function(b){a._showRelatedRecords(b.layerInfoId,b.objectIds)})),a._activeTableHandles.push(f(a._activeTable,"show-all-records",function(b){a.getExistLayerTabPage(b.layerInfoId).params.layerType=a._layerTypes.FEATURELAYER})),a._activeTableHandles.push(f(a._activeTable,"refresh",function(b){delete a.getExistLayerTabPage(b.layerInfoId).params.featureSet})),a._activeTableHandles.push(f(a._activeTable,"apply-filter",function(b){a.filterManager.applyWidgetFilter(b.layerInfoId,
a.id,b.expr);a._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var a=this._activeTableHandles;0<a.length;){var b=a.pop();b&&b.remove&&b.remove()}},setActiveTable:function(a,b){this._activeTable&&(this._activeTable.cancelThread(),this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(a){this._activeTable=a;this._activeTable.active();this._activeTable.changeHeight(b.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||
this._activeTable.tableCreated&&!this._activeTable.matchingMap&&b.featureSet||b.layer&&b.selectedIds)if(a=d.getObject("featureSet.features.length",!1,b),b.layer&&b.selectedIds)this._activeTable.queryRecordsByRelationship(b);else if(a){var c=b.featureSet.displayFieldName;b=r.map(b.featureSet.features,function(a){return a.attributes[c]});this._activeTable.startQuery(b)}else this._activeTable.startQuery();this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=
e.create("div",{},this.domNode);e.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var b=e.create("div");e.place(b,this.AttributeTableDiv);this.tabContainer=new n({style:"width: 100%;"},b);e.setStyle(this.tabContainer.domNode,"height",this.normalHeight+"px");this.tabContainer.startup();for(var b=this._resourceManager.getConfigInfos(),c=b.length,f=0;f<c;f++){var g=b[f];if(g.show){var g=d.clone(g),h={};h.paneId=g.id;h.title=g.name;h.name=g.name;h.layerType=this._layerTypes.FEATURELAYER;
h.style="height: 100%; width: 100%; overflow: visible;";g=new m(h);this.layerTabPages[f]=g;this.tabContainer.addChild(g)}}0<c?this.noGridHeight=this._getGridTopSectionHeight()+5:this._toggleNoTableMessage(!0);p.setVerticalCenter(this.tabContainer.domNode);this.tabChanged();this.own(a.after(this.tabContainer,"selectChild",d.hitch(this,this.tabChanged)));this.applyA11y&&this.applyA11y()},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},_getGridTopSectionHeight:function(){var a=
y(".dijitTabPaneWrapper",this.domNode)[0];if(a){var b=e.position(this.domNode).y;return e.position(a).y-b}return 0},_getLayerInfoByIdFromConfigJSON:function(a){var b=r.filter(this.config.layerInfos,function(b){return b.id===a});return b&&0<b.length&&b[0]},_showRelatedRecords:function(a,b){var c=this._activeTable;if(c&&(c=c.layerInfo)&&c.id===a&&c.layerObject){a=c.layerObject.relationships;for(var d=0,e=a.length;d<e;d++)this.addNewRelationTab(b,a[d],c.id,!0,!0)}},addNewLayerTab:function(a,b,c,e,g){var h=
this._resourceManager.getLayerInfoById(a);if(h){a=this.getExistLayerTabPage(a);var k={};k.title=this.getLayerInfoLabel(h);k.name=k.title;k.paneId=this.getLayerInfoId(h);k.closable=c;k.layerType=this._layerTypes.FEATURELAYER;k.featureSet=b;a?(d.mixin(a.params,k),this.onOpen()):(this._resourceManager.getConfigInfoById(h.id)||this._resourceManager.addConfigInfo(h),this._resourceManager.getLayerInfoById(h.id)||this._resourceManager.addLayerInfo(h),this.onOpen(),k.style="height: 100%; width: 100%; overflow: visible",
a=new m(k),this.layerTabPages.push(a),a.set("title",k.name),this.own(f(a,"close",d.hitch(this,this.layerTabPageClose,k.paneId,!0))),this.tabContainer.addChild(a,g));e&&this.tabContainer.selectChild(a);1===this.layerTabPages.length&&this._toggleNoTableMessage(!1)}},addNewRelationTab:function(a,b,c,e,g){var h=this._resourceManager.getRelationShipInfo(b),k=b&&h;if(k){var h=this.getExistLayerTabPage(h.id),l={};l.oids=a;l.title=k.title||k.name||b.name;l.name=l.title;l.paneId=k.id;l.relKey=b._relKey;l.originalInfoId=
c;l.closable=e;l.layerType=this._layerTypes.RELATIONSHIPTABLE;h?d.mixin(h.params,l):(this._resourceManager.getConfigInfoById(k.id)||this._resourceManager.addConfigInfo(k),this._resourceManager.getLayerInfoById(k.id)||this._resourceManager.addLayerInfo(k),l.style="height: 100%; width: 100%; overflow: visible",h=new m(l),this.layerTabPages.push(h),h.set("title",l.name),this.own(f(h,"close",d.hitch(this,this.layerTabPageClose,l.paneId,!0))),this.tabContainer.addChild(h));g&&this.tabContainer.selectChild(h)}},
onReceiveData:function(a,b,c){c&&"AttributeTable"===c.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(c.layer=c.layer||c.layerInfo,c.closeable=!0,c.isActive=!0,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){this._addLayerToTable(c)})):this._openTable().then(d.hitch(this,function(){this._resourceManager.getLayerInfoById(c.layer.id)?this._addLayerToTable(c):this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,
function(){this._addLayerToTable(c)}))}))))},_addLayerToTable:function(a){var b=null;if(d.getObject("layer.id",!1,a)||d.getObject("layerInfo.id",!1,a)){var c=this._resourceManager.getLayerInfoById(a.layerInfo&&a.layerInfo.id||a.layer&&a.layer.id);c.getLayerObject().then(d.hitch(this,function(e){e?(e.id=a.layer.id,e.loaded?this.addNewLayerTab(c.id,a.featureSet,!!a.closeable,!!a.isActive,a.index):this.own(f(e,"load",d.hitch(this,this.addNewLayerTab,c.id,a.featureSet,!!a.closeable,!!a.isActive,a.index)))):
a.url&&(b=new h(a.url),this.own(f(b,"load",d.hitch(this,this.addNewLayerTab,c.id,a.featureSet,!!a.closeable,!!a.isActive,a.index))))}),d.hitch(this,function(a){new w({message:a.message||a})}))}},getExistLayerTabPage:function(a){for(var b=this.layerTabPages.length,c=0;c<b;c++)if(this.layerTabPages[c]&&this.layerTabPages[c].get("paneId")===a)return this.layerTabPages[c];return null},layerTabPageClose:function(a,b){var e=this.layerTabPages.length;d.getObject("_activeTable.layerInfo.id",!1,this)===a&&
this.setActiveTable(null);for(var f=0;f<e;f++)if(this.layerTabPages[f]&&this.layerTabPages[f].paneId===a){var g=d.getObject("_resourceManager.featureTableSet."+a,!1,this);g&&(g=g.getFilterObj())&&c.isDefined(g.expr)&&this.filterManager.applyWidgetFilter(a,this.id,"");!0===b&&(this.tabContainer.removeChild(this.layerTabPages[f]),this.layerTabPages[f].destroyRecursive());this.layerTabPages&&this.layerTabPages[f]&&this.layerTabPages.splice(f,1);this._resourceManager.removeConfigInfo(a);this._resourceManager.removeLayerInfo(a);
if(1===e){this._activeLayerInfoId=null;this.onClose();this._toggleNoTableMessage(!0);break}else a===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[e-2]);break}},_processRelatedRecordsFromPopup:function(a,b){if(a){var c=[];c.push(a.getLayerObject());c.push(a.getRelatedTableInfoArray());v(c).then(d.hitch(this,function(c){if(c){var d=c[0];this._resourceManager.collectRelationShips(a,c[1]);c=d.relationships;for(var d=0,e=c.length;d<e;d++)this.addNewRelationTab(b,c[d],a.id,!0,
!0)}}))}},showRelatedRecordsFromPopup:function(a,b){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){this._processRelatedRecordsFromPopup(a,b)})):this._openTable().then(d.hitch(this,function(){this._resourceManager.getLayerInfoById(a.id)?this._processRelatedRecordsFromPopup(a,b):this._resourceManager.updateLayerInfoResources(!1).then(d.hitch(this,function(){this._processRelatedRecordsFromPopup(a,b)}))}))},_toggleNoTableMessage:function(a){if(!this.NoTableMessageDiv){var b=
this.AttributeTableDiv||this.domNode;this.NoTableMessageDiv=e.create("div",{innerHTML:this.nls.noTablesAvailable+"\x3cbr/\x3e\x3cbr/\x3e"+(this.config.syncWithLayers?this.nls.checkLayerListToSelectLayers:this.nls.checkConfigutationToSelectLayers),className:"jimu-widget-attributetable-notable hidden"});e.place(this.NoTableMessageDiv,b)}e[a?"removeClass":"addClass"](this.NoTableMessageDiv,"hidden")},_toggleLoading:function(a){void 0===a?this.loading.hidden?this.loading.show():this.loading.hide():a?
this.loading.show():this.loading.hide()},isLoading:function(){return this.loading&&!this.loading.hidden||this._activeTable&&this._activeTable.loading&&!this._activeTable.loading.hidden}});g.inPanel=!1;g.hasUIFile=!1;return g});