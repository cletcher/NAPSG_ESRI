// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(f,h,m,q,n,u,r,z,w,B,c){f=f(B,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(a){this._geocodeHandler=
h.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=h.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=h.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(a){this.outSpatialReference=a},_geocodeHandler:function(a,k,b,d,e){try{var g=a.candidates,x;k=[];var l,p=g.length,t=a.spatialReference,v;for(l=0;l<p;l++){x=g[l];if(v=x.location)v.spatialReference=t;k[l]=new c(x)}this._successHandler([k],
"onAddressToLocationsComplete",b,e)}catch(A){this._errorHandler(A,d,e)}},_geocodeAddressesHandler:function(a,k,b,d,e){try{var g=a.locations;k=[];var x,l=g.length,p=a.spatialReference,t;for(x=0;x<l;x++){if(t=g[x].location)t.spatialReference=p;k[x]=new c(g[x])}this._successHandler([k],"onAddressesToLocationsComplete",b,e)}catch(v){this._errorHandler(v,d,e)}},addressToLocations:function(a,k,b,d,e){var g,c,l,p,t,v,A,f;a.address&&(d=b,b=k,k=a.outFields,e=a.searchExtent,f=a.countryCode,g=a.magicKey,c=a.distance,
A=a.categories,a.location&&this.normalization&&(l=a.location.normalize()),p=a.locationType,t=a.maxLocations,v=a.forStorage,a=a.address);e&&(e=e.shiftCentralMeridian());var r=this.outSpatialReference;a=this._encode(h.mixin({},this._url.query,a,{f:"json",outSR:r&&n.toJson(r.toJson()),outFields:k&&k.join(",")||null,searchExtent:e&&n.toJson(e.toJson()),category:A&&A.join(",")||null,countryCode:f||null,magicKey:g||null,distance:c||null,location:l||null,locationType:p||null,maxLocations:t||null,forStorage:v||
null}));var y=this._geocodeHandler,m=this._errorHandler,C=new q(w._dfdCanceller);C._pendingDfd=z({url:this._url.path+"/findAddressCandidates",content:a,callbackParamName:"callback",load:function(a,e){y(a,e,b,d,C)},error:function(a){m(a,d,C)}});return C},suggestLocations:function(a){var c;c=new q(w._dfdCanceller);a.hasOwnProperty("location")&&this.normalization&&(a.location=a.location.normalize());a.searchExtent&&(a.searchExtent=a.searchExtent.shiftCentralMeridian());a=this._encode(h.mixin({},this._url.query,
{f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:a.searchExtent&&n.toJson(a.searchExtent.toJson()),category:a.categories&&a.categories.join(",")||null,countryCode:a.countryCode||null,location:a.location||null,distance:a.distance||null},{f:"json"}));a=z({url:this._url.path+"/suggest",content:a,callbackParamName:"callback"});c._pendingDfd=a;a.then(h.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);c.resolve(a)}),h.hitch(this,function(a){this._errorHandler(a);
c.reject(a)}));return c},addressesToLocations:function(a,c,b){var d=this.outSpatialReference,e=[],g=a.categories,k=a.locationType,l=a.countryCode;m.forEach(a.addresses,function(a,b){e.push({attributes:a})});a=this._encode(h.mixin({},this._url.query,{category:g&&g.join(",")||null,locationType:k||null,sourceCountry:l||null},{addresses:n.toJson({records:e})},{f:"json",outSR:d&&n.toJson(d.toJson())}));var p=this._geocodeAddressesHandler,t=this._errorHandler,v=new q(w._dfdCanceller);v._pendingDfd=z({url:this._url.path+
"/geocodeAddresses",content:a,callbackParamName:"callback",load:function(a,d){p(a,d,c,b,v)},error:function(a){t(a,b,v)}});return v},_reverseGeocodeHandler:function(a,k,b,d,e){try{var g=new c({address:a.address,location:a.location,score:100});this._successHandler([g],"onLocationToAddressComplete",b,e)}catch(x){this._errorHandler(x,d,e)}},locationToAddress:function(a,c,b,d){a&&this.normalization&&(a=a.normalize());var e=this.outSpatialReference;a=this._encode(h.mixin({},this._url.query,{outSR:e&&n.toJson(e.toJson()),
location:a&&n.toJson(a.toJson()),distance:c,f:"json"}));var g=this._reverseGeocodeHandler,k=this._errorHandler,l=new q(w._dfdCanceller);l._pendingDfd=z({url:this._url.path+"/reverseGeocode",content:a,callbackParamName:"callback",load:function(a,e){g(a,e,b,d,l)},error:function(a){k(a,d,l)}});return l},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});u("extend-esri")&&h.setObject("tasks.Locator",
f,r);return f})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(f,h,m,q,n){f=f(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(f){h.mixin(this,f);this.location=new n(this.location)}});m("extend-esri")&&h.setObject("tasks.AddressCandidate",f,q);return f})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),
function(f,h,m,q,n,u,r,z){f=f(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var f={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},h=this.distances,c=this.outSpatialReference,a=this.bufferSpatialReference,k=m.map(this.geometries,function(a){a="extent"===a.type?r.fromExtent(a):a;return a.toJson()},this),b=this.geometries;if(b&&0<b.length){var d=
"extent"===b[0].type?"esriGeometryPolygon":z.getJsonType(b[0]);f.geometries=q.toJson({geometryType:d,geometries:k});f.inSR=b[0].spatialReference.wkid?b[0].spatialReference.wkid:q.toJson(b[0].spatialReference.toJson())}h&&(f.distances=h.join(","));c&&(f.outSR=c.wkid?c.wkid:q.toJson(c.toJson()));a&&(f.bufferSR=a.wkid?a.wkid:q.toJson(a.toJson()));return f}});n("extend-esri")&&h.setObject("tasks.BufferParameters",f,u);return f})},"widgets/IncidentAnalysis/js/SummaryInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/CSVUtils jimu/utils esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query".split(" "),
function(f,h,m,q,n,u,r,z,w,B,c,a,k,b,d,e,g,x,l,p,t,v,A,I,D,y,J){return f("SummaryInfo",null,{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],constructor:function(a,b,d){this.tab=a;this.container=b;this.parent=d;this.config=d.config;this.buffer=this.incident=this.summaryLayer=null},updateForIncident:function(a,b){this.container.innerHTML="";u.add(this.container,"loading");this.incident=a;this.buffer=b;this.summaryIds=[];this.summaryFeatures=[];if(this.summaryLayer)this._queryFeatures(b.geometry);
else{var d=new v(this.tab.tabLayers[0].url);B(d,"load",m.hitch(this,function(){d.capabilities&&-1<d.capabilities.indexOf("Query")?(this.summaryLayer=d,this.summaryFields=this._getFields(this.summaryLayer),this._queryFeatures(b.geometry)):this._processError()}));B(this.parent.opLayers,"layerInfosFilterChanged",m.hitch(this,this._layerFilterChanged))}},_layerFilterChanged:function(a){if(null!==this.summaryLayer&&null!==this.incident&&null!==this.buffer){var b=this.tab.tabLayers[0].id;h.forEach(a,m.hitch(this,
function(a){b===a.id&&this.updateForIncident(this.incident,this.buffer)}))}},_queryFeatures:function(a){var b=this.tab.tabLayers[0].id,d="";this.parent.opLayers.traversal(function(a){if(b===a.id&&a.getFilter())return d=a.getFilter(),!0});var e=new J;e.geometry=a;e.where=d;this.summaryLayer.queryIds(e,m.hitch(this,function(a){a?(this.summaryIds=a,0<this.summaryIds.length?this._queryFeaturesByIds():this._processResults()):this._processResults()}))},_queryFeaturesByIds:function(){var a=this.summaryLayer.maxRecordCount||
1E3,b=this.summaryIds.slice(0,a);this.summaryIds.splice(0,a);var a=new J,d=!1;h.some(this.summaryFields,function(a){if("area"===a.type||"length"===a.type)return d=!0});a.returnGeometry=d;var e=[];h.forEach(this.summaryFields,function(a){e.push(a.field)});a.outFields=e;a.objectIds=b;this.summaryLayer.queryFeatures(a,m.hitch(this,function(a){this.summaryFeatures=this.summaryFeatures.concat(a.features);this._processResults();0<this.summaryIds.length?(n.byId("IMT_download")&&u.replace(n.byId("IMT_download"),
"processing","download"),setTimeout(m.hitch(this,this._queryFeaturesByIds),900)):n.byId("IMT_download")&&u.replace(n.byId("IMT_download"),"download","processing")}))},_prepResults:function(){for(var a=0;a<this.summaryFields.length;a++){var b=this.summaryFields[a],d=b.field,e=b.value;switch(b.type){case "count":e=this.summaryFeatures.length;break;case "area":e=this._getArea();break;case "length":e=this._getLength();break;case "sum":e=this._getSum(d);break;case "avg":e=this._getSum(d)/this.summaryFeatures.length;
break;case "min":e=this._getMin(d);break;case "max":e=this._getMax(d)}b.value=e}},_sortResults:function(a){return function(b,d){return b.attributes[a]<d.attributes[a]?-1:b.attributes[a]>d.attributes[a]?1:0}},_getSum:function(a){var b=0;h.forEach(this.summaryFeatures,function(d){b+=d.attributes[a]});return b},_getMin:function(a){this.summaryFeatures.sort(this._sortResults(a));return this.summaryFeatures[0].attributes[a]},_getMax:function(a){this.summaryFeatures.sort(this._sortResults(a));this.summaryFeatures.reverse();
return this.summaryFeatures[0].attributes[a]},_getArea:function(){var a=0,b=m.clone(this.config.distanceSettings);b.miles=109413;b.kilometers=109414;b.feet=109405;b.meters=109404;b.yards=109442;b.nauticalMiles=109409;var d=b[this.config.distanceUnits];h.forEach(this.summaryFeatures,function(b){a+=g.geodesicArea(b.geometry,d)});return a},_getLength:function(){var a=0,b=this.config.distanceSettings[this.config.distanceUnits];h.forEach(this.summaryFeatures,function(d){a+=g.geodesicLength(d.geometry,
b)});return a},_processError:function(){this.container.innerHTML="";u.remove(this.container,"loading");this.container.innerHTML=this.parent.nls.noFeaturesFound},_processResults:function(){this._prepResults();this.container.innerHTML="";u.remove(this.container,"loading");var a=this.summaryFields,b=0,e=r.create("div",{id:"tpc",style:"width:"+220*(a.length+1)+"px;"},this.container);u.add(e,"IMT_tabPanelContent");var g=r.create("div",{},e);u.add(g,"IMTcol");g=r.create("div",{id:"IMT_download",innerHTML:this.parent.nls.downloadCSV},
g);u.add(g,["btnExport","download"]);B(g,"click",m.hitch(this,this._exportToCSV));for(g=0;g<a.length;g++){var b=a[g],c=d.sanitizeHTML(b.alias?b.alias:"")+"\x3cbr/\x3e",b=b.alias===this.parent.nls.area||b.alias===this.parent.nls.length?b.value:Math.round(b.value);isNaN(b)&&(b=0);c+="\x3cdiv class\x3d'colSummary'\x3e"+w.format(b)+"\x3c/div\x3e\x3cbr/\x3e";c=r.create("div",{id:"Demographics_"+g,innerHTML:c},e);u.add(c,"IMTcol")}},_exportToCSV:function(){if(0===this.summaryFeatures.length)return!1;console.log(this.tab);
var a=this.tab.layers,d=[],e=[];h.forEach(this.summaryFeatures,function(a){d.push(a.attributes)});for(var g in d[0])e.push(g);b.exportCSV(a,d,e)},_getFields:function(a){var b=[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)return h.forEach(this.tab.advConfig.fields,m.hitch(this,function(a){var d="";"count"!==a.type&&"area"!==a.type&&"length"!==a.type&&(d=" (\x3cspan style\x3d'font-size:7pt;'\x3e"+this.parent.nls[a.type]+"\x3c/span\x3e)");b.push({field:a.expression,
alias:a.label+d,type:a.type,value:0})})),b;var d;d=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var e=0;e<d.length;e++){var g=d[e],c=g.fieldName||g.name,p=this._getFieldType(a.fields,c),k=null;c===a.objectIdField||"esriFieldTypeDouble"!==p&&"esriFieldTypeInteger"!==p&&"esriFieldTypeSmallInteger"!==p||("undefined"!==typeof g.visible?g.visible&&(k={field:g.fieldName,alias:g.label,type:"sum",value:0}):k={field:g.name,alias:g.alias,type:"sum",value:0},k&&b.push(k))}return b},_getFieldType:function(a,
b){var d;h.some(a,function(a){if(a.name===b)return d=a.type,!0});return d}})})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),function(f,h,m,q,n,u,r,z,w,B,c,a){function k(a){var b=h.clone(a.attributes);(a=a.geometry)&&"point"===a.type&&("x"in b?b._x=a.x:b.x=a.x,"y"in b?b._y=a.y:b.y=a.y);return b}f.exportCSV=function(a,d,e){return f._createCSVStr(d,
e).then(function(b){return f._download(a+".csv",b)})};f.exportCSVFromFeatureLayer=function(a,d,e){e=e||{};return f._getExportData(d,{datas:e.datas,objectIds:e.objectIds,fromClient:e.fromClient,withGeometry:e.withGeometry,outFields:e.outFields,filterExpression:e.filterExpression,outSpatialReference:e.outSpatialReference,arcadeExpressions:e.arcadeExpressions,geometry:e.geometry,orderByFields:e.orderByFields,start:e.start,num:e.num}).then(function(b){return f._formattedData(d,b,{formatNumber:e.formatNumber,
formatDate:e.formatDate,formatCodedValue:e.formatCodedValue,richText:{clearFormat:e.richTextFieldsToClear&&!!e.richTextFieldsToClear.length,fieldsToClear:e.richTextFieldsToClear||[]},popupInfo:e.popupInfo}).then(function(b){return f.exportCSV(a,b.datas,b.columns)})})};f.exportCSVByAttributes=function(a,d,e,g){g=h.mixin({},g);g.datas=e;return f.exportCSVFromFeatureLayer(a,d,g)};f.exportCSVByGraphics=function(a,d,e,g){e=m.map(e,function(a){return a.attributes});return f.exportCSVByAttributes(a,d,e,
g)};f._createCSVStr=function(a,d){var b=new u,g="",c=0,k=0,p="",t="";try{d=m.map(d,function(a){return"string"===typeof a?{name:a}:a});m.forEach(d,function(a){a=a.alias||a.name;-1<a.toString().indexOf(",")&&(a='"'+a+'"');g=g+p+a;p=","});for(var g=g+"\r\n",c=a.length,k=d.length,v=0;v<c;v++){for(var p="",A=0;A<k;A++)(t=a[v][d[A].name])||"number"===typeof t||(t=""),t&&/[",\r\n]/g.test(t)&&(t='"'+t.replace(/(")/g,'""')+'"'),g=g+p+t,p=",";g+="\r\n"}b.resolve(g)}catch(I){console.error(I),b.resolve("")}return b};
f._isIE11=function(){return 11===r.has("ie")};f._isEdge=function(){return r.has("edge")};f._getDownloadUrl=function(a){return window.Blob&&window.URL&&window.URL.createObjectURL?(a=new Blob(["\ufeff"+a],{type:"text/csv"}),URL.createObjectURL(a)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(a)};f._download=function(a,d){var b=new u;try{if(n("ie")&&10>n("ie")){var g=window.top.open("about:blank","_blank");g.document.write("sep\x3d,\r\n"+d);g.document.close();g.document.execCommand("SaveAs",
!0,a);g.close()}else if(10===n("ie")||f._isIE11()||f._isEdge()){var c=new Blob(["\ufeff"+d],{type:"text/csv"});navigator.msSaveBlob(c,a)}else{var k=q.create("a",{href:f._getDownloadUrl(d),target:"_blank",download:a},document.body);if(n("safari")){var p=document.createEvent("MouseEvents");p.initEvent("click",!0,!0);k.dispatchEvent(p)}else k.click();q.destroy(k)}b.resolve()}catch(t){b.reject(t)}return b};f._getExportData=function(a,d){var b=new u,g=null,c=[],l=d.datas,p=d.withGeometry,t=!!d.arcadeExpressions,
g=d.outFields;g&&g.length||(g=a.fields);g=h.clone(g);if(p&&!(l&&0<l.length)){t?(c=m.filter(a.fields,function(a){return-1===a.name.indexOf("expression/")}),c=h.clone(c)):c=h.clone(g);var v="",v=-1!==g.indexOf("x")?"_x":"x";g.push({name:v,alias:v,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});v=-1!==g.indexOf("y")?"_y":"y";g.push({name:v,alias:v,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}l&&0<l.length?(t&&(l=f._getAttrsWithExpressionsBatch(l,d.arcadeExpressions)),
b.resolve({data:l||[],outFields:g})):d.fromClient?(l=m.map(a.graphics,function(a){a=p?k(a):h.clone(a);return a=t?f._getAttrsWithExpressions(a,d.arcadeExpressions):a}),b.resolve({data:l||[],outFields:g})):f._getExportDataFromServer(a,c,d).then(function(a){t&&(a=f._getAttrsWithExpressionsBatch(a,d.arcadeExpressions));b.resolve({data:a||[],outFields:g})});return b};f._getExportDataFromServer=function(a,d,e){var b=new u;if("esri.layers.FeatureLayer"!==a.declaredClass)return b.resolve([]),b;var c=new w(a.url),
l=new B;l.where=e.filterExpression||a.getDefinitionExpression&&a.getDefinitionExpression()||"1\x3d1";0<d.length?(a=m.map(d,function(a){return a.name}),l.outFields=a):l.outFields=["*"];l.objectIds=e.objectIds;l.returnGeometry=e.withGeometry;l.outSR=e.spatialReference;l.geometry=e.geometry;l.orderByFields=e.orderByFields;l.start=e.start;l.num=e.num;c.execute(l,function(a){a=m.map(a.features,function(a){return k(a)});b.resolve(a)},function(a){console.error(a);b.resolve([])});return b};f._formattedData=
function(a,d,e){var b=new u,c=[],k=d.data;d=d.outFields;for(var p=0,t=k.length;p<t;p++){for(var v={},A=0;A<d.length;A++){var r=d[A];v[r.name]=f._getExportValue(k[p][r.name],r,a.objectIdField,a.typeIdField,k[p][a.typeIdField],a.types,e)}c.push(v)}a=m.map(d,function(a){return{alias:a.alias,name:a.name}});b.resolve({datas:c,columns:a});return b};f._getExportValue=function(a,d,e,c,k,l,p){function b(a){if(f&&z.isDefined(f.fieldInfos))for(var b=0,d=f.fieldInfos.length;b<d;b++){var e=f.fieldInfos[b];if(e.fieldName===
a)return e.format}return null}function g(a){for(var b=0,d=h.length;b<d;b++)if(h[b].fieldName===a)return!0;return!1}var f=p.popupInfo,h=p.richText.fieldsToClear,x=!!d.domain&&p.formatCodedValue,y="esriFieldTypeDate"===d.type&&p.formatDate,n=e&&d.name===e;c=c&&d.name===c;g="esriFieldTypeString"===d.type&&p.richText.clearFormat&&g(d.name);return y?r.fieldFormatter.getFormattedDate(a,b(d.name)):c?r.fieldFormatter.getTypeName(a,l):x?r.fieldFormatter.getCodedValue(d.domain,a):g?a?(d=document.createElement("span"),
d.innerHTML=a,d.textContent||d.innerText||""):a:x||y||n||c||g?a:(p=null,e&&l&&0<l.length&&(e=(e=m.filter(l,function(a){return a.id===k}))&&e[0])&&e.domains&&e.domains[d.name]&&e.domains[d.name].codedValues&&(p=r.fieldFormatter.getCodedValue(e.domains[d.name],a)),null!==p?p:a)};f._getAttrsWithExpressions=function(b,d){var e=h.getObject("expressionInfos",!1,d);d=h.getObject("layerDefinition",!1,d);var g=new c(null,null,b);return a.customExpr.getAttributesFromCustomArcadeExpr(e,g,d)||b};f._getAttrsWithExpressionsBatch=
function(a,d){var b=[];return b=m.map(a,function(a){return f._getAttrsWithExpressions(a,d)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),function(f,h,m,q,n,u,r,z,w,B){var c={readExprInfo:{}};c.readExprInfo.getArcadeProfilesByType=function(a,k,b){a={map:a,layer:k};return"render"===b?c.readExprInfo._getArcadeRender(a):
"label"===b?c.readExprInfo._getArcadeLabel(a):"infoTemplate"===b?c.readExprInfo._getArcadeInfoTemplate(a):c.readExprInfo._getAllArcade(a)};c.readExprInfo._getArcadeRender=function(a){return c.readExprInfo._lookupArcadeRender({layers:c.readExprInfo._checkPassInLayer(a)})};c.readExprInfo._getArcadeInfoTemplate=function(a){return c.readExprInfo._lookupArcadeInfoTemplate({layers:c.readExprInfo._checkPassInLayer(a)})};c.readExprInfo._getArcadeLabel=function(a){return c.readExprInfo._lookupArcadeLabel({layers:c.readExprInfo._checkPassInLayer(a)})};
c.readExprInfo._getAllArcade=function(a){var k=c.readExprInfo._getArcadeRender(a),b=c.readExprInfo._getArcadeInfoTemplate(a);a=c.readExprInfo._getArcadeLabel(a);return{render:k,infoTemplate:b,label:a}};c.readExprInfo._checkPassInLayer=function(a){var k=[];return k="undefined"!==typeof a?"undefined"!==typeof a.layer?null!==a.layer&&""!==a.layer?c.readExprInfo._getAllMapLayers(a):c.readExprInfo._getAllMapLayers():c.readExprInfo._getAllMapLayers():c.readExprInfo._getAllMapLayers()};c.readExprInfo._getAllMapLayers=
function(a){var c="",b=[],d=B.getInstance();a&&a.layer&&(c=a.layer.id);""!==c?(a=d.getNodeById(c))&&b.push(a._layerInfo.layerObject):d.traversal(function(a){"undefined"!==typeof a._layerInfo.layerObject.type?-1===a._layerInfo.layerObject.type.indexOf("tile")&&b.push(a._layerInfo.layerObject):b.push(a._layerInfo.layerObject)});return b};c.readExprInfo._lookupArcadeRender=function(a){var c=[];0<a.layers.length&&f.forEach(a.layers,h.hitch(this,function(a){var b={};if("undefined"!==typeof a.renderer){var e=
a.renderer;"undefined"!==typeof e.valueExpression&&(b.layer=a.id,b.valueExpression=e.valueExpression,b.valueExpressionTitle=e.valueExpressionTitle,"undefined"!==typeof e.values&&(b.values=e.values),"undefined"!==typeof e.visualVariables&&(b.visualVariables=e.visualVariables));1<Object.keys(b).length&&b.constructor===Object?c.push(b):c.push({layer:a.id,valueExpression:null,valueExpressionTitle:null,values:null,visualVariables:null})}}));return c};c.readExprInfo._lookupArcadeInfoTemplate=function(a){var c=
[];0<a.layers.length&&f.forEach(a.layers,h.hitch(this,function(a){var b={};if("undefined"!==typeof a.infoTemplate)"undefined"!==typeof a.infoTemplate.info.expressionInfos&&0<a.infoTemplate.info.expressionInfos.length&&(b.layer=a.id,b.expressionInfos=a.infoTemplate.info.expressionInfos);else if("undefined"!==typeof a.infoTemplates)for(var e in a.infoTemplates)if(a.infoTemplates.hasOwnProperty(e)&&"undefined"!==typeof a.infoTemplates[e].infoTemplate.info.expressionInfos){var g=a.infoTemplates[e].infoTemplate;
0<g.info.expressionInfos.length&&(b.layer=a.id,b.expressionInfos=g.info.expressionInfos)}1<Object.keys(b).length&&b.constructor===Object?c.push(b):c.push({layer:a.id,expressionInfos:null})}));return c};c.readExprInfo._lookupArcadeLabel=function(a){var c=[];0<a.layers.length&&f.forEach(a.layers,h.hitch(this,function(a){var b={};"undefined"!==typeof a.labelingInfo&&f.forEach(a.labelingInfo,h.hitch(this,function(d){"undefined"!==typeof d.name&&(b.layer=a.id,b.name=d.name,b.labelingInfo=d,b.expression=
d.labelExpressionInfo.expression)}));1<Object.keys(b).length&&b.constructor===Object?c.push(b):c.push({layer:a.id,name:null,labelingInfo:null,expression:null})}));return c};c.customExpr={};c.customExpr.getAttributesFromCustomArcadeExpr=function(a,k,b){a=c.InfoTemplate._parseArcadeExpressions(a);return c.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(k,a,b)};c.customExpr.getAttributesValueFromCustomArcadeExprBatch=function(a,k,b){var d=[],e;for(e in k)d.push(k[e]);k=c.InfoTemplate._parseArcadeExpressions(a);
a=c.InfoTemplate._getExprNamesArrayFromPopupExprInfos(a);a.relationships=null;a.parsedExpressions=k;var g=new m;c.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(d,a,b).then(function(a){g.resolve(a)});return g};c.InfoTemplate={};c.InfoTemplate.getAttributesFromInfoTemplate=function(a,k,b){var d={fields:[]};k.layerObject&&k.layerObject.fields&&(d.fields=k.layerObject.fields);a=c.readExprInfo.getArcadeProfilesByType(a,k,"infoTemplate")[0].expressionInfos;if(!a)return b.attributes;a=c.InfoTemplate._parseArcadeExpressions(a);
return c.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,a,d)};c.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(a,k,b){var d={fields:[]};k.layerObject&&k.layerObject.fields&&(d.fields=k.layerObject.fields);var e=[],g;for(g in b)e.push(b[g]);a=c.readExprInfo.getArcadeProfilesByType(a,k,"infoTemplate")[0].expressionInfos;var f=new m;if(!a)return f.resolve([]),f;b=c.InfoTemplate._parseArcadeExpressions(a);g=null;g=k.getPopupInfo().description;null!==g?(g=c.InfoTemplate._convertPopupDescToFieldNamesArray(g),
g.relationships=c.InfoTemplate._getRelationshipQueries(k)):(g=c.InfoTemplate._getExprNamesArrayFromPopupExprInfos(a),g.relationships=null);g.parsedExpressions=b;c.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(e,g,d).then(function(a){f.resolve(a)});return f};c.InfoTemplate._getRelationshipQueries=function(a){var c=!1,b={},d=/\d+/,e;if(e=a.getPopupInfo().description.match(/\{relationships\/\d+\//gm))c=!0,f.forEach(e,function(c){var e=c.match(d)[0];b.hasOwnProperty(e)||(c=new z,c.outFields=["*"],
c.relationshipId=e,c.returnGeometry=!1,b[e]={operLayer:a,relatedQuery:c})});return c?b:null};c.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(a){var c=[],b;for(b in a)c.push("${expression/"+a[b].name+"}");return c};c.InfoTemplate._convertPopupDescToFieldNamesArray=function(a){a=c.InfoTemplate._convertEndParasToEOLs(a);a=c.InfoTemplate._convertBreaksToEOLs(a);a=c.InfoTemplate._sanitizeNoTags(a).trim();a=a.replace(/\{/gi,"${");a=a.replace(/\u00a0/gi," ");a=a.split("\n");return a=f.map(a,
function(a){return a.trim()})};c.InfoTemplate._sanitizeNoTags=function(a){var c;c=w.sanitizeHTML(a);a=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var b;do b=c,c=c.replace(a,"");while(c!==b);return c=c.replace(/</g,"\x26lt;")};c.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=function(a,k,b){var d=new m,e=[],g=[],r=0;k.relationships?(f.forEach(a,function(a){c.InfoTemplate._objEach(k.relationships,
function(d,e){var p=new m,l=d.relatedQuery,t;g.push(p);t=a.attributes[d.operLayer.layerObject.objectIdField];l.objectIds=[t];d.operLayer.layerObject.queryRelatedFeatures(l,function(d){var g=[];d[t]&&d[t].features&&(d=d[t].features,f.forEach(d,function(d){var p=[],l,v,t;l=a.attributes;v="relationships/"+e+"/";c.InfoTemplate._objEach(d.attributes,function(a,b){t=v+b;l[t]=a});f.forEach(k,function(d){p.push(n.substitute(d,c.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,k.parsedExpressions,
b),c.InfoTemplate._useEmptyStringForNull))});g.push(p)}));p.resolve(g)})})}),q(g).then(function(a){f.forEach(a,function(a){f.forEach(a,function(a){++r;e.push(a)})});console.log(r+" related address features found");d.resolve(e)})):(f.forEach(a,function(a){var d=[];f.forEach(k,function(e){d.push(n.substitute(e,c.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,k.parsedExpressions,b),c.InfoTemplate._useEmptyStringForNull))});e.push(d)}),d.resolve(e));return d};c.InfoTemplate._parseArcadeExpressions=
function(a){var c;Array.isArray(a)&&0<a.length&&(c={},f.forEach(a,function(a){c[a.name]=u.parseScript(a.expression)}));return c};c.InfoTemplate._initArcadeContext=function(a,c){var b={vars:{}};b.vars.$feature=r.createFromGraphicLikeObject(a.geometry,a.attributes,c);return b};c.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(a,f,b){var d,e;d=h.mixin({},a.attributes);if(f)for(e in a=c.InfoTemplate._initArcadeContext(a,b),f)b=u.executeScript(f[e],a),d["expression/"+e]=b?b.toString():
"";return d};c.InfoTemplate._convertEndParasToEOLs=function(a){var c=a;a=a.match(/<\/p>/gi);f.forEach(a,function(a){c=c.replace(a,"\n")});return c};c.InfoTemplate._convertBreaksToEOLs=function(a){var c=a;a=a.match(/<br\s*\/?>/gi);f.forEach(a,function(a){c=c.replace(a,"\n")});return c};c.InfoTemplate._useEmptyStringForNull=function(a){return a?a:""};c.InfoTemplate._objEach=function(a,c,b){for(var d in a)a.hasOwnProperty(d)&&c.call(b,a[d],d)};return c})},"widgets/IncidentAnalysis/js/WeatherInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct esri/geometry/webMercatorUtils esri/request".split(" "),
function(f,h,m,q,n,u){return f("WeatherInfo",null,{constructor:function(f,h,n){this.tab=f;this.container=h;this.parent=n;this.weatherURL=f.url;this.weatherDict={119:["Cloudy","cloudy5.png","cloudy5.png"],377:["Moderate or heavy showers of ice pellets","hail.png","hail.png"],374:["Light showers of ice pellets","hail.png","hail.png"],350:["Ice pellets","hail.png","hail.png"],353:["Light rain shower","light_rain.png","light_rain.png"],302:["Moderate rain","light_rain.png","light_rain.png"],296:["Light rain",
"light_rain.png","light_rain.png"],293:["Patchy light rain","light_rain.png","light_rain.png"],266:["Light drizzle","light_rain.png","light_rain.png"],263:["Patchy light drizzle","light_rain.png","light_rain.png"],122:["Overcast","overcast.png","overcast.png"],359:["Torrential rain shower","shower3.png","shower3.png"],308:["Heavy rain","shower3.png","shower3.png"],365:["Moderate or heavy sleet showers","sleet.png","sleet.png"],362:["Light sleet showers","sleet.png","sleet.png"],320:["Moderate or heavy sleet",
"sleet.png","sleet.png"],317:["Light sleet","sleet.png","sleet.png"],314:["Moderate or Heavy freezing rain","sleet.png","sleet.png"],311:["Light freezing rain","sleet.png","sleet.png"],284:["Heavy freezing drizzle","sleet.png","sleet.png"],281:["Freezing drizzle","sleet.png","sleet.png"],185:["Patchy freezing drizzle nearby","sleet.png","sleet.png"],182:["Patchy sleet nearby","sleet.png","sleet.png"],395:["Moderate or heavy snow in area with thunder","snow4.png","snow4.png"],335:["Patchy heavy snow",
"snow4.png","snow4.png"],230:["Blizzard","snow4.png","snow4.png"],227:["Blowing snow","snow4.png","snow4.png"],371:["Moderate or heavy snow showers","snow5.png","snow5.png"],338:["Heavy snow","snow5.png","snow5.png"],389:["Moderate or heavy rain in area with thunder","tstorm3.png","tstorm3.png"],392:["Patchy light snow in area with thunder","snow2.png","snow2_night.png"],386:["Patchy light rain in area with thunder","tstorm1.png","tstorm1_night.png"],368:["Light snow showers","snow2.png","snow2_night.png"],
356:["Moderate or heavy rain shower","shower2.png","shower2_night.png"],332:["Moderate snow","snow3.png","snow3_night.png"],329:["Patchy moderate snow","snow2.png","snow2_night.png"],326:["Light snow","snow1.png","snow1_night.png"],323:["Patchy light snow","snow1.png","snow1_night.png"],305:["Heavy rain at times","shower2.png","shower2_night.png"],299:["Moderate rain at times","shower2.png","shower2_night.png"],260:["Freezing fog","fog.png","fog_night.png"],248:["Fog","fog.png","fog_night.png"],200:["Thundery outbreaks in nearby",
"tstorm1.png","tstorm1_night.png"],179:["Patchy snow nearby","snow1.png","snow1_night.png"],176:["Patchy rain nearby","shower1.png","shower1_night.png"],143:["Mist","mist.png","mist_night.png"],116:["Partly Cloudy","cloudy3.png","cloudy3_night.png"],113:["Clear/Sunny","sunny.png","sunny_night.png"]}},updateForIncident:function(f){this.container.innerHTML="";m.add(this.container,"loading");var r=f=f.geometry;"point"!==f.type&&(r=f.getExtent().getCenter());f=n.webMercatorToGeographic(r);u({url:this.weatherURL+
"\x26callbackNode\x3d"+this.parent.name+"\x26q\x3d"+(f.y+","+f.x),callbackParamName:"callback"},{useProxy:!1}).then(h.hitch(this,function(f){return this._resultsHandler(f)}),h.hitch(this,function(f){f=this._errorHandler(f);console.log(f)}))},_resultsHandler:function(f){f=f.data;console.log(f);var h=f.current_condition;f=f.weather;var n=1;this.container.innerHTML="";m.remove(this.container,"loading");var r=q.create("div",{id:"tpc",style:"width:"+165*(f.length+3)+"px;"},this.container);m.add(r,"IMT_tabPanelContent");
var c,a;if(0<h.length){h=h[0];c=h.localObsDateTime.split(" ");a=c[2];c=c[1].split(":");c=parseInt(c[0],10);if("AM"===a){if(6>c||12===c)n=2}else 6<c&&12>c&&(n=2);a=h.temp_F;this.parent.config.celsius&&(a=h.temp_C);c=h.weatherCode;c=this.weatherDict[parseInt(c,10)];c=this.parent.nls.now+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+c[n]+"' /\x3e\x3cbr/\x3e"+a+"\x26deg;";a=q.create("div",{innerHTML:c},r);m.add(a,"IMTcolSmall");a=h.windspeedMiles;c=" MPH";this.parent.config.celsius&&
(a=h.windspeedKmph,c=" KMPH");c=this.parent.nls.wind+"\x3cbr/\x3e\x3cspan style\x3d'font-size: 30px; line-height:47px'\x3e"+h.winddir16Point+"\x3c/span\x3e\x3cbr/\x3e"+a+c;h=q.create("div",{innerHTML:c},r);m.add(h,"IMTcolSmall")}for(a=0;a<f.length;a++){var h=f[a],k=this._getDay(h.date),b=h.tempMaxF||h.maxtempF,d=h.tempMinF||h.mintempF;this.parent.config.celsius&&(b=h.tempMaxC||h.maxtempC,d=h.tempMinC||h.mintempC);c=h.weatherCode||h.hourly[0].weatherCode;c=this.weatherDict[parseInt(c,10)];c=k+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+
this.parent.folderUrl+"images/w/"+c[n]+"' /\x3e\x3cbr/\x3e"+b+"\x26deg; | "+d+"\x26deg;";h=q.create("div",{innerHTML:c},r);m.add(h,"IMTcolSmall")}f=q.create("div",{innerHTML:'\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d"font-size:11px;color:#6e6e6e"\x3ePowered by\x3cbr/\x3e\x3ca style\x3d"color:#6e6e6e;text-decoration:none" href\x3d"https://darksky.net/poweredby/" title\x3d"Dark Sky" target\x3d"_blank"\x3eDark Sky\x3c/a\x3e\x3c/span\x3e'},r);m.add(f,"IMTcolSmall");m.add(f,"IMTcolLast")},_getDay:function(f){f=
f.split("-");f="SUN MON TUE WED THU FRI SAT".split(" ")[(new Date(f[0],f[1]-1,f[2])).getDay()];return this.parent.nls[f]},_errorHandler:function(f){console.log(f.message);f=q.create("div",{innerHTML:f.message},this.container);m.add(f,"IMTcolSmall")}})})},"widgets/IncidentAnalysis/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/dom-class dojo/dom-construct dojo/dom-style dojo/on esri/geometry/geometryEngine esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query".split(" "),
function(f,h,m,q,n,u,r,z,w,B,c,a,k,b,d,e){return f("ClosestInfo",null,{constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.distance=this.incident=this.featureLayer=null;this.map=c.map;this.specialFields={}},updateForIncident:function(a,b,d){if(this.featureLayer)this.processIncident(a,b,d);else if(0<this.tab.tabLayers.length){var e=new c(this.tab.tabLayers[0].url);z(e,"load",h.hitch(this,function(){e.capabilities&&-1<e.capabilities.indexOf("Query")?(this.featureLayer=
e,this.processIncident(a,b,d)):this._processError()}));z(this.parent.opLayers,"layerInfosFilterChanged",h.hitch(this,this._layerFilterChanged))}},_layerFilterChanged:function(a){if(null!==this.featureLayer&&null!==this.incident&&null!==this.distance&&null!==this.graphicsLayer){var b=this.tab.tabLayers[0].id;q.forEach(a,h.hitch(this,function(a){b===a.id&&this.processIncident(this.incident,this.distance,this.graphicsLayer)}))}},processIncident:function(a,b,c){this.container.innerHTML="";n.add(this.container,
"loading");var d=[];this.incident=a;this.distance=b;b=w.buffer(a.geometry,b,this.parent.config.distanceSettings[this.parent.config.distanceUnits]);this.graphicsLayer=c;this.graphicsLayer.clear();var f=this.tab.tabLayers[0].id,g="";this.parent.opLayers.traversal(function(a){if(f===a.id&&a.getFilter())return g=a.getFilter(),!0});c=new e;c.returnGeometry=!0;c.geometry=b;c.where=g;c.outFields=this._getFields(this.featureLayer);c.outSpatialReference=this.parent.map.spatialReference;this.featureLayer.queryFeatures(c,
h.hitch(this,function(b){var c=this._getFields(this.featureLayer);b=b.features;if(0<b.length){for(var e=0;e<b.length;e++){for(var f=b[e],g={DISTANCE:this._getDistance(a.geometry,f.geometry)},p=0;p<c.length;p++)g[c[p]]=f.attributes[c[p]];f.attributes=g}b.sort(this._compareDistance);d.push(b[0])}this._processResults(d)}),h.hitch(this,this._processError))},_processError:function(){this.container.innerHTML="";n.remove(this.container,"loading");this.container.innerHTML=this.parent.nls.noFeaturesFound},
_processResults:function(c){this.container.innerHTML="";n.remove(this.container,"loading");0===c.length&&(this.container.innerHTML=this.parent.nls.noFeaturesFound);var e=u.create("div",{id:"tpc",style:"width:"+220*c.length+"px;"},this.container);n.add(e,"IMT_tabPanelContent");for(var f=this.parent.nls[this.parent.config.distanceUnits],g=0;g<c.length;g++){var t=g+1,v=c[g],A=v.geometry,q=A;"point"!==A.type&&(q=A.getExtent().getCenter());var v=v.attributes,D=f+": "+Math.round(100*v.DISTANCE)/100,A="",
y=0,w;for(w in v)"DISTANCE"!==w&&3>y&&(A+=this._getFieldValue(w,v[w])+"\x3cbr/\x3e",y+=1);y=u.create("div",{id:"Feature_"+t},e);n.add(y,"IMTcolRec");var C=u.create("div",{},y);n.add(C,"IMTcolRecBar");var G=u.create("div",{innerHTML:t},C);n.add(G,"IMTcolRecNum");r.set(G,"backgroundColor",this.parent.config.color);z(G,"click",h.hitch(this,this._zoomToLocation,q));D=u.create("div",{innerHTML:D},C);n.add(D,"IMTcolDistance");this.parent.config.enableRouting&&(D=u.create("div",{},C),n.add(D,"IMTcolDir"),
z(D,"click",h.hitch(this,this._routeToIncident,q)));A=u.create("div",{innerHTML:A},y);n.add(A,"IMTcolInfo");A=new k(k.STYLE_SOLID,new m.fromString(this.parent.config.color),1);A=new a(a.STYLE_CIRCLE,24,A,new m.fromString(this.parent.config.color));y=new b;y.family="Arial";y.size="12px";t=new d(t,y,"#ffffff");t.setOffset(0,-4);this.graphicsLayer.add(new B(q,A,v));this.graphicsLayer.add(new B(q,t,v))}},_getFields:function(a){var c=[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)q.forEach(this.tab.advConfig.fields,
function(a){c.push(a.expression)});else{var b;b=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var d=0;d<b.length;d++){var e=b[d];"undefined"!==typeof e.visible?e.visible&&c.push(e.fieldName):c.push(e.name)}}var f={};q.forEach(a.fields,function(a){if("esriFieldTypeDate"===a.type||a.domain)f[a.name]=a});this.specialFields=f;return c},_getFieldValue:function(a,c){var b=c;this.specialFields[a]&&(a=this.specialFields[a],"esriFieldTypeDate"===a.type?b=(new Date(c)).toLocaleString():q.some(a.domain.codedValues,
function(a){if(a.code===c)return b=a.name,!0}));return b},_getDistance:function(a,c){var b=0,d=this.parent.config.distanceUnits,b=w.distance(a,c,9001);switch(d){case "miles":b*=6.21371E-4;break;case "kilometers":b*=.001;break;case "feet":b*=3.28084;break;case "yards":b*=1.09361;break;case "nauticalMiles":b*=5.39957E-4}return b},_compareDistance:function(a,b){return a.attributes.DISTANCE<b.attributes.DISTANCE?-1:a.attributes.DISTANCE>b.attributes.DISTANCE?1:0},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},
_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/IncidentAnalysis/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/dom-class dojo/dom-construct dojo/dom-style dojo/on esri/geometry/geometryEngine esri/geometry/Polyline esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query jimu/CSVUtils".split(" "),
function(f,h,m,q,n,u,r,z,w,B,c,a,k,b,d,e,g,x,l){return f("ProximityInfo",null,{constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.buffer=this.incident=this.featureLayer=null;this.specialFields={}},updateForIncident:function(a,b,c){if(this.featureLayer)this.processIncident(a,b,c);else if(0<this.tab.tabLayers.length){var d=new k(this.tab.tabLayers[0].url);z(d,"load",h.hitch(this,function(){d.capabilities&&-1<d.capabilities.indexOf("Query")?(this.featureLayer=
d,this.processIncident(a,b,c)):this._processError()}));z(this.parent.opLayers,"layerInfosFilterChanged",h.hitch(this,this._layerFilterChanged))}},_layerFilterChanged:function(a){if(null!==this.featureLayer&&null!==this.incident&&null!==this.buffer&&null!==this.graphicsLayer){var b=this.tab.tabLayers[0].id;q.forEach(a,h.hitch(this,function(a){b===a.id&&this.processIncident(this.incident,this.buffer,this.graphicsLayer)}))}},processIncident:function(a,b,c){this.container.innerHTML="";n.add(this.container,
"loading");var d=[];this.incident=a;this.buffer=b;this.graphicsLayer=c;this.graphicsLayer.clear();var e=this.tab.tabLayers[0].id,f="";this.parent.opLayers.traversal(function(a){if(e===a.id&&a.getFilter())return f=a.getFilter(),!0});c=new x;c.returnGeometry=!0;c.geometry=b.geometry;c.where=f;c.outFields=this._getFields(this.featureLayer);c.outSpatialReference=this.parent.map.spatialReference;this.featureLayer.queryFeatures(c,h.hitch(this,function(b){var c=this._getFields(this.featureLayer);b=b.features;
if(0<b.length)for(var e=0;e<b.length;e++){for(var f=b[e],g={DISTANCE:this._getDistance(a.geometry,f.geometry)},h=0;h<c.length;h++)g[c[h]]=f.attributes[c[h]];f.attributes=g;d.push(f)}this._processResults(d)}),h.hitch(this,this._processError))},_processError:function(){this.container.innerHTML="";n.remove(this.container,"loading");this.container.innerHTML=this.parent.nls.noFeaturesFound},_processResults:function(c){this.container.innerHTML="";n.remove(this.container,"loading");this.graphicsLayer.clear();
if(0===c.length)this.container.innerHTML=this.parent.nls.noFeaturesFound;else{c.sort(this._compareDistance);var f=u.create("div",{id:"tpc",style:"width:"+220*(c.length+1)+"px;"},this.container);n.add(f,"IMT_tabPanelContent");var k=u.create("div",{},f);n.add(k,"IMTcol");k=u.create("div",{innerHTML:this.parent.nls.downloadCSV},k);n.add(k,"btnExport");z(k,"click",h.hitch(this,this._exportToCSV,c));for(var k=this.parent.nls[this.parent.config.distanceUnits],p=0;p<c.length;p++){var l=p+1,q=c[p],y=q.geometry,
w=y;"point"!==y.type&&(w=y.getExtent().getCenter());var q=q.attributes,B=k+": "+Math.round(100*q.DISTANCE)/100,y="",x=0,E;for(E in q)"DISTANCE"!==E&&3>x&&(y+=this._getFieldValue(E,q[E])+"\x3cbr/\x3e",x+=1);x=u.create("div",{id:"Feature_"+l},f);n.add(x,"IMTcolRec");var H=u.create("div",{},x);n.add(H,"IMTcolRecBar");var F=u.create("div",{innerHTML:l},H);n.add(F,"IMTcolRecNum");r.set(F,"backgroundColor",this.parent.config.color);z(F,"click",h.hitch(this,this._zoomToLocation,w));B=u.create("div",{innerHTML:B},
H);n.add(B,"IMTcolDistance");this.parent.config.enableRouting&&(B=u.create("div",{},H),n.add(B,"IMTcolDir"),z(B,"click",h.hitch(this,this._routeToIncident,w)));y=u.create("div",{innerHTML:y},x);n.add(y,"IMTcolInfo");y=new d(d.STYLE_SOLID,new m.fromString(this.parent.config.color),1);y=new b(b.STYLE_CIRCLE,24,y,new m.fromString(this.parent.config.color));x=new e;x.family="Arial";x.size="12px";l=new g(l,x,"#ffffff");l.setOffset(0,-4);this.graphicsLayer.add(new a(w,y,q));this.graphicsLayer.add(new a(w,
l,q))}}},_exportToCSV:function(a){if(0===a.length)return!1;var c=this.tab.layers,b=[],d=[];q.forEach(a,function(a){b.push(a.attributes)});for(var e in b[0])d.push(e);l.exportCSV(c,b,d)},_getFields:function(a){var b=[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)q.forEach(this.tab.advConfig.fields,function(a){b.push(a.expression)});else{var c;c=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var d=0;d<c.length;d++){var e=c[d];"undefined"!==typeof e.visible?
e.visible&&b.push(e.fieldName):b.push(e.name)}}var f={};q.forEach(a.fields,function(a){if("esriFieldTypeDate"===a.type||a.domain)f[a.name]=a});this.specialFields=f;return b},_getFieldValue:function(a,b){var c=b;this.specialFields[a]&&(a=this.specialFields[a],"esriFieldTypeDate"===a.type?c=(new Date(b)).toLocaleString():q.some(a.domain.codedValues,function(a){if(a.code===b)return c=a.name,!0}));return c},_getDistance:function(a,b){var d=0;4326===a.spatialReference.wkid&&(a=c.geographicToWebMercator(a));
d="point"===a.type?a:a.getExtent().getCenter();4326===b.spatialReference.wkid&&(b=c.geographicToWebMercator(b));a="point"===b.type?b:b.getExtent().getCenter();b=this.parent.config.distanceUnits;var e=new B(d.spatialReference);e.addPath([d,a]);d=d.spatialReference.isWebMercator()?w.geodesicLength(e,9001):w.planarLength(e,9001);switch(b){case "miles":d*=6.21371E-4;break;case "kilometers":d*=.001;break;case "feet":d*=3.28084;break;case "yards":d*=1.09361;break;case "nauticalMiles":d*=5.39957E-4}return d},
_compareDistance:function(a,b){return a.attributes.DISTANCE<b.attributes.DISTANCE?-1:a.attributes.DISTANCE>b.attributes.DISTANCE?1:0},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/IncidentAnalysis/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/IncidentAnalysis/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv id\x3d"tabPanel0" class\x3d"IMT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"IMT_tabPanelContent" style\x3d"width: 660px"\x3e\r\n          \x3cdiv id\x3d"incidentsLocate" class\x3d"IMTcol"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locate_lbl" class\x3d"label"\x3e\r\n              ${nls.locate_incident}\r\n            \x3c/div\x3e\r\n            \x3cbr/\x3e\r\n            \x3cdiv class\x3d"colBar"\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn0"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn1"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn2"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32 btnClear" data-dojo-attach-event\x3d"onclick:_clear"\x3e \x3cimg id\x3d"btn3"\x3e \x3c/img\x3e \x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv id\x3d"incidentsDistance" class\x3d"IMTcol"\x3e\r\n            \x3cdiv class\x3d"label" data-dojo-attach-point\x3d"buffer_lbl"\x3e\x3c/div\x3e\r\n            \x3cbr/\x3e\r\n            \x3cdiv class\x3d"colBar"\x3e\r\n              \x3cdiv id\x3d"horizontalSliderDiv" data-dojo-attach-point\x3d"horizontalSliderDiv"\x3e\x3c/div\x3e\r\n              \x3cdiv style\x3d"text-align:center; margin-top: -4px;"\x3e\r\n                \x3cinput data-dojo-type\x3d"dijit/form/TextBox" style\x3d"width:60px;align:left;" data-dojo-attach-point\x3d"sliderValue" name\x3d"sliderValue" value\x3d"15" /\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"IMTcol" style\x3d"visibility:hidden"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv class\x3d"label" style\x3d"width:100%;" data-dojo-attach-point\x3d"div_reversed_address"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv id\x3d"panelMessage" data-dojo-attach-point\x3d"messageNode"\x3e\r\n      \x3cspan id\x3d"msgText" data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv id\x3d"panelFooter" data-dojo-attach-point\x3d"footerNode" class\x3d"jimu-main-background"\x3e\r\n      \x3cdiv id\x3d"panelFooterContent" data-dojo-attach-point\x3d"footerContentNode"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv id\x3d"IMT_tabs" data-dojo-attach-point\x3d"tabsNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/IncidentAnalysis/css/style.css":".jimu-widget-IMT {color: #ffffff !important; background-color: #4c4c4c; left: 0px !important; right: 0px !important; bottom: 0px; height: 140px !important; display: block;}.jimu-widget-IMT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-IMT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-IMT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-IMT .panelBottom {position: absolute; width: 100%; height: 140px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-IMT #panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-IMT #panelFooter {position: absolute; bottom: 0px; left: 0px; right: 0px; height: 40px; line-height: 40px; overflow: hidden; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-IMT #panelFooterContent {position: absolute; left: 0px; right: 24px; height: 90px; overflow-x: auto; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-IMT #panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-IMT #panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 40px; line-height: 40px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 18px;}.jimu-rtl .jimu-widget-IMT #panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-IMT .panelContainer {position: absolute; width: 100%; height: 100px; overflow: hidden; display: block;}.jimu-widget-IMT .IMT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 90px; display: none; overflow-x: auto !important; overflow-y: hidden !important;}.jimu-widget-IMT .IMT_tabPanelContent {position: absolute; top: 0px; width: auto; height: 80px; white-space: nowrap; display: block; overflow-x: visible; overflow-y: hidden;}.jimu-widget-IMT #IMT_tabs {position: absolute; white-space: nowrap; height: 40px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-IMT .IMTTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 40px; float: left; line-height: 40px; font-size: 13px; padding: 0 35px 0 10px; background-image: url('images/tab.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .IMTTab {float: right;}.jimu-widget-IMT .active {color: #ffffff; background-color: #353535; background-color: rgba(0, 0, 0, 0.3); background-image: url('images/tabon.png'); background-position: right center; background-repeat: no-repeat;}.jimu-widget-IMT .IMTcol {float: left; height: 80px; width: 220px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcol {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none;}.jimu-widget-IMT .IMTcolSmall {float: left; height: 80px; width: 165px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcolSmall {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none;}.jimu-widget-IMT .IMTcolLast {border-left: none; border-right: none;}.jimu-widget-IMT .IMTcol .label,.jimu-widget-IMT .IMTcolSmall .label {font-size: 13px; padding: 2px 0; overflow: hidden; text-overflow: ellipsis; width: 100%;}.jimu-widget-IMT .IMTcol .colBar {position: relative; height: 32px; display: block;}.jimu-widget-IMT .btn32 {float: left; width: 32px; height: 32px; padding: 0; color: #ffffff; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-radius: 2px; display: block; margin-right: 8px; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .btn32 {float: right;}.jimu-widget-IMT .btn32:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .btn32 img {padding: 8px;}.jimu-widget-IMT .btnClear {background-color: #bb0000; margin-left: 16px;}.jimu-rtl .jimu-widget-IMT .btnClear {margin-right: 16px; margin-left: 0;}.jimu-widget-IMT .btnClear:hover {background-color: #ff0000;}.jimu-widget-IMT .dijitTextBox,.jimu-widget-IMT .dijitTextBoxHover,.jimu-widget-IMT .dijitTextBoxFocused,.jimu-widget-IMT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-IMT .dijitTextBoxFocused,.jimu-widget-IMT .dijitInputInner,.jimu-widget-IMT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-IMT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-IMT .btnExport {background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-radius: 2px; padding: 10px 44px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer;}.jimu-widget-IMT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-IMT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-IMT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-IMT .colSummary {height: 36px; line-height: 36px; font-size: 28px; padding-top: 25px;}.jimu-widget-IMT .IMTcolRec {float: left; height: 80px; width: 220px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-align: left; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcolRec {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none; text-align: right;}.jimu-widget-IMT .IMTcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-IMT .IMTcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #4c4c4c; color: #ffffff; line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-IMT .IMTcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .IMTcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-IMT .IMTcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-IMT .IMTcolInfo {position: relative; margin-top: 4px; height: 60px; line-height: 13px; width: 100%; display: block; overflow: hidden; text-overflow: ellipsis;}.claro .dijitSlider {background: transparent; border: 0 none; -webkit-border-radius: 3px; border-radius: 3px; padding: 0;}.claro .dijitSliderBar {border-style: solid; outline: 1px;}.claro .dijitRuleLabelsContainer {color: #2b2e34;}.claro .dijitSliderDisabled {opacity: 0.65; -ms-filter: \"progid:DXImageTransform.Microsoft.Alpha(Opacity\x3d65)\"; filter: alpha(opacity\x3d65);}.claro .dijitRuleLabelsContainerH {padding: 8px 0 !important; color: #6e6e6e !important;}.claro .dijitSliderBarH,.claro .dijitSliderBumperH {height: 4px;}.claro .dijitSlider .dijitSliderLeftBumper {-webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px; border-width: 1px 0 1px 1px; margin-left: 4px;}.claro .dijitSlider .dijitSliderRightBumper {-webkit-border-radius: 0 2px 2px 0; border-radius: 0 2px 2px 0; border-width: 1px 1px 1px 0; margin-left: -2px; margin-right: 4px;}.claro .dijitSlider .dijitSliderProgressBarH {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSlider .dijitSliderLeftBumper {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none; -webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px;}.claro .dijitSlider .dijitSliderRemainingBarH,.claro .dijitSlider .dijitSliderRightBumper {border-color: #878787; background-color: #878787; -webkit-border-radius: 2px; border-radius: 2px;}.claro .dijitSliderHover .dijitSliderProgressBarH,.claro .dijitSliderHover .dijitSliderLeftBumper {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSliderFocused .dijitSliderProgressBarH,.claro .dijitSliderFocused .dijitSliderLeftBumper {border-color: #ebebeb;}.claro .dijitSliderFocused .dijitSliderRemainingBarH,.claro .dijitSliderFocused .dijitSliderRightBumper {border-color: #878787; background-color: #878787; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSliderImageHandle {background: #ffffff; -webkit-border-radius: 50%; border-radius: 50%; border: 0 none; width: 16px; height: 16px; margin-top: -2px; position: absolute;}.claro .dijitSliderImageHandle:after {content: \"\"; display: block; background: #6e6e6e; -webkit-border-radius: 50%; border-radius: 50%; height: 8px; width: 8px; left: 4px; top: 4px; position: absolute;}.claro .dijitSliderDisabled.dijitSliderFocused .dijitSliderImageHandle:after {display: none; outline: none;}.claro .dijitSliderDecrementIconH,.claro .dijitSliderIncrementIconH {padding: 0; height: 20px; width: 20px; background-color: transparent; border: 0 none;}.IMT_tabPanel::-webkit-scrollbar {width: 6px; height: 6px; background-color: rgba(0, 0, 0, 0.1);}.IMT_tabPanel::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0.4);}.IMT_tabPanel {scrollbar-base-color: #4c4c4c; scrollbar-3dlight-color: #4c4c4c; scrollbar-highlight-color: #4c4c4c; scrollbar-track-color: #444444; scrollbar-arrow-color: #2e2e2e; scrollbar-shadow-color: #4c4c4c; scrollbar-dark-shadow-color: #4c4c4c; scrollbar-face-color: #2e2e2e;}",
"*now":function(f){f(['dojo/i18n!*preload*widgets/IncidentAnalysis/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/LayerInfos/LayerInfos dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/webMercatorUtils esri/graphic esri/layers/GraphicsLayer esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/BufferParameters esri/toolbars/draw ./js/SummaryInfo ./js/WeatherInfo ./js/ClosestInfo ./js/ProximityInfo dojo/keys dojo/domReady!".split(" "),function(f,
h,m,q,n,u,r,z,w,B,c,a,k,b,d,e,g,x,l,p,t,v,A,I,D,y,J,C,G,E,H,F,K,M,O,N,U,L,P,Q,R,S,T){return f([m,h],{baseClass:"jimu-widget-IMT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,tabLayersVisibility:{},toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incident:null,buffer:null,locator:null,stops:[],Incident_Local_Storage_Key:"IMT_Incident",SLIDER_MAX_VALUE:1E4,postCreate:function(){this.inherited(arguments)},
startup:function(){this.inherited(arguments);this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this.SLIDER_MAX_VALUE=this.config.bufferRange.maximum;this.opLayers=this.map.itemInfo.itemData.operationalLayers;this._mapLoaded();this._restoreIncidents()},onOpen:function(){this.inherited(arguments);this._getTabLayersVisibility();this._clickTab(0)},onClose:function(){this._clear();this._toggleTabLayersOld();this._setTabLayersVisibility();this.inherited(arguments)},
onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear();this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);this.lyrProximity&&this.map.addLayer(this.lyrProximity);this.inherited(arguments)},onAppConfigChanged:function(a,b,c){switch(b){case "styleChange":this._updateUI(c);break;case "widgetPoolChange":this._verifyRouting()}},_updateUI:function(a){this._getStyleColor(a)},
_getStyleColor:function(a){var b=this.appConfig.theme.name,e=this.appConfig.theme.styles[0];a&&(e=a);g.get({url:"./themes/"+b+"/manifest.json",handleAs:"json",load:d.hitch(this,function(a){a=a.styles;for(var b=0;b<a.length;b++){var d=a[b];d.name===e&&(c.set(this.footerNode,"background-color",d.styleColor),this.config.color=d.styleColor,this._setupSymbols(),this._bufferIncident())}})})},setPosition:function(a,b){if("BoxTheme"===this.appConfig.theme.name||"DartTheme"===this.appConfig.theme.name||"LaunchpadTheme"===
this.appConfig.theme.name)this.inherited(arguments);else{this.position={left:"0px",right:"0px",bottom:"0px",height:"140px"};var c=n.getPositionStyle(this.position);c.position="absolute";b=this.map.id;z.place(this.domNode,b);z.setStyle(this.domNode,c);this.started&&this.resize();"TabTheme"===this.appConfig.theme.name&&(c=this.widgetManager.getControllerWidgets()[0],this.widgetManager.minimizeWidget(c.id))}},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&
this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(a){this.onReceiveData("","",{eventType:"IncidentLocation",dataValue:a})},_initLayers:function(){this.locator=new N(this.config.geocodeService.url);this.own(B(this.locator,"location-to-address-complete",d.hitch(this,this._showIncidentAddress)));this.own(B(this.locator,"error",d.hitch(this,this._onAddressError)));this.lyrBuffer=new E;this.map.addLayer(this.lyrBuffer);this.lyrIncidents=new E;this.map.addLayer(this.lyrIncidents);this.lyrClosest=
new E;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new E;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity)},_mapLoaded:function(){x("[data-reference]").style("z-index",0);this.map.itemId&&u.getInstance(this.map,this.map.itemInfo).then(d.hitch(this,function(a){this.opLayers=a;this._processOperationalLayers()}));this._clickTab(0)},_processOperationalLayers:function(){for(var a=0;a<this.config.tabs.length;a++){var b=this.config.tabs[a];
b.layers&&""!==b.layers&&(b.tabLayers=this._getTabLayers(b.layers,!1),0===b.tabLayers.length&&(b.tabLayers=this._getTabLayers(b.layers,!0)))}},_createUI:function(){var e=this.config.distanceUnits,f=n.sanitizeHTML(this.config.bufferLabel?this.config.bufferLabel:""),f=f+(" ("+this.nls[e]+")");this.buffer_lbl.innerHTML=f;this.buffer_lbl.title=f;e=w.byId("horizontalSliderDiv");f=document.createElement("div");e.appendChild(f);f=document.createElement("div");e.appendChild(f);var f=new t({container:"bottomDecoration",
minimum:this.config.bufferRange.minimum,maximum:this.config.bufferRange.maximum,labels:[this.config.bufferRange.minimum,this.config.bufferRange.maximum],style:"height:2em;font-size:75%;color:#fff"},f),g=Math.abs(Math.round(this.config.bufferRange.maximum-this.config.bufferRange.minimum))+1,h=this.config.bufferRange.minimum+10;h>this.config.bufferRange.maximum&&(h=this.config.bufferRange.minimum);this.horizontalSlider=new p({value:h,minimum:this.config.bufferRange.minimum,maximum:this.config.bufferRange.maximum,
discreteValues:g,intermediateChanges:!1,showButtons:!1,style:"width:180px;"},e);this.own(B(this.horizontalSlider,"change",d.hitch(this,this._sliderChange)));this.horizontalSlider.startup();f.startup();this.sliderValue.set("value",h);e={type:"incidents",label:this.nls.incident,color:this.config.color};this.config.incidentLabel&&(e.label=this.config.incidentLabel);this.config.locateLabel&&(this.locate_lbl.innerHTML=this.config.locateLabel);this.config.tabs.splice(0,0,e);e=this.panelContainer;f=w.byId("IMT_tabs");
for(h=g=0;h<this.config.tabs.length;h++){var l=this.config.tabs[h],m=l.label;"weather"===l.type&&(m=this.nls.weather);m&&""!==m||(m=l.title||l.layers);m=k.create("div",{id:"tab"+h,innerHTML:n.sanitizeHTML(m?m:"")},f);a.add(m,"IMTTab");g+=b.position(m).w;B(m,"click",d.hitch(this,this._clickTab,h));0<h&&(m=k.create("div",{id:"tabPanel"+h,innerHTML:this.nls.defaultTabMsg},e),a.add(m,"IMT_tabPanel"),"summary"===l.type&&(l.summaryInfo=new P(l,m,this)),"weather"===l.type&&(l.weatherInfo=new Q(l,m,this)),
"closest"===l.type&&(l.closestInfo=new R(l,m,this)),"proximity"===l.type&&(l.proximityInfo=new S(l,m,this)))}c.set(f,"width",g+10+"px")},_loadUI:function(){for(var a=0;4>a;a++){var b=w.byId("btn"+a);z.setAttr(b,"src",this.folderUrl+"images/btn"+a+".png");this.own(B(b,"click",d.hitch(this,this._clickIncidentsButton,a)))}this.toolbar=new L(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-end",d.hitch(this,this._drawIncident));this.own(B(this.horizontalSlider,"change",d.hitch(this,this._sliderChange)));
this.own(B(this.sliderValue,"keyup",d.hitch(this,function(a){a.keyCode===T.ENTER?this._updateSliderValue():(a=this.sliderValue.get("value"),isNaN(a)?this.sliderValue.set("value",this.horizontalSlider.value):(a<this.config.bufferRange.minimum&&this.sliderValue.set("value",this.config.bufferRange.minimum),a>this.SLIDER_MAX_VALUE&&this.sliderValue.set("value",this.SLIDER_MAX_VALUE)))})))},_locateBuffer:function(a){if(null!==a&&(a="extent"===a.type?a:a.geometry.getExtent(),null!==a)){a=a.expand(1.5);
var b=80/this.map.height,c=a.getHeight();a.update(a.xmin,a.ymin-c*b,a.xmax,a.ymax-c*b,this.map.spatialReference);this.map.setExtent(a,!0)}},_clickIncidentsButton:function(b){var c;if(3>b){for(var d=0;3>d;d++)c=w.byId("btn"+d),a.remove(c,"btnOn");-1<b&&b!==this.tool?(c=w.byId("btn"+b),a.add(c,"btnOn"),this.tool=b):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear();this.toolbar.activate(L.POINT);this.disableWebMapPopup();break;case 1:this._clear();
this.toolbar.activate(L.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(),this.toolbar.activate(L.POLYGON),this.disableWebMapPopup()}}else this._clear()},_clear:function(){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.buffer=this.incident=null;this.div_reversed_address.innerHTML="";z.setStyle(this.div_reverse_geocoding,"visibility","hidden");for(var a=1;a<this.config.tabs.length;a++)w.byId("tabPanel"+
a)&&(w.byId("tabPanel"+a).innerHTML=this.nls.defaultTabMsg)},_sliderChange:function(){this.sliderValue.set("value",this.horizontalSlider.value);this._bufferIncident()},_sliderTextChange:function(){0>this.sliderValue.value||this.sliderValue.value>this.SLIDER_MAX_VALUE?this.sliderValue.set("value",this.horizontalSlider.value):this.horizontalSlider.set("value",this.sliderValue.value)},_updateSliderValue:function(){0>this.sliderValue.displayedValue||this.sliderValue.displayedValue>this.SLIDER_MAX_VALUE?
this.sliderValue.set("value",this.horizontalSlider.value):this.horizontalSlider.set("value",this.sliderValue.displayedValue)},_clickTab:function(a){this._toggleTabs(a);this._toggleTabLayers(a);this.curTab=a;this._clickIncidentsButton(-1)},_toggleTabs:function(b){for(var d=0;d<this.config.tabs.length;d++)d===b?(a.add("tab"+d,"active"),c.set("tabPanel"+d,"display","block")):(a.remove("tab"+d,"active"),c.set("tabPanel"+d,"display","none"));this._scrollToTab(b)},_getTabLayersVisibility:function(){this.config.disableLayerManagement||
(e.forEach(this.config.tabs,d.hitch(this,function(a){e.forEach(a.tabLayers,d.hitch(this,function(a){"undefined"!==typeof a.visible&&(this.tabLayersVisibility[a.id]=a.visible?!0:!1)}))})),e.forEach(this.config.tabs,d.hitch(this,function(a){e.forEach(a.tabLayers,d.hitch(this,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!1)}))})))},_setTabLayersVisibility:function(){this.config.disableLayerManagement||e.forEach(this.config.tabs,d.hitch(this,function(a){e.forEach(a.tabLayers,d.hitch(this,
function(a){a.id in this.tabLayersVisibility&&a.setVisibility(this.tabLayersVisibility[a.id])}))}))},_toggleTabLayers:function(a){this._toggleTabLayersOld();this._toggleTabLayersNew(a)},_toggleTabLayersOld:function(){var a=this.config.tabs[this.curTab];a&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),this.config.disableLayerManagement||a.tabLayers&&e.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!1)}))},_toggleTabLayersNew:function(a){a=this.config.tabs[a];
switch(a.type){case "summary":this.incident&&!0===a.updateFlag&&(a.summaryInfo.updateForIncident(this.incident,this.buffer),a.updateFlag=!1);break;case "weather":this.incident&&!0===a.updateFlag&&(a.weatherInfo.updateForIncident(this.incident),a.updateFlag=!1);break;case "closest":this.lyrClosest.setVisibility(!0);this.incident&&(a.closestInfo.updateForIncident(this.incident,this.config.maxDistance,this.lyrClosest),a.updateFlag=!1);break;case "proximity":this.lyrProximity.setVisibility(!0),this.incident&&
(a.proximityInfo.updateForIncident(this.incident,this.buffer,this.lyrProximity),a.updateFlag=!1)}a.updateFlag=!1;this.config.disableLayerManagement||a.tabLayers&&e.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)})},_drawIncident:function(a){var b=a.geometry.type,c=this.symPoint;"polyline"===b&&(c=this.symLine);"polygon"===b&&(c=this.symPoly);this.incident=new G(a.geometry,c);this.lyrIncidents.add(this.incident);this.toolbar.deactivate();this._clickIncidentsButton(-1);
this._bufferIncident();"point"===b&&this._getIncidentAddress(a.geometry);this.div_reversed_address.innerHTML="";z.setStyle(this.div_reverse_geocoding,"visibility","hidden")},_getIncidentAddress:function(a){this.map.graphics.clear();this.locator.locationToAddress(a,100)},_showIncidentAddress:function(a){if(a.address.address){var b=a.address.address.Address,c=a.address.location,d=new H;d.family="Arial";d.size="18px";d=new O(b,d,"#000000");d.setOffset(20,-4);d.horizontalAlignment="left";this.map.graphics.add(new G(c,
d,{}));b+="\x3c/br\x3e";a.address.address.City&&(b+=a.address.address.City+", ");a.address.address.Region&&(b+=a.address.address.Region);a.address.address.Postal&&(b+=" "+a.address.address.Postal);this.div_reversed_address.innerHTML=b;z.setStyle(this.div_reverse_geocoding,"visibility","visible")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;z.setStyle(this.div_reverse_geocoding,"visibility","visible")},_bufferIncident:function(){if(null!==this.incident){for(var a=
0;a<this.config.tabs.length;a++)this.config.tabs[a].updateFlag=!0;a=this.incident;this.buffer=null;this.lyrBuffer.clear();var b=this.horizontalSlider.value,c=this.config.distanceSettings[this.config.distanceUnits];0===b&&(b=.001);if(0<b){var d=a.geometry.spatialReference.wkid,a=4326===d||3857===d||102100===d?A.geodesicBuffer(a.geometry,b,c):A.buffer(a.geometry,b,c);this._locateBuffer(a.getExtent());this.buffer=new G(a,this.symBuffer);this.lyrBuffer.add(this.buffer);this._performAnalysis()}}},_performAnalysis:function(){this._toggleTabLayersNew(this.curTab)},
_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=!1;var a=this.appConfig.getConfigElementsByName("Directions");e.forEach(a,d.hitch(this,function(a){"Directions"===a.name&&(this.dirConfig=a,this.config.enableRouting=!0)}))}},zoomToLocation:function(a){this.map.centerAt(a)},routeToIncident:function(a){var b=this.incident.geometry,c=b;"point"!==b.type&&(c=b.getExtent().getCenter());this.stops=[a,c];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(d.hitch(this,
function(a){a.addStop(this.stops[0]);a.addStop(this.stops[1])}))},_getTabLayers:function(a,b){var c=[];e.forEach(this.opLayers._layerInfos,d.hitch(this,function(d){var e=d.originOperLayer.layerType;if(0<d.newSubLayers.length)this._recurseOpLayers(d.newSubLayers,c,a,b);else{var f=d.id;b&&(f=d.title);a===f&&("ArcGISFeatureLayer"===e&&d.originOperLayer.featureCollection?c.push(d.originOperLayer):c.push(d.layerObject))}}));return c},_recurseOpLayers:function(a,b,c,f){e.forEach(a,d.hitch(this,function(a){var d=
a.originOperLayer.layerType;if(0<a.newSubLayers.length)this._recurseOpLayers(a.newSubLayers,b,c);else{var e=a.id;f&&(e=a.title);c===e&&("ArcGISFeatureLayer"===d&&a.originOperLayer.featureCollection?b.push(a.originOperLayer):(a.layerObject.id=a.layerObject.id?a.layerObject.id:a.id,b.push(a.layerObject)))}}))},_setupSymbols:function(){var a=r.fromString(this.config.color),b=a.toRgb();b.push(.2);var c=r.fromString("#000000"),a=r.blendColors(a,c,.2).toRgb(),c=new F(F.STYLE_SOLID,new r([255,255,255,.25]),
1);this.symPoint=new M(M.STYLE_CIRCLE,20,c,new r([a[0],a[1],a[2],.7]));this.symLine=new F(F.STYLE_SOLID,new r([a[0],a[1],a[2],.7]),3);this.symPoly=new K(K.STYLE_SOLID,this.symLine,new r([a[0],a[1],a[2],.3]));this.symBuffer=new K(K.STYLE_SOLID,c,new r(b))},onReceiveData:function(a,b,c){null!==c&&c.eventType&&("IncidentLocation"===c.eventType?c.dataValue&&null!==c.dataValue&&(this._clear(),this._clickTab(0),a=c.dataValue,a.attributes[this.shapeFlagFieldName]?(this.incident=a,this._bufferIncident()):
this._drawIncident(a)):"WebMapChanged"===c.eventType&&this._storeIncidents())},_storeIncidents:function(){if(null!==this.incident){var a={location:l.stringify(this.incident.geometry),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.horizontalSlider.value,unit:this.config.distanceUnits},a=l.stringify(a);window.localStorage.setItem(this.Incident_Local_Storage_Key,a);console.log("Inclident saved to storage")}this.publishData({eventType:"WebMapChangedACK"});console.log("eventType WebMapChangedACK fired")},
_restoreIncidents:function(){var a=window.localStorage.getItem(this.Incident_Local_Storage_Key);if(null!==a&&"null"!==a){window.localStorage.setItem(this.Incident_Local_Storage_Key,null);var a=l.parse(a,!0),b=a.buffer_dist;this.sliderValue.set("value",b);this.horizontalSlider.set("value",b);var b=l.parse(a.location),c=a.hasBuffer;if(b){var a={},d=null;"extent"===b.type?d=new v(b):"multipoint"===b.type?d=new y(b):"point"===b.type?d=new D(b):"polygon"===b.type?d=new I(b):"polyline"===b.type&&(d=new J(b));
a.geometry=d;this._drawIncident(a,c)}}},_scrollToTab:function(a){var c=b.position(this.footerContentNode).w;b.position(this.tabsNode).w>c&&(a=b.getMarginBox("tab"+a),this.footerContentNode.scrollLeft=a.l-(c-a.w)/2)},_close:function(){this.widgetManager.closeWidget(this.id)}})});