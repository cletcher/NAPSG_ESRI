// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/has dojo/topic esri/toolbars/draw esri/graphic esri/geometry/Polyline esri/geometry/geometryEngine jimu/utils ./Feedback".split(" "),function(m,g,n,q,e,h,p,k,l,r,f){f=m([f],{constructor:function(a){m.safeMixin(this,a);this.syncEvents()},syncEvents:function(){e.subscribe("manual-startpoint-input",g.hitch(this,this.onLineStartManualInputHandler));e.subscribe("manual-line-end-point-input",g.hitch(this,this.onLineEndManualInputHandler));
e.subscribe("clear-points",g.hitch(this,this.clearPoints))},clearPoints:function(a){a&&(this._points=[],this.map.graphics.clear())},onLineStartManualInputHandler:function(a){this._points=[];this._points.push(a.offset(0,0));this.set("startPoint",this._points[0]);this.map.centerAt(a)},onLineEndManualInputHandler:function(a){this._points.push(a.offset(0,0));this.set("endPoint",this._points[1])},getAngle:function(a,b){var c=null,c=(180*Math.atan2(b.x-a.x,b.y-a.y)/Math.PI+360)%360;"mils"===this.angleUnit&&
(c*=17.777777778);return c.toFixed(2)},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c;this._points.push(a);switch(this._geometryType){case h.POINT:this.set("startPoint",this._points[0]);this.set("endPoint",this._points[0]);this._drawEnd(a);this._setTooltipMessage(0);break;case h.POLYLINE:if(2===this._points.length){this.set("endPoint",this._points[1]);this._onDblClickHandler();return}1===this._points.length?
(this.set("startPoint",this._points[0]),c=new k(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new p(c,this.lineSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=n.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new p(new k({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0)):(this.set("endPoint",this._points[1]),this._graphic.geometry._insertPoints([a],
0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a),c.setPoint(0,1,a),b.setGeometry(c))}this._setTooltipMessage(this._points.length);1===this._points.length&&"polyline"===this._geometryType&&(a=this._tooltip)&&(a.innerHTML=r.sanitizeHTML(this.nls.clickToFinishLineMessage))},_onDblClickHandler:function(a){var b=this._points,c=this.map.spatialReference;q("esri-touch")&&a&&b.push(a.mapPoint);a=new k({paths:[[[b[0].x,b[0].y],
[b[1].x,b[1].y]]],spatialReference:c});a.geodesicLength=l.geodesicLength(a,9001);n.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._geometryType===h.POLYLINE?this._points[0]:this._points[this._points.length-1];a=b||a.mapPoint;var d=this._tGraphic.geometry;d.setPoint(0,0,{x:c.x,y:c.y});d.setPoint(0,1,{x:a.x,y:a.y});b=l.geodesicDensify(d,
10001);d=l.geodesicLength(d,9001);this._graphic.setGeometry(b);b=this.coordTool.convertMetersToUnits(d,this.lengthUnit);c=this.getAngle(c,a);e.publish("DD_LINE_LENGTH_DID_CHANGE",b);e.publish("DD_LINE_ANGLE_DID_CHANGE",c)}});f.drawnLineLengthDidChange="DD_LINE_LENGTH_DID_CHANGE";f.drawnLineAngleDidChange="DD_LINE_ANGLE_DID_CHANGE";return f});