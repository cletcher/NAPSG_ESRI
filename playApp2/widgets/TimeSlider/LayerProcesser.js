// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dijit/_WidgetBase ./utils".split(" "),function(g,f,e,h,k,d){return g([k,h],{nls:null,map:null,layerInfosObj:null,setLayerInfosObj:function(a){this.layerInfosObj=a},setTimeSlider:function(a){this.timeSlider=a},processTimeDisableLayer:function(){var a=0,c,b,a=0;for(c=this.map.layerIds.length;a<c;a++)b=this.map.layerIds[a],b=this.map.getLayer(b),this._processTimeUpdate(b);a=0;for(c=this.map.graphicsLayerIds.length;a<c;a++)b=this.map.graphicsLayerIds[a],
b=this.map.getLayer(b),this._processTimeUpdate(b)},_processTimeUpdate:function(a){var c=d.isLayerEnabledTime(a,this.layerInfosObj);a.setUseMapTime&&(!0!==c?a.setUseMapTime(!1):a.setUseMapTime(!0))},processerDisableLayers:function(a){a&&a.disabledLayers&&e.map(a.disabledLayers,f.hitch(this,function(a){!0!==a.isTimeEnabled&&(a=this.layerInfosObj.getLayerInfoById(a.layerId))&&a.layerObject&&a.layerObject.setUseMapTime&&a.layerObject.setUseMapTime(!1)}))},hasVisibleTemporalLayer:function(){var a=0,c,
b,a=0;for(c=this.map.layerIds.length;a<c;a++)if(b=this.map.layerIds[a],b=this.map.getLayer(b),this._isTimeTemporalLayer(b,!0))return!0;a=0;for(c=this.map.graphicsLayerIds.length;a<c;a++)if(b=this.map.graphicsLayerIds[a],b=this.map.getLayer(b),this._isTimeTemporalLayer(b,!0))return!0;return!1},_isTimeTemporalLayer:function(a,c){if(!a)return!1;var b=a&&a.timeInfo&&a.useMapTime;!0===c&&(b=b&&a.visible);if(b)if("esri.layers.KMLLayer"===a.declaredClass){if(a=a.getLayers(),e.some(a,function(a){return a.timeInfo&&
a.timeInfo.timeExtent?!0:!1}))return!0}else{if(a.timeInfo&&a.timeInfo.timeExtent)return!0}else return!1},_getVisibleTemporalLayerNames:function(){var a=0,c,b,d=[],a=0;for(c=this.map.layerIds.length;a<c;a++)b=this.map.layerIds[a],b=this.map.getLayer(b),this._isTimeTemporalLayer(b,!0)&&d.push(b.id);a=0;for(c=this.map.graphicsLayerIds.length;a<c;a++)b=this.map.graphicsLayerIds[a],b=this.map.getLayer(b),this._isTimeTemporalLayer(b,!0)&&d.push(b.id);return e.map(d,f.hitch(this,function(a){return this.layerInfosObj.getLayerInfoById(a).title||
""}))},_onLayerInfosIsShowInMapChanged:function(a){e.some(a,f.hitch(this,function(a){for(var b=null;!b;)b=this.map.getLayer(a.id),a=a.parentLayerInfo;return this.layerProcesser._isTimeTemporalLayer(b)}))&&this.layerProcesser._onTimeTemportalLayerChanged(this)},_onLayerInfosChanged:function(a,c,b){"added"===c?(a=this.map.getLayer(b.id),this.layerProcesser._isTimeTemporalLayer(a,!0)&&this.layerProcesser._onTimeTemportalLayerChanged(this)):"removed"===c&&this.layerProcesser._onTimeTemportalLayerChanged(this)},
_onTimeTemportalLayerChanged:function(a){"closed"!==a.state&&(a.layerProcesser.hasVisibleTemporalLayer()?a.timeSlider?a.updateLayerLabel():a.showTimeSlider():a.timeSlider&&a.closeTimeSlider())},hasLiveDataLayer:function(){var a=0,c,b,a=0;for(c=this.map.layerIds.length;a<c;a++)if(b=this.map.layerIds[a],b=this.map.getLayer(b),d.hasLiveData(b))return!0;a=0;for(c=this.map.graphicsLayerIds.length;a<c;a++)if(b=this.map.graphicsLayerIds[a],b=this.map.getLayer(b),d.hasLiveData(b))return!0;return!1}})});