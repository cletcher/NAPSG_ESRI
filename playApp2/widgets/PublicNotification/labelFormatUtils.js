// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/graphic ./generalUtils".split(" "),function(e,r,m,t,n,f,u,v,w){var g={convertPopupToLabelSpec:function(a){a=w.sanitizeNoTags(g.convertBreaksToEOLs(g.convertEndParasToEOLs(a))).trim();a=a.replace(/\{/gi,"${");a=a.replace(/\u00a0/gi," ");a=a.split("\n");return a=e.map(a,function(a){return a.trim()})},createLabelsFromFeatures:function(a,b){var c=new m,d=[],k=[],f=0;b.relationships?
(e.forEach(a,function(a){g.objEach(b.relationships,function(c,d){var f=new m,l=c.relatedQuery,h;k.push(f);h=a.attributes[c.operLayer.layerObject.objectIdField];l.objectIds=[h];c.operLayer.layerObject.queryRelatedFeatures(l,function(c){var l=[];c[h]&&c[h].features&&(c=c[h].features,e.forEach(c,function(c){var f=[],k,h,p,q;k=a.attributes;h="relationships/"+d+"/";g.objEach(c.attributes,function(a,c){p=h+c;k[p]=a});q=new v(a.geometry,null,k);e.forEach(b,function(a){f.push(n.substitute(a,g.combineFeatureAttributesAndExpressionResolutions(q,
b.parsedExpressions),g.useEmptyStringForNull))});l.push(f)}));f.resolve(l)})})}),t(k).then(function(a){e.forEach(a,function(a){e.forEach(a,function(a){++f;d.push(a)})});console.log(f+" related address features found");c.resolve(d)})):(e.forEach(a,function(a){var c=[];e.forEach(b,function(d){c.push(n.substitute(d,g.combineFeatureAttributesAndExpressionResolutions(a,b.parsedExpressions),g.useEmptyStringForNull))});d.push(c)}),c.resolve(d));return c},parseArcadeExpressions:function(a){var b;Array.isArray(a)&&
0<a.length&&(b={},e.forEach(a,function(a){b[a.name]=f.parseScript(a.expression)}));return b},initArcadeContext:function(a){var b={vars:{}};b.vars.$feature=u.createFromGraphicLikeObject(a.geometry,a.attributes);return b},combineFeatureAttributesAndExpressionResolutions:function(a,b){var c,d,e;c=r.mixin({},a.attributes);if(b)for(d in a=g.initArcadeContext(a),b)e=f.executeScript(b[d],a),c["expression/"+d]=e?e.toString():"";return c},convertEndParasToEOLs:function(a){var b=a;a=a.match(/<\/p>/gi);e.forEach(a,
function(a){b=b.replace(a,"\n")});return b},convertBreaksToEOLs:function(a){var b=a;a=a.match(/<br\s*\/?>/gi);e.forEach(a,function(a){b=b.replace(a,"\n")});return b},useEmptyStringForNull:function(a){return a?a:""},objEach:function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d)}};return g});