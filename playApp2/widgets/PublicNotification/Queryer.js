// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/Deferred esri/geometry/geometryEngineAsync esri/tasks/BufferParameters esri/tasks/GeometryService esri/tasks/query esri/tasks/QueryTask".split(" "),function(n,p,g,h,k,m,l,q,r){return p([],{constructor:function(f,b){this.map=f;this._geometryService=new l(b)},createUnionOfGeometries:function(f){var b;b=new h;if(!Array.isArray(f))return b.reject("No geometries to buffer"),b;k.union(f).then(g.hitch(this,function(c){c?b.resolve(c):b.reject("Unioning failed")}),
g.hitch(this,function(){b.reject("Unioning failed")}));return b},createBufferFromGeometries:function(f,b){var c,d,e;c=new h;if(!Array.isArray(f))return c.reject("No geometries to buffer"),c;d=b;k.union(f).then(g.hitch(this,function(a){a?0<d||"polygon"===a.type?(0===d&&(d=-.1),e=new m,e.bufferSpatialReference=this.map.spatialReference,e.distances=[d],e.geodesic=!0,e.geometries=[a],e.outSpatialReference=this.map.spatialReference,e.unit=l.UNIT_METER,this._geometryService.buffer(e,function(a){Array.isArray(a)&&
0<a.length?c.resolve(a[0]):c.reject("Buffering failed")},function(a){c.reject("Buffering failed: "+a)})):c.resolve(a):c.reject("Unioning failed")}),function(a){c.reject(a)});return c},findIntersectingFeatures:function(f,b,c){var d,e=new h,a={};b=new r(b);d=new q;d.geometry=f;d.returnGeometry=!0;d.outFields=c;b.execute(d,g.hitch(this,function(b){b&&Array.isArray(b.features)&&0<b.features.length?k.union(this._getFeatureGeometries(b.features)).then(g.hitch(this,function(c){var d;Array.isArray(c.rings)&&
0<c.rings.length?(d=new m,d.bufferSpatialReference=this.map.spatialReference,d.distances=[-.1],d.geodesic=!0,d.geometries=[c],d.outSpatialReference=this.map.spatialReference,d.unit=l.UNIT_METER,this._geometryService.buffer(d,function(c){Array.isArray(c)&&0<c.length?(a.intersectGeometry=f,a.features=b.features,a.highlight=c[0],e.resolve(a)):e.reject("Buffering union failed")})):(a.intersectGeometry=f,a.features=b.features,a.highlight=c,e.resolve(a))})):(a.intersectGeometry=f,a.features=[],a.highlight=
null,e.resolve(a))}),function(a){e.reject(a)});return e},find:function(f,b,c,d){var e=new h;this.findIntersectingFeatures(f,b,c).then(g.hitch(this,function(a){console.log(a.features.length+" "+d+" features found");e.resolve(a)}),function(a){e.reject(a)});return e},_getFeatureGeometries:function(f){return n.map(f,g.hitch(this,function(b){return b.geometry}))}})});