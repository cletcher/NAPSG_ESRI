// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/Evented dojo/dom-construct dojo/_base/html dojo/_base/array dojo/query dojo/on dojo/dom-style jimu/dijit/Popup jimu/dijit/CheckBox dojo/NodeList-data".split(" "),function(p,q,c,r,l,e,g,f,k,m,t,n){return p([q,r],{baseClass:"jimu-widget-screening",selectedFields:[],fieldsPopup:null,_selectAllCheckBox:null,_selectAllCheckBoxHandle:null,_fieldsCheckBoxChangeHandle:[],constructor:function(a){this.selectedFields=[];this._selectAllCheckBoxHandle=
this._selectAllCheckBox=this.fieldsPopup=null;this._fieldsCheckBoxChangeHandle=[];c.mixin(this,a)},startup:function(){this._populateConfiguredFields();this._populateSelectedFields();this.onFieldsSelectorClick();k(window,"resize",c.hitch(this,function(){this._setFieldPopupDimensions()}))},_populateConfiguredFields:function(){for(var a in this.outFields)this.selectedFields.push(a)},_populateSelectedFields:function(){null!==this.retainSelectedFieldsArr&&(this.selectedFields=this.retainSelectedFieldsArr)},
_resetSelectAllCheckboxStatus:function(){var a;a=!0;this._fieldsCheckBox.forEach(function(b){b.checked||(a=!1)});a?(this._selectAllCheckBoxHandle[0].pause(),this._selectAllCheckBox.check()):(this._selectAllCheckBoxHandle[0].pause(),this._selectAllCheckBox.uncheck(!0));this._selectAllCheckBoxHandle[0].resume()},_attachFieldCheckBoxChangeEvent:function(a){this._fieldsCheckBoxChangeHandle.push(this.own(k.pausable(a,"change",c.hitch(this,function(){this._resetSelectAllCheckboxStatus()}))))},_pauseFieldCheckBoxEvent:function(){this._fieldsCheckBoxChangeHandle.forEach(function(a){a[0].pause()})},
_resumeFieldCheckBoxEvent:function(){this._fieldsCheckBoxChangeHandle.forEach(function(a){a[0].resume()})},onFieldsSelectorClick:function(){var a,b,h,g=0;b=e.create("div",{});l.create("div",{"class":"esriCTSelectFieldReportLabel",innerHTML:this.fieldTitle},b);h=l.create("div",{"class":"esriCTSelectAllReportLabel"},b);this._selectAllCheckBox=new n({checked:!1,label:this.nls.reportsTab.selectAllLabel});this._selectAllCheckBoxHandle=this.own(k.pausable(this._selectAllCheckBox,"change",c.hitch(this,function(a){this._pauseFieldCheckBoxEvent();
a?this._fieldsCheckBox.forEach(function(a){a.check()}):this._fieldsCheckBox.forEach(function(a){a.uncheck(!0)});this._resumeFieldCheckBoxEvent()})));this._selectAllCheckBox.placeAt(h);h=e.create("div",{"class":"esriCTSelectFieldParentContainer",style:{maxHeight:"350px"}},b);this._fieldsCheckBox=[];for(a in this.outFields){var d=new n({checked:this._isSearchable(this.outFields[a]),label:this.outFields[a].label||this.outFields[a].alias||a});this._attachFieldCheckBoxChangeEvent(d);e.addClass(d.domNode,
"esriCTLayerFieldCheckbox");e.addClass(d.labelNode,"jimu-ellipsis");e.setAttr(d.domNode,{title:this.outFields[a].label||this.outFields[a].alias||a});"DartTheme"===this.appConfig.theme.name&&m.set(d.domNode.children[0],"backgroundColor","#4c4c4c");0===g%3&&(window.isRTL?e.setStyle(d.domNode,"marginRight",0):e.setStyle(d.domNode,"marginLeft",0));d.placeAt(h);f(d.domNode).data("fieldName",a);this._fieldsCheckBox.push(d);g++}this.fieldsPopup=new t({titleLabel:this.popupTitle,autoHeight:!0,content:b,container:window.jimuConfig.layoutId,
width:640,maxHeight:600,buttons:[{label:this.nls.common.ok,onClick:c.hitch(this,"_onSearchFieldsOk")},{label:this.nls.common.cancel,onClick:c.hitch(this,"_onCancelClick")}],onClose:c.hitch(this,function(){this.fieldsPopup=null;this.emit("onClose")})});e.addClass(this.fieldsPopup.domNode,this.appConfig.theme.name+"  "+this.baseClass);this._setFieldPopupDimensions();this._resetSelectAllCheckboxStatus()},_setFieldPopupDimensions:function(){this.fieldsPopup&&(window.appInfo.isRunInMobile?(this.fieldsPopup.set("width",
window.innerWidth-100),f(".esriCTLayerFieldCheckbox").addClass("esriCTLayerFieldWithoutMargin"),m.set(f(".esriCTSelectFieldParentContainer")[0],"height","200px")):(this.fieldsPopup.set("width",640),this.fieldsPopup.set("maxHeight",600),f(".esriCTLayerFieldCheckbox").removeClass("esriCTLayerFieldWithoutMargin")))},_isSearchable:function(a){return g.some(this.selectedFields,c.hitch(this,function(b){return a.hasOwnProperty("name")?a.name===b:a.hasOwnProperty("fieldName")?a.fieldName===b:!1}))},_onSearchFieldsOk:function(){var a=
[];g.forEach(this._fieldsCheckBox,function(b){if(b.getValue()){var c=f(b.domNode).data("fieldName");a.push(c[0]);f(b.domNode).removeData()}});this.setSearchFields(a);this.fieldsPopup.close();this.emit("onFieldSelectComplete",this.selectedFields)},_onCancelClick:function(){this.fieldsPopup.close();this.emit("onCancel")},_getSearchFields:function(){return this.selectedFields},setSearchFields:function(a){this.selectedFields=a}})});