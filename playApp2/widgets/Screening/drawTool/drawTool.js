// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/drawTool/drawTool.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTDrawBoxLabel"\x3e${nls.drawToolWidget.useDrawToolForAOILabel}\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTDrawToolIconsParentDiv" data-dojo-attach-point\x3d"drawToolIconsParentDiv"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTSelectToolParentDiv" data-dojo-attach-point\x3d"selectToolParent"\x3e\r\n    \x3cdiv class\x3d"esriCTSelectToolDiv" data-dojo-attach-point\x3d"selectToolDiv"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTWidgetAndBufferSeparator esriCTHidden" data-dojo-attach-point\x3d"seperatorAfterSelect"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!-- Layer chooser starts --\x3e\r\n  \x3cdiv class\x3d"esriCTParentDivOfChooseSymbol esriCTHidden" data-dojo-attach-point\x3d"parentDivOfChooseSymbol"\x3e\r\n    \x3cdiv class\x3d"esriCTExpandCollapseParentContainer"\x3e\r\n      \x3cdiv class\x3d"esriCTLayerPanelOfSelectIcon esriCTLayerPanelExpandIcon" data-dojo-attach-point\x3d"layerSectionIcon"\r\n        role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.drawToolWidget.chooseLayerTitle}" aria-expanded\x3d"false"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTSelectableLayerTitle esriCTEllipsis" data-dojo-attach-point\x3d"impactSummaryLayerTitle"\r\n        title\x3d"${nls.drawToolWidget.chooseLayerTitle}"\x3e\r\n        ${nls.drawToolWidget.chooseLayerTitle}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTImpactSummaryLayerMaxRecordHint esriCTHidden esriCTCursorPointer"\r\n        data-dojo-attach-point\x3d"singleLayerSelectionWarning" title\x3d"${nls.drawToolWidget.layerSelectionWarningTooltip}"\r\n        role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.drawToolWidget.layerSelectionWarningTooltip}"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"entireLayerParentContainer" class\x3d"esriCTHidden"\x3e\r\n      \x3cdiv class\x3d"jimu-widget-screening-selectable-layer-item no-action"\x3e\r\n        \x3cdiv class\x3d"layer-row"\x3e\r\n          \x3cdiv class\x3d"selectable-check checked" title\x3d"${nls.drawToolWidget.selectAllLayersText}"\r\n            data-dojo-attach-point\x3d"selectAllLayers" role\x3d"checkbox" tabindex\x3d"0"\r\n            aria-label\x3d"${nls.drawToolWidget.selectAllLayersText}" aria-checked\x3d"true"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" title\x3d"${nls.drawToolWidget.selectAllLayersText}"\x3e\r\n            ${nls.drawToolWidget.selectAllLayersText}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"layer-nodes" data-dojo-attach-point\x3d"layerItemsNode"\x3e\r\n        \x3cdiv class\x3d"esriCTLayerItems"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!-- Layer chooser ends --\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./drawTool.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/Evented dojo/on dojo/dom-construct dojo/query dojo/dom-class dojo/_base/array jimu/BaseWidget jimu/dijit/DrawBox jimu/dijit/FeatureSetChooserForMultipleLayers jimu/SelectionManager esri/geometry/geometryEngine dojo/_base/html dojo/_base/array ./SelectableLayerItem jimu/dijit/Message dijit/focus dojo/dom-style dojo/keys dojo/_base/event jimu/utils dojo/dom-attr".split(" "),function(t,u,v,c,w,f,x,
n,d,r,y,z,A,B,C,q,l,D,E,m,p,g,h,F,k){return t([y,v,w],{baseClass:"jimu-widget-screening-drawTool",templateString:u,_drawTool:null,_filteredLayerArray:[],selectTool:null,layerItems:null,currentSelectedDrawTool:null,_selectToolFocusElement:null,constructor:function(a){this._drawTool=null;this._filteredLayerArray=[];this._selectToolFocusElement=this.currentSelectedDrawTool=this.layerItems=this.selectTool=null;c.mixin(this,a)},postCreate:function(){this.layerItems=[];this._createFeatureLayerArr();this._initializeDrawBoxTools();
this.config.drawToolSelectableLayers&&0<this.config.drawToolSelectableLayers.length||!this.config.drawToolSelectableLayers?(this._initializeSelectTool(),this._setFeatureLayersForSelectTool(),this._initLayers()):this._hideLayerChooserListOfSelectTool();this.own(f(this.layerSectionIcon,"click",c.hitch(this,function(a){h.stop(a);this._showOrHideLayerDetailsContainer()})));this.own(f(this.impactSummaryLayerTitle,"click",c.hitch(this,this._showOrHideLayerDetailsContainer)));this.own(f(this.layerSectionIcon,
"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),this._showOrHideLayerDetailsContainer();a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(f(this.impactSummaryLayerTitle,"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),this._showOrHideLayerDetailsContainer()})));this.own(f(this.selectAllLayers,"click",c.hitch(this,function(a){h.stop(a);this._selectAllLayers()})));
this.own(f(this.selectAllLayers,"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),this._selectAllLayers();a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(f(this.singleLayerSelectionWarning,"click",c.hitch(this,function(a){h.stop(a);this._showMessage(this.nls.drawToolWidget.layerSelectionWarningTooltip)})));this.own(f(this.singleLayerSelectionWarning,"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||
a.keyCode===g.SPACE)h.stop(a),this._showMessage(this.nls.drawToolWidget.layerSelectionWarningTooltip);a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})))},_initLayers:function(){q.empty(this.layerItemsNode);l.forEach(this._filteredLayerArray,c.hitch(this,function(a){if(a&&a.objectIdField&&a.geometryType){var b,e;l.forEach(this.layerInfoArray,c.hitch(this,function(e){e.id===a.id&&(b=e)}));e=new D({layerInfo:b,checked:!0,layerVisible:!0,map:this.map,nls:this.nls,
isSingleTabSelected:this.isSingleTabSelected});this.own(f(e,"stateChange",c.hitch(this,function(){this.emit("clearExistingSelection");this.selectTool.setFeatureLayers(this._getSelectableLayers());this._updateSelectAllState()})));this.own(f(e,"focusLastSelectedTab",c.hitch(this,function(){this.emit("focusLastSelectedTab")})));e.init(a);q.place(e.domNode,this.layerItemsNode);e.startup();this.layerItems.push(e)}}))},_getSelectableLayers:function(){var a=[];l.forEach(this.layerItems,function(b){b.isLayerVisible()&&
b.isChecked()&&a.push(b.featureLayer)},this);return a},_showOrHideLayerDetailsContainer:function(){d.contains(this.layerSectionIcon,"esriCTLayerPanelCollapseIcon")?(d.add(this.entireLayerParentContainer,"esriCTHidden"),d.replace(this.layerSectionIcon,"esriCTLayerPanelExpandIcon","esriCTLayerPanelCollapseIcon"),k.set(this.layerSectionIcon,"aria-expanded","false")):(d.remove(this.entireLayerParentContainer,"esriCTHidden"),d.replace(this.layerSectionIcon,"esriCTLayerPanelCollapseIcon","esriCTLayerPanelExpandIcon"),
k.set(this.layerSectionIcon,"aria-expanded","true"))},_selectAllLayers:function(){var a;q.toggleClass(this.selectAllLayers,"checked");(a=d.contains(this.selectAllLayers,"checked"))?k.set(this.selectAllLayers,"aria-checked","true"):k.set(this.selectAllLayers,"aria-checked","false");l.forEach(this.layerItems,function(b){a?d.contains(b.selectableCheckBox,"checked")||(b.selectableCheckBox.click(),k.set(b.selectableCheckBox,"aria-checked","true")):d.contains(b.selectableCheckBox,"checked")&&(b.selectableCheckBox.click(),
k.set(b.selectableCheckBox,"aria-checked","false"))})},_updateSelectAllState:function(){var a,b,e;e=!0;a=d.contains(this.selectAllLayers,"checked");l.forEach(this.layerItems,function(a){d.contains(a.selectableCheckBox,"checked")?e=!1:b=!0});b?(d.remove(this.selectAllLayers,"checked"),k.set(this.selectAllLayers,"aria-checked","false")):a||(d.add(this.selectAllLayers,"checked"),k.set(this.selectAllLayers,"aria-checked","true"));e?(d.remove(this.singleLayerSelectionWarning,"esriCTHidden"),this.singleLayerSelectionWarning.focus()):
d.add(this.singleLayerSelectionWarning,"esriCTHidden")},_createFeatureLayerArr:function(){if(this.config.drawToolSelectableLayers)l.forEach(this.config.drawToolSelectableLayers,c.hitch(this,function(a){a=this.layerInfosObj.getLayerInfoById(a).layerObject;""!==a&&null!==a&&void 0!==a&&this._filteredLayerArray.push(a)}));else for(var a in this.filteredLayerObj)this.filteredLayerObj.hasOwnProperty(a)&&this._filteredLayerArray.push(this.filteredLayerObj[a])},_hideAllTheDrawTools:function(){this._drawTool&&
n(".draw-item",this._drawTool.domNode).addClass("esriCTHidden")},_initializeDrawBoxTools:function(){var a,b,e;b=[];e=!1;this.config.hasOwnProperty("showPointTool")&&this.config.showPointTool&&b.push("POINT");this.config.hasOwnProperty("showPolylineTool")&&this.config.showPolylineTool&&b.push("POLYLINE");this.config.hasOwnProperty("showExtentTool")&&this.config.showExtentTool&&b.push("EXTENT");this.config.hasOwnProperty("showPolygonTool")&&this.config.showPolygonTool&&b.push("POLYGON");this.config.hasOwnProperty("showCircleTool")&&
this.config.showCircleTool&&b.push("CIRCLE");if(this.config.hasOwnProperty("showPointTool")||this.config.hasOwnProperty("showPolylineTool")||this.config.hasOwnProperty("showExtentTool")||this.config.hasOwnProperty("showPolygonTool")||this.config.hasOwnProperty("showCircleTool"))e=!0;this.config.hasOwnProperty("showPointTool")||this.config.hasOwnProperty("showPolylineTool")||this.config.hasOwnProperty("showExtentTool")||this.config.hasOwnProperty("showPolygonTool")||this.config.hasOwnProperty("showCircleTool")||
b.push("POINT","POLYLINE","EXTENT","POLYGON");this._drawTool=new z({geoTypes:b,map:this.map,pointSymbol:this.pointSymbol,polylineSymbol:this.polylineSymbol,polygonSymbol:this.polygonSymbol},this.drawToolIconsParentDiv);this._drawTool.startup();this._attachKeydownEventToTheNodes();this._addAriaLabelToDrawTools();e&&0===b.length&&this._hideAllTheDrawTools();this.own(f(this._drawTool,"draw-activate",c.hitch(this,function(a){this.currentSelectedDrawTool=a;this._deactivateSelectTool();this.selectTool&&
this.selectTool.isActive()&&this._drawTool.drawToolBar.activate(a);"extent"===a&&this.map.disablePan();this.map.setInfoWindowOnClick(!1)})));this.own(f(this._drawTool,"draw-end",c.hitch(this,function(b){this._drawTool.drawLayer.clear();this.map.enablePan();(a="polygon"===b.geometry.type?C.simplify(b.geometry):b.geometry)?this.emit("onDrawComplete",[b]):this._drawTool.drawLayer.clear();this.map.setInfoWindowOnClick(!0);this._activateLastSelectedTool()})))},_initializeSelectTool:function(){var a,b;
this.selectTool=new A({map:this.map,updateSelection:!0,fullyWithin:!1},this.selectToolDiv);a=n(".btn-clear",this.selectTool.domNode)[0];d.add(a,"esriCTHidden");k.set(a,"tab-index","-1");this._selectToolFocusElement=this.selectTool.domNode.children[0];k.set(this._selectToolFocusElement,"role","button");k.set(this._selectToolFocusElement,"aria-label",this.nls.drawToolWidget.selectToolLabel);b=n(".btn-select",this.selectTool.domNode)[0];this.own(f(b,"click",c.hitch(this,function(a){h.stop(a);this._activateOrDeactivateSelectTool()})));
this.own(f(this.selectToolParent,"keydown",c.hitch(this,function(a){a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"));if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),b.click()})));this.own(f(this.selectTool,"unloading",c.hitch(this,function(){var a;this.currentSelectedDrawTool="selectTool";this._deactivateSelectTool();a=this._getSelectedFeature();this.emit("onSelectionComplete",a);this._activateLastSelectedTool()})));x.place(this.selectToolParent,
n(".draw-items",this.domNode)[0],"last")},deactivateTools:function(){this._drawTool&&this._drawTool.isActive()&&this._drawTool.deactivate();this.selectTool&&this.selectTool.isActive()&&this._deactivateSelectTool();this.map.enablePan()},_setFeatureLayersForSelectTool:function(){this.selectTool.setFeatureLayers(this._filteredLayerArray)},_getSelectedFeature:function(){var a;a=[];r.forEach(this._filteredLayerArray,c.hitch(this,function(b){a=a.concat(b.getSelectedFeatures())}));return a},clearAllSelections:function(){var a;
a=B.getInstance();r.forEach(this._filteredLayerArray,c.hitch(this,function(b){a.clearSelection(b)}))},_showMessage:function(a){(new E({message:a})).message=a},_displayLayerChooserListOfSelectTool:function(){d.remove(this.seperatorAfterSelect,"esriCTHidden");d.remove(this.parentDivOfChooseSymbol,"esriCTHidden")},_hideLayerChooserListOfSelectTool:function(){d.add(this.seperatorAfterSelect,"esriCTHidden");d.add(this.parentDivOfChooseSymbol,"esriCTHidden")},_deactivateSelectTool:function(){this.selectTool&&
this.selectTool.deactivate();this._hideLayerChooserListOfSelectTool()},focusFirstNodeOfSelectedTab:function(){var a;a=!1;l.forEach(this._drawTool.domNode.children[0].children,c.hitch(this,function(b){"block"!==p.get(b,"display")||a||(a=!0,this._focusOutCurrentNode(),m.focus(b))}))},setFirstFocusNode:function(a){var b;b=!1;l.forEach(this._drawTool.domNode.children[0].children,c.hitch(this,function(c){"block"!==p.get(c,"display")||b||(b=!0,F.initFirstFocusNode(a,c))}))},_attachKeydownEventToTheNodes:function(){l.forEach(this._drawTool.domNode.children[0].children,
c.hitch(this,function(a){"block"===p.get(a,"display")&&this.own(f(a,"keydown",c.hitch(this,function(a){a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})))}))},_addAriaLabelToDrawTools:function(){l.forEach(this._drawTool.domNode.children[0].children,c.hitch(this,function(a){if("block"===p.get(a,"display")){var b=k.get(a,"title");k.set(a,"aria-label",b);d.add(a,"esriCTDrawItem")}}))},_focusOutCurrentNode:function(){m.curNode&&m.curNode.blur()},_activateOrDeactivateSelectTool:function(){this._drawTool.isActive()&&
this._drawTool.deactivate();this.selectTool&&this.selectTool.isActive()?(this._displayLayerChooserListOfSelectTool(),this.map.disablePan()):this._deactivateSelectTool()},setFocusOnSelectTool:function(){""!==this.selectTool&&null!==this.selectTool&&void 0!==this.selectTool&&(this._focusOutCurrentNode(),m.focus(this._selectToolFocusElement),this.currentSelectedDrawTool=null)},_activateLastSelectedTool:function(){switch(this.currentSelectedDrawTool){case "point":this._focusOutCurrentNode();m.focus(this._drawTool.pointIcon);
this.currentSelectedDrawTool=null;break;case "polyline":this._focusOutCurrentNode();m.focus(this._drawTool.polylineIcon);this.currentSelectedDrawTool=null;break;case "extent":this._focusOutCurrentNode();m.focus(this._drawTool.extentIcon);this.currentSelectedDrawTool=null;break;case "circle":this._focusOutCurrentNode();m.focus(this._drawTool.circleIcon);this.currentSelectedDrawTool=null;break;case "polygon":this._focusOutCurrentNode();m.focus(this._drawTool.polygonIcon);this.currentSelectedDrawTool=
null;break;case "selectTool":this._focusOutCurrentNode(),m.focus(this._selectToolFocusElement)}}})});