// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred esri/layers/FeatureLayer esri/layers/GeoRSSLayer esri/layers/WFSLayer jimu/LayerInfos/LayerInfos".split(" "),function(l,e,m,n,h,q,r,p){var g={getLayerObjects:function(){var a=new n,b=[];p.getInstanceSync().traversal(function(a){b.push(a)});var c=e.map(b,function(a){var b;return a.getItemInfo().then(function(a){a&&(b=a.getItem())}).then(function(){return a.getLayerType()}).then(function(b){"GeoRSSLayer"===b&&(a.isLeaf()||e.forEach(a.getSubLayers(),
function(a){a.layerObject.name||(a.layerObject.name=a.title)}));return a.getLayerObjectTryUsingFeatureService()}).then(function(a){if(a)return a.itemInfo=b,a})});m(c).then(function(c){var k=[];e.forEach(c,function(a,c){if(a&&a.geometryType)if(a instanceof h&&"esri.layers.StreamLayer"!==a.declaredClass||a instanceof q)a.id=a.id||b[c].id,k.push(a);else if(a instanceof r){var d=g.createFeatureCollectionJsonFromWFS(a),d=new h(d,{mode:h.MODE_SNAPSHOT,outFields:["*"]});d.id=a.id||b[c].id;d.title=a._layerName;
d.name=a._layerName;d.capabilities?-1===d.capabilities.indexOf("Extract")&&(d.capabilities+=",Extract"):d.capabilities="Extract";k.push(d)}});a.resolve(k)},function(){a.resolve([])});return a},getTableInfos:function(){var a=p.getInstanceSync(),a=[].concat(a.getTableInfoArray(),a.getLayerInfoArray());return e.filter(a,function(a){return!0===a.isTable})},getTableLayerObjects:function(){var a=new n,b=g.getTableInfos(),b=e.map(b,function(a){return a.getLayerObject()});m(b).then(function(b){b=e.filter(b,
function(a){return null!==a});a.resolve(b)});return a},getMainGeometryType:function(a){var b=0,c=0,f=0;e.forEach(a.graphics,function(a){"point"===a.geometry.type?b++:"polyline"===a.geometry.type?c++:"polygon"===a.geometry.type&&f++});return b>c&&b>f?"esriGeometryPoint":c>b&&c>f?"esriGeometryPolyline":"esriGeometryPolygon"},createFeatureCollectionJsonFromWFS:function(a){var b=g.getMainGeometryType(a),c={layerDefinition:null,featureSet:{features:[],geometryType:b}};c.layerDefinition={geometryType:b,
objectIdField:"__OBJECTID",type:"Feature Layer",typeIdField:"",drawingInfo:{renderer:{type:"simple",symbol:("esriGeometryPoint"===b?a._pointSymbol:"esriGeometryPolyline"===b?a._lineSymbol:a._polygonSymbol).toJson()},fixedSymbols:!0},fields:[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID"}],types:[],capabilities:"Query"};e.forEach(a.fields,function(a){-1<e.indexOf(["esriFieldTypeInteger","esriFieldTypeDouble","esriFieldTypeDate","esriFieldTypeString"],a.type)&&c.layerDefinition.fields.push(l.clone(a))});
var f=[];e.forEach(a.graphics,function(a,b){var c=l.clone(a.attributes);c.__OBJECTID=b;f.push({geometry:a.geometry.toJson(),attributes:c})});c.featureSet.features=f;return c}};return g});