// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/aspect dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/on ../../../dijit/utils/MouseUtil ../../../dijit/tooltips/TooltipUtil".split(" "),function(p,f,w,x,m,q,r){function k(a){return a&&a.isDraggable}function y(a){n=!0;g=null;var e=r.createTooltip(null,null,{htmlFragment:z(a)}),c=m(b.domNode,"mousemove, touchmove, dojotouchmove",function(c){q.fixTouchEvent(c);(c=b.row(c))&&c.data&&t(c.data,a)}),d=m(document.body,"mouseup, touchend",function(){g&&g!=a&&("before"==l&&b.store.data[g.index-
1]==a||"after"==l&&u(g)==a||!h.onDnDHappened||h.onDnDHappened({objectDropped:a,objectOver:g,position:l}));k()}),f=m(document.body,"keyup",function(a){27==a.keyCode&&k()}),k=function(){r.removeTooltip(e);c.remove();d.remove();f.remove();t(null,null);g=null;n=!1}}function z(a){if(h.dndBoxRenderer)return h.dndBoxRenderer(a);a=w.create("div",{innerHTML:a.label||"DnD Box in action!","class":"esriMapsAnalystXSelectableTreeDnDBoxRoot"});a.style.cursor="move";return a}function t(a,e){d&&(f.remove(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedAllowedBefore"),
f.remove(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedAllowedAfter"),f.remove(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedForbiddenBefore"),f.remove(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedForbiddenAfter"),l=d=null);if(a&&(e=b.row(a))&&e.element){d=e.element;e=k(a);var c=x.position(d);l=c=c.y+c.h/2>q.getCursorPosition().clientY?"before":"after";(e=a.isHost?e?"before"==c||!(b._expanded&&b._expanded[a.id]):"before"==c?k(b.store.data[a.index-1]):!(b._expanded&&b._expanded[a.id])&&
k(u(a)):"after"==c&&!(!a.isHost&&a.hostElement.children[a.index+1]))&&"before"==c?f.add(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedAllowedBefore"):e&&"after"==c?f.add(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedAllowedAfter"):e||"before"!=c?e||"after"!=c||f.add(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedForbiddenAfter"):f.add(d,"esriMapsAnalystXSelectableTreeDnDRowHighlightedForbiddenBefore");g=e?a.isHost?a:a.hostElement:null}}function u(a){return a.isHost?b.store.data[a.index+
1]:b.store.data[a.hostElement.index+1]}function v(a){h=a;p.after(h,"init",function(){b=h.grid;var a=[];p.after(b,"destroy",function(){a.forEach(function(a){a.remove()})});a.push(m(b.domNode,"mousedown, touchstart, dojotouchover",function(a){n||(a=b.row(a))&&a.data&&k(a.data)&&y(a.data)}))});return h}var b,h,g,d,l,n=!1;v.prepareTreeData=function(a){var b=0,c=0;a.forEach(function(a){a.index=b++;a.isHost=!0;a.isDraggable=void 0===a.isDraggable?!0:a.isDraggable;a.children&&a.children.forEach(function(b){b.index=
c++;b.hostElement=a})})};return v});