// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Query/setting/SingleQuerySetting.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"filterDiv" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\r\n\t\x3ctable data-dojo-attach-point\x3d"generalTable" class\x3d"general" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd class\x3d"first-td"\x3e${nls.querySource}\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" style\x3d"width:100%;border-collapse:collapse;"\x3e\r\n\t\t\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd style\x3d"width:auto;"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"urlTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d\'required:true,trim:true,disabled:true\' style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd style\x3d"width:40px;"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"setting-btn jimu-float-trailing" data-dojo-attach-event\x3d"onclick:_onBtnSetSourceClicked" title\x3d"${nls.setSource}"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"jimu-icon jimu-icon-setting"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\r\n\t\x3cdiv data-dojo-attach-point\x3d"detailSection" class\x3d"detail"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"infoTabNode"\x3e\r\n\t\t\t\x3ctable class\x3d"general" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e${jimuNls.common.title}\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"queryNameTextBox" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d\'required:true,trim:true\' style\x3d"width:100%;" data-dojo-attach-event\x3d"change:_onQueryNameChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"first-td"\x3e${nls.icon}\x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"second-td"\x3e\r\n\t\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"symbolPicker" data-dojo-type\x3d"jimu/dijit/SymbolPicker" data-dojo-props\x3d"cropImage:true,customZIndex:2000"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/div\x3e\r\n\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"definitionTabNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"attribute-filter-section"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"stress"\x3e${nls.queryCriteira}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"attribute-filter-content"\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-widget-note" style\x3d"margin-top:5px;"\x3e${nls.defineWhereClause}\x3c/div\x3e\r\n\t\t\t\t\t\x3ctable style\x3d"width:100%;margin-top:4px;"\x3e\r\n\t\t\t\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\t\t\x3ccol width\x3d"40"\x3e\x3c/col\x3e\r\n\t\t\t\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"attribute-sql jimu-widget-note" data-dojo-attach-point\x3d"sqlDiv" style\x3d"border:1px solid #ccc;padding:7px 8px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"setting-btn jimu-float-trailing" data-dojo-attach-event\x3d"onclick:_onBtnFilterClicked" title\x3d"${nls.setSource}"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"jimu-icon jimu-icon-setting"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/tbody\x3e\r\n\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3cdiv style\x3d"margin-top:13px;" data-dojo-attach-point\x3d"showSQLSection"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"spatial-filter-section" data-dojo-attach-point\x3d"spatialFilterDiv"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"resultsTabNode"\x3e\r\n\t\t\t\x3cdiv class\x3d"popup-section"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"stress"\x3e${nls.content}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"popupContainer"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"symbolSection" class\x3d"symbol-section" style\x3d"margin-top:14px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"stress" style\x3d"margin-bottom:15px;"\x3e${nls.symbol}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv style\x3d"margin-top:5px;"\x3e\r\n\t\t\t\t\t\x3cfieldset id\x3d"symbolRadioGroup"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"radio-label-container"\x3e\r\n\t\t\t\t\t\t\t\x3cinput data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"radioServiceSymbol" class\x3d"jimu-radio-btn" name\x3d"symbolRadioGroup" /\x3e\r\n\t\t\t\t\t\t\t\x3clabel for\x3d"radioServiceSymbol" data-dojo-attach-point\x3d"labelServiceSymbol"\x3e${nls.serviceSymbolTip}\x3c/label\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"radio-label-container" style\x3d"margin-top:8px;"\x3e\r\n\t\t\t\t\t\t\t\x3cinput data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"radioCustomSymbol" checked class\x3d"jimu-radio-btn" name\x3d"symbolRadioGroup"/\x3e\r\n\t\t\t\t\t\t\t\x3clabel for\x3d"radioCustomSymbol" data-dojo-attach-point\x3d"labelCustomSymbol"\x3e${nls.setSymbol}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"layerSymbolPicker" data-dojo-type\x3d"jimu/dijit/SymbolPicker"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/fieldset\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" class\x3d"small-font-size" data-dojo-attach-point\x3d"cbxModifySymbol" style\x3d"margin-top:8px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"optionsTabNode"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"cbxKeepResultsDiv" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"export-section" data-dojo-attach-point\x3d"exportSection"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv style\x3d"margin-top: 5px;" data-dojo-attach-point\x3d"expandSection"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv style\x3d"margin-top: 5px;" data-dojo-attach-point\x3d"customResultNameSection"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"create-layer-section"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"stress"\x3e${nls.createLayerForTaskTip}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv style\x3d"margin-top:15px;"\x3e\r\n\t\t\t\t\t\x3cfieldset id\x3d"resLayerRadioGroup"\x3e\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\x3cdiv class\x3d"radio-label-container"\x3e\r\n\t\t\t\t\t\t\t\x3cinput name\x3d"resLayerRadioGroup" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"radioOneLayerPerTask" checked class\x3d"jimu-radio-btn"/\x3e\r\n\t\t\t\t\t\t\t\x3clabel for\x3d"radioOneLayerPerTask" data-dojo-attach-point\x3d"labelOneLayerPerTask"\x3e${nls.oneLayerForTaskTip}\x3c/label\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"radio-label-container" style\x3d"margin-top:15px;"\x3e\r\n\t\t\t\t\t\t\t\x3cinput name\x3d"resLayerRadioGroup" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"radioMultipleLayerPerTask" class\x3d"jimu-radio-btn"/\x3e\r\n\t\t\t\t\t\t\t\x3clabel for\x3d"radioMultipleLayerPerTask" data-dojo-attach-point\x3d"labelMultipleLayerPerTask"\x3e${nls.multipleLayerForTaskTip}\x3c/label\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\r\n\t\t\t\t\t\x3c/fieldset\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\r\n\t\x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/on dojo/query dojo/Evented dojo/Deferred dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/_base/declare dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./SingleQuerySetting.html dojo/promise/all jimu/utils jimu/dijit/Popup jimu/dijit/CheckBox jimu/dijit/TabContainer3 jimu/dijit/Message jimu/LayerInfos/LayerInfos jimu/dijit/_QueryableLayerSourcePopup ../utils ./PopupConfig ./SpatialFilterConfig esri/request esri/symbols/jsonUtils jimu/dijit/Filter jimu/dijit/SymbolPicker jimu/dijit/LoadingIndicator jimu/dijit/ImageChooser dijit/form/ValidationTextBox dijit/form/RadioButton".split(" "),
function(m,p,q,r,f,d,t,u,v,w,x,y,h,z,l,A,n,B,C,g,D,E,F,G,H){return u([t,v,w,q],{baseClass:"jimu-widget-single-query-setting",templateString:x,popupConfig:null,spatialFilterConfig:null,jimuNls:null,_webMapLayerId:null,_defaultTaskIcon:null,map:null,nls:null,target:null,tr:null,appConfig:null,folderUrl:null,_layerDefinition:null,_filterParts:null,postMixInProperties:function(){this.inherited(arguments);this._defaultTaskIcon=this.folderUrl+"css/images/default_task_icon.png";this.jimuNls=window.jimuNls},
postCreate:function(){this.inherited(arguments);this._initSelf()},destroy:function(){this.target=null;this.emit("before-destroy");this.filter&&this.filter.destroy();this.filterPopup&&(this.filterPopup.onClose=f.hitch(this,function(){return!0}),this.filterPopup.close());this.inherited(arguments)},setConfig:function(a){if(a.webMapLayerId){var b=a.webMapLayerId,c=B.getInstanceSync(),e=c.getLayerInfoById(b);e||(e=c.getTableInfoById(b));if(!e)return;b=e.getUrl();a.url=b}this._setConfig(a)},_setConfig:function(a){this.config=
a;if(this._isObject(this.config)){this._filterParts=a.filter;var b=a.url||"";if(b&&"string"===typeof b)if(this.showBigShelter(),this.tab.showShelter(),this._layerDefinition&&this._layerDefinition.url===b)this._resetByConfig(this.config,this._layerDefinition,this._layerObject).promise.always(f.hitch(this,function(){this.hideBigShelter();this.tab.hideShelter()}));else{this._layerObject=this._layerDefinition=null;var c=F({url:b,handAs:"json",content:{f:"json"},callbackParamName:"callback"});a=g.tryGetLayerObject(a.webMapLayerId);
y([c,a]).then(function(a){var c=a[1];this.domNode&&(this._layerDefinition=a[0],this._layerDefinition.url=b,this._layerObject=c,this._resetByConfig(this.config,this._layerDefinition,this._layerObject).promise.always(f.hitch(this,function(){this.hideBigShelter();this.tab.hideShelter()})))}.bind(this),function(a){console.error(a);this.domNode&&this.hideBigShelter()}.bind(this))}}},getConfig:function(){var a={url:"",name:"",icon:"",filter:null,showSQL:!1,spatialFilter:null,popupInfo:"",orderByFields:[],
useLayerSymbol:!0,resultsSymbol:"",canModifySymbol:this.cbxModifySymbol.getValue(),enableExport:!1,defaultExpand:!0,singleResultLayer:!0,webMapLayerId:this._webMapLayerId};if(!this._layerDefinition)return this.scrollToDom(this.generalTable),new n({message:this.nls.setSourceTip}),null;a.url=this._layerDefinition.url;if(!this.queryNameTextBox.validate())return h.showValidationErrorTipForFormDijit(this.queryNameTextBox),null;var b=this.queryNameTextBox.get("value"),b=h.sanitizeHTML(b);a.name=b;a.icon=
this.symbolPicker.getSymbol().toJson();b=this.filter.toJson();if(!b)return new n({message:this.nls.setFilterTip}),null;a.filter=b;a.showSQL=this.cbxShowSQL.getValue();if(g.isTable(this._layerDefinition))a.spatialFilter=null;else{b=this.spatialFilterConfig.getConfig();if(!b)return null;a.spatialFilter=b}b=this.popupConfig.getConfig();if(!b)return null;a.orderByFields=b.orderByFields;a.popupInfo=b.popupInfo;b=null;if(g.isTable(this._layerDefinition))a.useLayerSymbol=!1,a.resultsSymbol=null;else if(g.isImageServiceLayer(this._layerDefinition))if(a.useLayerSymbol=
!1,b=this.layerSymbolPicker.getSymbol())a.resultsSymbol=b.toJson();else return console.error("Can't get symbol from SymbolPicker"),null;else if(this.radioCustomSymbol.checked)if(a.useLayerSymbol=!1,b=this.layerSymbolPicker.getSymbol())a.resultsSymbol=b.toJson();else return console.error("Can't get symbol from SymbolPicker"),null;else a.useLayerSymbol=!0,a.resultsSymbol=null;a.singleResultLayer=this.radioOneLayerPerTask.checked;a.enableExport=this.cbxExport.getValue();a.defaultExpand=this.cbxExpand.getValue();
a.customResultName=this.cbxCRN.getValue();this.target._layerDefinition=this._layerDefinition;this.target._layerObject=this._layerObject;this.target.singleConfig=a;a.webMapLayerId&&(a.url="");return a},scrollToDom:function(a){a=d.coords(a).y;var b=d.coords(this.domNode).y;this.domNode.parentNode.scrollTop=a-b},showBigShelter:function(){this.emit("loading")},hideBigShelter:function(){this.emit("unloading")},showQueryDefinition:function(){this.tab.selectTab(this.nls.queryDefinition)},showResultsSetting:function(){this.tab.selectTab(this.nls.results)},
_initSelf:function(){this._initTabs();this._initInfoTab();this._initFilterTab();this._initResultSettingTab();this._initOptionsTab()},_initTabs:function(){this.tab=new A({tabs:[{title:this.nls.infoText,content:this.infoTabNode},{title:this.nls.filters,content:this.definitionTabNode},{title:this.nls.results,content:this.resultsTabNode},{title:this.nls.optionsText,content:this.optionsTabNode}]});this.tab.placeAt(this.detailSection);this.tab.showShelter();this.own(m(this.tab,"tabChanged",f.hitch(this,
function(a){a===this.nls.filters&&this._updateSqlDivByFilter()})))},_initInfoTab:function(){this._setDefaultTaskIcon()},_initFilterTab:function(){this.filter=new H({enableAskForValues:!0,noFilterTip:this.nls.noFilterTip,style:"width:100%;"});this.filter.placeAt(this.filterDiv);this.cbxShowSQL=new l({label:this.nls.displaySQLTip});this.cbxShowSQL.labelNode&&d.addClass(this.cbxShowSQL.labelNode,"light-stress");this.cbxShowSQL.check();this.cbxShowSQL.placeAt(this.showSQLSection);this._initSpatialFilterConfig()},
_resetAttributeFilter:function(){this.filter.reset();this._updateSqlDivByFilter()},resetFilter:function(a){this.filter&&this._layerDefinition&&this.filter.build({url:this._layerDefinition.url,partsObj:a,layerDefinition:this._layerObject||this._layerDefinition,featureLayerId:this._webMapLayerId})},_updateSqlDivByFilter:function(){var a="",b=this.filter.toJson();b?a=b.expr?b.displaySQL?b.displaySQL:"1\x3d1"===b.expr?this.nls.noExpressionDefinedTip:b.expr:this.nls.specifyFilterAtRuntimeTip:console.log("can't get partsObj from filter");
a&&(this.sqlDiv.innerHTML=a)},_onBtnFilterClicked:function(){this.filterPopup?this.filterPopup.show():this.filterPopup=new z({width:680,height:485,content:this.filter,buttons:[{label:this.nls.ok,onClick:f.hitch(this,function(){(this._filterParts=this.filter.toJson())?(this._updateSqlDivByFilter(),this.filterPopup.hide()):new n({message:this.nls.setFilterTip})})},{label:this.nls.cancel,onClick:f.hitch(this,function(){this.resetFilter(this._filterParts);this.filterPopup.hide()})}],onClose:f.hitch(this,
function(){this.resetFilter(this._filterParts);this.filterPopup.hide();return!1})})},_initSpatialFilterConfig:function(){this.spatialFilterConfig=new E({nls:this.nls});this.spatialFilterConfig.placeAt(this.spatialFilterDiv)},_initResultSettingTab:function(){this._initPopupConfig();this.cbxModifySymbol.setLabel(this.nls.changeSymbolAtRuntime);this.cbxModifySymbol.uncheck()},_initPopupConfig:function(){this.popupConfig=new D({nls:this.nls,sqs:this});this.popupConfig.placeAt(this.popupContainer)},_showSymbolSection:function(){d.removeClass(this.symbolSection,
"not-visible")},_hideSymbolSection:function(){d.addClass(this.symbolSection,"not-visible")},_initOptionsTab:function(){this.cbxExport=new l({label:this.nls.exportTip});this.cbxExport.placeAt(this.exportSection);d.addClass(this.cbxExport.domNode,"small-font-size");this.cbxExpand=new l({label:this.nls.expandTip,checked:!0});this.cbxExpand.placeAt(this.expandSection);d.addClass(this.cbxExpand.domNode,"small-font-size");this.cbxCRN=new l({label:this.nls.customResultNameTip,checked:!0});this.cbxCRN.placeAt(this.customResultNameSection);
d.addClass(this.cbxCRN.domNode,"small-font-size")},_onQueryNameChanged:function(){var a=p(".label",this.target)[0],b=this.queryNameTextBox.get("value"),b=h.sanitizeHTML(b);a.innerHTML=b;a.title=b},_clear:function(){this.urlTextBox.set("value","");this._layerObject=this._layerDefinition=null;this.queryNameTextBox.set("value","");this._setDefaultTaskIcon();this._resetAttributeFilter();d.removeClass(this.spatialFilterDiv,"not-visible");this.spatialFilterConfig.reset();this.cbxShowSQL.check();this.tab.showShelter();
this.popupConfig.onLayerChange(!0);this.radioServiceSymbol.set("disabled",!1);this.radioCustomSymbol.set("checked",!0);this.layerSymbolPicker.reset();this.cbxModifySymbol.uncheck();this.radioOneLayerPerTask.set("checked",!0);this.cbxExport.uncheck()},_onBtnSetSourceClicked:function(){var a=new C({titleLabel:this.nls.setDataSource,dijitArgs:{style:{height:"100%"},multiple:!1,createMapResponse:this.map.webMapResponse,portalUrl:this.appConfig.portalUrl}});this.own(m(a,"ok",f.hitch(this,function(b){var c=
a.getSelectedRadioType();a.close();a=null;this.setNewLayerDefinition(b,c,null)})));this.own(m(a,"cancel",f.hitch(this,function(){a.close();a=null})));a.startup()},setNewLayerDefinition:function(a,b,c){a.definition.name=a.name;a.definition.url=a.url;a.url!==(this._layerDefinition&&this._layerDefinition.url)&&this._resetByNewLayerDefinition(a,b,c)},_resetByNewLayerDefinition:function(a,b,c){var e=a.definition;this._clear();if(e){var k=null;"map"===b&&a.layerInfo&&(k=a.layerInfo.id);this._layerDefinition=
e;this._webMapLayerId=k;g.tryGetLayerObject(this._webMapLayerId).then(function(a){this._layerObject=a;a=e.url;this.urlTextBox.set("value",a);this.queryNameTextBox.set("value",c||e.name);this.tab.hideShelter();this._resetAttributeFilter();this._layerDefinition&&this.filter.build({url:a,expr:"1\x3d1",layerDefinition:this._layerObject||this._layerDefinition,featureLayerId:this._webMapLayerId}).promise.always(f.hitch(this,function(){this._updateSqlDivByFilter()}));g.isTable(this._layerDefinition)?d.addClass(this.spatialFilterDiv,
"not-visible"):d.removeClass(this.spatialFilterDiv,"not-visible");this.popupConfig.onLayerChange(!!this._webMapLayerId);this._webMapLayerId&&this.popupConfig.setConfig({popupInfo:{readFromWebMap:!0},orderByFields:[]});this._handleSymbolSection(e);this.cbxModifySymbol.uncheck()}.bind(this))}},_handleSymbolSection:function(a,b){var c="";this._showSymbolSection();g.isTable(a)?(this.radioServiceSymbol.set("disabled",!0),this._hideSymbolSection(),this.layerSymbolPicker.reset()):g.isImageServiceLayer(a)?
(this.radioServiceSymbol.set("disabled",!0),this.radioCustomSymbol.set("checked",!0),c="fill"):(this.radioServiceSymbol.set("disabled",!1),a.geometryType&&(a=h.getTypeByGeometryType(a.geometryType),"point"===a?c="marker":"polyline"===a?c="line":"polygon"===a&&(c="fill")));c&&(this.layerSymbolPicker.showByType(c),b&&this.layerSymbolPicker.showBySymbol(b))},_setDefaultTaskIcon:function(){this.symbolPicker.showByType("marker")},_resetByConfig:function(a,b,c){var e=new r;a=f.clone(a);this._upgradeConfigForLowerVersion(b,
a);this._webMapLayerId=a.webMapLayerId;this.urlTextBox.set("value",a.url);this.queryNameTextBox.set("value",a.name||"");a.icon?this.symbolPicker.showBySymbol(a.icon):this._setDefaultTaskIcon();var k=a.filter;this._resetAttributeFilter();var h=null;c={url:b.url,layerDefinition:c||b,featureLayerId:this._webMapLayerId};this._isObject(k)?c.partsObj=k:c.expr="1\x3d1";h=this.filter.build(c);h.promise.always(f.hitch(this,function(){this._updateSqlDivByFilter();e.resolve()}));this.cbxShowSQL.setValue(a.showSQL);
this.spatialFilterConfig.reset();g.isTable(this._layerDefinition)?d.addClass(this.spatialFilterDiv,"not-visible"):(d.removeClass(this.spatialFilterDiv,"not-visible"),a.spatialFilter&&this.spatialFilterConfig.setConfig(a.spatialFilter));this.popupConfig.onLayerChange(!!this._webMapLayerId);this.popupConfig.setConfig({popupInfo:a.popupInfo,orderByFields:a.orderByFields});c=null;if(a.resultsSymbol)try{c=G.fromJson(a.resultsSymbol)}catch(I){console.error(I)}this._handleSymbolSection(b,c);a.useLayerSymbol&&
this.radioServiceSymbol.set("checked",!0);this.cbxModifySymbol.setValue(a.canModifySymbol);a.singleResultLayer?this.radioOneLayerPerTask.set("checked",!0):this.radioMultipleLayerPerTask.set("checked",!0);this.cbxExport.setValue(a.enableExport);this.cbxExpand.setValue(a.defaultExpand);this.cbxCRN.setValue(a.customResultName);return e},_upgradeConfigForLowerVersion:function(a,b){b.popup&&!b.popupInfo&&(b.popupInfo=g.upgradePopupToPopupInfo(a,b.popup));g.dynamicUpdateConfigIcon(b,this._defaultTaskIcon)},
_isObject:function(a){return a&&"object"===typeof a}})});