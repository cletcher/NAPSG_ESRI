// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/ParcelDrafter/PlanInfo.html":'\x3cdiv class\x3d"esriCTFullWidth"\x3e\r\n    \x3c!-- Parcel name input container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"parcelNameRow"\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"parcelName"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- DocumentType input container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"documentTypeRow"\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"documentType"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Plan name input container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"planNameRow"\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"planName"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Save/Cancle button container --\x3e\r\n    \x3cdiv class\x3d"esriCTPlanInfoNode"\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1" title\x3d"${nls.common.save}" data-dojo-attach-point\x3d"planInfoSaveButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.save}"\x3e\r\n            ${nls.common.save}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1 esriCTHidden" title\x3d"${nls.common.deleteText}" data-dojo-attach-point\x3d"planInfoDeleteButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.deleteText}"\x3e\r\n            ${nls.common.deleteText}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn" title\x3d"${nls.common.cancel}" data-dojo-attach-point\x3d"planInfoCancelButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.cancel}"\x3e\r\n            ${nls.common.cancel}\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./PlanInfo.html dojo/_base/lang dojo/_base/array dojo/Evented dojo/dom-class dijit/form/ValidationTextBox dojo/store/Memory dijit/form/ComboBox dojo/on esri/geometry/Polyline esri/graphic esri/tasks/query esri/tasks/QueryTask jimu/dijit/Message ./geometryUtils jimu/utils dojo/keys dojo/dom-attr dojo/aspect".split(" "),function(r,t,u,v,d,n,w,f,x,y,z,h,A,p,B,C,D,E,F,k,m,q){return r([t,u,w],{baseClass:"jimu-widget-ParcelDrafter-PlanInfo",
templateString:v,_itemList:null,_polygonLayer:null,parcelNameTextBox:null,planNameTextBox:null,documentTypeControl:null,planSettings:null,_savedPolygonObjectId:null,_savedPolyLines:null,constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);f.add(this.domNode,"esriCTFullWidth");this.config.polygonLayer.documentType.hasOwnProperty("name")&&(f.remove(this.documentTypeRow,"esriCTHidden"),this._createDocumentTypeControl());this.config.polygonLayer.parcelName.hasOwnProperty("name")&&
(f.remove(this.parcelNameRow,"esriCTHidden"),this.parcelNameTextBox=this._createFieldInputs(this.config.polygonLayer.parcelName,this.parcelName,this.nls.planInfo.parcelNamePlaceholderText,!this.config.polygonLayer.parcelName.nullable));this.config.polygonLayer.planName.hasOwnProperty("name")&&(f.remove(this.planNameRow,"esriCTHidden"),this.planNameTextBox=this._createFieldInputs(this.config.polygonLayer.planName,this.planName,this.nls.planInfo.planNamePlaceholderText,!this.config.polygonLayer.planName.nullable));
this.own(h(this.planInfoCancelButton,"click",d.hitch(this,function(){this.emit("cancelTraversedParcel")})));this.own(h(this.planInfoCancelButton,"keydown",d.hitch(this,function(a){a.keyCode!==k.ENTER&&a.keyCode!==k.SPACE||this.emit("cancelTraversedParcel")})));this.own(h(this.planInfoSaveButton,"click",d.hitch(this,function(){this.emit("saveTraversedParcel")})));this.own(h(this.planInfoSaveButton,"keydown",d.hitch(this,function(a){a.keyCode!==k.ENTER&&a.keyCode!==k.SPACE||this.emit("saveTraversedParcel")})));
this.own(h(this.planInfoDeleteButton,"click",d.hitch(this,this.deleteParcel)));this.own(h(this.planInfoDeleteButton,"keydown",d.hitch(this,function(a){a.keyCode!==k.ENTER&&a.keyCode!==k.SPACE||this.deleteParcel()})))},resetValues:function(){this.parcelNameTextBox&&this.parcelNameTextBox.set("value","");this.planNameTextBox&&this.planNameTextBox.set("value","");this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",null):this.documentTypeControl.set("value",
""));f.add(this.planInfoDeleteButton,"esriCTHidden")},_showMessage:function(a){this.emit("showMessage",a)},_createDocumentTypeControl:function(){this.config.polygonLayer.documentType.domain?(this.documentTypeControl=this._createFieldSelect(this.documentType,this.nls.planInfo.parcelDocumentTypeText,!this.config.polygonLayer.documentType.nullable),this.own(h(this.documentTypeControl,"change",d.hitch(this,function(a){""===a||null===a||void 0===a||this.documentTypeControl.store.data.some(function(b){return b.name===
a})||(this.documentTypeControl.set("item",null),this._showMessage(this.nls.planInfo.enterValidDocumentTypeMessage))})))):this.documentTypeControl=this._createFieldInputs(this.config.polygonLayer.documentType,this.documentType,this.nls.planInfo.parcelDocumentTypeText,!this.config.polygonLayer.documentType.nullable)},_createFieldInputs:function(a,b,c,e){c=e?c+" "+this.nls.planInfo.requiredText:c+" "+this.nls.planInfo.optionalText;c=new x({placeHolder:c,"class":"esriCTFullWidth",required:e,"aria-label":c});
0<=this.numberFieldTypes.indexOf(a.type)&&(c.validator=d.hitch(this,function(b){return""===b||this.validateNumericField(b,a.type)?!0:!1}));c.placeAt(b);return c},_createFieldSelect:function(a,b,c){var e;e=this._createDocTypeDataArr();e=new y({data:e});b=c?b+" "+this.nls.planInfo.requiredText:b+" "+this.nls.planInfo.optionalText;this.selectBox=new z({placeHolder:b,"class":"esriCTFullWidth",required:c,store:e},a);m.set(this.selectBox.domNode,"aria-label",b);m.set(this.selectBox.domNode,"role","combobox");
m.set(this.selectBox.domNode,"aria-expanded","false");q.after(this.selectBox,"loadAndOpenDropDown",d.hitch(this,function(){m.set(this.selectBox.domNode,"aria-expanded","true")}));q.after(this.selectBox,"closeDropDown",d.hitch(this,function(){m.set(this.selectBox.domNode,"aria-expanded","false")}));return this.selectBox},_createDocTypeDataArr:function(){var a=[];this.config.polygonLayer.documentType.domain.codedValues&&n.forEach(this.config.polygonLayer.documentType.domain.codedValues,d.hitch(this,
function(b){a.push({name:b.name,id:b.code})}));return a},saveData:function(a){if(a.miscloseDetails&&(0===a.miscloseDetails.LengthConversions.meters||a.appliedCompassRule))this._saveParcel(a);else{var b;b=new D({message:this.nls.planInfo.saveNonClosedParcelConfirmationMessage,type:"question",buttons:[{label:this.nls.common.yes,onClick:d.hitch(this,function(){b.close();this._saveParcel(a)})},{label:this.nls.common.no}]})}},_saveParcel:function(a){this._itemList=a.itemList;this.planSettings=a.planSettings;
a.miscloseDetails&&(0===a.miscloseDetails.LengthConversions.meters||a.appliedCompassRule)?0===a.polygonDeleteArr.length?this._createPolygonData(a):this._deletePolygonBeforeSaving(a):0<a.polygonDeleteArr.length?this._deletePolygonBeforeSaving(a):this._createPolylineData(null)},_createParcelPolygon:function(){var a,b,c,e,d;c=[];e=this.parcelLinesGraphicsLayer.graphics;for(a=0;a<e.length;a++)if(this._itemList[a].LineSymbol.type===this.config.BoundaryLineType)for(b=0;b<e[a].geometry.paths.length;b++)c.push(e[a].geometry.paths[b]);
0<c.length&&(d=E.getPolygonFromPolyLines(c,!1,!0,e[0].geometry.spatialReference))&&(this.parcelPolygonGraphicsLayer.clear(),a=new p(d),this.parcelPolygonGraphicsLayer.add(a),d=this.parcelPolygonGraphicsLayer.graphics[0].geometry);return d},_createPolygonData:function(a){var b,c,d,g,l;a.miscloseDetails&&(0===a.miscloseDetails.LengthConversions.meters||a.appliedCompassRule)?(this.loading.show(),b=[],c={},l=this.polygonLayerUnit,g=null,this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?
this.documentTypeControl.hasOwnProperty("item")&&this.documentTypeControl.item&&this.documentTypeControl.item.hasOwnProperty("id")&&(g=this.documentTypeControl.item.id):""!==this.documentTypeControl.get("value")&&(g=this.documentTypeControl.get("value"))),(d=this._createParcelPolygon())?(c[this.config.polygonLayer.rotation.name]=a.rotation,c[this.config.polygonLayer.scale.name]=a.scale,c[this.config.polygonLayer.miscloseRatio.name]=a.miscloseDetails.miscloseValue,c[this.config.polygonLayer.miscloseDistance.name]=
this._getValueAccToFeatureLayerUnit(l,a.miscloseDetails,"LengthConversions"),this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(c[this.config.polygonLayer.statedArea.name]=a.statedArea),this.parcelNameTextBox&&(c[this.config.polygonLayer.parcelName.name]=this.parcelNameTextBox.get("value")),this.planNameTextBox&&(c[this.config.polygonLayer.planName.name]=this.planNameTextBox.get("value")),this.documentTypeControl&&(c[this.config.polygonLayer.documentType.name]=g),a=new p(d,null,c),b.push(a),
this._saveParcelPolygon(b)):this._showMessage(this.nls.planInfo.unableToCreatePolygonParcel)):this._createPolylineData(null)},setParcelInformation:function(a,b){var c=this.map.getLayer(this.config.polygonLayer.id).objectIdField;this._savedPolygonObjectId=a[0].attributes[c];this._savedPolyLines=b;f.remove(this.planInfoDeleteButton,"esriCTHidden");this.parcelNameTextBox&&this.parcelNameTextBox.set("value",a[0].attributes[this.config.polygonLayer.parcelName.name]);this.planNameTextBox&&this.planNameTextBox.set("value",
a[0].attributes[this.config.polygonLayer.planName.name]);this.documentTypeControl&&(a=a[0].attributes[this.config.polygonLayer.documentType.name],null!==a&&""!==a&&void 0!==a&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",this.documentTypeControl.store.get(a)):this.documentTypeControl.set("value",a)))},_rollbackSavedPolygon:function(){var a,b,c;b={attributes:{}};(a=this.map.getLayer(this.config.polygonLayer.id))&&null!==this._savedPolygonObjectId&&(b.attributes[a.objectIdField]=
this._savedPolygonObjectId,c=a.applyEdits(null,null,[b]));return c},_rollbackSavedPolyLines:function(a){var b,c,e,g;c=[];b=this.map.getLayer(this.config.polylineLayer.id);n.forEach(a,d.hitch(this,function(a){e={attributes:{}};a.hasOwnProperty("objectId")?(e.attributes[b.objectIdField]=a.objectId,c.push(e)):a.attributes.hasOwnProperty(b.objectIdField)&&(e.attributes[b.objectIdField]=a.attributes[b.objectIdField],c.push(e))}));b&&0<c.length&&(g=b.applyEdits(null,null,c));return g},_deletePolygonBeforeSaving:function(a){(this._polygonLayer=
this.map.getLayer(this.config.polygonLayer.id))?this._polygonLayer.applyEdits(null,null,a.polygonDeleteArr,d.hitch(this,function(){this._deleteLinesBeforeSaving(a)}),d.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)})):this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)},_deleteLinesBeforeSaving:function(a){var b;(b=this.map.getLayer(this.config.polylineLayer.id))?b.applyEdits(null,null,a.polylineDeleteArr,d.hitch(this,function(){this._createPolygonData(a)}),
d.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)})):this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)},_saveParcelPolygon:function(a){(this._polygonLayer=this.map.getLayer(this.config.polygonLayer.id))?(this._savedPolygonObjectId=null,this._polygonLayer.applyEdits(a,null,null,d.hitch(this,function(a){a&&0<a.length&&a[0].success?(this._savedPolygonObjectId=a[0].objectId,this._polygonLayer.refresh(),a=new B,a.objectIds=[this._savedPolygonObjectId],
a.returnGeometry=!1,a.outFields=[this.config.polygonLayer.relatedGUID.name],(new C(this._polygonLayer.url)).execute(a,d.hitch(this,function(a){this.loading.hide();this._createPolylineData(a.features[0].attributes[this.config.polygonLayer.relatedGUID.name])}),d.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)}))):(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))}),d.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)}))):
(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))},_getValueAccToFeatureLayerUnit:function(a,b,c){if(b.hasOwnProperty(c)&&b[c])switch(a){case "meters":case "degrees":return b[c].meters;case "feet":return b[c].feet;case "uSSurveyFeet":return b[c].uSSurveyFeet;default:return null}else return null},_createPolylineData:function(a){var b,c,d,g,l,h;this.loading.show();l=this.parcelLinesGraphicsLayer.graphics;d=this.polylineLayerUnit;h=this._itemList;g=[];for(var f=0;f<
l.length;f++)b={},c=h[f],b[this.config.polylineLayer.bearing.name]=c.BearingConversions.naDD,b[this.config.polylineLayer.distance.name]=this._getValueAccToFeatureLayerUnit(d,c,"LengthConversions"),b[this.config.polylineLayer.lineType.name]=c.LineSymbol.type,b[this.config.polylineLayer.radius.name]=this._getValueAccToFeatureLayerUnit(d,c,"RadiusConversions"),null!==b[this.config.polylineLayer.radius.name]&&""!==b[this.config.polylineLayer.radius.name]&&void 0!==b[this.config.polylineLayer.radius.name]?
(b[this.config.polylineLayer.arcLength.name]=this._getValueAccToFeatureLayerUnit(d,c,"ArcLengthConversions"),c=this._getValueAccToFeatureLayerUnit(d,c,"ChordLengthConversions"),b[this.config.polylineLayer.chordLength.name]=c,b[this.config.polylineLayer.distance.name]=c):(b[this.config.polylineLayer.arcLength.name]=null,b[this.config.polylineLayer.chordLength.name]=null),b[this.config.polylineLayer.relatedGUID.name]=a,b[this.config.polylineLayer.sequenceId.name]=f,c=l[f].geometry.toJson(),c=new A(c),
b=new p(c,null,b,null),g.push(b);this._saveParcelLines(g)},_saveParcelLines:function(a){var b;(b=this.map.getLayer(this.config.polylineLayer.id))?b.applyEdits(a,null,null,d.hitch(this,function(b){var c=[],d=[];n.forEach(b,function(a){a.success?d.push(a):c.push(a)});0<c.length?(this._rollbackSavedPolygon(),0<d.length&&c.length!==a.length&&this._rollbackSavedPolyLines(d),this._showMessage(this.nls.planInfo.unableToSaveParcelLines)):(this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelSavedSuccessMessage),
this._savedPolygonObjectId=null,this.emit("displayMainPageAfterSave",!1));this.loading.hide()}),d.hitch(this,function(){this._rollbackSavedPolygon();this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)})):(this._rollbackSavedPolygon(),this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSaveParcelLines))},validateParcelDetails:function(a){var b={};if(this.parcelNameTextBox&&!this.parcelNameTextBox.isValid())return b.status=!1,b.message=this.nls.planInfo.enterValidParcelNameMessage,
b;if(this.planNameTextBox&&!this.planNameTextBox.isValid())return b.status=!1,b.message=this.nls.planInfo.enterValidPlanNameMessage,b;if(this.documentTypeControl&&!this.documentTypeControl.isValid())return b.status=!1,b.message=this.nls.planInfo.enterValidDocumentTypeMessage,b;if(this.config.polygonLayer.statedArea&&this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(!this.config.polygonLayer.statedArea.nullable&&(null===a||""===a)||null!==a&&""!==a&&-1<this.numberFieldTypes.indexOf(this.config.polygonLayer.statedArea.type)&&
!this.validateNumericField(a,this.config.polygonLayer.statedArea.type)))return b.status=!1,b.message=this.nls.planInfo.enterValidStatedAreaNameMessage,b;b.status=!0;return b},deleteParcel:function(){this.loading.show();this._rollbackSavedPolygon().then(d.hitch(this,function(){this._rollbackSavedPolyLines(this._savedPolyLines).then(d.hitch(this,function(){this.loading.hide();this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeletedSuccessMessage);this._savedPolygonObjectId=null;this.emit("displayMainPageAfterSave",
!1)}),d.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeleteErrorMessage);this.emit("displayMainPageAfterSave",!1)}))}),d.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeleteErrorMessage);this.emit("displayMainPageAfterSave",!1)}))},setPlanInfoCancelBtnAsLastNode:function(){F.initLastFocusNode(this.widgetDomNode,this.planInfoCancelButton)},
_showParcelSavedAndDeleteMsg:function(a){this.emit("showParcelSavedAndDeleteMsg",a)}})});