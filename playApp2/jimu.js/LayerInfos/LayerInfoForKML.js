// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault jimu/utils dojo/Deferred esri/lang".split(" "),function(k,f,e,t,l,m,n,u,p,q,r){return k(n,{constructor:function(){},_getExtentAsync:function(){var a=this.layerObject.getLayers(),b=null,d=null;if(0<a.length&&"esri.layers.KMLLayer"===a[0].declaredClass){var c=[];this.traversal(e.hitch(this,function(a){a.id!==this.id&&"esri.layers.KMLLayer"===a.layerObject.declaredClass&&
c.push(a)}));f.forEach(c,function(a){d=a._getExtentAsync();b=b?b.union(d):d},this)}else f.forEach(a,function(a){d=p.graphicsExtent(a.graphics);b=b?b.union(d):d},this);return b},_getExtent:function(){var a=new q;a.resolve(this._getExtentAsync());return a},_resetLayerObjectVisiblity:function(a){var b=a?a[this.id]:null;if(b){var d={},c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(d[c]=a[c].visible);this._setSubLayerVisibleByCheckedInfo(d);this._setTopLayerVisible(b.visible)}},_setSubLayerVisibleByCheckedInfo:function(a){this.traversal(e.hitch(this,
function(b){r.isDefined(a[b.id])&&b._setTopLayerVisible(a[b.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){a?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var a=[];f.forEach(this._getOperLayerByParentFolderId(-1,this),function(b){b=this._layerInfoFactory.create(b);a.push(b);b.init()},this);return a},_getOperLayerByParentFolderId:function(a,b){var d=[],c=this.layerObject.getLayers()||[],g=f.filter(this.layerObject.folders||
[],function(b){return b.parentFolderId===a?!0:!1}),h=[],h=0===g.length?f.filter(c,function(a){return this._flag.kmzSubLayersWereHandled?!1:!0},this):g;f.forEach(h,function(a){var c;"esri.layers.KMLFolder"===a.declaredClass?c={layerObject:a,title:a.label||a.title||a.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(a),subId:a.id,kml:{layerInfo:this,currentFolder:a},selfType:"kml",parentLayerInfo:b}:"esri.layers.KMLLayer"===a.declaredClass?(c=e.getObject("linkInfo.name",!1,a),c={layerObject:a,
title:a.label||a.title||c||a.name||a.id||" ",id:a.id||"-",subId:a.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",parentLayerInfo:b},e.setObject("_wabProperties.kmllayerWasHandled",!0,a),this._flag.kmzSubLayersWereHandled=!0):(e.setObject("_wabProperties.kmllayerWasHandled",!0,a),e.setObject("_wabProperties.isTemporaryLayer",!0,a));c&&d.push(c)},this);return d},_getAllSubLayerObject:function(){var a=[];this.traversal(e.hitch(this,function(b){b.layerObject&&b.layerObject.getLayers&&
(a=a.concat(b.layerObject.getLayers()))}));return a},_getSubLayerInfoIdForSubFolder:function(a){return this.id+"_folder_"+a.id},_needToRenew:function(){return f.some(this._getAllSubLayerObject(),function(a){if(!e.getObject("_wabProperties.kmllayerWasHandled",!1,a))return!0},this)},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(a=l.after(this.layerObject,"setFolderVisibility",e.hitch(this,this._onSubFolderVisibleChanged),!0),this._eventHandles.push(a))},
_onSubFolderVisibleChanged:function(a){a=this._getSubLayerInfoIdForSubFolder(a);(a=this.findLayerInfoById(a))&&m.publish("layerInfos/layerInfo/visibleChanged",[a])}})});