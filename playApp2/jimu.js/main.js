// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*
 Chen, Yi-Cyuan 2015-2017
 @license MIT
*/
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/AGOLLoading ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a){function u(a,b){var c=f.clone(a),h=l.widgetProperties;"undefined"===typeof b&&(b=!1);delete c.mode;delete c.configWabVersion;l.visitElement(c,
function(a,d){a.widgets?(delete a.isOnScreen,delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&delete a.icon,delete a.openType,d.isOnScreen&&a.panel&&l.isEqual(a.panel,c.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,delete a.isRemote,delete a.featureActions,h.forEach(function(b){delete a[b]}),
b?"undefined"===typeof a.openAtStart&&(a.openAtStart=!1):(a.visible&&delete a.visible,a.manifest&&a.label===a.manifest.label&&delete a.label,a.isDefaultConfig&&(delete a.config,delete a.isDefaultConfig)),delete a.manifest,a.itemId&&delete a.uri)});delete c.rawAppConfig;delete c._ssl;delete c.getConfigElementById;delete c.getConfigElementsByName;delete c.processNoUriWidgets;delete c.addElementId;delete c.getCleanConfig;delete c.visitElement;delete c.agolConfig;delete c._itemData;delete c.oldWabVersion;
delete c.titleColor;return c}var v=null,x;x=t(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a){this.urlParams=a||{};this.listenBuilderEvents();this.versionManager=new p;this.widgetManager=g.getInstance();this.configLoader=d.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&f.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(e);
"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&f.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(e);l.isMobileUa()||m(window,"resize",f.hitch(this,this._onWindowResize));m(window,"orientationchange",f.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){e.subscribe("builder/widgetChanged",f.hitch(this,this._onWidgetChanged));e.subscribe("builder/groupChanged",f.hitch(this,this._onGroupChanged));e.subscribe("builder/layoutDefinitionChanged",
f.hitch(this,this._onLayoutDefinitionChanged));e.subscribe("builder/onScreenGroupsChanged",f.hitch(this,this._onOnScreenGroupsChanged));e.subscribe("builder/widgetPoolChanged",f.hitch(this,this._onWidgetPoolChanged));e.subscribe("builder/openAtStartChange",f.hitch(this,this._onOpenAtStartChanged));e.subscribe("builder/onScreenOrderChanged",f.hitch(this,this._onScreenOrderChanged));e.subscribe("builder/mapContentModified",f.hitch(this,this._onMapContentModified));e.subscribe("builder/mapChanged",f.hitch(this,
this._onMapChanged));e.subscribe("builder/mapOptionsChanged",f.hitch(this,this._onMapOptionsChanged));e.subscribe("builder/mapRefreshIntervalChanged",f.hitch(this,this._onMapRefreshIntervalChanged));e.subscribe("builder/appAttributeChanged",f.hitch(this,this._onAppAttributeChanged));e.subscribe("builder/dataSourceChanged",f.hitch(this,this._onDataSourceChanged));e.subscribe("builder/setAppConfig",f.hitch(this,this._onAppConfigSet));e.subscribe("builder/themeChanged",f.hitch(this,this._onThemeChanged));
e.subscribe("builder/layoutChanged",f.hitch(this,this._onLayoutChanged));e.subscribe("builder/styleChanged",f.hitch(this,this._onStyleChanged));e.subscribe("builder/syncExtent",f.hitch(this,this._onSyncExtent));e.subscribe("builder/loadingPageChanged",f.hitch(this,this._onLoadingPageChanged));e.subscribe("builder/templateConfigChanged",f.hitch(this,this._onTemplateConfigChanged));e.subscribe("builder/appProxyForMapChanged",f.hitch(this,this._onAppProxyForMapChanged));e.subscribe("builder/appProxyForUrlChanged",
f.hitch(this,this._onAppProxyForUrlChanged));e.subscribe("builder/sharedThemeChanged",f.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode){var a=new n;a.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(f.hitch(this,function(b){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(b);console.timeEnd("Load Config");window.appInfo.isRunInMobile=l.inMobileSize();b=
this.getAppConfig();a.destroy();e.publish("appConfigLoaded",b);return b}),f.hitch(this,function(b){a.destroy();console.error(b);b&&b.message&&"string"===typeof b.message&&this._showErrorMessage(b.message)}))}},_showErrorMessage:function(a){q.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(a)},document.body);q.setStyle(jimuConfig.loadingId,"display","none")},getAppConfig:function(){var a;window.appInfo.isRunInMobile?(a=f.clone(this._getMobileConfig(this.appConfig)),a._originConfig=f.clone(this.appConfig)):
a=f.clone(this.appConfig);a.getConfigElementById=function(a){return l.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return l.getConfigElementsByName(this,a)};a.getCleanConfig=function(a){return this._originConfig?u(this._originConfig,a):u(this,a)};a.visitElement=function(a){l.visitElement(this,a)};return a},_onOrientationChange:function(){this.appConfig&&e.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var a=l.inMobileSize();window.appInfo.isRunInMobile!==
a&&(window.appInfo.isRunInMobile=a,this.appConfig&&e.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(a){return l.mixinAppConfigPosition(a,a.mobileLayout)},_updateDataSourceForWidget:function(a){this._deleteDataSourcesFromWidget(a);this._addDataSourcesForWidget(a)},_deleteDataSourcesFromWidget:function(a){for(var b in this.appConfig.dataSource.dataSources)b.startWith("widget~"+a.id+"~")&&delete this.appConfig.dataSource.dataSources[b]},_addDataSourcesForWidget:function(a){k.forEach(a.provideDataSources,
function(b){var c="widget~"+a.id+"~"+b.id;b.id=c;this.appConfig.dataSource.dataSources[c]=b},this);delete a.provideDataSources},_addIdForWidgets:function(a){var b=0,c;this.getAppConfig().visitElement(function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var h=a.id.lastIndexOf("_");-1<h&&(c=a.id.substr(h+1),b=Math.max(b,c))}});k.forEach(a,function(a){a.id||(b++,a.id=a.itemId?a.itemId+"_"+b:a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_onWidgetChanged:function(a){var b=l.reCreateObject(a);a=l.getConfigElementById(this.appConfig,
a.id);this._updateDataSourceForWidget(b);!1!==b.inPanel||a.uri||(b.closeable=!0);for(var c in b)a[c]=b[c];delete a.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"widgetChange",b)},_onGroupChanged:function(a){var b=l.reCreateObject(a);a=l.getConfigElementById(this.appConfig,a.id);this._handleDataSourceForWidgets(a,b);for(var c in b)a[c]=b[c];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
e.publish("appConfigChanged",this.getAppConfig(),"groupChange",b)},_handleDataSourceForWidgets:function(a,b){var c=k.filter(b.widgets,function(b){return b.id?0===k.filter(a.widgets,function(a){return b.id===a.id}).length:!0},this);this._addIdForWidgets(c);k.forEach(c,function(a){this._addDataSourcesForWidget(a)},this);c=k.filter(a.widgets,function(a){return 0===k.filter(b.widgets,function(b){return b.id===a.id}).length},this);k.forEach(c,function(a){this._deleteDataSourcesFromWidget(a)},this);k.forEach(b.widgets,
function(b){k.forEach(a.widgets,function(a){b.id===a.id&&b.provideDataSources&&this._updateDataSourceForWidget(b)},this)},this)},_onWidgetPoolChanged:function(a){var b=l.reCreateObject(a);this._handleDataSourceForWidgetsSection(this.appConfig.widgetPool,b);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=b.widgets,this.appConfig.widgetPool.groups=b.groups):(a=l.getConfigElementById(this.appConfig,b.controllerId),k.forEach(a.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,
a)},this),k.forEach(a.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?b.widgets:this.appConfig.widgetPool.widgets.concat(b.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?b.groups:this.appConfig.widgetPool.groups.concat(b.groups),a.controlledWidgets=k.map(b.widgets,function(a){return a.id}),a.controlledGroups=k.map(b.groups,
function(a){return a.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",b)}))},_handleDataSourceForWidgetsSection:function(a,b){var c=b.widgets;k.forEach(b.groups,function(a){c=c.concat(a.widgets)},this);var h=a.widgets;k.forEach(a.groups,function(a){h=h.concat(a.widgets)},this);
this._handleDataSourceForWidgets({widgets:h},{widgets:c})},_removeWidgetOrGroupFromPoolById:function(a,b){k.some(a.widgetPool.widgets,function(c,h){if(c.id===b)return a.widgetPool.widgets.splice(h,1),!0});k.some(a.widgetPool.groups,function(c,h){if(c.id===b)return a.widgetPool.groups.splice(h,1),!0})},_onOpenAtStartChanged:function(a){var b=l.reCreateObject(a),c=this.appConfig;a.isOnScreen?(c=c.widgetOnScreen&&c.widgetOnScreen.widgets)&&0<c.length&&k.forEach(c,f.hitch(this,function(b){b.id===a.id?
b.openAtStart=!b.openAtStart:delete b.openAtStart})):((c=c.widgetPool)&&c.groups&&0<c.groups.length&&k.forEach(c.groups,f.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})),c&&c.widgets&&0<c.widgets.length&&k.forEach(c.widgets,f.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})));e.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",b)},_onScreenOrderChanged:function(a){var b=l.reCreateObject(a);k.forEach(this.appConfig.widgetOnScreen.widgets,
function(a){a.isController||(!1!==a.inPanel||!0!==a.closeable)&&!0!==a.inPanel&&a.uri||k.some(b,function(b){if(a.id===b.id)return a.position=b.position,!0})},this);e.publish("appConfigChanged",this.getAppConfig(),"onScreenOrderChange",b)},_onAppAttributeChanged:function(a){a=l.reCreateObject(a);f.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),
"attributeChange",a)},_onDataSourceChanged:function(a){var b=l.reCreateObject(a);this.appConfig.dataSource=b;e.publish("appConfigChanged",this.getAppConfig(),"dataSourceChange",a)},_onLoadingPageChanged:function(a){a=l.reCreateObject(a);var b;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:"backgroundImage"in a?(b=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=f.mixin(b,a.backgroundImage)):"loadingGif"in a&&(b=this.appConfig.loadingPage.loadingGif||
{},this.appConfig.loadingPage.loadingGif=f.mixin(b,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onAppProxyForMapChanged:function(a){a=l.reCreateObject(a);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==a.mapItemId?this.appConfig.map.appProxy=a:k.forEach(a.proxyItems,f.hitch(this,function(a){if(!k.some(this.appConfig.map.appProxy.proxyItems,function(b){if(b.sourceUrl===
a.sourceUrl)return b.useProxy=a.useProxy,b.proxyUrl=a.proxyUrl||"",b.proxyId=a.proxyId||"",isNaN(a.hitsPerInterval)||(b.hitsPerInterval=a.hitsPerInterval),isNaN(a.intervalSeconds)||(b.intervalSeconds=a.intervalSeconds),!0})&&a.useProxy&&a.proxyUrl){var b=this.appConfig.map.appProxy.proxyItems||[];b.push(a);this.appConfig.map.appProxy.proxyItems=b}})):this.appConfig.map.appProxy=a;e.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onAppProxyForUrlChanged:function(a){a=l.reCreateObject(a);
this.appConfig.appProxies=a;e.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onTemplateConfigChanged:function(a){a=l.reCreateObject(a);this.appConfig.templateConfig=a;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onMapContentModified:function(){e.publish("mapContentModified")},_onMapChanged:function(a){var b=l.reCreateObject(a);this.appConfig.map.mapOptions&&
l.deleteMapOptions(this.appConfig.map.mapOptions);this.appConfig.map.mapRefreshInterval={useWebMapRefreshInterval:!0};f.mixin(this.appConfig.map,b);this._deleteDataSourcesFromMap();this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"mapChange",b)}))},_deleteDataSourcesFromMap:function(){k.forEach(Object.keys(this.appConfig.dataSource.dataSources),
function(a){a.startWith("map")&&delete this.appConfig.dataSource.dataSources[a]},this)},_onMapOptionsChanged:function(a){a=l.reCreateObject(a);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});f.mixin(this.appConfig.map.mapOptions,a);e.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onMapRefreshIntervalChanged:function(a){a=l.reCreateObject(a);this.appConfig.map.mapRefreshInterval||(this.appConfig.map.mapRefreshInterval={});f.mixin(this.appConfig.map.mapRefreshInterval,
a);this.appConfig.map.mapRefreshInterval.useWebMapRefreshInterval&&delete this.appConfig.map.mapRefreshInterval.minutes;e.publish("appConfigChanged",this.getAppConfig(),"mapRefreshIntervalChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(f.hitch(this,function(b){var c=f.clone(this.appConfig.widgetOnScreen);this.appConfig=b;this._handleDataSourceForWidgetsSection(c,{});e.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=
l.mixinAppConfigPosition(this.appConfig,a.layoutConfig);this.appConfig.layoutDefinition=a.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:(delete this.appConfig.theme.customStyles,
delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});e.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onOnScreenGroupsChanged:function(a){a=l.reCreateObject(a);this.appConfig.widgetOnScreen.groups=a.groups;e.publish("appConfigChanged",this.getAppConfig(),"onScreenGroupsChange",a.groups)},_onLayoutDefinitionChanged:function(a){a=l.reCreateObject(a);l.isEqual(this.appConfig.layoutDefinition,
a.layoutDefinition)||(this.appConfig.layoutDefinition=a.layoutDefinition,this.appConfig.widgetOnScreen.groups=l.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,a.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),e.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",a.layoutDefinition))},_onSharedThemeChanged:function(a){var b=this.appConfig.theme.sharedTheme;a=l.reCreateObject(a);a.useHeader&&!b.useHeader&&
(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!a.useHeader&&b.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));
a.useLogo&&!b.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!a.useLogo&&b.useLogo&&
this._onAppAttributeChanged({logo:this.appConfig.logo});f.mixin(b,a);e.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",a)},_onSyncExtent:function(a){e.publish("syncExtent",a)},_genStyles:function(a,b){var c=[];c.push(b);k.forEach(a,function(a){0>c.indexOf(a)&&c.push(a)});return c},_getAppConfigFromTheme:function(a){var b=new r,c,h=[],d=this.getAppConfig().getCleanConfig();d.mode=this.urlParams.mode;k.forEach(d.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)c=
f.clone(a.appConfig),c.map=d.map,c.map.position=a.appConfig.map.position,this._copyPoolToThemePool(d,c),c.links=d.links,c.title=d.title,c.subtitle=d.subtitle,c.logo=d.logo;else{var n=a.getCurrentLayout(),h=a.getCurrentStyle();c=f.clone(d);n=f.clone(n.layoutConfig);c.widgetOnScreen=n.widgetOnScreen;n.widgetPool&&(k.forEach(n.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),k.forEach(n.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(d,n);c.widgetPool=
n.widgetPool;n.map&&n.map.position&&(c.map.position=n.map.position);c.mobileLayout=n.mobileLayout;c.layoutDefinition=n.layoutDefinition;h=this._genStyles(k.map(a.getStyles(),function(a){return a.name}),h.name);c.theme={name:a.getName(),styles:h,version:a.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(c.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},c.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):
(c.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},c.theme.customStyles={mainBackgroundColor:""});c.titleColor=d.titleColor;c.logoLink=d.logoLink}this.configLoader.addNeedValues(c);this.configLoader.loadWidgetsManifest(c).then(f.hitch(this,function(a){return this.configLoader.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(){this._addDefaultValues(c);b.resolve(c)}));return b},_copyPoolToThemePool:function(a,b){var c=a.widgetPool;b.widgetPool||(b.widgetPool={});a=b.widgetPool;
var h=k.filter(a.widgets,function(a){if(a.isPreconfiguredInTheme||!k.some(c.widgets,function(b){return b.name===a.name}))return!0}),d=k.filter(a.groups,function(a){return a.isPreconfiguredInTheme}),n=k.filter(c.widgets,function(a){return!a.isPreconfiguredInTheme}),g=k.filter(c.groups,function(a){return!a.isPreconfiguredInTheme}),n=this._getPoolWidgetsWithoutDuplicated(n,b.widgetOnScreen.widgets||[]);a.widgets=n.concat(h);a.groups=g.concat(d)},_getPoolWidgetsWithoutDuplicated:function(a,b){for(var c=
f.clone(a),h=this.getAppConfig(),d=a.length-1;0<=d;d--)for(var n=b.length-1;0<=n;n--)if(b[n].uri){var g=b[n].name;g||(g=l.getWidgetNameFromUri(b[n].uri));var u=h.getConfigElementById(a[d].id);a[d]&&a[d].name===g&&!1===u.supportMultiInstance&&(console.log("Widget",a[d].name,"is not copied to new theme because this widget exists in new theme."),c.splice(d,1))}return c},_onAppConfigSet:function(a){a=l.reCreateObject(a);window.appInfo.isRunInMobile=l.inMobileSize();this.configLoader.processProxy(a);this.configLoader.addNeedValues(a);
this.configLoader.loadAndUpgradeAllWidgetsConfig(a).then(f.hitch(this,function(a){this._addDefaultValues(a);c.setPortalUrl(a.portalUrl);window.portalUrl=a.portalUrl;this.appConfig?(l.deleteMapOptions(a.map.mapOptions),this.appConfig=a,this._deleteDataSourcesFromMap(),e.publish("appConfigChanged",this.getAppConfig(),"resetConfig",a)):(this.appConfig=a,b.getPortal(a.portalUrl).loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;e.publish("appConfigLoaded",this.getAppConfig())})))}))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);
this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);this._addDefaultDataSource(a);this._addDefaultSharedTheme(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===
a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultDataSource:function(a){a.dataSource?(a.dataSource.dataSources||(a.dataSource.dataSources={}),a.dataSource.settings||(a.dataSource.settings={})):a.dataSource={dataSources:{},settings:{}}},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(b){var c=
b&&b.geometryService,c=c&&"string"===typeof c&&f.trim(c)?f.trim(c):this.portalSelf.helperServices.geometry.url;b.geometryService=c;h.defaults.geometryService=new a(b.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});
"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(a){l.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultSharedTheme:function(a){a.theme.sharedTheme?("undefined"===typeof a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.useHeader=!1),"undefined"===typeof a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.useLogo=!1)):a.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);
this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var b,c;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||
(a.widgets[b].position={}),a.widgets[b].position.relativeTo||(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0!==a.widgets[b].inPanel||a.widgets[b].panel||(a.widgets[b].panel=f.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++)for(a.groups[b].panel||(a.groups[b].panel=a.panel),a.groups[b].panel&&!a.groups[b].panel.position&&
(a.groups[b].panel.position={}),a.groups[b].panel.position.relativeTo||(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map"),a.groups[b].widgets||(a.groups[b].widgets=[]),c=0;c<a.groups[b].widgets.length;c++)a.groups[b].widgets[c].panel=a.groups[b].panel}},_addPoolDefaultPanelAndPosition:function(a){var b,c,d=a.widgetPool;if(d){b=d.panel&&d.panel.positionRelativeTo?d.panel.positionRelativeTo:"map";"undefined"===typeof d.panel||"undefined"===
typeof d.panel.uri?d.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof d.panel.position?d.panel.position={relativeTo:b}:"undefined"===typeof d.panel.position.relativeTo&&(d.panel.position.relativeTo=b);if(d.groups)for(b=0;b<d.groups.length;b++)for(d.groups[b].panel?d.groups[b].panel.position.relativeTo||(d.groups[b].panel.position.relativeTo=d.groups[b].panel.positionRelativeTo?d.groups[b].panel.positionRelativeTo:"map"):d.groups[b].panel=d.panel,d.groups[b].widgets||
(d.groups[b].widgets=[]),c=0;c<d.groups[b].widgets.length;c++)d.groups[b].widgets[c].panel=d.groups[b].panel;if(d.widgets)for(b=0;b<d.widgets.length;b++)!1===d.widgets[b].inPanel?(c=d.widgets[b].positionRelativeTo?d.widgets[b].positionRelativeTo:"map",d.widgets[b].position)?d.widgets[b].position.relativeTo||(d.widgets[b].position.relativeTo=c):d.widgets[b].position={relativeTo:c}:d.widgets[b].panel||(d.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){l.visitElement(a,f.hitch(this,
function(a,b){a.isOnScreen=b.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:window.apiNls.common.groupLabel),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:window.apiNls.common.groupLabel+" "+b.index)):a.gid=b.groupId}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+
"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(a){var b=0,c,d;if(a.widgetPool.widgets)for(c=0;c<a.widgetPool.widgets.length;c++)a.widgetPool.widgets[c].index=b,b++;if(a.widgetPool.groups)for(c=0;c<a.widgetPool.groups.length;c++)for(a.widgetPool.groups[c].index=b,b++,d=0;d<a.widgetPool.groups[c].widgets.length;d++)a.widgetPool.groups[c].widgets[d].index=d}});x.getInstance=function(a){null===v?v=new x(a):a&&(v.urlParams=a,v.configLoader&&(v.configLoader.urlParams=
a));window.getAppConfig=f.hitch(v,v.getAppConfig);return v};return x})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang moment/moment esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils ./shared/utils ./accessibleUtils ./zoomToUtils libs/caja-html-sanitizer-minified".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w,B,F,D,G,H,M,L,J,K,N,P,Q,O,R,I,V,Y,S,Z){function aa(a,b){a=a||"";var c=0,d=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!y.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){c++;c===d.length&&b()}}];for(a=0;a<d.length;a++)testLoad(d[a])}function ba(a,b){var c=a.match(/url\([^)]+\)/gi),d,h;if(null===c||""===b)return a;for(d=0;d<c.length;d++)if(h=c[d].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),
4<=h.length){var n=h[2];/^data:image\/.*;/.test(n)||(b.endWith("/")||(b+="/"),a=a.replace(h[1]+n+h[3],h[1]+b+n+h[3]))}return a}function W(a,b){var c=Array.isArray(b),d=c&&[]||{};c?(a=a||[],d=d.concat(a),b.forEach(function(b,c){"undefined"===typeof a[c]?d[c]=b:"object"===typeof b?d[c]=W(a[c],b):-1===a.indexOf(b)&&d.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){d[b]=a[b]}),Object.keys(b).forEach(function(c){d[c]="object"===typeof b[c]&&b[c]?a[c]?W(a[c],b[c]):b[c]:b[c]}));return d}
function X(a,b){var c=a.map(function(a){return a.id});f.forEach(b,function(b){0>c.indexOf(b)&&a.push({id:b,widgets:[]})},this);var d=[];a=f.filter(a,function(a){return 0>b.indexOf(a.id)?(d.push(a),!1):!0},this);if(0===a.length)return[];var h=a[a.length-1];f.forEach(d,function(a){h.widgets=h.widgets.concat(a.widgets)},this);return a=a.sort(function(a,c){return b.indexOf(a.id)-b.indexOf(c.id)})}function U(a,b,c){function d(a,b){return t.isArray(a[b.key])?a[b.key][b.index]:a[b.key]}b=function(a){var b=
[];a.split("_").forEach(function(a){var c=!1,d;"--"===a.slice(a.length-2)&&(c=!0,a=a.slice(0,a.length-2));d=a.search(/\[[0-9]+\]/);-1===d&&(d=a.length);b.push({key:a.slice(0,d),index:Number(a.slice(d+1,-1)),deleteFlag:c})});return b}(b);for(var h=1;h<b.length-1;h++)if(a=d(a,b[h]),!a)return;if(b[b.length-1].deleteFlag)!0===c&&(t.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(t.isArray(a[b[b.length-1].key])){if(void 0===c)return a[b[b.length-
1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=c}else{if(void 0===c)return a[b[b.length-1].key];a[b[b.length-1].key]=c}}function ca(a,b,c){function d(c){c=y.template.getSearchRange(b,c,"]");var d=b.slice(c.firstPos,c.lastPos);return-1!==c.firstPos?(d=b.slice(c.firstPos+d.indexOf("[")+1,c.lastPos-1),c=b.slice(c.lastPos+1),(d=y.getConfigElementById(a,d))?{object:d,key:"section_"+c,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var h=a,n=b=b.replace(/\//g,"_"),g=
d("groups\\[.+\\]");if("deleted"!==g.state&&("isSection"===g.state&&(h=g.object,n=g.key),g=d("widgets\\[.+\\]"),"delete"!==g.state))return"isSection"===g.state&&(h=g.object,n=g.key),U(h,n,c)}var y={},T={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};t.mixin(y,Y);t.mixin(y,S);t.mixin(y,Z);window.atob||(window.atob=function(a){a=u.decode(a);for(var b="",c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);return b});window.btob||(window.btob=function(a){for(var b=
[],c=0,d=a.length;c<d;c++)b.push(String.charCodeAt(a[c]));return u.encode(b)});var ga="unload",la=[];require.on("error",function(a){f.forEach(la,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var c in a.info)-1<c.indexOf(b.resKey)&&b.def.reject(a)})});y.checkError=function(a,b){la.push({resKey:a,def:b})};y.replacePlaceHolder=function(a,b){var d=c.stringify(a),h=d.match(/\$\{(\w)+\}/g);if(null===h)return a;for(a=0;a<h.length;a++){var n=h[a].match(/(\w)+/g)[0];b[n]&&(d=d.replace(h[a],
b[n]))}return c.parse(d)};y.changeUnit=function(a){var b=Math.abs(a),c;a=Math.floor(b);c=Math.floor(60*(b-a));b=(60*(60*(b-a)-c)).toFixed(2);return a+"\u00b0"+(10>c?"0"+c:c)+"'"+(10>b?"0"+b:b)+'"'};y.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};y.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+
parseInt(a[3],10)/10)};y.preloadImg=function(a,b){var c=[],c="string"===typeof a?[a]:a;f.forEach(c,function(a){(new Image).src=b?b+a:a})};y.setWABLogoDefaultAlt=function(a){if(a){a=m("img",a);for(var b=["img_1412759111499","img_1545621838463","img_1560482577021"],c=0,d=a.length;c<d;c++){var h=a[c];-1<b.indexOf(k.getAttr(h,"id"))&&!k.getAttr(h,"alt")&&k.setAttr(h,"alt","Web AppBuilder for ArcGIS.png")}}};var ea=null;y.getImagesSize=function(a){var b=new g;if(!a||0!==a.indexOf("http"))return b.reject(),
b;null===ea&&(ea=k.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var c=d(ea,"load",function(){clearTimeout(h);h=null;c.remove();var a=k.getContentBox(ea);1===a.w&&1===a.h||0===a.w||0===a.h?b.reject():b.resolve([a.w,a.h])},{}),h=setTimeout(function(){clearTimeout(h);h=null;b.reject()},5E3);k.setAttr(ea,"src",a);return b};y.getPositionStyle=function(a){var b={};if(!a)return b;a=t.clone(a);if(window.isRTL){var c;"undefined"!==typeof a.left&&
"undefined"!==typeof a.right?(c=a.left,a.left=a.right,a.right=c):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(c=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=c):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight);"undefined"!==
typeof a.marginLeft&&"undefined"!==typeof a.marginRight?(c=a.marginLeft,a.marginLeft=a.marginRight,a.marginRight=c):"undefined"!==typeof a.marginLeft?(a.marginRight=a.marginLeft,delete a.marginLeft):"undefined"!==typeof a.marginRight&&(a.marginLeft=a.marginRight,delete a.marginRight)}c="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var d=0;d<c.length;d++){var h=c[d];"number"===typeof a[h]?
b[h]=a[h]+"px":"undefined"!==typeof a[h]?b[h]=a[h]:"padding"===h.substr(0,7)||"margin"===h.substr(0,7)?b[h]=0:b[h]="auto"}b.zIndex="undefined"===typeof a.zIndex?"auto":a.zIndex;return b};y.isEqual=function(a,b){function c(a,b){var n;if(null===a&&null===b||"undefined"===typeof a&&"undefined"===typeof b)return!0;if(null===a&&null!==b||null===b&&null!==a||"undefined"===typeof a&&"undefined"!==typeof b||"undefined"===typeof b&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&
"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof RegExp&&b instanceof RegExp||a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<d.indexOf(a)||-1<h.indexOf(b))return!1;if(null!==b){for(n in b)if(b.hasOwnProperty(n)!==a.hasOwnProperty(n)||typeof b[n]!==typeof a[n])return!1;for(n in a){if(b.hasOwnProperty(n)!==a.hasOwnProperty(n)||typeof b[n]!==
typeof a[n])return!1;switch(typeof a[n]){case "object":case "function":d.push(a);h.push(b);if(!c(a[n],b[n]))return!1;d.pop();h.pop();break;default:if(!(isNaN(a[n])&&isNaN(b[n])&&"number"===typeof a[n]&&"number"===typeof b[n]||a[n]===b[n]))return!1}}}return!0}var d,h;d=[];h=[];return c(a,b)?!0:!1};y.file={loadFileAPI:function(){var a=new g;if("unload"===ga){var b=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:b+"libs/polyfills/fileAPI/",flashUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.swf",
flashImageUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};aa(b,t.hitch(this,function(){ga="loaded";a.resolve()}));ga="loading"}else"loaded"===ga&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return q("safari")&&6>q("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(fa){a=
null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-y.file.getNameFromPath(a).length)},readFile:function(a,b,c,d){if(this.supportHTML5()){var h=a.target.files[0];h&&(h.type.match(b)?h.size>=
c?d({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){d(null,h.name,a.target.result)},a.readAsDataURL(h)):d({errCode:"invalidType"}))}else if(this.supportFileAPI()){var n=window.FileAPI.getFiles(a);n[0].type.match(b)?n[0].size>=c?d({errCode:"exceed"}):window.FileAPI.readAsDataURL(n[0],function(a){a&&a.result?d(null,n[0].name,a.result):d({errCode:"readError"})}):d({errCode:"invalidType"})}}};y.getUriInfo=function(a){var b,c={};b=a.indexOf("/");a.substring(0,b);b=a.substring(0,a.lastIndexOf("/")+
1);c.folderUrl=require(y.getRequireConfig()).toUrl(b);c.amdFolder=b;c.url=c.folderUrl;if(/^http(s)?:\/\//.test(a)||/^\/\//.test(a))c.isRemote=!0;return c};y.widgetJson=function(){var a={addManifest2WidgetJson:function(a,b){t.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b;a.isRemote=b.isRemote;a.isRemote&&(a.itemId=b.itemId);b.featureActions&&(a.featureActions=b.featureActions);a.icon||(a.icon=b.icon);a.thumbnail||(a.thumbnail=b.thumbnail);a.folderUrl=b.folderUrl;a.amdFolder=
b.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var b in a.manifest.properties)a[b]=void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}},getUriFromItem:function(b){return b.url?a.getFolderUrlFromItem(b)+"Widget":null},getFolderUrlFromItem:function(a){if(!a.url)return null;a=/manifest\.json$/.test(a.url)?a.url.substring(0,a.url.length-13):/\/$/.test(a.url)?a.url:a.url+"/";"https:"===window.location.protocol&&(a=a.replace(/^http:\/\//,"https://"));
return a}};return a}();y.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};y.getTypeByGeometryType=function(a){var b="",c="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),d=["esriGeometryRing",
"esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=c.indexOf(a)?b="polyline":0<=d.indexOf(a)&&(b="polygon");return b};y.getSymbolTypeByGeometryType=function(a){var b=null;a=y.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b="fill");return b};y.getServices=function(){return T};y.getArcGISDefaultGeometryService=function(){return new H(T.geometryService)};y.restoreToDefaultWebMapExtent=function(a,
b,c){var d=new g;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){d.reject("Invalid map.")},0),d;b=b&&b.itemInfo;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo")},0),d;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo.item.extent")}),d;var h=new C({wkid:4326}),h=new A(b[0][0],b[0][1],b[1][0],b[1][1],h);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(h);if(a.spatialReference.isWebMercator())return h=G.geographicToWebMercator(h),
a.setExtent(h);b=new M;b.geometries=[h];b.outSR=a.spatialReference;h=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;h&&"esri.tasks.GeometryService"===h.declaredClass||(c&&"string"===typeof c&&t.trim(c)?(c=t.trim(c),h=new H(c)):h=y.getArcGISDefaultGeometryService());h.project(b).then(function(b){if(b=b&&b[0])return a.setExtent(b);d.reject("Invalid projected geometry.");return d},function(a){console.error(a);d.reject(a);return d});return d};y.getAncestorWindow=function(){for(var a=
window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};y.getAncestorDom=function(a,b,c){if(a&&1===a.nodeType&&b&&"function"===typeof b){var d=100,h=document.body;c&&("number"===typeof c?(c=parseInt(c,10),0<c&&(d=c)):1===c.nodeType&&(h=c));for(c=0;a.parentNode&&c<d&&k.isDescendant(a.parentNode,h);){if(b(a.parentNode))return a.parentNode;a=a.parentNode;c++}}return null};y.bindClickAndDblclickEvents=function(a,b,c,h){var n=null;if(a&&1===a.nodeType&&b&&"function"===typeof b&&c&&"function"===typeof c){var g=
200;h&&"number"===typeof h&&(h=parseInt(h,10),0<h&&(g=h));var u=0,n=d(a,"click",function(a){u++;1===u?setTimeout(function(){1===u&&(u=0,b(a))},g):2===u&&(u=0,c(a))})}return n};y.isScrollToBottom=function(a){var b=k.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+b.h)};y.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};y.getItemQueryStringByTypes=function(a){var b="",c=y.getAllItemTypes();if(a&&0<a.length&&0<a.length){var d="";f.forEach(a,function(b,c){d+=' type:"'+b+'" ';c!==a.length-1&&(d+=" OR ")});b=" ( "+d+" ) ";c=a.concat(c);c=f.filter(c,function(b){return f.every(a,
function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});f.forEach(c,function(a){b+=' -type:"'+a+'" '})}return b};y.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};y.isNotEmptyString=function(a,b){var c=a&&"string"===typeof a;return c?b?c&&t.trim(a):!0:!1};y.isNotEmptyStringArray=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(!y.isNotEmptyString(d.value?d.value:d,b))return!1}return!0};y.isValidNumber=function(a){return"number"===
typeof a&&!isNaN(a)};y.isValidNumberArray=function(a){for(var b=0;b<a.length;b++){var c=a[b],c=c.value||0===c.value?c.value:c;if(!y.isValidNumber(c))return!1}return!0};y.isValidDate=function(a){if(a)try{var b=y.getDateByDateTimeStr(a);return!isNaN(b.getTime())}catch(da){return console.error(da),!1}else return!1};y.isObject=function(a){return a&&"object"===typeof a};y.createWebMap=function(a,b,c,d){a=V.getStandardPortalUrl(a);a=V.getBaseItemUrl(a);z.arcgisUrl=a;return z.createMap(b,c,d)};y.getRandomString=
function(){var a=Math.random().toString();return a=a.slice(2,a.length)};y._getDomainsByServerName=function(a){var b=a.split("."),c=b.length;return f.map(b,t.hitch(this,function(a,d){a=b.slice(d,c);var h="",n=a.length-1;f.forEach(a,t.hitch(this,function(a,b){h+=a;b!==n&&(h+=".")}));return h}))};y.removeCookie=function(a,b){var c=this._getDomainsByServerName(window.location.hostname);f.forEach(c,t.hitch(this,function(c){n(a,null,{expires:-1,path:b});n(a,null,{expires:-1,path:b,domain:c});n(a,null,{expires:-1,
path:b,domain:"."+c})}))};y.isLocaleChanged=function(a,b){return!a.startWith(b)};y.hashToObject=function(a){a=a.replace("#","");a=r.queryToObject(a);for(var b in a)if(a.hasOwnProperty(b))try{a[b]=c.parse(a[b])}catch(da){}return a};y.reCreateObject=function(a){function b(a){var d=[];a.forEach(function(a){Array.isArray(a)?d.push(b(a)):"object"===typeof a?d.push(c(a)):d.push(a)});return d}function c(a){var d={},h;for(h in a)a.hasOwnProperty(h)&&(null===a[h]?d[h]=null:Array.isArray(a[h])?d[h]=b(a[h]):
d[h]="object"===typeof a[h]?c(a[h]):a[h]);return d}return Array.isArray(a)?b(a):c(a)};y.setVerticalCenter=function(a){setTimeout(function(){var b=m(".jimu-vcenter-text",a),c,d;f.forEach(b,function(a){c=k.getContentBox(a).h;k.setStyle(a,{lineHeight:c+"px"})},this);b=m(".jimu-vcenter",a);f.forEach(b,function(a){c=k.getContentBox(a).h;d=k.getContentBox(m(a).parent()[0]).h;k.setStyle(a,{marginTop:(d-c)/2+"px"})},this)},10)};y.merge=W;y.loadStyleLink=function(a,b,c){var h=new g,n,u=require(y.getRequireConfig()).toUrl(b);
if(require.cache["url:"+u]){n=require.cache["url:"+u];var v=u.split("/").pop(),u=u.substr(0,u.length-v.length);n=ba(n,u);a=c?k.create("style",{id:a,type:"text/css"},k.byId(c),"before"):k.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=n:a.appendChild(k.toDom(n));h.resolve("load");return h}n=c?k.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},k.byId(c),"before"):k.create("link",
{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);d(n,"load",function(){h.resolve("load")});var l=setInterval(function(){var a;if(f.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(b),c.href.length)===b)return a=c,!0}))try{!h.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&h.resolve("load"),clearInterval(l)}catch(ja){}},50);return h};y.changeLocation=function(a){window.history.pushState&&
window.history.pushState({path:a},"",encodeURI(a))};y.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=K.urlToObject(a),b.hash=null):(a=a.split("#"),b=K.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?r.queryToObject(a[1]):a[1]:null);return b};y.manifest=function(){function a(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon=
"layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}return{addManifestProperies:function(b){b.icon||(b.icon=b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);b.thumbnail||(b.thumbnail=b.folderUrl+"images/thumbnail.png");"theme"===b.category?a(b):("undefined"!==typeof b["2D"]&&(b.support2D=b["2D"]),"undefined"!==typeof b["3D"]&&(b.support3D=b["3D"]),"undefined"===typeof b["2D"]&&"undefined"===typeof b["3D"]&&(b.support2D=!0),delete b["2D"],delete b["3D"],"undefined"===
typeof b.properties&&(b.properties={}),Y.processWidgetProperties(b))},processManifestLabel:function(a,b){var c=b.split("-")[0];a.label=a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels[c]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&f.forEach(a.layouts,function(c){var d="i18nLabels_layout_"+c.name;c.label=a[d]&&(a[d][b]||a[d].defaultLabel)||c.label||c.name});a.styles&&f.forEach(a.styles,function(c){var d="i18nLabels_style_"+c.name;c.label=a[d]&&(a[d][b]||a[d].defaultLabel)||c.label||c.name})},
addI18NLabel:function(a){var b=new g;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var c;c=a.isRemote?a.amdFolder+"nls/strings.js":a.amdFolder+"nls/strings";require(y.getRequireConfig(),["dojo/i18n!"+c],function(c){var d={};d[dojoConfig.locale]=c;Y.addI18NLabelToManifest(a,null,d);b.resolve(a)});return b}}}();y.isNumberField=function(a){return 0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"].indexOf(a)};y.getTime=function(a){var b=a.getTimezoneOffset(),b=0>b?"+"+Math.abs(b)/60:"-"+b/60;return a.getTime()+36E5*b};y.getUniqueValues=function(a,b,c,d,h){return function(){var b=new g,c={};d?(c.layerDefinition=d,h&&(c.fieldPopupInfo=h),b.resolve(c)):b=N({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(a){c.layerDefinition=a;return c},function(a){console.log("Error: ",a.message)});return b}().then(function(d){return y._getUniqueValues(a,
b,c,d.layerDefinition).then(function(a){return y._getValues(d.layerDefinition,d.fieldPopupInfo,b,a)})})};y._getValues=function(a,b,c,d){var h=[],h=y.getFieldInfoByFieldName(a.fields,c),n=null,g=y.isNumberField(h.type),u="esriFieldTypeDate"===h.type?!0:!1;if(h){if(g)d=f.map(d,function(a){a=parseFloat(a);isNaN(a)&&(a=null);return a});else if(u)return h=f.map(d,t.hitch(this,function(a){var c=a,d=a;y.isValidDate(a)&&(c=y.getDateTimeStrByFieldInfo(a,b),d=y.localizeDateByFieldInfo(a,b));return{value:c,
label:d}}));a=y.getCodedValueListForCodedValueOrSubTypes(a,c);if(null!==a)for(n={},c=0;c<a.length;c++)n[a[c].value]=a[c].label}return h=f.map(d,function(a){var c=null,c=null===a||void 0===a?"\x3cNull\x3e":n&&n.hasOwnProperty(a)?n[a]:g?b?y.localizeNumberByFieldInfo(a,b):y.localizeNumber(a):u?y.localizeDateByFieldInfo(new Date(a),b):a;return{value:a,label:c}})};y._getUniqueValues=function(a,b,c,d){var h=new g;a=a.replace(/\/*$/g,"");c||(c="1\x3d1");var h=/\/ImageServer$/gi.test(a),n=-1<a.indexOf("MapServer/dynamicLayer");
h||n?h=y._getUniqueValuesByQueryTask(a,b,c):(h=y.getFieldInfoByFieldName(d.fields,b),h=0<y.getCodedValuesOrTypesCount(h,d)?y._getUniqueValuesByQueryTask(a,b,c):y._getUniqueValuesByGenerateRenderer(a,b,c));return h};y.getCodedValuesOrTypesCount=function(a,b){return a?b.typeIdField&&b.typeIdField.toUpperCase()===a.name.toUpperCase()&&b.types?b.types.length:(a=y._getAllCodedValue(b,a))?a.length:0:0};y._getUniqueValuesByQueryTask=function(a,b,c){var d=new P;d.where=c;d.returnDistinctValues=!0;d.returnGeometry=
!1;d.outFields=[b];return(new Q(a)).execute(d).then(function(a){var c=[];a.features&&0<a.features.length&&f.forEach(a.features,function(a){a&&a.attributes&&c.push(a.attributes[b])});return c})};y._getUniqueValuesByGenerateRenderer=function(a,b,d){var h=new g,n=a.split("?");a=1<n.length?n[0].replace(/\/*$/g,"")+"/generateRenderer?"+n[1]:a.replace(/\/*$/g,"")+"/generateRenderer";b=c.stringify({type:"uniqueValueDef",uniqueValueFields:[b]});N({url:a,content:{classificationDef:b,f:"json",where:d},handleAs:"json",
callbackParamName:"callback"}).then(t.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=f.map(a,t.hitch(this,function(a){return a.value})));h.resolve(b)}),t.hitch(this,function(a){h.reject(a)}));return h};y.isCodedValuesSupportFilter=function(a,b){a=a.currentVersion?a:a.toJson().layerDefinition;var c=parseFloat(a.currentVersion);return b<=parseFloat(a.maxRecordCount)&&10.1<c};y.combineRadioCheckBoxWithLabel=function(a,b){var c=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var d=
a.getAttribute("type")||"",d=d.toLowerCase();if("radio"===d||"checkbox"===d)c=!0}d=!1;b&&1===b.nodeType&&"label"===b.tagName.toLowerCase()&&(d=!0);c&&d&&(c=a.getAttribute("id"),c||(c="input_"+y.getRandomString(),a.setAttribute("id",c)),b.setAttribute("for",c),k.setStyle(b,"cursor","pointer"))};y.groupRadios=function(a,b){var c=[],h="radiogroup_"+y.getRandomString();f.forEach(a,function(a){a.name=h;b&&(a=d(a,"change",b),c.push(a))});return c};y.convertExtentToPolygon=function(a){var b=a.xmin,c=a.xmax,
d=a.ymin,h=a.ymax;return new D({rings:[[[b,h],[c,h],[c,d],[b,d],[b,h]]],spatialReference:a.toJson()})};y.combineGeometries=function(a){function b(a){var b={points:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"point"===a.type?b.points=b.points.concat([[a.x,a.y]]):"multipoint"===a.type&&(b.points=b.points.concat(a.points))});return new B(b)}function c(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});
return new F(b)}function d(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=y.convertExtentToPolygon(a),b.rings=b.rings.concat(a.rings))});return new D(b)}var h=null;if(a&&0<a.length)if(1===a.length)h=a[0];else{for(var n=null,g=null,u=null,v=null,l=0;l<a.length;l++){n=a[l];switch(n.type){case "point":case "multipoint":v="point";break;case "polyline":v="polyline";break;case "polygon":case "extent":v=
"polygon";break;default:return null}if(0===l)u=v;else if(u!==v)return null;if(l!==a.length-1&&(g=a[l+1],!n.spatialReference.equals(g.spatialReference)))return null}"point"===v?h=b(a):"polyline"===v?h=c(a):"polygon"===v&&(h=d(a))}return h};y.combineGeometriesByGraphics=function(a){var b=null;a&&0<a.length&&(a=f.map(a,function(a){return a.geometry}),b=y.combineGeometries(a));return b};y.isFeaturelayerUrlSupportQuery=function(a,b){var c=!1,d=/\/featureserver\//gi.test(a);a=/\/mapserver\//gi.test(a);
b=(b||"").toLowerCase();d?c=0<=b.indexOf("query"):a&&(c=0<=b.indexOf("data"));return c};y.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};y.isStringEndWith=function(a,b){return a.lastIndexOf(b)+b.length===a.length};y.localizeNumber=function(a,c){var d=(a.toString().split(".")[1]||"").length,h="",h=c&&isFinite(c.places)&&c.places,h=0<h||0<d?"#,###,###,##0.0"+Array.prototype.join.call({length:0<h?h+1:d},"0"):"#,###,###,##0",d={locale:e.locale,pattern:h};t.mixin(d,
c||{});try{return b.format(a,d)}catch(ka){return console.error(ka),a.toLocaleString()}};y.parseNumber=function(a,c){var d={locale:e.locale};t.mixin(d,c||{});try{return b.parse(a,d)}catch(ha){return console.error(ha),a}};y.localizeDate=function(a,b){var c={locale:e.locale,fullYear:!0};t.mixin(c,b||{});"ar"===e.locale&&"long"!==c.formatLength&&"full"!==c.formatLength&&(c.formatLength="long");try{return h.format(a,c)}catch(ha){return console.error(ha),"date"===c.selector?a.toLocaleDateString():"time"===
c.selector?a.toLocaleTimeString():a.toLocaleString()}};y.localizeNumberByFieldInfo=function(b,c){var d=null,d=t.exists("format.places",c)&&c.format.places,d=y.localizeNumber(b,{places:d});return t.exists("format.digitSeparator",c)&&!c.format.digitSeparator?d.toString().replace(new RegExp("\\"+a.group,"g"),""):d};y.localizeDateByFieldInfo=function(a,b){var c=null;try{var d={date:a instanceof Date?a.getTime():a},h=t.exists("format.dateFormat",b)?b.format.dateFormat:"longMonthDayYear",c=v.substitute(d,
"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+E.prototype._dateFormats[h]}})}catch(ia){console.error(ia),c=a}return c};y.getDatePatternsByFormat=function(a){return E.prototype._dateFormatsJson[a]};y.localizeDateTimeByFieldInfo=function(a,b,c,d){var h={h:"h",m:"h:mm",s:"h:mm:ss"},n={h:"H",m:"H:mm",s:"H:mm:ss"},g=function(a,b,c){a=y.getDatePatternsByFormat(a).datePattern;var d=h[b],d=c||"h"===b?h[b]+" a":n[b];return"(datePattern: '"+a+"', timePattern: '"+d+"', selector: 'date and time')"},
u,l,p=null;try{var e={date:a instanceof Date?a.getTime():a};if(t.exists("format.dateFormat",b)){var m=b.format.dateFormat;c?l=0<m.indexOf("Time")?g(m,d,0>m.indexOf("24")):g(m,d):u=m.split("ShortTime")[0].split("LongTime")[0]}else c?l=g("longMonthDayYear",d):u="longMonthDayYear";l=l?l:E.prototype._dateFormats[u];p=v.substitute(e,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+l}})}catch(qa){console.error(qa),p=a}return p};y.getDateTimeStr=function(a,b){b=b?b:"YYYY-MM-DD HH:mm:ss";
return x(a).format(b)};y.getDateByDateTimeStr=function(a){return x(a).toDate()};y.getDateByDateTimeStrAndFormat=function(a,b){a=y.getDateByDateTimeStr(a);t.exists("format.dateFormat",b)&&(b=b.format.dateFormat,0<=b.indexOf("ShortTime")?a.setSeconds(0):0>b.indexOf("Time")&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0)));return a};y.getDateTimeStrByFieldInfo=function(a,b){var c="YYYY-MM-DD";t.exists("format.dateFormat",b)&&(b=b.format.dateFormat,0<=b.indexOf("LongTime")?c+=" HH:mm:ss":0<=b.indexOf("ShortTime")&&
(c+=" HH:mm"));return x(a).format(c)};y.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var c=a.indexOf(" ",b);-1===c&&(c=a.length);var d=-1<a.indexOf("\r\n",b)?a.indexOf("\r\n",b):-1<a.indexOf("\n",b)?a.indexOf("\n",b):c,c=d<c?d:c,d=a.substring(b,c);a=a.substring(0,b)+'\x3cA href\x3d"'+d+'" target\x3d"_blank"\x3e'+d+"\x3c/A\x3e"+a.substring(c,a.length)}}return null===a?"":a},getFormattedNumber:function(a,
b){if("number"===typeof a){var c=(a.toString().split(".")[1]||"").length;a=y.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):c,digitSeparator:b&&b.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a,b){if("number"===typeof a||a instanceof Date)a=y.localizeDateByFieldInfo(a,{format:b});return a||""},getCodedValue:function(a,b){if(a&&a.codedValues){for(var c=0,d=a.codedValues.length;c<
d;c++){var h=a.codedValues[c];if(v.isDefined(b)&&t.exists("code",h)&&b.toString()===h.code.toString())return h.name}return b}return b||null},getTypeName:function(a,b){for(var c=b.length,d=0;d<c;d++)if(a===b[d].id)return b[d].name;return a}};y.addRelativePathInCss=ba;y.url={isAbsolute:function(a){return a?a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,b){a=K.urlToObject(a);a.query&&delete a.query[b];b=a.path;for(var c in a.query)b=b===a.path?b+"?"+c+"\x3d"+a.query[c]:
b+"\x26"+c+"\x3d"+a.query[c];return b},addQueryParamToUrl:function(a,b,c){a=K.urlToObject(a);a.query||(a.query={});a.query[b]=c;b=a.path;for(var d in a.query)b=b===a.path?b+"?"+d+"\x3d"+a.query[d]:b+"\x26"+d+"\x3d"+a.query[d];return b},compareUrl:function(a,b){a=this.getUrlPath(a);b=this.getUrlPath(b);a=V.removeProtocol(a.toString().toLowerCase()).replace(/\/+/g,"/");b=V.removeProtocol(b.toString().toLowerCase()).replace(/\/+/g,"/");return a===b},getUrlPath:function(a){return K.urlToObject(a).path}};
y.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};y.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};y.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=K.urlToObject(a.href);a.query&&a.query.apiurl&&(b=y.url.addQueryParamToUrl(b,
"apiurl",a.query.apiurl));return b};y.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};y.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};y.isLightColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?!0:!1};y.mixinAppConfigPosition=
function(a,b){var c=t.clone(a);if(!b)return c;b=t.clone(b);var d=c.widgetOnScreen,h=b.widgetOnScreen;h&&h.widgets&&("[object Object]"===Object.prototype.toString.call(h.widgets)?f.forEach(d.widgets,function(a,b){b=a.uri?a.uri:"ph_"+b;h.widgets[b]&&h.widgets[b].position&&(h.widgets[b].position.relativeTo||(h.widgets[b].position.relativeTo="map"),a.position=h.widgets[b].position)},this):f.forEach(h.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");d.widgets[b]&&
a.position&&(d.widgets[b].position=a.position)}));h&&h.groups&&("[object Object]"===Object.prototype.toString.call(h.groups)?f.forEach(d.groups,function(a,b){b=a.label?a.label:"g_"+b;h.groups[b]&&h.groups[b].panel&&h.groups[b].panel.position&&(h.groups[b].panel.position.relativeTo||(h.groups[b].panel.position.relativeTo="map"),a.panel.position=h.groups[b].panel.position)},this):(a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===
a?f.forEach(h.groups,function(a,b){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");d.groups[b]&&a.panel&&a.panel.position&&(d.groups[b].panel.position=a.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===a&&(d.groups=X(d.groups,h.groups.map(function(a){return a.id})))));b.map&&b.map.position&&(c.map?c.map.position=b.map.position:c.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&
(b.widgetPool.panel.position.relativeTo="map"),c.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(c.mobileLayout=b.mobileLayout);return c};y.handleGridLayoutOnScreenGroupChange=X;y.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,b,c){var d=-1;b=a.search(new RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(c),d=b+a+c.length);return{firstPos:b,lastPos:d}},setConfigValue:function(a,b,c){U(a,b,c)},getConfigValue:function(a,
b){return U(a,b)},setConfigValueWithId:function(a,b,c){ca(a,b,c)},getConfigValueWithId:function(a,b){return ca(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var b=y.template.getSearchRange(a,y.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,
b.lastPos-1)}return a},getGroupIdByKey:function(a){var b=y.template.getSearchRange(a,y.template.groupIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=[],c=y.template.widgetIdentification+"_config",d;f.forEach(a.configurationSettings,function(a){f.forEach(a.fields,function(a){a.fieldName&&(d=y.template.getSearchRange(a.fieldName,c,"]"),0<=d.firstPos&&
(a=y.template.getWidgetIdByKey(a.fieldName),-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,b,c){function d(a){var b=[];f.forEach(a,function(a){a&&b.push(a)},this);return b}var h=a.widgetOnScreen,n=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);c&&(a.map.mapOptions&&y.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=n,b.values.app_title||(b.values.app_title=c.title),b.values.app_subtitle||(b.values.app_subtitle=c.snippet));for(var g in b.values)"webmap"!==
g&&y.template.setConfigValueWithId(a,g,b.values[g]);a.widgetPool.widgets=d(a.widgetPool.widgets);h.widgets=d(h.widgets);if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=d(a.widgetPool.groups[b].widgets);if(h.groups)for(b=0;b<h.groups.length;b++)h.groups[b].widgets=d(h.groups[b].widgets);return a}};y.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,
delete a.minZoom)};y.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},function(a){return a})};y.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};y.encodeHTML=function(a){return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};y.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};y.getBestDisplayAttributes=function(a,b){var c=
{},d=null,h;for(h in a)d=y.getBestDisplayValue(h,a,b),c[h]=d;return c};y.getBestDisplayValue=function(a,b,c){var d="",h=null;t.isArrayLike(c)?h=y.getFieldInfoByFieldName(c,a):"object"===typeof c&&c.name===a&&(h=c);h&&(d=b[a],"esriFieldTypeDate"===h.type?d&&(a=new Date(parseInt(d,10)),d=y._tryLocaleDate(a)):"number"===typeof d&&(h.domain&&"codedValue"===h.domain.type?f.some(h.domain.codedValues,function(a){if(a.code===d)return d=a.name,!0}):d=y._tryLocaleNumber(d)));if(null===d||void 0===d)d="";return d};
y._getCodedValues=function(a){var b=null;(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length&&(b=a.codedValues,b=f.map(b,t.hitch(this,function(a){return{value:a.code,label:a.name}})));return b};y._getSubTypes=function(a){var b=null;a.subtypeField&&a.subtypes&&0<a.subtypes.length&&(b=f.map(a.subtypes,t.hitch(this,function(a){return{value:a.id,label:a.name}})));return b};y._getRenderTypes=function(a){var b=null;a.typeIdField&&a.types&&0<a.types.length&&(b=f.map(a.types,t.hitch(this,
function(a){return{value:a.id,label:a.name}})));return b};y._getCodedValueOrSubtypes=function(a,b,c){var d=y.getFieldInfoByFieldName(a.fields,b);return void 0!==c&&null!==c?y._getCodedValueBySubTypeId(a,b,c,d):y._getAllCodedValue(a,d)};y._getDisplayValueForCodedValueOrSubtype=function(a,b,c,d){var h={isCodedValueOrSubtype:!1,displayValue:c+""};(a=y._getCodedValueOrSubtypes(a,b,d))&&0<a.length&&f.some(a,t.hitch(this,function(a){return a.value===c?(h={isCodedValueOrSubtype:!0,displayValue:a.label},
!0):!1}));return h};y._deleteSubtypePropertiesTemp=function(a){delete a.subtypeField;delete a.subtypes};y.getDisplayValueForCodedValueOrSubtype=function(a,b,c){y._deleteSubtypePropertiesTemp(a);var d=c[b],h,n=a.typeIdField;c.hasOwnProperty(n)&&(h=c[n]);(n=a.subtypeField)&&a.subtypes&&0<a.subtypes.length&&c.hasOwnProperty(n)&&(h=c[n]);d=y._getDisplayValueForCodedValueOrSubtype(a,b,d,h);a.typeIdField===b&&(d.displayValue=y._updateCodedValueListFromRender(a,[{value:c[b],label:d.displayValue}])[0].label);
return d};y._getDisplayValueFromCodedValues=function(a,b){var c={isCodedValueOrSubtype:!1,displayValue:a+""};b&&0<b.length&&f.some(b,t.hitch(this,function(b){return b.value===a?(c={isCodedValueOrSubtype:!0,displayValue:b.label},!0):!1}));c.value=a;return c};y.getDisplayValueForCodedValueOrSubtypeBatch=function(a,b,c){y._deleteSubtypePropertiesTemp(a);var d={},h=a.typeIdField,n=a.subtypeField,g=y.getFieldInfoByFieldName(a.fields,b);n&&a.subtypes&&0<a.subtypes.length?(d.subType=y._getSubTypes(a),h=
n,d.all=y._getAllCodedValueNew(a,g)):(d.all=y._getAllCodedValue(a,g),d.subType=y._getRenderTypes(a));if(d.subType&&0<d.subType.length){var n=d.subType,u;for(u in n){var v=n[u].value,l=y._getCodedValueBySubTypeId(a,b,v,g);d[v]=a.typeIdField===b?y._updateCodedValueListFromRender(a,l):l}}a.typeIdField===b&&(d.subType=y._updateCodedValueListFromRender(a,d.subType),d.all=y._updateCodedValueListFromRender(a,d.all));v=[];u=[];for(var p in c)v=c[p],n=v[b],h===b?v=d.subType:v.hasOwnProperty(h)?(v=v[h],v=d[v],
v||(v=y._getCodedValues(g),a.typeIdField===b&&(v=y._updateCodedValueListFromRender(a,v)))):v=d.all,n=y._getDisplayValueFromCodedValues(n,v),u.push(n);return u};y._getUniquCodedValue=function(a,b,c){a[b]?c!==a[b]&&(a[b]=a[b]+", "+c):a[b]=c;return a};y._getAllCodedValue=function(a,b){var c=b.name,d={},h=null,n=!0;if(a.typeIdField&&a.types&&0<a.types.length)f.map(a.types,t.hitch(this,function(a){a.domains&&a.domains[c]&&(a=a.domains[c],"inherited"===a.type?n&&(n=!1,a=y._getCodedValues(b),f.map(a,t.hitch(this,
function(a){d=y._getUniquCodedValue(d,a.value,a.label)}))):a.codedValues&&0<a.codedValues.length&&f.map(a.codedValues,t.hitch(this,function(a){d=y._getUniquCodedValue(d,a.code,a.name)})))})),h||(h=y._getCodedValues(b));else return this._getCodedValues(b);a=[];var g=y.isNumberField(b.type),u;for(u in d){var v=g?parseFloat(u):u;a.push({value:v,label:d[u]})}0<a.length&&(h=a);return h};y._getAllCodedValueNew=function(a,b){var c=b.name,d={},h=null,n=!0;if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)f.map(a.subtypes,
t.hitch(this,function(a){a.domains&&a.domains[c]&&(a=a.domains[c],"inherited"===a.type?n&&(n=!1,a=y._getCodedValues(b),f.map(a,t.hitch(this,function(a){d=y._getUniquCodedValue(d,a.value,a.label)}))):a.codedValues&&0<a.codedValues.length&&f.map(a.codedValues,t.hitch(this,function(a){d=y._getUniquCodedValue(d,a.code,a.name)})))})),h||(h=y._getCodedValues(b));else return this._getCodedValues(b);a=[];var g=y.isNumberField(b.type),u;for(u in d){var v=g?parseFloat(u):u;a.push({value:v,label:d[u]})}0<a.length&&
(h=a);return h};y._getCodedValueBySubTypeId=function(a,b,c,d){var h="typeIdField",n="types";a.subtypeField&&a.subtypes&&0<a.subtypes.length&&(h="subtypeField",n="subtypes");var g=null;d=d?d:y.getFieldInfoByFieldName(a.fields,b);a[h]&&a[n]&&0<a[n].length?(f.map(a[n],t.hitch(this,function(n){if(n.id===c){if(b===a[h])return g=[{value:n.id,label:n.name}],!0;n.domains&&n.domains[b]?(n=n.domains[b],"inherited"===n.type?g=y._getCodedValues(d):n.codedValues&&0<n.codedValues.length&&(g=f.map(n.codedValues,
t.hitch(this,function(a){return{value:a.code,label:a.name}})))):n.domains&&(g=y._getCodedValues(d))}})),g||(g=y._getCodedValues(d))):g=y._getCodedValues(d);return g};y.getCodedValueListForCodedValueOrSubTypes=function(a,b,c){y._deleteSubtypePropertiesTemp(a);var d=null,d=y.getFieldInfoByFieldName(a.fields,b),h,n;c&&(h=c[a.typeIdField],n=c[a.subtypeField]);if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)return b===a.subtypeField?(d=y._getSubTypes(a),void 0!==n&&(c=y._getDisplayValueFromCodedValues(n,
d),d=[{value:c.value,label:c.displayValue}])):d=void 0===n?y._getAllCodedValueNew(a,d):y._getCodedValueBySubTypeId(a,b,n,d),b===a.typeIdField&&(d=y._updateCodedValueListFromRender(a,d)),d;a.subtypeField="";a.subtypes=[];a.typeIdField&&a.typeIdField.toUpperCase()===b.toUpperCase()?(d=y._getRenderTypes(a),c&&void 0!==h&&null!==h&&(c=y._getDisplayValueFromCodedValues(h,d),d=[{value:c.value,label:c.displayValue}])):d=c&&void 0!==h&&null!==h?y._getCodedValueBySubTypeId(a,b,h,d):y._getAllCodedValue(a,d);
b===a.typeIdField&&(d=y._updateCodedValueListFromRender(a,d));return d};y._verifyIfFieldIsSubtypeField=function(a,b){var c={isSubtypeField:!1,subtypeField:""};if(a.subtypeField)return c={isSubtypeField:a.subtypeField===b.name,subtypeField:a.subtypeField};["esriFieldTypeSmallInteger","esriFieldTypeInteger"].indexOf(b.type)&&a.typeIdField===b.name&&a.types&&0<a.types.length&&(void 0===a.types[0].domains[b.name]?c={isSubtypeField:!0,subtypeField:b.name}:c.isSubtypeField=!1);return!1};y._getRendererFromLayerDef=
function(a){var b=null;a.drawingInfo&&a.drawingInfo.renderer&&"uniqueValue"===a.drawingInfo.renderer.type&&(b=a.drawingInfo.renderer);return b};y._getRenderValueLabelsForUnique=function(a){var b=null,c=null,d=y._getRendererFromLayerDef(a);d?(b={},c=d.uniqueValueInfos):a.renderer&&(d=a.toJson().layerDefinition,d=y._getRendererFromLayerDef(d),a=a.renderer.toJson(),"uniqueValue"===a.type&&d&&d.field1===a.field1?(b={},c=a.uniqueValueInfos):d&&(b={},c=d.uniqueValueInfos));if(c)for(a=0;a<c.length;a++)d=
c[a],b[d.value]=d.label;return b};y._updateCodedValueListFromRender=function(a,b){if((a=y._getRenderValueLabelsForUnique(a))&&b)for(var c=0;c<b.length;c++){var d=b[c];a[d.value]&&(d.label=a[d.value])}return b};y.getDefaultPortalFieldInfo=function(a){var b=a.name,b={fieldName:b,label:a.alias||b,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":b.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":b.format=
{places:2,digitSeparator:!0};break;case "esriFieldTypeDate":b.format={dateFormat:"longMonthDayYear"}}return b};y.getDefaultPopupInfo=function(a,b,c){var d=null;a&&a.fields&&(d={title:b,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},f.forEach(a.fields,function(a){var b=!1;c?f.some(c,t.hitch(this,function(b){return b&&a.name.toLowerCase()===b.toLowerCase()}))&&(b=!0):b=!0;b&&(b=this.getDefaultPortalFieldInfo(a),b.visible=!0,b.isEditable=a.editable,d.fieldInfos.push(b))},this));return d};
y._tryLocaleNumber=function(a){var b=y.localizeNumber(a);if(null===b||void 0===b)b=a;return b};y._tryLocaleDate=function(a){var b=y.localizeDate(a);b||(b=a.toLocaleDateString());return b};y.getFieldInfoByFieldName=function(a,b){var c=null;a&&0<a.length&&f.some(a,t.hitch(this,function(a){return a.name===b?(c=a,!0):!1}));return c};y.getDateFieldFormatByFieldName=function(a,b){if(a&&0<a.length)for(var c=0;c<a.length;c++){var d=a[c];if(d.fieldName===b){if(d.format&&d.format.dateFormat)return d.format.dateFormat;
break}}return""};y.completePopupFieldFromLayerField=function(a,b){if(!b)return a;for(var c in a){var d=a[c].name,h=!1,n;for(n in b)if(b[n].fieldName===d){h=!0;break}h||(d=y.getPopupFieldFromLayerField(a[c]),b.push(d))}return b};y.getPopupFieldFromLayerField=function(a){return{fieldName:a.name,isEditable:a.editable,label:a.alias,visible:a.visible?a.visible:!1,stringFieldOption:"esriFieldTypeString"===a.type?"textbox":null,tooltips:"",domain:a.domain?a.domain:null}};y.containsNonLatinCharacter=function(a){for(var b=
0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1};y.has=function(a){var b=q(a);if(b)return b;if("ie"===a.toLowerCase()){a=0;var c=/MSIE (\d+\.\d+);/.test(navigator.userAgent),d=!!navigator.userAgent.match(/Trident\/7.0/),h=navigator.userAgent.indexOf("rv:11.0");c&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);d&&-1!==h&&(a=11);return 11===a&&11||b}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||b};y.detectUserAgent=function(){return window.userAgent};
y.isMobileUa=function(){return window.isMobileUa};y.inMobileSize=function(){var a=k.getMarginBox(document.body);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return k.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;k.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};y.getObjectIdField=function(a){if(a.objectIdField)return a.objectIdField;a=a.fields;for(var b=0;b<a.length;b++){var c=a[b];if("esriFieldTypeOID"===c.type)return c.name}return null};
y.isNeedHttpsButNot=function(){var a=navigator.geolocation,b=window.hasOwnProperty("isSecureContext");return(b&&window.isSecureContext||!b&&"https:"===window.location.protocol)&&a?!1:!0};y.toFeatureSet=function(a){var b=new L;"[object Object]"===Object.prototype.toString.call(a)&&(a=[a]);b.features=a;if(0<a.length){var c;f.some(a,function(a){if(a.geometry)return c=a,!0});if(c){a=c.getLayer();var d={};a&&(b.displayFieldName=a.displayField,f.forEach(a.fields,t.hitch(this,function(a){var b=a.name;d[b]=
a.alias||b})),b.fieldAliases=d);b.geometryType=c.geometry.type;b.spatialReference=c.geometry.spatialReference}}return b};y.showValidationErrorTipForFormDijit=function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),setTimeout(t.hitch(this,function(){a.focusNode.blur()}),100))}catch(fa){console.error(fa)}};y.getFeatureLayerDefinition=function(a){var b=null,c=a.graphics;a.graphics=[];var d=a.toJson();a.graphics=c;d&&(b=d.layerDefinition);return b};y.simulateClickEvent=function(a){if(q("safari")){var b=
document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}else a.click()};y.getFeatureSetByLayerAndFeatures=function(a,b){var c=new L;c.fields=t.clone(a.fields);c.features=b;c.geometryType=a.geometryType;c.fieldAliases={};f.forEach(c.fields,t.hitch(this,function(a){var b=a.name;c.fieldAliases[b]=a.alias||b}));return c};y.featureAction=function(){return{zoomTo:function(a,b,c){c||(c={});if(a&&b&&0<b.length){var d=f.every(b,function(a){return a&&a.spatialReference&&a.type});if(f.every(b,
function(a){return a&&a.geometry&&a.geometry.spatialReference&&a.geometry.type})||d)d&&(b=f.map(b,function(a){return{geometry:a}})),y.zoomToFeatureSet(a,{features:b},c.extentFactor)}},flash:function(a,b){function c(a,b){f.forEach(h,function(c,d){c.setSymbol(b?a:n[d]||g)})}function d(a){return function(){setTimeout(function(){c(u,!0);h[0]&&b&&b.redraw();setTimeout(function(){c(null,!1);h[0]&&b&&b.redraw();a()},200)},200)}}if(f.every(a||[],function(a){return a&&a.geometry})){var h=a;a=h[0];var n=f.map(h,
function(a){return a.symbol}),g=a.symbol||t.getObject("renderer.symbol",!1,b),u=null;b&&"esriGeometryPoint"===b.geometryType?u=new J(require.toUrl("jimu")+"/images/flash.gif",20,20):(u=t.clone(g))&&(u.outline?u.outline.setColor("#ffc500"):u.setColor("#ffc500"));a&&g&&u&&b&&("esriGeometryPoint"===b.geometryType?(c(u,!0),b.redraw(),setTimeout(function(){c(null,!1);b.redraw()},2E3)):d(d(d(function(){})))())}},panTo:function(a,b){f.every(b||[],function(a){return a&&a.geometry})&&(0<b.length?b=O.graphicsExtent(b).getCenter():
(b=b[0].geometry,b="polyline"===b.type||"polygon"===b.type?b.getExtent().getCenter():"extent"===b.type?b.getCenter():"multipoint"===b.type?1<b.points.length?b.getExtent().getCenter():b.getPoint(0):b),a.centerAt(b))},showPopup:function(a,b){f.every(b||[],function(a){return a&&a.geometry})&&(a=a.infoWindow,a.setFeatures(b),b=b[0],"point"===b.geometry.type?a.show(b.geometry,{closetFirst:!0}):a.show(b.geometry.getExtent().getCenter(),{closetFirst:!0}))}}}();y.isInConfigOrPreviewWindow=function(){var a=
!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(fa){a=!1}return!!a};y.getAppHref=function(){var a="";return a=y.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};y.getAppIdFromUrl=function(){var a=!0,b=y.getAppHref();if(-1!==b.indexOf("id\x3d")||-1!==b.indexOf("appid\x3d")||-1!==b.indexOf("apps"))a=!1;if(!0===a)return b;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;
if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};y.getEditorContentHeight=function(a,b,c){var d=new g;this._content=a;this._dom=b;this._domParam=c;var h=setTimeout(t.hitch(this,function(){clearTimeout(h);h=null;var a=0,b=this._domParam.contentWidth;try{var c=document.createElement("div");c.setAttribute("id","fakeContent");k.setStyle(c,
"background-size","contain");c.innerHTML=this._content;this._dom.appendChild(c);if(c){var n=m("img",c);n&&n.length&&n.style({maxWidth:b-20+"px"});k.setStyle(c,"position","absolute");k.setStyle(c,"width",b+"px");k.setStyle(c,"left","-99999px");k.setStyle(c,"top","-99999px");k.setStyle(c,"visibility","hidden");var g=k.getContentBox(c);g.h&&(a=g.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(na){console.error("can't getEditorContentHeight"+na),a=200}d.resolve(a)}),1500);return d};
y.getBase64Data=function(a){var b=new g;if(a&&a.startWith("data:image"))b.resolve(a);else try{N({url:a,handleAs:"arraybuffer"}).then(function(a){var c=new FileReader;c.onloadend=function(){b.resolve(c.result)};c.onerror=function(){b.resolve(null)};c.readAsDataURL(new Blob([a],{type:"image/png"}))},function(){b.resolve(null)})}catch(da){console.warn(da),b.resolve(null)}return b};y.getEditorTextColor=function(a,b){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:y.getColorRecordName(a),
forceAttr:b}}};y.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:y.getColorRecordName(a)}}};y.getColorRecordName=function(a){return"wab_cr_"+(a||"")};y.b64toBlob=function(a,b,c){b=b||"";c=c||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var d=[],h=0;h<a.length;h+=c){for(var n=a.slice(h,h+c),g=Array(n.length),u=0;u<n.length;u++)g[u]=n.charCodeAt(u);n=new Uint8Array(g);d.push(n)}return new Blob(d,{type:b})};
y.subtractionArray=function(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c],h=b.length-1;0<=h;h--)if(d===b[h]){a.splice(c,1);b.splice(h,1);break}return a};y.resourcesUrlToBlob=function(a){return N({url:a,handleAs:"blob"})};y.processItemResourceOfAppConfig=function(a,b){function c(a){var b=a.obj,c=a.key,d={obj:b,key:c};"number"===typeof a.i?(d.i=a.i,d.value=b[c][a.i]):d.value=b[c];return d}function d(a){for(var b in a)if("object"===typeof a[b])if(Array.isArray(a[b]))for(var c=a,n=b,g=0;g<c[n].length;g++)"string"===
typeof c[n][g]?h(c,n,g):"object"===typeof c[n][g]&&d(c[n][g]);else d(a[b]);else"string"===typeof a[b]&&h(a,b)}function h(a,d,h){"number"===typeof h?b.test(a[d][h])&&(u=b.func(c({obj:a,key:d,i:h})),"function"===typeof u.then?g.push(u):n.push(u)):b.test(a[d])&&(u=b.func(c({obj:a,key:d})),"function"===typeof u.then?g.push(u):n.push(u))}var n=[],g=[],u;d(a);return 0<g.length?p(g).then(function(b){0<n.length&&(b=b.concat(n));return{appConfig:a,result:b}}):{appConfig:a,result:n}};y.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};
y.uniqueArray=function(a){for(var b=[],c=0;c<a.length;c++)-1===b.indexOf(a[c])&&b.push(a[c]);return b};y.isNotEmptyObject=function(a,b){return b?y.isObject(a)&&0<Object.keys(a).length&&Array.isArray(a):y.isObject(a)&&0<Object.keys(a).length};y.getMinOfArray=function(a){return Number(Math.min.apply(Math,a))};y.getDataSchemaFromLayerDefinition=function(a){var b=a.fields.filter(function(a){return"esriFieldTypeOID"===a.type}),b=0<b.length?b[0]:null;return{geometryType:a.geometryType,fields:a.fields,displayField:a.displayField,
objectIdField:b,typeIdField:a.typeIdField}};y.isValidPointGeometry=function(a){return a&&"point"===a.type&&y.isTrueOrZero(a.x)&&y.isTrueOrZero(a.y)};y.isVaildPointGeometry=y.isValidPointGeometry;y.isNumberOrNumberString=function(a){return/^-?[1-9]\d*$/.test(a)||/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/.test(a)};y.convertNumberToPercentage=function(a,b,c){if(!y.isNumberOrNumberString(a))return a;"undefined"===typeof c&&(c=!0);"undefined"===typeof b&&(b=2);b={format:{places:b,digitSeparator:c}};
var d=e.locale;c="ar"===d||"tr"===d;d="ar"===d||"he"===d;a=Number(a);var h=!1;0>a&&(h=!0,a=Math.abs(a));a=y.localizeNumberByFieldInfo(100*a,b);a=c?"%"+a:a+"%";h&&(a=d?a+"-":"-"+a);return a};y.getClientFeaturesFromMap=function(a,b,c,d){var h=[],n=!1;if(b){c?0<b.getSelectedFeatures().length?(h=b.getSelectedFeatures(),n=!0):h=b.graphics:h=b.graphics;d&&(h=y.filterFeaturesByExtent(a.extent,h));if(h&&0<h.length){var g=y.getObjectIdField(b);g&&(a=h[0])&&a.attributes&&a.attributes.hasOwnProperty(g)&&h.sort(function(a,
b){a.attributes||(a.attributes={});b.attributes||(b.attributes={});a=a.attributes[g];b=b.attributes[g];return a<b?-1:a>b?1:0})}h.isSelectedFeatures=n;return h}};y.filterFeaturesByExtent=function(a,b){var c=a.normalize();return b=f.filter(b,t.hitch(this,function(a){try{if(a.geometry){var b="point"===a.geometry.type||"multipoint"===a.geometry;return f.some(c,t.hitch(this,function(c){return b?c.contains(a.geometry):w.intersects(c,a.geometry)}))}}catch(ia){console.error(ia)}return!1}))};y.upperCaseString=
function(a){return a&&"string"===typeof a?a.toUpperCase():a};y.lowerCaseString=function(a){return a&&"string"===typeof a?a.toLowerCase():a};y.getSubstituteString=function(a,b){return v.substitute({value:a},b)};y.getUUID=function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return a()+a()+"_"+a()+"_"+a()+"_"+a()+"_"+a()+a()+a()};y.checkEssentialAppsLicense=function(a,b,c){var d=V.getStandardPortalUrl(window.portalUrl),h=V.getSharingUrl(d),d=new I({appId:"arcgisWebApps",
portalUrl:d});R.registerOAuthInfos([d]);return c?R.checkAppAccess(h,"arcgisWebApps"):b.getItemById(a).then(function(a){if("public"!==a.access)return R.checkAppAccess(h,"arcgisWebApps")})};y.getStyleColorInTheme=function(a){var b=new g,c,d;window&&window.isBuilder?(d="./stemapp/themes/",c=window.appConfig):(d="./themes/",c=window.getAppConfig());if(c&&c.theme.customStyles&&c.theme.customStyles.mainBackgroundColor)return b.resolve(c.theme.customStyles.mainBackgroundColor),b.promise;var h=c.theme.name,
n=c.theme.styles[0];a&&(n=a);N({url:d+h+"/manifest.json",handleAs:"json"}).then(t.hitch(this,function(a){if(a&&a.styles){a=a.styles;for(var c=0;c<a.length;c++){var d=a[c];d.name===n&&b.resolve(d.styleColor)}}}),t.hitch(this,function(a){console.error(a);b.reject(null)}));return b.promise};return y})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(t,f,k){var q=t.NodeList;f.extend(q,{_buildArrayFromCallback:function(e){for(var f=[],m=0;m<this.length;m++){var l=
e.call(this[m],this[m],f);l&&(f=f.concat(l))}return f},_getUniqueAsNodeList:function(e){for(var f=[],m=0,l;l=e[m];m++)1==l.nodeType&&-1==k.indexOf(f,l)&&f.push(l);return this._wrap(f,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(e,f){e=this._getUniqueAsNodeList(e);e=f?t._filterResult(e,f):e;return e._stash(this)},_getRelatedUniqueNodes:function(e,f){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(f),e)},children:function(e){return this._getRelatedUniqueNodes(e,
function(e,m){return f._toArray(e.childNodes)})},closest:function(e,f){return this._getRelatedUniqueNodes(null,function(m,l){do if(t._filterResult([m],e,f).length)return m;while(m!=f&&(m=m.parentNode)&&1==m.nodeType);return null})},parent:function(e){return this._getRelatedUniqueNodes(e,function(e,m){return e.parentNode})},parents:function(e){return this._getRelatedUniqueNodes(e,function(e,m){for(m=[];e.parentNode;)e=e.parentNode,m.push(e);return m})},siblings:function(e){return this._getRelatedUniqueNodes(e,
function(e,m){m=[];for(var l=e.parentNode&&e.parentNode.childNodes,g=0;g<l.length;g++)l[g]!=e&&m.push(l[g]);return m})},next:function(e){return this._getRelatedUniqueNodes(e,function(e,m){for(e=e.nextSibling;e&&1!=e.nodeType;)e=e.nextSibling;return e})},nextAll:function(e){return this._getRelatedUniqueNodes(e,function(e,m){for(m=[];e=e.nextSibling;)1==e.nodeType&&m.push(e);return m})},prev:function(e){return this._getRelatedUniqueNodes(e,function(e,m){for(e=e.previousSibling;e&&1!=e.nodeType;)e=e.previousSibling;
return e})},prevAll:function(e){return this._getRelatedUniqueNodes(e,function(e,m){for(m=[];e=e.previousSibling;)1==e.nodeType&&m.push(e);return m})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(e,f){return 0!=f%2})},odd:function(){return this.filter(function(e,f){return 0==f%2})}});return q})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(t){t=t.getObject("dojox.encoding.base64",!0);t.encode=function(f){for(var k=[],q=f.length,e=q%3,q=q-e,r=0;r<q;){var m=f[r++]<<16|f[r++]<<8|f[r++];k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>18&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>12&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>6&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m&
63))}switch(e){case 2:m=f[r++]<<16|f[r++]<<8;k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>18&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>12&63));k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>6&63));k.push("\x3d");break;case 1:m=f[r++]<<16,k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>18&63)),k.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>>
12&63)),k.push("\x3d"),k.push("\x3d")}return k.join("")};t.decode=function(f){f=f.split("");for(var k=[],q=f.length;"\x3d"==f[--q];);for(var e=0;e<q;){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<18;e<=q&&(r|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<12);e<=q&&(r|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<6);e<=q&&(r|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++]));
k.push(r>>>16&255);k.push(r>>>8&255);k.push(r&255)}for(;0==k[k.length-1];)k.pop();return k};return t})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(t,f,k,q,e,r,m,l){t=t(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var g=k.map(this.geometries,function(d){return d.toJson()}),
e={};e.outSR=this.outSR.wkid||q.toJson(this.outSR.toJson());e.inSR=this.geometries[0].spatialReference.wkid||q.toJson(this.geometries[0].spatialReference.toJson());e.geometries=q.toJson({geometryType:l.getJsonType(this.geometries[0]),geometries:g});this.transformation&&(e.transformation=this.transformation.wkid||q.toJson(this.transformation));m.isDefined(this.transformForward)&&(e.transformForward=this.transformForward);return e}});e("extend-esri")&&f.setObject("tasks.ProjectParameters",t,r);return t})},
"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(t,f){var k=t.clone(f);k.declaredClass="jimu.portalUrlUtils";k.getPortalUrlFromLocation=function(){return k.getPortalServerFromLocation()+k.getDeployContextFromLocation()};k.getPortalSignInUrlFromLocation=function(){var f=k.getPortalUrlFromLocation();return k.setHttpsProtocol(f+"home/signin.html")};k.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};
k.getDeployContextFromLocation=function(){var f=window.location.href.split("?")[0],e=f.indexOf("/home/");0>e&&(e=f.indexOf("/apps/"));f=f.substring(f.indexOf(window.location.host)+window.location.host.length+1,e);"/"!==f&&(f="/"+f+"/");return f};k.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+k.getDeployContextFromLocation()+"sharing/rest/"};return k})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var t={declaredClass:"jimu.shared.basePortalUrlUtils"};
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(f){return this.substr(0,f.length)===f});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(f){return this.substr(this.length-f.length,f.length)===f});t.getServerByUrl=function(f){f=(f||"").trim();f=f.replace(/^(http(s?):?)\/\//gi,"");0===f.indexOf("//")&&
(f=f.slice(2));return f.split("/")[0]};t.getServerWithProtocol=function(f){var k="";if(f=(f||"").trim()){var q=t.getServerByUrl(f);if(!q)return k;var e=t.getProtocol(f);e?k=e+"://"+q:0===f.indexOf("//")&&(k="//"+q)}return k};t.isSameServer=function(f,k){f=t.getServerByUrl(f)||"";k=t.getServerByUrl(k)||"";return f.toLowerCase()===k.toLowerCase()};t.getDomain=function(f){var k="";if(f=t.getServerByUrl(f))f=f.replace(/:\d+$/,""),f=f.match(/[^.]\w+\.\w+$/),null!==f&&(k=f[0],/^\d+\.\d+$/.test(k)&&(k=""));
return k};t.isSameDomain=function(f,k){f=t.getDomain(f);k=t.getDomain(k);return""!==f&&f===k};t.isOrgOnline=function(f){return 0<=t.getServerByUrl(f).toLowerCase().indexOf(".maps.arcgis.com")};t.isOnline=function(f){return 0<=t.getServerByUrl(f).toLowerCase().indexOf(".arcgis.com")};t.isArcGIScom=function(f){f=t.getServerByUrl(f).toLowerCase();return"www.arcgis.com"===f||"arcgis.com"===f};t.getStandardPortalUrl=function(f){var k=t.getServerByUrl(f);if(""===k)return"";t.isOnline(k)?(t.isArcGIScom(k)&&
(k="www.arcgis.com"),f=t.addProtocol(f),f=t.getProtocol(f)+"://"+k):(f=(f||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),f=t.addProtocol(f),f.replace(new RegExp("http(s?)://"+k,"g"),"")||(f+="/arcgis"));return f};t.isSamePortalUrl=function(f,k){var q=/^http(s?):\/\//gi,e=/^\/\//gi;f=t.getStandardPortalUrl(f).toLowerCase().replace(q,"").replace(e,"");k=t.getStandardPortalUrl(k).toLowerCase().replace(q,"").replace(e,"");return f===k};t.addProtocol=function(f){if(-1>=f.toLowerCase().indexOf("http://")&&
-1>=f.toLowerCase().indexOf("https://")){var k="";"undefined"!==typeof window&&window.location?(k=window.location.protocol,f=f.startWith("//")?k+f:f.startWith("/")?k+"//"+window.location.host+f:k+"//"+f):(k="http:",f=f.startWith("//")?k+f:k+"//"+f)}return f};t.getProtocol=function(f){var k="";f=f.toLowerCase();0===f.indexOf("https://")?k="https":0===f.indexOf("http://")&&(k="http");return k};t.updateUrlProtocolByOtherUrl=function(f,k){k=k.toLowerCase();0===k.indexOf("https://")?f=t.setHttpsProtocol(f):
0===k.indexOf("http://")&&(f=t.setHttpProtocol(f));return f};t.removeProtocol=function(f){return f.replace(/^http(s?):\/\//i,"//")};t.setHttpProtocol=function(f){f=t.addProtocol(f);return f.replace(/^https:\/\//,"http://")};t.setHttpsProtocol=function(f){f=t.addProtocol(f);return f.replace(/^http:\/\//,"https://")};t.setProtocol=function(f,k){return 0<=k.indexOf("https")?t.setHttpsProtocol(f):0<=k.indexOf("http")?t.setHttpProtocol(f):f};t.getSharingUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&
(k=f+"/sharing/rest");return k};t.getOAuth2Url=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/oauth2");return k};t.getAppIdUrl=function(f,k){var q="";(f=t.getStandardPortalUrl(f))&&(q=f+"/sharing/rest/oauth2/apps/"+k);return q};t.getSignInUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/home/signin.html");return k};t.getBaseSearchUrl=function(f){var k="";f=t.getStandardPortalUrl(f);(f=f.replace(/\/*$/g,""))&&(k=f+"/sharing/rest/search");return k};t.getBaseItemUrl=
function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/content/items");return k};t.getItemUrl=function(f,k){var q="";(f=t.getBaseItemUrl(f))&&k&&(q=f+"/"+k);return q};t.getItemDataUrl=function(f,k){var q="";(f=t.getItemUrl(f,k))&&(q=f+"/data");return q};t.getItemGroupsUrl=function(f,k){var q="";(f=t.getItemUrl(f,k))&&(q=f+"/groups");return q};t.getGenerateTokenUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/sharing/generateToken");return k};t.getItemDetailsPageUrl=
function(f,k){var q="";f&&k&&(f=t.getStandardPortalUrl(f),q=f+"/home/item.html?id\x3d"+k);return q};t.getUserProfilePageUrl=function(f,k){var q="";f&&k&&(f=t.getStandardPortalUrl(f),q=f+"/home/user.html?user\x3d"+k);return q};t.getBaseGroupUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/community/groups");return k};t.getPortalSelfInfoUrl=function(f){var k="";(f=t.getStandardPortalUrl(f||""))&&(k=f+"/sharing/rest/portals/self");return k};t.getPortalHelpMapUrl=function(f){var k=
"";(f=t.getStandardPortalUrl(f||""))&&(k=f+"/sharing/rest/portals/helpmap");return k};t.getCommunitySelfUrl=function(f){var k="";(f=t.getStandardPortalUrl(f||""))&&(k=f+"/sharing/rest/community/self");return k};t.getBaseUserUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/sharing/rest/community/users");return k};t.getUserUrl=function(f,k){var q="",e=t.getBaseUserUrl(f);f&&k&&(q=e+"/"+k);return q};t.getUserTagsUrl=function(f,k){var q="",e=t.getUserUrl(f,k);f&&k&&(q=e+"/tags");return q};
t.getUserThumbnailUrl=function(f,k,q){var e="";(f=t.getUserUrl(f,k))&&q&&(e=f+"/info/"+q);return e};t.getContentUrl=function(f){var k="";f&&(f=t.getStandardPortalUrl(f),k=f+"/sharing/rest/content");return k};t.getUserContentUrl=function(f,k,q){var e="",e="";f&&k&&(e=t.getContentUrl(f),e=q?e+"/users/"+k+"/"+q:e+"/users/"+k);return e};t.getUserContentItemUrl=function(f,k,q){var e="",e="";f&&k&&q&&(e=t.getUserContentUrl(f,k),e=e+"/items/"+q);return e};t.getItemResourceUrl=function(f,k,q){var e="",e=
"";f&&k&&(e=t.getContentUrl(f),e=q?e+"/items/"+k+"/resources/"+q:e+"/items/"+k+"/resources");return e};t.getAddItemUrl=function(f,k,q){var e="",e="";f&&k&&(e=t.getUserContentUrl(f,k,q),e+="/addItem");return e};t.getDeleteItemUrl=function(f,k,q){var e="";(f=t.getUserItemsUrl(f,k))&&(e=f+"/"+q+"/delete");return e};t.getUserItemsUrl=function(f,k,q){var e="",e="";f&&k&&(e=t.getUserContentUrl(f,k,q),e+="/items");return e};t.getUpdateItemUrl=function(f,k,q,e){var r="",r="";f&&k&&(r=t.getUserItemsUrl(f,
k,e),r=r+"/"+q+"/update");return r};t.shareItemUrl=function(f,k,q,e){var r="",r="";f&&k&&(r=t.getUserItemsUrl(f,k,e),r=r+"/"+q+"/share");return r};t.getHomeIndexUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/home/index.html");return k};t.getHomeMapViewerUrl=function(f,k){var q="";if(f=t.getStandardPortalUrl(f))q=f+"/home/webmap/viewer.html",q=k?q+("?webmap\x3d"+k):q+"?useExisting\x3d1";return q};t.getHomeSceneViewerUrl=function(f,k){var q="";if(f=t.getStandardPortalUrl(f))q=f+"/home/webscene/viewer.html",
k&&(q+="?webscene\x3d"+k);return q};t.getHomeGalleryUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/home/gallery.html");return k};t.getHomeGroupsUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/home/groups.html");return k};t.getHomeMyContentUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/home/content.html");return k};t.getHomeMyOrganizationUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/home/organization.html");return k};t.getHomeUserUrl=
function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/home/user.html");return k};t.getPortalHelpUrl=function(f,k){var q="";(f=t.getStandardPortalUrl(f))&&(q=f+"/portalhelp/"+(k||"en")+"/portal/");return q};t.getPortalAdminHelpUrl=function(f,k){var q="";(f=t.getStandardPortalUrl(f))&&(q=f+"/portalhelp/"+(k||"en")+"/admin/help/");return q};t.getPortalProxyUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&(k=f+"/sharing/proxy");return k};t.getOAuth2SignOutUrl=function(f){var k="";(f=t.getStandardPortalUrl(f))&&
(k=f+"/sharing/rest/oauth2/signout");return k};t.getNewPrintUrl=function(f){var k="";if(f=t.getStandardPortalUrl(f))f=t.setHttpProtocol(f),k=f+"/sharing/tools/newPrint";return k};t.getSwitchAccoutnsUrl=function(f,k,q){var e="";if(f=t.getStandardPortalUrl(f))e=f+"/home/pages/Account/manage_accounts.html#client_id\x3d"+k,q&&(e+="\x26redirect_uri\x3d"+q);e&&(e=t.setHttpsProtocol(e));return e};return t})},"jimu/shared/utils":function(){define([],function(){function t(f,e){function r(e,l){var g,p,d,c,
n="widgetOnScreen"===e;if(f[e]){if(f[e].groups)for(g=0;g<f[e].groups.length;g++)if(d=f[e].groups[g],l(d,{index:g,isWidget:!1,groupId:d.id,isThemeWidget:!1,isOnScreen:n}),f[e].groups[g].widgets)for(p=0;p<f[e].groups[g].widgets.length;p++)c=f[e].groups[g].widgets[p],l(c,{index:p,isWidget:!0,groupId:d.id,isThemeWidget:c.uri&&-1<c.uri.indexOf("themes/"+f.theme.name),isOnScreen:n});if(f[e].widgets)for(g=0;g<f[e].widgets.length;g++)c=f[e].widgets[g],l(f[e].widgets[g],{index:g,isWidget:!0,groupId:e,isThemeWidget:c.uri&&
-1<c.uri.indexOf("themes/"+f.theme.name),isOnScreen:n})}}r("widgetOnScreen",e);r("widgetPool",e)}var f={},k="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");f.visitElement=t;f.getConfigElementById=function(f,e){var r;if("map"===e)return f.map;t(f,function(f){if(f.id===e)return r=f,!0});return r};f.getConfigElementByLabel=
function(f,e){var r;if("map"===e)return f.map;t(f,function(f){if(f.label||f.name===e)return r=f,!0});return r};f.getConfigElementsByName=function(f,e){var r=[];if("map"===e)return[f.map];t(f,function(f){f.name===e&&r.push(f)});return r};f.getWidgetNameFromUri=function(f){f=f.split("/");f.pop();return f.pop()};f.getAmdFolderFromUri=function(f){f=f.split("/");f.pop();return f.join("/")+"/"};f.widgetProperties=k;f.processWidgetProperties=function(f){"undefined"===typeof f.properties.isController&&(f.properties.isController=
!1);"undefined"===typeof f.properties.isThemeWidget&&(f.properties.isThemeWidget=!1);"undefined"===typeof f.properties.hasVersionManager&&(f.properties.hasVersionManager=!1);"undefined"===typeof f.properties.mirrorIconForRTL&&(f.properties.mirrorIconForRTL=!1);k.forEach(function(e){"undefined"===typeof f.properties[e]&&(f.properties[e]=!0)})};f.getControllerWidgets=function(f){var e=[];f.visitElement(function(f){f.isController&&e.push(f)});return e};f.addI18NLabelToManifest=function(f,e,r){function m(g,
d){d[l]&&(f.i18nLabels[g]=d[l]);"theme"===f.category&&(f.layouts&&f.layouts.forEach(function(c){f["i18nLabels_layout_"+c.name]||(f["i18nLabels_layout_"+c.name]={});f["i18nLabels_layout_"+c.name][g]=d["_layout_"+c.name]}),f.styles&&f.styles.forEach(function(c){f["i18nLabels_style_"+c.name]||(f["i18nLabels_style_"+c.name]={});f["i18nLabels_style_"+c.name][g]=d["_style_"+c.name]}));"widget"===f.category&&f.featureActions&&f.featureActions.forEach(function(c){f["i18nLabels_featureAction_"+c.name]||(f["i18nLabels_featureAction_"+
c.name]={});f["i18nLabels_featureAction_"+c.name][g]=d["_featureAction_"+c.name]})}f.i18nLabels={};var l="widget"===f.category?"_widgetLabel":"_themeLabel";e&&e.root&&e.root[l]&&(f.i18nLabels.defaultLabel=e.root[l],"theme"===f.category&&(f.layouts&&f.layouts.forEach(function(g){f["i18nLabels_layout_"+g.name]={};f["i18nLabels_layout_"+g.name].defaultLabel=e.root["_layout_"+g.name]}),f.styles&&f.styles.forEach(function(g){f["i18nLabels_style_"+g.name]={};f["i18nLabels_style_"+g.name].defaultLabel=e.root["_style_"+
g.name]})),"widget"===f.category&&f.featureActions&&f.featureActions.forEach(function(g){f["i18nLabels_featureAction_"+g.name]={};f["i18nLabels_featureAction_"+g.name].defaultLabel=e.root["_featureAction_"+g.name]}));for(var g in r)m(g,r[g])};f.isHostedService=function(f){if(!f)return!1;var e=-1!==f.indexOf(".arcgis.com/");f=-1!==f.indexOf("//services")||-1!==f.indexOf("//tiles")||-1!==f.indexOf("//features");return e&&f};return f})},"jimu/accessibleUtils":function(){define(["dojo/_base/lang","dojo/_base/html",
"dojo/query","dojo/keys","dojo/on"],function(t,f,k,q,e){var r={firstFocusNodeClass:"firstFocusNode",lastFocusNodeClass:"lastFocusNode",lastFocusNodeClassInDOM:"lastFocusNodeInDOM",isInNavMode:function(){return f.hasClass(document.body,"jimu-nav-mode")?!0:!1},initTabIndexAndOrder:function(e){var l=r.getFirstFocusNode(e.domNode,e.inPanel),g=r.getLastFocusNode(e.domNode);l&&!g&&(g=l);e.isController&&(l=g=null);r.initFirstFocusNode(e.domNode,l);r.initLastFocusNode(e.domNode,g)},isOnScreenNotCloseableOffPanel:function(e){return e.isOnScreen&&
!e.inPanel&&!0!==e.closeable},preventMapNavigation:function(e){0<=[q.NUMPAD_PLUS,61,187,q.NUMPAD_MINUS,173,189,q.UP_ARROW,q.NUMPAD_8,q.RIGHT_ARROW,q.NUMPAD_6,q.DOWN_ARROW,q.NUMPAD_2,q.LEFT_ARROW,q.NUMPAD_4,q.PAGE_UP,q.NUMPAD_9,q.PAGE_DOWN,q.NUMPAD_3,q.END,q.NUMPAD_1,q.HOME,q.NUMPAD_7].indexOf(e.keyCode)&&e.stopPropagation()},_addAttrsOnWidgetDom:function(e){var l=0<=["MyLocation","HomeButton","FullScreen"].indexOf(e.name)?"button":"application";e.inPanel||f.setAttr(e.domNode,"role",l)},initWidgetCancelEvent:function(m){this._addAttrsOnWidgetDom(m);
e(m.domNode,"keydown",t.hitch(this,function(e){r.preventMapNavigation(e);var g=e.target;m.inPanel||0>[q.ENTER,q.ESCAPE].indexOf(e.keyCode)||(r.isOnScreenNotCloseableOffPanel(m)?e.keyCode===q.ENTER&&f.hasClass(g,m.baseClass)?(e.preventDefault(),r.focusFirstFocusNode(m.domNode)):e.keyCode===q.ESCAPE&&(f.hasClass(g,m.baseClass)?"Splash"!==m.name&&(g=m.domNode.parentNode,"map"===f.getAttr(g,"id")?(e.preventDefault(),g.focus()):(e="jimu-layout-manager"===f.getAttr(g,"id")?m.domNode:m.domNode.parentNode,
r.trapToNextFocusContainer(e))):(e.stopPropagation(),m.domNode.focus())):e.keyCode!==q.ESCAPE||f.hasClass(g,m.baseClass)||(m.domNode.focus(),m.onClose(),e.preventDefault(),e.stopPropagation()))}))},initFirstFocusNode:function(m,l){var g=r.getFirstFocusNode(m);g&&(f.removeClass(g,r.firstFocusNodeClass),g.firstNodeEvent&&g.firstNodeEvent.remove(),g===m&&(f.setAttr(g,"tabindex",null),f.setAttr(g,"role","")));l&&(l===m&&(f.setAttr(l,"tabindex",0),f.setAttr(l,"role","document")),f.addClass(l,r.firstFocusNodeClass),
l.firstNodeEvent=e(l,"keydown",t.hitch(this,function(g){f.hasClass(g.target,r.firstFocusNodeClass)&&g.keyCode===q.TAB&&(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode?(window.currentMsgPopup.focusedNodeBeforeOpen=g.target,g.preventDefault(),window.currentMsgPopup.firstFocusNode.focus()):!r.tryToFocusSplashWidget(g,m)&&g.shiftKey&&(g.preventDefault(),g=r.getLastFocusNode(m),r.isDomFocusable(g)?g.focus():(g=r.getFocusNodesInDom(g),1<=g.length&&g[g.length-1].focus())))})))},tryToFocusSplashWidget:function(e,
l){var g=k(".jimu-widget-splash",k("#jimu-layout-manager")[0])[0];return g&&"none"!==f.getStyle(g,"display")&&g!==l?(e.stopPropagation(),e.preventDefault(),k("."+r.firstFocusNodeClass,g)[0].focus(),!0):!1},initLastFocusNode:function(m,l){var g=r.getLastFocusNode(m);g&&(f.removeClass(g,r.lastFocusNodeClass),g.lastNodeEvent&&g.lastNodeEvent.remove(),g===m&&f.setAttr(g,"tabindex",null));l&&(l===m&&f.setAttr(l,"tabindex",0),f.addClass(l,r.lastFocusNodeClass),l.lastNodeEvent=e(l,"keydown",t.hitch(this,
function(g){if(!g.shiftKey&&g.keyCode===q.TAB)if(m===l||f.hasClass(g.target,r.lastFocusNodeClass)&&r.isDomFocusable(g.target))g.preventDefault(),this.focusFirstFocusNode(m);else{var d=this.getFocusNodesInDom(l);if(0===d.length||r._isLastFromInnerNodes(d,g.target))g.preventDefault(),this.focusFirstFocusNode(m)}})))},_isLastFromInnerNodes:function(e,l){var g=!1;if(l===e[e.length-1])g=!0;else for(var p=0;p<e.length;p++)if(l===e[p]&&f.hasClass(e[p],r.lastFocusNodeClassInDOM)){g=!0;break}return g},focusFirstFocusNode:function(e){var f=
k("."+r.firstFocusNodeClass,e)[0];(f?f:e).focus()},getFirstFocusNode:function(e,l){var g=f.hasClass(e,r.firstFocusNodeClass)?e:k("."+r.firstFocusNodeClass,e)[0];!g&&l&&(g=e,null===f.getAttr(g,"tabindex")&&f.setAttr(g,"tabindex","0"));return g},getLastFocusNode:function(e){return f.hasClass(e,r.lastFocusNodeClass)?e:k("."+r.lastFocusNodeClass,e)[0]},getFirstSkipLink:function(){return k("#skipContainer a")[0]},focusOnFirstSkipLink:function(){r.getFirstSkipLink().focus()},traversalDom:function(e,f){f=
f?f:[];for(var g=e.childNodes,l=0;l<g.length;l++)e=g[l],1===e.nodeType&&(f.push(e),r.traversalDom(e,f));return f},getFocusNodesInDom:function(e){e=r.traversalDom(e);for(var f=[],g=0;g<e.length;g++){var p=e[g];r.isDomFocusable(p)&&f.push(p)}return f},isDomFocusable:function(e){var l=["A","INPUT","BUTTON","SELECT","TEXTAREA"],g="hidden"!==f.getAttr(e,"type")&&"none"!==f.getStyle(e,"display"),p=!0!==f.getAttr(e,"disabled"),d=parseInt(f.getAttr(e,"tabindex"),10);return g&&p&&(0<=l.indexOf(e.tagName)&&
-1!==d||0>l.indexOf(e.tagName)&&0<=d)?!0:!1},getFrameNodesByAsc:function(){for(var e=k("#jimu-layout-manager")[0].children,l=[],g=0;g<e.length;g++){var p=e[g];0<parseInt(f.getAttr(p,"tabindex"),10)&&"none"!==f.getStyle(p,"display")&&l.push(p)}l.sort(function(d,c){d=parseInt(f.getAttr(d,"tabindex"),10);c=parseInt(f.getAttr(c,"tabindex"),10);return d<c?-1:d===c?0:1});return l},trapToNextFocusContainer:function(e){var l=r.getFrameNodesByAsc(),g=null;if("skipContainer"===f.getAttr(e,"id"))return(g=l[0])&&
g.focus(),g;l.unshift(r.getFirstSkipLink());e=parseInt(f.getAttr(e,"tabindex"),10);for(var p=0;p<l.length;p++)if(parseInt(f.getAttr(l[p],"tabindex"),10)===e){g=p===l.length-1?l[0]:l[p+1];break}g&&g.focus();return g},isAutoFocusFirstNodeWidget:function(e){var f=!0;r.isOnScreenNotCloseableOffPanel(e)?f=!1:e.openAtStart?e.openAtStartAysn?f=e.openAtStartAysn=!1:e._isFirstOpenAtStart||(e._isFirstOpenAtStart=!0,f=!1):e.isOnScreen&&"widgetOnScreen"!==e.gid?f=!1:e.inGroupPanel&&(f=!1);return f},_getTooltipLabel:function(e,
l){var g=f.getAttr(e,"aria-label");e=f.getAttr(e,"title");return g||e||l},addTooltipByDomNode:function(m,l,g){m.defaultPosition=["below-centered","above-centered","after-centered","before-centered"];var p;e(l,"focus",t.hitch(this,function(d){r.isInNavMode()&&(p&&f.setAttr(p,"role","presentation"),m.show(r._getTooltipLabel(l,g)+"\x26nbsp;\x26nbsp;",d.target),p||(p=k(".dijitTooltipContainer",document.body)[0],f.setAttr(p,"role","presentation")))}));e(l,"blur",t.hitch(this,function(d){m&&m.hide(d.target)}))}};
return r})},"jimu/zoomToUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred esri/config esri/graphic esri/graphicsUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/geometry/webMercatorUtils esri/tasks/ProjectParameters".split(" "),function(t,f,k,q,e,r,m,l,g,p,d){var c={zoomToFeatureSet:function(d,b,h){var a=b.features&&0<b.features.length&&b.features[0].getLayer&&b.features[0].getLayer(),a=a?a.id:null;b=c.graphicsExtent(b.features,h);return c.zoomToExtent(d,
b,a)},zoomToExtent:function(d,b,h){var a;if(!d||!c.isValidExtent(b))return a=new k,a.reject(),a;h?(a=new k,require(["jimu/LayerStructure"],function(n){(n=n.getInstance().getNodeById(h))?n.zoomTo(b).then(function(){a.resolve()},function(){a.reject()}):c.projectToMapSpatialReference(d,b).then(function(h){b.isSinglePoint&&(h=c.convertSinglePointExtent(d,h));d.setExtent(h,!0);a.resolve()},function(){a.reject()})})):a=c.projectToMapSpatialReference(d,b).then(function(a){b.isSinglePoint&&(a=c.convertSinglePointExtent(d,
a));return d.setExtent(a,!0)});return a},isValidExtent:function(d){return d&&c.isTrueOrZero(d.xmin)&&c.isTrueOrZero(d.ymin)&&c.isTrueOrZero(d.xmax)&&c.isTrueOrZero(d.ymax)}};c.isVaildExtent=c.isValidExtent;c.isTrueOrZero=function(c){return 0===c?!0:!!c};c.convertSinglePointExtent=function(d,b){var h=d.getScale();if(h=c.getMedianScale(d,h,0))b=c.adjustHeightToAspectRatio(d,b),b=c.getExtentForScale(b,d.width,h);return b};c.graphicsExtent=function(c,b){var d=null;try{if(c&&1===c.length&&c[0].geometry&&
"esri.geometry.Multipoint"===c[0].geometry.declaredClass&&1===c[0].geometry.points.length){var a=c[0].geometry.points[0],n=new l(a[0],a[1],c[0].geometry.spatialReference);c=[new e(n)]}if(c&&1===c.length&&c[0].geometry&&"esri.geometry.Point"===c[0].geometry.declaredClass){var g=c[0].geometry,d=new m(g.x-1E-4,g.y-1E-4,g.x+1E-4,g.y+1E-4,g.spatialReference);d.isSinglePoint=!0}else c&&0<c.length&&(d=r.graphicsExtent(c))&&"number"===typeof b&&0<b&&(d=d.expand(b))}catch(x){console.error(x)}return d};c.projectToMapSpatialReference=
function(d,b){return c.projectToSpatialReference(b,d.spatialReference)};c.projectToSpatialReference=function(c,b){var h=new k,a=c;if(b&&c)if(b.equals(c.spatialReference))h.resolve(a);else if(b.isWebMercator()&&c.spatialReference.equals(new g(4326)))a=p.geographicToWebMercator(c),a.isSinglePoint=c.isSinglePoint,h.resolve(a);else if(b.equals(new g(4326))&&c.spatialReference.isWebMercator())a=p.webMercatorToGeographic(c),a.isSinglePoint=c.isSinglePoint,h.resolve(a);else{var n=q&&q.defaults&&q.defaults.geometryService;
if(n&&"esri.tasks.GeometryService"===n.declaredClass){var e=new d;e.geometries=[c];e.outSR=b;n.project(e).then(function(b){(a=b&&0<b.length&&b[0])?(a.isSinglePoint=c.isSinglePoint,h.resolve(a)):h.reject()},function(){})}else h.reject()}else h.reject();return h};c.getMapLods=function(c){var b=null;c._params&&c._params.lods&&(b=f.map(c._params.lods,t.hitch(this,function(b){return b.toJson()})));return b};c.getMedianScale=function(d,b,h){return c.getTargetScale(d,2,b,h)};c.getTargetScale=function(d,
b,h,a){d=c.getMapLods(d);var n=1;if(d){var g=[],e=[];f.forEach(d,function(b){0<h&&b.scale>h||(b.scale<a?e.push(b.scale):g.push(b.scale))});g.reverse();1<=g.length?(n=e.length?e.length/d.length:1,b=Math.floor((g.length-1)/(b/n)),b=g[b]):b=null}else b=0===h?null:(h-a)/b;return b};c.getScaleForNextTileLevel=function(d,b,h){if(d=c.getMapLods(d)){if(h){for(h=0;h<d.length;h++)if(d[h].scale<b)return d[h].scale-1;return d[d.length-1].scale-1}for(h=d.length-1;0<=h;h--)if(d[h].scale>b)return d[h].scale+1;return d[0].scale+
1}return h?b-1:b+1};c.adjustExtentToAspectRatio=function(c,b){c=c.width/c.height;var d=b.getWidth()/b.getHeight();d>c?(c=b.getWidth()/c/2,t.mixin(b,{ymin:b.getCenter().y-c,ymax:b.getCenter().y+c})):d<c&&(c=b.getHeight()*c/2,t.mixin(b,{xmin:b.getCenter().x-c,xmax:b.getCenter().x+c}));return b};c.adjustHeightToAspectRatio=function(c,b){c=b.getWidth()*(c.height/c.width)/5;t.mixin(b,{ymin:b.getCenter().y-c,ymax:b.getCenter().y+c});return b};c.getExtentForScale=function(c,b,d){var a=20015077/180,h=esri.config.defaults,
n=esri.WKIDUnitConversion,g,e,f=c.spatialReference;f&&(g=f.wkid,e=f.wkt);f=null;g?f=n.values[n[g]]:e&&-1!==e.search(/^PROJCS/i)&&(n=/UNIT\[([^\]]+)\]\]$/i.exec(e))&&n[1]&&(f=parseFloat(n[1].split(",")[1]));return c.expand(d*b/(39.37*(f||a)*h.screenDPI)/c.getWidth())};c.getScaleForExtent=function(c,b){var d=20015077/180,a=esri.config.defaults,n=esri.WKIDUnitConversion,g,e,f=c.spatialReference;f&&(g=f.wkid,e=f.wkt);f=null;g?f=n.values[n[g]]:e&&-1!==e.search(/^PROJCS/i)&&(n=/UNIT\[([^\]]+)\]\]$/i.exec(e))&&
n[1]&&(f=parseFloat(n[1].split(",")[1]));return c.getWidth()/b*(f||d)*39.37*a.screenDPI};return c})},"libs/caja-html-sanitizer-minified":function(){(function(){var t=function(){function f(a){return(a=(""+a).match(n))?new g(p(a[1]),p(a[2]),p(a[3]),p(a[4]),p(a[5]),p(a[6]),p(a[7])):null}function e(a,b){return"string"==typeof a?encodeURI(a).replace(b,r):null}function r(a){a=a.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(a>>4&15)+"0123456789ABCDEF".charAt(a&15)}function m(a){if(null===a)return null;
a=a.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/");for(var b=d,c;(c=a.replace(b,"$1"))!=a;a=c);return a}function l(a,b){a=a.R();var d=b.K();d?a.fa(b.j):d=b.V();d?a.ca(b.m):d=b.W();d?a.da(b.k):d=b.Y();var h=b.g,n=m(h);if(d)a.ba(b.T()),n=n&&n.replace(c,"");else if(d=!!h){if(47!==n.charCodeAt(0))var n=m(a.g||"").replace(c,""),g=n.lastIndexOf("/")+1,n=m((g?n.substring(0,g):"")+m(h)).replace(c,"")}else n=n&&n.replace(c,""),n!==h&&a.G(n);d?a.G(n):d=b.Z();d?a.M(b.l):d=b.X();d&&a.ea(b.n);return a}
function g(a,b,c,d,h,n,g){this.j=a;this.m=b;this.k=c;this.h=d;this.g=h;this.l=n;this.n=g}function p(a){return"string"==typeof a&&0<a.length?a:null}var d=RegExp(/(\/|^)(?:[^./][^/]*|\.{2,}(?:[^./][^/]*)|\.{3,}[^/]*)\/\.\.(?:\/|$)/),c=/^(?:\.\.\/)*(?:\.\.$)?/;g.prototype.toString=function(){var a=[];null!==this.j&&a.push(this.j,":");null!==this.k&&(a.push("//"),null!==this.m&&a.push(this.m,"@"),a.push(this.k),null!==this.h&&a.push(":",this.h.toString()));null!==this.g&&a.push(this.g);null!==this.l&&
a.push("?",this.l);null!==this.n&&a.push("#",this.n);return a.join("")};g.prototype.R=function(){return new g(this.j,this.m,this.k,this.h,this.g,this.l,this.n)};g.prototype.U=function(){return this.j&&decodeURIComponent(this.j).toLowerCase()};g.prototype.fa=function(a){this.j=a?a:null};g.prototype.K=function(){return null!==this.j};g.prototype.ca=function(a){this.m=a?a:null};g.prototype.V=function(){return null!==this.m};g.prototype.da=function(a){this.k=a?a:null;this.G(this.g)};g.prototype.W=function(){return null!==
this.k};g.prototype.T=function(){return this.h&&decodeURIComponent(this.h)};g.prototype.ba=function(a){if(a){a=Number(a);if(a!==(a&65535))throw Error("Bad port number "+a);this.h=""+a}else this.h=null};g.prototype.Y=function(){return null!==this.h};g.prototype.S=function(){return this.g&&decodeURIComponent(this.g)};g.prototype.G=function(a){a?(a=""+a,this.g=!this.k||/^\//.test(a)?a:"/"+a):this.g=null};g.prototype.M=function(a){this.l=a?a:null};g.prototype.Z=function(){return null!==this.l};g.prototype.aa=
function(a){if("object"===typeof a&&!(a instanceof Array)&&(a instanceof Object||"[object Array]"!==Object.prototype.toString.call(a))){var b=[],c=-1,d;for(d in a){var h=a[d];"string"===typeof h&&(b[++c]=d,b[++c]=h)}a=b}for(var b=[],c="",n=0;n<a.length;)d=a[n++],h=a[n++],b.push(c,encodeURIComponent(d.toString())),c="\x26",h&&b.push("\x3d",encodeURIComponent(h.toString()));this.l=b.join("")};g.prototype.ea=function(a){this.n=a?a:null};g.prototype.X=function(){return null!==this.n};var n=/^(?:([^:/?#]+):)?(?:\/\/(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,
b=/[#\/\?@]/g,h=/[\#\?]/g;g.parse=f;g.create=function(a,c,d,n,f,l,p){a=new g(e(a,b),e(c,b),"string"==typeof d?encodeURIComponent(d):null,0<n?n.toString():null,e(f,h),null,"string"==typeof p?encodeURIComponent(p):null);l&&("string"===typeof l?a.M(l.replace(/[^?&=0-9A-Za-z_\-~.%]/g,r)):a.aa(l));return a};g.$=l;g.ja=m;g.ua={oa:function(a){return/\.html$/.test(f(a).S())?"text/html":"application/javascript"},$:function(a,b){return a?l(f(a),f(b)).toString():""+b}};return g}();"undefined"!==typeof window&&
(window.URI=t);var f={e:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13}};f.atype=f.e;f.w={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,
"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,
"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,
"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,
"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,
"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,
"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,
"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,
"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,
"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,
"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0};f.ATTRIBS=f.w;f.c={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256};
f.eflags=f.c;f.f={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,
ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2};f.ELEMENTS=f.f;f.O={a:"HTMLAnchorElement",
abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",
code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",
frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",
legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",
q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",
thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"};f.ELEMENT_DOM_INTERFACES=f.O;f.N={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};f.ueffects=f.N;f.J={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,
"q::cite":0,"video::poster":1,"video::src":1};f.URIEFFECTS=f.J;f.L={UNSANDBOXED:2,SANDBOXED:1,DATA:0};f.ltypes=f.L;f.I={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2};f.LOADERTYPES=f.I;"undefined"!==typeof window&&(window.html4=f);var k=function(f){function e(a,b){b=A.hasOwnProperty(b)?A[b]:(a=b.match(w))?String.fromCharCode(parseInt(a[1],10)):(a=
b.match(k))?String.fromCharCode(parseInt(a[1],16)):D&&F.test(b)?(D.innerHTML="\x26"+b+";",a=D.textContent,A[b]=a):"\x26"+b+";";return b}function r(a){return a.replace(H,e)}function m(a){return(""+a).replace(L,"\x26amp;").replace(K,"\x26lt;").replace(N,"\x26gt;").replace(P,"\x26#34;")}function l(a){return a.replace(J,"\x26amp;$1").replace(K,"\x26lt;").replace(N,"\x26gt;")}function g(a){var b={z:a.z||a.cdata,A:a.A||a.comment,B:a.B||a.endDoc,r:a.r||a.endTag,d:a.d||a.pcdata,F:a.F||a.rcdata,H:a.H||a.startDoc,
v:a.v||a.startTag};return function(a,c){var h=/(<\/|<\!--|<[!?]|[&<>])/g;a+="";if(O)a=a.split(h);else{for(var n=[],g=0,u;null!==(u=h.exec(a));)n.push(a.substring(g,u.index)),n.push(u[0]),g=u.index+u[0].length;n.push(a.substring(g));a=n}d(b,a,0,{o:!1,C:!1},c)}}function p(a,b,c,h,n){return function(){d(a,b,c,h,n)}}function d(a,b,d,h,g){try{a.H&&0==d&&a.H(g);for(var u,e,v,l=b.length;d<l;){var z=b[d++],x=b[d];switch(z){case "\x26":M.test(x)?(a.d&&a.d("\x26"+x,g,I,p(a,b,d,h,g)),d++):a.d&&a.d("\x26amp;",
g,I,p(a,b,d,h,g));break;case "\x3c/":if(u=/^([-\w:]+)[^\'\"]*/.exec(x))if(u[0].length===x.length&&"\x3e"===b[d+1])d+=2,v=u[1].toLowerCase(),a.r&&a.r(v,g,I,p(a,b,d,h,g));else{var m=b,r=d,w=a,C=g,q=I,A=h,k=n(m,r);k?(w.r&&w.r(k.name,C,q,p(w,m,r,A,C)),d=k.next):d=m.length}else a.d&&a.d("\x26lt;/",g,I,p(a,b,d,h,g));break;case "\x3c":if(u=/^([-\w:]+)\s*\/?/.exec(x))if(u[0].length===x.length&&"\x3e"===b[d+1]){d+=2;v=u[1].toLowerCase();a.v&&a.v(v,[],g,I,p(a,b,d,h,g));var E=f.f[v];E&R&&(d=c(b,{name:v,next:d,
c:E},a,g,I,h))}else{var m=b,r=a,w=g,C=I,q=h,B=n(m,d);B?(r.v&&r.v(B.name,B.P,w,C,p(r,m,B.next,q,w)),d=B.c&R?c(m,B,r,w,C,q):B.next):d=m.length}else a.d&&a.d("\x26lt;",g,I,p(a,b,d,h,g));break;case "\x3c!--":if(!h.C){for(e=d+1;e<l&&("\x3e"!==b[e]||!/--$/.test(b[e-1]));e++);if(e<l){if(a.A){var t=b.slice(d,e).join("");a.A(t.substr(0,t.length-2),g,I,p(a,b,e+1,h,g))}d=e+1}else h.C=!0}h.C&&a.d&&a.d("\x26lt;!--",g,I,p(a,b,d,h,g));break;case "\x3c!":if(/^\w/.test(x)){if(!h.o){for(e=d+1;e<l&&"\x3e"!==b[e];e++);
e<l?d=e+1:h.o=!0}h.o&&a.d&&a.d("\x26lt;!",g,I,p(a,b,d,h,g))}else a.d&&a.d("\x26lt;!",g,I,p(a,b,d,h,g));break;case "\x3c?":if(!h.o){for(e=d+1;e<l&&"\x3e"!==b[e];e++);e<l?d=e+1:h.o=!0}h.o&&a.d&&a.d("\x26lt;?",g,I,p(a,b,d,h,g));break;case "\x3e":a.d&&a.d("\x26gt;",g,I,p(a,b,d,h,g));break;case "":break;default:a.d&&a.d(z,g,I,p(a,b,d,h,g))}}a.B&&a.B(g)}catch(ja){if(ja!==I)throw ja;}}function c(a,b,c,d,h,n){var g=a.length;V.hasOwnProperty(b.name)||(V[b.name]=RegExp("^"+b.name+"(?:[\\s\\/]|$)","i"));for(var u=
V[b.name],e=b.next,v=b.next+1;v<g&&("\x3c/"!==a[v-1]||!u.test(a[v]));v++);v<g&&--v;g=a.slice(e,v).join("");if(b.c&f.c.CDATA)c.z&&c.z(g,d,h,p(c,a,v,n,d));else if(b.c&f.c.RCDATA)c.F&&c.F(l(g),d,h,p(c,a,v,n,d));else throw Error("bug");return v}function n(a,b){var c=/^([-\w:]+)/.exec(a[b]),d={};d.name=c[1].toLowerCase();d.c=f.f[d.name];var h=a[b].substr(c[0].length);b+=1;for(var n=a.length;b<n&&"\x3e"!==a[b];b++)h+=a[b];if(!(n<=b)){for(var g=[];""!==h;)if(c=Q.exec(h))if(c[4]&&!c[5]||c[6]&&!c[7]){for(var c=
c[4]||c[6],u=!1,h=[h,a[b++]];b<n;b++){if(u){if("\x3e"===a[b])break}else 0<=a[b].indexOf(c)&&(u=!0);h.push(a[b])}if(n<=b)break;h=h.join("")}else{var u=c[1].toLowerCase(),e;if(c[2]){e=c[3];var v=e.charCodeAt(0);if(34===v||39===v)e=e.substr(1,e.length-2);e=r(e.replace(G,""))}else e="";g.push(u,e);h=h.substr(c[0].length)}else h=h.replace(/^[\s\S][^a-z\s]*/,"");d.P=g;d.next=b+1;return d}}function b(a){function b(a,b){d||b.push(a)}var c,d;return g({startDoc:function(){c=[];d=!1},startTag:function(b,h,n){if(!d&&
f.f.hasOwnProperty(b)){var g=f.f[b];if(!(g&f.c.FOLDABLE)){var e=a(b,h);if(e){if("object"!==typeof e)throw Error("tagPolicy did not return object (old API?)");if("attribs"in e)h=e.attribs;else throw Error("tagPolicy gave no attribs");var u;"tagName"in e?(u=e.tagName,e=f.f[u]):(u=b,e=g);if(g&f.c.OPTIONAL_ENDTAG){var v=c[c.length-1];v&&v.D===b&&(v.t!==u||b!==u)&&n.push("\x3c/",v.t,"\x3e")}g&f.c.EMPTY||c.push({D:b,t:u});n.push("\x3c",u);b=0;for(v=h.length;b<v;b+=2){var l=h[b],p=h[b+1];null!==p&&void 0!==
p&&n.push(" ",l,'\x3d"',m(p),'"')}n.push("\x3e");g&f.c.EMPTY&&!(e&f.c.EMPTY)&&n.push("\x3c/",u,"\x3e")}else d=!(g&f.c.EMPTY)}}},endTag:function(a,b){if(d)d=!1;else if(f.f.hasOwnProperty(a)){var h=f.f[a];if(!(h&(f.c.EMPTY|f.c.FOLDABLE))){if(h&f.c.OPTIONAL_ENDTAG)for(h=c.length;0<=--h;){var n=c[h].D;if(n===a)break;if(!(f.f[n]&f.c.OPTIONAL_ENDTAG))return}else for(h=c.length;0<=--h&&c[h].D!==a;);if(!(0>h)){for(n=c.length;--n>h;){var g=c[n].t;f.f[g]&f.c.OPTIONAL_ENDTAG||b.push("\x3c/",g,"\x3e")}h<c.length&&
(a=c[h].t);c.length=h;b.push("\x3c/",a,"\x3e")}}}},pcdata:b,rcdata:b,cdata:b,endDoc:function(a){for(;c.length;c.length--)a.push("\x3c/",c[c.length-1].t,"\x3e")}})}function h(a,b,c,d,h){if(!h)return null;try{var n=t.parse(""+a);if(n&&(!n.K()||Y.test(n.U()))){var g=h(n,b,c,d);return g?g.toString():null}}catch(y){}return null}function a(a,b,c,d,h){c||a(b+" removed",{Q:"removed",tagName:b});if(d!==h){var n="changed";d&&!h?n="removed":!d&&h&&(n="added");a(b+"."+c+" "+n,{Q:n,tagName:b,ia:c,oldValue:d,newValue:h})}}
function u(a,b,c){b=b+"::"+c;if(a.hasOwnProperty(b))return a[b];b="*::"+c;if(a.hasOwnProperty(b))return a[b]}function v(b,c,d,n,g){for(var e=0;e<c.length;e+=2){var v=c[e],l=c[e+1],p=l,z=null,x;if((x=b+"::"+v,f.w.hasOwnProperty(x))||(x="*::"+v,f.w.hasOwnProperty(x)))z=f.w[x];if(null!==z)switch(z){case f.e.NONE:break;case f.e.SCRIPT:l=null;g&&a(g,b,v,p,l);break;case f.e.STYLE:if("undefined"===typeof q){l=null;g&&a(g,b,v,p,l);break}var m=[];q(l,{declaration:function(a,b){var c=a.toLowerCase();C(c,b,
d?function(a){return h(a,f.N.ga,f.L.ha,{TYPE:"CSS",CSS_PROP:c},d)}:null);b.length&&m.push(c+": "+b.join(" "))}});l=0<m.length?m.join(" ; "):null;g&&a(g,b,v,p,l);break;case f.e.ID:case f.e.IDREF:case f.e.IDREFS:case f.e.GLOBAL_NAME:case f.e.LOCAL_NAME:case f.e.CLASSES:l=n?n(l):l;g&&a(g,b,v,p,l);break;case f.e.URI:l=h(l,u(f.J,b,v),u(f.I,b,v),{TYPE:"MARKUP",XML_ATTR:v,XML_TAG:b},d);g&&a(g,b,v,p,l);break;case f.e.URI_FRAGMENT:l&&"#"===l.charAt(0)?(l=l.substring(1),l=n?n(l):l,null!==l&&void 0!==l&&(l=
"#"+l)):l=null;g&&a(g,b,v,p,l);break;default:l=null,g&&a(g,b,v,p,l)}else l=null,g&&a(g,b,v,p,l);c[e+1]=l}return c}function x(b,c,d){return function(h,n){if(f.f[h]&f.c.UNSAFE)d&&a(d,h,void 0,void 0,void 0);else return{attribs:v(h,n,b,c,d)}}}function z(a,c){var d=[];b(c)(a,d);return d.join("")}var q,C;"undefined"!==typeof window&&(q=window.parseCssDeclarations,C=window.sanitizeCssProperty);var A={lt:"\x3c",LT:"\x3c",gt:"\x3e",GT:"\x3e",amp:"\x26",AMP:"\x26",quot:'"',apos:"'",nbsp:"\u00a0"},w=/^#(\d+)$/,
k=/^#x([0-9A-Fa-f]+)$/,F=/^[A-Za-z][A-za-z0-9]+$/,D="undefined"!==typeof window&&window.document?window.document.createElement("textarea"):null,G=/\0/g,H=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,M=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,L=/&/g,J=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,K=/[<]/g,N=/>/g,P=/\"/g,Q=/^\s*([-.:\w]+)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i,O=3==="a,b".split(/(,)/).length,R=f.c.CDATA|f.c.RCDATA,I={},V={},Y=/^(?:https?|mailto)$/i,S={};S.ka=
S.escapeAttrib=m;S.la=S.makeHtmlSanitizer=b;S.ma=S.makeSaxParser=g;S.na=S.makeTagPolicy=x;S.pa=S.normalizeRCData=l;S.qa=S.sanitize=function(a,b,c,d){return z(a,x(b,c,d))};S.ra=S.sanitizeAttribs=v;S.sa=S.sanitizeWithPolicy=z;S.ta=S.unescapeEntities=r;return S}(f),f=k.sanitize;"undefined"!==typeof window&&(window.html=k,window.html_sanitize=f);"function"===typeof define&&define.amd&&define([],function(){return k})})()},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dijit/Tooltip dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all dijit/registry ./utils jimu/tokenUtils ./dijit/Message ./DataSourceManager".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x){var z=null,E=t(m,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(r.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),r.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(r.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),r.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(r.subscribe("app/sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),
r.subscribe("app/sceneViewChanged",f.hitch(this,this._onSceneViewChanged))):(r.subscribe("sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),r.subscribe("sceneViewChanged",f.hitch(this,this._onSceneViewChanged)));window.isBuilder?(r.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),r.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(r.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),r.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));
r.subscribe("userSignIn",f.hitch(this,this._onUserSignIn));r.subscribe("userSignOut",f.hitch(this,this._onUserSignOut));r.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered));r.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart))},loadWidget:function(a){var c=new e,d;a=f.clone(a);(d=this.getWidgetById(a.id))?c.resolve(d):b([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(f.hitch(this,function(a){var b=a[0],d=a[1];this.loadWidgetResources(d).then(f.hitch(this,
function(a){try{var n=this.createWidget(d,b,a);q.setAttr(n.domNode,"data-widget-name",d.name);console.log("widget ["+d.uri+"] created.")}catch(M){console.log("create ["+d.uri+"] error:"+M.stack),new v({message:window.jimuNls.widgetManager.createWidgetError+": "+d.uri}),h.byId(d.id)&&h.byId(d.id).destroy(),c.reject(M)}setTimeout(f.hitch(this,function(){c.resolve(n);this.emit("widget-created",n);r.publish("widgetCreated",n)}),50)}),function(a){c.reject(a)})}),function(a){c.reject(a)});return c},loadWidgetClass:function(b){var c=
new e,d;d=b.isRemote?b.uri+".js":b.uri;require(a.getRequireConfig(),[d],f.hitch(this,function(a){c.resolve(a)}));a.checkError(b.uri,c);return c},loadWidgetResources:function(a){var c=new e,d,h,n,g=[];n=f.clone(a);a=this.tryLoadWidgetConfig(n);d=this._tryLoadResource(n,"i18n");h=this._tryLoadResource(n,"style");n=this._tryLoadResource(n,"template");g.push(a);g.push(d);g.push(n);g.push(h);b(g).then(f.hitch(this,function(a){var b={};b.config=a[0];b.i18n=a[1];b.template=a[2];b.style=a[3];c.resolve(b)}),
function(a){c.reject(a)});return c},loadWidgetManifest:function(b){var c=new e,d=a.getUriInfo(b.uri),d=d.isRemote?d.folderUrl+"manifest.json?f\x3djson":d.folderUrl+"manifest.json";if(b.manifest)return c.resolve(b),c;n(d,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(d){if(d.error&&d.error.code)return c.reject(d.error);d.category="widget";f.mixin(d,a.getUriInfo(b.uri));a.manifest.addI18NLabel(d).then(f.hitch(this,function(){this._processManifest(d);a.widgetJson.addManifest2WidgetJson(b,
d);c.resolve(b)}))}),function(a){c.reject(a)});return c},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;var b={left:-9999,top:-9999,relativeTo:a.position.relativeTo};a._isTestSizeFlag=!0;a.setPosition(b);this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);"undefined"!==typeof a._isTestSizeFlag&&delete a._isTestSizeFlag;return a._marginBox},_processManifest:function(b){a.manifest.addManifestProperies(b);
a.manifest.processManifestLabel(b,window.dojoConfig.locale)},createWidget:function(b,c,d){if(this.getWidgetById(b.id))return this.getWidgetById(b.id);d.config&&d.i18n&&(d.config=a.replacePlaceHolder(d.config,d.i18n));b.rawConfig=b.config;b.config=d.config||{};this.appConfig._appData&&this._mergeAgolConfig(b);b.nls=d.i18n||{};d.template&&(b.templateString=d.template);b["class"]="jimu-widget";b.label||(b.label=b.name);this.map&&(b.map=this.map);b.appConfig=this.appConfig;d={};for(var h in b)b.hasOwnProperty(h)&&
(d[h]=b[h]);d.widgetManager=this;b=new c(d);b.clazz=c;p.after(b,"startup",f.hitch(this,this._postWidgetStartup,b));p.before(b,"destroy",f.hitch(this,this._onDestroyWidget,b));b.domNode.addEventListener(this._getActiveEventName(),f.hitch(this,this._onClickWidget,b),{capture:!0});this.loaded.push(b);return b},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=k.map(this.loaded,function(a){return a.id});k.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},
loadWidgetSettingPage:function(a){var c=new e;a=f.clone(a);a.id+="_setting";b([this.loadWidgetSettingClass(a)]).then(f.hitch(this,function(b){var d=b[0];this.loadWidgetSettingPageResources(a).then(f.hitch(this,function(b){var n,g={nls:b.i18n,appConfig:this.appConfig,"class":"jimu-widget-setting"};null!==b.template&&(g.templateString=b.template);"HTML3D"===window.appInfo.appType?g.sceneView=this.sceneView:g.map=this.map;for(var e in a)a.hasOwnProperty(e)&&(g[e]=a[e]);try{n=new d(g),q.setAttr(n.domNode,
"data-widget-name-setting",g.name),p.before(n,"destroy",f.hitch(this,this._onDestroyWidgetSetting,n)),c.resolve(n)}catch(M){new v({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+a.uri}),h.byId(g.id)&&h.byId(g.id).destroy(),c.reject(M)}}),function(a){console.log(a)})}),function(a){c.reject(a)});return c},loadWidgetSettingClass:function(b){var c=new e,d;d=b.isRemote?b.folderUrl+"setting/Setting.js":b.amdFolder+"setting/Setting";require(a.getRequireConfig(),[d],f.hitch(this,function(a){c.resolve(a)}));
a.checkError(b.folderUrl+"setting/Setting.js",c);return c},loadWidgetSettingPageResources:function(a){var c=new e,d,h,n=[];a=f.clone(a);d=this._tryLoadResource(a,"settingI18n");h=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");n.push(d);n.push(h);n.push(a);b(n).then(f.hitch(this,function(a){var b={};b.i18n=a[0]||{};b.template=a[1];b.style=a[2];c.resolve(b)}),function(a){console.log(a)});return c},getWidgetById:function(a){var b;k.some(this.loaded,function(c){if(c.id===
a)return b=c,!0},this);return b},getWidgetByLabel:function(a){var b;k.some(this.loaded,function(c){if(c.label===a)return b=c,!0},this);return b},getWidgetsByName:function(a){var b=[];k.some(this.loaded,function(c){c.name===a&&b.push(c)},this);return b},changeWindowStateTo:function(a,b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);q.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(A){console.log(console.error("fail to close widget "+a.name+". "+A.stack))}}this.appConfig.mode||this._removeDataSourceUsage(a)},openWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;if(!b.started)try{b.started=!0,b.startup()}catch(A){console.error("fail to startup widget "+
b.name+". "+A.stack)}if("closed"===b.state){q.setStyle(b.domNode,"display","");b.setState("opened");try{b.onOpen()}catch(A){console.error("fail to open widget "+b.name+". "+A.stack)}a.isAutoFocusFirstNodeWidget(b)&&a.focusFirstFocusNode(b.domNode);this.appConfig.mode||this._addDataSourceUsage(b)}},activateWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(A){console.log(console.error("fail to maximize widget "+a.name+". "+A.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(A){console.log(console.error("fail to minimize widget "+a.name+". "+A.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=
this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(A){console.log(console.error("fail to normalize widget "+a.name+". "+A.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(A){console.log(console.error("fail to destroy widget "+a.name+". "+A.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(f.hitch(this,
function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},triggerWidgetOpen:function(a){function b(a){var b=p.after(a,"onOpen",function(){b.remove();c.resolve(a)})}var c=new e,d=this.getWidgetById(a);if(d){if("closed"!==d.state)return c.resolve(d),c;b(d)}else var h=r.subscribe("widgetCreated",f.hitch(this,function(b){b.id===a&&(h.remove(),c.resolve(b))}));r.publish("openWidget",a);return c},_tryLoadWidgetConfig:function(b){var c=new e;if(b.config&&f.isObject(b.config))return c.resolve(b.config),
c;if(b.config){if(require.cache["url:"+b.config])return c.resolve(d.parse(require.cache["url:"+b.config])),c;c=a.processUrlInAppConfig(b.config);c=c.split("/");c[c.length-1]=encodeURIComponent(c[c.length-1]);c=c.join("/");return n(c,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(b,"config").then(function(a){b.isDefaultConfig=!0;return a})},_upgradeWidgetConfig:function(b,c){var d=new e,h=b.manifest.version,n=b.version,g;if(h===n)return d.resolve(c),d;if(!1===b.hasVersionManager)return b.version=
h,d.resolve(c),d;require(a.getRequireConfig(),[b.amdFolder+(b.isRemote?"VersionManager.js":"VersionManager")],f.hitch(this,function(a){a=new a;var e=a.getVersionIndex(n),u=a.getVersionIndex(h);if(e>u)d.reject("Bad widget version number, "+b.name+","+n);else try{g=a.upgrade(c,n,h),b.version=h,d.resolve(g)}catch(L){console.log("Read widget ["+b.name+"] old config error,"+L.stack),d.resolve(c)}}));return d},loadWidgetStyle:function(b){var c=this._getStyleIdFromWidgetJson(b,!1),d=new e;return q.byId(c)?
(d.resolve("load"),d):a.loadStyleLink(c,b.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(b){var c=this._getStyleIdFromWidgetJson(b,!0),d=new e;return q.byId(c)?(d.resolve("load"),d):a.loadStyleLink(c,b.settingStyleFile)},loadWidgetConfig:function(b){b=require(a.getRequireConfig()).toUrl(b.configFile);if(require.cache["url:"+b]){var c=new e;c.resolve(d.parse(require.cache["url:"+b]));return c}return n(b,{handleAs:"json",headers:{"X-Requested-With":null}})},
loadWidgetI18n:function(b){var c=new e;require(a.getRequireConfig(),["dojo/i18n!"+b.i18nFile],function(a){c.resolve(a)});return c},loadWidgetSettingI18n:function(b){var c=new e;require(a.getRequireConfig(),["dojo/i18n!"+b.settingI18nFile],function(a){c.resolve(a)});return c},loadWidgetTemplate:function(b){var c=new e;require(a.getRequireConfig(),["dojo/text!"+b.templateFile],function(a){c.resolve(a)});a.checkError(b.templateFile,c);return c},loadWidgetSettingTemplate:function(b){var c=new e;require(a.getRequireConfig(),
["dojo/text!"+b.settingTemplateFile],function(a){c.resolve(a)});a.checkError(b.settingTemplateFile,c);return c},removeWidgetStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!1))},removeWidgetSettingStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!0))},_removeStyle:function(a){if(q.byId(a)){var b=q.attr(a,"data-import-styles");if(b)for(var c=0;c<parseInt(b,10);c++)q.destroy(a+"_import_"+c);q.destroy(a)}},_getStyleIdFromWidgetJson:function(a,b){return this._replaceId("widget/style/"+
(a.itemId?a.itemId:a.uri)+(b?"/setting":""))},getControllerWidgets:function(){return k.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return k.filter(this.loaded,function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return k.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===
a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a&&this.closeWidget(this.loaded[b])},_addDataSourceUsage:function(a){k.forEach(this._getUsedDataSourceIdFromWidget(a),function(b){x.getInstance().addDataSourceUsage(b,a.id)})},_removeDataSourceUsage:function(a){k.forEach(this._getUsedDataSourceIdFromWidget(a),function(b){x.getInstance().removeDataSourceUsage(b,a.id)})},_getUsedDataSourceIdFromWidget:function(a){if((a=
this.appConfig.getConfigElementById(a.id))&&a.config){var b=d.stringify(a.config);return k.filter(Object.keys(this.appConfig.dataSource.dataSources),function(a){return-1<b.indexOf(a)},this)}},_mergeAgolConfig:function(b){var c=this.appConfig._appData.values,d="widgets["+b.id+"]",h;for(h in c){var n=h.replace(/\//g,"_").indexOf(d+"_config");0<=n&&a.template.setConfigValue(b,h.replace(/\//g,"_").substr(n,h.length).replace(d,"widget"),c[h])}},_onUserSignIn:function(a){k.forEach(this.loaded,function(b){b.onSignIn(a)},
this)},_onUserSignOut:function(){k.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&q.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&q.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=
a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&q.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),r.publish("widgetActived",a))},_onClickWidget:function(a,b){var d=c(".jimu-widget",a.domNode);if(0<d.length)for(var h=0;h<d.length;h++)if(b.target===d[h]||q.isDescendant(b.target,d[h]))return;this._activeWidget(a)},_onMoveStart:function(a){k.forEach(this.loaded,function(b){b.domNode===
a.node&&this._activeWidget(b)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);u.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a},_onSceneViewLoaded:function(a){this.sceneView=a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,b,c,d){var h=f.clone(a);this.appConfig=h;k.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(h,b,c,d),"widgetChange"===b&&this._onConfigChanged(c.id,c.config,d))},
this)},_onConfigChanged:function(a,b){if(a=this.getWidgetById(a))a.onConfigChanged(b),f.mixin(a.config,b)},_onActionTriggered:function(a){if("map"!==a.elementId&&"app"!==a.elementId){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});k.forEach(this.getControllerWidgets(),function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_resetFirstFocusNode:function(b){if(window.isMoveFocusWhenInit){var c=
this.getWidgetsByName("Splash")[0];if(c&&"none"!==q.getStyle(c.domNode,"display"))window.isMoveFocusWhenInit=!1,b&&"Splash"===b.name||c.domNode.focus();else if(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode)window.isMoveFocusWhenInit=!1,window.currentMsgPopup.focusedNodeBeforeOpen=a.getFirstSkipLink(),window.currentMsgPopup.firstFocusNode.focus();else if(window.isMoveFocusWhenInit)window.isMoveFocusWhenInit=!1,a.isInNavMode()&&a.focusOnFirstSkipLink();else return!1;return!0}},_postWidgetStartup:function(b){b.started=
!0;a.setVerticalCenter(b.domNode);p.after(b,"resize",f.hitch(this,a.setVerticalCenter,b.domNode));a.initTabIndexAndOrder(b);a.initWidgetCancelEvent(b);var c=b.position||b.panel&&b.panel.position;c&&"browser"===c.relativeTo&&l(b.domNode,"focus",f.hitch(this,function(){this._resetFirstFocusNode()}));this.openWidget(b);if(c=u.getPortalCredential(this.appConfig.portalUrl))b.onSignIn(c);else b.onSignOut();this._triggerMissedAction(b);b.inPanel||a.addTooltipByDomNode(g,b.domNode,b.label)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===
a.id)a.onAction(b.action.name,b.action.data)})},_remove:function(a){return k.some(this.loaded,function(b,c){if(b.id===a)return this.loaded.splice(c,1),!0},this)},_tryLoadResource:function(a,b){var c,d=new e;if("config"===b)c=a.amdFolder+"config.json",a.configFile=c,c="hasConfig";else if("style"===b)c=a.amdFolder+"css/style.css",a.styleFile=c,c="hasStyle";else if("i18n"===b)c=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?c:a.amdFolder+"nls/strings",c="hasLocale";else if("template"===b)c=a.amdFolder+
"Widget.html",a.templateFile=c,c="hasUIFile";else if("settingTemplate"===b)c=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=c,c="hasSettingUIFile";else if("settingI18n"===b)c=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?c:a.amdFolder+"setting/nls/strings",c="hasSettingLocale";else if("settingStyle"===b)c=a.amdFolder+"setting/css/style.css",a.settingStyleFile=c,c="hasSettingStyle";else return d;a[c]?function(){var c;if("config"===b)c=this.loadWidgetConfig(a);else if("style"===
b)c=this.loadWidgetStyle(a);else if("i18n"===b)c=this.loadWidgetI18n(a);else if("template"===b)c=this.loadWidgetTemplate(a);else if("settingTemplate"===b)c=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)c=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)c=this.loadWidgetSettingI18n(a);else return d;c.then(function(a){d.resolve(a)},function(c){console.error("Load widget resource error. resource:",b);console.error(c);new v({message:window.jimuNls.widgetManager.loadWidgetResourceError+
": "+a.uri});d.reject(c)})}.apply(this):d.resolve(null);return d},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);this.emit("widget-destroyed",a.id);r.publish("widgetDestroyed",a.id);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&
this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)},_getActiveEventName:function(){var a="PointerEvent"in window?"pointer":"MSPointerEvent"in window?"MSPointer":!1,b=a&&"MS"===a.slice(0,2);return a?a+(b?"Down":"down"):"mousedown"}});E.getInstance=function(a){null===z&&(z=new E(a),window._widgetManager=z);return z};return E})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils esri/layers/vectorTiles/kernel".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u){"function"!==typeof e.getAll&&(e.getAll=function(a){var b=[];(a=e(a))&&b.push(a);return b});n={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return a.isInConfigOrPreviewWindow()},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=h.getStandardPortalUrl(a))&&
(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(a){var b=new q,d=h.getStandardPortalUrl(a);a=d+"/sharing";var n=h.setHttpsProtocol(d+"/sharing/generateToken?f\x3djson"),e=h.setHttpsProtocol(a);l.get(n,{jsonp:"callback"}).then(t.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(d),this.removeWabAuthCookie(),g.id.getCredential(e).then(t.hitch(this,function(g){function e(a){var b=a.creationTime||(new Date).getTime(),c=a.expires;0<b&&0<c&&c>
b&&setTimeout(function(){l.get(n,{jsonp:"callback"}).then(function(b){b.token&&(a.token=b.token,a.expires=b.expires,a.creationTime=(new Date).getTime(),a.refreshServerTokens(),e(a))},function(a){console.error(a)})},.8*(c-b))}g.token||(g.token=a.token);g.expires||(g.expires=a.expires);var u=c.canUseXhr(g.server,!0);-1<u&&p.defaults.io.corsEnabledServers.splice(u,1);this._pushCorsEnabledServerInfo({host:h.getServerByUrl(d),withCredentials:!0});b.resolve(!0);e(g)}),t.hitch(this,function(){b.resolve(!0)}))):
b.resolve(!1)}),t.hitch(this,function(a){console.error(a);b.reject(a)}));return b},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var b=p.defaults.io.corsEnabledServers,d=h.getServerByUrl(a);(a=h.getServerWithProtocol(a))||(a="http://"+d);a=c.canUseXhr(a,!0);-1<a&&b.splice(a,1);this._pushCorsEnabledServerInfo({host:d,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var b=
p.defaults.io.corsEnabledServers,c="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var d in a.host)a[d]="function"===typeof a.host[d]?function(){return a.host[d].apply(a.host,arguments)}:a.host[d];a.length=a.host.length;f.forEach(c,function(b){"function"===
typeof a.host[b]&&(a[b]=function(){return a.host[b].apply(a.host,arguments)})})}b.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?f.some(g.id.credentials,t.hitch(this,function(b){return a.token===b.token}))?!1:(g.id.credentials.push(a),!0):!1},registerToken:function(a){var b=h.getSharingUrl(this.portalUrl);g.id.findCredential(b)&&f.some(g.id.credentials,t.hitch(this,function(a,b){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return g.id.credentials.splice(b,
1),!0}));return this._getTokenInfo(a).then(function(a){a&&g.id.registerToken(a)})},_getTokenInfo:function(a){var b=h.getPortalSelfInfoUrl(this.portalUrl);return l.get(b+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(t.hitch(this,function(b){return b.user?{server:h.getSharingUrl(this.portalUrl),ssl:b.allSSL,token:a,userId:b.user.username}:null}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&
t.trim(a)},signInPortal:function(a){var b=new q;if(this._isInvalidPortalUrl(a)){a=h.getStandardPortalUrl(a);var c=h.getSharingUrl(a),d=this.getPortalCredential(a);d?setTimeout(t.hitch(this,function(){b.resolve(d)}),0):b=g.id.getCredential(c)}else setTimeout(t.hitch(this,function(){b.reject("Invalid portalurl.")}),0);return b},_loadPortalSelfInfo:function(a){a=h.getPortalSelfInfoUrl(a);return d({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,c){if(!a||
"string"!==typeof a||!c||"string"!==typeof c)return null;var d=g.id.findOAuthInfo(a);d||(d=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",d=new b({appId:c,expiration:20159,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:d}),g.id.registerOAuthInfos([d]));d.appId=c;return d},signOutAll:function(){var a=h.getStandardPortalUrl(this.portalUrl),b=!!g.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():
this.removeWabAuthCookie();g.id.destroyCredentials();g.id._oAuthHash=null;b&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(t.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,c=a.server,d=a.scope,b=b&&"string"===typeof b&&t.trim(b),c=c&&"string"===typeof c&&t.trim(c),d="portal"===d||"server"===d,h=!0;a.expires&&(a=parseInt(a.expires,10),h=(new Date).getTime(),h=a>h);b=b&&c&&d&&h}return b},isValidPortalCredentialOfPortalUrl:function(a,
b){var c=!1;this.isValidCredential(b)&&(c="portal"===b.scope,a=h.isSameServer(a,b.server),c=c&&a);return c},getPortalCredential:function(a){var b=null;a=t.trim(a||"");if(!a)return null;a=h.getStandardPortalUrl(a);(b=this._filterPortalCredential(a,g.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();return b},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var a=this.portalUrl;if(a&&(a=h.getStandardPortalUrl(a),h.isOrgOnline(a)&&!this._filterPortalCredential(a,g.id.credentials))){var b=
this._filterPortalCredential("http://www.arcgis.com",g.id.credentials);b&&g.id.registerToken({token:b.token,scope:"portal",userId:b.userId,server:a+"/sharing/rest",expires:b.expires})}},saveAndRegisterCookieToCredential:function(a){a=t.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;g.id.registerToken(a);return g.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=t.clone(a);var b=1E3*parseInt(a.expires_in,
10),b=(new Date).getTime()+b,c=h.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:c,token:a.access_token,expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");e("wab_auth",r.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");
window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,b){var c=null;a=h.getStandardPortalUrl(a);b&&0<b.length&&(b=f.filter(b,t.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)})),0<b.length&&(c=b[b.length-1]));return c},_removePortalCredential:function(a){var b=t.trim(a||"");if(b){b=h.getStandardPortalUrl(b);for(a=f.filter(g.id.credentials,t.hitch(this,
function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);g.id.credentials=f.filter(g.id.credentials,t.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(b,a)}))}},getUserIdByToken:function(a,b){var c=new q;if(a&&"string"===typeof a&&b&&"string"===typeof b){var n=h.getStandardPortalUrl(b);b=f.filter(g.id.credentials,t.hitch(this,function(b){var c=b.token===a&&b.userId;b=h.isSameServer(n,b.server);return c&&b}));if(0<b.length){var e=
b[0];setTimeout(t.hitch(this,function(){c.resolve(e.userId)}),0);return c}b=h.getCommunitySelfUrl(n);d({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(t.hitch(this,function(a){c.resolve(a&&a.username||"")}),t.hitch(this,function(a){console.error(a);c.reject("fail to get userId by token")}))}else setTimeout(t.hitch(this,function(){c.reject("invalid parameters")}),0);return c},xtGetCredentialFromCookie:function(a){var b=e("wab_auth"),c=null;if(b)try{c=r.parse(b)}catch(E){console.error(E)}if(!c||
"object"!==typeof c||!h.isSameServer(a,c.server)||window.location.host!==c.referer)return null;c.expires=parseInt(c.expires,10);b=(new Date).getTime();if(!(c.expires>b))return this.removeCookie("wab_auth"),null;a+="/sharing/rest";c.server=a;(b=g.id.findCredential(a))||g.id.registerToken(c);return b=g.id.findCredential(a)},removeCookie:function(b){var c=this.getCookiePath();a.removeCookie(b,c)},_getDomainsByServerName:function(a){var b=a.split("."),c=b.length;return f.map(b,t.hitch(this,function(a,
d){a=b.slice(d,c);var h="",n=a.length-1;f.forEach(a,t.hitch(this,function(a,b){h+=a;b!==n&&(h+=".")}));return h}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{m.publish("userSignIn",a)}catch(x){console.error(x)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{m.publish("anyUserSignIn",a)}catch(x){console.error(x)}},_publishCurrentPortalUserSignOut:function(a){try{m.publish("userSignOut",a)}catch(x){console.error(x)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,
a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(x){console.error(x)}},_bindEvents:function(){k.after(g.id,"signIn",t.hitch(this,function(a,b){console.log(b[1]);k.after(a,"callback",t.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b._wab="builder";if(b){g.id=b;var c=window.esriConfig.defaults.io,
a=a.esriConfig.defaults.io;c.corsEnabledServers=a.corsEnabledServers;c.webTierAuthServers=a.webTierAuthServers;c._processedCorsServers=a._processedCorsServers;c.corsStatus=a.corsStatus;Object.defineProperty(u,"id",{get:function(){return b},enumerable:!0,configurable:!0})}}}this._bindEvents();this._started=!0}}};n.startup();return n})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(t,f,k,q){return function(){function e(){}
Object.defineProperty(e,"id",{get:function(){return k.id?q:null},enumerable:!0,configurable:!0});e.workerMessages={};return e}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require","exports","esri/IdentityManager"],function(t,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.findCredential=function(f){return k.findCredential(f)}})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),
function(t,f,k,q,e,r){return t(r,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,customZIndex:null,postMixInProperties:function(){this.content=this.message;window.currentMsgPopup=this},_createTitleNode:function(){this.titleLabel&&(this.titleNode=k.create("div",{"class":"title"},this.domNode),this.titleLabeNode=k.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),
this.closeBtnNode=k.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",role:"button",tabindex:0},this.titleNode),this.own(e(this.closeBtnNode,"click",f.hitch(this,this.close))),this.own(e(this.closeBtnNode,"keydown",f.hitch(this,function(e){e.keyCode===q.ENTER&&(this.close(),this.focusLastActiveNode())}))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:q.ENTER,onClick:f.hitch(this,this.close)})},_increaseZIndex:function(){k.setStyle(this.domNode,
"zIndex",501);k.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/Evented dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/keys dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){var h=0;return t([n,k],{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",classNames:[],titleLabel:"",content:null,container:null,customZIndex:null,buttons:[],
enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,isResize:!0,horizontalWidthRate:0,maxHeight:800,maxWidth:1024,enableMoveable:!0,hasTitle:!0,contentHasNoMargin:!1,hasOverlay:!0,moveToCenter:!0,customPosition:null,hiddenAfterInit:!1,useFocusLogic:!0,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},focusLastActiveNode:function(){this.focusedNodeBeforeOpen&&this.useFocusLogic&&
this.focusedNodeBeforeOpen.focus()},postCreate:function(){this.focusedNodeBeforeOpen=document.activeElement;this._preProcessing();this.inherited(arguments);this._initDomNode();this._addStylesByHeightType();this._calcAndSetPosition();e.place(this.domNode,this.container);setTimeout(f.hitch(this,function(){this._calcAndSetPosition(!0,!1);this.initFocusNodes()}),50);this.isResize&&this.own(m(window,"resize",f.hitch(this,function(){this._calcAndSetPosition(!0,!0)})));this.hasOverlay&&(this.overlayNode=
e.create("div",{"class":"jimu-overlay"},this.container));this.customZIndex||0===this.customZIndex?(e.setStyle(this.domNode,"zIndex",this.customZIndex+1),this.overlayNode&&e.setStyle(this.overlayNode,"zIndex",this.customZIndex)):this._increaseZIndex();this.hiddenAfterInit&&this.hide();r.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();e.setAttr(this.domNode,"role","application");e.setAttr(this.domNode,"aria-label",window.jimuNls.common.popup);this.own(m(this.domNode,
"keydown",f.hitch(this,function(a){a.keyCode===l.ESCAPE&&(this.closeBtnNode?this.closeBtnNode.focus():(this.close(),this.focusLastActiveNode()));b.preventMapNavigation(a)})))},initFocusNodes:function(){if(this.useFocusLogic){if("string"===typeof this.content){var a="uniqMsgId_"+b.getUUID();e.setAttr(this.contentContainerNode,"id",a);e.setAttr(this.domNode,"tabindex","0");e.setAttr(this.domNode,"aria-labelledby",a)}this.firstFocusNode=this._getFirstFocusNode();this.lastFocusNode=this._getLastFocusNode();
this.firstFocusNode&&(this.own(m(this.firstFocusNode,"keydown",f.hitch(this,function(a){a.shiftKey&&a.keyCode===l.TAB&&(a.preventDefault(),this.firstFocusNode.focus())}))),this.firstFocusNode.focus());this.lastFocusNode&&this.own(m(this.lastFocusNode,"keydown",f.hitch(this,function(a){a.shiftKey||a.keyCode!==l.TAB||(a.preventDefault(),this.firstFocusNode.focus())})))}},_getFirstFocusNode:function(){var a=this.closeBtnNode;"string"===typeof this.content&&(a=this.domNode);if(!a){var c=[];this.content.domNode?
c=b.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(c=b.getFocusNodesInDom(this.content));0<c.length?a=c[0]:this.buttons.length&&(a=this._getFirstBtn())}return a},_getLastFocusNode:function(){var a=this._getLastBtn();if(!a)if(this.content&&"string"!==typeof this.content){var c;this.content.domNode?c=b.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(c=b.getFocusNodesInDom(this.content));a=0<c.length?c[c.length-1]:this.closeBtnNode}else a=this.closeBtnNode;
return a},_getFirstBtn:function(){for(var a=null,b=d(".jimu-btn",this.buttonContainer),c=0;c<=b.length-1;c++)if("none"!==e.getStyle(b[c],"display")){a=b[c];break}return a},_getLastBtn:function(){for(var a=null,b=d(".jimu-btn",this.buttonContainer),c=b.length-1;0<=c;c--)if("none"!==e.getStyle(b[c],"display")){a=b[c];break}return a},_preProcessing:function(){"number"!==typeof this.width&&(this.width=this.maxWidth);"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&
(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=e.create("div",{"class":"title"},this.domNode);this.titleLabeNode=e.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=e.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",tabindex:0,"aria-label":window.jimuNls.common.close,role:"button"},this.titleNode);var a=null,a="ontouchstart"in document?p.press:"click";this.own(m(this.closeBtnNode,
a,f.hitch(this,this.close)));this.own(m(this.closeBtnNode,"keydown",f.hitch(this,function(a){a.keyCode!==l.ENTER&&a.keyCode!==l.SPACE||this.close()})))},_initDomNode:function(){for(var a=0;a<=this.classNames.length-1;a++)e.addClass(this.domNode,this.classNames[a]);this.hasTitle&&this._createTitleNode();this.contentContainerNode=e.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),
this.content.popup=this):1===this.content.nodeType&&e.place(this.content,this.contentContainerNode));this.buttonContainer=e.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&e.setStyle(this.buttonContainer,"display","none");for(a=0;a<=this.buttons.length-1;a++)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var b=e.getContentBox(this.buttonContainer),c=e.getMarginExtents(this.enabledButtons[0]),
d=e.getPadBorderExtents(this.enabledButtons[0]),h=0,d=8===g("ie")?d.l+d.r:0,h=(b.w-(c.l+c.r+d)*a)/a;0<h&&(q.forEach(this.enabledButtons,f.hitch(this,function(a){e.setStyle(a,"maxWidth",h+"px")})),q.forEach(this.disabledButtons,f.hitch(this,function(a){e.setStyle(a,"maxWidth",h+"px")})))}},_moveableNode:function(a,b){this.moveable&&(this.moveable.destroy(),this.moveable=null);var d=e.getMarginBox(this.container);d.l=d.l-a+b;d.w+=2*(a-b);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:d,
handle:this.titleNode||this.contentContainerNode,within:!0});this.own(m(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(m(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===d("#header").length?{t:0,l:0,w:0,h:0}:e.getMarginBox("header")},_getFooterBox:function(){return 0===d(".footer",this.container).length?{t:0,l:0,w:0,h:0}:e.getMarginBox(d(".footer",this.container)[0])},_calcAndSetPosition:function(a,b){var c=e.getMarginBox(this.domNode);if("string"!==
typeof this.container||e.byId(this.container)){var d=e.getContentBox(this.container),h=this._getHeaderBox(),n=this._getFooterBox(),n=d.h-h.h-n.h-40,g=0,u=0;this.customPosition&&this.customPosition.height?(this.height=this.customPosition.height,u="number"===typeof this.height?this.height+"px":this.height):(this.height=this._fixedHeight?this.height>n?n:this.height:this.autoHeight?(c.h>n?n:c.h)||n-200:n>this.maxHeight?this.maxHeight:n,u=this.height+"px");this.customPosition&&this.customPosition.width?
(this.width=this.customPosition.width,g="number"===typeof this.width?this.width+"px":this.width):("number"===typeof this.horizontalWidthRate&&0<this.horizontalWidthRate?(g=e.getMarginBox(window.document.body).w*this.horizontalWidthRate,this.width=g=g>this.maxWidth?g:this.maxWidth):this.width=this.width||this.maxWidth,g=this.width+"px");var f=c=0;this.customPosition?(c="number"===typeof this.customPosition.left?this.customPosition.left+"px":this.customPosition.left,f="number"===typeof this.customPosition.top?
this.customPosition.top+"px":this.customPosition.top):this.moveToCenter&&(f=(n-this.height)/2+h.h+20,f=f<h.h?h.h:f,c=(d.w-this.width)/2+"px",f+="px");e.setStyle(this.domNode,{width:g,height:this.autoHeight?"auto":u,left:c,top:f});this.enableMoveable&&this._moveableNode(this.width,100);!this.moveToCenter&&a&&"block"===e.getStyle(this.domNode,"display")&&this.emit("popupHasInitedSuccessfully",b)}},setDomNodeStyls:function(a){e.setStyle(this.domNode,a)},setCustomPosition:function(a,b,c,d){this.width=
c||this.width||this.maxWidth;this.height=d||this.height||this.maxHeight;c="number"===typeof this.width?this.width+"px":this.width;d="number"===typeof this.height?this.height+"px":this.height;e.setStyle(this.domNode,{left:"number"===typeof a?a+"px":a,top:"number"===typeof b?b+"px":b,width:c,height:this.autoHeight?"auto":d})},_addStylesByHeightType:function(){this.autoHeight?(e.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&e.setStyle(this.contentContainerNode,{marginBottom:"15px"})):
(e.addClass(this.contentContainerNode,"content-absolute"),this.hasTitle||e.addClass(this.contentContainerNode,"no-popup-title-content-absolute"),e.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&e.setStyle(this.contentContainerNode,{bottom:"15px"}));this.contentHasNoMargin&&e.addClass(this.contentContainerNode,"content-fill-Popup")},_increaseZIndex:function(){e.setStyle(this.domNode,"zIndex",h+200+1);this.overlayNode&&e.setStyle(this.overlayNode,"zIndex",h+200);
h++},setTitleLabel:function(a){this.titleNode.innerHTML=b.stripHTML(a)},onMoving:function(a){e.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){e.setStyle(a.node,"opacity",1)},show:function(){this.overlayNode&&e.setStyle(this.overlayNode,"display","block");e.setStyle(this.domNode,"display","block")},hide:function(){this.overlayNode&&e.setStyle(this.overlayNode,"display","none");e.setStyle(this.domNode,"display","none")},close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,
b=f.clone(this.domNode);e.setStyle(this.domNode,"display","none");this.overlayNode&&e.destroy(this.overlayNode);this.destroy();this.moveable&&this.moveable.destroy();e.place(b,a);r.animateProperty({node:b,properties:{opacity:0},duration:200,onEnd:function(){e.destroy(b)}}).play();this.focusLastActiveNode();window.currentMsgPopup=null}},addButton:function(a){this._createButton(a)},_createButton:function(a){var b=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(b+=a.classNames.join(" "));
var c=e.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+b,innerHTML:a.label,tabindex:0,role:"button",title:a.title||a.label},this.buttonContainer);this.enabledButtons.push(c);b=e.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+b,title:a.title||a.label,innerHTML:a.label,tabindex:0,role:"button","aria-disabled":"true",style:{display:"none"}},this.buttonContainer);this.disabledButtons.push(b);this.own(m(c,
"click",f.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})));this.own(m(c,"keydown",f.hitch(this,function(b){if(b.keyCode===l.ENTER||b.keyCode===l.SPACE)if(a.onClick)a.onClick(b);else this.close()})))},setButtonProps:function(a,b){"number"===typeof a&&isFinite(a)||(b=a,a=0);if(b&&0!==this.enabledButtons.length)for(var c in b)"title"===c?(e.setAttr(this.enabledButtons[a],"title",b[c]),e.setAttr(this.disabledButtons[a],"title",b[c])):"label"===c&&(e.setProp(this.enabledButtons[a],
"innerHTML",b[c]),e.setProp(this.disabledButtons[a],"innerHTML",b[c]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(e.setStyle(this.enabledButtons[a],"display","inline-block"),e.setStyle(this.disabledButtons[a],"display","none")):(q.forEach(this.enabledButtons[a],f.hitch(this,function(a){e.setStyle(a,"display","inline-block")})),q.forEach(this.disabledButtons[a],f.hitch(this,function(a){e.setStyle(a,"display","none")})))},disableButton:function(a){"number"===
typeof a&&isFinite(a)&&a<this.disabledButtons.length?(e.setStyle(this.disabledButtons[a],"display","inline-block"),e.setStyle(this.enabledButtons[a],"display","none")):(q.forEach(this.disabledButtons,f.hitch(this,function(a){e.setStyle(a,"display","inline-block")})),q.forEach(this.enabledButtons,f.hitch(this,function(a){e.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(e.setStyle(this.disabledButtons[a],
"display","none"),e.setStyle(this.enabledButtons[a],"display","none")):(q.forEach(this.disabledButtons,f.hitch(this,function(a){e.setStyle(a,"display","none")})),q.forEach(this.enabledButtons,f.hitch(this,function(a){e.setStyle(a,"display","none")})))},resize:function(a){a&&(this.width=a.w,this.height=a.h);this._calcAndSetPosition();this.content&&this.content.domNode&&this.content.resize&&this.content.resize()}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),
function(t,f,k,q,e,r){q=t("dojo.dnd.move.constrainedMoveable",r,{constraints:function(){},within:!1,constructor:function(e,f){f||(f={});this.constraints=f.constraints;this.within=f.within},onFirstMove:function(e){var l=this.constraintBox=this.constraints.call(this,e);l.r=l.l+l.w;l.b=l.t+l.h;this.within&&(e=f.getMarginSize(e.node),l.r-=e.w,l.b-=e.h)},onMove:function(e,f){var g=this.constraintBox,l=e.node.style;this.onMoving(e,f);f.l=f.l<g.l?g.l:g.r<f.l?g.r:f.l;f.t=f.t<g.t?g.t:g.b<f.t?g.b:f.t;l.left=
f.l+"px";l.top=f.t+"px";this.onMoved(e,f)}});e=t("dojo.dnd.move.boxConstrainedMoveable",q,{box:{},constructor:function(e,f){var g=f&&f.box;this.constraints=function(){return g}}});t=t("dojo.dnd.move.parentConstrainedMoveable",q,{area:"content",constructor:function(e,l){var g=l&&l.area;this.constraints=function(){var e=this.node.parentNode,d=k.getComputedStyle(e),c=f.getMarginBox(e,d);if("margin"==g)return c;var n=f.getMarginExtents(e,d);c.l+=n.l;c.t+=n.t;c.w-=n.w;c.h-=n.h;if("border"==g)return c;
n=f.getBorderExtents(e,d);c.l+=n.l;c.t+=n.t;c.w-=n.w;c.h-=n.h;if("padding"==g)return c;n=f.getPadExtents(e,d);c.l+=n.l;c.t+=n.t;c.w-=n.w;c.h-=n.h;return c}}});return{constrainedMoveable:q,boxConstrainedMoveable:e,parentConstrainedMoveable:t}})},"jimu/DataSourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Evented dojo/when ./utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/portalUrlUtils jimu/filterUtils esri/tasks/query esri/tasks/QueryTask esri/tasks/StatisticDefinition ./Query".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){var a=null,u=t(e,{constructor:function(){this._listeners=[];this._refreshTimers=[];this._dataStore={};this._jimuQueryObject={};this._dataSourceUsage={};this._itemsFilter={};this.filterUtils=new d;window.isBuilder?(q.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),q.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(q.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),q.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?
(q.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),q.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(q.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),q.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));q.subscribe("updateDataSourceData",f.hitch(this,this._onUpdataDataSourceData));window.isBuilder&&q.subscribe("app/dataSourceDataUpdated",f.hitch(this,this._onDataSourceDataUpdatedInApp))},getData:function(a){return this._dataStore[a]},
getDataSourceConfig:function(a){return this.appConfig.dataSource.dataSources[a]},parseDataSourceId:function(a){var b=a.split("~"),c={};if(2>b.length)return console.error("Bad data source id:",a),c;switch(b[0]){case "map":return b=a.lastIndexOf("~"),c={from:"map",layerId:a.substring(4,b)};case "widget":return c={from:"widget",widgetId:b[1]};case "external":return c={from:"external"};default:console.error("Bad data source id:",a)}},addDataSourceUsage:function(a,b){this._dataSourceUsage[a]?(0>this._dataSourceUsage[a].indexOf(b)&&
this._dataSourceUsage[a].push(b),1===this._dataSourceUsage[a].length&&this._startOneDataSource(this.appConfig.dataSource.dataSources[a])):(this._dataSourceUsage[a]=[b],this._startOneDataSource(this.appConfig.dataSource.dataSources[a]))},removeDataSourceUsage:function(a,b){this._dataSourceUsage[a]&&0<=this._dataSourceUsage[a].indexOf(b)&&(this._dataSourceUsage[a]=k.filter(this._dataSourceUsage[a],function(a){return a!==b}))},_onUpdataDataSourceData:function(a,b){this.appConfig.dataSource.dataSources[a]?
"widget"!==this.parseDataSourceId(a).from?console.error("Please update data source from widget only.",a):this._updateDataSourceData(a,b):console.error("Not found data source id:",a)},_updateDataSourceData:function(a,b){this._dataStore[a]=b;q.publish("dataSourceDataUpdated",a,b);this.emit("update",a,b)},_onDataSourceDataUpdatedInApp:function(a,b){this._updateDataSourceData(a,b)},_onMapLoaded:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapLoaded")},
_onMapChanged:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapChanged")},_onAppConfigLoaded:function(a){this.appConfig=f.clone(a)},_onAppConfigChanged:function(a,b){a=f.clone(a);window.isBuilder||("dataSourceChange"===b?this._handleDataSourceConfigChange(this.appConfig,a,b):"mapChange"===b&&this._cleanForConfigChangedDataSource(this.appConfig,a));this.appConfig=a},_handleDataSourceConfigChange:function(a,b,c){a&&(this._removeListeners(),
this._removeTimers(),this._cleanForConfigChangedDataSource(a,b));k.forEach(Object.keys(b.dataSource.dataSources),function(a){b.dataSource.dataSources[a].idObj=this.parseDataSourceId(a)},this);this._listenDataSourceChange(b.dataSource.dataSources);this._startRefreshTimer(b.dataSource,c);this._initStaticDataSource(b.dataSource)},_cleanForConfigChangedDataSource:function(a,b){var c=a.dataSource.dataSources,d=b.dataSource.dataSources;k.forEach(Object.keys(c),function(a){if(!d[a]||d[a]&&!m.isEqual(d[a],
c[a]))delete this._jimuQueryObject[a],this._updateDataSourceData(a,{features:[]}),delete this._dataStore[a]},this)},_isGlobalRefresh:function(a){return a.unifiedRefreshInterval&&0<a.unifiedRefreshInterval},_startOneDataSource:function(a){var b;b=this._isGlobalRefresh(this.appConfig.dataSource.settings)?this.appConfig.dataSource.settings.unifiedRefreshInterval:a.refreshInterval;if("map"===a.idObj.from)this._listenMapDataSourceChange(a);else if("external"===a.idObj.from&&a.filterByExtent){var c={};
c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c)}if("map"===a.idObj.from||"external"===a.idObj.from)this._refeshDataSource(a),a.isDynamic&&(c={},c.handle=setInterval(f.hitch(this,this._refeshDataSource,a),6E4*b),c.dsId=a.id,this._refreshTimers.push(c))},_stopAndCleanOneDataSource:function(a){this._listeners=k.filter(this._listeners,function(b){return b.dsId===a.id?(b.handle.remove(),!1):!0},this);this._refreshTimers=k.filter(this._refreshTimers,
function(b){return b.dsId===a.id?(clearInterval(b.handle),!1):!0},this);this._updateDataSourceData(a.id,{features:[]})},_listenDataSourceChange:function(a){k.forEach(Object.keys(a),function(b){b=a[b];if("map"===b.idObj.from)this._listenMapDataSourceChange(b);else if("external"===b.idObj.from&&b.filterByExtent){var c={};c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,b));c.dsId=b.id;this._listeners.push(c)}},this)},_listenMapDataSourceChange:function(a){this._getLayerObject(a.idObj.layerId).then(f.hitch(this,
function(b){if(b){var c={};c.handle=b.on("edits-complete",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c);c={};c.handle=this._getLayerInfo(a.idObj.layerId).on("filterChanged",f.hitch(this,this._onLayerDataChange,a));c.dsId=a.id;this._listeners.push(c);a.filterByExtent&&(c={},c.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a)),c.dsId=a.id,this._listeners.push(c))}else console.error("Can not find layer that data source depends on.",a.id)}))},_onLayerDataChange:function(a){this._doQueryForDataSource(a)},
_doQueryForDataSource:function(a){("config"===this.appConfig.mode||this._dataSourceUsage[a.id]&&0!==this._dataSourceUsage[a.id].length)&&this.doQuery(a).then(f.hitch(this,function(b){this._updateDataSourceData(a.id,{features:b.features})}))},_getLayerObject:function(a){return(a=l.getInstanceSync().getLayerOrTableInfoById(a))?a.getLayerObject():r(null)},_getLayerInfo:function(a){return l.getInstanceSync().getLayerOrTableInfoById(a)},_startRefreshTimer:function(a,b){var c=a.dataSources,d=a.settings;
k.forEach(Object.keys(c),function(h){h=c[h];if("widget"!==h.idObj.from&&h.isDynamic&&h.url){var n;n=this._isGlobalRefresh(d)?d.unifiedRefreshInterval:h.refreshInterval;"dataSourceChange"===b?"external"!==h.idObj.from&&"map"!==h.idObj.from||this._refeshDataSource(h):"external"===h.idObj.from&&this._refeshDataSource(h);h={handle:setInterval(f.hitch(this,this._refeshDataSource,h),6E4*n),dsId:a.id};this._refreshTimers.push(h)}},this)},_initStaticDataSource:function(a){k.forEach(Object.keys(a.dataSources),
function(b){b=a.dataSources[b];"widget"!==b.idObj.from&&!b.isDynamic&&b.url&&this._doQueryForDataSource(b)},this)},_refeshDataSource:function(a){this._doQueryForDataSource(a)},_getDataSourceFilter:function(a){if("map"===a.idObj.from){var b=l.getInstanceSync().getLayerOrTableInfoById(a.idObj.layerId),c;b&&(c=b.getFilter());var b=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1",d;d=c?"("+c+") and ("+b+")":b;return r(d)}return"external"===a.idObj.from?a.portalUrl&&a.itemId?this._getFilterFromItem(a.portalUrl,
a.itemId,a.url).then(f.hitch(this,function(b){var c=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1";return d=b?"("+b+") and ("+c+")":c})):r(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1"):r(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1")},_getFilterExpr:function(a,b){return this.filterUtils.hasVirtualDate(a)?(this.filterUtils.isHosted=m.isHostedService(b),this.filterUtils.getExprByFilterObj(a)):a.expr},_getFilterFromItem:function(a,b,c){var d=p.getItemUrl(a,b);if(this._itemsFilter[d])return r(this._itemsFilter[d]);
var h=g.getPortal(a);return h.getItemById(b).then(f.hitch(this,function(a){return"Feature Service"!==a.type?this._itemsFilter[d]=null:h.getItemData(b).then(f.hitch(this,function(a){var b=c.split("/"),h=b.pop();h||(h=b.pop());if(!a.layers)return this._itemsFilter[d]=null;a=a.layers.filter(function(a){return a.id+""===h})[0];return a&&a.layerDefinition?this._itemsFilter[d]=a.layerDefinition.definitionExpression:this._itemsFilter[d]=null}))}))},doQuery:function(a){a.idObj||(a.idObj=this.parseDataSourceId(a.id));
this.emit("begin-update",a.id);return this._getQueryObjectFromDataSource(a).then(f.hitch(this,function(d){var g,e;if("Features"===a.type){if("serviceLimitation"===a.resultRecordType)return g=d,e=new n(a.url),e.execute(g);var u=this._jimuQueryObject[a.id];!u||u.url===a.url&&m.isEqual(u.query.toJson(),d.toJson())||(delete this._jimuQueryObject[a.id],u=null);u||(u={},u.url=a.url,u.query=d,"all"!==a.resultRecordType&&(u.pageSize=a.resultRecordCount),u=new h(u),this._jimuQueryObject[a.id]=u);return"all"===
a.resultRecordType?u.getAllFeatures():u.queryByPage(1)}e=new n(a.url);g=new c;return this._getDataSourceFilter(a).then(f.hitch(this,function(c){g.where=c;a.filterByExtent&&(g.geometry=this.map.extent);a.dataSchema.groupByFields&&0<a.dataSchema.groupByFields.length&&(g.groupByFieldsForStatistics=a.dataSchema.groupByFields);a.dataSchema.orderByFields&&0<a.dataSchema.orderByFields.length&&(g.orderByFields=a.dataSchema.orderByFields);g.outStatistics=a.dataSchema.statistics.map(function(a){var c=a.onStatisticField+
"_"+a.statisticType;"count"===a.statisticType&&(c="STAT_COUNT");var c=m.upperCaseString(c),d=new b;d.statisticType=a.statisticType;d.onStatisticField=a.onStatisticField;d.outStatisticFieldName=c;return d});return e.execute(g)}))}))},_getQueryObjectFromDataSource:function(a){return this._getDataSourceFilter(a).then(f.hitch(this,function(b){var d=new c;d.where=b;a.filterByExtent&&(d.geometry=this.map.extent);d.outFields=a.dataSchema.fields.map(function(a){return a.name});a.dataSchema.orderByFields&&
0<a.dataSchema.orderByFields.length&&(d.orderByFields=a.dataSchema.orderByFields);d.returnGeometry=!0;d.outSpatialReference=this.map.spatialReference;return r(d)}))},_removeListeners:function(){this._listeners.forEach(f.hitch(this,function(a){a.handle.remove()}));this._listeners=[]},_removeTimers:function(){this._refreshTimers.forEach(f.hitch(this,function(a){clearInterval(a.handle)}));this._refreshTimers=[]}});u.getInstance=function(){null===a&&(a=new u,window._datasourceManager=a);return a};return u})},
"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory libs/crc".split(" "),function(t,f,k,q,e,r,m,l,g,p){var d=t([m],{declaredClass:"jimu.LayerInfos",map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_basemapLayerInfos:null,_finalBasemapLayerInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,_objectId:null,_layerInfoFactory:null,
constructor:function(b,c){this._objectId=Math.random();this._unreachableLayersTitleOfWebmap=[];this._basemapLayers=c.baseMap.baseMapLayers;this._operLayers=c.operationalLayers;this._tables=c.tables;this._layerInfoFactory=new g(b,this);this.map=b;this._initLayerInfos();this._initBasemapLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._finalLayerInfos);this._clearAddedFlag(this._finalBasemapLayerInfos);this._initFinalLayerInfos();
this._initFinalBasemapLayerInfos();this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var b=[];f.forEach(this.getLayerInfoArray(),function(c){for(var a=0;a<this._operLayers.length;a++)if(c.id===this._operLayers[a].id){b.push(c);break}a===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(c.id)&&b.push(c)},this);return b},getTableInfoArrayOfWebmap:function(){var b=[];f.forEach(this.getTableInfoArray(),function(c){for(var a=0;a<this._tables.length;a++)if(c.id===
this._tables[a].id){b.push(c);break}},this);return b},getLayerInfoArray:function(){return f.filter(this._finalLayerInfos,function(b){k.getObject("_wabProperties.isTemporaryLayer",!1,b.layerObject)&&(b._flag._isTemporaryLayerInfo=!0);return!b._flag._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._tableInfos},getBasemapLayerInfoArray:function(){return this._finalBasemapLayerInfos},addFeatureCollection:function(b,c){var a=this._getUniqueTopLayerInfoId(c),d={layers:[]};f.forEach(b,function(b,
c){b.id=a+"_"+c;d.layers.push({id:b.id,layerObject:b})},this);this.map.addLayers(b);var h;try{h=this._layerInfoFactory.create({featureCollection:d,title:c||a,id:a},this.map),h.init()}catch(x){console.warn(x.message),h=null}h&&(h._extraOfWebmapLayerInfo=!0,this._layerInfos.push(h),this.update(),this._onLayersUpdated(h,h.getRootLayerInfo()))},addTable:function(b){b=this._addTables([b],this._tableInfos);return b[0]?b[0]:null},removeTable:function(b){var c=-1;f.forEach(this._tableInfos,function(a,d){b.id===
a.id&&(c=d)});if(0<=c){var a=this._tableInfos[c];this._tableInfos.splice(c,1);a.destroy();this._onTableChange([b],d.REMOVED)}},_addTables:function(b,c){var a=[],h=[];f.forEach(b,function(b){var d;try{b.layerObject={url:b.url,featureCollectionData:b.featureCollectionData,empty:!0},b.id=this._getUniqueTableId(b.id),b.selfType="table",d=this._layerInfoFactory.create(b),d.init()}catch(z){console.warn(z.message),d=null}d&&(a.push(d),c.push(d),h.push(d.getLayerObject()))},this);l(h).then(k.hitch(this,function(b){var c=
[];f.forEach(b,function(b,d){d=a[d];b?c.push(d):(this.removeTable(d),d.destroy())},this);this._onTableChange(c,d.ADDED)}));return a},_getUniqueTableId:function(b){var c=this._tableInfos.concat(this._tableInfos||[]);return this._getUniqueLayerOrTableId(b,c)},_getUniqueTopLayerInfoId:function(b){return this._getUniqueLayerOrTableId(b,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(b,c){var a=1,d;b||(b="table");for(d=b;;){for(var h=0;h<c.length&&c[h].id!==d;h++);if(h===c.length)return d;d=
b+"_"+a.toString();a++}},_traversal:function(b,c){for(var a=0;a<c.length;a++)if(c[a].traversal(b))return!0;return!1},traversal:function(b){var c=this.getLayerInfoArray();return this._traversal(b,c)},traversalLayerInfosOfWebmap:function(b){var c=this.getLayerInfoArrayOfWebmap();return this._traversal(b,c)},traversalAll:function(b){var c=this.getLayerInfoArray(),a=this.getBasemapLayerInfoArray(),d=this.getTableInfoArray(),c=c.concat(a.concat(d));return this._traversal(b,c)},_traversalAllWithSpecialLayerInfo:function(b){return this._traversal(b,
this._finalLayerInfos.concat(this._tableInfos))},getLayerInfoById:function(b){return this._findLayerInfoById(b)},getTableInfoById:function(b){var c=null;f.some(this.getTableInfoArray(),function(a){if(a.id===b)return c=a,!0});return c},getLayerOrTableInfoById:function(b){var c=null;this.traversalAll(function(a){if(a.id===b)return c=a,!0});return c},getLayerInfoByTopLayerId:function(b){return this._findTopLayerInfoById(b)},moveUpLayer:function(b,c){var a=null;c=c?c:1;b=this._getTopLayerInfoIndexById(b.id);
0<=b-c&&(a=this._finalLayerInfos[b-c].obtainLayerIndexesInMap().length,this._finalLayerInfos[b].moveRightOfIndex(this._finalLayerInfos[b-c].obtainLayerIndexesInMap()[a-1].index),a=this._finalLayerInfos[b-c],r.publish("layerInfos/layerReorder",b,c,"moveup"));return a},_reorderLayerInfosArray:function(b,c,a){"moveup"===a?(a=this._finalLayerInfos[b],this._finalLayerInfos.splice(b,1),this._finalLayerInfos.splice(b-c,0,a)):(a=this._finalLayerInfos[b],this._finalLayerInfos.splice(b+c+1,0,a),this._finalLayerInfos.splice(b,
1));this._markFirstOrLastNode();return a},moveDownLayer:function(b,c){var a=null;c=c?c:1;b=this._getTopLayerInfoIndexById(b.id);b+c<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[b].moveLeftOfIndex(this._finalLayerInfos[b+c].obtainLayerIndexesInMap()[0].index),a=this._finalLayerInfos[b+c],r.publish("layerInfos/layerReorder",b,c,"movedown"));return a},getBasemapLayers:function(){var b=[];f.forEach(this.map.layerIds.concat(this.map.graphicsLayerIds||[]),function(c){c=this.map.getLayer(c);"basemap"!==
c._basemapGalleryLayerType&&"reference"!==c._basemapGalleryLayerType||b.push(c)},this);return b.reverse()},getMapNotesLayerInfoArray:function(){return f.filter(this.getLayerInfoArray(),function(b){return b.isMapNotesLayerInfo()},this)},restoreState:function(b){var c=b&&b.layerOptions?b.layerOptions:null;f.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(c)},this)},_getEncodedLayerIdsOfCurrentMap:function(){this._encodedLayerIds||(this._encodedLayerIds={encodedToLayerIds:{},layerIdsToEncoded:{}},
this.traversal(k.hitch(this,function(b){var c=this._encodeLayerId(b.id);this._encodedLayerIds.encodedToLayerIds[c]=b.id;this._encodedLayerIds.layerIdsToEncoded[b.id]=c})));return this._encodedLayerIds},_getShowOrHideLayerIdsBySimpleState:function(b){var c=[],a=[],d={showLayerIds:null,hideLayerIds:null},n=this._getEncodedLayerIdsOfCurrentMap().encodedToLayerIds;b&&b.showLayersEncoded&&n?(f.forEach(b.showLayersEncoded,function(a){(a=n[a])&&c.push(a)}),d.showLayerIds=c):b&&b.showLayers?d.showLayerIds=
b.showLayers:b&&b.hideLayersEncoded&&n?(f.forEach(b.hideLayersEncoded,function(b){(b=n[b])&&a.push(b)}),d.hideLayerIds=a):b&&b.hideLayers&&(d.hideLayerIds=b.hideLayers);return d},setSimplificationState:function(b){var c={layerOptions:{}},a=this._getShowOrHideLayerIdsBySimpleState(b);this.traversal(k.hitch(this,function(b){c.layerOptions[b.id]={};var d,h,n=null;a.showLayerIds?(d=a.showLayerIds,h=!0):(d=a.hideLayerIds,h=!1);f.some(d,function(a){if(b.id===a)return n=b.id,!0;if(b.title.trim&&a.trim&&
b.title.trim()===a.trim())return n=b.id,!1});c.layerOptions[b.id].visible=h?null!==n?!0:!1:null===n?!0:!1}));this.restoreState(c)},getSimplificationState:function(){var b={showLayers:[],showLayersEncoded:[],hideLayers:[],hideLayersEncoded:[]};this.traversal(k.hitch(this,function(c){c.isVisible()?(b.showLayers.push(c.id),b.showLayersEncoded.push(this._encodeLayerId(c.id))):(b.hideLayers.push(c.id),b.hideLayersEncoded.push(this._encodeLayerId(c.id)))}));return b},_encodeLayerId:function(b){var c=p.crc24;
b=c(b);b=parseInt(b,16);return b=b.toString(36)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},getObjectId:function(){return this._objectId},_initLayerInfos:function(){this._layerInfos=[];this._initSpecifiedLayerInfos(this._operLayers,this._layerInfos)},_initBasemapLayerInfos:function(){this._basemapLayerInfos=[];this._initSpecifiedLayerInfos(this._basemapLayers,this._basemapLayerInfos)},_initSpecifiedLayerInfos:function(b,c){var a;f.forEach(b,function(b){try{a=
this._layerInfoFactory.create(b),a.init()}catch(v){console.warn(v.message),a=null,0<=v.message.indexOf("declaredClass")&&this._unreachableLayersTitleOfWebmap.push(b.title)}a&&c.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];f.forEach(this._finalLayerInfos||this._layerInfos,function(b,c){var a;if(b._needToRenew()){try{a=this._layerInfoFactory.create(b.originOperLayer),a.init()}catch(v){console.warn(v.message),a=null}a&&(b.destroy(),this._finalLayerInfos[c]=
a)}else if(b.originOperLayer.featureCollection){var d=[];f.forEach(b.getSubLayers(),function(a){d.push(a.id)});f.forEach(d,function(a){this.map.getLayer(a)||b.removeSubLayerById(a)},this);1===b.getSubLayers().length&&(c=b.getSubLayers()[0],this.map.getLayer(c.id).title=b.title,b.removeSubLayerById(c.id),this._removedLayerInfoIdsFromFeatureCollection.push(c.id),b.id+="_logically_removed")}},this)},_refineFinalLayerInfos:function(){this._finalLayerInfos&&(this._finalLayerInfos=f.filter(this._finalLayerInfos,
function(b){return!b._flag._invalid}))},_initFinalLayerInfos:function(){var b,c,a=this._finalLayerInfos||this._layerInfos;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-1;0<=b;b--)c=this.map.graphicsLayerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!0);for(b=this.map.layerIds.length-1;0<=b;b--)c=this.map.layerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!1);this._refineFinalLayerInfos()},
_initTablesInfos:function(){this._tableInfos=[];var b=this._tables&&this._tables.reverse();b&&this._addTables(b,this._tableInfos)},_initFinalBasemapLayerInfos:function(){var b=this._finalBasemapLayerInfos||this._basemapLayerInfos;this._finalBasemapLayerInfos=[];f.forEach(this.getBasemapLayers(),function(c){var a;f.some(b,function(b){if(b.id===c.id)return a=b,!0},this);this._addToFinalBasemapLayerInfos(a,c.id,!1)},this)},_isBasemap:function(b){for(var c=!1,a=this.getBasemapLayers(),d=0;d<a.length;d++)a[d].id===
b&&(c=!0);return c},_addToFinalBasemapLayerInfos:function(b,c,a){this._addToSpecifiedLayerInfos(b,c,a,this._finalBasemapLayerInfos)},_addToFinalLayerInfos:function(b,c,a){this._addToSpecifiedLayerInfos(b,c,a,this._finalLayerInfos)},_addToSpecifiedLayerInfos:function(b,c,a,d){var h;if(b)b._addedFlag||b.isGraphicLayer()!==a||(d.push(b),b._addedFlag=!0);else{b=this.map.getLayer(c);if("esri.layers.GraphicsLayer"!==b.declaredClass&&"esri.layers.LabelLayer"!==b.declaredClass){try{var n={layerObject:b,title:this._getLayerTitle(b),
id:b.id||" "};k.mixin(n,k.getObject("_wabProperties.originOperLayer",!1,b));h=this._layerInfoFactory.create(n,this.map);h.init()}catch(z){console.warn(z.message),h=null}h&&(k.getObject("_wabProperties.isTemporaryLayer",!1,b)&&(h._flag._isTemporaryLayerInfo=!0),d.push(h))}("esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===b.declaredClass)&&h&&h._getServiceDefinition().then(k.hitch(this,function(a){var b=[];f.forEach(a.tables,function(a){a.url=
h.getUrl()+"/"+a.id;a.id=h.id+"_"+a.id;a.title=this._getLayerTitle(a);b.push(a)},this);this._addTables(b,this._tableInfos)}))}},_getLayerTitle:function(b){if(b.title)return b.title;if(k.getObject("_wabProperties.originalLayerName",!1,b))return b.name||b.id;var c=b.label||b.name||"";if(b.url&&!k.getObject("_wabProperties.itemLayerInfo",!1,b)){var a;a=b.url.indexOf("/FeatureServer");-1===a&&(a=b.url.indexOf("/MapServer"));-1===a&&(a=b.url.indexOf("/service"));-1<a&&(a=b.url.substring(0,a),a=a.substring(a.lastIndexOf("/")+
1,a.length),c=c?a+" - "+c:a)}return c||b.id},_findLayerInfoByIdAndReturnTopLayer:function(b,c){var a,d=null;c||(c=this._finalLayerInfos);for(a=0;a<c.length;a++)if(d=c[a].findLayerInfoById(b)){d=c[a];break}return d},_findLayerInfoById:function(b,c){var a,d=null;c||(c=this._finalLayerInfos);for(a=0;a<c.length&&!(d=c[a].findLayerInfoById(b));a++);return d},_findTopLayerInfoById:function(b){var c,a=null,d=[].concat(this._finalLayerInfos||[],this._tableInfos||[]);for(c=0;c<d.length;c++)if(d[c].id===b){a=
d[c];break}return a},_getTopLayerInfoIndexById:function(b){var c,a=-1;for(c=0;c<this._finalLayerInfos.length;c++)if(this._finalLayerInfos[c].id===b){a=c;break}return a},_clearAddedFlag:function(b){f.forEach(b,function(b){b._addedFlag=!1})},_markFirstOrLastNode:function(){var b;if(this._finalLayerInfos.length){for(b=0;b<this._finalLayerInfos.length;b++)this._finalLayerInfos[b].isFirst=!1,this._finalLayerInfos[b].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-
1].isLast=!0;for(b=0;b<this._finalLayerInfos.length;b++)if(!this._finalLayerInfos[b].isGraphicLayer()){b&&(this._finalLayerInfos[b-1].isLast=!0);this._finalLayerInfos[b].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(b,c,a){"BasemapGallery"===b&&(this._basemapLayers.length=0,f.forEach(a,k.hitch(this,function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(b){var c;for(c=this._basemapLayers.length=0;c<
b.layers.length;c++)this._basemapLayers.push({layerObject:b.layer[c],id:b.layers[c].id})},_destroyLayerInfos:function(){f.forEach(this._finalLayerInfos,k.hitch(this,function(b){b.destroy()}))},_bindEvents:function(){var b,c,a,n,g,f,l,p,m,q,w;b=e(this.map,"layer-add-result",k.hitch(this,this._onLayersChange,d.ADDED));c=e(this.map,"layer-remove",k.hitch(this,this._onLayersChange,d.REMOVED));l=r.subscribe("layerInfos/layerReorder",k.hitch(this,this._onLayerReorder));n=r.subscribe("layerInfos/layerInfo/isShowInMapChanged",
k.hitch(this,this._onShowInMapChanged));g=r.subscribe("layerInfos/layerInfo/visibleChanged",k.hitch(this,this._onVisibleChanged));f=r.subscribe("layerInfos/layerInfo/filterChanged",k.hitch(this,this._onFilterChanged));p=r.subscribe("layerInfos/layerInfo/rendererChanged",k.hitch(this,this._onRendererChanged));m=r.subscribe("layerInfos/layerInfo/opacityChanged",k.hitch(this,this._onOpacityChanged));w=r.subscribe("layerInfos/layerInfo/scaleRangeChanged",k.hitch(this,this._onScaleRangeChanged));q=r.subscribe("layerInfos/layerInfo/timeExtentChanged",
k.hitch(this,this._onTimeExtentChanged));a=e(this.map,"before-unload",k.hitch(this,function(){b.remove();c.remove();l.remove();n.remove();g.remove();f.remove();p.remove();a.remove();m.remove();w.remove();q.remove();this._destroyLayerInfos()}))},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(b){console.warn(b)}},_emitEventForEveryLayerInfo:function(b,c,a){try{f.forEach(c,function(c){c.emitEvent(b,a)},this)}catch(u){console.warn(u)}},_onLayersChange:function(b,c){var a=null,h;c.error||
"esri.layers.GraphicsLayer"===c.layer.declaredClass||"esri.layers.LabelLayer"===c.layer.declaredClass||(b===d.ADDED?(this.update(),a=b=this._findLayerInfoById(c.layer.id,c.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),h=d.ADDED,b&&!b.isRootLayer()&&(a=b.getRootLayerInfo(),h=d.SUBLAYER_ADDED)):(a=b=this._findLayerInfoById(c.layer.id,c.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),h=d.REMOVED,b&&!b.isRootLayer()&&(a=b.getRootLayerInfo(),
h=d.SUBLAYER_REMOVED),b&&b.destroy(),this.update()),a&&(c.layer._basemapGalleryLayerType?(this._emitEvent("basemapLayersChanged"),this._emitEvent("basemapLayerInfosChanged",a,h,b)):this._emitEvent("layerInfosChanged",a,h,b)))},_onTableChange:function(b,c){this._emitEvent("tableInfosChanged",b,c,b)},_onLayersUpdated:function(b,c){b.isTable?this._emitEvent("tableInfosChanged",[b],d.UPDATED,[c]):this._emitEvent("layerInfosChanged",b,d.UPDATED,c)},_onShowInMapChanged:function(b){this._emitEvent("layerInfosIsShowInMapChanged",
b);this._emitEventForEveryLayerInfo("isShowInMapChanged",b)},_onVisibleChanged:function(b){this._emitEvent("layerInfosIsVisibleChanged",b);this._emitEventForEveryLayerInfo("isVisibleChanged",b)},_onFilterChanged:function(b,c){this._emitEvent("layerInfosFilterChanged",b,c);this._emitEventForEveryLayerInfo("filterChanged",b,c)},_onLayerReorder:function(b,c,a){b=this._reorderLayerInfosArray(b,c,a);this._emitEvent("layerInfosReorder",b,d.REORDERED,b)},_onRendererChanged:function(b){this._emitEvent("layerInfosRendererChanged",
b);this._emitEventForEveryLayerInfo("rendererChanged",b)},_onOpacityChanged:function(b){this._emitEvent("layerInfosOpacityChanged",b);this._emitEventForEveryLayerInfo("opacityChanged",b)},_onScaleRangeChanged:function(b){this._emitEvent("layerInfosScaleRangeChanged",b);this._emitEventForEveryLayerInfo("scaleRangeChanged",b)},_onTimeExtentChanged:function(b){this._emitEvent("layerInfosTimeExtentChanged",b);this._emitEventForEveryLayerInfo("timeExtentChanged",b)}});d.getLayerInfoArrayByType=function(b,
c){var a=new q,h=[],n=[];d.getInstance(b,b.iteminfo).then(function(b){b.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;h.push(b)});l(h).then(function(b){f.forEach(b,function(a,b){c===a&&n.push(h[b].layerInfo)});a.resolve(n)})});return a};var c=null,n=null;d.getInstance=function(b,c){var a=new q;a.resolve(d.getInstanceSyncForInit(b,c));return a};d.getInstanceSyncForInit=function(b,h){c&&c!==b&&(n=c=null);n||(n=new d(b,h.itemData),c=b);return n};d.getInstanceSync=function(){return n};d.setInstance=
function(b,d){c=b;n=d};d.createInstance=function(b){var c=null;return c=new d(b,b.itemInfo.itemData)};k.mixin(d,{ADDED:"added",REMOVED:"removed",SUBLAYER_ADDED:"subLayerAdded",SUBLAYER_REMOVED:"subLayerRemoved",UPDATED:"updated",REORDERED:"reordered"});return d})},"jimu/LayerInfos/LayerInfoFactory":function(){define("dojo/_base/declare jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream jimu/LayerInfos/LayerInfoForDefaultKML".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){return t(null,{constructor:function(b,a){this.map=b;this.layerInfos=a},create:function(h){var a=null;if(h.featureCollection)a=new f(h,this.map,this,this.layerInfos);else if("esri.layers.KMLLayer"===h.layerObject.declaredClass)a=new q(h,this.map,this,this.layerInfos);else if("esri.layers.GeoRSSLayer"===h.layerObject.declaredClass)a=new e(h,this.map,this,this.layerInfos);else if("esri.layers.WMSLayer"!==h.layerObject.declaredClass||h.selfType)if("esri.layers.ArcGISDynamicMapServiceLayer"===
h.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===h.layerObject.declaredClass)a=new k(h,this.map,this,this.layerInfos);else if("esri.layers.ArcGISImageServiceLayer"===h.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===h.layerObject.declaredClass)a=new c(h,this.map,this,this.layerInfos);else if("esri.layers.StreamLayer"===h.layerObject.declaredClass)a=new n(h,this.map,this,this.layerInfos);else switch("Table"===h.layerObject.type&&(h.selfType="table"),
h.selfType){case "mapservice_dynamic_group":case "mapservice_dynamic":a=new l(h,this.map,this,this.layerInfos);break;case "mapservice_tiled_group":case "mapservice_tiled":a=new g(h,this.map,this,this.layerInfos);break;case "wms":a=new p(h,this.map,this,this.layerInfos);break;case "kml":a=new b(h,this.map,this,this.layerInfos);break;case "table":a=new d(h,this.map,this,this.layerInfos);break;default:a=new r(h,this.map,this,this.layerInfos)}else a=new m(h,this.map,this,this.layerInfos);return a}})})},
"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/promise/all esri/lang jimu/utils ./LayerInfo".split(" "),function(t,f,k,q,e,r,m){return t(m,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},_getExtent:function(){var e=null,g=[];f.forEach(this.getSubLayers(),function(e){g.push(e._getExtent())},this);return q(g).then(k.hitch(this,function(g){f.forEach(g,function(d){r.isValidExtent(d)&&
(e=e?e.union(d):d)},this);return e}))},_resetLayerObjectVisiblity:function(e){var g=e?e[this.id]:null;if(g){var f={},d;for(d in e)e.hasOwnProperty(d)&&"function"!==typeof e[d]&&(f[d]=e[d].visible);this._setSubLayerVisibleByCheckedInfo(f);this._setTopLayerVisible(g.visible)}},_setSubLayerVisibleByCheckedInfo:function(l){f.forEach(this.newSubLayers,function(g){e.isDefined(l[g.id])&&g.layerObject.setVisibility(l[g.id])},this)},_initVisible:function(){var e=!1,g;for(g=0;g<this.newSubLayers.length;g++)e=
e||this.newSubLayers[g].layerObject.visible;e&&(this._visible=!0)},_setTopLayerVisible:function(e){this._visible=e?!0:!1;f.forEach(this.newSubLayers,function(g){g.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var e=[];f.forEach(this.originOperLayer.featureCollection.layers,function(g){this._getLayerIndexesInMapByLayerId(g.layerObject.id)&&(k.setObject("_wabProperties.originOperLayer.showLegend",this.originOperLayer.featureCollection.showLegend,g.layerObject),
g=this._layerInfoFactory.create({layerObject:g.layerObject,title:g.layerObject.label||g.layerObject.title||g.layerObject.name||g.layerObject.id||" ",id:g.id||"-",subId:g.id||"-",collection:{layerInfo:this},selfType:"collection",showLegend:!0,parentLayerInfo:this}),e.push(g),g.init())},this);e.reverse();return e},_obtainLayerIndexesInMap:function(){var e=[],g,f;for(f=this.newSubLayers.length-1;0<=f;f--)(g=this._getLayerIndexesInMapByLayerId(this.newSubLayers[f].layerObject.id))&&e.push(g);return e},
moveLeftOfIndex:function(e){var g;for(g=0;g<this.newSubLayers.length;g++)this.map.reorderLayer(this.newSubLayers[g].layerObject,e)},moveRightOfIndex:function(e){var g;for(g=this.newSubLayers.length-1;0<=g;g--)this.map.reorderLayer(this.newSubLayers[g].layerObject,e)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getOpacity:function(){var e,g=0;for(e=0;e<this.newSubLayers.length;e++)if(this.newSubLayers[e].layerObject.opacity)g=
this.newSubLayers[e].layerObject.opacity>g?this.newSubLayers[e].layerObject.opacity:g;else return 1;return g},setOpacity:function(e){f.forEach(this.newSubLayers,function(g){g.layerObject.setOpacity&&g.layerObject.setOpacity(e)})},getScaleRange:function(){var e=this.getSubLayers();return e[0]?e[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect dojo/Evented dojo/request/script jimu/portalUrlUtils jimu/portalUtils jimu/LayerNode jimu/utils ./RequestBuffer esri/kernel esri/tasks/query esri/request".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v){var x=t([g],{declaredClass:"jimu.LayerInfo",originOperLayer:null,layerObject:null,map:null,title:null,id:null,subId:null,newSubLayers:null,parentLayerInfo:null,isTable:null,isTiled:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,_subLayerInfoIndex:null,_serviceDefinitionBuffer:null,_flag:null,_objectId:null,_itemInfo:null,_adaptor:null,constructor:function(a,b,c,d){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=
this.originOperLayer.title||this.originOperLayer.id||"";this.id=this.originOperLayer.id;this.subId=void 0!==this.originOperLayer.subId?this.originOperLayer.subId:this.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.isTiled=this.isTable=!1;this._eventHandles=[];this._layerInfoFactory=c;this._layerInfos=d;this._flag={};this._objectId=Math.random();this._adaptor=new n(this)},init:function(){this.newSubLayers=this.obtainNewSubLayers();this._initSubLayerInfoIndex();this._initVisible();
this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._initServiceDefinitionBuffer();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},_initServiceDefinitionBuffer:function(){this._serviceDefinitionBuffer=new h(k.hitch(this,this._serviceDefinitionRequest))},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},
getObjectId:function(){return this._objectId},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},moveLeftOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},moveRightOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},findLayerInfoById:function(a){var b=
null,c=0;if(this.id&&this.id===a)return this;for(c=0;c<this.newSubLayers.length&&!(b=this.newSubLayers[c].findLayerInfoById(a));c++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},_setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var b=a?a[this.id]:null;this.isRootLayer()&&b&&this._resetLayerObjectVisiblity(a)},_initVisible:function(){},
isVisible:function(){return this._visible?!0:!1},show:function(){this._setTopLayerVisible(!0)},hide:function(){this._setTopLayerVisible(!1)},_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===a)return{isGraphicLayer:!1,
index:b};return null},_isShowInMapChanged:function(){var a=!1,b=this.isShowInMap();!1===b&&this.map.infoWindow.hide();this._oldIsShowInMap!==b&&(this._oldIsShowInMap=b,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(b){b._isShowInMapChanged()&&a.push(b)});m.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){m.publish("layerInfos/layerInfo/visibleChanged",[this])},_initSubLayerInfoIndex:function(){var a={};this.isRootLayer()&&this.traversal(function(b){b.isRootLayer()||
(a[b.subId]=b)});this._subLayerInfoIndex=a},_getLayerInfosObj:function(){return this._layerInfos},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return r.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},
_needToRenew:function(){return!1},_getServiceDefinition:function(){var a=new q;a.resolve(null);return a},_serviceDefinitionRequest:function(a){return this._normalRequest(a,{f:"json"},"json")},getServiceDefinition:function(){return this._getServiceDefinition()},_normalRequest:function(a,b,c){return v({url:a,content:b,handleAs:c,callbackParamName:"callback"})},getLayerObject:function(){var a=new q;this.layerObject?a.resolve(this.layerObject):a.resolve(null);return a},getLayerObjectTryUsingFeatureService:function(){return this.getLayerObject()},
getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getLayerLevel:function(){for(var a=0,b=this;b.parentLayerInfo;)a++,b=b.parentLayerInfo;return a},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new q;this.layerObject.declaredClass&&
(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},getPopupInfoFromLayerObject:function(){var a=this.getInfoTemplate(),b=null;a&&(b=a.info);return b},loadPopupInfo:function(){var a=new q;this.loadInfoTemplate().then(k.hitch(this,function(b){var c=null;b&&(c=b.info);a.resolve(c)}));return a},loadInfoTemplate:function(){var a=new q;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?
this.originOperLayer.layerDefinition.definitionExpression:null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new q,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),d=this.getLayerObject();e({type:c,layerObject:d}).then(k.hitch(this,
function(c){var d=c.type;c=c.layerObject;b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=!0);if(!c)b.isSupportQuery=!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())b.isSupportQuery=!1;else if(!c.url||c.capabilities&&c.capabilities.indexOf&&0<=c.capabilities.indexOf("Query"))b.isSupportQuery=!0;a.resolve(b)}),function(){a.resolve(b)});return a},getRelatedTableInfoArray:function(a){a=new q;a.resolve([]);return a},getRelatedRecords:function(a,
b){a=new q;a.resolve([]);return a},removeSubLayerById:function(a){var b=[];f.forEach(this.newSubLayers,function(c){c.id!==a?b.push(c):c.destroy()});this.newSubLayers=b},releaseResource:function(){f.forEach(this._eventHandles,function(a){a.remove()});this.destroyLabelLayer();this._adaptor&&this._adaptor.destroy()},destroy:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.inherited(arguments)},update:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});
this.releaseResource();this.init()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},_getExtent:function(){var a=new q;a.resolve(this.layerObject.fullExtent||this.layerObject.initialExtent);return a},getExtent:function(){var a=new q;this._getExtent().then(k.hitch(this,function(c){b.projectToMapSpatialReference(this.map,c).then(k.hitch(this,function(b){a.resolve(b)}),
k.hitch(this,function(){a.resolve(null)}))}),k.hitch(this,function(){a.resolve(null)}));return a},_requerySelectdFeatures:function(){var a=new q;this.getLayerObject().then(k.hitch(this,function(b){var c=[],d;if(b&&b.isEditable&&!b.isEditable()){d=b.objectIdField;var c=b.getSelectedFeatures(),h=b.on("update-end",k.hitch(this,function(){var n=new u,g=[];f.forEach(c,function(a){g.push(a.attributes[d])},this);n.objectIds=g;n.maxAllowableOffset=0;b.queryFeatures(n,k.hitch(this,function(b){f.forEach(b.features,
function(a){f.some(c,function(b){return b.attributes[d]===a.attributes[d]?(b.setGeometry(a.geometry),!0):!1})},this);a.resolve()}),k.hitch(this,function(){a.resolve()}));h&&h.remove&&h.remove()}))}}));return a},zoomTo:function(a){this._requerySelectdFeatures();return a?b.projectToMapSpatialReference(this.map,a).then(k.hitch(this,function(a){return this._zoomTo(a)})):this.getExtent().then(k.hitch(this,function(a){return this._zoomTo(a)}))},_zoomTo:function(a){if(b.isValidExtent(a)){a=k.clone(a);var c=
this.getLayerScaleRange(),d=c.minScale,c=c.maxScale;if(a.isSinglePoint){if(d=b.getTargetScale(this.map,3,d,c))a=b.adjustHeightToAspectRatio(this.map,a),a=b.getExtentForScale(a,this.map.width,d),this.map.setExtent(a)}else{a=b.adjustExtentToAspectRatio(this.map,a);var h=b.getScaleForExtent(a,this.map.width);0<d&&h>d?(d=b.getScaleForNextTileLevel(this.map,d,!0),a=b.adjustHeightToAspectRatio(this.map,a),a=b.getExtentForScale(a,this.map.width,d),this.map.setExtent(a)):h<c?(c=b.getScaleForNextTileLevel(this.map,
c,!1),a=b.adjustHeightToAspectRatio(this.map,a),a=b.getExtentForScale(a,this.map.width,c),this.map.setExtent(a)):this.map.setExtent(a,!0)}}},mergeScale:function(a,b,c,d){var h=0,n=0;0===a&&0<c?h=c:0<a&&0===c?h=a:0<a&&0<c&&(h=Math.min(a,c));n=Math.max(b,d);return{minScale:h,maxScale:n}},unionScale:function(a,b,c,d){var h=0,n=0,h=0===a||0===c?0:Math.max(a,c),n=Math.min(b,d);return{minScale:h,maxScale:n}},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?
{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(a,b){this.layerObject&&this.layerObject.setScaleRange&&this.layerObject.setScaleRange(a,b)},getLayerScaleRange:function(){var a,b=this.getScaleRange();this.traversal(k.hitch(this,function(b){b.id!==this.id&&(b=b.getScaleRange(),a=a?this.unionScale(a.minScale,a.maxScale,b.minScale,b.maxScale):b)}));return a?this.mergeScale(b.minScale,b.maxScale,a.minScale,a.maxScale):b},isCurrentScaleInTheScaleRange:function(){var a=
this.getScaleRange(),b=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>=b)&&(0===a.maxScale||b>=a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,b=this;b&&(a=b.isCurrentScaleInTheScaleRange(),b=b.parentLayerInfo,a););return a},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},enablePopupNested:function(){this.isLeaf()?this.enablePopup():this.traversal(k.hitch(this,function(a){a.isLeaf()&&a.enablePopup()}))},isSupportPopup:function(){var a=
new q;a.resolve(!1);return a},disablePopupNested:function(){this.isLeaf()?this.disablePopup():this.traversal(k.hitch(this,function(a){a.isLeaf()&&a.disablePopup()}))},isPopupNestedEnabled:function(){var a=!1;this.isLeaf()?a=this.isPopupEnabled():this.traversal(k.hitch(this,function(b){return b.isLeaf()&&b.isPopupEnabled()?a=!0:!1}));return a},isSupportPopupNested:function(){var a=new q,b=[];this.traversal(function(a){a.isLeaf()&&b.push(a.isSupportPopup())});e(b).then(function(b){f.some(b,function(b){if(b)return a.resolve(!0),
!0;a.resolve(!1);return!1})});return a},getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this._getBasicItemInfo()},isPublicService:function(){var a=new q,b=this.getUrl();(b=b&&b+"?f\x3djson")?("https"===d.getProtocol(window.location.href)&&(b=d.setHttpsProtocol(b)),p.get(b,{jsonp:"callback"}).then(k.hitch(this,function(b){b&&b.error?a.resolve(!1):a.resolve(!0)}),k.hitch(this,function(){a.resolve(!1)}))):a.resolve(!0);return a},isEditable:function(){var b=
!1,d=!0,h=getAppConfig().portalUrl,h=c.getPortal(h),n=this.isPublicService(),g=new q,u=new q;h.getUser().then(k.hitch(this,function(a){u.resolve(a)}),k.hitch(this,function(){u.resolve(null)}));e({user:u,isPublicService:n}).then(k.hitch(this,function(c){var h=c.user&&c.user.privileges;c=c.isPublicService;h&&-1===f.indexOf(h,"features:user:edit")&&a.id&&!c&&(d=!1);b=this.layerObject&&this.layerObject.isEditable?this.layerObject.isEditable()&&d?!0:!1:!1;g.resolve(b)}),k.hitch(this,function(){g.resolve(!1)}));
return g},_getBasicItemInfo:function(){var a=null,b=this.getRootLayerInfo(),c=window.appConfig||window.getAppConfig(),h=k.getObject("_wabProperties.itemLayerInfo",!1,b.layerObject);b.originOperLayer.itemId?(a={},a.itemId=b.originOperLayer.itemId,a.portalUrl=d.getStandardPortalUrl(c.map.portalUrl||c.portalUrl)):h&&h.portalUrl&&h.itemId&&(a={},a.itemId=h.itemId,a.portalUrl=d.getStandardPortalUrl(h.portalUrl));return a},getItemInfo:function(){var a=new q,b=this.getRootLayerInfo();b.isItemLayer()?(b._itemInfo||
(b._itemInfo=new x.ItemInfo(this,b)),b._itemInfo.onLoad().then(k.hitch(this,function(){a.resolve(b._itemInfo)}),k.hitch(this,function(){a.resolve(null)}))):a.resolve(null);return a},isHostedService:function(){var a=new q;this._getServiceDefinition().then(k.hitch(this,function(b){a.resolve(b&&b.serviceItemId?!0:!1)}));return a},isHostedLayer:function(){var a;this.isItemLayer()?a=this.isHostedService():(a=new q,a.resolve(!1));return a},obtainLabelControl:function(){},restoreLabelControl:function(){},
destroyRealtedLabelLayer:function(){},destroyLabelLayer:function(){},canShowLabel:function(){},isShowLabels:function(){},showLabels:function(){},hideLabels:function(){},isBasemap:function(){return this.getRootLayerInfo().layerObject._basemapGalleryLayerType?!0:!1},emitEvent:function(){try{this.emit.apply(this,arguments),this._adaptor&&this._adaptor.emitEvent.apply(this._adaptor,arguments)}catch(z){console.error(z)}},_bindEvent:function(){var a;this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visibility-change",
k.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(a),a=l.after(this.layerObject,"setDefinitionExpression",k.hitch(this,this._onFilterChanged)),this._eventHandles.push(a),a=l.after(this.layerObject,"setRenderer",k.hitch(this,this._onRendererChanged)),this._eventHandles.push(a),this.isRootLayer()&&(a=this.layerObject.on("opacity-change",k.hitch(this,this._onOpacityChanged)),this._eventHandles.push(a)),a=this.layerObject.on("scale-range-change",k.hitch(this,this._onScaleRangeChanged)),
this._eventHandles.push(a),this.isRootLayer()&&(a=this.map.on("time-extent-change",k.hitch(this,function(){this.layerObject&&this.layerObject.useMapTime&&this._onTimeExtentChanged()})),this._eventHandles.push(a)),this.isRootLayer()&&(a=l.after(this.layerObject,"setTimeDefinition",k.hitch(this,function(){this.layerObject&&this.layerObject.timeInfo&&this.layerObject.mode===esri.layers.FeatureLayer.MODE_SNAPSHOT&&this._onTimeExtentChanged()})),this._eventHandles.push(a)))},_onVisibilityChanged:function(){this._initVisible();
this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=this._oldFilter?this._oldFilter:null,b=this.layerObject.getDefinitionExpression(),b=b?b:null;a!==b&&(m.publish("layerInfos/layerInfo/filterChanged",[this],k.getObject("_wabProperties.objectPassWithFilterChangeEvent",!0,this.layerObject)),this._oldFilter=b,k.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))},_onRendererChanged:function(){m.publish("layerInfos/layerInfo/rendererChanged",
[this])},_onOpacityChanged:function(){m.publish("layerInfos/layerInfo/opacityChanged",[this])},_onScaleRangeChanged:function(){m.publish("layerInfos/layerInfo/scaleRangeChanged",[this])},_onTimeExtentChanged:function(){var a=[],b=[];this.traversal(function(c){var d=c.getServiceDefinition().then(function(b){b&&b.timeInfo&&a.push(c)});b.push(d)});e(b).then(k.hitch(this,function(){m.publish("layerInfos/layerInfo/timeExtentChanged",a)}))}});x.ItemInfo=t(null,{_currentLayerInfo:null,_rootLayerInfo:null,
_portalUrl:null,_itemId:null,_item:null,_itemData:null,_serviceDefinition:null,_itemInfoLoadedDef:null,constructor:function(a,b){this._currentLayerInfo=a;this._rootLayerInfo=b;this._loadResource()},_loadResource:function(){this._itemInfoLoadedDef=new q;var a=this._rootLayerInfo.isItemLayer();if(a){this._portalUrl=a.portalUrl;this._itemId=a.itemId;var b=c.getPortal(this._portalUrl),a=b.getItemById(this._itemId),b=b.getItemData(this._itemId),d=this._currentLayerInfo._getServiceDefinition();e({item:a,
itemData:b,serviceDefinition:d}).then(k.hitch(this,function(a){this._item=a.item;this._itemData=a.itemData;this._serviceDefinition=a.serviceDefinition;this._itemInfoLoadedDef.resolve(this)}),k.hitch(this,function(a){a&&a.message&&console.log(a.message);this._itemInfoLoadedDef.reject()}))}else this._itemInfoLoadedDef.reject()},onLoad:function(){return this._itemInfoLoadedDef},getPortalUrl:function(){return this._portalUrl},getItemId:function(){return this._itemId},getItem:function(){return this._item},
getItemData:function(){return this._itemData},isHostedLayer:function(){return this._serviceDefinition&&this._serviceDefinition.serviceItemId?!0:!1}});return x})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json dojo/request/xhr esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils ./ServiceDefinitionManager".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){var h=t([],{declaredClass:"jimu.Portal",selfUrl:null,
user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=c.getStandardPortalUrl(a);this.selfUrl=c.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var a=this.selfUrl;this.isValidCredential()&&(a=-1<a.indexOf("?")?a+("\x26token\x3d"+this.credential.token):a+("?token\x3d"+this.credential.token));return b.getInstance().getServiceDefinition(a).then(f.hitch(this,function(a){var b=a.user;delete a.user;f.mixin(this,a);a.user=b;return a}))},_checkCredential:function(){var a=
n.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=n.getPortalCredential(this.portalUrl))},signIn:function(){var a=new e;this.updateCredential();this.isValidCredential()?setTimeout(f.hitch(this,function(){a.resolve(this.credential)}),0):a=n.signInPortal(this.portalUrl);return a},haveSignIn:function(){return n.userHaveSignInPortal(this.portalUrl)},
clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var a=new e;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(f.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(f.hitch(this,function(b){this.user=b;a.resolve(this.user)}),f.hitch(this,function(b){console.error(b);a.reject(b)})):n.getUserIdByToken(this.credential.token,
this.portalUrl).then(f.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(f.hitch(this,function(b){this.user=b;a.resolve(this.user)}),f.hitch(this,function(b){console.error(b);a.reject(b)}))}),f.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(f.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(a){this.updateCredential();var b=new e,d=c.getBaseSearchUrl(this.portalUrl),h={f:"json"};a&&(h=f.mixin(h,a));
this.isValidCredential()&&(h.token=this.credential.token);h.sortField||h.sortOrder||(h.sortField="title",h.sortOrder="asc");g({url:d,handleAs:"json",content:h,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=k.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}));b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getItemData:function(a){this.updateCredential();a={url:c.getItemDataUrl(this.portalUrl,
a),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return g(a)},_getItemById:function(a,b){a={url:c.getItemUrl(this.portalUrl,a),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};b&&(a.content.token=b);return g(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}))},getItemById:function(a,b){this.updateCredential();return this._getItemById(a).then(f.hitch(this,function(c){return b&&c.owner&&this.isValidCredential()&&
this.credential&&this.credential.userId===c.owner?this._getItemById(a,this.credential.token):c}))},getAppById:function(a){var b=new e;this.updateCredential();this.isValidCredential()?(a=c.getAppIdUrl(this.portalUrl,a),b=g({url:a,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(f.hitch(this,function(){b.reject("token is null.")}),0);return b},queryGroups:function(a){this.updateCredential();var b=new e,d=c.getBaseGroupUrl(this.portalUrl),h={f:"json"};a&&(h=f.mixin(h,a));
this.isValidCredential()&&(h.token=this.credential.token);g({url:d,handleAs:"json",content:h,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=k.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}));b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},registerApp:function(a,b,d){var h=new e;this.updateCredential();if(this.isValidCredential())var n=this.credential&&this.credential.token,
u=c.getOAuth2Url(this.portalUrl),h=g({url:u+"/registerApp",content:{itemId:a,appType:b,redirect_uris:m.stringify(d),token:n,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(f.hitch(this,function(){h.reject("token is null.")}),0);return h},createAndRegisterApp:function(a){var b=new e;this.updateCredential();this.isValidCredential()?this.getUser().then(f.hitch(this,function(c){c.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},
"").then(f.hitch(this,function(c){c.success?this.registerApp(c.id,"browser",a).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(f.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(b){this.updateCredential();var d=new e;b={url:c.getUserUrl(this.portalUrl,b),
content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential&&this.credential.token);g(b).then(f.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;this.user=new a(b);d.resolve(this.user)}),f.hitch(this,function(a){console.error(a);d.reject(a)}));return d},getHelpMap:function(){this.updateCredential();var a={url:c.getPortalHelpMapUrl(this.portalUrl),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};
return g(a)}}),a=t([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var a=n.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var a=new p({id:this.roleId?
this.roleId:this.role,role:this.role});this.privileges&&a.setPrivileges(this.privileges);return a.canCreateItem()},getGroups:function(){var a=[];this.groups&&(a=k.map(this.groups,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new u(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var a=
{url:c.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(a.content.token=this.credential.token);return g(a)},getTags:function(){this.updateCredential();var a={url:c.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(a.content.token=this.credential.token);return g(a)},addItem:function(a,b){this.updateCredential();var d=new e;if(this.isValidCredential()){var h=
{f:"json",token:this.credential.token};a&&(h=f.mixin(h,a));g({url:c.getAddItemUrl(this.portalUrl,this.username,b),handleAs:"json",callbackParamName:"callback",content:h},{usePost:!0}).then(f.hitch(this,function(a){d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)}))}else setTimeout(f.hitch(this,function(){d.reject("token is null.")}),0);return d},deleteItem:function(a){this.updateCredential();var b=new e;this.isValidCredential()?(a=c.getDeleteItemUrl(this.portalUrl,this.username,
a),b=g({url:a,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(f.hitch(this,function(){b.reject("token is null.")}),0);return b},getItemById:function(a,b){this.updateCredential();var d=new e;a={url:c.getUserItemsUrl(this.portalUrl,this.username,b)+"/"+a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};g(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new v(a);d.resolve(a)}),f.hitch(this,
function(a){console.error(a);d.reject(a)}));return d},shareItem:function(a,b,d){this.updateCredential();var h=new e;this.isValidCredential()?(b={url:c.shareItemUrl(this.portalUrl,this.username,b,d),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},a&&(b.content=f.mixin(b.content,a)),g(b,{usePost:!0}).then(f.hitch(this,function(a){h.resolve(a)}),f.hitch(this,function(a){console.error(a);h.reject(a)}))):setTimeout(f.hitch(this,function(){h.reject("token is null.")}),
0);return h},updateItem:function(a,b){this.updateCredential();var d=new e;this.isValidCredential()?this.portal.getItemById(a).then(f.hitch(this,function(h){var n={f:"json",token:this.credential.token};b&&(n=f.mixin(n,b));g({url:c.getUpdateItemUrl(this.portalUrl,h.owner,a,h.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:n},{usePost:!0}).then(f.hitch(this,function(a){d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)}))}),f.hitch(this,function(a){console.error(a);
d.reject(a)})):setTimeout(f.hitch(this,function(){d.reject("token is null.")}),0);return d},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role},getRegisteredAppInfo:function(a,b){var d=new e;this.updateCredential();b=c.getUserItemsUrl(this.portalUrl,this.username,b);return d=g({url:b+"/"+a+"/registeredAppInfo",
content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})},getRegisteredAppInfoWithXhr:function(a,b){var d=new e;this.updateCredential();b=c.getUserItemsUrl(this.portalUrl,this.username,b);return d=l(b+"/"+a+"/registeredAppInfo",{data:{token:this.credential.token,f:"json"},method:"POST",handleAs:"json"})}}),u=t([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var a=n.isValidCredential(this.credential);
a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),v=t([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&
f.mixin(this,a);this.itemUrl=c.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=c.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=c.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=
n.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var a={url:c.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};
this.isValidCredential()&&(a.content.token=this.credential.token);return g(a)}}),x={portals:[],webMapQueryStr:" "+d.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+d.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var b=0;b<this.portals.length;b++){var d=this.portals[b];if(c.isSamePortalUrl(a,d.portalUrl))return d.updateCredential(),d}return null},getPortal:function(a){if(!a||"string"!==typeof a||!f.trim(a))return null;a=c.getStandardPortalUrl(a);var b=this._findPortal(a);
b||(b=new h(a),b.credential=n.getPortalCredential(b.portalUrl),b.updateCredential(),this.portals.push(b));return b},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var b="english",c="",d=new e;this.getPortal(a).getUser().then(f.hitch(this,function(a){a&&a.units?b=a.units:
(c=q.locale,b=c.startWith("en")?"english":"metric");d.resolve(b)}),f.hitch(this,function(h){console.warn(h);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){var b=null;a&&a.units?b=a.units:(c=a&&a.culture||q.locale,b=c.startWith("en")?"english":"metric");d.resolve(b)}),f.hitch(this,function(a){console.warn(a);c=q.locale;b=c.startWith("en")?"english":"metric";d.resolve(b)}))}));return d.promise},_getPortalSelfGroup:function(a,b){var c=new e,d=this.getPortal(a);d||setTimeout(f.hitch(this,function(){c.reject()}),
0);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){d.queryGroups({f:"json",q:a[b]}).then(f.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=d.portalUrl,a.credential=d.credential,a.portal=d,a=new u(a),c.resolve(a)):c.reject("Can't find portal self group.")}),f.hitch(this,function(a){console.error(a);c.reject(a)}))}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=new e;this.getBasemapGalleryGroup(a).then(f.hitch(this,
function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(f.hitch(this,function(a){b.resolve(a)}),f.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(a){var b=c.getStandardPortalUrl(a);return this._searchWABDefaultWebScene(b).then(f.hitch(this,function(a){return a?a:this._createWABDefaultWebScene(b).then(f.hitch(this,function(a){return this.getPortal(b).getUser().then(f.hitch(this,
function(b){var c=!1;b&&b.privileges&&0<b.privileges.length&&(c=k.some(b.privileges,function(a){return 0<=a.indexOf("shareToPublic")}));return c?b.shareItem({everyone:!0},a).then(f.hitch(this,function(){return a}),f.hitch(this,function(){return a})):a}),f.hitch(this,function(b){console.error(b);return a}))}))}))},_searchWABDefaultWebScene:function(a){var b=new e;a=c.getStandardPortalUrl(a);a=this.getPortal(a);a.queryItems({q:'typekeywords:"WABDefaultWebScene" orgid:'+a.user.orgId+" access:public "+
this.webSceneQueryStr}).then(f.hitch(this,function(a){a&&a.results&&0<a.results.length?b.resolve(a.results[0].id):b.resolve(null)}),f.hitch(this,function(a){console.error("_searchWABDefaultWebScene error:",a);b.reject(a)}));return b},_createWABDefaultWebScene:function(a){var b=new e;a=c.getStandardPortalUrl(a);this.getPortal(a).getUser().then(f.hitch(this,function(a){var c={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:m.stringify({operationalLayers:[],
baseMap:{id:"basemap",title:"Topographic",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",id:"worldTopoBase",layerType:"ArcGISTiledMapServiceLayer",title:"Topo"}],elevationLayers:[{url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",id:"globalElevation",layerType:"ArcGISTiledElevationServiceLayer",title:"Elevation"}]},ground:{layers:[{url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",
id:"globalElevation",layerType:"ArcGISTiledElevationServiceLayer",title:"Elevation"}]},viewingMode:"global",spatialReference:{latestWkid:3857,wkid:102100},version:"1.16",authoringApp:"WebAppBuilder",authoringAppVersion:"2.13"}),snippet:""};a.addItem(c,"").then(f.hitch(this,function(a){a.success?b.resolve(a.id):(console.error("Can't create default web scene:",a),b.reject())}))}),f.hitch(this,function(a){console.error("Can't create default web scene");b.reject(a)}));return b},getDefaultWebMap:function(a){var b=
new e;this.getPortalSelfInfo(a).then(f.hitch(this,function(c){var d=c.defaultBasemap&&c.defaultBasemap.id;d?b.resolve(d):this._getDefaultWebMapByBasemapGallery(a,c).then(f.hitch(this,function(c){c?b.resolve(c):this._getMostNumViewsWebMap(a).then(f.hitch(this,function(a){a?b.resolve(a):b.reject()}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,
b){var c=new e,d=this.getPortal(a),h=b.defaultBasemap&&b.defaultBasemap.title;d.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(f.hitch(this,function(a){a=a.results;0<a.length?d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+h}).then(f.hitch(this,function(a){a=a.results;a=k.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),
d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+h}).then(f.hitch(this,function(a){a=a.results;a=k.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];d.getItemData(b.id).then(f.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?c.resolve(b.id):c.resolve(null)}),f.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),c.resolve(null)}),f.hitch(this,
function(a){console.error(a);c.reject(a)})))}),f.hitch(this,function(a){console.error(a);c.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),c.resolve(null))}),f.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getMostNumViewsWebMap:function(a){var b=new e;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,function(a){a=a.results;a=k.filter(a,
f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},comparePortalVersion:function(a,b){var c=a.split(".");a=parseInt(c[0],10);var c=1<c.length?parseInt(c[1],10):0,d=b.split(".");b=parseInt(d[0],10);d=1<d.length?parseInt(d[1],10):0;return a>b?1:a<b?-1:c>d?1:c<d?-1:0},getItemResources:function(a,b,d){d||(d=100);a=c.getStandardPortalUrl(a);
a=c.getItemResourceUrl(a,b);return g({url:a,content:{f:"json",num:d}}).then(function(a){if(a&&a.resources)return a.resources})},addResource:function(a,b,d,h,n){a=c.getStandardPortalUrl(a);var e=this.getPortal(a),f=new FormData;f.append("file",d,h);f.append("fileName",h);f.append("f","json");var u="";n?(f.append("resourcesPrefix",n),u=n+"/"+h):u=h;return e.getItemById(b,!0).then(function(d){d=c.getUserContentItemUrl(a,d.owner,b);return g({url:d+"/addResources",form:f}).then(function(b){var d="";b&&
b.success&&(d=c.getItemResourceUrl(a,"${itemId}",u));return d},function(a){console.error(a.message||a);return a})})},removeResources:function(a,b,d,h){var n={resource:h?h+"/"+d:d,f:"json"};a=c.getStandardPortalUrl(a);return this.getPortal(a).getItemById(b,!0).then(function(d){d=c.getUserContentItemUrl(a,d.owner,b);return g({url:d+"/removeResources",content:n},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}};r.subscribe("userSignOut",function(a){(a=x._findPortal(a))&&
a.clearCredentialAndUser()});return x})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(t,f,k,q,e){return t(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(e){e=e||{};this.id=e.id;this.baseRole=e.role;this.name=e.name;this.description=e.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,
deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,
designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(r){e.isDefined(r)&&r instanceof Array&&k.forEach(r,f.hitch(this,function(e){this._readPrivilege(e)}))},_readPrivilege:function(e){this._applyEffectToAction(!0,e)},_applyEffectToAction:function(e,f){switch(f){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=e;
break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=e;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=e;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=e;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=e;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=e;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=e;
break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=e;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=e;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=e;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=e;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=e;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=
e;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=e;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=e;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=e;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=e;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=e;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=
e;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=e;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=e;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=e;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=e;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=e;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=
e;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=e;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=e;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=e;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=e;break;case "features:user:edit":this.privilegeObj.features.user.edit=e;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=e;break;
case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=e;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=e;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=e;break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=e;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=e;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=
e;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=e;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=e;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=e;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=e;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=e}},_applyToAll:function(e){this.privilegeObj.portal.admin.inviteUsers=e;this.privilegeObj.portal.admin.disableUsers=
e;this.privilegeObj.portal.admin.viewUsers=e;this.privilegeObj.portal.admin.updateUsers=e;this.privilegeObj.portal.admin.deleteUsers=e;this.privilegeObj.portal.admin.changeUserRoles=e;this.privilegeObj.portal.admin.viewGroups=e;this.privilegeObj.portal.admin.updateGroups=e;this.privilegeObj.portal.admin.deleteGroups=e;this.privilegeObj.portal.admin.reassignGroups=e;this.privilegeObj.portal.admin.assignToGroups=e;this.privilegeObj.portal.admin.manageEnterpriseGroups=e;this.privilegeObj.portal.admin.viewItems=
e;this.privilegeObj.portal.admin.updateItems=e;this.privilegeObj.portal.admin.deleteItems=e;this.privilegeObj.portal.admin.reassignItems=e;this.privilegeObj.portal.admin.manageLicenses=e;this.privilegeObj.portal.publisher.publishFeatures=e;this.privilegeObj.portal.publisher.publishTiles=e;this.privilegeObj.portal.publisher.publishScenes=e;this.privilegeObj.portal.user.createGroup=e;this.privilegeObj.portal.user.joinGroup=e;this.privilegeObj.portal.user.joinNonOrgGroup=e;this.privilegeObj.portal.user.createItem=
e;this.privilegeObj.portal.user.shareToGroup=e;this.privilegeObj.portal.user.shareToOrg=e;this.privilegeObj.portal.user.shareToPublic=e;this.privilegeObj.portal.user.shareGroupToOrg=e;this.privilegeObj.portal.user.shareGroupToPublic=e;this.privilegeObj.features.user.edit=e;this.privilegeObj.opendata.user.openDataAdmin=e;this.privilegeObj.opendata.user.designateGroup=e;this.privilegeObj.premium.user.geocode=e;this.privilegeObj.premium.user.networkanalysis=e;this.privilegeObj.premium.user.spatialanalysis=
e;this.privilegeObj.premium.user.geoenrichment=e;this.privilegeObj.premium.user.demographics=e;this.privilegeObj.premium.user.elevation=e;this.privilegeObj.marketplace.admin.purchase=e;this.privilegeObj.marketplace.admin.manage=e;this.privilegeObj.marketplace.admin.startTrial=e},_buildPrivilegesArray:function(){var e=[];!0===this.privilegeObj.portal.admin.inviteUsers&&e.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&e.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&
e.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&e.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&e.push("portal:admin:deleteUsers");!0===this.privilegeObj.portal.admin.changeUserRoles&&e.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&e.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&e.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&
e.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&e.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&e.push("portal:admin:assignToGroups");!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&e.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&e.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&e.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&
e.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&e.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&e.push("portal:admin:manageLicenses");!0===this.privilegeObj.portal.publisher.publishFeatures&&e.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&e.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&e.push("portal:publisher:publishScenes");
!0===this.privilegeObj.portal.user.createGroup&&e.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&e.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&e.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&e.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&e.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&e.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&
e.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&e.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&e.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&e.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&e.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&e.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&
e.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&e.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&e.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&e.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&e.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&e.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&
e.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&e.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&e.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&e.push("marketplace:admin:startTrial");return e},isUser:function(){return e.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return e.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===
this.id)},isAdmin:function(){return e.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||e.isDefined(this.baseRole)&&("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||e.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||e.isDefined(this.baseRole)&&("org_admin"===this.baseRole||
"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&e.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},
canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},
canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},
canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},
canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},
canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},
canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(f){this.privileges=f;this._initPrivilegesObject();e.isDefined(f)&&this._readPrivileges(f)},stringify:function(){return q.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return q.stringify({id:this.id,
name:this.name,description:this.description})},stringifyPrivileges:function(){return q.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return q.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/ServiceDefinitionManager":function(){define(["dojo/_base/declare","esri/request"],function(t,f){var k=null,q=t(null,{cache:{},getServiceDefinition:function(e,r){r||(r="json");var m=this.cache[e];
0>=this._getDefStatus(m)&&(m=f({url:e,handleAs:r,content:{f:r},callbackParamName:"callback"}),this.cache[e]=m);return m},_getDefStatus:function(e){return e?e.isFulfilled()?e.isResolved()?2:-1:1:0}});q.getInstance=function(){k||(k=new q,window._serviceDefinitionManager=k);return k};return q})},"jimu/LayerNode":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/Evented"],function(t,f,k,q,e){var r=t([e],{declaredClass:"jimu.LayerNode",_layerInfo:null,map:null,
title:null,id:null,subId:null,layerObject:null,constructor:function(e){this._layerInfo=e;this.map=e.map;this.title=e.title;this.id=e.id;this.subId=e.subId},isLeaf:function(){return this._layerInfo.isLeaf()},isRoot:function(){return this._layerInfo.isRootLayer()},toggle:function(){this._layerInfo.setTopLayerVisible(!this.isToggledOn())},isToggledOn:function(){return this._layerInfo.isVisible()},show:function(){this._layerInfo.show()},hide:function(){this._layerInfo.hide()},isVisible:function(){return this._layerInfo.isShowInMap()},
traversal:function(e){return this._layerInfo.traversal(function(f){return e(f._adaptor)})},getNodeById:function(e){var f=null;if(e=this._layerInfo.findLayerInfoById(e))f=e._adaptor;return f},getExtent:function(){return this._layerInfo.getExtent()},getOpacity:function(){return this._layerInfo.getOpacity()},setOpacity:function(e){this._layerInfo.setOpacity(e)},getServiceDefinition:function(){return this._layerInfo.getServiceDefinition()},getLayerObject:function(){return this._layerInfo.getLayerObject()},
getRootNode:function(){return this._layerInfo.getRootLayerInfo()._adaptor},getParentNode:function(){var e=this._layerInfo.parentLayerInfo;return e?e._adaptor:null},getSubNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfo.getSubLayers())},getNodeLevel:function(){return this._layerInfo.getLayerLevel()},getLayerType:function(){return this._layerInfo.getLayerType()},getPopupInfoFromWebmap:function(){return this._layerInfo.getPopupInfo()},getPopupInfo:function(){return this._layerInfo.getPopupInfoFromLayerObject()},
loadPopupInfo:function(){return this._layerInfo.loadPopupInfo()},getInfoTemplate:function(){return this._layerInfo.getInfoTemplate()},loadInfoTemplate:function(){return this._layerInfo.loadInfoTemplate()},getFilterFromWebmap:function(){return this._layerInfo.getFilterOfWebmap()},getFilter:function(){return this._layerInfo.getFilter()},setFilter:function(e){this._layerInfo.setFilter(e)},isShowLegend:function(){return this.isShowLegendFromWebmap()},isShowLegendFromWebmap:function(){return this._layerInfo.getShowLegendOfWebmap()},
isToggledOnLegendFromWebMap:function(){return this._layerInfo._getShowLegendOfWebmap()},getUrl:function(){return this._layerInfo.getUrl()},getRelatedNodes:function(){var e=new q;this._layerInfo.getRelatedTableInfoArray().then(k.hitch(this,function(f){e.resolve(this._getNodesArrayFromInfosArray(f))}));return e},isVisibleAtMapScale:function(){return this._layerInfo.isInScale()},enablePopup:function(){return this._layerInfo.enablePopup()},disablePopup:function(){return this._layerInfo.disablePopup()},
isPopupEnabled:function(){return this._layerInfo.isPopupEnabled()},isItemLayer:function(){return this._layerInfo.isItemLayer()},getItemInfo:function(){return this._layerInfo.getItemInfo()},isHostedService:function(){return this._layerInfo.isHostedService()},isHostedLayer:function(){return this._layerInfo.isHostedLayer()},canShowLabel:function(){return this._layerInfo.canShowLabel()},isLabelVisble:function(){return this._layerInfo.isShowLabels()},showLabel:function(){this._layerInfo.showLabels()},
hideLabel:function(){this._layerInfo.hideLabels()},isTable:function(){return!!this._layerInfo.isTable},isTiled:function(){return!!this._layerInfo.isTiled},isBasemap:function(){return this._layerInfo.isBasemap()},isEditable:function(e){return this._layerInfo.isEditable(e)},zoomTo:function(e){return this._layerInfo.zoomTo(e)},emitEvent:function(e){try{var f=null;switch(e){case "isVisibleChanged":f=r.EVENT_TOOGLE_CHANGE;break;case "isShowInMapChanged":f=r.EVENT_VISIBILITY_CHANGE;break;case "filterChanged":f=
r.EVENT_FILTER_CHANGE;break;case "rendererChanged":f=r.EVENT_RENDERER_CHANGE;break;case "opacityChanged":f=r.EVENT_OPACITY_CHANGE;break;case "timeExtentChanged":f=r.EVENT_TIME_EXTENT_CHANGE}f&&this.emit(f)}catch(g){console.error(g)}},destroy:function(){this.inherited(arguments)},_getNodesArrayFromInfosArray:function(e){var l=[];f.forEach(e,function(g){l.push(g._adaptor)},this);return l}});k.mixin(r,{EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",
EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return r})},"jimu/LayerInfos/RequestBuffer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(t,f,k){var q=t(null,{_realRequest:null,_buffer:null,constructor:function(e){this._buffer={};this._realRequest=e?e:function(){return new k}},getRequest:function(e){this._buffer[e]||(this._buffer[e]=new q.RequestProxy(this._realRequest,e));return this._buffer[e]},
request:function(e){var f=Array.prototype.slice.apply(arguments);f.splice(0,1);var m=this.getRequest(e);return m.request.apply(m,f)},setResponse:function(e,f){this.getRequest(e).setResponse(f)},isResolved:function(e){return this.getRequest(e).isResolved()}});q.RequestProxy=t(null,{_key:null,_deferred:null,_realRequest:null,constructor:function(e,f){this._realRequest=e;this._key=f},request:function(){this._deferred||(this._deferred=new k,this._realRequest.apply(null,arguments).then(f.hitch(this,function(e){this._deferred.resolve(e)}),
f.hitch(this,function(e){e&&console.warn(e.message||e);e=this._deferred;this._deferred=null;e.resolve(null)})));return this._deferred},fakeRequest:function(){this._deferred||(this._deferred=new k);return this._deferred},setResponse:function(e,f){this._deferred||(this._deferred=new k);null===e||void 0===e?(this._deferred.resolve(null),f&&(this._deferred=null)):this._deferred.resolve(e)},isResolved:function(){return this._deferred&&this._deferred.isResolved()}});return q})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang".split(" "),
function(t,f,k,q,e,r,m,l,g,p){return t(l,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerVisible:null,constructor:function(){},init:function(){this._initJsapiLayerInfos();this._initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup();this.inherited(arguments);this._needToRefresh().then(k.hitch(this,function(d){d&&(this.update(),this._getLayerInfosObj()._onLayersUpdated(this,this))}))},_needToRefresh:function(){var d=new q;
this.layerObject.dynamicLayerInfos&&this.isRootLayer()&&this.isItemLayer()&&!this.originOperLayer.thematicGroup?this.getItemInfo().then(k.hitch(this,function(c){(c=(c=c.getItemData())&&c.thematicGroup)?(this.originOperLayer.thematicGroup=c,d.resolve(!0)):d.resolve(!1)})):d.resolve(!1);return d},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var d=f.filter(this.originOperLayer.layers,
function(c){return p.isDefined(c.id)&&p.isDefined(c.name)&&p.isDefined(c.minScale)&&p.isDefined(c.maxScale)&&p.isDefined(c.parentLayerId)&&p.isDefined(c.defaultVisibility)});this._jsapiLayerInfos=this.layerObject.dynamicLayerInfos?this.originOperLayer.thematicGroup&&this.originOperLayer.thematicGroup.layerIds&&0<=this.originOperLayer.thematicGroup.layerIds.length?f.filter(this.layerObject.dynamicLayerInfos,function(c){return-1<this.originOperLayer.thematicGroup.layerIds.indexOf(c.id)?!0:!1},this):
this.layerObject.dynamicLayerInfos:0<d.length?d:this.layerObject.layerInfos},_cloneInfoTemplates:function(d){var c={},n;for(n in d)if(d.hasOwnProperty(n)&&"function"!==typeof d[n]){var b=d[n];b.infoTemplate&&b.infoTemplate.toJson&&(c[n]={infoTemplate:new b.infoTemplate.constructor(b.infoTemplate.toJson()),layerUrl:b.layerUrl,resourceInfo:b.resourceInfo})}return c},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:this._cloneInfoTemplates(this.layerObject.infoTemplates)};
this.layerObject._infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);r.after(this.layerObject,"setInfoTemplates",k.hitch(this,function(){this.layerObject._infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.traversal(function(d){d._afterSetInfoTemplates&&d._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new q}},
_initSubLayerVisible:function(d){this._subLayerVisible={};for(var c=0;c<this._jsapiLayerInfos.length;c++)this._subLayerVisible[this._jsapiLayerInfos[c].id]=!1;d?f.forEach(d,function(c){this._subLayerVisible[c]=!0},this):this.originOperLayer.visibleLayers?f.forEach(this.originOperLayer.visibleLayers,function(c){this._subLayerVisible[c]=!0},this):f.forEach(this._jsapiLayerInfos,function(c){c.defaultVisibility&&(this._subLayerVisible[c.id]=!0)},this)},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},
_setTopLayerVisible:function(d){this.originOperLayer.layerObject.setVisibility(d);this._visible=d},_setSubLayerVisible:function(d){var c=[-1,-1,-1],n,b=[],h=f.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});f.forEach(h,function(a){if(!this._isGroupLayerBySubId(a)){var c=this._subLayerInfoIndex[a];c&&c._isAllSubLayerVisibleOnPath()&&b.push(a)}},this);var h=b,a;for(a in d)if(d.hasOwnProperty(a)&&"function"!==typeof d[a]){var g=Number(a);d[a]?(n=f.indexOf(h,g),0>n&&h.push(g)):
(n=f.indexOf(h,g),0<=n&&h.splice(n,1))}c=c.concat(h);this.originOperLayer.layerObject.setVisibleLayers(c)},_resetLayerObjectVisiblity:function(d){var c=d?d[this.id]:null,n=!1;if(d&&(c&&this.layerObject.setVisibility(c.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var c={},b;for(b in d)d.hasOwnProperty(b)&&"function"!==typeof d[b]&&(n=!0,c[b]=d[b].visible);n&&this._setSubLayerVisibleByCheckedInfo(c)}},_setSubLayerVisibleByCheckedInfo:function(d){var c=[];f.forEach(this._jsapiLayerInfos,
function(b){var h=this.id+"_"+b.id;p.isDefined(d[h])?d[h]&&c.push(b.id):this._subLayerVisible[b.id]&&c.push(b.id)},this);this._initSubLayerVisible(c);this.traversal(function(b){b._initVisible()});var n={};this.traversal(function(b){0===b.getSubLayers().length&&(n[b.originOperLayer.mapService.subId]=b._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(n)},_subLayerVisibleChanged:function(){var d=[];this.traversal(function(c){d.push(c)});m.publish("layerInfos/layerInfo/visibleChanged",d)},obtainNewSubLayers:function(){var d=
[],c=this.originOperLayer.layerObject,n=null,n="esri.layers.ArcGISDynamicMapServiceLayer"===c.declaredClass?"dynamic":"tiled";f.forEach(this._jsapiLayerInfos,function(b){var a=null,a=c.url+"/"+b.id,h=c.id+"_"+b.id;b.subLayerIds&&0<b.subLayerIds.length?(a={url:a,empty:!0},this._addNewSubLayer(d,a,h,b,n+"_group")):(a={url:a,empty:!0},this._addNewSubLayer(d,a,h,b,n))},this);var b=[];f.forEach(this._jsapiLayerInfos,function(b,a){b=b.parentLayerId;if(-1!==b){for(var c=null,h=0;h<d.length;h++)if(d[h].mapService.subId===
b){c=d[h];break}(b=c)&&b.subLayers.push(d[a])}},this);f.forEach(this._jsapiLayerInfos,function(c,a){-1===c.parentLayerId&&(c=this._layerInfoFactory.create(d[a]),b.push(c),c.init())},this);return b},_addNewSubLayer:function(d,c,n,b,h){var a=b.source&&b.source.mapLayerId;if(void 0===a||null===a)a=b.id;d.push({layerObject:c,title:b.name||b.id||" ",id:n||"-",subId:b.id,subLayers:[],mapService:{layerInfo:this,subId:b.id,mapServiceSubId:a},selfType:"mapservice_"+h,parentLayerInfo:this})},_handleErrorSubLayer:function(d,
c,n,b,h,a){d[c]={layerObject:null,title:a.name||a.id||" ",id:n||" ",subLayers:[],mapService:{layerInfo:this,subId:b}}},getLegendInfo:function(d){var c=new q;this._legendInfo?c.resolve(this._legendInfo):this._legendRequest(d).then(k.hitch(this,function(d){this._legendInfo=d.layers;c.resolve(this._legendInfo)}),function(){c.reject()});return c},_legendRequest:function(d){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(d)},_legendRequestServer:function(){var d=
this.layerObject.url+"/legend",c={f:"json"};this.layerObject._params.dynamicLayers&&(c.dynamicLayers=e.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));return g({url:d,content:c,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(d){return g({url:d+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(d){var c=[],n;f.forEach(d.dynamicLayerInfos||
d.layerInfos,function(b){n={id:b.id};n.source=b.source&&b.source.toJson();var h;d.layerDefinitions&&d.layerDefinitions[b.id]&&(h=d.layerDefinitions[b.id]);h&&(n.definitionExpression=h);var a;d.layerDrawingOptions&&d.layerDrawingOptions[b.id]&&(a=d.layerDrawingOptions[b.id]);a&&(n.drawingInfo=a.toJson());n.minScale=b.minScale||0;n.maxScale=b.maxScale||0;c.push(n)});return c},_getServiceDefinition:function(){var d=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(d)},
_getSubserviceDefinition:function(d){return 10.11<=this.layerObject.version?this._getAllLayerAndTable(d):this._getLayerAndTable(d)},_getAllLayerAndTable:function(d){var c=this.layerObject.url+"/layers",n=this._serviceDefinitionBuffer.getRequest("_all_layer_and_table_request");n.isResolved()||n.request(c).then(k.hitch(this,function(b){b||(b={layers:[]});this.traversal(k.hitch(this,function(c){if(!c.isRootLayer()){var a=c.originOperLayer.mapService.mapServiceSubId;c=this._serviceDefinitionBuffer.getRequest(a);
var d=null;f.some(b.layers,function(b){if(b.id===a)return d=b,!0},this);c.setResponse(d)}}))}));return this._serviceDefinitionBuffer.getRequest(d).fakeRequest()},_getLayerAndTable:function(d){var c=this.layerObject.url+"/"+d;return this._serviceDefinitionBuffer.getRequest(d).request(c)},_getSublayerSettingOfWebmap:function(d){var c=f.filter(this.originOperLayer.layers,function(c){return c.id===d});return 1===c.length?c[0]:null},_getSublayerShowLegendOfWebmap:function(d){return(d=this._getSublayerSettingOfWebmap(d))?
void 0!==d.showLegend?d.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(d){return null===this._getJsapiLayerInfoById(d)?!1:!0},_getJsapiLayerInfoById:function(d){for(var c=null,n=0;n<this._jsapiLayerInfos.length;n++)if(this._jsapiLayerInfos[n].id===d){c=this._jsapiLayerInfos[n];break}return c},_isGroupLayerBySubId:function(d){return(d=this._getJsapiLayerInfoById(d))&&d.subLayerIds&&0<d.subLayerIds.length?!0:!1},_bindEvent:function(){var d;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&
(d=this.layerObject.on("visible-layers-change",k.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(d),d=r.after(this.layerObject,"setLayerDefinitions",k.hitch(this,this._onFilterChanged)),this._eventHandles.push(d))},_onVisibleLayersChanged:function(d){var c=d.visibleLayers;if(-1===c[0]&&-1===c[1]&&-1===c[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{d=[];var n=[-1,-1,-1],c=this._converVisibleLayers(c);d=c.visibleLayersForUpdateSubLayerVisible;n=n.concat(c.visibleLayersForSetVisibleLayers);
this._initSubLayerVisible(d);this.traversal(function(b){b._initVisible()});this.layerObject.setVisibleLayers(n)}},_converVisibleLayers:function(d){var c={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};f.forEach(d,function(c){var b=this.findLayerInfoById(this.id+"_"+c);if(this._isGroupLayerBySubId(c))b.traversal(function(b){d.push(b.originOperLayer.mapService.subId)});else for(;b&&b.originOperLayer.mapService;)d.push(b.originOperLayer.mapService.subId),b=b.parentLayerInfo},
this);f.forEach(d,function(d){0<=d&&0>c.visibleLayersForUpdateSubLayerVisible.indexOf(d)&&c.visibleLayersForUpdateSubLayerVisible.push(d)},this);f.forEach(c.visibleLayersForUpdateSubLayerVisible,function(d){this._isGroupLayerBySubId(d)||c.visibleLayersForSetVisibleLayers.push(d)},this);return c},_onFilterChanged:function(){for(var d,c=[],n=this.layerObject.layerDefinitions,b=n.length>this._oldFilter.length?n.length:this._oldFilter.length,h=0;h<b;h++)(n[h]?n[h]:null)!==(this._oldFilter[h]?this._oldFilter[h]:
null)&&(d=this.findLayerInfoById(this.id+"_"+h))&&d.isLeaf()&&c.push(d);0<c.length&&(m.publish("layerInfos/layerInfo/filterChanged",c,k.getObject("_wabProperties.objectPassWithFilterChangeEvent",!0,this.layerObject)),this._oldFilter=n,k.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault jimu/utils dojo/Deferred esri/lang".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d){return t(m,{constructor:function(){},_getExtentAsync:function(){var c=this.layerObject.getLayers(),d=null,b=null;if(0<c.length&&"esri.layers.KMLLayer"===c[0].declaredClass){var h=[];this.traversal(k.hitch(this,function(a){a.id!==this.id&&"esri.layers.KMLLayer"===a.layerObject.declaredClass&&h.push(a)}));f.forEach(h,function(a){b=a._getExtentAsync();d=d?d.union(b):b},this)}else f.forEach(c,function(a){b=g.graphicsExtent(a.graphics);d=d?d.union(b):b},this);return d},
_getExtent:function(){var c=new p;c.resolve(this._getExtentAsync());return c},_resetLayerObjectVisiblity:function(c){var d=c?c[this.id]:null;if(d){var b={},h;for(h in c)c.hasOwnProperty(h)&&"function"!==typeof c[h]&&(b[h]=c[h].visible);this._setSubLayerVisibleByCheckedInfo(b);this._setTopLayerVisible(d.visible)}},_setSubLayerVisibleByCheckedInfo:function(c){this.traversal(k.hitch(this,function(n){d.isDefined(c[n.id])&&n._setTopLayerVisible(c[n.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},
_setTopLayerVisible:function(c){c?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var c=[];f.forEach(this._getOperLayerByParentFolderId(-1,this),function(d){d=this._layerInfoFactory.create(d);c.push(d);d.init()},this);return c},_getOperLayerByParentFolderId:function(c,d){var b=[],h=this.layerObject.getLayers()||[],a=f.filter(this.layerObject.folders||[],function(a){return a.parentFolderId===c?!0:!1}),n=[],n=0===a.length?f.filter(h,function(a){return this._flag.kmzSubLayersWereHandled?
!1:!0},this):a;f.forEach(n,function(a){var c;"esri.layers.KMLFolder"===a.declaredClass?c={layerObject:a,title:a.label||a.title||a.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(a),subId:a.id,kml:{layerInfo:this,currentFolder:a},selfType:"kml",parentLayerInfo:d}:"esri.layers.KMLLayer"===a.declaredClass?(c=k.getObject("linkInfo.name",!1,a),c={layerObject:a,title:a.label||a.title||c||a.name||a.id||" ",id:a.id||"-",subId:a.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",
parentLayerInfo:d},k.setObject("_wabProperties.kmllayerWasHandled",!0,a),this._flag.kmzSubLayersWereHandled=!0):(k.setObject("_wabProperties.kmllayerWasHandled",!0,a),k.setObject("_wabProperties.isTemporaryLayer",!0,a));c&&b.push(c)},this);return b},_getAllSubLayerObject:function(){var c=[];this.traversal(k.hitch(this,function(d){d.layerObject&&d.layerObject.getLayers&&(c=c.concat(d.layerObject.getLayers()))}));return c},_getSubLayerInfoIdForSubFolder:function(c){return this.id+"_folder_"+c.id},_needToRenew:function(){return f.some(this._getAllSubLayerObject(),
function(c){if(!k.getObject("_wabProperties.kmllayerWasHandled",!1,c))return!0},this)},_bindEvent:function(){var c;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(c=e.after(this.layerObject,"setFolderVisibility",k.hitch(this,this._onSubFolderVisibleChanged),!0),this._eventHandles.push(c))},_onSubFolderVisibleChanged:function(c){c=this._getSubLayerInfoIdForSubFolder(c);(c=this.findLayerInfoById(c))&&r.publish("layerInfos/layerInfo/visibleChanged",[c])}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend esri/graphic esri/geometry/Point esri/tasks/query esri/tasks/RelationshipQuery esri/tasks/QueryTask".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w){return t(r,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(B){console.warn(B.message)}},_updateLayerObjectName:function(){this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!k.getObject("_wabProperties.originalLayerName",!1,this.layerObject)&&(k.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),
this.layerObject.name=this.title,k.setObject("arcgisProps.title",this.title,this.layerObject))},_initToShowLabels:function(){var a=k.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);a&&!this.layerObject.empty&&n.getPortal(a.portalUrl).getItemData(a.itemId).then(k.hitch(this,function(a){var b;a&&a.layers&&(f.some(a.layers,function(a){return a.id===this.layerObject.layerId?(b=a,!0):!1},this),b&&b.showLabels&&((a=k.getObject("layerDefinition.drawingInfo.labelingInfo",!1,b))&&!this.layerObject.labelingInfo&&
this.layerObject.setLabelingInfo&&(a=f.map(a,function(a){return new u(a)},this),this.layerObject.setLabelingInfo(a)),this.showLabels()))}),k.hitch(this,function(a){a&&a.message&&console.log(a.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var b=[],c=this.getInfoTemplate();c&&c.info&&c.info.fieldInfos?
f.forEach(c.info.fieldInfos,function(a){a.visible&&b.push(a.fieldName)},this):b=["*"];a.outFields=b;return a},_getExtent:function(){var a=new q,c;c=this.layerObject.graphics&&0<this.layerObject.graphics.length?b.graphicsExtent(this.layerObject.graphics):this.layerObject.fullExtent||this.layerObject.initialExtent;this.layerObject.url?this.getServiceDefinition().then(k.hitch(this,function(d){var h=new w(this.layerObject.url),n=new C,g=this.getFilter();n.where=g?g:"1\x3d1";n.outSpatialReference=this.map.spatialReference;
n.returnGeometry=!0;d&&d.advancedQueryCapabilities&&d.advancedQueryCapabilities.supportsReturningQueryExtent?h.executeForExtent(n,k.hitch(this,function(c){var d=c.extent;1===c.count&&"esriGeometryPoint"===this.layerObject.geometryType&&(c=new E(c.extent.xmin,c.extent.ymin,c.extent.spatialReference),d=b.graphicsExtent([new z(c)]));a.resolve(d)}),k.hitch(this,function(){a.resolve(c);console.log("executeForExtent failed.")})):this.getSupportTableInfo().then(k.hitch(this,function(d){d.isSupportQuery?
h.execute(n).then(k.hitch(this,function(c){c=b.graphicsExtent(c.features);a.resolve(c)}),k.hitch(this,function(){a.resolve(c);console.log("query execute failed.")})):a.resolve(c)}))})):a.resolve(c);return a},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},_initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,
b=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=b?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=
!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},_prepareCheckedInfoForShowOrHide:function(a){for(var b={},c=this;c.parentLayerInfo;)b[c.id]=a,c=c.parentLayerInfo;return b},show:function(){if(this.isRootLayer())this._setTopLayerVisible(!0);else{var a=this.getRootLayerInfo();if(a._setSubLayerVisibleByCheckedInfo){var b=this._prepareCheckedInfoForShowOrHide(!0);
a._setSubLayerVisibleByCheckedInfo(b);a.show()}}},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;var a=d.after(this.layerObject,"setInfoTemplate",k.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=
null)}));this._eventHandles.push(a)},_getServiceDefinition:function(){var a;(a=this.getUrl())&&this.isRootLayer()&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass?a=this._serviceDefinitionBuffer.getRequest(this.subId).request(a):(a=new q,a.resolve(null));return a},createLegendsNode:function(){var a=l.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);l.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+
"/images/loading.gif"},a);return a},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){l.empty(a);p.remove(a,"jimu-legends-div-flag");var b=new x({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:x.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},l.create("div",{},a));b.startup();
a._legendDijit=b}},_initLegendsNode:function(a){var b=[],c=this.layerObject;!this.layerObject||this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(l.empty(a),c.renderer&&(c.renderer.infos?b=k.clone(c.renderer.infos):b.push({label:c.renderer.label,symbol:c.renderer.symbol}),c.renderer&&c.renderer.defaultSymbol&&0<b.length&&b.push({label:c.renderer.defaultLabel||"others",symbol:c.renderer.defaultSymbol}),f.forEach(b,function(b){b.legendDiv=l.create("div",
{"class":"legend-div"},a);b.symbolDiv=l.create("div",{"class":"legend-symbol jimu-float-leading"},b.legendDiv);b.labelDiv=l.create("div",{"class":"legend-label jimu-float-leading",innerHTML:b.label||" "},b.legendDiv);if("textsymbol"===b.symbol.type)g.set(b.symbolDiv,"innerHTML",b.symbol.text);else{var c=m.createSurface(b.symbolDiv,50,50);b=h.getShapeDescriptors(b.symbol);c.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke).setTransform(m.matrix.translate(25,25))}},this)))},obtainNewSubLayers:function(){var a=
[];f.forEach(this.originOperLayer.subLayers,function(b){b.parentLayerInfo=this;b=this._layerInfoFactory.create(b);a.push(b);b.init()},this);return a},_isAllSubLayerVisibleOnPath:function(){for(var a=!0,b=this;!b.isRootLayer();)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},_getCustomPopupInfo:function(a,c){var d=null;a&&a.fields&&(d={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},f.forEach(a.fields,function(a){var h=!1;c?f.some(c,k.hitch(this,function(b){return b&&
a.name.toLowerCase()===b.toLowerCase()}))&&(h=!0):h=!0;h&&(h=b.getDefaultPortalFieldInfo(a),h.visible=!0,h.isEditable=a.editable,d.fieldInfos.push(h))},this));return d},_getDefaultPopupInfo:function(a){if(a=this._getCustomPopupInfo(a))a.fieldInfos=f.filter(a.fieldInfos,k.hitch(this,function(a){return(a=a.fieldName&&a.fieldName.toLowerCase())&&0>a.indexOf("object")&&0>a.indexOf("globalid")&&0>a.indexOf("shape")&&0>a.indexOf("perimeter")?!0:!1}));return a},_getDefaultPopupTemplate:function(a){var b=
null;(a=this.getPopupInfo()||this._getDefaultPopupInfo(a))&&(b=new v(a));return b},enablePopup:function(){return this.loadInfoTemplate().then(k.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?
!0:!1},isSupportPopup:function(){var a=new q;this.loadInfoTemplate().then(k.hitch(this,function(b){b?a.resolve(!0):a.resolve(!1)}));return a},loadInfoTemplate:function(){var a=new q;this.controlPopupInfo.infoTemplate?a.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(k.hitch(this,function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);a.resolve(this.controlPopupInfo.infoTemplate)}),k.hitch(this,function(){a.resolve(null)}));return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},
_getRelatedUrls:function(a,b){var c=[];if(!a||!a.url||!a.relationships)return c;var d=a.url.lastIndexOf("/"),h=a.url.slice(0,d);f.forEach(a.relationships,function(a){b&&a.role&&"esriRelCardinalityManyToMany"!==a.cardinality&&b!==a.role||c.push(h+"/"+a.relatedTableId.toString())},this);return c},getRelatedTableInfoArray:function(a){var b=[],d=new q;this.getLayerObject().then(k.hitch(this,function(h){var n=this._getRelatedUrls(h,a);0!==n.length&&this._getLayerInfosObj().traversalAll(k.hitch(this,function(a){var d=
-1;if(0===n.length)return!0;f.forEach(n,function(h,n){k.getObject("layerObject.url",!1,a)&&c.removeProtocol(h.toString().toLowerCase()).replace(/\/+/g,"/")===c.removeProtocol(a.layerObject.url.toString().toLowerCase()).replace(/\/+/g,"/")&&(b.push(a),d=n)},this);0<=d&&n.splice(d,1);return!1}));d.resolve(b)}),k.hitch(this,function(){d.resolve(b)}));return d},_getOrderByFields:function(a){var b=null;if(void 0===a||null===a)return b;var c=this.getPopupInfo();c&&c.relatedRecordsInfo&&c.relatedRecordsInfo.orderByFields&&
f.some(c.relatedRecordsInfo.orderByFields,function(c){var d=c.field.split("/");if(d[1]===a.toString())return b=[d[2]+" "+c.order],!0},this);return b},_getOriRelationshipByDestLayer:function(a,b,c){var d=null;a=f.filter(a.relationships,function(a){if(a.relatedTableId===b.layerId)return!0},this);return d=a[c]?a[c]:a[0]},getRelatedRecords:function(a,b,c){var d=new q,h=new A,n=this.getLayerObject(),g=b.getLayerObject();e({originalLayerObject:n,relatedLayerObject:g}).then(k.hitch(this,function(n){n.originalLayerObject&&
n.relatedLayerObject||d.resolve([]);n=this._getOriRelationshipByDestLayer(this.layerObject,n.relatedLayerObject,c);h.outFields=["*"];h.relationshipId=n&&n.id;var g=a.attributes[this.layerObject.objectIdField];h.objectIds=[g];h.definitionExpression=b.getFilter();h.orderByFields=this._getOrderByFields(n&&n.id);this.layerObject.queryRelatedFeatures(h,k.hitch(this,function(a){(a=a[g]&&a[g].features)?d.resolve(a):d.resolve([])}),k.hitch(this,function(){d.resolve([])}))}));return d},getFilter:function(){return this.layerObject&&
!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a,b){this.layerObject&&!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&(b=k.mixin({},b),k.setObject("_wabProperties.objectPassWithFilterChangeEvent",b,this.layerObject),this.layerObject.setDefinitionExpression(a))},_isAlreadyInLabelLayerOfMap:function(a){var b=!1;a&&(b=f.some(a.getFeatureLayers(),function(a){return this.id===a.id},this));return b},
_addToLabelLayerOfMap:function(){var a=this.getLabelLayerOfMap();a&&!this._isAlreadyInLabelLayerOfMap(a)&&(a.addFeatureLayer(this.layerObject),this.map.removeLayer(a),this.map.addLayer(a))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:
!1},getLabelLayerOfMap:function(){var b;this.map._labels?b=this.map._labels:(b=this.map.getLayer("labels"),b||(b=new a({id:"labels"}),this.map.addLayer(b)));return b},obtainLabelControl:function(){var b=this.id+"_labelLayer",c=this.map.getLayer(b);if(!c&&this._isSupportLabelControl()){var d=this.getLabelLayerOfMap();d&&this._isAlreadyInLabelLayerOfMap(d)&&(c=new a({id:b}),c.addFeatureLayer(this.layerObject),this.map.addLayer(c),this._removeFromLabelLayerOfMap())}return c?c:null},restoreLabelControl:function(){this._isSupportLabelControl()&&
(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var a=this.map.getLayer(this.id+"_labelLayer");a&&this.map.removeLayer(a)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},isShowLabels:function(){var a=this.map.getLayer(this.id+"_labelLayer"),b=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(a||
b&&this._isAlreadyInLabelLayerOfMap(b))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}})})},"esri/layers/LabelLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/i18n!dojo/cldr/nls/number dojo/number dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../ArcadeExpression ../core/timerUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ../renderers/SimpleRenderer ../arcadeProfiles/labelingProfile ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./GraphicsLayer ./LabelClass".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w,B){function F(a){return"sizeInfo"===a.type}t=t(w,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=f.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
f.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)q.disconnect(this._mapEventHandlers[a]);this.refresh();b.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,d){if(!this.getFeatureLayer(a.layerId)){var h=[];h.push(a.on("update-end",
f.hitch(this,"refresh")));h.push(a.on("suspend",f.hitch(this,"refresh")));h.push(a.on("resume",f.hitch(this,"refresh")));h.push(a.on("edits-complete",f.hitch(this,"refresh")));h.push(a.on("labeling-info-change",f.hitch(this,"refresh")));h.push(a.on("time-extent-change",f.hitch(this,"refresh")));h.push(a.on("show-labels-change",f.hitch(this,"refresh")));h.push(a.on("feature-reduction-change",f.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:d,
LabelRenderer:b,EventHandlers:h});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=k.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)q.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)q.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=b.setTimeout(this._refreshLabels,b.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,c,d,h,n,g=[],e,f="DYNAMIC"===this._engineType?new C:new A;if(this._map){f.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(c=this.featureLayers[a],c.visible&&c.showLabels&&c.visibleAtMapScale&&!c._suspended)if(b=
this._featureLayerInfos[a],n=this._convertOptions(null),b.LabelRenderer){if(g=c.labelingInfo)if(e=g[0])h=this._getLabelExpression(e),n=this._convertOptions(e);d=b.LabelRenderer;b.LabelExpressionInfo&&(h=b.LabelExpressionInfo);b.LabelingOptions&&(n=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(g=b.LabelingOptions.pointPriorities,n.pointPriorities="above-center"==g||"AboveCenter"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"AboveLeft"==
g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"AboveRight"==g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"BelowCenter"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"BelowLeft"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"BelowRight"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"CenterCenter"==g||"esriServerPointLabelPlacementCenterCenter"==
g?"CenterCenter":"center-left"==g||"CenterLeft"==g||"esriServerPointLabelPlacementCenterLeft"==g?"CenterLeft":"center-right"==g||"CenterRight"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(n.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(n.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(n.labelRotation=b.LabelingOptions.labelRotation),
void 0!==b.LabelingOptions.howManyLabels&&(n.howManyLabels=b.LabelingOptions.howManyLabels));d instanceof B&&(h=this._getLabelExpression(d),d=new z(d.symbol),n=this._convertOptions(d));this._addLabels(c,d,h,n)}else if(g=c.labelingInfo)for(b=g.length-1;0<=b;b--)if(e=g[b])d=new B(e instanceof B?e.toJson():e),h=this._getLabelExpression(e),n=this._convertOptions(e),this._addLabels(c,d,h,n);h=f._process(this._preparedLabels);this.clear();this.drawLabels(this._map,h)}},drawLabels:function(a,b){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var g=b[c],n=g.x,e=g.y,f=g.text,u=g.angle,l=g.layer.labelSymbol;"polyline"==g.layer.geometry.type&&g.layer.options.labelRotation&&l.setAngle(180/Math.PI*u);l.setText(f);l instanceof h&&(f=l.getHeight(),n-=.25*f*this._scale*Math.sin(u),e-=.33*f*this._scale);u=new d(new v(n,e,a.extent.spatialReference));u.setParentGraphic(g.layer.graphic);u.setSymbol(l);this.add(u)}},_addLabels:function(a,b,c,d){var h,g,n,e;if(this._isWithinScaleRange(b.minScale,
b.maxScale)&&c&&""!==c){var f=this._map,u=!a.url&&!f.spatialReference.equals(a.spatialReference);for(h=0;h<a.graphics.length;h++)if(g=a.graphics[h],!1!==g.visible&&!g._suspended){n=g.geometry;if(u){if(!x.canProject(n,f))continue;n=x.project(n,f)}n&&this._isWhere(b.where,g.attributes)&&this._isWithinScreenArea(n)&&(e=this._buildLabelText(c,g,a.fields,d),this._addLabel(e,b,a.renderer,g,d,n,f))}}},_isWithinScreenArea:function(a){a="point"===a.type?new u(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();
if(void 0===a)return!1;a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var d=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),h=c[3],g=this._sqlEquation(b[this._removeQuotes(c[4])],
c[5],this._removeQuotes(c[6]));switch(h){case "AND":return d&&g;case "OR":return d||g}}}return!1}catch(K){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-
2);b=a.indexOf("'");c=a.lastIndexOf("'");return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||k.filter(a.visualVariables,F)[0]:null},_addLabel:function(b,c,d,g,n,e,u){var p,m,r,x;if(b&&""!==f.trim(b)&&c){b=b.replace(/[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/g," ");p=c.getSymbol(g);p instanceof h?(p=new h(p.toJson()),p.setVerticalAlignment("baseline"),p.setHorizontalAlignment("center")):p=p instanceof a?new a(p.toJson()):new h;
p.setText(b);c.symbol=p;if(r=this._getProportionalSize(c.sizeInfo,g.attributes))p instanceof h?p.setSize(r):p instanceof a&&(p.setWidth(r),p.setHeight(r));x=r=0;if(d){m=d.getSymbol(g);var v=this._getSizeInfo(d);if((d=v?d.getSize(g,{sizeInfo:v,resolution:u.getResolutionInMeters()}):g.size)&&null!==d)r=x=d;else if(m)if("simplemarkersymbol"==m.type)x=r=m.size;else if("picturemarkersymbol"==m.type)r=m.width,x=m.height;else if("simplelinesymbol"==m.type||"cartographiclinesymbol"==m.type)r=m.width}d={};
d.graphic=g;d.options=n;d.geometry=e;d.labelRenderer=c;d.labelSymbol=p;d.labelWidth=p.getWidth()/2;d.labelHeight=p.getHeight()/2;d.symbolWidth=l.normalizedLength(r)/2;d.symbolHeight=l.normalizedLength(x)/2;d.text=b;d.angle=p.angle;this._preparedLabels.push(d)}},_buildLabelText:function(a,b,d,h){if(h.hasExpression)return a=E.getEvalOptions({expression:h.arcadeExpr,feature:b,layer:b.getLayer(),spatialReference:this._map.spatialReference}),b=b.evaluateExpression(h.arcadeExpr,a),p.isDefined(b)?""+b:"";
var g=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,n=a;for(b=0;b<d.length;b++)if("{"+d[b].name+"}"==a){var n=g[d[b].name],u=d[b].domain;if(u&&f.isObject(u)){if("codedValue"==u.type&&h.useCodedValues)for(b=n,a=0;a<u.codedValues.length;a++)if(u.codedValues[a].code==b){n=u.codedValues[a].name;break}break}u=d[b].type;if(h.fieldInfos){var l=h.fieldInfos;for(b=0;b<l.length;b++)if("{"+l[b].fieldName+"}"==a){a=l[b].format;"esriFieldTypeDate"==u?n=p.substitute({myKey:n},"${myKey}",{format:{myKey:f.mixin({formatType:"DateFormat"},
c.prototype._dateFormatsJson[a&&a.dateFormat||"shortDate"])}}):"esriFieldTypeInteger"!=u&&"esriFieldTypeSingle"!=u&&"esriFieldTypeSmallInteger"!=u&&"esriFieldTypeLong"!=u&&"esriFieldTypeDouble"!=u||!a||(n=r.format(n,{places:a.places}),a.digitSeparator||e.group&&(n=n.replace(new RegExp("\\"+e.group,"g"),"")));break}}break}else n="";return null==n?"":n})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&
(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(a,b){if(!a)return null;b=p.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&b)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(b-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=
!0,c="shortDate",d=null,h=null,g="",e=!0,f,u;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),h=a.fieldInfos,g=a.labelPlacement,null!=a.useCodedValues&&(b=a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(u=!0,f=new n({expression:l,returnType:"string",profile:E}))}if("always-horizontal"==g||"esriServerPolygonPlacementAlwaysHorizontal"==g)e=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:h,pointPriorities:"above-center"==
g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"esriServerPointLabelPlacementCenterCenter"==
g?"CenterCenter":"center-left"==g||"esriServerPointLabelPlacementCenterLeft"==g?"CenterLeft":"center-right"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==g||"below-start"==g||"center-start"==g?"PlaceAtStart":"above-end"==g||"below-end"==g||"center-end"==g?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==g||"esriServerLinePlacementAboveAfter"==g||"above-along"==g||"esriServerLinePlacementAboveAlong"==g||"above-before"==g||
"esriServerLinePlacementAboveBefore"==g||"above-start"==g||"esriServerLinePlacementAboveStart"==g||"above-end"==g||"esriServerLinePlacementAboveEnd"==g?"Above":"below-after"==g||"esriServerLinePlacementBelowAfter"==g||"below-along"==g||"esriServerLinePlacementBelowAlong"==g||"below-before"==g||"esriServerLinePlacementBelowBefore"==g||"below-start"==g||"esriServerLinePlacementBelowStart"==g||"below-end"==g||"esriServerLinePlacementBelowEnd"==g?"Below":"center-after"==g||"esriServerLinePlacementCenterAfter"==
g||"center-along"==g||"esriServerLinePlacementCenterAlong"==g||"center-before"==g||"esriServerLinePlacementCenterBefore"==g||"center-start"==g||"esriServerLinePlacementCenterStart"==g||"center-end"==g||"esriServerLinePlacementCenterEnd"==g?"OnLine":"Above",labelRotation:e,howManyLabels:"OneLabel",hasExpression:u,arcadeExpr:f}}});m("extend-esri")&&f.setObject("layers.LabelLayer",t,g);return t})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),
function(t,f,k,q,e,r){t=t(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(e,f){this._labelLayer=f;this._xmin=e.extent.xmin;this._xmax=e.extent.xmax;this._ymin=e.extent.ymin;this._ymax=e.extent.ymax;this._scale=(this._xmax-this._xmin)/e.width},_process:function(e){this._preparedLabels=
e;this._placedLabels=[];var f;for(e=this._preparedLabels.length-1;0<=e;e--){var g=this._preparedLabels[e],p=Math.min(g.labelWidth,g.labelHeight),d=g.labelWidth+0*p,p=g.labelHeight+0*p,c=(f=g.options)&&void 0!==f.lineLabelPlacement?f.lineLabelPlacement:"PlaceAtCenter",n=f&&void 0!==f.lineLabelPosition?f.lineLabelPosition:"Above",b=f&&void 0!==f.pointPriorities?f.pointPriorities:"AboveRight",h=[2,2,1,3,0,2,3,3,2];"AboveLeft"==b?h=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==b?h=[2,1,2,2,0,2,3,3,3]:"AboveRight"==
b?h=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==b?h=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==b?h=[0,0,0,0,1,0,0,0,0]:"CenterRight"==b?h=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==b?h=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==b?h=[3,3,3,2,0,2,2,1,2]:"BelowRight"==b&&(h=[3,3,2,3,0,2,2,2,1]);var a=f&&void 0!==f.labelRotation?f.labelRotation:!0,b=Math.PI/180*g.angle;f=f&&void 0!==f.howManyLabels?f.howManyLabels:"OneLabel";if("point"==g.geometry.type)this._generatePointPositions(g,g.geometry.x,g.geometry.y,g.text,b,d,p,g.symbolWidth,
g.symbolHeight,h);else if("multipoint"==g.geometry.type)for(c=g.geometry,n=0;n<c.points.length;n++)this._generatePointPositions(g,c.points[n][0],c.points[n][1],g.text,b,d,p,g.symbolWidth,g.symbolHeight,h);else"polyline"==g.geometry.type?this._generateLinePositions(g,g.geometry,g.text,d,p,2*g.symbolHeight+p,c,n,a):"polygon"==g.geometry.type&&this._generatePolygonPositions(g,f,g.geometry,g.text,b,d,p)}return this._placedLabels},_generatePointPositions:function(e,f,g,p,d,c,n,b,h,a){b=(b+c)*this._scale;
h=(h+n)*this._scale;var u,l;for(u=1;3>=u;u++)for(l=1;9>=l;l++)if(a[l-1]==u)switch(l){case 1:if(this._findPlace(e,p,f-b,g+h,d,c,n))return;break;case 2:if(this._findPlace(e,p,f,g+h,d,c,n))return;break;case 3:if(this._findPlace(e,p,f+b,g+h,d,c,n))return;break;case 4:if(this._findPlace(e,p,f-b,g,d,c,n))return;break;case 5:if(this._findPlace(e,p,f,g,d,c,n))return;break;case 6:if(this._findPlace(e,p,f+b,g,d,c,n))return;break;case 7:if(this._findPlace(e,p,f-b,g-h,d,c,n))return;break;case 8:if(this._findPlace(e,
p,f,g-h,d,c,n))return;break;case 9:if(this._findPlace(e,p,f+b,g-h,d,c,n))return}},_generateLinePositions:function(e,f,g,p,d,c,n,b,h){var a=p*this._scale*p*this._scale,u,l,m;for(u=0;u<f.paths.length;u++){var r=f.paths[u],q=r.length,k=Math.floor((q-1)/2),A=0!==(q-1)%2?1:-1;"PlaceAtStart"==n&&(k=0,A=1);"PlaceAtEnd"==n&&(k=q-2,A=-1);for(;0<=k&&k<q-1;){for(l=k;l<q;l++){var w=r[k][0],B=r[k][1],t=r[l][0]-w,D=r[l][1]-B;if(t*t+D*D>a){for(var G=Math.atan2(D,t);G>Math.PI/2;)G-=Math.PI;for(;G<-(Math.PI/2);)G+=
Math.PI;var H=Math.sin(G),M=Math.cos(G),L=0,J=0;"Above"==b&&(L=c*H*this._scale,J=c*M*this._scale);"Below"==b&&(L=-c*H*this._scale,J=-c*M*this._scale);if(1==l-k){if(this._clipLine(w,B,r[l][0],r[l][1])&&(w=this._x1-this._x0,m=this._y1-this._y0,w*w+m*m>a&&(l=Math.atan2(m,w),t=p/2+2*d,B=t*this._scale*Math.cos(l),t=t*this._scale*Math.sin(l),"PlaceAtStart"==n?(w=this._x0+B,m=this._y0+t):"PlaceAtEnd"==n?(w=this._x1-B,m=this._y1-t):(w=this._x0+w/2,m=this._y0+m/2),this._findPlace(e,g,w-L,m+J,h?-l:0,p,d))))return}else{var K=
0;for(m=k;m<=l;m++)K=Math.max(K,Math.abs((r[m][1]-B)*M-(r[m][0]-w)*H));if(K<d&&this._findPlace(e,g,w+t/2-L,B+D/2+J,h?-G:0,p,d))return}break}}k+=A}}},_generatePolygonPositions:function(e,f,g,p,d,c,n){var b;if("ManyLabels"==f)for(f=0;f<g.rings.length;f++)b=g.rings[f],r.prototype.isClockwise(b)&&(b=this._findCentroid(b,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(e,p,b[0],b[1],d,c,n));else{b=this._findCentroidForFeature(g,this._xmin,this._ymin,this._xmax,this._ymax);var h=b[1],a=0;for(f=
0;10>f;f++){a+=n/4;b=this._findCentroidForFeature(g,this._xmin,h+(a-n/4),this._xmax,h+(a+n/4));if(this._findPlace(e,p,b[0],b[1],d,c,n))break;b=this._findCentroidForFeature(g,this._xmin,h-(a+n/4),this._xmax,h-(a-n/4));if(this._findPlace(e,p,b[0],b[1],d,c,n))break}}},_findCentroid:function(e,f,g,p,d){var c=e.length,n=[0,0],b=0,h=e[0][0],a=e[0][1];h>p&&(h=p);h<f&&(h=f);a>d&&(a=d);a<g&&(a=g);for(var u=1;u<c-1;u++){var l=e[u][0],m=e[u][1],r=e[u+1][0],q=e[u+1][1];l>p&&(l=p);l<f&&(l=f);m>d&&(m=d);m<g&&(m=
g);r>p&&(r=p);r<f&&(r=f);q>d&&(q=d);q<g&&(q=g);var k=(l-h)*(q-a)-(r-h)*(m-a);n[0]+=k*(h+l+r);n[1]+=k*(a+m+q);b+=k}n[0]/=3*b;n[1]/=3*b;if(isNaN(n[0])||isNaN(n[1]))return n;g=[];this._fillBuffer(e,g,n);n[0]=this._sortBuffer(g,n[0],f,p);return n},_findCentroidForFeature:function(e,f,g,p,d){for(var c,n=0,b=[0,0],h=0;h<e.rings.length;h++){var a=e.rings[h],u=a.length,l=a[0][0],m=a[0][1];l>p&&(l=p);l<f&&(l=f);m>d&&(m=d);m<g&&(m=g);for(c=1;c<u-1;c++){var r=a[c][0],q=a[c][1],k=a[c+1][0],A=a[c+1][1];r>p&&(r=
p);r<f&&(r=f);q>d&&(q=d);q<g&&(q=g);k>p&&(k=p);k<f&&(k=f);A>d&&(A=d);A<g&&(A=g);var w=(r-l)*(A-m)-(k-l)*(q-m);b[0]+=w*(l+r+k);b[1]+=w*(m+q+A);n+=w}}b[0]/=3*n;b[1]/=3*n;if(isNaN(b[0])||isNaN(b[1]))return b;g=[];for(c=0;c<e.rings.length;c++)this._fillBuffer(e.rings[c],g,b);b[0]=this._sortBuffer(g,b[0],f,p);return b},_fillBuffer:function(e,f,g){for(var p=e.length-1,d=e[0][1]>=e[p][1]?1:-1,c=0;c<=p;c++){var n=c,b=c+1;c==p&&(b=0);var h=e[n][0],n=e[n][1],a=e[b][0],b=e[b][1],u=b>=n?1:-1;if(n<=g[1]&&g[1]<=
b||b<=g[1]&&g[1]<=n)g[1]!=n&&g[1]!=b?(f.push((g[1]-n)*(a-h)/(b-n)+h),d=u):g[1]==n&&g[1]!=b?(d!=u&&f.push(h),d=u):g[1]!=n&&g[1]==b?(f.push(a),d=u):g[1]==n&&g[1]==b&&(1==d&&f.push(h),f.push(a),d=u)}},_sortBuffer:function(e,f,g,p){var d=e.length;e.sort();if(0<d){for(var c=0,n=f=0;n<d-1;n+=2){var b=Math.abs(e[n+1]-e[n]);!(e[n]<=g&&e[n+1]<=g||e[n]>=p&&e[n+1]>=p)&&b>c&&(c=b,f=n)}d=e[f];e=e[f+1];d>p&&(d=p);d<g&&(d=g);e>p&&(e=p);e<g&&(e=g);f=(d+e)/2}return f},_findPlace:function(f,l,g,p,d,c,n){if(isNaN(g)||
isNaN(p))return!1;for(var b=0;b<this._placedLabels.length;b++){var h=this._placedLabels[b].angle,a=this._placedLabels[b].width*this._scale,u=this._placedLabels[b].height*this._scale,m=this._placedLabels[b].x-g,x=this._placedLabels[b].y-p;if(0===d&&0===h){if(this._findPlace2(-c*this._scale,-n*this._scale,c*this._scale,n*this._scale,m-a,x-u,m+a,x+u))return!1}else{var q=new e(-c*this._scale,-n*this._scale,c*this._scale,n*this._scale,null),k=0,C=1;0!==d&&(k=Math.sin(d),C=Math.cos(d));var A=m*C-x*k,m=
m*k+x*C,h=h-d,k=Math.sin(h),C=Math.cos(h),w=-a*C- -u*k,x=-a*k+-u*C,h=+a*C- -u*k,t=+a*k+-u*C,a=A+w,u=m-x,k=A+h,C=m-t,w=A-w,x=m+x,A=A-h,m=m+t,h=new r;h.addRing([[a,u],[k,C],[w,x],[A,m],[a,u]]);if(q.intersects(h))return!1}}for(;d>Math.PI/2;)d-=Math.PI;for(;d<-(Math.PI/2);)d+=Math.PI;b={};b.layer=f;b.text=l;b.angle=d;b.x=g;b.y=p;b.width=c;b.height=n;this._placedLabels.push(b);return!0},_findPlace2:function(e,f,g,p,d,c,n,b){return(e>=d&&e<=n||g>=d&&g<=n||e<=d&&g>=n)&&(f>=c&&f<=b||p>=c&&p<=b||f<=c&&p>=
b)?!0:!1},_clipLine:function(e,f,g,p){for(var d=this._code(e,f),c=this._code(g,p);0!==d||0!==c;){if(0!==(d&c))return!1;var n=g-e,b=p-f;0!==d?(e<this._xmin?(f+=b*(this._xmin-e)/n,e=this._xmin):e>this._xmax?(f+=b*(this._xmax-e)/n,e=this._xmax):f<this._ymin?(e+=n*(this._ymin-f)/b,f=this._ymin):f>this._ymax&&(e+=n*(this._ymax-f)/b,f=this._ymax),d=this._code(e,f)):(g<this._xmin?(p+=b*(this._xmin-g)/n,g=this._xmin):g>this._xmax?(p+=b*(this._xmax-g)/n,g=this._xmax):p<this._ymin?(g+=n*(this._ymin-p)/b,p=
this._ymin):p>this._ymax&&(g+=n*(this._ymax-p)/b,p=this._ymax),c=this._code(g,p))}this._x0=e;this._y0=f;this._x1=g;this._y1=p;return!0},_code:function(e,f){var g=0;e<this._xmin&&(g+=8);e>this._xmax&&(g+=4);f<this._ymin&&(g+=2);f>this._ymax&&(g+=1);return g}});k("extend-esri")&&f.setObject("layers.labelLayerUtils.DynamicLabelClass",t,q);return t})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),
function(t,f,k,q,e,r,m){return t(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(e,g){this._labelLayer=g;this._map=e;this._xmin=e.extent.xmin;this._xmax=e.extent.xmax;this._ymin=e.extent.ymin;this._ymax=e.extent.ymax;this._scale=
(this._xmax-this._xmin)/e.width},_process:function(e){var g,f,d,c,n,b,h,a,u;this._preparedLabels=e;this._placedLabels=[];for(e=this._preparedLabels.length-1;0<=e;e--){g=this._preparedLabels[e];n=g.labelWidth;b=g.labelHeight;a=(h=g.options)&&h.lineLabelPlacement?h.lineLabelPlacement:"PlaceAtCenter";u=h&&h.lineLabelPosition?h.lineLabelPosition:"Above";f=h&&h.labelRotation?h.labelRotation:!0;d=Math.PI/180*g.angle;c=h&&h.howManyLabels?h.howManyLabels:"OneLabel";var l=[];if("point"===g.geometry.type)this._generatePointPositions(g.geometry.x,
g.geometry.y,g.text,d,n,b,g.symbolWidth,g.symbolHeight,h,l);else if("multipoint"===g.geometry.type)for(f=0;f<g.geometry.points.length;f++)this._generatePointPositions(g.geometry.points[f][0],g.geometry.points[f][1],g.text,d,n,b,g.symbolWidth,g.symbolHeight,h,l);else if("polyline"===g.geometry.type)if("PlaceAtStart"===a)this._generateLinePositionsPlaceAtStart(g.geometry,!0,g.text,n,b,2*g.symbolHeight+b,a,u,f,l);else if("PlaceAtEnd"===a)this._generateLinePositionsPlaceAtEnd(g.geometry,!0,g.text,n,b,
2*g.symbolHeight+b,a,u,f,l);else{h=[];var x=g.geometry.getExtent(),q=this._map.extent;if(x.getWidth()<n*this._scale/this._OVERRUN&&x.getHeight()<n*this._scale/this._OVERRUN)continue;else.5*x.getWidth()<q.getWidth()&&.5*x.getHeight()<q.getHeight()?this._generateLinePositionsPlaceAtCenter(g.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,g.text,n,b,2*g.symbolHeight+b,a,u,f,h):this._generateLinePositionsPlaceAtCenter(g.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,
g.text,n,b,2*g.symbolHeight+b,a,u,f,h);this._postSorting(q,h,l)}else if("polygon"===g.geometry.type){a=[];for(f=0;f<g.geometry.rings.length;f++)u=g.geometry.rings[f],1<g.geometry.rings.length&&!m.prototype.isClockwise(u)||(h=this._calcRingExtent(u),h.xmax-h.xmin<4*n*this._scale/this._OVERRUN&&h.ymax-h.ymin<4*b*this._scale/this._OVERRUN||a.push(u));a.sort(function(a,b){return b.length-a.length});for(f=0;f<a.length;f++)this._generatePolygonPositionsForManyLabels(a[f],g.geometry.spatialReference,g.text,
d,n,b,l)}for(f=0;f<l.length&&(a=l[f].x,u=l[f].y,void 0!==l[f].angle&&(d=l[f].angle),h=this._findPlace(g,g.text,a,u,d,n,b),"OneLabel"!==c||!h||!this._labelLayer._isWithinScreenArea(new r(a,u,g.geometry.spatialReference)));f++);}return this._placedLabels},_generatePointPositions:function(e,g,f,d,c,n,b,h,a,u){f=a&&a.pointPriorities?a.pointPriorities:"AboveRight";c=(b+c)*this._scale;n=(h+n)*this._scale;switch(f.toLowerCase()){case "aboveleft":e-=c;g+=n;break;case "abovecenter":g+=n;break;case "aboveright":e+=
c;g+=n;break;case "centerleft":e-=c;break;case "centercenter":break;case "centerright":e+=c;break;case "belowleft":e-=c;g-=n;break;case "belowcenter":g-=n;break;case "belowright":e+=c;g-=n;break;default:return}u.push({x:e,y:g})},_generateLinePositionsPlaceAtStart:function(e,g,f,d,c,n,b,h,a,u){b=d*this._scale;var p=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,m,r,q,k,w,t,F;for(l=0;l<e.paths.length;l++){var D=e.paths[l],G=b,H=0;for(m=0;m<D.length-1;m++)r=D[m][0],q=
D[m][1],k=D[m+1][0],w=D[m+1][1],t=k-r,F=w-q,t=Math.sqrt(t*t+F*F),H+t>G?(H=this._generatePositionsOnLine(e.spatialReference,g,G,p,H,r,q,k,w,f,d,c,n,h,a,u),G=p):H+=t}},_generateLinePositionsPlaceAtEnd:function(e,g,f,d,c,n,b,h,a,u){b=d*this._scale;var p=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,m,r,q,k,w,t,F;for(l=0;l<e.paths.length;l++){var D=e.paths[l],G=b,H=0;for(m=D.length-2;0<=m;m--)r=D[m+1][0],q=D[m+1][1],k=D[m][0],w=D[m][1],t=k-r,F=w-q,t=Math.sqrt(t*t+F*F),
H+t>G?(H=this._generatePositionsOnLine(e.spatialReference,g,G,p,H,r,q,k,w,f,d,c,n,h,a,u),G=p):H+=t}},_generateLinePositionsPlaceAtCenter:function(e,g,f,d,c,n,b,h,a,u,m){var p,l,r,q,v,k,t,F;for(h=0;h<e.paths.length;h++){var D=e.paths[h];if(!(2>D.length)){if(2==D.length){q=D[0];p=D[1];r=q[0];q=q[1];D=p[0];k=p[1];v=(D-r)*(D-r)+(k-q)*(k-q);t=Math.atan2(k-q,D-r);k=Math.cos(t);t=Math.sin(t);D=[];F=r;for(var G=q;(F-r)*(F-r)+(G-q)*(G-q)<v;)D.push([F,G]),F+=f/2*k,G+=f/2*t;D.push(p)}var H=0;for(p=0;p<D.length-
1;p++)r=D[p][0],q=D[p][1],v=D[p+1][0],k=D[p+1][1],t=v-r,F=k-q,H+=Math.sqrt(t*t+F*F);for(p=G=0;p<D.length-1;p++){r=D[p][0];q=D[p][1];v=D[p+1][0];k=D[p+1][1];t=v-r;F=k-q;t=Math.sqrt(t*t+F*F);if(G+t>H/2)break;G+=t}p==D.length-1&&p--;r=D[p][0];q=D[p][1];v=D[p+1][0];k=D[p+1][1];t=v-r;F=k-q;G=H/2-G;t=Math.atan2(F,t);F=r+G*Math.cos(t);t=q+G*Math.sin(t);r=this._angleAndShifts(r,q,v,k,b,a,u);m.push({x:F+r.shiftX,y:t+r.shiftY,angle:r.angle});var H=F,M=t,G=0;for(l=p;l<D.length-1;l++)l==p?(r=H,q=M):(r=D[l][0],
q=D[l][1]),v=D[l+1][0],k=D[l+1][1],t=v-r,F=k-q,t=Math.sqrt(t*t+F*F),G=G+t>f?this._generatePositionsOnLine(e.spatialReference,g,f,f,G,r,q,v,k,d,c,n,b,a,u,m):G+t;G=0;for(l=p;0<=l;l--)l==p?(r=H,q=M):(r=D[l+1][0],q=D[l+1][1]),v=D[l][0],k=D[l][1],t=v-r,F=k-q,t=Math.sqrt(t*t+F*F),G=G+t>f?this._generatePositionsOnLine(e.spatialReference,g,f,f,G,r,q,v,k,d,c,n,b,a,u,m):G+t}}},_generatePositionsOnLine:function(f,g,p,d,c,n,b,h,a,u,m,r,q,k,t,A){u=Math.atan2(a-b,h-n);m=n;r=b;var l=m,v=r;do if(c=p-c,m+=c*Math.cos(u),
r+=c*Math.sin(u),this._belongs(m,r,n,b,h,a))c=this._angleAndShifts(n,b,h,a,q,k,t),p=m+c.shiftX,v=r+c.shiftY,g?this._labelLayer._isWithinScreenArea(new e(p,v,p,v,f))&&A.push({x:p,y:v,angle:c.angle}):A.push({x:p,y:v,angle:c.angle}),l=m,v=r,c=0,p=d;else return f=h-l,a-=v,Math.sqrt(f*f+a*a);while(1)},_postSorting:function(e,g,f){if(e&&0<g.length){var d=.5*(e.xmin+e.xmax);e=.5*(e.ymin+e.ymax);for(var c=g[0].x,n=g[0].y,b=Math.sqrt((c-d)*(c-d)+(n-e)*(n-e)),h=g[0].angle,a=0;a<g.length;a++){var u=g[a].x,p=
g[a].y,l=Math.sqrt((u-d)*(u-d)+(p-e)*(p-e));l<b&&(c=u,n=p,b=l,h=g[a].angle)}f.push({x:c,y:n,angle:h})}},_belongs:function(e,g,f,d,c,n){if(c==f&&n==d)return!1;if(c>f){if(e>c||e<f)return!1}else if(e<c||e>f)return!1;if(n>d){if(g>n||g<d)return!1}else if(g<n||g>d)return!1;return!0},_angleAndShifts:function(e,g,f,d,c,n,b){for(e=Math.atan2(d-g,f-e);e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;d=Math.sin(e);var h=Math.cos(e);f=g=0;"Above"==n&&(g=c*d*this._scale,f=c*h*this._scale);"Below"==n&&(g=
-c*d*this._scale,f=-c*h*this._scale);c=[];c.angle=b?-e:0;c.shiftX=-g;c.shiftY=f;return c},_generatePolygonPositionsForManyLabels:function(e,g,f,d,c,n,b){c=this._findCentroidForRing(e);d=c[0];var h=c[1],a=this._calcRingExtent(e);c=a.xmin;n=a.ymin;var u=a.xmax,a=a.ymax,p=(a-n)/(this._map.height*this._scale);if(!(10<(u-c)/(this._map.width*this._scale)&&10<p)){var l=!0;if(u-c>this._map.width*this._scale||a-n>this._map.height*this._scale)l=!1;var p=this._map.width*this._scale*(l?.1875:.5),l=this._map.height*
this._scale*(l?.1875:.5),m=!0,r=!0,q=0;do{h+=(q%2?-1:1)*q*l;if(this._scanRingByX(f,g,e,d,h,c,u,p,b))break;h<n&&(m=!1);h>a&&(r=!1);q++}while(m||r)}},_scanRingByX:function(f,g,p,d,c,n,b,h,a){var u=!0,l=!0,m=0,r=1E3;do{d+=(m%2?-1:1)*m*h;var q=this._movePointInsideRing(p,d,c),k=this._labelLayer._isWithinScreenArea(new e(q,c,q,c,g)),A=this._isPointWithinRing(f,p,q,c);if(k&&A)return a.push({x:q,y:c}),!0;d<n&&(u=!1);d>b&&(l=!1);m++;r--;if(0>=r)return!0}while(u||l);return!1},_movePointInsideRing:function(e,
g,f){for(var d=[],c=e.length-1,n=e[0][1]>=e[c][1]?1:-1,b=0;b<=c;b++){var h=b,a=b+1;b==c&&(a=0);var u=e[h][0],h=e[h][1],p=e[a][0],a=e[a][1],l=a>=h?1:-1;if(h<=f&&f<=a||a<=f&&f<=h)f!=h&&f!=a?(d.push((f-h)*(p-u)/(a-h)+u),n=l):f==h&&f!=a?(n!=l&&d.push(u),n=l):f!=h&&f==a?(d.push(p),n=l):f==h&&f==a&&(1==n&&d.push(u),d.push(p),n=l)}d.sort(function(a,b){return a-b});e=d.length;if(0<e){for(b=f=g=0;b<e-1;b+=2)c=Math.abs(d[b+1]-d[b]),c>g&&(g=c,f=b);g=(d[f]+d[f+1])/2}return g},_calcRingExtent:function(f){var g,
p;p=new e;for(g=0;g<f.length-1;g++){var d=f[g][0],c=f[g][1];if(void 0===p.xmin||d<p.xmin)p.xmin=d;if(void 0===p.ymin||c<p.ymin)p.ymin=c;if(void 0===p.xmax||d>p.xmax)p.xmax=d;if(void 0===p.ymax||c>p.ymax)p.ymax=c}return p},_isPointWithinPolygon:function(e,g,f,d){var c;for(c=0;c<g.rings.length;c++)if(this._isPointWithinRing(e,g.rings[c],f,d))return!0;return!1},_isPointWithinRing:function(e,g,f,d){var c,n,b,h,a=[],u=g.length;for(e=0;e<u-1;e++)if(c=g[e][0],n=g[e][1],b=g[e+1][0],h=g[e+1][1],c!=b||n!=h){if(n==
h)if(d==n)a.push(c);else continue;c==b?(n<h&&d>=n&&d<h&&a.push(c),n>h&&d<=n&&d>h&&a.push(c)):(n=(b-c)/(h-n)*(d-n)+c,c<b&&n>=c&&n<b&&a.push(n),c>b&&n<=c&&n>b&&a.push(n))}a.sort(function(a,b){return a-b});for(e=0;e<a.length-1;e++)if(c=a[e],b=a[e+1],f>=c&&f<b)if(e%2)break;else return!0;return!1},_findCentroidForRing:function(e){for(var g=e.length,f=[0,0],d=0,c=e[0][0],n=e[0][1],b=1;b<g-1;b++){var h=e[b][0],a=e[b][1],u=e[b+1][0],l=e[b+1][1],m=(h-c)*(l-n)-(u-c)*(a-n);f[0]+=m*(c+h+u);f[1]+=m*(n+a+l);d+=
m}f[0]/=3*d;f[1]/=3*d;return f},_findCentroidForFeature:function(e){for(var g=0,f=[0,0],d=0;d<e.rings.length;d++)for(var c=e.rings[d],n=c.length,b=c[0][0],h=c[0][1],a=1;a<n-1;a++){var u=c[a][0],l=c[a][1],m=c[a+1][0],r=c[a+1][1],q=(u-b)*(r-h)-(m-b)*(l-h);f[0]+=q*(b+u+m);f[1]+=q*(h+l+r);g+=q}f[0]/=3*g;f[1]/=3*g;return f},_findPlace:function(f,g,p,d,c,n,b){if(isNaN(p)||isNaN(d))return!1;for(var h=0;h<this._placedLabels.length;h++){var a=this._placedLabels[h].angle,u=this._placedLabels[h].width*this._scale,
l=this._placedLabels[h].height*this._scale,r=this._placedLabels[h].x-p,q=this._placedLabels[h].y-d;if(0===c&&0===a){if(this._findPlace2(-n*this._scale,-b*this._scale,n*this._scale,b*this._scale,r-u,q-l,r+u,q+l))return!1}else{var k=new e(-n*this._scale,-b*this._scale,n*this._scale,b*this._scale,null),t=0,A=1;0!==c&&(t=Math.sin(c),A=Math.cos(c));var w=r*A-q*t,r=r*t+q*A,a=a-c,t=Math.sin(a),A=Math.cos(a),B=-u*A- -l*t,q=-u*t+-l*A,a=+u*A- -l*t,F=+u*t+-l*A,u=w+B,l=r-q,t=w+a,A=r-F,B=w-B,q=r+q,w=w-a,r=r+F,
a=new m;a.addRing([[u,l],[t,A],[B,q],[w,r],[u,l]]);if(k.intersects(a))return!1}}for(;c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;h={};h.layer=f;h.text=g;h.angle=c;h.x=p;h.y=d;h.width=n;h.height=b;this._placedLabels.push(h);return!0},_findPlace2:function(e,g,f,d,c,n,b,h){return(e>=c&&e<=b||f>=c&&f<=b||e<=c&&f>=b)&&(g>=n&&g<=h||d>=n&&d<=h||g<=n&&d>=h)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w,B,F,D,G,H,M,L,J,K,N,P,Q,O,R,I,V,Y,S,Z){var aa=D.getClassValuesForRelationship(),ba={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},W={HH:315,HL:45,LL:135,LH:225},X=f([S,v],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new m([64,64,64]),defaultText:"Aa",sizeRampLightColor:new m([255,
255,255]),sizeRampDarkColor:new m([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_preserveCacheOnDestroy:!1,_layerConnects:null,_mapConnects:null,constructor:function(a,b){k.mixin(this,Z.widgets.legend);this._i18n=Z.widgets.legend;a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?
!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===X.ALIGN_RIGHT?X.ALIGN_RIGHT:X.ALIGN_LEFT,this.arrangement===X.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=l(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);
var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],t.locale&&-1!==t.locale.indexOf(c)&&(-1!==t.locale.indexOf("-")?-1!==t.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();
9>g("ie")&&(this._repaintItems=k.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||q.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],q.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&
(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)h.destroy(this.domNode.children[a]);
this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],q.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),
a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];q.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(d=c.getLayers(),q.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==
c.declaredClass&&(d=c.getFeatureLayers(),q.forEach(d,function(a){b.push(a.id)},this))},this);q.forEach(this.map.graphicsLayerIds,function(c){var d=this.map.getLayer(c);-1==q.indexOf(a,c)&&-1==q.indexOf(b,c)&&this._isSupportedLayerType(d)&&this._isLayerDrawingEnabled(d)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&(a._params&&a._params.drawMode||a.isFeatureReductionActive&&
a.isFeatureReductionActive())},_activate:function(){this._deactivate();if(this.autoUpdate){this._mapConnects=[];this._layerConnects={};var a=this._mapConnects;this._respectCurrentMapScale&&a.push(e.connect(this.map,"onZoomEnd",this,"_refreshLayers"));this.useAllMapLayers&&(a.push(e.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers")),a.push(e.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers")),a.push(e.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")));q.forEach(this.layers,
function(a){var b=[e.connect(a,"onFeatureReductionRendererChange",this,"_refreshLayers"),e.connect(a,"onFeatureReductionChange",this,"_refreshLayers"),e.connect(a,"onVisibilityChange",this,"_refreshLayers"),e.connect(a,"onOpacityChange",this,"_refreshLayers"),e.connect(a,"onScaleRangeChange",this,"_refreshLayers")];"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&b.push(e.connect(a,"_onDynamicLayersChange",k.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&(b.push(e.connect(a,"onRenderingChange",k.partial(this._updateImageServiceLayers,this,a))),b.push(e.connect(a,"onRendererChange",k.partial(this._updateImageServiceLayers,this,a))));("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||a.setWebGLEnabled)&&b.push(e.connect(a,"onRendererChange",k.hitch(this,"_refreshLayers")));this._layerConnects[a.id]=b},this)}},_deactivate:function(){q.forEach(this._mapConnects,function(a){e.disconnect(a)});q.forEach(this.layers,function(a){var b=
this._layerConnects;b&&q.forEach(b[a.id],function(a){e.disconnect(a)})},this);this._mapConnects=this._layerConnects=null},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];q.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);q.forEach(this.map.graphicsLayerIds,
function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var d=!1,g=!1;a.set(this.domNode,"position","relative");h.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var n=[];q.forEach(this.layers,function(a){if("esri.layers.KMLLayer"==a.declaredClass||"esri.layers.GeoRSSLayer"==a.declaredClass){var b;a.loaded?("esri.layers.KMLLayer"==
a.declaredClass?b=a.getLayers():"esri.layers.GeoRSSLayer"==a.declaredClass&&(b=a.getFeatureLayers(),this.hideLayersInLegend[a.id]&&(b=q.filter(b,function(b){return-1==q.indexOf(this.hideLayersInLegend[a.id],b.id)},this))),q.forEach(b,function(b){"esri.layers.FeatureLayer"==b.declaredClass&&a._titleForLegend&&(b._titleForLegend=a._titleForLegend+" - ","esriGeometryPoint"==b.geometryType?b._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==b.geometryType?b._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==
b.geometryType&&(b._titleForLegend+=this.NLS_areas),n.push(b))},this)):e.connect(a,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===a.declaredClass)if(!a.loaded)e.connect(a,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&a.visible)&&0<a.layerInfos.length&&q.some(a.layerInfos,function(a){return a.legendURL})){var c=!1;q.forEach(a.layerInfos,function(b){if(b.legendURL&&-1<
q.indexOf(a.visibleLayers,b.name)){c||(h.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(a._titleForLegend||a.name||a.id)+"\x3c/span\x3e"},this.domNode),c=!0);var g;b=b.legendURL;if(a.customParameters||a.customLayerParameters){var e=k.clone(a.customParameters||{});k.mixin(e,a.customLayerParameters||{});for(g in e)b+=(-1===b.indexOf("?")?"?":"\x26")+g+"\x3d"+e[g]}h.create("div",{innerHTML:"\x3cimg src\x3d'"+b+"'/\x3e"},this.domNode);d=!0}},this)}}else"esri.layers.WFSLayer"!==
a.declaredClass||a.renderer?n.push(a):(b=h.create("div",{id:this.id+"_"+a.id,"class":"esriLegendService"}),h.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},h.create("td",{align:this._align},h.create("tr",{},h.create("tbody",{},h.create("table",{width:"95%"},b))))),h.place(b,this.id,"first"),b=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b),b=h.create("tbody",{},b),"esriGeometryComplex"===a.geometryType?(this._buildRow_Renderer(a,
a._pointSymbol,null,this.NLS_points,null,b),this._buildRow_Renderer(a,a._lineSymbol,null,this.NLS_lines,null,b),this._buildRow_Renderer(a,a._polygonSymbol,null,this.NLS_areas,null,b)):"esriGeometryPoint"===a.geometryType?this._buildRow_Renderer(a,a._pointSymbol,null,"",null,b):"esriGeometryPolyline"===a.geometryType?this._buildRow_Renderer(a,a._lineSymbol,null,"",null,b):"esriGeometryPolygon"===a.geometryType&&this._buildRow_Renderer(a,a._polygonSymbol,null,"",null,b),g=!0)},this);var f=[];q.forEach(n,
function(a){if(!a.loaded)var b=e.connect(a,"onLoad",this,function(a){e.disconnect(b);b=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var c=h.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});h.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},h.create("td",{align:this._align},h.create("tr",{},h.create("tbody",
{},h.create("table",{width:"95%"},c)))));h.place(c,this.id,"first");a.legendResponse||a.renderer&&"esri.renderer.StretchRenderer"!==a.renderer.declaredClass||a.renderer&&"esri.renderer.StretchRenderer"===a.renderer.declaredClass&&1===a.bandCount?this._createLegendForLayer(a):this.isHostedTileService(a)?this._getLayerInfos(a).then(k.hitch(this,function(a){this._createLegendForLayer(a)}),k.hitch(this,function(a){f.push(this._legendRequest(a))})):f.push(this._legendRequest(a))}},this);0!==f.length||
d||g?(new c(f)).addCallback(k.hitch(this,function(a){d||g?b.byId(this.id+"_msg").innerHTML="":b.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(b.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(c){if(c.legendResponse||c.renderer||this.isHostedTileService(c)){var d=!1;if(c.legendResponse||this.isHostedTileService(c)){var h=c.dynamicLayerInfos||c.layerInfos;h&&h.length?q.forEach(h,function(a,b){this.hideLayersInLegend[c.id]&&-1!==
q.indexOf(this.hideLayersInLegend[c.id],a.id)||(a=this._buildLegendItems(c,a,b),d=d||a)},this):"esri.layers.ArcGISImageServiceLayer"==c.declaredClass&&(d=this._buildLegendItems(c,{id:0,name:null,title:c.name,subLayerIds:null,parentLayerId:-1},0))}else c.renderer&&(h=c.url?c.url.substring(c.url.lastIndexOf("/")+1,c.url.length):"fc_"+c.id,d=this._buildLegendItems(c,{id:h,name:null,subLayerIds:null,parentLayerId:-1},0));d&&(a.set(b.byId(this.id+"_"+c.id),"display","block"),a.set(b.byId(this.id+"_msg"),
"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);e.connect(a,"onLoad",k.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&(b+="?token\x3d"+c);var d=k.hitch(this,"_processLegendResponse"),h={f:"json"};a._params.dynamicLayers&&(h.dynamicLayers=n.stringify(this._createDynamicLayers(a)),"[{}]"===
h.dynamicLayers&&(h.dynamicLayers="[]"));a._params.bandIds&&(h.bandIds=a._params.bandIds);a._params.renderingRule?h.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&q.forEach(a.rasterFunctionInfos,function(a){a&&a.name&&"none"===a.name.toLowerCase()&&(h.renderingRule=n.stringify({rasterFunction:a.name}))});return w({url:b,content:h,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:A.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=
a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!g("ie")||8<g("ie"))b+="\x26returnbytes\x3dtrue";var c=k.hitch(this,"_processLegendResponse");return w({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,d){c(a,b,d)},error:A.defaults.io.errorHandler})},_processLegendResponse:function(a,c){c&&c.layers?(a.legendResponse=c,b.byId(this.id+"_"+a.id)&&h.empty(b.byId(this.id+"_"+a.id)),h.create("span",
{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},h.create("td",{align:this._align},h.create("tr",{},h.create("tbody",{},h.create("table",{width:"95%"},b.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+r.toJson(c))},_buildLegendItems:function(a,c,d){var g=!1,e=b.byId(this.id+"_"+a.id),n=c.parentLayerId;if(c.subLayerIds)a=h.create("div",{id:this.id+"_"+a.id+"_"+c.id+"_group",style:{display:"none"},"class":-1==
n?0<d?"esriLegendGroupLayer":"":this._legendAlign},-1==n?e:b.byId(this.id+"_"+a.id+"_"+n+"_group")),h.create("td",{innerHTML:E.encode(c.name),align:this._align},h.create("tr",{},h.create("tbody",{},h.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers)if(d=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===q.indexOf(a.visibleLayers,c.id))return g}else{if(d=this._getReallyVisibleLayers(d,a.visibleLayers),-1===q.indexOf(d,
c.id))return g}else if(-1===q.indexOf(a.visibleLayers,c.id))return g;e=h.create("div",{id:this.id+"_"+a.id+"_"+c.id,style:{display:"none"},"class":-1<n?this._legendAlign:""},-1==n?e:b.byId(this.id+"_"+a.id+"_"+n+"_group"));h.create("td",{innerHTML:E.encode(c.name)||"",align:this._align},h.create("tr",{},h.create("tbody",{},h.create("table",{width:"95%","class":"esriLegendLayerLabel"},e))));d=a.dynamicLayerInfos||a.layerInfos;n=!1;d&&d.length&&(n=q.some(d,function(a){return!!a.drawingInfo}));if(a.legendResponse)g=
g||this._buildLegendItems_Tools(a,c,e);else if(a.renderer||n)g=g||this._buildLegendItems_Renderer(a,c,e)}return g},_getReallyVisibleLayers:function(a,b){if(!a||!b||!b.length)return[];var c=[],d=[],h;for(h=0;h<a.length;h++)if(a[h].subLayerIds){if(-1===q.indexOf(b,a[h].id)||-1<q.indexOf(d,a[h].id))d=d.concat(a[h].subLayerIds)}else-1<q.indexOf(b,a[h].id)&&-1===q.indexOf(d,a[h].id)&&c.push(a[h].id);return c},_buildLegendItems_Tools:function(c,d,g){var e=d.parentLayerId,n=this.map.getScale(),f=!1,u=function(a,
b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(c,d,n)){var p=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===c.declaredClass||"esri.layers.ArcGISMapServiceLayer"===c.declaredClass)){var l=this._getEffectiveScale(c,d);
if(l.minScale&&l.minScale<n||l.maxScale&&l.maxScale>n)p=!1}if(p){var n=u(c.legendResponse.layers,d),m=n.legendType,r=n.layerType,v=n.legend;if(v){"esri.layers.ArcGISImageServiceLayer"!==c.declaredClass&&this._sanitizeLegendResponse(c,n,d);g=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);var x=h.create("tbody",{},g);(c._hoverLabel||c._hoverLabels)&&this._createHoverAction(g,c,d);var k=[];q.forEach(v,function(a){if(!(10.1<=c.version&&!a.values&&1<v.length)||
!c._hideDefaultSymbol&&"\x3call other values\x3e"!==a.label&&(a.label||"esri.layers.ArcGISImageServiceLayer"===c.declaredClass&&10.3<=c.version||"Raster Layer"===r)){var b=a.label;if(a.url&&0===a.url.indexOf("http")||a.imageData&&0<a.imageData.length)f=!0,b&&-1!==q.indexOf(k,b)||(k.push(b),this._buildRow_Tools(a,x,c,d.id,m))}},this)}}}f&&(a.set(b.byId(this.id+"_"+c.id+"_"+d.id),"display","block"),-1<e&&(a.set(b.byId(this.id+"_"+c.id+"_"+e+"_group"),"display","block"),this._findParentGroup(c.id,c,
e)));return f},_getLayerInfos:function(a){var b=new d,c=a.dynamicLayerInfos||a.layerInfos;if(c&&c.length)if(q.some(c,function(a){return!!a.drawingInfo}))b.resolve(a);else{var h=a.url,g=h.indexOf("?"),h=-1==g?h+"/layers":h.substring(0,g)+"/layers"+h.substring(g,h.length);w({url:h,content:{f:"json"},callbackParamName:"callback",load:function(d,h){d.layers?(q.forEach(c,function(a){var b=q.filter(d.layers,function(b){return a.source?b.id===a.source.mapLayerId:b.id===a.id});b&&b[0]&&b[0].drawingInfo&&
(a.drawingInfo=b[0].drawingInfo,a.fields=b[0].fields)}),b.resolve(a)):b.reject(a)},error:function(c){b.reject(a)}})}return b},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=k.getObject("layerDefinition.drawingInfo.renderer",!1,c);var h,g;a||(a=k.getObject("drawingInfo.renderer",!1,c));q.some(d,function(a){if(a.values)return!0})&&q.some(d,function(a,b){a.values||(g=b,h=a);return!!h});a?"uniqueValue"===a.type?h&&(d.splice(g,1),d.push(h)):"classBreaks"===
a.type&&(h&&d.splice(g,1),d.reverse(),h&&d.push(h)):h&&(d.splice(g,1),d.push(h));b._sanitized=!0}},_buildRow_Tools:function(a,b,c,d,e){var n=h.create("tr",{},b),f;this.alignRight?(b=h.create("td",{align:this._isRightToLeft?"left":"right"},n),f=h.create("td",{align:this._isRightToLeft?"left":"right",width:35},n)):(f=h.create("td",{width:35,align:"center"},n),b=h.create("td",{},n));n=a.url;(!g("ie")||9<=g("ie")||9>g("ie")&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&a.imageData&&0<a.imageData.length?
n="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(n=c.url+"/"+d+"/images/"+a.url,(d=c._getToken())&&(n+="?token\x3d"+d));d=h.create("img",{src:n,border:0,style:"opacity:"+c.opacity},f);a=h.create("td",{innerHTML:E.encode(a.label),align:this._align},h.create("tr",{},h.create("tbody",{},h.create("table",{width:"95%",dir:"ltr"},b))));e&&"Stretched"===e&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass&&(a.style.verticalAlign="top",a.style.lineHeight="1",d.style.marginBottom=
"-1px",d.style.display="block",b.style.verticalAlign="top");9>g("ie")&&(d.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getVariables:function(a,b,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?q.filter(a,function(a){return!(!a||a.field!==b||a.normalizationField!=c)}):a},_getFieldAlias:function(a,b,c){var d=b.infoTemplate||
(b.infoTemplates&&c&&b.infoTemplates[c.id]?b.infoTemplates[c.id].infoTemplate:null),d=d&&d.getFieldInfo&&d.getFieldInfo(a);a=k.isFunction(a)?null:this.getField(b,a,c);b=d||a;c="";b&&(c=d&&d.label||a&&a.alias||b.name||b.fieldName);return c},_getDomainName:function(a,b,c,d){var h;a&&!k.isFunction(a)&&(h=(c=(a=this.getField(c,a,d))&&c.getDomain?c.getDomain(a.name):null)&&c.codedValues?c.getName(b):null);return h},_getRampTitle:function(a,b,c){var d,h=a.field,g=a.normalizationField,n=!1,e=!1,f=!1,h=k.isFunction(h)?
null:h,g=k.isFunction(g)?null:g;if(a.legendOptions&&a.legendOptions.title)d=a.legendOptions.title;else if(a.valueExpressionTitle)d=a.valueExpressionTitle;else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var u=b.renderer.authoringInfo.visualVariables;for(a=0;a<u.length;a++){var p=u[a];if("colorInfo"===p.type&&"ratio"===p.style){n=!0;break}else if("colorInfo"===p.type&&"percent"===p.style){e=!0;break}else if("colorInfo"===p.type&&"percentTotal"===p.style){f=!0;
break}}}(n=f&&"showRatioPercentTotal"||e&&"showRatioPercent"||n&&"showRatio"||g&&"showNormField"||h&&"showField"||null)&&(d=B.substitute({field:h&&this._getFieldAlias(h,b,c),normField:g&&this._getFieldAlias(g,b,c)},"showField"===n?"${field}":this._i18n[n]))}return d},_getRendererTitle:function(a,b,c){var d;if(a){var h,g,n;"esri.renderer.ClassBreaksRenderer"===a.declaredClass&&(h=a.attributeField,g=a.normalizationField,n="percent-of-total"===a.normalizationType);h=k.isFunction(h)?null:h;g=k.isFunction(g)?
null:g;a.legendOptions&&a.legendOptions.title?d=a.legendOptions.title:a.valueExpressionTitle?d=a.valueExpressionTitle:(a=g&&"showNormField"||(n?"showNormPct":null)||h&&"showField"||null)&&(d=B.substitute({field:h&&this._getFieldAlias(h,b,c),normField:g&&this._getFieldAlias(g,b,c)},"showField"===a?"${field}":this._i18n[a]))}return d},_buildLegendItems_Renderer:function(c,d,g){var n=d.parentLayerId,e=this.map,f=e.getScale(),u,p=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(c,d,f)){var l,
m,r,v,x,w,z;m="esri.layers.ArcGISImageServiceVectorLayer"===c.declaredClass?c.renderer.renderer:d&&d.drawingInfo?Y.fromJson(k.clone(d.drawingInfo.renderer)):c.isFeatureReductionActive&&c.isFeatureReductionActive()?c.getFeatureReductionRenderer():c.renderer;if("esri.renderer.ScaleDependentRenderer"===m.declaredClass&&(m=(e="zoom"===m.rangeType?m.getRendererInfoByZoom(e.getZoom()):m.getRendererInfoByScale(f))&&e.renderer,!m))return!1;e=m&&m.authoringInfo&&"relationship"===m.authoringInfo.type;if("esri.renderer.StretchRenderer"!==
m.declaredClass){var A=this._getVariables(m),t=q.filter(A,function(a){return!!a}).length,C=A[0],J=A[1],A=A[2],F,G,D,L,H;C&&(r=this._getMedianColor(m,C),C.field&&(x=k.isFunction(C.field)?null:this.getField(c,C.field,d)),F=!(C.legendOptions&&!1===C.legendOptions.showLegend));J&&(J.field&&(z=k.isFunction(J.field)?null:this.getField(c,J.field,d)),G=!(J.legendOptions&&!1===J.legendOptions.showLegend));A&&(A.field&&(w=k.isFunction(A.field)?null:this.getField(c,A.field,d)),D=!(A.legendOptions&&!1===A.legendOptions.showLegend))}if("esri.renderer.HeatmapRenderer"===
m.declaredClass)u=p=!0,this._showHeatRamp(c,d,m,g);else if("esri.renderer.DotDensityRenderer"===m.declaredClass)u=p=!0,this._showDotDensityLegend(c,d,m,g);else if("esri.renderer.TemporalRenderer"===m.declaredClass)u=p=!0,f=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),l=h.create("tbody",{},f),(c._hoverLabel||c._hoverLabels)&&this._createHoverAction(f,c,d),m.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===m.latestObservationRenderer.declaredClass&&
this._buildRow_Renderer(c,m.latestObservationRenderer.symbol,r,E.encode(m.latestObservationRenderer.label)||this.NLS_currentObservations,null,l),m.observationRenderer&&"esri.renderer.SimpleRenderer"===m.observationRenderer.declaredClass&&this._buildRow_Renderer(c,m.observationRenderer.symbol,r,E.encode(m.observationRenderer.label)||this.NLS_previousObservations,null,l);else if("esri.renderer.UniqueValueRenderer"===m.declaredClass){if(m.infos&&0<m.infos.length){u=p=!0;if(m.legendOptions&&m.legendOptions.title||
m.valueExpressionTitle)f=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),l=h.create("tbody",{},f),t=m.legendOptions&&m.legendOptions.title?m.legendOptions.title:m.valueExpressionTitle,this._buildRow_Renderer(c,null,r,E.encode(t),null,l);f=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);l=h.create("tbody",{},f);(c._hoverLabel||c._hoverLabels)&&this._createHoverAction(f,c,d);m.attributeField&&A&&this._addSubHeader(l,this._getFieldAlias(m.attributeField,
c,d));if(e){var K=m.authoringInfo;H=K.focus;var t=K.numClasses,M=K.field1.field,f=K.field2.field;if(t&&M&&f){var y=K.field1.normalizationField,K=K.field2.normalizationField,P=y&&this._i18n.showNormField||M&&"${field}",U=K&&this._i18n.showNormField||f&&"${field}",M=B.substitute({field:this._getFieldAlias(M,c,d),normField:y&&this._getFieldAlias(y,c,d)},P),f=B.substitute({field:this._getFieldAlias(f,c,d),normField:K&&this._getFieldAlias(K,c,d)},U),y={shapeDescriptor:ba,rotation:this._getRotationAngleForFocus(H)||
0};this._buildRow_Renderer(c,null,null,E.encode(M),null,l,null,y);y.rotation+=90;this._buildRow_Renderer(c,null,null,E.encode(f),null,l,null,y);this._drawRelationshipLegend(g,{numClasses:t,focus:H,uvInfos:m.infos})}}else{var Q=[];q.forEach(m.infos,function(a){var b=null;this._isLayerEditable(c)&&c.types&&(b=this._getTemplateFromTypes(c.types,a.value));var h=a.label;null==h&&(h=this._getDomainName(m.attributeField,a.value,c,d)||a.value);-1===q.indexOf(Q,h)&&(Q.push(h),this._buildRow_Renderer(c,a.symbol,
r,E.encode(h),b,l))},this)}}H=!e&&this._displayDefaultSymbol(c,m,g)}else if("esri.renderer.ClassBreaksRenderer"===m.declaredClass){if(m.infos&&0<m.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===c.declaredClass)u=p=!0,L=this._isUnclassedRenderer(m),C||1!==m.infos.length||(v=(v=m.infos[0])&&v.symbol),L||(f=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),l=h.create("tbody",{},f),t=this._getRendererTitle(m,c,d),this._buildRow_Renderer(c,null,r,E.encode(t),
null,l)),f=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),l=h.create("tbody",{},f),(c._hoverLabel||c._hoverLabels)&&this._createHoverAction(f,c,d),L&&A&&D||(e=m.infos.slice(0).reverse(),q.forEach(e,function(a){var b=a.label;null!=b||L||(b=a.minValue+" - "+a.maxValue);this._buildRow_Renderer(c,a.symbol,r,E.encode(b),null,l)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==c.declaredClass||c.renderer.style!==N.STYLE_SCALAR&&c.renderer.style!==N.STYLE_SINGLE_ARROW||
(this._buildRow_Renderer(c,m.defaultSymbol,null,"",null,l),c._hideDefaultSymbol=!0);L||(H=this._displayDefaultSymbol(c,m,g))}else if("esri.renderer.StretchRenderer"===m.declaredClass){u=p=!0;f=h.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},g);l=h.create("tbody",{},f);var O=this;c.renderingRule?c.getRenderingRuleServiceInfo(c.renderingRule).then(function(a){var b=a&&a.minValues&&0<a.minValues.length&&a.maxValues&&0<a.maxValues.length;a&&1<a.bandCount||!b?O._legendRequest(c).then(function(a){O._processLegendResponse(c,
a)}):O._createStretchLegend(l,m,a.minValues[0],a.maxValues[0])}):this.createStretchLegend(l,m,c.serviceInfo.minValues[0],c.serviceInfo.maxValues[0])}else"esri.renderer.SimpleRenderer"===m.declaredClass&&(u=p=!0,f=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),l=h.create("tbody",{},f),(c._hoverLabel||c._hoverLabels)&&this._createHoverAction(f,c,d),v=null,this._isLayerEditable(c)&&c.templates&&0<c.templates.length&&(v=c.templates[0]),e=1<t?null:x&&F||z&&G||w&&
D,this._buildRow_Renderer(c,m.symbol,r,E.encode(e?this._getRampTitle(1<t?null:C||J||A,c,d):m.label),v,l),v=C?null:m.symbol,e&&(x=z=w=null));u&&(C&&F&&(C.field||C.valueExpression)&&this._showGradientRamp(c,d,m,null,g,C,x,null,A&&D?!0:!1),A&&D&&(A.field||A.valueExpression)&&(u=C&&F||"esri.renderer.UniqueValueRenderer"===m.declaredClass?!1:!0,this._showSizeLegend(c,d,m,A,r,g,w,null,u)),J&&G&&(J.field||J.valueExpression)&&this._showGradientRamp(c,d,m,v&&!v.url&&v.color?v.color:this.transparencyRampColor,
g,J,z,null,!1));H||L&&!F&&!D&&!G||(H=this._displayDefaultSymbol(c,m,g));p=p||H}p&&(a.set(b.byId(this.id+"_"+c.id+"_"+d.id),"display","block"),-1<n&&(a.set(b.byId(this.id+"_"+c.id+"_"+n+"_group"),"display","block"),this._findParentGroup(c.id,n)));return p},_createStretchLegend:function(a,b,c,d){var g=h.create("tr",{},a),n;n=h.create("td",{rowspan:2,"class":"esriStretchLegend"},g);b=h.toDom(this._addColorRamp(b.colorRamp));h.place(b,n);h.create("td",{},g).innerHTML=this._i18n.high+": "+Math.round(d*
Math.pow(10,3))/Math.pow(10,3);a=h.create("tr",{},a);h.create("td",{},a).innerHTML=this._i18n.low+": "+Math.round(c*Math.pow(10,3))/Math.pow(10,3)},_addColorRamp:function(a){a||(a={algorithm:"hsv",fromColor:[0,0,0,1],toColor:[255,255,255,1]});var b=this._generateColorRampDivs(a);a.label="\x3cdiv class\x3d'esriStretchLegendGradientLabel'\x3e"+b+"\x3c/div\x3e";return a.label},_generateColorRampDivs:function(a){if(a){var b,c="";"multipart"===a.type?(b=100/a.colorRamps.length,q.forEach(a.colorRamps.reverse(),
function(a){c+=this._generateSingleGradientDiv(a.fromColor,a.toColor,b)},this)):c=this._generateSingleGradientDiv(a.fromColor,a.toColor,100);return c}},_generateSingleGradientDiv:function(a,b,c){if(a&&b){var d,h="";a=a.toRgb?a.toRgb():a;b=b.toRgb?b.toRgb():b;d="(0deg, rgb("+a.slice(0,3).join()+"), rgb("+b.slice(0,3).join()+"));";q.forEach(["-webkit-linear-gradient","-o-linear-gradient","-moz-linear-gradient","linear-gradient"],function(a){h+="background: "+a+d});return"\x3cdiv class\x3d'esriStretchLegendSingleGradient' style\x3d'height:"+
c+"%;"+h+"'\x3e\x3c/div\x3e"}},_isLayerEditable:function(a){return"function"===typeof a.isEditable&&a.isEditable()},_isUnclassedRenderer:function(a,b){var c;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,b,c){var d;!a._hideDefaultSymbol&&b.defaultSymbol&&(d=!0,c=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
c),c=h.create("tbody",{},c),this._buildRow_Renderer(a,b.defaultSymbol,null,E.encode(b.defaultLabel)||"others",null,c));return d},_showGradientRamp:function(a,b,c,d,g,n,e,f,u){u=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(u?"":" esriLegendSubFragment")},g);g=h.create("tbody",{},u);(a._hoverLabel||a._hoverLabels||f)&&this._createHoverAction(u,a,b,f);(e||n.valueExpression||n.legendOptions&&n.legendOptions.title)&&this._addSubHeader(g,this._getRampTitle(n,a,b));
e=n.field;var p;e&&(p=k.isFunction(e)?null:this.getField(a,e,b));(b=this._getRampStops(c,n,d,p&&"esriFieldTypeDate"===p.type))&&b.length&&this._drawGradientRamp(g,b,!0,a,this._getRampBorderColor(c),!!d)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c,d){var h,g,n,e,f=!1;b.colors||b.opacityValues?(g=b.maxDataValue-b.minDataValue,
h=q.map([0,.25,.5,.75,1],function(a){n=b.minDataValue+a*g;return Number(n.toFixed(6))}),this._checkPrecision(0,4,h)):b.stops&&(h=q.map(b.stops,function(a){return a.value}),(f=q.some(b.stops,function(a){return!!a.label}))&&(e=q.map(b.stops,function(a){return a.label})));var u=h[0],p,l;g=h[h.length-1]-u;return q.map(h,function(n,r){c?(p=new m(c.toRgba()),l=a.getOpacity(n,{opacityInfo:b}),null!=l&&(p.a=l)):p=a.getColor(n,{colorInfo:b});var q="";if(f)q=e[r];else{var q=d?D.formatDate(n,D.timelineDateFormatOptions):
F.format(n),v="";0===r?v=this._specialChars.lt+" ":r===h.length-1&&(v=this._specialChars.gt+" ");q=v+q}return{value:n,color:p,offset:1-(n-u)/g,label:q}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,h=c[a],g=c[d],n=c[b],e=Math.floor(h),f=Math.floor(g),u=Math.floor(n);e===h&&u===n&&f!==g&&e!==f&&u!==f&&(c[d]=f);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if("esri.renderer.SimpleRenderer"===a.declaredClass)b=a.symbol;
else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(b,c,d,n,e,f){var u=h.create("tr",{},b),p,l,r,v,k,w=c.length-1,z;v=0;this.alignRight?(b=h.create("td",{align:this._isRightToLeft?"left":"right"},u),p=h.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},u)):(p=h.create("td",{width:this.gradientWidth,
align:"center"},u),b=h.create("td",{},u));u=e&&0<e.a&&!(240<=e.r&&240<=e.g&&240<=e.b);l=h.create("div",{"class":u?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},p);p=h.create("div",{"class":"esriLegendColorRamp"+(f?" esriLegendTransparencyRamp":"")},l);f=a.get(p,"width");u&&(e=9>g("ie")?e.toHex():"rgba("+e.toRgba().join(",")+")",a.set(p,"border",this.colorRampBorder+" "+e));d?(e=this.gradientHeight*w,a.set(p,"height",e+"px")):e=a.get(p,"height");a.set(l,
"height",e+"px");u=x.createSurface(p,f,e);9>g("ie")&&(v=u.getEventSource(),a.set(v,"position","relative"),a.set(v.parentNode,"position","relative"),v=1);try{d&&q.forEach(c,function(a,b){a.offset=b/w}),k=u.createRect({x:-v,y:-v,width:f+v,height:e+v}),k.setFill({type:"linear",x1:0,y1:0,x2:0,y2:e,colors:c}).setStroke(null),u.createRect({width:f,height:e}).setFill(new m([255,255,255,1-n.opacity])).setStroke(null),this._surfaceItems.push(u)}catch(pa){u.clear(),u.destroy()}q.forEach(c,function(a,b){a.label&&
(z="top:"+100*a.offset+"%;",a="",0===b&&(a+=" esriLegendColorRampTickFirst"),b===c.length-1&&(a+=" esriLegendColorRampTickLast"),h.create("div",{"class":"esriLegendColorRampTick"+a,innerHTML:"\x26nbsp;",style:z},l))});r=h.create("div",{"class":"esriLegendColorRampLabels",style:{height:e+this.gradientHeight+"px"}},b);d?q.forEach(c,function(a){h.create("div",{"class":"esriLegendColorRampLabel",innerHTML:E.encode(a.label)||"\x26nbsp;"},r)}):(h.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},
r),h.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(e+this.gradientHeight-2*this.gradientHeight)+"px;"},r))},_showHeatRamp:function(a,b,c,d,g){var e,n=c.field;e=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=h.create("tbody",{},e);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(e,a,b,g);(n=n&&this.getField(a,n,b))&&this._addSubHeader(d,this._getFieldAlias(n.name,a,b));b=this._getHeatmapStops(c);b.length&&
this._drawGradientRamp(d,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,h,g;b&&b[0]?(c=b.length-1,(a=b[0]&&null!=b[0].ratio)?(a=b[c])&&1!==a.ratio&&(b=b.slice(0),b.push({ratio:1,color:a.color}),c++):(d=b[0].value,h=b[c].value-d,b=q.map(b,function(a){return{color:a.color,ratio:(a.value-d)/h}}))):a&&a[0]&&(c=a.length-1,g=1/(a.length-1),b=q.map(a,function(a,b){return{color:a,ratio:b*g}}));b=q.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,
label:d,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,c,d){var g=c.legendOptions,e,n,f,u,p,l,m,r=this.dotDensitySwatchSize,v=Math.round(r/2);g&&(n=g.backgroundColor,f=g.outline,u=g.valueUnit,p=g.dotCoverage);p=(p||this.dotCoverage)/100;m=Math.round(r*r/Math.pow(c.dotSize,2)*p);d=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);l=h.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,a,b);this._addSubHeader(l,
B.substitute({value:c.dotValue,unit:u||""},this.NLS_dotValue));q.forEach(c.fields,function(d){d=k.mixin({},d);d.numPoints=m;e=new Q(c._generateImageSrc(r,r,[d],{x:0,y:0},{x:r,y:r},n),f||c.outline,r,r);d=this.getField(a,d.name,b)||d;this._buildRow_Renderer(a,e,null,E.encode(this._getFieldAlias(d.name,a,b)),null,l,{type:"path",path:"M "+-v+","+-v+" L "+v+","+-v+" L "+v+","+v+" L "+-v+","+v+" L "+-v+","+-v+" E"})},this)},_showSizeLegend:function(a,b,c,d,g,e,n,f,u){var p=d.legendOptions,p=p&&p.customValues;
g=this._getSizeSymbol(c,g);if((!d.valueUnit||"unknown"===d.valueUnit)&&g&&(p||null!=d.minSize&&null!=d.maxSize&&null!=d.minDataValue&&null!=d.maxDataValue||d.stops&&!(1>=d.stops.length))){u=h.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(u?"":" esriLegendSubFragment")},e);e=h.create("tbody",{},u);(a._hoverLabel||a._hoverLabels||f)&&this._createHoverAction(u,a,b,f);(n||d.valueExpression||d.legendOptions&&d.legendOptions.title)&&this._addSubHeader(e,this._getRampTitle(d,
a,b));n=(u=(f=d.field)&&!k.isFunction(f))&&"cluster_count"===f.toLowerCase();b=(b=u?a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(f):this.getField(a,f,b):null)&&"esriFieldTypeDate"===b.type;var p=p||this._getDataValues(c,g,d,b,n),l,m=p.length-1;for(f=m;0<=f;f--)u=p[f],g=V.fromJson(g.toJson()),this._applySize(g,c,d,u),u=b?D.formatDate(u,D.timelineDateFormatOptions):F.format(u),l="",f===m?l=this._specialChars.gt+" ":0===f&&(l=n&&1===p[f]?"":this._specialChars.lt+
" "),l="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+E.encode(l+u)+"\x3c/span\x3e",this._buildRow_Renderer(a,g,null,l,null,e)}},_getSizeSymbol:function(a,b){var c,d;if("esri.renderer.SimpleRenderer"===a.declaredClass)c=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)c=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?
null:c)if(c=V.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?c.setColor(new m(this.sizeRampDarkColor)):(c.setColor(new m(this.sizeRampLightColor)),c.setOutline&&(a=new R,a.setColor(new m(this.sizeRampDarkColor)),a.setWidth(1.5),c.setOutline(a)));return c},_getDataValues:function(a,b,c,d,h){if(h){var g;q.some([5,3,2],function(h){h=this._getDataValuesByCount(a,b,c,d,h);this._hasFractionalValues(h)||(g=h);return!!g},this);return g}return this._getDataValuesByCount(a,b,c,d,5)},_getDataValuesByCount:function(a,
b,c,d,h,g){h=null==h?5:h;g=null==g?20:g;var e=a.getSizeRangeAtScale(c,this.map.getScale());h=this._interpolateSizeRange(e,h);var n=this._getDataRange(c),f=q.map(h,function(a){return this._getDataValueFromSize(a,n,e)},this);if(!d){var u,f=F.round(f);for(d=1;d<f.length-1;d++)if(u=this._roundDataValue(a,b,c,f[d],f[d-1],g))f[d]=u[0],h[d]=u[1]}return f},_hasFractionalValues:function(a){return q.some(a,function(a){return a!==Math.floor(a)})},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,
max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var c=a.minSize;a=(a.maxSize-c)/(b-1);var d,h=[];for(d=0;d<b;d++)h.push(c+a*d);return h},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var h=b.min;b=b.max;return a<=d?h:a>=c?b:(a-d)/(c-d)*(b-h)+h},_roundDataValue:function(a,b,c,d,h,g){var e=this._getSize(b,a,c,d);h=this._getSize(b,a,c,h);var n,f=F.getDigits(d),u=f.integer,f=f.fractional,p,l,m,r,q,v,x,k,w,z,A;0<d&&1>d&&(n=Math.pow(10,
f),d*=n,u=F.getDigits(d).integer);for(--u;0<=u&&(p=Math.pow(10,u),f=Math.floor(d/p)*p,p*=Math.ceil(d/p),null!=n&&(f/=n,p/=n),l=(f+p)/2,l=F.round([f,l,p],{indexes:[1]})[1],m=this._getSize(b,a,c,f),r=this._getSize(b,a,c,p),q=this._getSize(b,a,c,l),v=F.getPctChange(e,m,h,null),x=F.getPctChange(e,r,h,null),k=F.getPctChange(e,q,h,null),w=v.prev<=g,z=x.prev<=g,w&&z&&(v.prev<=x.prev?(w=!0,z=!1):(z=!0,w=!1)),w?A=[f,m]:z?A=[p,r]:k.prev<=g&&(A=[l,q]),!A);u--);return A},_applySize:function(a,b,c,d){var h=a.type;
b=this._getSize(a,b,c,d);switch(h){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":h=a.width;c=a.height;a.setHeight(b);a.setWidth(h/c*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,d,g,e,n,f){var u=!!f,p=h.create("tr",{},
e),l;if(this.alignRight){if(e=h.create("td",{align:this._isRightToLeft?"left":"right"},p),b||u)l=h.create("td",{align:this._isRightToLeft?"left":"right",width:35},p)}else{if(b||u)l=h.create("td",{width:35,align:"center"},p);e=h.create("td",{},p)}var m=p=30,r;if(b)if("simplemarkersymbol"==b.type)p=Math.min(Math.max(p,b.size+12),125),m=Math.min(Math.max(m,b.size+12),125);else if("picturemarkersymbol"==b.type)p=Math.min(Math.max(p,b.width),125),m=Math.min(b.height||m,125);else if("textsymbol"==b.type){var q,
v;b.text||(q=b.text,v=!0,b.setText(this.defaultText));p=Math.min(Math.max(p,b.getWidth()+12),125);m=Math.min(Math.max(m,b.getHeight()+12),125);v&&b.setText(q)}if(b||u)r=h.create("div",{style:"width:"+p+"px;height:"+m+"px;"},l);B.isDefined(d)&&"number"===typeof d&&(d=""+d);h.create("td",{innerHTML:d||"",align:this._align},h.create("tr",{},h.create("tbody",{},h.create("table",{width:"95%"},e))));if(b||u)a=this._drawSymbol(r,b,c,p,m,g,a,n,f),this._surfaceItems.push(a)},_addSubHeader:function(a,b){a=
h.create("tr",{},a);a=h.create("td",{align:this._align,colspan:2},a);h.create("td",{innerHTML:E.encode(b)||"",align:this._align},h.create("tr",{},h.create("tbody",{},h.create("table",{width:"95%"},a))))},_drawSymbol:function(b,c,d,h,e,n,f,u,p){var l=c&&V.fromJson(c.toJson()),r=f.opacity;c=!!p;if(l)if(d&&l.setColor(new m(d.toRgba())),"simplelinesymbol"===l.type||"cartographiclinesymbol"===l.type||"textsymbol"===l.type){if(!l.color)return;d=l.color.toRgba();d[3]*=r;l.color.setColor(d)}else"simplemarkersymbol"===
l.type||"simplefillsymbol"===l.type?(l.color&&(d=l.color.toRgba(),d[3]*=r,l.color.setColor(d)),l.outline&&l.outline.color&&(d=l.outline.color.toRgba(),d[3]*=r,l.outline.color.setColor(d))):"picturemarkersymbol"===l.type&&(b.style.opacity=r,b.style.filter="alpha(opacity\x3d("+100*r+"))");b=x.createSurface(b,h,e);9>g("ie")&&(d=b.getEventSource(),a.set(d,"position","relative"),a.set(d.parentNode,"position","relative"));n=c?p.shapeDescriptor:this._getDrawingToolShape(l,n)||V.getShapeDescriptors(l);var q,
r=(d=n.defaultShape)&&"text"===d.type;try{r&&!d.text&&(d.text=this.defaultText),q=b.createShape(u||d).setFill(n.fill).setStroke(n.stroke),r&&q.setFont(n.font)}catch(pa){b.clear();b.destroy();return}var v=q.getBoundingBox();u=v.width;n=v.height;var r=-(v.x+u/2),w=-(v.y+n/2);d=b.getDimensions();r={dx:r+d.width/2,dy:w+d.height/2};if(l&&"simplemarkersymbol"===l.type&&"path"===l.style)h=f._getScaleMatrix(v,l.size),q.applyTransform(z.scaleAt(h.xx,h.yy,{x:d.width/2,y:d.height/2}));else if(u>h||n>e)f=u/h>
n/e,h=((f?h:e)-5)/(f?u:n),k.mixin(r,{xx:h,yy:h});q.applyTransform(r);c&&q.applyTransform(z.rotategAt(p.rotation,u/2,n/2));return b},_getDrawingToolShape:function(a,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};
break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_drawRelationshipLegend:function(a,b){var c=b.focus,d=b.numClasses,h=aa[d],g=!!c,n=Math.sqrt(Math.pow(75,2)+Math.pow(75,2)),e={};b.uvInfos.forEach(function(a){e[a.value]={label:a.label,fill:this._getSymbolColor(a.symbol)}},this);b=[];for(var f=0;f<d;f++){for(var u=
[],p=0;p<d;p++)u.push(e[h[f][p]].fill);b.push(u)}h=this._getRelationshipCornerLabels(c,e);a=this._drawRampLayout(a,h,n,g);a=x.createSurface(a,n,n);g||(a.rawNode.style.margin="-15px -15px -18px -15px");b=I.create2DColorRamp({surface:a,colors:b,numClasses:d,size:75});d=(n-75)/2;n=(n-75)/2;b.applyTransform(z.translate(d,n));g&&b.applyTransform(z.rotategAt(this._getRotationAngleForFocus(c),37.5,37.5));b=a.createGroup();h={width:1,color:"#555555"};f=a.defNode;this._createArrowMarker(f,"start");this._createArrowMarker(f,
"end");f=b.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(h);h=b.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(h);this._setLineArrow(f.rawNode,"left",c);this._setLineArrow(h.rawNode,"right",c);b.applyTransform(z.translate(d,n));g&&b.applyTransform(z.rotategAt(-45,37.5,37.5));this._surfaceItems.push(a)},_drawRampLayout:function(a,b,c,d){var g=h.create("div",{style:{padding:"10px"}},a);a=c+"px";c+="px";d?(d=h.create("div",{style:{display:"flex"}},g),h.create("div",{class:"esriLegendRelationshipLabel",
style:{alignSelf:"center",maxWidth:a,textAlign:"right"},innerHTML:b.left},d),g=h.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},d),h.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:b.right},d),d=h.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:b.top},g),d=h.create("div",{style:{height:c,width:c}},g),g=h.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",
maxWidth:a},innerHTML:b.bottom},g)):(g=h.create("div",{style:{display:"table",color:"#555555"}},g),d=h.create("div",{style:{display:"table-row"}},g),c=h.create("div",{style:{display:"table-row"}},g),g=h.create("div",{style:{display:"table-row"}},g),h.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"bottom"},innerHTML:b.left},d),h.create("div",{style:{display:"table-cell"}},d),h.create("div",{class:"esriLegendRelationshipLabel",
style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"bottom"},innerHTML:b.top},d),h.create("div",{style:{display:"table-cell"}},c),d=h.create("div",{style:{display:"table-cell"}},c),h.create("div",{style:{display:"table-cell"}},c),h.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"top"},innerHTML:b.bottom},g),h.create("div",{style:{display:"table-cell"}},g),h.create("div",{class:"esriLegendRelationshipLabel",
style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"top"},innerHTML:b.right},g));return d},_getSymbolColor:function(a){if(a)return"simplelinesymbol"===a.type||"simplemarkersymbol"===a.type&&(a.style===O.STYLE_X||a.style===O.STYLE_CROSS)?(a=a.getStroke())&&a.color:a.getFill()},_getRotationAngleForFocus:function(a){var b=W[a];a&&null==b&&(b=W.HH);return b},_setLineArrow:function(a,b,c){var d=this.id+"_arrowStart",h=this.id+"_arrowEnd";b="left"===b;switch(c){case "HL":a.setAttribute(b?
"marker-start":"marker-end","url(#"+(b?h:d)+")");break;case "LL":a.setAttribute("marker-start","url(#"+h+")");break;case "LH":a.setAttribute(b?"marker-end":"marker-start","url(#"+(b?d:h)+")");break;default:a.setAttribute("marker-end","url(#"+d+")")}},_createArrowMarker:function(a,b){var c="start"===b,d=this.id+(c?"_arrowStart":"_arrowEnd");b=c?"0,0 5,5 0,10":"5,0 0,5 5,10";var h=c?5:0,c=document.createElementNS("http://www.w3.org/2000/svg","marker");c.setAttribute("id",d);c.setAttribute("markerWidth",
"10");c.setAttribute("markerHeight","10");c.setAttribute("refX",h);c.setAttribute("refY","5");c.setAttribute("markerUnits","strokeWidth");c.setAttribute("orient","auto");d=document.createElementNS("http://www.w3.org/2000/svg","polyline");d.setAttribute("points",b);d.setAttribute("fill","none");d.setAttribute("stroke","#555555");d.setAttribute("stroke-width","1");c.appendChild(d);a.appendChild(c)},_getRelationshipCornerLabels:function(a,b){var c=b.HH.label,d=b.LL.label,h=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:c,
bottom:d,left:h,right:b};case "HL":return{top:h,bottom:b,left:d,right:c};case "LL":return{top:d,bottom:c,left:b,right:h};case "LH":return{top:b,bottom:h,left:c,right:d};default:return{top:c,bottom:d,left:h,right:b}}},_repaintItems:function(){q.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(ca){}a.children&&k.isArray(a.children)&&q.forEach(a.children,
this._repaint,this)}},_createHoverAction:function(c,d,g,n){if(n=d._hoverLabel||d._hoverLabels&&d._hoverLabels[g.id]||n)n=E.encode(n),d.mouseMoveHandler=d.mouseMoveHandler||{},d.mouseMoveHandler[g.id]=e.connect(c,"onmousemove",k.hitch(this,function(c,d){this.mouseX=d.clientX;this.mouseY=d.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,a.set(b.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(k.hitch(this,function(c,d,g){if(c==this.mouseX&&d==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,b.byId(this.id+"_hoverLabel")){var n=b.byId(this.id+"_hoverLabel");n.innerHTML="\x3cspan\x3e"+g+"\x3c/span\x3e";a.set(n,"top",d+"px");a.set(n,"left",c+15+"px");a.set(n,"display","")}else h.create("div",{innerHTML:"\x3cspan\x3e"+g+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:d+"px",left:c+15+"px"}},document.body)},d.clientX,d.clientY,c),500)},n)),d.mouseOutHandler=d.mouseOutHandler||{},d.mouseOutHandler[g.id]=e.connect(c,"onmouseout",k.hitch(this,function(c){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,a.set(b.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;q.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)e.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)e.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;q.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();
var h;a.layerDefinitions&&a.layerDefinitions[d.id]&&(h=a.layerDefinitions[d.id]);h&&(c.definitionExpression=h);var g;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(g=a.layerDrawingOptions[d.id]);g&&(c.drawingInfo=g.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(c,d,h){var g,n=
d.dynamicLayerInfos||d.layerInfos;for(g=0;g<n.length;g++)if(h==n[g].id){-1<n[g].parentLayerId&&(a.set(b.byId(this.id+"_"+c+"_"+n[g].parentLayerId+"_group"),"display","block"),this._findParentGroup(c,d,n[g].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var h=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,n;for(g=0;g<h.length;g++)if(h[g].id===c&&h[g].subLayerIds)for(n=0;n<h[g].subLayerIds.length;n++){var e=h[g].subLayerIds[n];-1===q.indexOf(d,e)&&(d.push(e),b(e,d))}}a.layer.layerInfos&&
q.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,h=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var g=a.legendResponse.layers[d];if(b.id==g.layerId){var n,e;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==g.minScale&&a.tileInfo&&(n=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(e=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(n=Math.min(a.minScale,
g.minScale)||a.minScale||g.minScale,e=Math.max(a.maxScale,g.maxScale));if(0<n&&n<c||e>c)h=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)h=!1;return h},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],B.isDefined(a)&&(b+=" ("+a+")"));return E.encode(b)},_getEffectiveScale:function(a,
b){var c=b.minScale,d=b.maxScale;if(B.isDefined(b.parentLayerId)){a=a.layerInfos;b=b.parentLayerId;var h;for(h=a.length-1;0<=h;h--)if(a[h].id==b)if(0==c&&0<a[h].minScale?c=a[h].minScale:0<c&&0==a[h].minScale||0<c&&0<a[h].minScale&&(c=Math.min(c,a[h].minScale)),d=Math.max(d||0,a[h].maxScale||0),-1<a[h].parentLayerId)b=a[h].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return!(!a||!("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass))},isHostedTileService:function(a){var b=
/(https?:)?\/\/services.*\.arcgis\.com/i;return!("esri.layers.ArcGISTiledMapServiceLayer"!==a.declaredClass||!b.test(a.url))},getField:function(a,b,c){if(a.getField)return a.getField(b);if(c&&c.fields){var d;q.forEach(c.fields,function(a){a.name===b&&(d=a)});return d}return null}});k.mixin(X,{ALIGN_LEFT:0,ALIGN_RIGHT:1});g("extend-esri")&&k.setObject("dijit.Legend",X,C);return X})},"dojo/debounce":function(){define([],function(){return function(t,f){var k;return function(){k&&clearTimeout(k);var q=
this,e=arguments;k=setTimeout(function(){t.apply(q,e)},f)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(t,f,k,q){var e=function(e,f){return e-f},r={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(e){var f=String(e),g=f.match(r._reNumber);e={integer:0,fractional:0};g&&g[1]?(e.integer=g[1].split("").length,e.fractional=g[3]?g[3].split("").length:0):-1<f.toLowerCase().indexOf("e")&&(g=f.split("e"),f=g[0],g=g[1],f&&g&&(f=
Number(f),g=Number(g),(e=0<g)||(g=Math.abs(g)),f=r.getDigits(f),e?(f.integer+=g,f.fractional=g>f.fractional?0:f.fractional-g):(f.fractional+=g,f.integer=g>f.integer?1:f.integer-g),e=f));return e},getFixedNumbers:function(e,f){var g;g=Number(e.toFixed(f));g<e?e=g+1/Math.pow(10,f):(e=g,g-=1/Math.pow(10,f));g=Number(g.toFixed(f));e=Number(e.toFixed(f));return[g,e]},getPctChange:function(e,f,g,p){var d={prev:null,next:null},c;null!=g&&(c=e-g,d.prev=Math.floor(Math.abs(100*(f-g-c)/c)));null!=p&&(c=p-e,
d.next=Math.floor(Math.abs(100*(p-f-c)/c)));return d},round:function(f,l){f=f.slice(0);var g,p,d,c,n,b,h,a,u=l&&null!=l.tolerance?l.tolerance:2,m=l&&l.indexes,q=l&&null!=l.strictBounds?l.strictBounds:!1;if(m)m.sort(e);else for(m=[],n=0;n<f.length;n++)m.push(n);for(n=0;n<m.length;n++)if(a=m[n],l=f[a],g=0===a?null:f[a-1],p=a===f.length-1?null:f[a+1],d=r.getDigits(l),d=d.fractional){b=0;for(h=!1;b<=d&&!h;)c=r.getFixedNumbers(l,b),c=q&&0===n?c[1]:c[0],h=r.hasMinimalChange(l,c,g,p,u),b++;h&&(f[a]=c)}return f},
hasMinimalChange:function(e,f,g,p,d){e=r.getPctChange(e,f,g,p);f=null==e.prev||e.prev<=d;g=null==e.next||e.next<=d;return f&&g||e.prev+e.next<=2*d},_reAllZeros:new RegExp("\\"+k.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,format:function(e,l){l=l||{places:20,round:-1};(e=f.format(e,l))&&(e=e.replace(r._reSomeZeros,"$1").replace(r._reAllZeros,""));return e}};t("extend-esri")&&(q.numberUtils=r);return r})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),
function(t,f,k,q,e,r,m,l){function g(a){return a&&f.map(a,function(a){return new m(a)})}function p(a,b,d){var h="";0===b?h=c.lt+" ":b===d&&(h=c.gt+" ");return h+a}var d={},c={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},n={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},b={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},h={formatLength:"short",fullYear:!0},a={formatLength:"short"};t.mixin(d,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(b,c){var d=[];null==b||b instanceof Date||
(b=new Date(b));c=c||{};c=t.mixin({},c);var g=c.selector?c.selector.toLowerCase():null,e=!g||-1<g.indexOf("time"),g=!g||-1<g.indexOf("date");e&&(c.timeOptions=c.timeOptions||a,c.timeOptions&&(c.timeOptions=t.mixin({},c.timeOptions),c.timeOptions.selector=c.timeOptions.selector||"time",d.push(c.timeOptions)));g&&(c.dateOptions=c.dateOptions||h,c.dateOptions&&(c.dateOptions=t.mixin({},c.dateOptions),c.dateOptions.selector=c.dateOptions.selector||"date",d.push(c.dateOptions)));d&&d.length?(d=f.map(d,
function(a){return q.format(b,a)}),c=1==d.length?d[0]:l["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return d[b]})):c=q.format(b);return c},createColorStops:function(a){var b=a.values,c=a.colors,h=a.labelIndexes,g=a.isDate,e=a.dateFormatOptions;a=[];return a=f.map(b,function(a,n){var u=null;if(!h||-1<f.indexOf(h,n)){var l;(l=g?d.formatDate(a,e):r.format(a))&&(u=p(l,n,b.length-1))}return{value:a,color:c[n],label:u}})},updateColorStops:function(a){var b=a.stops,c=a.changes,
h=a.isDate,g=a.dateFormatOptions,e=[],n,u=f.map(b,function(a){return a.value});f.forEach(c,function(a){e.push(a.index);u[a.index]=a.value});n=r.round(u,{indexes:e});f.forEach(b,function(a,c){a.value=u[c];if(null!=a.label){var e,f=null;(e=h?d.formatDate(n[c],g):r.format(n[c]))&&(f=p(e,c,b.length-1));a.label=f}})},createClassBreakLabel:function(a){var b=a.minValue,d=a.maxValue,h=a.isFirstBreak?"":c.gt+" ";a="percent-of-total"===a.normalizationType?c.pct:"";b=null==b?"":r.format(b);d=null==d?"":r.format(d);
return h+b+a+" \u2013 "+d+a},setLabelsForClassBreaks:function(a){var b=a.classBreaks,c=a.classificationMethod,h=a.normalizationType,g=[];b&&b.length&&("standard-deviation"===c?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):a.round?(g.push(b[0].minValue),f.forEach(b,function(a){g.push(a.maxValue)}),g=r.round(g),f.forEach(b,function(a,b){a.label=d.createClassBreakLabel({minValue:0===b?g[0]:g[b],maxValue:g[b+1],isFirstBreak:0===
b,normalizationType:h})})):f.forEach(b,function(a,b){a.label=d.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:h})}))},updateClassBreak:function(a){var b=a.classBreaks,c=a.normalizationType,h=a.change,g=h.index,h=h.value,e=-1,n=-1,f=b.length;"standard-deviation"===a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===g?e=g:g===f?n=g-1:(n=g-1,e=g),-1<e&&e<f&&
(a=b[e],a.minValue=h,a.label=d.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===e,normalizationType:c})),-1<n&&n<f&&(a=b[n],a.maxValue=h,a.label=d.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===n,normalizationType:c})))},calculateDateFormatInterval:function(a){var b,c,d=a.length,h,g,e,u,p,l,m=Infinity,r;a=f.map(a,function(a){return new Date(a)});for(b=0;b<d-1;b++){h=a[b];e=[];p=Infinity;l="";for(c=b+1;c<d;c++)g=a[c],g=h.getFullYear()!==
g.getFullYear()&&"year"||h.getMonth()!==g.getMonth()&&"month"||h.getDate()!==g.getDate()&&"day"||h.getHours()!==g.getHours()&&"hour"||h.getMinutes()!==g.getMinutes()&&"minute"||h.getSeconds()!==g.getSeconds()&&"second"||"millisecond",u=n[g],u<p&&(p=u,l=g),e.push(g);p<m&&(m=p,r=l)}return r},createUniqueValueLabel:function(a){var c=a.value,h=a.fieldInfo,g=a.domain;a=a.dateFormatInterval;var e=String(c);(g=g&&g.codedValues?g.getName(c):null)?e=g:"number"===typeof c&&(e=h&&"esriFieldTypeDate"===h.type?
d.formatDate(c,a&&b[a]):r.format(c));return e},cloneColorInfo:function(a){var b;a&&(b=t.mixin({},a),b.colors=g(b.colors),b.stops=b.stops&&f.map(b.stops,function(a){a=t.mixin({},a);a.color&&(a.color=new m(a.color));return a}),b.legendOptions&&(b.legendOptions=t.mixin({},b.legendOptions)));return b},cloneOpacityInfo:function(a){var b;if(a){b=t.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=f.map(a,function(a){return t.mixin({},a)});if(a=b.legendOptions)b.legendOptions=
t.mixin({},a)}return b},cloneSizeInfo:function(a){var b;a&&(b=t.mixin({},a),b.stops&&(b.stops=f.map(b.stops,function(a){return t.mixin({},a)})),(a=b.minSize)&&"object"===typeof a&&(b.minSize=d.cloneSizeInfo(a)),(a=b.maxSize)&&"object"===typeof a&&(b.maxSize=d.cloneSizeInfo(a)),a=b.legendOptions)&&(b.legendOptions=t.mixin({},a),a=a.customValues)&&(b.legendOptions.customValues=a.slice(0));return b},getClassCodesForRelationship:function(){return t.clone({2:["L","H"],3:["L","M","H"],4:["L","M1","M2",
"H"]})},getClassValuesForRelationship:function(){return t.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});k("extend-esri")&&t.setObject("renderer.utils",d,e);return d})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define("dojo/_base/declare dojo/_base/array dojo/Deferred esri/lang jimu/utils ./LayerInfo".split(" "),function(t,f,k,q,e,r){return t(r,
{constructor:function(){},_getExtent:function(){var f=new k,l=this.layerObject.items,g=this.layerObject.fullExtent||this.layerObject.initialExtent;0===l.length?f.resolve(g):f.resolve(e.graphicsExtent(l));return f},_resetLayerObjectVisiblity:function(e){var f=e?e[this.id]:null;if(f){var g={},p;for(p in e)e.hasOwnProperty(p)&&"function"!==typeof e[p]&&(g[p]=e[p].visible);this._setSubLayerVisibleByCheckedInfo(g);this._setTopLayerVisible(f.visible)}},_setSubLayerVisibleByCheckedInfo:function(e){f.forEach(this.newSubLayers,
function(f){q.isDefined(e[f.id])&&f.layerObject.setVisibility(e[f.id])},this)},_initVisible:function(){var e=!1,f;for(f=0;f<this.newSubLayers.length;f++)e=e||this.newSubLayers[f].layerObject.visible;e&&(this._visible=!0)},_setTopLayerVisible:function(e){this._visible=e?!0:!1;f.forEach(this.newSubLayers,function(e){e.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var e=[],l=this.layerObject.getFeatureLayers();f.forEach(l,function(g){g=this._layerInfoFactory.create({layerObject:g,
title:g.label||g.title||g.name||g.id||" ",id:g.id||" ",subId:g.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});e.push(g);g.init()},this);this._markInvalidSubLayerInfoThatAsRootLayer(l);return e},_markInvalidSubLayerInfoThatAsRootLayer:function(e){var l;f.forEach(e,function(g){if(l=this._getLayerInfosObj()._findTopLayerInfoById(g.id))l._flag._invalid=!0},this)},_needToRenew:function(){var e=this.layerObject.getFeatureLayers();return(e?e.length:0)===this.newSubLayers.length?
!1:!0},_obtainLayerIndexesInMap:function(){var e=[],f,g;for(g=0;g<this.newSubLayers.length;g++)(f=this._getLayerIndexesInMapByLayerId(this.newSubLayers[g].layerObject.id))&&e.push(f);return e},moveLeftOfIndex:function(e){var f;for(f=this.newSubLayers.length-1;0<=f;f--)this.map.reorderLayer(this.newSubLayers[f].layerObject,e)},moveRightOfIndex:function(e){var f;for(f=0;f<this.newSubLayers.length;f++)this.map.reorderLayer(this.newSubLayers[f].layerObject,e)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS esri/layers/FeatureLayer esri/lang".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d){return t(l,{constructor:function(c,d){},_getExtent:function(){var c=new e;c.resolve(this.layerObject.extent||this.layerObject.fullExtent);return c},_initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(c){this._visible=c;this.layerObject.setVisibility(c)},_setSubLayerVisible:function(c){var d=[],b,d=k.clone(this.originOperLayer.layerObject.visibleLayers),h;for(h in c)if(c.hasOwnProperty(h)&&"function"!==typeof c[h]){var a=c[h],
g=h.toString();b=f.indexOf(d,g);a?0>b&&d.push(g):0<=b&&d.splice(b,1)}this._setVisibleLayersBySelfFlag=!0;this.layerObject.setVisibleLayers(d)},_resetLayerObjectVisiblity:function(c){var d=c?c[this.id]:null,b=!1;if(c){d&&this.layerObject.setVisibility(d.visible);var d={},h;for(h in c)c.hasOwnProperty(h)&&"function"!==typeof c[h]&&(b=!0,d[h]=c[h].visible);b&&this._setSubLayerVisibleByCheckedInfo(d)}},_setSubLayerVisibleByCheckedInfo:function(c){var g={};this.traversal(function(b){b.isRootLayer()||d.isDefined(c[b.id])&&
b._setVisible(c[b.id])});this.traversal(function(b){0===b.getSubLayers().length&&(g[b.subId]=b._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(g)},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_serviceDefinitionRequest:function(c){return this._normalRequest(c,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var c=[];f.forEach(this.layerObject.layerInfos,function(d,b){d=this._getOperLayerFromWMSLayerInfo(d,
this);d=this._layerInfoFactory.create(d);c.push(d);d.init()},this);c.reverse();return c},_getOperLayerFromWMSLayerInfo:function(c,d){return{layerObject:this.layerObject,title:c.label||c.title||c.name||" ",id:this.id+"_"+(c.name||c.title+"-"+Math.random()),subId:c.name||"-",wms:{layerInfo:this,subId:c.name||"-",wmsLayerInfo:c},selfType:"wms",parentLayerInfo:d}},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&m.after(this.layerObject,"setVisibleLayers",k.hitch(this,
this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var c=[];this._setVisibleLayersBySelfFlag||(this.traversal(function(c){c.isRootLayer()||c._initVisible()}),this._setVisibleLayersBySelfFlag=!1);this.traversal(function(d){d.isRootLayer()||c.push(d)});this._setVisibleLayersBySelfFlag=!1;q.publish("layerInfos/layerInfo/visibleChanged",c);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/Deferred dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(t,f,k,q,e,r,m){return t(m,{constructor:function(e,g){this.layerObject=e.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var e=!1;this.traversal(function(g){if(0<=f.indexOf(g.layerObject.visibleLayers,g.subId))return e=!0});this._visible=e},_setVisible:function(e){this._visible=e?!0:!1},_setTopLayerVisible:function(e){var g=this.originOperLayer.wms;this._visible=e?!0:!1;var f={};this.traversal(function(d){0===d.getSubLayers().length&&(f[d.subId]=d._isAllSubLayerVisibleOnPath())});
g.layerInfo._setSubLayerVisible(f)},_getServiceDefinition:function(){var e=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(e)},_serviceDefinitionRequest:function(e){return this._normalRequest(e,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var e=[],g=this.originOperLayer.wms;f.forEach(g.wmsLayerInfo.subLayers,function(f){f=g.layerInfo._getOperLayerFromWMSLayerInfo(f,this);f=this._layerInfoFactory.create(f);e.push(f);f.init()},this);
return e},drawLegends:function(e){this._initLegendsNode(e)},_initLegendsNode:function(f){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var g=e.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});r(g,"load",function(){e.empty(f);var p=e.create("div",{"class":"legend-div"},f);k.place(g,p)})}else e.empty(f)},getOpacity:function(){},setOpacity:function(e){},enablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=!0},disablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=
!1},isPopupEnabled:function(){return this.originOperLayer.wms.wmsLayerInfo.showPopup},isSupportPopup:function(){var e=new q;this.originOperLayer.wms.wmsLayerInfo.queryable?e.resolve(!0):e.resolve(!1);return e},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(t,f){return t(f,
{constructor:function(f,q){},_initVisible:function(){var f=!1,q=this.originOperLayer.mapService;q&&q.layerInfo._subLayerVisible[q.subId]&&(f=!0);this._visible=f},_setTopLayerVisible:function(f){var q=this.originOperLayer.mapService;if(q){q.layerInfo._subLayerVisible[q.subId]=f?!0:!1;this._visible=f;var e={};this.traversal(function(f){0===f.getSubLayers().length&&(e[f.originOperLayer.mapService.subId]=f._isAllSubLayerVisibleOnPath())});q.layerInfo._setSubLayerVisible(e)}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/topic dojo/dom-construct ./LayerInfoForDefault ./LayerObjectFacory".split(" "),
function(t,f,k,q,e,r,m,l){return t(m,{_legendsNode:null,_layerObjectFacory:null,constructor:function(){this._layerObjectFacory=new l(this)},_resetLayerObjectVisiblity:function(){},_loadLegends:function(g){var e=new q;this.originOperLayer.mapService.layerInfo.getLegendInfo(g).then(k.hitch(this,function(d){e.resolve(d)}));return e},drawLegends:function(g,e){this._loadLegends(e).then(k.hitch(this,function(d){this._initLegendsNode(d,g)}))},_initLegendsNode:function(g,e){var d=this.originOperLayer.mapService;
if(g){r.empty(e);for(var c=null,n=0;n<g.length;n++)if(g[n].layerId===d.subId){c=g[n];break}if(c){var b=r.create("table",{"class":"legend-table",style:"font-size: 12px"},e);f.forEach(c.legend,function(c){if("\x3call other values\x3e"!==c.label){var a=r.create("tr",{"class":"legend-tr",style:"border: 1px solid"},b),d=r.create("td",{"class":"legend-symbol-td",style:""},a),h=null,h=c.imageData?"data:"+c.contentType+";base64,"+c.imageData:c.url;r.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",
src:h},d);r.create("td",{"class":"legend-label-td",innerHTML:c.label||" ",style:"padding-left: 5px"},a)}},this)}}},_initControlPopup:function(){var g=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:g.infoTemplates&&g.infoTemplates[e]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var g=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&
g.infoTemplates&&delete g.infoTemplates[e]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},_getServiceDefinition:function(){return this.originOperLayer.mapService.layerInfo._getSubserviceDefinition(this.originOperLayer.mapService.mapServiceSubId)},_getLayerObject:function(g){var e=new q;(g?this._layerObjectFacory.getLayerObjectWithUrl(g):this._layerObjectFacory.getLayerObject()).then(k.hitch(this,
function(d){this.layerObject.empty&&d&&(this.layerObject=d);e.resolve(d)}));return e},getLayerObject:function(){return this._getLayerObject()},getLayerObjectTryUsingFeatureService:function(){var g;return this.isItemLayer()?this.getItemInfo().then(k.hitch(this,function(e){e&&e.getItemData()&&e.getItemData().layers&&f.some(e.getItemData().layers,function(d){if(d.id===this.subId)return g=d.layerUrl,!0},this);return g?this._getLayerObject(g):this._getLayerObject()})):this.getLayerObject()},getPopupInfo:function(){var g=
null,e=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(e)for(var d=0;d<e.length;d++)if(e[d].id===this.originOperLayer.mapService.subId){g=e[d].popupInfo;break}return g},getFilterOfWebmap:function(){var g=null,e=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(e)for(var d=0;d<e.length;d++)if(e[d].id===this.originOperLayer.mapService.subId){g=e[d].layerDefinition?e[d].layerDefinition.definitionExpression:null;break}return g},getFilter:function(){var g=this.originOperLayer.mapService;
return g.layerInfo.layerObject&&g.layerInfo.layerObject.layerDefinitions?g.layerInfo.layerObject.layerDefinitions[g.subId]:null},setFilter:function(g,e){var d,c=this.originOperLayer.mapService;c.layerInfo.layerObject&&c.layerInfo.layerObject.setLayerDefinitions&&(d=c.layerInfo.layerObject.layerDefinitions?f.map(c.layerInfo.layerObject.layerDefinitions,function(c){return c}):[],e=k.mixin({},e),k.setObject("_wabProperties.objectPassWithFilterChangeEvent",e,c.layerInfo.layerObject),d[c.subId]=g,c.layerInfo.layerObject.setLayerDefinitions(d))},
getLayerType:function(){var g=new q;0<this.getSubLayers().length?g.resolve("GroupLayer"):this._getServiceDefinition().then(k.hitch(this,function(e){e?g.resolve(e.type.replace(/\ /g,"")):g.resolve(null)}),function(){g.resolve(null)});return g},getSupportTableInfo:function(){var g=new q,e={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(k.hitch(this,function(d){e.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(e.isSupportedLayer=!0);this._getServiceDefinition().then(k.hitch(this,
function(c){c&&0<=c.capabilities.indexOf("Data")&&(e.isSupportQuery=!0);g.resolve(e)}),function(){g.resolve(e)})}),function(){g.resolve(e)});return g},enablePopup:function(){var g=this.originOperLayer.mapService.layerInfo,e=g.layerObject,d=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(k.hitch(this,function(){return g.controlPopupInfo.infoTemplates&&g.controlPopupInfo.infoTemplates[d]?(this.controlPopupInfo.enablePopup=!0,e.infoTemplates||(e.infoTemplates={}),e.infoTemplates[d]=
g.controlPopupInfo.infoTemplates[d],!0):!1}))},disablePopup:function(){var g=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;g.infoTemplates&&delete g.infoTemplates[e]},loadInfoTemplate:function(){var g=new q,e=this.originOperLayer.mapService.layerInfo,d=this.originOperLayer.mapService.subId;e.controlPopupInfo.infoTemplates&&e.controlPopupInfo.infoTemplates[d]&&e.controlPopupInfo.infoTemplates[d].infoTemplate?g.resolve(e.controlPopupInfo.infoTemplates[d].infoTemplate):
(e.controlPopupInfo.infoTemplates||(e.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(k.hitch(this,function(c){c=this._getDefaultPopupTemplate(c);e.controlPopupInfo.infoTemplates[d]={infoTemplate:c,layerUrl:null};g.resolve(c)}),k.hitch(this,function(){g.resolve(null)})));return g},getInfoTemplate:function(){var e=this.originOperLayer.mapService.layerInfo,f=this.originOperLayer.mapService.subId;return e.controlPopupInfo.infoTemplates&&e.controlPopupInfo.infoTemplates[f]&&e.controlPopupInfo.infoTemplates[f].infoTemplate?
e.controlPopupInfo.infoTemplates[f].infoTemplate:null},getScaleRange:function(){var e=this.originOperLayer.mapService;return(e=e.layerInfo._getJsapiLayerInfoById(e.subId))&&0<=e.minScale&&0<=e.maxScale?{minScale:e.minScale,maxScale:e.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(g,f){var d=this.originOperLayer.mapService,c=d.layerInfo._getJsapiLayerInfoById(d.subId);d.layerInfo.layerObject&&d.layerInfo.layerObject.supportsDynamicLayers&&d.layerInfo.layerObject.setDynamicLayerInfos&&c&&
(c.minScale!==g||c.maxScale!==f)&&(c.minScale=g,c.maxScale=f,d.layerInfo.layerObject.setDynamicLayerInfos(d.layerInfo._jsapiLayerInfos),e.publish("layerInfos/layerInfo/scaleRangeChanged",[this]))},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerObjectFacory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./RequestBuffer esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),
function(t,f,k,q,e,r,m,l,g,p){return t(null,{_layerInfo:null,_layerObjectBuffer:null,constructor:function(d){this._layerInfo=d;this._initLayerObjectBuffer()},_initLayerObjectBuffer:function(){this._layerObjectBuffer=new e(f.hitch(this,this._getLayerObject))},getLayerObject:function(){var d=this._layerInfo.getUrl();return this._layerObjectBuffer.getRequest(this._layerInfo.subId).request(d)},getLayerObjectWithUrl:function(d){return this._layerObjectBuffer.getRequest(this._layerInfo.subId+"_url").request(d)},
_getLayerObject:function(d){var c,e=new q;this._layerInfo.getLayerType().then(f.hitch(this,function(b){var h=f.mixin(this._getLayerOptionsForCreateLayerObject(),this._layerInfo.originOperLayer.options||{})||{};switch(b){case "FeatureLayer":c=new r(d,h);break;case "RasterLayer":c=new m(d);break;case "StreamLayer":c=new l(d);break;case "ArcGISImageServiceLayer":c=new g(d);break;case "ArcGISImageServiceVectorLayer":c=new p(d);break;case "Table":if(this._layerInfo.layerObject&&!this._layerInfo.layerObject.empty)return this._setLayerObjectProperties(this._layerInfo.layerObject),
e.resolve(this._layerInfo.layerObject),e;if(this._layerInfo.layerObject&&this._layerInfo.layerObject.url)c=new r(d,h);else return this._layerInfo.layerObject&&this._layerInfo.layerObject.featureCollectionData?(c=new r(this._layerInfo.layerObject.featureCollectionData,h),this._setLayerObjectProperties(c),e.resolve(c)):e.resolve(null),e;break;case "GroupLayer":return e=this._getGroupLayerObject();default:return e.resolve(null),e}var a=c.on("load",f.hitch(this,function(){this._setLayerObjectProperties(c);
e.resolve(c);a.remove&&a.remove()})),n=c.on("error",f.hitch(this,function(a){e.reject(a);n.remove&&n.remove()}))}),f.hitch(this,function(){e.reject()}));return e},_getGroupLayerObject:function(){var d=new q;this._layerInfo._getServiceDefinition().then(f.hitch(this,function(c){if(null===c)d.reject();else{var e=this._layerInfo.getUrl();c.url=e;c.id=this._layerInfo.id;d.resolve(c)}}));return d},_getLayerOptionsForCreateLayerObject:function(){var d={},c=[],e=this._layerInfo.getInfoTemplate();e&&e.info&&
e.info.fieldInfos?k.forEach(e.info.fieldInfos,function(b){b.visible&&c.push(b.fieldName)},this):c=["*"];d.outFields=c;return d},_setLayerObjectProperties:function(d){d.name&&!f.getObject("_wabProperties.originalLayerName",!1,d)&&(f.setObject("_wabProperties.originalLayerName",d.name,d),d.name=this._layerInfo.title);d.id=this._layerInfo.id;this._layerInfo.loadInfoTemplate().then(f.hitch(this,function(c){d.infoTemplate=c}))}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){return t([d,c],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,b){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var a,b;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){a=[];for(b=0;b<this.minValues.length;b++)a.push([this.minValues[b],this.maxValues[b],this.meanValues[b],this.stdvValues[b]]);this.bandCount!==a.length&&(a=null)}b=0;var c=!1;"U8"===this.pixelType?(b=5,c=a?!1:!0):a?(b=5,c=!1):(b=6,c=!0);this.renderingRule&&(b=5,c=!0);this.pixelFilter=(new n({stretchType:b,min:0,max:255,dra:c,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,
statistics:a,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}})})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){var h=p.defaults.map.zoomDuration;return t([b],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,
opacity:1,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this.pixelData=null;this._initialize(a,b)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},
clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;m.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(f.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new n((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,b){this.pixelFilter=a;b||this.redraw()},_toggleTime:function(){},_setMap:function(a,b){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var c=this._div=r.create("div",null,b),h={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(h[g._css.names.transform]=g._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;m.set(c,h);this._canvas=r.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute;"},c);d.isDefined(this.opacity)&&m.set(c,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(k.connect(a,"onPan",this,this._panHandler));this._connects.push(k.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?this._connects.push(k.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(k.connect(a,
"onZoom",this,this._onZoomHandler)),this._connects.push(k.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(k.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(k.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(k.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(k.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};
this.evaluateSuspension();if(this.suspended&&!a.loaded)var e=k.connect(a,"onLoad",this,function(){k.disconnect(e);e=null;this.evaluateSuspension()});return c},_unsetMap:function(a,b){q.forEach(this._connects,k.disconnect,this);var c=this._div;c&&(b.removeChild(c),r.destroy(c));this.updating&&a._jobs&&a._jobs--;this._rasterReadPromise&&this._rasterReadPromise.cancel();this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},
_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){if(this._map){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,m.set(this._div,g._css.names.transform,g._css.translate(this._left,
this._top)),m.set(this._canvas,g._css.names.transform,g._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){var a=this.pixelData.pixelBlock,b=this._context,c=b.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());var d=this.pixelData.extent,h=this._map.extent,e=this.getCurrentResolution(),n=0,f=0;Math.abs(d.xmin-h.xmin)>e.x&&(n=Math.round((d.xmin-h.xmin)/
e.x));Math.abs(h.ymax-d.ymax)>e.y&&(f=Math.round((h.ymax-d.ymax)/e.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,m.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top)),m.set(this._canvas,g._css.names.transform,g._css.translate(-this._left,-this._top))):(m.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),m.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+
"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};b.putImageData(c,n,f,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()}},_panHandler:function(a,b){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+b.x,this._top=this._map.__visibleDelta.y+b.y,m.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))):m.set(this._div,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&
(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onScaleHandler:function(a,b){var c={},d=g._css.names;m.set(this._canvas,d.transition,b?"none":d.transformName+" "+h+"ms ease");this._matrix=a;a=this._multiply?l.multiply(a,this._multiply):a;if(this._tdx||this._tdy)a=l.multiply(a,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});c[d.transform]=g._css.matrix(a);m.set(this._canvas,c)},_onZoomHandler:function(a,b,c){var d=this._startRect;a=d.width*b;b*=d.height;var h=d.left-(a-d.width)*(c.x-d.left)/
d.width;c=d.top-(b-d.height)*(c.y-d.top)/d.height;m.set(this._canvas,{left:h+"px",top:c+"px",width:a+"px",height:b+"px"});this._endRect={left:h,top:c,width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,c){m.set(this._div,{width:b+"px",height:c+"px"});m.set(this._canvas,{width:b+"px",height:c+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(a,b,c,d){this.suspended||
b&&0===b.x&&0===b.y&&!c||("css-transforms"===this._map.navigationMode&&(b&&(this._dragOrigin.x+=b.x,this._dragOrigin.y+=b.y),c||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,m.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))),c&&(m.set(this._canvas,g._css.names.transition,"none"),this._multiply=this._multiply?l.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},
_visibilityChangeHandler:function(a){a?c.show(this._div):c.hide(this._div)},_opacityChangeHandler:function(a){m.set(this._div,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w,B,F,D,G,H,M,L){t=t(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(c,d){this._url=a.urlToObject(c);this.raster=new A(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=d&&d.infoTemplate;this.format=(c=d&&d.imageServiceParameters)&&c.format;this.compressionTolerance=c&&c.compressionTolerance?c.compressionTolerance:.01;this.interpolation=
c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this.renderer=c?c.renderer:null;this.useMapDimensionValue=d&&d.hasOwnProperty("useMapDimensionValue")?!!d.useMapDimensionValue:!0;this.hasImageFilter=d&&d.hasImageFilter;this.activeMapDimensions=d&&d.activeMapDimensions;this._params=f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,
compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this.pixelFilter=d&&d.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=f.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=f.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=f.hitch(this,this._initLayer);this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=d&&d.loadCallback;c&&c.renderer&&(c.renderer.outputUnit||c.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new B,this.vectorFieldPixelFilter.setUnits(c.renderer.inputUnit,c.renderer.outputUnit));(d=d&&d.resourceInfo)?this._initLayer(d):b({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",
load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){if(null!==a&&void 0!==a){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();b=this.minScale;var c=this.maxScale;f.mixin(this,a);this.minScale=b;this.maxScale=c;this.initialExtent=this.fullExtent=this.extent=new u(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=
parseFloat(this.pixelSizeY);var d=this.minValues,h=this.maxValues,e=this.meanValues,g=this.stdvValues,p=this.bands=[];b=0;for(c=this.bandCount;b<c;b++)p[b]={min:d[b],max:h[b],mean:e[b],stddev:g[b]};this.timeInfo=(b=this.timeInfo)&&b.timeExtent?new D(b):null;c=this.fields=[];if(d=a.fields)for(b=0;b<d.length;b++)c.push(new G(d[b]));this._updateInfoTemplateFields(this.fields);this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);n.isDefined(a.minScale)&&
!this._hasMin&&this.setMinScale(a.minScale);n.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);b={};a.defaultMosaicMethod?(b.method=a.defaultMosaicMethod,b.operation=a.mosaicOperator,b.sortField=a.sortField,b.sortValue=a.sortValue):b.method=z.METHOD_NONE;this.defaultMosaicRule=new z(b);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType;this._setDefaultRenderingRule(!0);this.renderingRule&&
this.getRenderingRuleServiceInfo(this.renderingRule).then(f.hitch(this,function(a){a.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(f.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}))}));this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);
10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,function(a){a&&(a.features&&a.fields&&(this.rasterAttributeTable=f.clone(a)),a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features)),a.fields&&0<a.fields.length&&(this._rasterAttributeTableFields=f.clone(a.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||
this.refresh())}));this._initVectorPixelFilter();10.3<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&this.getRasterFunctionInfos().then(f.hitch(this,function(a){if(a&&a.length){this.rasterFunctionInfos=a;var b=[],c;q.forEach(a,function(a){if(a){var d=a.functionType;c=c||1===d||2===d;b.push(a.name)}},this);this._hasItemLevelRFT=c;this._rasterFunctionNames=b;c&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(a=
this._loadCallback)delete this._loadCallback,a(this)}},_updateInfoTemplateFields:function(a){if(a&&!(1>a.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var b,c,d,h;h=this.infoTemplate.info.fieldInfos;for(b=0;b<a.length;b++)for(d=a[b],c=0;c<h.length;c++)if(h[c].fieldName.toLowerCase()===d.name.toLowerCase()&&h[c].fieldName!==d.name){h[c].fieldName=d.name;break}}},getKeyProperties:function(a){var c=this._url.path+
"/keyProperties",d=new k(h._dfdCanceller),g={f:"json"};a&&a.renderingRule&&(g.renderingRule=e.toJson(a.renderingRule.toJson()));10<this.version?(d._pendingDfd=b({url:c,content:g,handleAs:"json",callbackParamName:"callback"}),d._pendingDfd.then(function(a){d.callback(a)},function(a){d.errback(a)})):(a=Error("Layer does not have key properties"),a.log=!!r.isDebug,d.errback(a));return d},getRasterAttributeTable:function(a){var c=this._url.path+"/rasterAttributeTable",d=new k(h._dfdCanceller),g={f:"json"},
n=this.hasRasterAttributeTable;a&&a.renderingRule&&(g.renderingRule=e.toJson(a.renderingRule.toJson()),n=!0);10<this.version&&n?(d._pendingDfd=b({url:c,content:g,handleAs:"json",callbackParamName:"callback"}),d._pendingDfd.then(function(a){d.callback(a)},function(a){d.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=!!r.isDebug,d.errback(a));return d},getRenderingRuleAttributeTable:function(a){var b=new k(h._dfdCanceller);if(!a||!a.renderingRule)return b.errback(Error("Rendering rule is not specified")),
b;a=a.renderingRule;var c=this._getRenderingRuleId(a);this._renderingRuleAttributeTable&&c&&this._renderingRuleAttributeTable.hasOwnProperty(c)?b.resolve(this._renderingRuleAttributeTable[c]):b=this.getRasterAttributeTable({renderingRule:a}).then(f.hitch(this,function(a){var b;a&&a.features&&a.features.length&&a.fields&&a.fields.length&&(b={features:f.clone(a.features),fields:f.clone(a.fields)},c&&(this._renderingRuleAttributeTable[c]=b));return b}));return b},_initVectorPixelFilter:function(){var a;
this._hasItemLevelRFT&&this.renderingRule&&(a=this._getItemLevelRenderingRule(this.renderingRule));if(a=a||this.renderingRule)return this.getRenderingRuleServiceInfo(a).then(f.hitch(this,function(a){a&&this._isVectorData(a)&&!n.isDefined(this.pixelFilter)&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new B,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===a.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(f.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(a.serviceDataType))}))},_applyVectorResamplingType:function(a){if(a){var b=this.renderingRule;b&&"Resample"===b.functionName&&((b.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===a?7:10,this.setRenderingRule(new E(b.toJson())))}},_getRasterAttributeTableFeatures:function(){var a=new k;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),
a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(f.hitch(this,function(a){a&&a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this.getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features}):(a=new k,a.errback(Error("Rendering rule is not specified")),
a)},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var c={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},d={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},h={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,
editable:!1,length:50,type:"esriFieldTypeDouble"},e=this.fields?f.clone(this.fields):[];a=e.length;e[a]=d;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(a++,e[a]=h);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,e[a]=c;!n.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==
this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(c={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},d={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,e[a]=c,a++,e[a]=d);a=this._rasterAttributeTableFields;(c=this.renderingRule&&this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(c)&&
(a=this._renderingRuleAttributeTable[c].fields);a&&0<a.length&&(a=q.filter(a,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),a=q.map(a,function(a){var c=f.clone(a);c.name=b+a.name;return c}),e=e.concat(a));var g=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&q.forEach(this.rasterFunctionInfos,function(a){a&&a.name&&"none"!==a.name.toLowerCase()&&(a={name:g+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,
type:"esriFieldTypeDouble"},e.push(a))});return e},_applyTimeToMultidimensionalCRF:function(a,b){var c=this.timeInfo&&this.timeInfo.startTimeField;if((b=b||this._params.time)&&c&&this._isMultidimensionalCRF()){a=f.clone(a||this.defaultMosaicRule)||new z;a.multidimensionalDefinition=a.multidimensionalDefinition||[];var d=a.multidimensionalDefinition.filter(function(a){return a.dimensionName===c}),h=b.split(",").map(function(a){return parseInt(a,10)});0<d.length?a.multidimensionalDefinition.forEach(function(a){a.dimensionName===
c&&(a.isSlice=1===h.length,a.values=1===h.length?h:[h])}):a.multidimensionalDefinition.push(new C({dimensionName:c,isSlice:1===h.length,values:1===h.length?h:[h]}))}return a},_prepareGetImageParameters:function(a,b,c,d){d=n.isDefined(d)?d:this._params;if(this.renderer||this._hasItemLevelRFT&&this.renderingRule){var h=this.getExportImageRenderingRule();d.renderingRule=h?e.toJson(h.toJson()):null}h=this.getExportImageMosaicRule(d);d.mosaicRule=h?e.toJson(h.toJson()):null;h=a.spatialReference.wkid||
e.toJson(a.spatialReference.toJson(!1));delete d._ts;f.mixin(d,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:b+","+c},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete d.compressionTolerance;d.format&&"LERC"===d.format.toUpperCase()&&(d.compressionTolerance=this.compressionTolerance);d.token=this._getToken()},getImageUrl:function(d,h,e,u,p){p=n.isDefined(p)?p:this._params;this._prepareGetImageParameters(d,h,e,p);d=f.clone(p);this._cleanupRequestParams(d);h=this._url.path+
"/exportImage?";e=a.addProxy(h+g.objectToQuery(f.mixin(d,{f:"image"})));var l=d.token;e.length>c.defaults.io.postLength||this.useMapImage?this._jsonRequest=b({url:h,content:f.mixin(d,{f:"json"}),callbackParamName:"callback",load:function(b,c){b=b.href;l&&(b+=-1===b.indexOf("?")?"?token\x3d"+l:"\x26token\x3d"+l);u(a.addProxy(b))},error:this._errorHandler}):u(e)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(a,b){this.interpolation=
this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},
setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=e.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return b({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},
handleAs:"json",load:function(a){return a&&a.rasterFunctionInfos}})},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?e.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:a});if(c)this.onRenderingChange();this._setDefaultFilter();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;this._setDefaultFilter();b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=z.METHOD_NONE);c.where=a;a=new z(c);this.setMosaicRule(a,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&
(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},getExportImageRenderingRule:function(){var a;this._hasItemLevelRFT&&this.renderingRule&&(a=this._getServiceLevelRenderingRule(this.renderingRule));a=a||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(a=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),
a)},getExportImageMosaicRule:function(){var a=this.mosaicRule,b;this._hasItemLevelRFT&&this.renderingRule&&(b=this._getItemLevelRenderingRule(this.renderingRule));b&&(a=a||this.defaultMosaicRule||new z,a.itemRenderingRule=b);return a=this._applyTimeToMultidimensionalCRF(a)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(){var a=new k(h._dfdCanceller);if(this.hasHistograms)a._pendingDfd=b({url:this._url.path+"/histograms",content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}),a._pendingDfd.then(function(b){a.callback(b)},function(b){a.errback(b)});else{var c=Error("Layer does not have histograms.");c.log=!!r.isDebug;a.errback(c)}return a},computeHistograms:function(a){var c=new k(h._dfdCanceller);if(10.1<=this.currentVersion){a=a||{};var d=a.geometry||this.fullExtent,e=(a.geometry||this.fullExtent).toJson(),d="extent"===d.type?"esriGeometryEnvelope":"esriGeometryPolygon",g=a.renderingRule||this.renderingRule||this.defaultRenderingRule,
g=g?g.toJson():null,n=a.mosaicRule||this.mosaicRule||this.defaultMosaicRule,n=n?n.toJson():null;a=a.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};c._pendingDfd=b({url:this._url.path+"/computeHistograms",content:f.mixin({f:"json",geometry:JSON.stringify(e),geometryType:d,renderingRule:JSON.stringify(g),mosaicRule:JSON.stringify(n),pixelSize:JSON.stringify(a),callbackParamName:"callback"}),handleAs:"json"});c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})}else e=Error("Layer doesn't support computeHistograms."),
e.log=!!r.isDebug,c.errback(e);return c},getRenderingRuleServiceInfo:function(a){var c=new h._fixDfd(new k(h._dfdCanceller));if(!a)return c.errback(Error("Rendering rule is not specified")),c;var d=this._getRenderingRuleId(a);return d&&this._rasterFunctionTemplateInfos[d]?(c.resolve(this._rasterFunctionTemplateInfos[d]),c):b({url:this._url.path,content:f.mixin(f.mixin({f:"json",renderingRule:JSON.stringify(a.toJson())},this._url.query)),callbackParamName:"callback",load:f.hitch(this,function(a){var b=
{};q.forEach(this._rasterFunctionServiceInfoProps,function(c){b[c]=a[c]});return this._rasterFunctionTemplateInfos[d]=b}),error:this._errorHandler})},queryVisibleRasters:function(a,b,c,d){var e=this._map,g=h._fixDfd(new k(h._dfdCanceller));this._visibleRasters=[];var n,u,p=!0,l=!0,m=null,r=this.infoTemplate?this.infoTemplate.info:null,x=r?f.clone(this.infoTemplate.info.fieldInfos):null;b=b||{};if(r&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var w=[];q.forEach(this.infoTemplate.info.mediaInfos,
function(a){w=w.concat(a&&a.value&&a.value.fields||[])});w.length&&q.forEach(x,function(a){a&&-1<w.indexOf(a.fieldName)&&(a.visible=!0)})}if(x&&0<x.length)for(p=!1,n=0;n<x.length;n++)if((u=x[n])&&u.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(u.visible||r.title&&-1<r.title.toLowerCase().indexOf(u.fieldName.toLowerCase()))){p=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&
(m=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);x&&0<x.length&&(l=!1,q.some(x,function(a){if(a&&a.fieldName.toLowerCase()===this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&a.visible)return l=!0},this));var z=(u=this._removeVisualizationStretchFunction(this.renderingRule))&&u.functionName,A=[];if(10.4<=this.version){var t=!1;if(this.rasterFunctionInfos&&x){var C=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;q.forEach(this.rasterFunctionInfos,function(a){var b=
C+a.name.replace(/ /gi,"_");q.some(x,function(a){return a.visible&&a.fieldName===b})&&(t=t||z&&z===a.name,A.push(new E({rasterFunction:a.name})))})}u&&!t&&A.push(u)}n=new L;n.geometry=a.geometry;n.returnGeometry=this._map.spatialReference.equals(this.spatialReference);n.returnCatalogItems=p;n.timeExtent=a.timeExtent;n.returnPixelValues=l;n.maxItemCount=m||a.maxItemCount;this._params.time&&this.mosaicRule?(a=f.clone(this.mosaicRule),a=this._filterOutTimeDimension(a),n.mosaicRule=a):n.mosaicRule=this.mosaicRule||
null;this._isMultidimensionalCRF()&&n.timeExtent&&(n.mosaicRule=this._applyTimeToMultidimensionalCRF(n.mosaicRule,n.timeExtent.toJson().join(",")),delete n.timeExtent);n.renderingRule=10.4>this.version&&u||null;n.renderingRules=A||null;10.61>this.version&&(n.returnPixelValues=void 0,n.maxItemCount=void 0);e&&(e=new v((e.extent.xmax-e.extent.xmin)/e.width,(e.extent.ymax-e.extent.ymin)/e.height,e.extent.spatialReference),n.pixelSize=e);b.requestParams=n;var B=this,e=new M(this.url);(g._pendingDfd=e.execute(n)).addCallbacks(function(a){B._queryVisibleRastersHandler(a,
b,c,d,g)},function(a){B._resolve([a],null,d,g,!0)});return g},_queryVisibleRastersHandler:function(a,c,d,h,g){function p(){var a=this.getCustomRasterFields(c),b=this._getDomainFields(a),h=c?c.returnDomainValues:!1,e=c&&c.rasterAttributeTableFieldPrefix,p,x,v,z,A,t,C,E,F,G,a=(a=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[a];this.renderingRule&&(this._useRenderingRuleAttributeTable||a)?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
G=l):a=this._getRasterAttributeTableFeatures();a.then(f.hitch(this,function(a){for(p=0;p<k.length;p++){P=k[p];P.setInfoTemplate(this.infoTemplate);P._layer=this;if(l){F=l.replace(/ /gi,"").split(",");x=l;v=F;r&&r.length>=p&&(x=r[p].replace(/ /gi,", "),v=r[p].split(" "));P.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=v;P.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=F;m&&(P.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=m.replace(/ /gi,"").split(","));if(this.pixelFilter){var c=
new w({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});q.forEach(v,function(a){c.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:c,extent:new u(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)P.attributes[this._rasterFieldPrefix+"Magnitude"]=c.pixels[0][0],P.attributes[this._rasterFieldPrefix+"Direction"]=c.pixels[1][0]}q.forEach(B,
function(a){P.attributes[a.name]=a.value});var D=G||x;if(a&&0<a.length&&(z=q.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==D:a.attributes.VALUE==D}),0<z.length&&(A=f.clone(z[0]),e&&A))){E={};for(t in A.attributes)A.attributes.hasOwnProperty(t)&&(C=e+t,E[C]=A.attributes[t]);A.attributes=E;P.attributes=f.mixin(P.attributes,A.attributes)}}h&&b&&0<b.length&&q.forEach(b,function(a){if(a){var b=P.attributes[a.name];n.isDefined(b)&&(b=this._getDomainValue(a.domain,
b),n.isDefined(b)&&(P.attributes[a.name]=b))}},this);Q.push(P);this._visibleRasters.push(P)}this._resolve([Q,null,!0],null,d,g)}))}var l=a.value,m=a.value,r,k,v=0,z=0,A=this,t=this.objectIdField,C,E,B=[];h=c.requestParams.renderingRules;var F=a.processedValues,G=this.renderingRule&&e.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(h&&F&&h.length===F.length){var D=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;q.forEach(h,function(a,b){if(a.functionName){var c=
{name:D+a.functionName.replace(/ /gi,"_"),value:F[b].replace(/ /gi,"").split(",")};B.push(c);G&&G===e.toJson(a.toJson())&&(l=F[b])}})}h=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var L=0,J,M,K=a.catalogItems.features.length;E=0;k=Array(K);r=Array(K);C=Array(K);if(a.properties&&a.properties.Values){K=a.properties.Values.length;
for(v=0;v<K;v++)-1<a.properties.Values[v].toLowerCase().indexOf("nodata")&&E++;J=K-E;for(v=0;v<K;v++)E=!0,-1<a.properties.Values[v].toLowerCase().indexOf("nodata")?(M=J++,h||(E=!1,k.length--,r.length--,C.length--)):M=L++,E&&(k[M]=a.catalogItems.features[v],r[M]=a.properties.Values[v],C[M]=k[M].attributes[t])}else{for(v=0;v<K;v++)k[v]=a.catalogItems.features[v],C[v]=k[v].attributes[t];r=null}}this._visibleRasters=[];var P;(a=-1<l.toLowerCase().indexOf("nodata"))&&!h&&(k=[],r=[],C=[]);!l||k||a||(t=
"ObjectId",k=[],P=new H(new u(this.fullExtent),null,{ObjectId:0}),k.push(P));var Q=[];k?!this._map.spatialReference.equals(this.spatialReference)&&C&&0<C.length?b({url:this._url.path+"/query",content:{f:"json",objectIds:C.join(","),returnGeometry:!0,outSR:e.toJson(A._map.spatialReference.toJson()),outFields:t},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)A._resolve([Q,null,null],null,d,g);else{for(v=0;v<a.features.length;v++)for(z=0;z<k.length;z++)k[z].attributes[t]==
a.features[v].attributes[t]&&(k[z].geometry=new x(a.features[v].geometry),k[z].geometry.setSpatialReference(A._map.spatialReference));p.call(A)}},error:function(a){A._resolve([Q,null,null],null,d,g)}}):p.call(this):this._resolve([Q,null,null],null,d,g)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];q.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});
return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;q.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=f.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,b,c);b=f.clone(this._params);this._cleanupRequestParams(b);b.extent=a;b.format=b.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===b.format.toLowerCase()&&!b.lercVersion&&10.5<=this.version&&
(b.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&delete b.time;c=null;this._useBrowserDecoding()&&(c=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?f.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=a,this.hasDataChanged=
!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=f.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,
b,c){a=a.getImageData(0,0,b,c).data;for(var d=b*c,h=0,e=0,g=new Uint8Array(d),n=new Uint8Array(d),f=new Uint8Array(d),u=new Uint8Array(d),p=Infinity,l=Infinity,r=Infinity,m=-Infinity,q=-Infinity,k=-Infinity,v,x,z,h=0;h<d;h++)v=a[e++],x=a[e++],z=a[e++],p=p<v?p:v,m=m>v?m:v,l=l<x?l:x,q=q>x?q:x,r=r<z?r:z,k=k>z?k:z,g[h]=v,n[h]=x,f[h]=z,u[h]=a[e++]&1;return new w({width:b,height:c,pixels:[g,n,f],pixelType:"U8",mask:u,statistics:[{minValue:p,maxValue:m},{minValue:l,maxValue:q},{minValue:r,maxValue:k}]})},
_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",c=new k(h._dfdCanceller);if(this._multidimensionalInfo)return c.resolve(this._multidimensionalInfo),c;10.3<=this.version&&this.hasMultidimensions?(c._pendingDfd=b({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),
c._pendingDfd.then(f.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;c.callback(a.multidimensionalInfo)}),function(a){c.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=!!r.isDebug,c.errback(a));return c},getDefaultMultidimensionalDefinition:function(){var a,b,c,d=[],e=new k(h._dfdCanceller),g;if(this._defaultMultidimensionalDefinition)return e.resolve(f.clone(this._defaultMultidimensionalDefinition)),e;e._pendingDfd=this.getMultidimensionalInfo();
e._pendingDfd.then(f.hitch(this,function(h){a=h;b=a.variables[0].dimensions;for(c in b)b.hasOwnProperty(c)&&"StdTime"!==b[c].name&&(g=b[c],d.push(new C({variableName:"",dimensionName:g.name,isSlice:!g.hasRanges,values:[this._getDefaultDimensionValue(g)]})));this._defaultMultidimensionalDefinition=d;e.callback(f.clone(d))}),function(a){e.errback(a)});return e},_getDefaultDimensionValue:function(a){if(a&&a.values&&a.values.length){var b,c,d=Infinity,h,e;if(a.hasRanges)return a.values[0];if(a.name&&
"stdz"===a.name.toLowerCase()){for(e=0;e<a.values.length&&(h=a.values[e],c=Math.abs(h-0),c<d&&(d=c,b=h),0!==c);e++);return b}return a.extent[0]}},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(f.hitch(this,function(d){b=d;0<b.length&&(this.mosaicRule?(c=f.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=f.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new z({multidimensionalDefinition:b}),
this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={},c=this.renderingRule;if(!c&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!c||"Resample"!==c.functionName)){var d="esriImageServiceDataTypeVector-UV"===
this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:d,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};c&&(b.rasterFunctionArguments.Raster=c.toJson())}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new E(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new z(e.fromJson(a.mosaicRule)),b=this._filterOutTimeDimension(b);a.mosaicRule=e.toJson(b.toJson())}var b=
"displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" "),c;for(c in b)a.hasOwnProperty(b[c])&&delete a[b[c]];return a},_filterOutTimeDimension:function(a){if(this._isMultidimensionalCRF())return a;if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var b=q.filter(a.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});a.multidimensionalDefinition=b}return a},_removeVisualizationStretchFunction:function(a){var b=
a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;var c=a.functionArguments.Raster;return c&&c.functionName&&q.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?c:a},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&this.fields&&1<this.fields.length)},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||
"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(a){a=(a=a||this)&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===a},_isRenderingRuleAProcessingTemplate:function(a){var b=a&&a.functionName;return!b||a.functionArguments?!1:q.some(b&&(this.rasterFunctionInfos||[]),function(a){return a&&a.name&&a.name.toLowerCase()===b.toLowerCase()})},_getRenderingRuleId:function(a){var b=a&&a.functionName;if(b){if(this._isRenderingRuleAProcessingTemplate(a))return b;
var c=this._customRenderingRuleId[b];if(c){if(c!==a){for(var d in this._customRenderingRuleId)if(this._customRenderingRuleId[d]===a)return d;for(c=0;this._customRenderingRuleId[h];)c+=1;var h;this._customRenderingRuleId[b+c]=a}}else this._customRenderingRuleId[b]=a;return b}},_createPixelData:function(a){a=new w({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new u(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,
extent:b}},_convertRendererToRenderingRule:function(a){var b=a&&a.declaredClass;if(!b||"esri.renderer.UniqueValueRenderer"!==b&&"esri.renderer.ClassBreaksRenderer"!==b&&"esri.renderer.StretchRenderer"!==b)return null;var c=null;"esri.renderer.StretchRenderer"===b?c=a.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===b?c=this._convertClassifyRenderer(a):"esri.renderer.UniqueValueRenderer"===b&&(c=this._convertUniqueValueRenderer(a));return c},_getValueField:function(a){if(a&&
a.length){var b,c;q.some(a,function(a){if((c=a.name)&&"value"===c.toLowerCase())return b=c,!0});return b}},_convertClassifyRenderer:function(a){var b,c=[],d=[],h=[],e=[],g;b=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var n,f,u=this.hasRasterAttributeTable,p,l;b&&(u=this._rasterFunctionTemplateInfos[b]?this._rasterFunctionTemplateInfos[b].hasRasterAttributeTable:this.hasRasterAttributeTable,f=this._renderingRuleAttributeTable[b],l=this._rasterFunctionTemplateInfos[b]);n=f&&f.features?
f.features:this._rasterAttributeTableFeatures;p=this._getValueField(f&&f.fields?f.fields:this._rasterAttributeTableFields);u&&n?(q.forEach(a.infos,function(b,c){var d,h=b.symbol.color;h.a&&q.forEach(n,function(g){d=g.attributes[a.attributeField];(d>=b.minValue&&d<b.maxValue||c===a.infos.length-1&&d>=b.minValue)&&e.push([g.attributes[p],h.r,h.g,h.b])},this)},this),b=l&&l.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(e,b),b=new E,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=
e,b.variableName="Raster"):(q.forEach(a.infos,function(a,b){g=a.symbol&&a.symbol.color;g.a?(0===b?c.push.call(c,a.minValue,a.maxValue+1E-4):c.push.call(c,a.minValue+1E-4,a.maxValue+1E-4),d.push(b),e.push([b,g.r,g.g,g.b])):h.push(a.minValue,a.maxValue)}),b=l&&l.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(e,b),b=new E,b.functionName="Remap",b.functionArguments={InputRanges:c,OutputValues:d,NoDataRanges:h},b.variableName="Raster",f=new E,f.functionName="Colormap",f.functionArguments=
{Colormap:e,Raster:b},b=f);return b},_convertUniqueValueRenderer:function(a){var b=[],c=this.renderingRule&&this._getRenderingRuleId(this.renderingRule),d,h,e,g;c&&(h=this._renderingRuleAttributeTable[c],g=this._rasterFunctionTemplateInfos[c]);d=h&&h.features?h.features:this._rasterAttributeTableFeatures;e=(c=h&&h.fields?h.fields:this._rasterAttributeTableFields)&&c.length?this._getValueField(c):"Value";q.forEach(a.infos,function(c){var h=c.symbol.color;h.a&&(a.attributeField!==e&&d?q.forEach(d,function(d){d.attributes[a.attributeField]==
c.value&&b.push([d.attributes[e],h.r,h.g,h.b])},this):b.push([c.value,h.r,h.g,h.b]))},this);this._adjustColormapToPixelTypeRange(b,g&&g.pixelType||this.pixelType);g=new E;g.functionName="Colormap";g.functionArguments={};g.functionArguments.Colormap=b;g.variableName="Raster";return g},_adjustColormapToPixelTypeRange:function(a,b){(b=this._pixelTypeRanges[b])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a},_combineRenderingRule:function(a,b){if(!a||!b)return a||b;var c=function(a){var b=
a.Raster;return b=b&&"esri.layers.RasterFunction"===b.declaredClass?c(b.functionArguments):a};a=f.clone(a);"none"!==b.functionName.toLocaleLowerCase()&&(c(a.functionArguments).Raster=b);return a},_isItemLevelRasterFunction:function(a){var b=a&&a.functionName;if(!b||!this._hasItemLevelRFT)return!1;var c=!1;q.some(this.rasterFunctionInfos,function(a){if(a&&a.name===b){if(1===a.functionType||2===a.functionType)c=!0;return!0}});return c},_getServiceLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||
!a)return a;a=new E(a.toJson());var b;b=a.functionArguments;for(var c;;)if((c=b&&b.Raster)&&c.functionArguments&&c.functionArguments.Raster)b=c,b=b.functionArguments;else{this._isItemLevelRasterFunction(c)&&delete b.Raster;break}return a},_getItemLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return null;if(this._isItemLevelRasterFunction(a))return a;a=new E(a.toJson());for(a=a.functionArguments;;)if((a=a&&a.Raster)&&a.functionArguments&&a.functionArguments.Raster)a=a.functionArguments;
else{if(this._isItemLevelRasterFunction(a))return a;break}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&h._resDfd(d,a,e)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=m.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(m.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=
a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}});l("extend-esri")&&f.setObject("layers.ImageServiceLayerMixin",t,d);return t})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),
function(t,f,k,q,e,r,m){var l=t(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(e){f.isObject(e)&&(f.mixin(this,e),e.mosaicMethod&&(this.method=e.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),e.mosaicOperation&&(this.operation=
e.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),e.fids&&(this.objectIds=e.fids),e.viewpoint&&(this.viewpoint=new r(e.viewpoint)),e.itemRenderingRule&&(this.itemRenderingRule=new m(e.itemRenderingRule)),this.multidimensionalDefinition=e.multidimensionalDefinition||[])},toJson:function(){var g=null,p=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(p)for(var g=[],d=0;d<p;d++)g.push("esri.layers.DimensionalDefinition"===
this.multidimensionalDefinition[d].declaredClass?this.multidimensionalDefinition[d].toJson():this.multidimensionalDefinition[d]);g={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:f.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:f.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:g,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():
null};return e.filter(g,function(c){if(null!==c)return!0})},_getMethodEnum:function(e){if(e){var g=l.METHOD_NONE;switch(e.toLowerCase()){case "byattribute":g=l.METHOD_ATTRIBUTE;break;case "center":g=l.METHOD_CENTER;break;case "lockraster":g=l.METHOD_LOCKRASTER;break;case "nadir":g=l.METHOD_NADIR;break;case "northwest":g=l.METHOD_NORTHWEST;break;case "seamline":g=l.METHOD_SEAMLINE;break;case "viewpoint":g=l.METHOD_VIEWPOINT}return g}},_getOperatorEnum:function(e){if(e)switch(e.toLowerCase()){case "first":return l.OPERATION_FIRST;
case "last":return l.OPERATION_LAST;case "max":return l.OPERATION_MAX;case "min":return l.OPERATION_MIN;case "blend":return l.OPERATION_BLEND;case "mean":return l.OPERATION_MEAN;case "sum":return l.OPERATION_SUM}}});f.mixin(l,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",
OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});k("extend-esri")&&f.setObject("layers.MosaicRule",l,q);return l})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(t,f,k,q,e){t=t(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,
constructor:function(e){f.isObject(e)&&f.mixin(this,e)},toJson:function(){var r={variableName:this.variableName,dimensionName:this.dimensionName,values:f.clone(this.values),isSlice:this.isSlice};return e.filter(r,function(e){return null!==e})}});k("extend-esri")&&f.setObject("layers.DimensionalDefinition",t,q);return t})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u){var v,x,z,E,C,A;f=f(p,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(a,c,h){var g=this,n=new q(b._dfdCanceller);if(10>l("ie"))throw"This browser is not supported.";
if(!a.imageServiceParameters)throw"Insufficient parameters to read data";var f=k.clone(a.imageServiceParameters),u=a.pixelType;e.some(this.validPixelTypes,function(a){return a===u})||(f.pixelType="F32");e.some(this.validFormats,function(a){return a.toLowerCase()===f.format.toLowerCase()})||(f.format="lerc");var p=a.decodeFunc,r;this._prepareGetImageParameters(f);var m=f.width,v=f.height,x=f.extent;delete f.width;delete f.height;delete f.extent;n._pendingDfd=d({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:k.mixin(f,{f:"image"}),load:function(a){g.decode(a,{width:m,height:v,planes:null,pixelType:u,noDataValue:f.noData,format:f.format,decodeFunc:p}).then(function(a){r={pixelBlock:a,extent:x};g._resolve([r,f],"onRasterReadComplete",c,n)},function(a){g._resolve([a],null,h,n,!0)})},error:function(a){g._resolve([a],null,h,n,!0)}});return n.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var c,d;b.format&&(c=b.format.toUpperCase());"BSQ"!==
c&&"BIP"!==c&&(c=this._getFormat(a));d=b.decodeFunc;if(void 0===d||null===d)d=this._getFormatDecoderDfd(c);return d(a,b)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new c(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new n(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==
a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var b=a.extent,d=b.spatialReference.wkid||m.toJson(b.spatialReference.toJson());delete a._ts;k.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:d,bboxSR:d,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,h=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+h*b/c:a.xmax=a.xmin+d*c/b;return a},
_resolve:function(a,c,d,h,e){c&&this[c].apply(this,a);d&&d.apply(null,a);h&&b._resDfd(h,a,e)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "LERC2":b=this._decodeLerc2;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=k.hitch(this,b);return function(c,
d){var h=new q;try{var e;"LERC"===a||!0===C?(e=b(c,d),h.resolve(e)):A.then(function(){e=b(c,d);h.resolve(e)})}catch(N){h.reject(N)}return h}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&216===a[1])b="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])b=
"LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,b){if(!v)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);a=(new v).decode(a);
if(!D(a,b))throw"The decoded image dimensions are incorrect.";b=[];var c,d;for(c=0;c<a.pixels.length;c++)d=a.pixels[c],b.push(this._calculateBandStatistics(d));return new h({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:b})},_decodePng:function(a,b){if(!x)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);a=new Uint8Array(a);var c=new x(a);a=new Uint8Array(b.width*b.height*4);c.copyToImageData(a,c.decodePixels());for(var d=c=0,e,d=new Uint8Array(b.width*
b.height),c=0;c<b.width*b.height;c++)d[c]=a[4*c+3];for(var g=new h({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:d,statistics:[]}),c=0;3>c;c++){e=new Uint8Array(b.width*b.height);for(d=0;d<b.width*b.height;d++)e[d]=a[4*d+c];g.addData({pixels:e,statistics:this._calculateBandStatistics(e)})}return g},_decodeBsq:function(a,b){if(!z)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);B=b.noDataValue;b.pixelType=F(b.pixelType);a=z.decodeBSQ(a,{bandCount:b.planes,width:b.width,
height:b.height,pixelType:w,noDataValue:B});var c=[],d,e=null;for(d=0;d<a.pixels.length;d++)e=a.pixels[d],c.push(this._calculateBandStatistics(e));return new h({width:b.width,height:b.height,pixels:a.pixels,pixelType:b.pixelType,mask:a.maskData,statistics:c})},_decodeBip:function(a,b){this._validateDecodeParams(b);B=b.noDataValue;b.pixelType=F(b.pixelType);a=z.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:w,noDataValue:B});var c=[],d,e=null;for(d=0;d<a.pixels.length;d++)e=
a.pixels[d],c.push(this._calculateBandStatistics(e));return new h({width:b.width,height:b.height,pixels:a.pixels,pixelType:b.pixelType,mask:a.maskData,statistics:c})},_decodeTiff:function(a,b){this._validateDecodeParams(b);B=b.noDataValue;b.pixelType=F(b.pixelType);a=E.decode(a);b=[];var c,d=null;for(c=0;c<a.pixels.length;c++)d=a.pixels[c],b.push(this._calculateBandStatistics(d,a.maskData));return new h({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType,mask:a.maskData,statistics:b})},
_decodeLerc:function(b,c){this._validateDecodeParams(c);B=c.noDataValue;c.pixelType=F(c.pixelType);for(var d=0,e,g=0,n,f=b.byteLength-10;g<f;){var u=a.decode(b,{inputOffset:g,encodedMaskData:e,returnMask:0===d?!0:!1,returnEncodedMask:0===d?!0:!1,returnFileInfo:!0,pixelType:w,noDataValue:B}),g=u.fileInfo.eofOffset;0===d&&(e=u.encodedMaskData,n=new h({width:c.width,height:c.height,pixels:[],pixelType:c.pixelType,mask:u.maskData,statistics:[]}));d++;if(!D(u,c))throw"The decoded image dimensions are incorrect";
n.addData({pixels:u.pixelData,statistics:{minValue:u.minValue,maxValue:u.maxValue,noDataValue:u.noDataValue}})}return n},_decodeLerc2:function(a,b){this._validateDecodeParams(b);B=b.noDataValue;b.pixelType=F(b.pixelType);for(var c=0,d,e,g=0,n,f=a.byteLength-10,p=[];g<f;){e=u.decode(a,{inputOffset:g,maskData:d,returnFileInfo:!0});g=e.fileInfo.eofOffset;0===c&&(d=e.maskData,n=new h({width:b.width,height:b.height,pixels:[],pixelType:e.fileInfo.pixelType,mask:e.maskData,statistics:[]}));e.fileInfo.mask&&
0<e.fileInfo.mask.numBytes&&p.push(e.maskData);c++;if(!D(e,b))throw"The decoded image dimensions are incorrect";n.addData({pixels:e.pixelData,statistics:{minValue:e.minValue,maxValue:e.maxValue,noDataValue:e.noDataValue}})}if(1<p.length){e=n.width*n.height;n.bandMasks=p;d=new Uint8Array(e);d.set(p[0]);for(b=1;b<p.length;b++)for(a=p[b],c=0;c<e;c++)d[c]&=a[c];n.maskData=d}return n},_calculateBandStatistics:function(a,b){var c=Infinity,d=-Infinity,h=a.length,e,g=0;if(b)for(e=0;e<h;e++)b[e]&&(g=a[e],
c=g<c?g:c,d=g>d?g:d);else for(e=0;e<h;e++)g=a[e],c=g<c?g:c,d=g>d?g:d;return{minValue:c,maxValue:d}},_loadRasterFormatModules:function(){C||(A||(A=new q),10>l("ie")?A.isRejected()||A.reject("unsupported browser version"):t(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,b,c,d){v=a;x=b;z=c;E=d;C=!0;A.isResolved()||A.resolve(!0)}))}});var w=null,B=null,F=function(a){if("U1"===a||"U2"===a||"U4"===a||"U8"===a)return B=
Math.pow(2,8)-1,w=Uint8Array,"U8";"U16"===a?(B=B||Math.pow(2,16)-1,w=Uint16Array):"U32"===a?(B=B||Math.pow(2,32)-1,w=Uint32Array):"S8"===a?(B=B||0-Math.pow(2,7),w=Int8Array):"S16"===a?(B=B||0-Math.pow(2,15),w=Int16Array):"S32"===a?(B=B||0-Math.pow(2,31),w=Int32Array):w=Float32Array;return a},D=function(a,b){return a.height!==b.height||a.width!==b.width?!1:!0};l("extend-esri")&&k.setObject("layers.Raster",f,g);return f})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(t,f,k,q){t=t([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(e){if(e){if(!e.width||Math.floor(e.width)!==e.width)throw"PixelBlock: incorrect width";if(!e.height||Math.floor(e.height)!==e.height)throw"PixelBlock: incorrect height";if(!e.pixels)throw"PixelBlock: pixel data not present";this.width=e.width;this.height=e.height;this.pixels=e.pixels;
this.pixelType=e.pixelType||null;this.statistics=e.statistics;this.mask=e.mask||null;this.maskIsAlpha=e.maskIsAlpha||!1;e=e.validPixelCount;null==e&&(e=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=e}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(e){if(!e.pixels||!e.statistics)throw"Pixel data or statistics are not present";if(e.pixels.length!==
this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(e.statistics);this.pixels.push(e.pixels)},getAsRGBA:function(){var e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)},getAsRGBAFloat:function(){var e=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(e);return e},clone:function(e){e=
e||this;var r=new this.constructor;r.width=e.width;r.height=e.height;r.pixelType=e.pixelType;r.maskIsAlpha=e.maskIsAlpha;e.mask&&(r.mask=new Uint8Array(e.mask));var m,l,g;if(e.pixels)for(r.pixels=[],g=(l=e.pixels.length)&&e.pixels[0].slice,m=0;m<l;m++)r.pixels[m]=g?e.pixels[m].slice(0,e.pixels[m].length):new e.pixels[m].constructor(e.pixels[m]);if(e.statistics)for(r.statistics=[],l=e.statistics.length,m=0;m<l;m++)r.statistics[m]=f.clone(e.statistics[m]);e=e.validPixelCount;null==e&&(e=r.mask?this._getValidPixelCount(r.mask):
r.width*r.height);return r},clamp:function(e){if("F64"!==e&&"F32"!==e){var f;switch(e){case "U8":f=[0,255];break;case "U16":f=[0,65535];break;case "U32":f=[0,4294967295];break;case "S8":f=[-128,127];break;case "S16":f=[-32768,32767];break;case "S32":f=[-2147483648,2147483647];break;default:f=[-3.4*1E39,3.4*1E39]}var m=f[0];f=f[1];var l=this.pixels,g=this.width*this.height,p=l.length,d,c,n,b,h,a=[];for(b=0;b<p;b++){n=this._createEmptyBand(e,g);d=l[b];for(h=0;h<g;h++)c=d[h],n[h]=c>f?f:c<m?m:c;a.push(n)}this.pixels=
a;this.pixelType=e}},calculateStatistics:function(){var e,f=[],m,l=this.mask;for(e=0;e<this.pixels.length;e++)m=this.pixels[e],f.push(this._calculateBandStatistics(m,l));this.statistics=f},_getValidPixelCount:function(e){var f,m=0;for(f=0;f<e.length;f++)e[f]&&m++;return m},_createEmptyBand:function(e,f){switch(e){case "U8":e=new Uint8Array(f);break;case "U16":e=new Uint16Array(f);break;case "U32":e=new Uint32Array(f);break;case "S8":e=new Int8Array(f);break;case "S16":e=new Int16Array(f);break;case "S32":e=
new Int32Array(f);break;case "U32":e=new Uint32Array(f);break;case "F32":e=new Float32Array(f);break;case "F64":e=new Float64Array(f);break;default:e=new Float32Array(f)}return e},_fillFrom8Bit:function(e){var f=this.pixels,m=this.mask;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var l,g,p;l=g=p=f[0];3<=f.length&&(g=f[1],p=f[2]);var f=new Uint32Array(e),d=this.width*this.height;if(l.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(m&&m.length===d)if(this.maskIsAlpha)for(e=0;e<d;e++)m[e]&&(f[e]=m[e]<<24|p[e]<<16|g[e]<<8|l[e]);else for(e=0;e<d;e++)m[e]&&(f[e]=-16777216|p[e]<<16|g[e]<<8|l[e]);else for(e=0;e<d;e++)f[e]=-16777216|p[e]<<16|g[e]<<8|l[e]},_fillFromNon8Bit:function(e){var f=this.pixels,m=this.mask,l=this.statistics;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var g=1,p=0,g=1;l&&0<l.length?(p=l.map(function(b){return b.minValue}).reduce(function(b,c){return Math.min(b,
c)}),g=l.map(function(b){return b.maxValue-b.minValue}).reduce(function(b,c){return Math.max(b,c)}),g=255/g):(g=255,"S8"===this.pixelType?(p=-128,g=127):"U16"===this.pixelType?g=65535:"S16"===this.pixelType?(p=-32768,g=32767):"U32"===this.pixelType?g=4294967295:"S32"===this.pixelType?(p=-2147483648,g=2147483647):"F32"===this.pixelType?(p=-3.4*1E39,g=3.4*1E39):"F64"===this.pixelType&&(p=-Number.MAX_VALUE,g=Number.MAX_VALUE),g=255/(g-p));e=new Uint32Array(e);var l=this.width*this.height,d,c,n;d=f[0];
if(d.length!==l)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=f.length)if(c=f[1],n=f[2],m&&m.length===l)for(f=0;f<l;f++)m[f]&&(e[f]=-16777216|(n[f]-p)*g<<16|(c[f]-p)*g<<8|(d[f]-p)*g);else for(f=0;f<l;f++)e[f]=-16777216|(n[f]-p)*g<<16|(c[f]-p)*g<<8|(d[f]-p)*g;else if(m&&m.length===l)for(f=0;f<l;f++)c=(d[f]-p)*g,m[f]&&(e[f]=-16777216|c<<16|c<<8|c);else for(f=0;f<l;f++)c=(d[f]-p)*g,e[f]=-16777216|c<<16|c<<8|c},_fillFrom32Bit:function(e){var f=this.pixels,m=this.mask;
if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var l,g,p;l=g=p=f[0];3<=f.length&&(g=f[1],p=f[2]);var d=this.width*this.height;if(l.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var c=0;if(m&&m.length===d)for(f=0;f<d;f++)e[c++]=l[f],e[c++]=g[f],e[c++]=p[f],e[c++]=m[f]&1;else for(f=0;f<d;f++)e[c++]=l[f],e[c++]=g[f],e[c++]=p[f],e[c++]=1},_calculateBandStatistics:function(e,f){var m=Infinity,l=-Infinity,
g=e.length,p,d=0;if(f)for(p=0;p<g;p++)f[p]&&(d=e[p],m=d<m?d:m,l=d>l?d:l);else for(p=0;p<g;p++)d=e[p],m=d<m?d:m,l=d>l?d:l;return{minValue:m,maxValue:l}}});k("extend-esri")&&f.setObject("layers.PixelBlock",t,q);return t})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var t={defaultNoDataValue:-3.4027999387901484E38,decode:function(k,q){var e;q=q||{};var r=q.inputOffset||0,m=q.encodedMaskData||null===q.encodedMaskData,l={},g=new Uint8Array(k,r,10);l.fileIdentifierString=String.fromCharCode.apply(null,
g);if("CntZImage"!=l.fileIdentifierString.trim())throw"Unexpected file identifier string: "+l.fileIdentifierString;r+=10;g=new DataView(k,r,24);l.fileVersion=g.getInt32(0,!0);l.imageType=g.getInt32(4,!0);l.height=g.getUint32(8,!0);l.width=g.getUint32(12,!0);l.maxZError=g.getFloat64(16,!0);r+=24;if(!m)if(g=new DataView(k,r,16),l.mask={},l.mask.numBlocksY=g.getUint32(0,!0),l.mask.numBlocksX=g.getUint32(4,!0),l.mask.numBytes=g.getUint32(8,!0),l.mask.maxValue=g.getFloat32(12,!0),r+=16,0<l.mask.numBytes){var m=
new Uint8Array(Math.ceil(l.width*l.height/8)),g=new DataView(k,r,l.mask.numBytes),p=g.getInt16(0,!0),d=2,c=0;do{if(0<p)for(;p--;)m[c++]=g.getUint8(d++);else for(var n=g.getUint8(d++),p=-p;p--;)m[c++]=n;p=g.getInt16(d,!0);d+=2}while(d<l.mask.numBytes);if(-32768!==p||c<m.length)throw"Unexpected end of mask RLE encoding";l.mask.bitset=m;r+=l.mask.numBytes}else 0===(l.mask.numBytes|l.mask.numBlocksY|l.mask.maxValue)&&(m=new Uint8Array(Math.ceil(l.width*l.height/8)),l.mask.bitset=m);g=new DataView(k,r,
16);l.pixels={};l.pixels.numBlocksY=g.getUint32(0,!0);l.pixels.numBlocksX=g.getUint32(4,!0);l.pixels.numBytes=g.getUint32(8,!0);l.pixels.maxValue=g.getFloat32(12,!0);r+=16;m=l.pixels.numBlocksX;g=l.pixels.numBlocksY;m+=0<l.width%m?1:0;p=g+(0<l.height%g?1:0);l.pixels.blocks=Array(m*p);for(c=d=0;c<p;c++)for(n=0;n<m;n++){var b=0,g=new DataView(k,r,Math.min(10,k.byteLength-r)),h={};l.pixels.blocks[d++]=h;var a=g.getUint8(0);b++;h.encoding=a&63;if(3<h.encoding)throw"Invalid block encoding ("+h.encoding+
")";if(2===h.encoding)r++;else{if(0!==a&&2!==a){a>>=6;h.offsetType=a;if(2===a)h.offset=g.getInt8(1),b++;else if(1===a)h.offset=g.getInt16(1,!0),b+=2;else if(0===a)h.offset=g.getFloat32(1,!0),b+=4;else throw"Invalid block offset type";if(1===h.encoding)if(a=g.getUint8(b),b++,h.bitsPerPixel=a&63,a>>=6,h.numValidPixelsType=a,2===a)h.numValidPixels=g.getUint8(b),b++;else if(1===a)h.numValidPixels=g.getUint16(b,!0),b+=2;else if(0===a)h.numValidPixels=g.getUint32(b,!0),b+=4;else throw"Invalid valid pixel count type";
}r+=b;if(3!=h.encoding)if(0===h.encoding){a=(l.pixels.numBytes-1)/4;if(a!==Math.floor(a))throw"uncompressed block has invalid length";g=new ArrayBuffer(4*a);b=new Uint8Array(g);b.set(new Uint8Array(k,r,4*a));g=new Float32Array(g);h.rawData=g;r+=4*a}else 1===h.encoding&&(a=Math.ceil(h.numValidPixels*h.bitsPerPixel/8),g=new ArrayBuffer(4*Math.ceil(a/4)),b=new Uint8Array(g),b.set(new Uint8Array(k,r,a)),h.stuffedData=new Uint32Array(g),r+=a)}}l.eofOffset=r;k=null!=q.noDataValue?q.noDataValue:t.defaultNoDataValue;
var m=q.encodedMaskData,a=q.returnMask,p=0,d=l.pixels.numBlocksX,c=l.pixels.numBlocksY,n=Math.floor(l.width/d),h=Math.floor(l.height/c),b=2*l.maxZError,r=Number.MAX_VALUE,u,m=m||(l.mask?l.mask.bitset:null),v,g=new (q.pixelType||Float32Array)(l.width*l.height);a&&m&&(v=new Uint8Array(l.width*l.height));for(var a=new Float32Array(n*h),x,z,E=0;E<=c;E++){var C=E!==c?h:l.height%c;if(0!==C)for(var A=0;A<=d;A++){var w=A!==d?n:l.width%d;if(0!==w){var B=E*l.width*h+A*n,F=l.width-w,D=l.pixels.blocks[p],G,H;
if(2>D.encoding){if(0===D.encoding)G=D.rawData;else{G=D.stuffedData;H=D.bitsPerPixel;u=D.numValidPixels;x=D.offset;z=b;var M=a,L=l.pixels.maxValue,J=(1<<H)-1,K=0,N=void 0,P=0,Q=void 0,O=void 0,R=Math.ceil((L-x)/z);G[G.length-1]<<=8*(4*G.length-Math.ceil(H*u/8));for(N=0;N<u;N++)0===P&&(O=G[K++],P=32),P>=H?(Q=O>>>P-H&J,P-=H):(P=H-P,Q=(O&J)<<P&J,O=G[K++],P=32-P,Q+=O>>>P),M[N]=Q<R?x+Q*z:L;G=a}H=0}else e=2===D.encoding?0:D.offset;var I;if(m)for(z=0;z<C;z++){B&7&&(I=m[B>>3],I<<=B&7);for(x=0;x<w;x++)B&7||
(I=m[B>>3]),I&128?(v&&(v[B]=1),u=2>D.encoding?G[H++]:e,r=r>u?u:r,g[B++]=u):(v&&(v[B]=0),g[B++]=k),I<<=1;B+=F}else if(2>D.encoding)for(z=0;z<C;z++){for(x=0;x<w;x++)u=G[H++],r=r>u?u:r,g[B++]=u;B+=F}else for(r=r>e?e:r,z=0;z<C;z++){for(x=0;x<w;x++)g[B++]=e;B+=F}if(1===D.encoding&&H!==D.numValidPixels)throw"Block and Mask do not match";p++}}}e=v;v={width:l.width,height:l.height,pixelData:g,minValue:r,maxValue:l.pixels.maxValue,noDataValue:k};e&&(v.maskData=e);q.returnEncodedMask&&l.mask&&(v.encodedMaskData=
l.mask.bitset?l.mask.bitset:null);if(q.returnFileInfo&&(v.fileInfo=f(l),q.computeUsedBitDepths)){q=v.fileInfo;e=l.pixels.numBlocksX*l.pixels.numBlocksY;I={};for(G=0;G<e;G++)H=l.pixels.blocks[G],0===H.encoding?I.float32=!0:1===H.encoding?I[H.bitsPerPixel]=!0:I[0]=!0;l=Object.keys(I);q.bitDepths=l}return v}},f=function(f){return{fileIdentifierString:f.fileIdentifierString,fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?
{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,noDataValue:this.noDataValue}}};return t})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var t={unstuff:function(f,e,r,m,l,g,p,d){var c=(1<<r)-1,n=0,b,h=0,a,u;f[f.length-1]<<=8*(4*f.length-Math.ceil(r*m/8));if(l)for(b=0;b<m;b++)0===h&&(u=
f[n++],h=32),h>=r?(a=u>>>h-r&c,h-=r):(h=r-h,a=(u&c)<<h&c,u=f[n++],h=32-h,a+=u>>>h),e[b]=l[a];else for(l=Math.ceil((d-g)/p),b=0;b<m;b++)0===h&&(u=f[n++],h=32),h>=r?(a=u>>>h-r&c,h-=r):(h=r-h,a=(u&c)<<h&c,u=f[n++],h=32-h,a+=u>>>h),e[b]=a<l?g+a*p:d},unstuffLUT:function(f,e,r,m,l,g){var p=(1<<e)-1,d=0,c=0,n=0,b=n=0,h,a=[];f[f.length-1]<<=8*(4*f.length-Math.ceil(e*r/8));for(var u=Math.ceil((g-m)/l),c=0;c<r;c++)0===n&&(h=f[d++],n=32),n>=e?(b=h>>>n-e&p,n-=e):(n=e-n,b=(h&p)<<n&p,h=f[d++],n=32-n,b+=h>>>n),
a[c]=b<u?m+b*l:g;a.unshift(m);return a},unstuff2:function(f,e,r,m,l,g,p,d){var c=(1<<r)-1,n=0,b,h=0,a=0,u,q,k;if(l)for(b=0;b<m;b++)0===h&&(q=f[n++],h=32,a=0),h>=r?(u=q>>>a&c,h-=r,a+=r):(k=r-h,u=q>>>a&c,q=f[n++],h=32-k,u|=(q&(1<<k)-1)<<r-k,a=k),e[b]=l[u];else for(l=Math.ceil((d-g)/p),b=0;b<m;b++)0===h&&(q=f[n++],h=32,a=0),h>=r?(u=q>>>a&c,h-=r,a+=r):(k=r-h,u=q>>>a&c,q=f[n++],h=32-k,u|=(q&(1<<k)-1)<<r-k,a=k),e[b]=u<l?g+u*p:d;return e},unstuffLUT2:function(f,e,r,m,l,g){for(var p=(1<<e)-1,d=0,c=0,n=0,
b=0,h=0,a=0,u,q=[],k=Math.ceil((g-m)/l),c=0;c<r;c++)0===b&&(u=f[d++],b=32,a=0),b>=e?(h=u>>>a&p,b-=e,a+=e):(n=e-b,h=u>>>a&p,u=f[d++],b=32-n,h|=(u&(1<<n)-1)<<e-n,a=n),q[c]=h<k?m+h*l:g;q.unshift(m);return q},originalUnstuff:function(f,e,r,m){var l=(1<<r)-1,g=0,p,d=0,c,n;f[f.length-1]<<=8*(4*f.length-Math.ceil(r*m/8));for(p=0;p<m;p++)0===d&&(n=f[g++],d=32),d>=r?(c=n>>>d-r&l,d-=r):(d=r-d,c=(n&l)<<d&l,n=f[g++],d=32-d,c+=n>>>d),e[p]=c;return e},originalUnstuff2:function(f,e,r,m){var l=(1<<r)-1,g=0,p,d=0,
c=0,n,b,h;for(p=0;p<m;p++)0===d&&(b=f[g++],d=32,c=0),d>=r?(n=b>>>c&l,d-=r,c+=r):(h=r-d,n=b>>>c&l,b=f[g++],d=32-h,n|=(b&(1<<h)-1)<<r-h,c=h),e[p]=n;return e}},f={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(f){for(var e=65535,r=65535,m=f.length,l=Math.floor(m/2),g=0;l;){var p=359<=l?359:l,l=l-p;do e+=f[g++]<<8,r+=e+=f[g++];while(--p);e=(e&65535)+(e>>>16);r=(r&65535)+(r>>>16)}m&1&&(r+=e+=f[g]<<8);return((r&65535)+(r>>>16)<<16|(e&65535)+(e>>>16))>>>0},readHeaderInfo:function(f,e){var r=
e.ptr,m=new Uint8Array(f,r,6),l={};l.fileIdentifierString=String.fromCharCode.apply(null,m);if(0!==l.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+l.fileIdentifierString;var r=r+6,m=new DataView(f,r,8),g=m.getInt32(0,!0);l.fileVersion=g;r+=4;3<=g&&(l.checksum=m.getUint32(4,!0),r+=4);m=new DataView(f,r,12);l.height=m.getUint32(0,!0);l.width=m.getUint32(4,!0);r+=8;4<=g?(l.numDims=m.getUint32(8,!0),r+=4):l.numDims=1;m=new DataView(f,r,40);l.numValidPixel=
m.getUint32(0,!0);l.microBlockSize=m.getInt32(4,!0);l.blobSize=m.getInt32(8,!0);l.imageType=m.getInt32(12,!0);l.maxZError=m.getFloat64(16,!0);l.zMin=m.getFloat64(24,!0);l.zMax=m.getFloat64(32,!0);r+=40;e.headerInfo=l;e.ptr=r;if(3<=g&&(f=this.computeChecksumFletcher32(new Uint8Array(f,r-(4<=g?52:48),l.blobSize-14)),f!==l.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(f,e){var r=e.headerInfo,m=this.getDataTypeArray(r.imageType),l=r.numDims*this.getDataTypeSize(r.imageType),g=
this.readSubArray(f,e.ptr,m,l);f=this.readSubArray(f,e.ptr+l,m,l);e.ptr+=2*l;l=!0;for(e=0;e<r.numDims;e++)if(g[e]!==f[e]){l=!1;break}r.minValues=g;r.maxValues=f;return l},readSubArray:function(f,e,r,m){if(r===Uint8Array)f=new Uint8Array(f,e,m);else{var l=new ArrayBuffer(m);(new Uint8Array(l)).set(new Uint8Array(f,e,m));f=new r(l)}return f},readMask:function(f,e){var r=e.ptr,m=e.headerInfo,l=m.width*m.height,g=m.numValidPixel,p=new DataView(f,r,4),m={};m.numBytes=p.getUint32(0,!0);r+=4;if((0===g||
l===g)&&0!==m.numBytes)throw"invalid mask";if(0===g)g=new Uint8Array(Math.ceil(l/8)),m.bitset=g,p=new Uint8Array(l),e.pixels.resultMask=p,r+=m.numBytes;else if(0<m.numBytes){g=new Uint8Array(Math.ceil(l/8));p=new DataView(f,r,m.numBytes);f=p.getInt16(0,!0);var d=2,c=0,n=0;do{if(0<f)for(;f--;)g[c++]=p.getUint8(d++);else for(n=p.getUint8(d++),f=-f;f--;)g[c++]=n;f=p.getInt16(d,!0);d+=2}while(d<m.numBytes);if(-32768!==f||c<g.length)throw"Unexpected end of mask RLE encoding";p=new Uint8Array(l);for(d=
d=f=0;d<l;d++)d&7?(f=g[d>>3],f<<=d&7):f=g[d>>3],f&128&&(p[d]=1);e.pixels.resultMask=p;m.bitset=g;r+=m.numBytes}e.ptr=r;e.mask=m;return!0},readDataOneSweep:function(q,e,r){var m=e.ptr,l=e.headerInfo,g=l.numDims,p=l.width*l.height,l=l.numValidPixel*f.getDataTypeSize(l.imageType)*g,d=e.pixels.resultMask;if(r===Uint8Array)q=new Uint8Array(q,m,l);else{var c=new ArrayBuffer(l);(new Uint8Array(c)).set(new Uint8Array(q,m,l));q=new r(c)}if(q.length===p*g)e.pixels.resultPixels=q;else{e.pixels.resultPixels=
new r(p*g);var n=c=r=0,b=0;if(1<g)for(n=0;n<g;n++)for(b=n*p,c=0;c<p;c++)d[c]&&(e.pixels.resultPixels[b+c]=q[r++]);else for(c=0;c<p;c++)d[c]&&(e.pixels.resultPixels[c]=q[r++])}e.ptr=m+l;return!0},readHuffmanTree:function(q,e){var r=this.HUFFMAN_LUT_BITS_MAX,m=new DataView(q,e.ptr,16);e.ptr+=16;if(2>m.getInt32(0,!0))throw"unsupported Huffman version";var l=m.getInt32(4,!0),g=m.getInt32(8,!0),m=m.getInt32(12,!0);if(g>=m)return!1;var p=new Uint32Array(m-g);f.decodeBits(q,e,p);var d=[],c,n,b;for(c=g;c<
m;c++)n=c-(c<l?0:l),d[n]={first:p[c-g],second:null};c=q.byteLength-e.ptr;p=new ArrayBuffer(4*Math.ceil(c/4));(new Uint8Array(p)).set(new Uint8Array(q,e.ptr,c));q=new Uint32Array(p);e=0;var h,p=0;h=q[0];for(c=g;c<m;c++)n=c-(c<l?0:l),b=d[n].first,0<b&&(d[n].second=h<<e>>>32-b,32-e>=b?(e+=b,32===e&&(e=0,p++,h=q[p])):(e+=b-32,p++,h=q[p],d[n].second|=h>>>32-e));var a=h=0,u=new k;for(c=0;c<d.length;c++)void 0!==d[c]&&(h=Math.max(h,d[c].first));a=h>=r?r:h;30<=h&&console.log("WARning, large NUM LUT BITS IS "+
h);var r=[],v,x;for(c=g;c<m;c++)if(n=c-(c<l?0:l),b=d[n].first,0<b)if(g=[b,n],b<=a)for(n=d[n].second<<a-b,v=1<<a-b,b=0;b<v;b++)r[n|b]=g;else for(n=d[n].second,v=u,--b;0<=b;b--)(x=n>>>b&1)?(v.right||(v.right=new k),v=v.right):(v.left||(v.left=new k),v=v.left),0!==b||v.val||(v.val=g[1]);return{decodeLut:r,numBitsLUTQick:a,numBitsLUT:h,tree:u,stuffedData:q,srcPtr:p,bitPos:e}},readHuffman:function(f,e,r){var m=e.headerInfo,l=m.numDims,g=e.headerInfo.height,p=e.headerInfo.width,d=p*g,c=this.readHuffmanTree(f,
e);f=c.decodeLut;var n=c.tree,b=c.stuffedData,h=c.srcPtr,a=c.bitPos,u=c.numBitsLUTQick,c=c.numBitsLUT,q=0===e.headerInfo.imageType?128:0,k,z,t=e.pixels.resultMask,C,A,w,B,F,D,G=0;0<a&&(h++,a=0);var H=b[h],M=1===e.encodeMode,L=new r(d*l),J=L,K;for(K=0;K<m.numDims;K++){1<l&&(J=new r(L.buffer,d*K,d),G=0);if(e.headerInfo.numValidPixel===p*g)for(w=F=0;w<g;w++)for(B=0;B<p;B++,F++){z=0;k=C=H<<a>>>32-u;32-a<u&&(k=C|=b[h+1]>>>64-a-u);if(f[k])z=f[k][1],a+=f[k][0];else for(k=C=H<<a>>>32-c,32-a<c&&(k=C|=b[h+
1]>>>64-a-c),k=n,D=0;D<c;D++)if(k=(A=C>>>c-D-1&1)?k.right:k.left,!k.left&&!k.right){z=k.val;a=a+D+1;break}32<=a&&(a-=32,h++,H=b[h]);z-=q;M?(z=0<B?z+G:0<w?z+J[F-p]:z+G,z&=255,G=J[F]=z):J[F]=z}else for(w=F=0;w<g;w++)for(B=0;B<p;B++,F++)if(t[F]){z=0;k=C=H<<a>>>32-u;32-a<u&&(k=C|=b[h+1]>>>64-a-u);if(f[k])z=f[k][1],a+=f[k][0];else for(k=C=H<<a>>>32-c,32-a<c&&(k=C|=b[h+1]>>>64-a-c),k=n,D=0;D<c;D++)if(k=(A=C>>>c-D-1&1)?k.right:k.left,!k.left&&!k.right){z=k.val;a=a+D+1;break}32<=a&&(a-=32,h++,H=b[h]);z-=
q;M?(z=0<B&&t[F-1]?z+G:0<w&&t[F-p]?z+J[F-p]:z+G,z&=255,G=J[F]=z):J[F]=z}e.ptr=e.ptr+4*(h+1)+(0<a?4:0)}e.pixels.resultPixels=L},decodeBits:function(f,e,r,m,l){var g=e.headerInfo,p=g.fileVersion,d=0,c=new DataView(f,e.ptr,5<=f.byteLength-e.ptr?5:f.byteLength-e.ptr),n=c.getUint8(0);d++;var b=n>>6,h=0===b?4:3-b,a=0<(n&32)?!0:!1,b=n&31,n=0;if(1===h)n=c.getUint8(d),d++;else if(2===h)n=c.getUint16(d,!0),d+=2;else if(4===h)n=c.getUint32(d,!0),d+=4;else throw"Invalid valid pixel count type";var h=2*g.maxZError,
u,q;l=1<g.numDims?g.maxValues[l]:g.zMax;if(a){e.counter.lut++;a=c.getUint8(d);d++;g=Math.ceil((a-1)*b/8);u=Math.ceil(g/4);u=new ArrayBuffer(4*u);q=new Uint8Array(u);e.ptr+=d;q.set(new Uint8Array(f,e.ptr,g));d=new Uint32Array(u);e.ptr+=g;for(c=0;a-1>>>c;)c++;g=Math.ceil(n*c/8);u=Math.ceil(g/4);u=new ArrayBuffer(4*u);q=new Uint8Array(u);q.set(new Uint8Array(f,e.ptr,g));f=new Uint32Array(u);e.ptr+=g;e=3<=p?t.unstuffLUT2(d,b,a-1,m,h,l):t.unstuffLUT(d,b,a-1,m,h,l);3<=p?t.unstuff2(f,r,c,n,e):t.unstuff(f,
r,c,n,e)}else e.counter.bitstuffer++,c=b,e.ptr+=d,0<c&&(g=Math.ceil(n*c/8),u=Math.ceil(g/4),u=new ArrayBuffer(4*u),q=new Uint8Array(u),q.set(new Uint8Array(f,e.ptr,g)),f=new Uint32Array(u),e.ptr+=g,3<=p?null==m?t.originalUnstuff2(f,r,c,n):t.unstuff2(f,r,c,n,!1,m,h,l):null==m?t.originalUnstuff(f,r,c,n):t.unstuff(f,r,c,n,!1,m,h,l))},readTiles:function(q,e,r){var m=e.headerInfo,l=m.width,g=m.height,p=m.microBlockSize,d=m.imageType,c=f.getDataTypeSize(d),n=Math.ceil(l/p),b=Math.ceil(g/p);e.pixels.numBlocksY=
b;e.pixels.numBlocksX=n;for(var h=e.pixels.ptr=0,a=0,u=0,k=0,x=0,z=0,t=0,C=0,A=h=0,w=0,B=0,t=t=h=t=0,F,D=new r(p*p),G=g%p||p,H=l%p||p,m=m.numDims,M,L=e.pixels.resultMask,J=e.pixels.resultPixels,u=0;u<b;u++)for(x=u!==b-1?p:G,k=0;k<n;k++)for(z=k!==n-1?p:H,w=u*l*p+k*p,B=l-z,M=0;M<m;M++){1<m&&(J=new r(e.pixels.resultPixels.buffer,l*g*M*c,l*g));t=q.byteLength-e.ptr;a=new DataView(q,e.ptr,Math.min(10,t));F={};t=0;C=a.getUint8(0);t++;h=C>>6&255;A=C>>2&15;if(A!==(k*p>>3&15))throw"integrity issue";C&=3;if(3<
C)throw e.ptr+=t,"Invalid block encoding ("+C+")";if(2===C)e.counter.constant++,e.ptr+=t;else if(0===C){e.counter.uncompressed++;e.ptr+=t;t=x*z*c;h=q.byteLength-e.ptr;t=t<h?t:h;h=new ArrayBuffer(0===t%c?t:t+c-t%c);a=new Uint8Array(h);a.set(new Uint8Array(q,e.ptr,t));F=new r(h);t=0;if(L)for(h=0;h<x;h++){for(a=0;a<z;a++)L[w]&&(J[w]=F[t++]),w++;w+=B}else for(h=0;h<x;h++){for(a=0;a<z;a++)J[w++]=F[t++];w+=B}e.ptr+=t*c}else if(h=f.getDataTypeUsed(d,h),F=f.getOnePixel(F,t,h,a),t+=f.getDataTypeSize(h),3===
C)if(e.ptr+=t,e.counter.constantoffset++,L)for(h=0;h<x;h++){for(a=0;a<z;a++)L[w]&&(J[w]=F),w++;w+=B}else for(h=0;h<x;h++){for(a=0;a<z;a++)J[w++]=F;w+=B}else if(e.ptr+=t,f.decodeBits(q,e,D,F,M),t=0,L)for(h=0;h<x;h++){for(a=0;a<z;a++)L[w]&&(J[w]=D[t++]),w++;w+=B}else for(h=0;h<x;h++){for(a=0;a<z;a++)J[w++]=D[t++];w+=B}}},formatFileInfo:function(q){return{fileIdentifierString:q.headerInfo.fileIdentifierString,fileVersion:q.headerInfo.fileVersion,imageType:q.headerInfo.imageType,height:q.headerInfo.height,
width:q.headerInfo.width,numValidPixel:q.headerInfo.numValidPixel,microBlockSize:q.headerInfo.microBlockSize,blobSize:q.headerInfo.blobSize,maxZError:q.headerInfo.maxZError,pixelType:f.getPixelType(q.headerInfo.imageType),eofOffset:q.eofOffset,mask:q.mask?{numBytes:q.mask.numBytes}:null,pixels:{numBlocksX:q.pixels.numBlocksX,numBlocksY:q.pixels.numBlocksY,maxValue:q.headerInfo.zMax,minValue:q.headerInfo.zMin,noDataValue:q.noDataValue}}},constructConstantSurface:function(f){var e=f.headerInfo.zMax,
r=f.headerInfo.numDims,m=f.headerInfo.height*f.headerInfo.width,l=m*r,g=0,p=0,d=0,c=f.pixels.resultMask;if(c)if(1<r)for(g=0;g<r;g++)for(d=g*m,p=0;p<m;p++)c[p]&&(f.pixels.resultPixels[d+p]=e);else for(p=0;p<m;p++)c[p]&&(f.pixels.resultPixels[p]=e);else if(f.pixels.resultPixels.fill)f.pixels.resultPixels.fill(e);else for(p=0;p<l;p++)f.pixels.resultPixels[p]=e},getDataTypeArray:function(f){switch(f){case 0:f=Int8Array;break;case 1:f=Uint8Array;break;case 2:f=Int16Array;break;case 3:f=Uint16Array;break;
case 4:f=Int32Array;break;case 5:f=Uint32Array;break;case 6:f=Float32Array;break;case 7:f=Float64Array;break;default:f=Float32Array}return f},getPixelType:function(f){switch(f){case 0:f="S8";break;case 1:f="U8";break;case 2:f="S16";break;case 3:f="U16";break;case 4:f="S32";break;case 5:f="U32";break;case 6:f="F32";break;case 7:f="F64";break;default:f="F32"}return f},isValidPixelValue:function(f,e){if(null==e)return!1;switch(f){case 0:f=-128<=e&&127>=e;break;case 1:f=0<=e&&255>=e;break;case 2:f=-32768<=
e&&32767>=e;break;case 3:f=0<=e&&65536>=e;break;case 4:f=-2147483648<=e&&2147483647>=e;break;case 5:f=0<=e&&4294967296>=e;break;case 6:f=-3.4027999387901484E38<=e&&3.4027999387901484E38>=e;break;case 7:f=4.9E-324<=e&&1.7976931348623157E308>=e;break;default:f=!1}return f},getDataTypeSize:function(f){var e=0;switch(f){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=f}return e},getDataTypeUsed:function(f,e){var r=f;switch(f){case 2:case 4:r=f-
e;break;case 3:case 5:r=f-2*e;break;case 6:r=0===e?f:1===e?2:1;break;case 7:r=0===e?f:f-2*e+1;break;default:r=f}return r},getOnePixel:function(f,e,r,m){f=0;switch(r){case 0:f=m.getInt8(e);break;case 1:f=m.getUint8(e);break;case 2:f=m.getInt16(e,!0);break;case 3:f=m.getUint16(e,!0);break;case 4:f=m.getInt32(e,!0);break;case 5:f=m.getUInt32(e,!0);break;case 6:f=m.getFloat32(e,!0);break;case 7:f=m.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type";}return f}},k=function(f,
e,r){this.val=f;this.left=e;this.right=r};return{decode:function(k,e){e=e||{};var r=e.noDataValue,m=0,l={};l.ptr=e.inputOffset||0;l.pixels={};if(f.readHeaderInfo(k,l)){var m=l.headerInfo,g=m.fileVersion,p=f.getDataTypeArray(m.imageType);f.readMask(k,l);m.numValidPixel===m.width*m.height||l.pixels.resultMask||(l.pixels.resultMask=e.maskData);var d=m.width*m.height;l.pixels.resultPixels=new p(d*m.numDims);l.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==m.numValidPixel)if(m.zMax===
m.zMin)f.constructConstantSurface(l);else if(4<=g&&f.checkMinMaxRanges(k,l))f.constructConstantSurface(l);else{var c=new DataView(k,l.ptr,2),n=c.getUint8(0);l.ptr++;if(n)f.readDataOneSweep(k,l,p);else if(1<g&&1>=m.imageType&&1E-5>Math.abs(m.maxZError-.5)){c=c.getUint8(1);l.ptr++;l.encodeMode=c;if(2<c||4>g&&1<c)throw"Invalid Huffman flag "+c;c?f.readHuffman(k,l,p):f.readTiles(k,l,p)}else f.readTiles(k,l,p)}l.eofOffset=l.ptr;e.inputOffset?(k=l.headerInfo.blobSize+e.inputOffset-l.ptr,1<=Math.abs(k)&&
(l.eofOffset=e.inputOffset+l.headerInfo.blobSize)):(k=l.headerInfo.blobSize-l.ptr,1<=Math.abs(k)&&(l.eofOffset=l.headerInfo.blobSize));k={width:m.width,height:m.height,pixelData:l.pixels.resultPixels,minValue:m.zMin,maxValue:m.zMax,validPixelCount:m.numValidPixel,dimCount:m.numDims,dimStats:{minValues:m.minValues,maxValues:m.maxValues},maskData:l.pixels.resultMask};if(l.pixels.resultMask&&f.isValidPixelValue(m.imageType,r)){g=l.pixels.resultMask;for(m=0;m<d;m++)g[m]||(k.pixelData[m]=r);k.noDataValue=
r}l.noDataValue=r;e.returnFileInfo&&(k.fileInfo=f.formatFileInfo(l));return k}},getBandCount:function(k){for(var e=0,r=0,m={ptr:0,pixels:{}};r<k.byteLength-58;)f.readHeaderInfo(k,m),r+=m.headerInfo.blobSize,e++,m.ptr=r;return e}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(t,f,k,q,e,r){t=t(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond",
"esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(e){f.mixin(this,e);this.isDataUV=e&&e.isDataUV?e.isDataUV:!1;this.computeMagnitudeAndDirection=f.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(e,f){this.inputUnit=e;this.outputUnit=f;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var e=r.indexOf(this.speedUnits,this.inputUnit),f=r.indexOf(this.speedUnits,
this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=e&&0<=f){var g=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=g[e]/g[f]}},computeMagnitudeAndDirection:function(f){if(!e.isDefined(f))throw"Could not compute magnitude and direction. No pixel data is available.";var l=f.pixelBlock;if(!e.isDefined(l)||2!==l.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var g=f.extent,p=(g.xmax-g.xmin)/l.width,d=(g.ymax-g.ymin)/l.height,c=
g.xmin+p/2,g=g.ymax-d/2;l.statistics[0].minValue=0;l.statistics[0].maxValue=0;var n=180/Math.PI,b=[],h=0,a=0,u=0,m=!e.isDefined(l.mask),r,k,q,t,A,w,B,F;A=B=Infinity;w=F=-Infinity;for(h=0;h<l.height;h++)for(a=0;a<l.width;a++,u++)if(b.push([c+p*a,g-d*h]),m||l.mask[u])q=r=l.pixels[0][u]*this.unitConversionFactor,t=k=l.pixels[1][u],this.isDataUV&&(q=Math.sqrt(r*r+k*k),t=90-n*Math.atan2(k,r),l.pixels[0][u]=q*this.unitConversionFactor,l.pixels[1][u]=t),q>w&&(w=q),q<A&&(A=q),t>F&&(F=t),t<B&&(B=t);l.statistics[0].maxValue=
w;l.statistics[0].minValue=A;l.statistics[1].maxValue=F;l.statistics[1].minValue=B;f.locations=b;return f}});k("extend-esri")&&f.setObject("layers.pixelFilters.VectorFieldPixelFilter",t,q);return t})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(t,f,k,q){var e;return f(null,{constructor:function(e){this.ctx=e.ctx;this._loadRasterFormatModule()},decode:function(e,f){if(!f.width||!f.height)throw"Native decoding requires the image format, width and height";
var l=new k,g,p=new Uint8Array(e);e=this._getFormat(e);if("error"===e)throw"invalid format";"jpeg"===e&&(g=this._getMask(p,f));var d="",c,n;for(c=0;c<p.length;c+=65535)n=p.subarray(c,c+65535>p.length-1?p.length-1:c+65535),d+=String.fromCharCode.apply(null,n);var p="data:image/"+e+";base64,"+window.btoa(d),b=new Image,h;b.src=p;var a=this;b.onload=function(){a.ctx.clearRect(0,0,f.width,f.height);a.ctx.drawImage(b,0,0);var d=a.ctx.getImageData(0,0,b.width,b.height);h=d.data;if(g)for(c=0;c<g.length;c++)h[4*
c+3]=g[c]?255:0;a.ctx.putImageData(d,0,0);l.resolve(null)};b.onerror=function(){l.reject("cannot load image")};return l},_getFormat:function(e){e=new Uint8Array(e,0,10);var f="error";255===e[0]&&216===e[1]?f="jpeg":137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&(f="png");return f},_getMask:function(f,m){var l;try{if(!e)throw"The zlib decoder module is not loaded.";var g=0,p=0,d=Math.round(f.length/2);1===d%2&&(d+=1);for(var c=f.length-2,g=d;g<c&&(255!==f[g]||217!==f[g+1]);g++);d=g+=2;if(d<f.length-
1){var n=(new e(f.subarray(d))).getBytes();l=new Uint8Array(m.width*m.height);for(g=f=0;g<n.length;g++)for(p=7;0<=p;p--)l[f++]=n[g]>>p&1}}catch(b){}return l},_loadRasterFormatModule:function(){10>q("ie")||t(["./Zlib"],function(f){e=f})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(t,f,k,q,e,r,m,l){t=t(m,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(e){this._url.path+="/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(e,f,d,c,n){try{var b=new l(e);this._successHandler([b],"onComplete",d,n)}catch(h){this._errorHandler(h,c,n)}},execute:function(g,p,d,c){var n=c.assembly;g=this._encode(f.mixin({},this._url.query,{f:"json"},g.toJson(n&&n[0])));var b=this._handler,h=this._errorHandler;return e({url:this._url.path,content:g,callbackParamName:"callback",
load:function(a,h){b(a,h,p,d,c.dfd)},error:function(a){h(a,d,c.dfd)}})},onComplete:function(){}});r._createWrappers(t);k("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyTask",t,q);return t})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(t,f,k,q,e,r){t=t(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(f){f.catalogItems&&(this.catalogItems=
new r(f.catalogItems));f.location&&(this.location=e.fromJson(f.location));this.catalogItemVisibilities=f.catalogItemVisibilities;this.name=f.name;this.objectId=f.objectId;this.value=f.value;this.processedValues=f.processedValues;this.properties=f.properties}});k("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyResult",t,q);return t})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(t,f,k,q,e,r,m,l){t=t(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(e){var f=e&&e.geometry||this.geometry;e={geometry:f,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?k.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?k.toJson(this.renderingRule.toJson()):null};f&&(e.geometryType=l.getJsonType(f));f=this.timeExtent;e.time=f?f.toJson().join(","):null;m.isDefined(this.pixelSizeX)&&m.isDefined(this.pixelSizeY)?e.pixelSize=k.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(e.pixelSize=this.pixelSize?k.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(e.renderingRules=k.toJson(q.map(this.renderingRules,function(d){return d.toJson()})));
m.isDefined(this.returnPixelValues)&&(e.returnPixelValues=this.returnPixelValues);m.isDefined(this.maxItemCount)&&(e.maxItemCount=this.maxItemCount);return e}});e("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyParameters",t,r);return t})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(t,f,k){var q;return t(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(e){this.stretchType=e.stretchType||e.StretchType||this.stretchType;this.min=e.min||e.Min||this.min;this.max=e.max||e.Max||this.max;this.numberOfStandardDeviations=e.numberOfStandardDeviations||e.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=e.statistics||e.Statistics||this.statistics;this.dra=e.dra||e.DRA||e.dRA||this.dra;this.minPercent=e.minPercent||e.MinPercent||
this.minPercent;this.maxPercent=e.maxPercent||e.MaxPercent||this.maxPercent;this.useGamma=e.useGamma||e.UseGamma||this.useGamma;this.gamma=e.gamma||e.Gamma||this.gamma;this.computeGamma=e.computeGamma||e.ComputeGamma||this.computeGamma;this.raster=e.raster||e.Raster||this.raster;this.outputPixelType=e.outputPixelType||e.OutputPixelType||this.outputPixelType;this.raster=e.raster||e.Raster||this.raster;q=this},filter:function(e){if(null!==e&&null!==e.pixelBlock&&null!==e.pixelBlock.pixels){var f=e.pixelBlock,
m=f.pixels,l=f.width*f.height,g=m.length,p;(p=6===q.stretchType||3===q.stretchType&&q.dra)&&q._calculateStatisticsHistograms(e);if(q.dra)if(p)q._statistics=f.statistics,q._histograms=f.histograms;else{var d=f.statistics;q._statistics=[];for(p=0;p<g;p++)q._statistics[p]=[d[p].minValue,d[p].maxValue,0,0]}else q._statistics=q.statistics,q._histograms=q.histograms;q.computeGamma&&(q.gamma=q._computeGammaValues(f.pixelType),q.useGamma=!0);q._createLUT(e);if(void 0===q.LUT||null===q.LUT)return q._filterNoLUT(e);
var d=q.LUT,c=q.LUTOffset,n,b;for(p=0;p<g;p++)for(b=d[p],f=0;f<l;f++)n=m[p][f],m[p][f]=b[n-c];e.pixelBlock.pixelType="U8";return e}},_calculateStatisticsHistograms:function(e){e=e.pixelBlock;var r=e.pixelType,m=e.pixels,l=e.mask,g=m.length,p,d,c,n,b=function(a){this.min=-.5;this.max=255.5;this.size=256;f.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},h=[],a,u,k,q,z,t;for(c=0;c<g;c++){a=new b;u=a.counts;q=m[c];if("U8"===r)if(l)for(n=0;n<e.width*e.height;n++)l[n]&&u[q[n]]++;else for(n=
0;n<e.width*e.height;n++)u[q[n]]++;else{p=e.statistics[c].minValue;d=e.statistics[c].maxValue;a.min=p;a.max=d;d=(d-p)/256;k=new Uint32Array(257);if(l)for(n=0;n<e.width*e.height;n++)l[n]&&k[Math.floor((q[n]-p)/d)]++;else for(n=0;n<e.width*e.height;n++)k[Math.floor((q[n]-p)/d)]++;for(n=0;255>n;n++)u[n]=k[n];u[255]=k[255]+k[256]}h.push(a);q=[];p=e.statistics[c].minValue;d=e.statistics[c].maxValue;for(n=t=z=k=0;n<a.size;n++)k+=u[n],z+=n*u[n];z/=k;for(n=0;n<a.size;n++)t+=u[n]*Math.pow(n-z,2);u=Math.sqrt(t/
(k-1));n=(z+.5)*(a.max-a.min)/a.size+a.min;a=u*(a.max-a.min)/a.size;q.push(p);q.push(d);q.push(n);q.push(a);e.statistics[c]=q}e.histograms=h},_getCutOffPoints:function(e){e=e.pixelBlock.pixels.length;var f=[],m=[],l,g,p,d,c,n;switch(q.stretchType){case 5:for(c=0;c<e;c++)f[c]=q._statistics[c][0],m[c]=q._statistics[c][1];break;case 3:for(c=0;c<e;c++)f[c]=q._statistics[c][2]-q.numberOfStandardDeviations*q._statistics[c][3],m[c]=q._statistics[c][2]+q.numberOfStandardDeviations*q._statistics[c][3],f[c]<
q._statistics[c][0]&&(f[c]=q._statistics[c][0]),m[c]>q._statistics[c][1]&&(m[c]=q._statistics[c][1]);break;case 6:for(c=0;c<e;c++){l=q._histograms[c];d=new Uint32Array(l.size);p=l.counts;for(n=g=0;n<l.size;n++)g+=p[n],d[n]=g;p=q.minPercent*g/100;for(n=1;n<l.size;n++)if(d[n]>p){f[c]=l.min+(l.max-l.min)/l.size*(n-.5);break}p=(1-q.maxPercent/100)*g;for(n=l.size-2;0<=n;n--)if(d[n]<p){m[c]=l.min+(l.max-l.min)/l.size*(n+.5);break}}break;default:for(c=0;c<e;c++)f[c]=0,m[c]=255}return{minCutOff:f,maxCutOff:m}},
_createLUT:function(e){var f=e.pixelBlock,m=f.pixelType;if("U8"===m||"U16"===m||"S8"===m||"S16"===m){if(q._LUTSignature&&(m=q._computeLutSignature(),m.length===q._LUTSignature.length&&!m.some(function(a,b){return a!==q._LUTSignature[b]})))return;var m=f.pixels.length,l=[],g=[],p=[],d,c,n,b=q.max,h=q.min,a=q.gamma,u=b-h,k=q._getCutOffPoints(e);e=k.minCutOff;var k=k.maxCutOff,x=0,z=256,t;"S8"===f.pixelType?x=-127:"S16"===f.pixelType&&(x=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)z=65536;for(f=
0;f<m;f++)l[f]=k[f]-e[f];if(q.useGamma&&null!==a&&a.length===m)for(f=0;f<m;f++)p[f]=1<a[f]?2<a[f]?6.5+Math.pow(a[f]-2,2.5):6.5+100*Math.pow(2-a[f],4):1;if(q.useGamma)for(var C,f=0;f<m;f++){t=[];for(d=0;d<z;d++)c=d+x,C=(c-e[f])/l[f],n=1,1<a[f]&&(n-=Math.pow(1/u,C*p[f])),c<k[f]&&c>e[f]?t[d]=Math.floor(n*u*Math.pow(C,1/a[f]))+h:c>k[f]?t[d]=b:c<e[f]&&(t[d]=h);g[f]=t}else for(f=0;f<m;f++){t=[];for(d=0;d<z;d++)c=d+x,t[d]=c<e[f]?h:c>k[f]?b:Math.floor((c-e[f])/l[f]*u)+h;g[f]=t}q.LUT=g;q.LUTOffset=x;q._LUTSignature=
q._computeLutSignature()}},_computeLutSignature:function(){var e=[],f,m;e.push(q.stretchType);e.push(q.min);e.push(q.max);e.push(q.numberOfStandardDeviations);if(q._statistics)for(f=0;f<q._statistics.length;f++)for(m=0;m<q._statistics[f].length;m++)e.push(q._statistics[f][m]);e.push(q.dra?1:0);e.push(q.minPercent);e.push(q.maxPercent);if(q.gamma)for(f=0;f<q._statistics.length;f++)e.push(q.gamma[f]);e.push(q.useGamma?1:0);return e},_filterNoLUT:function(e){if(null!==e&&null!==e.pixelBlock&&null!==
e.pixelBlock.pixels){var f=e.pixelBlock,m=f.pixels,l=f.mask,f=f.width*f.height,g=m.length,p=[],d=[],c,n,b,h,a,u=q.max,k=q.min,x=q.gamma,z=u-k;c=q._getCutOffPoints(e);var t=c.minCutOff,C=c.maxCutOff;for(c=0;c<g;c++)p[c]=C[c]-t[c];if(q.useGamma&&null!==x&&x.length===g)for(c=0;c<g;c++)d[c]=1<x[c]?2<x[c]?6.5+Math.pow(x[c]-2,2.5):6.5+100*Math.pow(2-x[c],4):1;if(q.useGamma)if(void 0!==l&&null!==l)for(n=0;n<f;n++){if(l[n])for(c=0;c<g;c++)b=m[c][n],a=(b-t[c])/p[c],h=1,1<x[c]&&(h-=Math.pow(1/z,a*d[c])),b<
C[c]&&b>t[c]?m[c][n]=Math.floor(h*z*Math.pow(a,1/x[c]))+k:b>C[c]?m[c][n]=u:b<t[c]&&(m[c][n]=k)}else for(n=0;n<f;n++)for(c=0;c<g;c++)b=m[c][n],a=(b-t[c])/p[c],h=1,1<x[c]&&(h-=Math.pow(1/z,a*d[c])),b<C[c]&&b>t[c]?m[c][n]=Math.floor(h*z*Math.pow(a,1/x[c]))+k:b>C[c]?m[c][n]=u:b<t[c]&&(m[c][n]=k);else if(void 0!==l&&null!==l)for(n=0;n<f;n++){if(l[n])for(c=0;c<g;c++)b=m[c][n],b<C[c]&&b>t[c]?m[c][n]=Math.floor((b-t[c])/p[c]*z)+k:b>C[c]?m[c][n]=u:b<t[c]&&(m[c][n]=k)}else for(n=0;n<f;n++)for(c=0;c<g;c++)b=
m[c][n],b<C[c]&&b>t[c]?m[c][n]=Math.floor((b-t[c])/p[c]*z)+k:b>C[c]?m[c][n]=u:b<t[c]&&(m[c][n]=k);e.pixelBlock.pixelType="U8";return e}},_computeGammaValues:function(e){var f=this._statistics.length,m,l=[],g;for(m=0;m<f;m++)g=this._statistics[m][2],"U8"!==e&&(g=255*(g-this._statistics[m][0])/(this._statistics[m][1]-this._statistics[m][0])),l.push(this._computeGammaValue(g));return l},_computeGammaValue:function(e){if(0!==e&&!(255<e||0>e)){var f=0;0<e&&150!=e&&255>e&&(f=150>=e?45*Math.cos(.01047*e):
17*Math.sin(.021*e));f=Math.log((e+f)/255);if(0!==f&&(e=Math.log(e/255)/f,!isNaN(e)))return Math.min(9.9,Math.max(.01,e))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C){t=t([b],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(a,d){d=d||{};d.mode&&d.mode!==b.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=b.MODE_STREAM,this._mode=new h(this));this.purgeOptions=new C(this,d.purgeOptions||{});this.purgeInterval=d.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=e.hitch(this,this._attemptReconnect);this._purge=e.hitch(this,this._purge);this._processServiceJson=e.hitch(this,this._processServiceJson);if(e.isObject(a)&&a.layerDefinition)this._initFeatureLayer(a,d);else{var f=this;c({url:a,content:e.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){f._processServiceJson(a,d)},function(a){f._errorHandler(a)})}},_processServiceJson:function(a,
b){var d=this;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField?(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=a.relatedFeatures.joinField,c({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(c){c=c.fields||[];var h=k.map(a.fields,function(a){return a.name.toLowerCase()});k.forEach(c,function(b){-1===k.indexOf(h,b.name.toLowerCase())&&a.fields.push(b)});b.resourceInfo=a;d._initFeatureLayer(d._url,b)},
function(a){d.onError({error:a})})):(b.resourceInfo=a,this._initFeatureLayer(this._url,b))},_initLayer:function(a,b){this.inherited(arguments);if(a){var c;if(a.layerDefinition)this.purgeOptions=new C(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var d=this._getWebsocketConnectionInfo(a),h=d.urls;h&&h.length?(this._socketUrls=h,this.socketUrl=h[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=d.token,h.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=h.length)):(this.socketUrl=void 0,d="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(d+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(d)))}if(this._params.filter)try{this._filter=
c=this._makeFilter(this._params.filter)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){c=c||{};c.geometry=this._params.geometryDefinition;c.outFields=this._outFields;c.where=this._defnExpr;try{this._filter=c=this._makeFilter(c)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_isWebGLCompatible:function(){return!1},_setMap:function(b){var c=this.inherited(arguments),d=this._getRenderer();this.timeInfo&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer))&&(this._trackManager=new a(this),this._trackManager.initialize(b));this.socketUrl&&!this._connected&&this._map&&this.connect();return c},_unsetMap:function(a,
b){k.forEach(this._connects,f.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&
this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(A){}this.inherited(arguments);this._trackManager&&this._trackManager.createTracklineContainer()},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},
onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var b=new r,c={},d=this._filter,h,e,f=this.socketUrl,g;try{this._connected||this._connecting?b.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&
(c.token=this._websocketToken);this._map&&this._map.spatialReference&&this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(c.outSR=this._map.spatialReference.wkid);if(d)for(e in d)null!==d[e]&&(h="geometry"===e?JSON.stringify(d[e]):d[e],c[e]=h);f+="?"+l.objectToQuery(c);g=this._createConnection(f,a);b.resolve(g)}.bind(this)).otherwise(function(a){b.reject(a)}))}catch(L){a&&(a(L,!1),b.reject(L)),this.onConnectionError({error:L})}return b.promise},disconnect:function(a){var b=
this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",c=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:c,message:b});a&&a(null,!0)},setFilter:function(a){var b,c;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;
try{if(void 0!==a.outFields)return c=Error("Outfields property cannot be changed after layer is created"),this.onFilterChange({filter:this.getFilter(),error:c}),!1;b=this._makeFilter(a)}catch(F){return c=Error(F),this.onFilterChange({filter:this.getFilter(),error:c}),!1}if(this.socket)a={filter:b},this.socket.send(JSON.stringify(a));else g.once(this,"connect",function(a){this.setFilter(b)});return!0},getFilter:function(){var a=this._filter,b={},c=["geometry","outFields","where"];a&&k.forEach(c,function(c){var d=
a[c];d&&("geometry"===c?d=u.fromJson(d):"outFields"===c&&(d=d.split(",")),b[c]=d)});return b},setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var b,c={},d=[];b=this._getField(a,!0);if(!b)return d;a=b.name;k.forEach(this.graphics||[],function(b){b=(b.attributes||{})[a];void 0===b||c[b]||(c[b]=1,d.push(b))});d.sort(function(a,b){return a<b?-1:a>b?1:0});return d},getLatestObservations:function(){var a=
[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var b=this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(b!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&this.purgeInterval){var b=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){b.updating||b.suspended||(b._mode._flushDrawBuffer(),b._togglePurgeT(!0))},
6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._purgeT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(a,b){var c=this,d=new WebSocket(a);d.onopen=function(){c.socket=d;c._connected=!0;c._connecting=!1;c._reconnecting=!1;c._reconnectAttempts=0;c._bind();c.onConnect();b&&b(null,!0)};d.onclose=
function(a){var b,d=!0,h=c._connected,e=null;if(c._connected||c._reconnecting){if(a.code)if(b="Connection failed: ",1001===a.code)b+=a.reason||"Service is going away.",d=!1;else if(4400===a.code)b+=a.reason||"Invalid url parameters. Check filter properties.",d=!1;else if(4404===a.code)b+="Service not found",d=!1;else if(4401===a.code||4403===a.code)b+="Not authorized",d=!1;d&&(c._reconnectAttempts+=1,c._reconnectAttempts>c.maxReconnectAttempts&&(b="Maximum reconnect attempts exceeded",d=!1,h=!0));
c._connected=!1;h&&(b&&(e=Error(b)),c.onDisconnect({error:e,willReconnect:d}));d?c._attemptReconnect():c.socket=null}else c.socket||(e=Error("Could not make connection to service"),c.onConnectionError({error:e})),c.socket=null,c._connected=!1};d.onerror=function(a){console.log("Socket error")};return d},_getKeepLatestFeatures:function(){var a=new r;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._keepLatestUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._keepLatestQueried=
!0}.bind(this)):a.resolve();return a.promise},_getRelatedFeatures:function(){var a=new r;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._relatedUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._relatedQueried=!0}.bind(this)):a.resolve();return a.promise},_purge:function(){var a,b=[],c;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=0;a<this.graphics.length-
this.purgeOptions.displayCount;a++)c=this.graphics[a],b.push(c);0<b.length&&(this._mode._removeFeatures(b),this._trackManager&&this._trackManager.removeFeatures(b))},_bind:function(){var a=this;this.socket.onmessage=function(b){a._onMessage(JSON.parse(b.data))}},_onMessage:function(a){var b=this;this.onMessage(a);var c={create:function(a){b._create(a)},update:function(a){b._update(a)},"delete":function(a){b._delete(a)}};if(a.type)c[a.type](a.feature);else a.hasOwnProperty("filter")?b._handleFilterMessage(a):
this._create(a)},_create:function(a){function b(a){if(!c._featureHasOID(a,d)){if(!a.geometry)return!1;a.attributes=a.attributes||{};a.attributes[d]=c._nextId++}a=a.declaredClass?a:new n(a);c._mode.drawFeature(a)}var c=this,d=c.objectIdField;a.length?a.forEach(function(a){a&&b(a)}):a&&b(a)},_delete:function(a){var b=this,c=a[b.objectIdField]||a.attributes[b.objectIdField],d=!1;this.graphics.forEach(function(a){a.attributes[b.objectIdField]==c&&(d=a)});d&&this.remove(d)},_update:function(a){var b=this,
c=!1;this.graphics.forEach(function(d){d.attributes[b.objectIdField]==a.attributes[b.objectIdField]&&(c=d)});c&&(a.attributes&&c.setAttributes(a.attributes),a.geometry&&c.setGeometry(u.fromJson(a.geometry)))},_makeFilter:function(a){var b,c=null;a=a||{};if(void 0!==a.geometry)if(c=c||{},null===a.geometry)c.geometry=null;else{b="string"===typeof a.geometry?u.fromJson(JSON.parse(a.geometry)):a.geometry.declaredClass?a.geometry:u.fromJson(a.geometry);if(!b||"point"===b.type)throw"Query object contains invalid geometry";
"extent"!==b.type&&(b=b.getExtent());if(!b||0===b.getHeight()&&0===b.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";c.spatialRel="esriSpatialRelIntersects";c.geometryType="esriGeometryEnvelope";c.geometry=b.toJson()}void 0!==a.where&&(c=c||{},c.where=a.where);if(void 0!==a.outFields&&(c=c||{},a="string"===typeof a.outFields?"*"===a.outFields?null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&
0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");c.outFields=a.fields?a.fields.join(","):null}return c},_makeOutFields:function(a){var b=this,c=[],d=[],h={fields:null};if(!a||0===a.length)return h;k.forEach(a,function(a){if("*"===a)return h;var e=b._getField(a,!0);e?c.push(e.name):d.push("Field named "+a+" not found in schema.")});a=b._getOutFields();k.forEach(a,function(a){b._getField(a)&&-1===k.indexOf(c,a)&&c.push(a)});h.fields=c;h.errors=d;return h},_handleFilterMessage:function(a){a.error?
(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var b={urls:[]},c,d=[],h=[],e,f,g;a.streamUrls&&k.forEach(a.streamUrls,function(a){"ws"===a.transport&&(c=a.urls,b.token=a.token)});if(!c)return b;k.forEach(c,function(a){0===a.lastIndexOf("wss",0)?h.push(a):d.push(a)});a="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?h:0===d.length?h:d;if(1<a.length)for(e=0;e<a.length-1;e++)f=e+Math.floor(Math.random()*(a.length-e)),g=a[f],a[f]=a[e],a[e]=g;b.urls=a;return b},_attemptReconnect:function(){var a=this,b;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>
a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;b=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});a.connect()},1E3*a._reconnectAttempts+b)},_getServiceConnectionMetadata:function(a){var b=this,d=b._url.path;a="function"===typeof a?a:
null;c({url:d,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(c){c=b._getWebsocketConnectionInfo(c);b._websocketToken=c.token;a&&a()},function(a){b.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,b=new q([5,112,176,.8]),c=new q([255,255,255]),c=new x(x.STYLE_SOLID,c,1),d;if("esriGeometryPoint"===a||"esriGeometryMultipoint"===a)d=new z(z.STYLE_CIRCLE,10,c,b);else if("esriGeometryPolyline"===a)d=new x(x.STYLE_SOLID,b,2);else if("esriGeometryPolygon"===
a||"esriGeometryEnvelope"===a)b=new q([5,112,176,.2]),c=new q([5,112,176,.8]),c=new x(x.STYLE_SOLID,c,1),d=new v(v.STYLE_SOLID,c,b);d&&this.setRenderer(new E(d))},_makeObjectIdField:function(){var a=1,b,c,d=[];if(!this.objectIdField){b=this.fields.length;for(c=0;c<b;c++)d.push(this.fields[c].name.toLowerCase());for(;-1!==k.indexOf(d,"objectid_"+a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,
b){return a.attributes&&(a.attributes[b]||0===a.attributes[b])},_randomIntFromInterval:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}});m("extend-esri")&&e.setObject("layers.StreamLayer",t,d);return t})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Point ../geometry/Polyline ./TrackManager".split(" "),function(t,f,k,q,e,r,m,l,g){t=t([g],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(e){this.inherited(arguments);
var d=e.getMap().spatialReference;this.isWebMercator=d.isWebMercator();this.canWrap=d._isWrappable();this.wrapThreshold=this.isWebMercator?2.0037508342788905E7:180},initialize:function(e){this.inherited(arguments)},addFeatures:function(e,d){function c(b,c){var d,h,e;f[b]||(f[b]=[]);b=f[b];0<a&&(c.length>a&&c.splice(0,c.length-a),h=c.length+b.length,h>a&&(d=b.splice(0,h-a)));h=c.length;for(e=0;e<h;e+=1)b.push(c[e]);return{deletes:d,adds:c}}var f,b,h,a,g={},p={},l;if(d)return this.inherited(arguments),
g;f=this.trackMap;b=this.layer;h=b._trackIdField;a=b.maximumTrackPoints||0;k.forEach(e,function(a){var b=a.attributes[h];a.visible&&(p[b]||(p[b]=[]),p[b].push(a))});for(l in p)p.hasOwnProperty(l)&&(b=c(l,p[l]),g[l]=b);return g},removeFeatures:function(e){var d=[],c=this.layer.objectIdField,f=this.layer._trackIdField;e&&(k.forEach(e,function(b){var h,a,e,g;a=b.attributes[f];h=b.attributes[c];if(e=this.trackMap[a])for(b=0;b<e.length;b+=1)if(g=e[b],g.attributes[c]===h){this.trackMap[a].splice(b,1);-1===
k.indexOf(a)&&d.push(a);break}},this),0<e.length&&this.refreshTracks(d))},drawTracks:function(e){function d(d){var e=b[d],g=e&&1<e.length,n=c.trackLineMap[d];n&&!g&&(f.remove(n),delete c.trackLineMap[d],n=null);if(!g)return!1;for(var u,g=[],p=[],k,q=e.length,v=0;v<q;v++)if(k=e[v].geometry){k=k.normalize();var t=k.x,G=0,H=!1;u&&c.canWrap&&(G=t-u.x,Math.abs(G)>c.wrapThreshold&&(H=!0));H?(p.push([c.getWrappedX(t),k.y]),g.push(p.slice(0)),p=[[t,k.y]]):p.push([t,k.y]);u=new m(t,k.y,h)}1<p.length&&g.push(p);
e={};e[a]=d;if(g.length)if(n){for(var M=n.geometry;M.paths.length;)M.removePath(M.paths.length-1);g.forEach(function(a){M.addPath(a)});n.setGeometry(M)}else n=new r(new l({paths:g,spatialReference:h}),null,e),f.add(n),c.trackLineMap[d]=n}var c=this,f=this.container,b,h,a,g;if(f)if(b=this.trackMap,h=this.map.spatialReference,a=this.layer._trackIdField,e)k.forEach(e,function(a){d(a)});else for(g in b)b.hasOwnProperty(g)&&d(g)},refreshTracks:function(e){function d(b){var a,d;b=c[b]||[];a=b.length;for(d=
0;d<a;d++)f._repaint(b[d],null,!0)}var c=this.trackMap,f=this.layer,b;this.drawTracks(e);if(e)k.forEach(e,function(b){d(b)});else for(b in c)c.hasOwnProperty(b)&&d(b)},getLatestObservations:function(){var e,d,c=this.trackMap,f=[];for(e in c)c.hasOwnProperty(e)&&(d=c[e],f.push(d[d.length-1]));return f},destroy:function(){this.inherited(arguments);this.trackLineMap=null},getWrappedX:function(e){var d=this.isWebMercator,c=d?2.0037508342788905E7:180,d=d?-2.0037508342788905E7:-180;return(0<e?d:c)-((0<
e?c:d)-e)}});q("extend-esri")&&f.setObject("layers._StreamTrackManager",t,e);return t})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(t,f,k,q,e){t=t([k],{declaredClass:"esri.layers.PurgeOptions",constructor:function(e,f){this.parent=e;for(var l in f)this[l]=f[l]},_displayCountSetter:function(e){this.displayCount=e;this.parent.refresh()}});q("extend-esri")&&f.setObject("layers.PurgeOptions",t,e);return t})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),
function(t,f,k,q,e,r,m){t=t([r,m],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(e,f){this._initialize(e,f);this.useMapImage=f&&f.useMapImage||!1},refresh:function(e){if(e)this.inherited(arguments);else{var f=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=f}},setRenderer:function(e,f){this.renderer=e;this.onRendererChange();f||this.refresh(!0)},exportMapImage:function(l,g){var p=e.defaults.map;l=f.mixin({size:p.width+
","+p.height},this._params,l?l.toJson(this.normalization):{},{f:"json"});delete l._ts;this._exportMapImage(this._url.path+"/exportImage",l,g)}});k("extend-esri")&&f.setObject("layers.ArcGISImageServiceLayer",t,q);return t})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){t=t([l,g],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(b,a){this.symbolTileSize=a&&a.symbolTileSize?a.symbolTileSize:50;this._maxMag=this._minMag=null;var c=f.clone(this._params);delete c.imageServiceParameters;delete c.pixelFilter;delete c.rendererStyle;delete c.symbolTileSize;this._initialize(b,a);this.renderer||this.setVectorRendererStyle(a&&a.rendererStyle?a.rendererStyle:p.STYLE_SINGLE_ARROW);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";f.mixin(this._params,c)},getField:function(b){return this._getField(b,!0)},setVectorRendererStyle:function(b){this.rendererStyle=b;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},
_refresh:function(b){if(10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(this._map){this.setImageFormat("LERC",!0);b=this.fullExtent&&this.fullExtent.xmin;var a=this.fullExtent&&this.fullExtent.ymax,c=f.clone(this._map.extent),d=1/this.symbolTileSize*this._map.width,d=d?Math.ceil(d):50,h=1/this.symbolTileSize*this._map.height,h=h?Math.ceil(h):Math.ceil((c.ymax-c.ymin)/(c.xmax-c.xmin)*d),g=(c.xmax-c.xmin)/d,n=(c.ymax-c.ymin)/h;c.xmin=
b+Math.floor((c.xmin-b)/g)*g;c.xmax=b+Math.ceil((c.xmax-b)/g)*g;c.ymin=a+Math.floor((c.ymin-a)/n)*n;c.ymax=a+Math.ceil((c.ymax-a)/n)*n;this._requestData(c,d,h)}},_drawPixelData:function(){this.clear();if(this.pixelData){var e=this.pixelData.pixelBlock,a=this.pixelData.extent,f=this.pixelData.locations,g=m.isDefined(e.mask)&&0<e.mask.length;if(e&&a&&f){if(this.useDefaultRenderer&&this.renderer&&(!m.isDefined(this._minMag)||!m.isDefined(this._maxMag))){var p=this._getServiceMinMaxStats();p?(this._minMag=
p.min,this._maxMag=p.max):(this._minMag=e.statistics[0].minValue,this._maxMag=e.statistics[0].maxValue);var p={type:"sizeInfo",minSize:b.px2pt(.2*this.symbolTileSize),maxSize:b.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},l=[];l.push(p);l.push({type:"colorInfo"});this.renderer.setVisualVariables(l)}for(var r=l=p=0,k,t=a.spatialReference?a.spatialReference._getInfo():null,p=0;p<e.height;p++)for(l=0;l<e.width;l++,r++)if(k=f[r],(!g||e.mask[r])&&k&&2===k.length){k=
new d(k[0],k[1],a.spatialReference);t&&(k.x=c.prototype._normalizeX(k.x,t).x);var w={Magnitude:e.pixels[0][r],Direction:e.pixels[1][r],Location:q.toJson(k.toJson())};k=new n(k,null,w);this.add(k)}}}},_getServiceMinMaxStats:function(){if(!m.isDefined(this.minValues)||!m.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var b=this.minValues[0],a=this.maxValues[0],c=this.minValues[1],d=this.maxValues[1];if(this.pixelFilter&&b&&a&&c&&d){var e=[];e.push([b,a]);e.push([c,
d]);c=this._createPixelData(e);this.pixelFilter(c);c&&c.pixelBlock&&c.pixelBlock.pixels&&0<c.pixelBlock.pixels.length&&(b=c.pixelBlock.pixels[0][0],a=c.pixelBlock.pixels[0][1])}return b&&a?{min:b,max:a}:null},_updateVectorFieldRenderer:function(){var c={type:"sizeInfo",minSize:b.px2pt(.2*this.symbolTileSize),maxSize:b.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},a=[];a.push(c);c=new p({style:this.rendererStyle,visualVariables:a,flowRepresentation:this._vectorFlowRepresentation});
this.setRenderer(c)},_getField:function(b,a){if(m.isDefined(b))return a&&(b=b.toLowerCase()),"magnitude"!==b&&"direction"!==b?null:{name:b,alias:b,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(b){"CancelError"!==b.name&&(this.clear(),this.onError(b))},_setFlowRepresentation:function(b){this.renderer&&this.renderer.flowRepresentation?this._vectorFlowRepresentation=this.renderer.flowRepresentation:b&&this.renderer&&m.isDefined(b.FlowDirection)&&b.FlowDirection&&
(this._vectorFlowRepresentation="oceanographic"===b.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}});e("extend-esri")&&f.setObject("layers.ArcGISImageServiceVectorLayer",t,r);return t})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(t,f){return t(f,{constructor:function(f,q){this.isTiled=!0},_initVisible:function(){},
_setTopLayerVisible:function(f){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(f){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault ./LayerObjectFacory esri/dijit/PopupTemplate".split(" "),function(t,f,k,q,e,r,m,l){return t(r,{_layerObjectFacory:null,
constructor:function(){this.newSubLayers=[];this.isTable=!0;this._layerObjectFacory=new m(this)},init:function(){},_getLayerObject:function(){var e=new q;this._layerObjectFacory.getLayerObject().then(f.hitch(this,function(f){this.layerObject.empty&&f&&(this.layerObject=f,this._bindEventAfterLayerObjectLoaded());e.resolve(f)}));return e},getLayerObject:function(){return this._getLayerObject()},getPopupInfoFromLayerObject:function(){var e=this.getPopupInfo();e||!this.layerObject||this.layerObject.empty||
(e=this._getDefaultPopupInfo(this.layerObject));return e},loadPopupInfo:function(){var e=new q,p=this.getPopupInfo();p?e.resolve(p):this.getLayerObject().then(f.hitch(this,function(){p=this._getDefaultPopupInfo(this.layerObject);e.resolve(p)}));return e},getLayerType:function(){var e=new q;e.resolve("Table");return e},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return k.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);
this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new l(this.originOperLayer.popupInfo):null}},_bindEventAfterLayerObjectLoaded:function(){var g=e.after(this.layerObject,"setDefinitionExpression",f.hitch(this,this._onFilterChanged));this._eventHandles.push(g)},getFilter:function(){var e;this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?(e=this.layerObject.getDefinitionExpression(),void 0===e&&(e=this.getFilterOfWebmap())):
e=this.getFilterOfWebmap();return e}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault".split(" "),function(t,f,k,q,e,r,m,l,g){return t(g,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&
"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(e){10.2<=this.layerObject.version?this._legendRequestServer().then(q.hitch(this,function(d){f.empty(e);k.forEach(d.layers,function(c){k.forEach(c.legend,function(c){if("\x3call other values\x3e"!==c.label){var b=f.create("div",{"class":"legend-div"},e),d=f.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},
b),a=null,a=c.imageData?"data:"+c.contentType+";base64,"+c.imageData:c.url;f.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:a},d);f.create("div",{"class":"legend-label jimu-float-leading",innerHTML:c.label||" "},b)}},this)},this)}),q.hitch(this,function(){f.empty(e)})):f.empty(e)},_legendRequestServer:function(){var e=this.layerObject.url+"/legend",d={f:"json"};this.layerObject._params.bandIds&&(d.bandIds=this.layerObject._params.bandIds);
this.layerObject._params.renderingRule&&(d.renderingRule=this.layerObject._params.renderingRule);return l({url:e,content:d,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var f=new e,d={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},c=this.getLayerType(),g=this.getLayerObject();r({type:c,layerObject:g}).then(q.hitch(this,function(b){var c=b.type;b=b.layerObject;d.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&(d.isSupportedLayer=!0);b.capabilities&&
0<=b.capabilities.indexOf("Catalog")?d.isSupportQuery=!0:d.isSupportedLayer=!1;f.resolve(d)}),function(){f.resolve(d)});return f},_getServiceDefinition:function(){var e=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(e)},_bindEvent:function(){var e;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(e=m.after(this.layerObject,"setRenderingRule",q.hitch(this,this._onRendererChanged)),this._eventHandles.push(e))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(t,f,k,q,e){return t(e,{getSupportTableInfo:function(){var e=new k,m={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},l=this.getLayerType(),g=this.getLayerObject();q({type:l,layerObject:g}).then(f.hitch(this,function(f){var d=f.type;f=f.layerObject;m.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(m.isSupportedLayer=!0);(d=f.getLatestObservations())&&0<d.length&&
(m.otherReasonCanNotSupport=!1);e.resolve(m)}),function(){e.resolve(m)});return e}})})},"jimu/LayerInfos/LayerInfoForDefaultKML":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-construct","./LayerInfoForDefault"],function(t,f,k,q){return t(q,{constructor:function(e,f){this.layerObject=e.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var e=this.originOperLayer.kml,f=e.layerInfo.originOperLayer.visibleFolders;e.layerInfo.isRootLayer()&&f?-1<f.indexOf(this.subId)?
this._visible=!0:this._visible=!1:this._visible=this.originOperLayer.kml.currentFolder.visible},_setTopLayerVisible:function(e){var f=this.originOperLayer.kml.currentFolder;this._visible=e;this.originOperLayer.kml.layerInfo.layerObject.setFolderVisibility(f,e)},obtainNewSubLayers:function(){var e=[],k=this.originOperLayer.kml;k.currentFolder&&f.forEach(k.layerInfo._getOperLayerByParentFolderId(k.currentFolder.id,this),function(f){f=this._layerInfoFactory.create(f);e.push(f);f.init()},this);return e},
getOpacity:function(){},setOpacity:function(e){},drawLegends:function(e){k.empty(e)},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.getRootLayerInfo().getScaleRange()}})})},"libs/crc":function(){(function(){var t="object"===typeof window?window:{};!t.JS_CRC_NO_NODE_JS&&"object"===typeof process&&process.versions&&process.versions.node&&(t=global);var f=!t.JS_CRC_NO_COMMON_JS&&"object"===typeof module&&module.exports,k="function"===typeof define&&
define.amd,q=!t.JS_CRC_NO_ARRAY_BUFFER&&"undefined"!==typeof ArrayBuffer,e="0123456789abcdef".split(""),r=[{name:"crc32",polynom:3988292384,initValue:-1,bytes:4},{name:"crc16",polynom:40961,initValue:0,bytes:2},{name:"crc24",polynom:720895,initValue:1,bytes:3}],m,l,g,p;for(m=0;m<r.length;++m){var d=r[m];d.method=function(c){return function(b){var d=b,a="string"!==typeof d;a&&q&&d instanceof ArrayBuffer&&(d=new Uint8Array(d));b=c.initValue;var f,g=d.length,n=c.table;if(a)for(f=0;f<g;++f)b=n[(b^d[f])&
255]^b>>>8;else for(f=0;f<g;++f)a=d.charCodeAt(f),128>a?b=n[(b^a)&255]^b>>>8:(2048>a?b=n[(b^(192|a>>6))&255]^b>>>8:(55296>a||57344<=a?b=n[(b^(224|a>>12))&255]^b>>>8:(a=65536+((a&1023)<<10|d.charCodeAt(++f)&1023),b=n[(b^(240|a>>18))&255]^b>>>8,b=n[(b^(128|a>>12&63))&255]^b>>>8),b=n[(b^(128|a>>6&63))&255]^b>>>8),b=n[(b^(128|a&63))&255]^b>>>8);b^=c.initValue;d="";3<c.bytes?d+=e[b>>28&15]+e[b>>24&15]+e[b>>20&15]+e[b>>16&15]:2<c.bytes&&(d+=e[b>>20&15]+e[b>>16&15]);return d+=e[b>>12&15]+e[b>>8&15]+e[b>>
4&15]+e[b&15]}}(d);d.table=[];for(l=0;256>l;++l){p=l;for(g=0;8>g;++g)p=p&1?d.polynom^p>>>1:p>>>1;d.table[l]=p>>>0}}var c={};for(m=0;m<r.length;++m)d=r[m],c[d.name]=d.method;if(f)module.exports=c;else{for(m=0;m<r.length;++m)d=r[m],t[d.name]=d.method;k&&define(function(){return c})}})()},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale dojo/number esri/lang dojo/data/ItemFileWriteStore jimu/utils moment/moment".split(" "),function(t,f,k,q,e,
r,m,l,g){var p=t([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:864E5,HourInMS:36E5,MinuteInMS:6E4,SecInMS:1E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(d){return 0===this.indexOf(d)};String.prototype.endsWith=function(d){return this.substring(this.length-d.length)===
d};String.prototype.count=function(d){return this.split(d).length-1};String.prototype.trim||(String.prototype.trim=f.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",
stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsAnyOf:"stringOperatorIsAnyOf",stringOperatorIsNoneOf:"stringOperatorIsNoneOf",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",
numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsAnyOf:"numberOperatorIsAnyOf",numberOperatorIsNoneOf:"numberOperatorIsNoneOf",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",
dateOperatorIsOnOrBefore:"dateOperatorIsOnOrBefore",dateOperatorIsOnOrAfter:"dateOperatorIsOnOrAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",dateOperatorIsIn:"dateOperatorIsIn",dateOperatorIsNotIn:"dateOperatorIsNotIn",dateOperatorMinutes:"dateOperatorMinutes",
dateOperatorHours:"dateOperatorHours",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorYears:"dateOperatorYears"},prepare:function(d,c){this.isHosted=l.isHostedService(d);c=c||[];this.setFieldsStoreByFieldInfos(c)},isPartsObjHasError:function(d){var c=!1;d&&(c=d.parts&&0<=d.parts.length?k.every(d.parts,f.hitch(this,function(c){return c.parts?0<c.parts.length?k.every(c.parts,f.hitch(this,function(b){return!b.error})):!1:!c.error})):
!1);return!c},isAskForValues:function(d){return p.isAskForValues(d)},hasVirtualDate:function(d){return p.hasVirtualDate(d)},setFieldsStoreByFieldInfos:function(d){d=k.filter(d,f.hitch(this,function(c){return 0<=this._supportFieldTypes.indexOf(c.type)}));d=k.map(d,function(c,d){var b;switch(c.type){case "esriFieldTypeString":b="string";break;case "esriFieldTypeDate":b="date";break;default:b="number"}return{id:d,label:c.name,shortType:b,alias:c.alias,editable:c.editable,name:c.name,nullable:c.nullable,
type:c.type}},this);this.fieldsStore=new m({data:{identifier:"id",label:"label",items:d}});return d.length},_validatePartsObj:function(d){return d&&"object"===typeof d},_isObject:function(d){return d&&"object"===typeof d},_isString:function(d){return d&&"string"===typeof d},containsNonLatinCharacter:function(d){for(var c=0;c<d.length;c++)if(255<d.charCodeAt(c))return!0;return!1},getExprByFilterObj:function(d){if(!k.every(d.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(d))return d.expr=
"",d.displaySQL="",d.expr;this._handleVirtualDate(d);var c="",e="",b,h;if(0===d.parts.length)e=c="1\x3d1";else if(1===d.parts.length)b=d.parts[0],b.valueObj&&f.isArray(b.valueObj.value)&&"multiple"!==b.valueObj.type?(h=this._checkIfValObjArrayAndChecked(b.valueObj.value))?(c=this.builtFilterString(b),e=b.displaySQL):e=c="1\x3d1":(c=this.builtFilterString(b),e=b.displaySQL);else for(var a="",g=0;g<d.parts.length;g++){b=d.parts[g];b.valueObj&&f.isArray(b.valueObj.value)&&"multiple"!==b.valueObj.type?
(h=this._checkIfValObjArrayAndChecked(b.valueObj.value))?(h=this.builtFilterString(b),b=b.displaySQL):b=h="1\x3d1":(h=this.builtFilterString(b),b=b.displaySQL);if(!r.isDefined(h))return null;c+=a+"("+h+")";e+=a+"("+b+")";a=a||" "+d.logicalOperator+" "}d.expr=c;d.displaySQL=e;return c},_checkIfValObjArrayAndChecked:function(d){var c=!1,e;for(e in d)if(d[e].isChecked){c=!0;break}return c},_handleVirtualDate:function(d){this.hasVirtualDate(d)&&k.forEach(d.parts,f.hitch(this,function(c){c.parts?k.forEach(c.parts,
f.hitch(this,function(c){this._updateRealDateByVirtualDate(c)})):this._updateRealDateByVirtualDate(c)}))},_updateRealDateByVirtualDate:function(d){var c;c=[this.OPERATORS.dateOperatorIsOn,this.OPERATORS.dateOperatorIsNotOn,this.OPERATORS.dateOperatorIsBefore,this.OPERATORS.dateOperatorIsAfter,this.OPERATORS.dateOperatorIsOnOrBefore,this.OPERATORS.dateOperatorIsOnOrAfter];d.valueObj.virtualDate?d.operator===this.OPERATORS.dateOperatorIsIn||d.operator===this.OPERATORS.dateOperatorIsNotIn?(c=p.getRealDateByVirtualDate(d.valueObj.virtualDate),
d.value1=c[0],d.value2=c[1]):-1<c.indexOf(d.operator)&&(c=p.getRealDateByVirtualDate(d.valueObj.virtualDate),d.value=c):(d.valueObj.virtualDate1&&(c=p.getRealDateByVirtualDate(d.valueObj.virtualDate1),d.value1=c),d.valueObj.virtualDate2&&(c=p.getRealDateByVirtualDate(d.valueObj.virtualDate2),d.value2=c))},isPartsObjReadyToBuild:function(d){return k.every(d.parts,f.hitch(this,function(c){return c.parts?k.every(c.parts,f.hitch(this,function(c){return this._isPartReadyToBuild(c)})):this._isPartReadyToBuild(c)}))},
_isPartReadyToBuild:function(d){var c=d.fieldObj.shortType,e=d.operator,b=d.valueObj;d=b.type||"value";var h=b.value,a=b.value1,b=b.value2;if("value"===d){if("string"===c)return e===this.OPERATORS.stringOperatorIsBlank||e===this.OPERATORS.stringOperatorIsNotBlank?!0:l.isNotEmptyString(h);if("number"===c)return e===this.OPERATORS.numberOperatorIsBlank||e===this.OPERATORS.numberOperatorIsNotBlank?!0:e===this.OPERATORS.numberOperatorIsBetween||e===this.OPERATORS.numberOperatorIsNotBetween?l.isValidNumber(a)&&
l.isValidNumber(b):l.isValidNumber(h);if("date"===c)return e===this.OPERATORS.dateOperatorIsBlank||e===this.OPERATORS.dateOperatorIsNotBlank?!0:e===this.OPERATORS.dateOperatorIsBetween||e===this.OPERATORS.dateOperatorIsNotBetween||e===this.OPERATORS.dateOperatorIsIn||e===this.OPERATORS.dateOperatorIsNotIn?l.isNotEmptyString(a)&&l.isNotEmptyString(b):e===this.OPERATORS.dateOperatorInTheLast||e===this.OPERATORS.dateOperatorNotInTheLast?void 0!==h&&null!==h:l.isNotEmptyString(h)}else{if("field"===d)return l.isNotEmptyString(h);
if("unique"===d){if("string"===c)return l.isNotEmptyString(h);if("number"===c)return l.isValidNumber(h);if("date"===c)return l.isValidDate(h)}else if("multiple"===d){if("string"===c)return l.isNotEmptyStringArray(h);if("number"===c)return l.isValidNumberArray(h)}else if("values"!==d&&("uniquePredefined"===d||"multiplePredefined"===d)){if("string"===c)return l.isNotEmptyStringArray(h);if("number"===c)return l.isValidNumberArray(h)}}return!1},builtFilterString:function(d){var c="",e="";if(d.parts)for(var b=
"",h=0;h<d.parts.length;h++){var a=d.parts[h],f=this.builtSingleFilterString(a);a.expr=f.whereClause;if(!r.isDefined(f.whereClause))return null;c+=b+f.whereClause;e+=b+a.displaySQL;b=" "+d.logicalOperator+" "}else d&&d.valueObj&&"multiple"===d.valueObj.type&&0===d.valueObj.value.length?c=e="1\x3d1":(c=this.builtSingleFilterString(d).whereClause,e=d.displaySQL);d.expr=c;d.displaySQL=e;return c},_preBuiltSingleFilterString:function(d){if("string"===d.fieldObj.shortType&&"\x3cNull\x3e"===d.valueObj.value){if(d.operator===
this.OPERATORS.stringOperatorIs)return{whereClause:d.fieldObj.name+" IS NULL"};if(d.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:d.fieldObj.name+" IS NOT NULL"}}if("number"===d.fieldObj.shortType&&"\x3cNull\x3e"===d.valueObj.value){if(d.operator===this.OPERATORS.numberOperatorIs)return{whereClause:d.fieldObj.name+" IS NULL"};if(d.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:d.fieldObj.name+" IS NOT NULL"}}return null},_handlePrefixStringsForIn:function(d,c){for(var e=
[],b=0;b<d.length;b++){var h=d[b],h=h.replace(/\'/g,"''"),a=this.isHosted&&this.containsNonLatinCharacter(h)?"N":"",h=c||this.isHosted?h:h.toUpperCase(),h=""+a+"'"+h+"'";e.push(h)}return e.join(",")},builtSingleFilterString:function(d){this.isHosted&&(d.caseSensitive=!1);if(r.isDefined(d.valueObj.isValid)&&!d.valueObj.isValid)return{whereClause:null};var c=this._preBuiltSingleFilterString(d);if(c)return c;var c=d.valueObj.value,e=d.valueObj.value1,b=d.valueObj.value2,h="",a="",g=[];if("string"===
d.fieldObj.shortType){e="";c&&"field"!==d.valueObj.type&&this.isHosted&&!f.isArray(c)&&this.containsNonLatinCharacter(c)&&(e="N");!c||"multiplePredefined"!==d.valueObj.type&&"uniquePredefined"!==d.valueObj.type||(g=[],k.forEach(c,f.hitch(this,function(a){a.isChecked&&g.push(a.value)})),d.operator===this.OPERATORS.stringOperatorIs||d.operator===this.OPERATORS.stringOperatorIsNot?(c=g[0],this.isHosted&&this.containsNonLatinCharacter(c)&&(e="N")):c=g);var p=[];switch(d.operator){case this.OPERATORS.stringOperatorIs:h=
"field"===d.valueObj.type?d.fieldObj.name+" \x3d "+c:d.caseSensitive||this.isHosted?d.fieldObj.name+" \x3d "+e+"'"+c.replace(/\'/g,"''")+"'":"UPPER("+d.fieldObj.name+") \x3d "+e+"'"+c.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorIsNot:h="field"===d.valueObj.type?d.fieldObj.name+" \x3c\x3e "+c:d.caseSensitive||this.isHosted?d.fieldObj.name+" \x3c\x3e "+e+"'"+c.replace(/\'/g,"''")+"'":"UPPER("+d.fieldObj.name+") \x3c\x3e "+e+"'"+c.replace(/\'/g,"''").toUpperCase()+"'";
break;case this.OPERATORS.stringOperatorStartsWith:p=[];"multiplePredefined"===d.valueObj.type||"uniquePredefined"===d.valueObj.type?(k.forEach(c,f.hitch(this,function(a){var b=this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";d.caseSensitive||this.isHosted?p.push(d.fieldObj.name+" LIKE "+b+"'"+a.replace(/\'/g,"''")+"%'"):p.push("UPPER("+d.fieldObj.name+") LIKE "+b+"'"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),h="(("+p.join(") OR (")+"))"):h=d.caseSensitive||this.isHosted?d.fieldObj.name+
" LIKE "+e+"'"+c.replace(/\'/g,"''")+"%'":"UPPER("+d.fieldObj.name+") LIKE "+e+"'"+c.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorEndsWith:p=[];"multiplePredefined"===d.valueObj.type||"uniquePredefined"===d.valueObj.type?(k.forEach(c,f.hitch(this,function(a){var b=this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";d.caseSensitive||this.isHosted?p.push(d.fieldObj.name+" LIKE "+b+"'%"+a.replace(/\'/g,"''")+"'"):p.push("UPPER("+d.fieldObj.name+") LIKE "+b+"'%"+
a.replace(/\'/g,"''").toUpperCase()+"'")})),h="(("+p.join(") OR (")+"))"):h=d.caseSensitive||this.isHosted?d.fieldObj.name+" LIKE "+e+"'%"+c.replace(/\'/g,"''")+"'":"UPPER("+d.fieldObj.name+") LIKE "+e+"'%"+c.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorContains:p=[];"multiplePredefined"===d.valueObj.type||"uniquePredefined"===d.valueObj.type?(k.forEach(c,f.hitch(this,function(a){var b=this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";d.caseSensitive||this.isHosted?
p.push(d.fieldObj.name+" LIKE "+b+"'%"+a.replace(/\'/g,"''")+"%'"):p.push("UPPER("+d.fieldObj.name+") LIKE "+b+"'%"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),h="(("+p.join(") OR (")+"))"):h=d.caseSensitive||this.isHosted?d.fieldObj.name+" LIKE "+e+"'%"+c.replace(/\'/g,"''")+"%'":"UPPER("+d.fieldObj.name+") LIKE "+e+"'%"+c.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorDoesNotContain:p=[];"multiplePredefined"===d.valueObj.type||"uniquePredefined"===d.valueObj.type?
(k.forEach(c,f.hitch(this,function(a){var b=this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";d.caseSensitive||this.isHosted?p.push(d.fieldObj.name+" NOT LIKE "+b+"'%"+a.replace(/\'/g,"''")+"%'"):p.push("UPPER("+d.fieldObj.name+") NOT LIKE "+b+"'%"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),h="(("+p.join(") AND (")+"))"):h=d.caseSensitive||this.isHosted?d.fieldObj.name+" NOT LIKE "+e+"'%"+c.replace(/\'/g,"''")+"%'":"UPPER("+d.fieldObj.name+") NOT LIKE "+e+"'%"+c.replace(/\'/g,"''").toUpperCase()+
"%'";break;case this.OPERATORS.stringOperatorIsAnyOf:c=this._handlePrefixStringsForIn(c,d.caseSensitive);h=d.caseSensitive||this.isHosted?d.fieldObj.name+" IN ("+c+")":"UPPER("+d.fieldObj.name+") IN ("+c+")";break;case this.OPERATORS.stringOperatorIsNoneOf:c=this._handlePrefixStringsForIn(c,d.caseSensitive);h=d.caseSensitive||this.isHosted?d.fieldObj.name+" NOT IN ("+c+")":"UPPER("+d.fieldObj.name+") NOT IN ("+c+")";break;case this.OPERATORS.stringOperatorIsBlank:h=d.fieldObj.name+" IS NULL";break;
case this.OPERATORS.stringOperatorIsNotBlank:h=d.fieldObj.name+" IS NOT NULL"}}else if("number"===d.fieldObj.shortType)switch(!c||"uniquePredefined"!==d.valueObj.type&&"multiplePredefined"!==d.valueObj.type?c&&"multiple"===d.valueObj.type&&(c=c.join(",")):(g=[],k.forEach(c,f.hitch(this,function(a){a.isChecked&&g.push(a.value)})),c=g.join(",")),d.operator){case this.OPERATORS.numberOperatorIs:h=d.fieldObj.name+" \x3d "+c;break;case this.OPERATORS.numberOperatorIsNot:h=d.fieldObj.name+" \x3c\x3e "+
c;break;case this.OPERATORS.numberOperatorIsAtLeast:h=d.fieldObj.name+" \x3e\x3d "+c;break;case this.OPERATORS.numberOperatorIsLessThan:h=d.fieldObj.name+" \x3c "+c;break;case this.OPERATORS.numberOperatorIsAtMost:h=d.fieldObj.name+" \x3c\x3d "+c;break;case this.OPERATORS.numberOperatorIsGreaterThan:h=d.fieldObj.name+" \x3e "+c;break;case this.OPERATORS.numberOperatorIsAnyOf:h=d.fieldObj.name+" IN ("+c+")";break;case this.OPERATORS.numberOperatorIsNoneOf:h=d.fieldObj.name+" NOT IN ("+c+")";break;
case this.OPERATORS.numberOperatorIsBetween:h=d.fieldObj.name+" BETWEEN "+e+" AND "+b;break;case this.OPERATORS.numberOperatorIsNotBetween:h=d.fieldObj.name+" NOT BETWEEN "+e+" AND "+b;break;case this.OPERATORS.numberOperatorIsBlank:h=d.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:h=d.fieldObj.name+" IS NOT NULL"}else{"field"!==d.valueObj.type&&(c&&(c=l.getDateByDateTimeStr(c)),e&&(e=l.getDateByDateTimeStr(e)),b&&(b=l.getDateByDateTimeStr(b)));var a=d.valueObj.enableTime,
m=d.valueObj.timeAccuracy;switch(d.operator){case this.OPERATORS.dateOperatorIsOn:"field"===d.valueObj.type?h=d.fieldObj.name+" \x3d "+c:(h="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(c,d.fieldObj.dateFormat):this._getEndDateByTime(c,a,m),h="("+d.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+h+"') AND ("+d.fieldObj.name+" \x3c\x3e "+(this.isHosted?"":"timestamp ")+"'"+h+"')");break;case this.OPERATORS.dateOperatorIsNotOn:"field"===
d.valueObj.type?h=d.fieldObj.name+" \x3c\x3e "+c:(h="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(c,d.fieldObj.dateFormat):this._getEndDateByTime(c,a,m),h="("+d.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"') OR ("+d.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+h+"')");break;case this.OPERATORS.dateOperatorIsBefore:h="field"===d.valueObj.type?d.fieldObj.name+" \x3c "+c:d.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+
"'";break;case this.OPERATORS.dateOperatorIsAfter:"field"===d.valueObj.type?h=d.fieldObj.name+" \x3e "+c:(h="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(c,d.fieldObj.dateFormat):this._getEndDateByTime(c,a,m),h=d.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+h+"'");break;case this.OPERATORS.dateOperatorIsOnOrBefore:"field"===d.valueObj.type?h=d.fieldObj.name+" \x3c\x3d "+c:(h="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(c,d.fieldObj.dateFormat):this._getEndDateByTime(c,
a,m),h=d.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+h+"'");break;case this.OPERATORS.dateOperatorIsOnOrAfter:h="field"===d.valueObj.type?d.fieldObj.name+" \x3e\x3d "+c:d.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"'";break;case this.OPERATORS.dateOperatorInTheLast:h=d.fieldObj.name+" BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(d.valueObj.value,d.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorNotInTheLast:h=
d.fieldObj.name+" NOT BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(d.valueObj.value,d.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorIsBetween:case this.OPERATORS.dateOperatorIsIn:h=this._getEndDateByTime(b,d.valueObj.enableTime2,d.valueObj.timeAccuracy2);h="("+d.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(e)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+h+"') AND ("+d.fieldObj.name+" \x3c\x3e "+(this.isHosted?"":"timestamp ")+
"'"+h+"')";break;case this.OPERATORS.dateOperatorIsNotBetween:case this.OPERATORS.dateOperatorIsNotIn:h=this._getEndDateByTime(b,d.valueObj.enableTime2,d.valueObj.timeAccuracy2);h="("+d.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(e)+"') OR ("+d.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+h+"')";break;case this.OPERATORS.dateOperatorIsBlank:h=d.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:h=d.fieldObj.name+" IS NOT NULL"}}"date"===
d.fieldObj.shortType?(c=f.clone(d.valueObj),c.dateFormat=d.fieldObj.dateFormat,a=this.getDisplaySQL(d.fieldObj.name,c,d.operator)):a=h;d.displaySQL=a;return{whereClause:h}},_getEndDateByTime:function(d,c,e){d=c?"s"===e?this.addSec(d):"m"===e?this.addMinute(d):this.addHour(d):this.addDay(d);return this.formatDate(d)},_getEndDateByTimeForUnique:function(d,c){d=c&&0<=c.indexOf("ShortTime")?this.addMinute(d):c&&0<=c.indexOf("LongTime")?this.addSec(d):this.addDay(d);return this.formatDate(d)},_dateENUM:{dateOperatorIsOn:"is on ",
dateOperatorIsNotOn:"is not on ",dateOperatorIsOn_At:"is at ",dateOperatorIsNotOn_At:"is not at ",dateOperatorIsIn:"is in ",dateOperatorIsNotIn:"is not in ",dateOperatorIsBefore:"is before ",dateOperatorIsAfter:"is after ",dateOperatorIsOnOrBefore:"is on or before ",dateOperatorIsOnOrAfter:"is on or after ",dateOperatorIsOnOrBefore_At:"is at or before ",dateOperatorIsOnOrAfter_At:"is at or after ",dateOperatorInTheLast:["is in the last "," from CURRENT_TIMESTAMP"],dateOperatorNotInTheLast:["is not in the last ",
" from CURRENT_TIMESTAMP"],dateOperatorIsBetween:["is between "," and "],dateOperatorIsNotBetween:["is not between "," and "],dateOperatorIsBlank:"is blank",dateOperatorIsNotBlank:"is not blank"},_getDisplayDates:function(d){var c={value:d.virtualDate,value1:d.virtualDate1,value2:d.virtualDate2},e=""===d.dateFormat?{}:{format:{dateFormat:d.dateFormat}};if(""===d.virtualDate||void 0===d.virtualDate)c.value="field"===d.type?d.value:"unique"===d.type?l.localizeDateByFieldInfo(l.getDateByDateTimeStr(d.value),
e):l.localizeDateTimeByFieldInfo(l.getDateByDateTimeStr(d.value),e,d.enableTime,d.timeAccuracy);""===d.virtualDate1&&(c.value1=l.localizeDateTimeByFieldInfo(l.getDateByDateTimeStr(d.value1),e,d.enableTime1,d.timeAccuracy1));""===d.virtualDate2&&(c.value2=l.localizeDateTimeByFieldInfo(l.getDateByDateTimeStr(d.value2),e,d.enableTime2,d.timeAccuracy2));return c},getDisplaySQL:function(d,c,e){var b="",b=this._dateENUM[e];if(0<e.indexOf("InTheLast"))b=b[0]+c.value+" "+this._getDateRangeEnum(c.value,c.range)+
b[1];else{var h=this._getDisplayDates(c,e);0<e.indexOf("Between")?b=b[0]+h.value1+b[1]+h.value2:0<e.indexOf("Blank")?b=this._dateENUM[e]:("unique"===c.type&&c.dateFormat&&0<=c.dateFormat.indexOf("Time")&&"dateOperatorIsBefore"!==e&&"dateOperatorIsAfter"!==e&&(e+="_At"),b=this._dateENUM[e]+h.value)}return d+" "+b},_getDateRangeEnum:function(d,c){c={dateOperatorYears:"year",dateOperatorDays:"day",dateOperatorMonths:"month",dateOperatorWeeks:"week",dateOperatorHours:"hour",dateOperatorMinutes:"minute"}[c];
return 1<d?c+"s":c},_convertRangeToDays:function(d,c){var e=d;c===this.OPERATORS.dateOperatorYears?e=365*d:c===this.OPERATORS.dateOperatorMonths?e=30*d:c===this.OPERATORS.dateOperatorWeeks?e=7*d:c===this.OPERATORS.dateOperatorHours?e=d/24:c===this.OPERATORS.dateOperatorMinutes&&(e=d/1440);return e=Math.round(1E6*e)/1E6},formatDate:function(d){d=new Date(d);return""+d.getUTCFullYear()+"-"+e.format(d.getUTCMonth()+1,{pattern:"00"})+"-"+e.format(d.getUTCDate(),{pattern:"00"})+" "+e.format(d.getUTCHours(),
{pattern:"00"})+":"+e.format(d.getUTCMinutes(),{pattern:"00"})+":"+e.format(d.getUTCSeconds(),{pattern:"00"})},addDay:function(d){return new Date(d.getTime()+this.dayInMS)},addHour:function(d){return new Date(d.getTime()+this.HourInMS)},addMinute:function(d){return new Date(d.getTime()+this.MinuteInMS)},addSec:function(d){return new Date(d.getTime()+this.SecInMS)},getFilterObjByExpr:function(d){if(d&&this.fieldsStore){var c=this.replaceStrings(d);d=c.defExpr;var e=this.findParts(d,"AND");1===e.parts.length&&
(e=this.findParts(d,"OR"),1===e.parts.length&&(e.logicalOperator="AND"));k.forEach(e.parts,function(b){b.expr=b.expr.trim();if(b.expr.startsWith("(")&&-1<b.expr.search(/\)$/)){var c=b.expr.substring(1,b.expr.length-1),a=c.indexOf("("),d=c.indexOf(")");if(-1===a&&-1===d||a<d)b.expr=c}c=this.findParts(b.expr,"AND");1===c.parts.length&&(c=this.findParts(b.expr,"OR"));1<c.parts.length&&(b.parts=c.parts,b.logicalOperator=c.logicalOperator)},this);this.parseExpr(e);this.reReplaceStrings(c,e,f.hitch(this,
function(){e&&e.parts&&k.forEach(e.parts,f.hitch(this,function(b){b&&(b.parts?k.forEach(b.parts,f.hitch(this,function(b){this._handleParsedValuesForSinglePart(b);this._addDefalutValueTypeForSinglePart(b)})):(this._handleParsedValuesForSinglePart(b),this._addDefalutValueTypeForSinglePart(b)))}))}));this.isPartsObjHasError(e)&&(e=null);return e}},_handleParsedValuesForSinglePart:function(d){d&&d.fieldObj&&"number"===d.fieldObj.shortType&&d.valueObj&&(d.valueObj.hasOwnProperty("value")&&(d.valueObj.value=
parseFloat(d.valueObj.value)),d.valueObj.hasOwnProperty("value1")&&(d.valueObj.value1=parseFloat(d.valueObj.value1)),d.valueObj.hasOwnProperty("value2")&&(d.valueObj.value2=parseFloat(d.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(d){d&&d.valueObj&&!d.valueObj.type&&(d.valueObj.type="value")},replaceStrings:function(d){for(var c=d,e=function(a,b,c){var d=-1,d=a.indexOf("'",c+1);return d===c+1?(d=a.indexOf("'",d+1),e(a,b,d)):c},b=[],h=d.indexOf("'");-1<h;){var a=h,h=d.indexOf("'",
h+1),f=0,h=e(d,a,h);"%"===d[a+1]&&a++;"%"===d[h-1]&&(--h,f++);var g=d.substring(a+1,h);"N"===d[a-1]&&(d=d.substring(0,a-1)+d.substring(a),--a,--h);this.isDateString(g)||-1!==g.indexOf("{")?h=d.indexOf("'",h+1+f):(b.push(g),d=d.substring(0,a+1)+"#"+(b.length-1)+"#"+d.substring(h),h=d.indexOf("'",d.lastIndexOf("#")+2+f))}return{origDefExpr:c,defExpr:d,savedStrings:b}},reReplaceStrings:function(d,c,e){var b=d.savedStrings;if(!b.length)e&&"function"===typeof e&&e();else if(b.length){var h=function(a,
b){if(void 0===a.valueObj||null===a.valueObj||void 0===a.valueObj.value||null===a.valueObj.value||"string"!==a.fieldObj.shortType)return!1;var c=a.valueObj.value.indexOf("#"),d=a.valueObj.value.lastIndexOf("#");return r.isDefined(a.valueObj.value)&&-1<c?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(c+1,d),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},h=f.hitch(this,h),a=!1;k.forEach(c.parts,function(c){if(c.parts){var d=!1;k.forEach(c.parts,function(a){d=h(a,b)||d});
d&&(a=d,c.expr=this.builtFilterString(c))}else(a=h(c,b)||a)&&this.builtFilterString(c)},this);e&&"function"===typeof e&&e();a&&(c.expr=null,this.getExprByFilterObj(c))}},isDateString:function(d){return 19===d.length&&"-"===d.charAt(4)&&"-"===d.charAt(7)&&" "===d.charAt(10)&&":"===d.charAt(13)&&":"===d.charAt(16)?!0:!1},findParts:function(d,c){for(var e=d.toLowerCase(),b=" "+c.toLowerCase()+" ",f=[],a=0,g=e.indexOf(b);0<g;){var p=d.substring(a,g),l=p.toLowerCase(),m=p.count("("),k=p.count(")"),r=p.count("'");
m!==k||1===r%2?g=e.indexOf(b,g+1):-1<l.indexOf(" between ")&&-1===l.indexOf(" and ")?g=e.indexOf(b,g+1):(f.push({expr:p}),a=g+b.length,g=e.indexOf(b,a))}f.push({expr:d.substring(a)});for(e=f.length-1;0<=e;e--)!this.hasOperator(f[e].expr)&&0<e&&(f[e-1].expr+=" "+c+" "+f[e].expr,f.splice(e,1));return{expr:d,parts:f,logicalOperator:c}},hasOperator:function(d){d=d.toLowerCase();return-1<d.indexOf("{")&&-1<d.indexOf("}")||-1<d.indexOf(" \x3d ")||-1<d.indexOf(" \x3c ")||-1<d.indexOf(" \x3e ")||-1<d.indexOf(" \x3c\x3e ")||
-1<d.indexOf(" \x3c\x3d ")||-1<d.indexOf(" \x3e\x3d ")||-1<d.indexOf(" like ")||-1<d.indexOf(" between ")||-1<d.indexOf(" date")||-1<d.indexOf(" is null")||-1<d.indexOf(" is not null")?!0:!1},parseExpr:function(d){k.forEach(d.parts,function(c){c.parts?this.parseExpr(c):this.parseSingleExpr(c)},this)},_preParseSingleExpr:function(d){var c=null;try{if(c=f.clone(d),c.expr=c.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(c.expr)){var e=d="",b=c.expr.match(/^UPPER\((.*)\)\s+/i);
if(b&&2<=b.length)d=b[1];else return null;var h=c.expr.match(/UPPER\(N?'(.*)'\)$/i);if(h&&2<=h.length)e="'"+h[1]+"'";else return null;c.expr=c.expr.replace(/^UPPER\((.*)\)\s+/i,d+" ");c.expr=c.expr.replace(/UPPER\(N?'(.*)'\)$/i,e);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&(c.caseSensitive=!0)}catch(a){return console.log(a),null}c&&this.isHosted&&(c.caseSensitive=!1);return c},_removeOperator:function(d,c,e){c=c.substring(e).trim();"date"===d&&!this.isHosted&&c.toLowerCase().startsWith("timestamp ")&&
(c=c.substring(10).trim());return c},parseSingleExpr:function(d){var c=this._preParseSingleExpr(d);c&&(d=f.mixin(d,c));var c=d.expr.trim(),e=c.indexOf(" "),b=c.substring(0,e);d.fieldObj={name:b};d.valueObj={};this.getFieldItemByName({name:b},function(b){d.fieldObj.shortType=b.shortType[0];d.fieldObj.label=b.label[0]},function(){d.error={msg:"unknown field name ("+b+")",code:1}});c=c.substring(e+1).trim();e=c.toLowerCase();e.startsWith("\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,
d),d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):e.startsWith("\x3c ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsBefore:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsLessThan:d.error={msg:"operator ("+e+") not supported for string",code:3}):e.startsWith("\x3e ")?
(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsAfter:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsGreaterThan:d.error={msg:"operator ("+e+") not supported for string",code:3}):e.startsWith("\x3c\x3e ")?(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===d.fieldObj.shortType?
this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):e.startsWith("\x3c\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsOnOrBefore:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsAtMost:d.error={msg:"operator ("+e+") not supported for string",code:3}):e.startsWith("\x3e\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),"date"===
d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsOnOrAfter:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsAtLeast:d.error={msg:"operator ("+e+") not supported for string",code:3}):e.startsWith("like ")?(c=c.substring(5).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),d),d.operator=this.OPERATORS.stringOperatorContains):c.startsWith("'%")&&c.endsWith("'")?(this.storeValue(c.substring(2,
c.length-1),d),d.operator=this.OPERATORS.stringOperatorEndsWith):c.startsWith("'")&&c.endsWith("%'")?(this.storeValue(c.substring(1,c.length-2),d),d.operator=this.OPERATORS.stringOperatorStartsWith):d.error={msg:"value ("+e+") not supported for LIKE",code:3}):e.startsWith("not like ")?(c=c.substring(9).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),d),d.operator=this.OPERATORS.stringOperatorDoesNotContain):d.error=
{msg:"value ("+e+") not supported for NOT LIKE",code:3}):e.startsWith("between ")?this._updatePartForBetween(c,!0,d):e.startsWith("not between ")?this._updatePartForBetween(c,!1,d):"is null"===e?(d.valueObj.value=null,d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===e?(d.valueObj.value=null,d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:
"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):d.error={msg:"unknown operator ("+e+")",code:2};if(r.isDefined(d.valueObj.value)&&"string"===typeof d.valueObj.value&&d.valueObj.value.startsWith("{")&&d.valueObj.value.endsWith("}")||r.isDefined(d.valueObj.value1)&&"string"===typeof d.valueObj.value1&&d.valueObj.value1.startsWith("{")&&d.valueObj.value1.endsWith("}"))d.isInteractive=!0},getFieldItemByName:function(d,c,e){this.fieldsStore.fetch({query:d,
onComplete:f.hitch(this,function(b){b&&b.length?c(b[0]):e()})})},subtractDay:function(d){return new Date(d.getTime()-this.dayInMS)},_updatePartForBetween:function(d,c,e){var b,f,a,g,n;d=this._removeOperator(e.fieldObj.shortType,d,(c?"between ":"not between ").length);b=d.toLowerCase().indexOf(" and ");if(-1<b)if(f=d.substring(0,b).trim(),f.startsWith("CURRENT_TIMESTAMP "))if(f=f.substring(18).trim(),f.startsWith("-")){e.operator=c?this.OPERATORS.dateOperatorInTheLast:this.OPERATORS.dateOperatorNotInTheLast;
try{n=parseFloat(f.substring(1).trim()),1<=n?(a=this.OPERATORS.dateOperatorDays,g=n/365,1E-4>Math.abs(g-Math.round(g))?(n=Math.round(g),a=this.OPERATORS.dateOperatorYears):(g=n/30,1E-4>Math.abs(g-Math.round(g))?(n=Math.round(g),a=this.OPERATORS.dateOperatorMonths):(g=n/7,1E-4>Math.abs(g-Math.round(g))&&(n=Math.round(g),a=this.OPERATORS.dateOperatorWeeks)))):(a=this.OPERATORS.dateOperatorMinutes,n*=24,1E-4>Math.abs(n-Math.round(n))?a=this.OPERATORS.dateOperatorHours:n*=60),e.valueObj.value=n,e.valueObj.range=
a}catch(x){e.error={msg:"missing count for '"+(c?"":"not ")+"in the last'",code:3}}}else e.error={msg:"'"+(c?"":"not ")+"in the next' not supported",code:3};else if(d=this._removeOperator(e.fieldObj.shortType,d.substring(b),5),this.storeValue1(f,e),this.storeValue2(d,e),"date"===e.fieldObj.shortType){if(e.operator=c?this.OPERATORS.dateOperatorIsBetween:this.OPERATORS.dateOperatorIsNotBetween,"object"===typeof e.valueObj.value1&&"object"===typeof e.valueObj.value2)try{1E3>Math.abs(this.subtractDay(e.valueObj.value2).getTime()-
e.valueObj.value1.getTime())&&(e.valueObj.value=e.valueObj.value1,delete e.valueObj.value1,delete e.valueObj.value2,e.operator=c?this.OPERATORS.dateOperatorIsOn:this.OPERATORS.dateOperatorIsNotOn)}catch(x){}}else"number"===e.fieldObj.shortType||"oid"===e.fieldObj.shortType?e.operator=c?this.OPERATORS.numberOperatorIsBetween:this.OPERATORS.numberOperatorIsNotBetween:e.error={msg:e.fieldObj.shortType+" field not supported for "+(c?"":"NOT ")+"BETWEEN",code:3};else e.error={msg:"missing AND operator for "+
(c?"":"NOT ")+"BETWEEN",code:3}},storeValue:function(d,c){if(d.startsWith("{")&&d.endsWith("}"))c.valueObj.value=d;else if(d.startsWith("'{")&&d.endsWith("}'"))c.valueObj.value=d.substring(1,d.length-1);else if("date"===c.fieldObj.shortType)if(d.startsWith("'")&&d.endsWith("'")){var e=d.substring(1,d.length-1);c.valueObj.value=this.parseDate(e)}else c.valueObj.value=d,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(d.startsWith("#")||d.startsWith("%#"))&&(d.endsWith("#")||d.endsWith("#%"))?
c.valueObj.value=d:d.startsWith("'")&&d.endsWith("'")?c.valueObj.value=d.substring(1,d.length-1).replace(/\'\'/g,"'"):(c.valueObj.value=d,c.valueObj.type="field",this.getFieldItemByName({name:d},function(b){c.valueObj.label=b.label[0]},function(){c.error={msg:"unknown field name ("+d+")",code:1}})):(c.valueObj.value=d,isNaN(d)&&(c.valueObj.type="field",this.getFieldItemByName({name:d},function(b){c.valueObj.label=b.label[0]},function(){c.error={msg:"unknown field name ("+d+")",code:1}})))},storeValue1:function(d,
c){d.startsWith("{")&&d.endsWith("}")?c.valueObj.value1=d:d.startsWith("'{")&&d.endsWith("}'")?c.valueObj.value1=d.substring(1,d.length-1):"date"===c.fieldObj.shortType?d.startsWith("'")&&d.endsWith("'")?(d=d.substring(1,d.length-1),c.valueObj.value1=this.parseDate(d)):(c.valueObj.value1=d,c.valueObj.type="field"):(c.valueObj.value1=d,isNaN(d)&&(c.valueObj.type="field"))},storeValue2:function(d,c){d.startsWith("{")&&d.endsWith("}")?c.valueObj.value2=d:d.startsWith("'{")&&d.endsWith("}'")?c.valueObj.value2=
d.substring(1,d.length-1):"date"===c.fieldObj.shortType?d.startsWith("'")&&d.endsWith("'")?(d=d.substring(1,d.length-1),c.valueObj.value2=this.parseDate(d)):(c.valueObj.value2=d,c.valueObj.type="field"):(c.valueObj.value2=d,isNaN(d)&&(c.valueObj.type="field"))},parseDate:function(d){var c=q.parse(d,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=q.parse(d.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=q.parse(d.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));
return c}});p.VIRTUAL_DATE_TODAY="today";p.VIRTUAL_DATE_YESTERDAY="yesterday";p.VIRTUAL_DATE_TOMORROW="tomorrow";p.VIRTUAL_DATE_THIS_WEEK="thisWeek";p.VIRTUAL_DATE_THIS_MONTH="thisMonth";p.VIRTUAL_DATE_THIS_QUARTER="thisQuarter";p.VIRTUAL_DATE_THIS_YEAR="thisYear";p.isAskForValues=function(d){var c=!1;return c=k.some(d.parts,function(c){return c.parts?k.some(c.parts,function(b){return!!b.interactiveObj}):!!c.interactiveObj})};p.hasVirtualDate=function(d){var c=!1;return c=k.some(d.parts,function(c){return c.parts?
k.some(c.parts,function(b){return!!b.valueObj.virtualDate||!!b.valueObj.virtualDate1||!!b.valueObj.virtualDate2}):!!c.valueObj.virtualDate||!!c.valueObj.virtualDate1||!!c.valueObj.virtualDate2})};p.getRealDateByVirtualDate=function(d){var c=null,e=new Date,b=e.getTime();switch(d){case p.VIRTUAL_DATE_TODAY:c=e;break;case p.VIRTUAL_DATE_YESTERDAY:c=new Date(b-864E5);break;case p.VIRTUAL_DATE_TOMORROW:c=new Date(b+864E5);break;case p.VIRTUAL_DATE_THIS_WEEK:c=[g().startOf("week").toDate(),g().endOf("week").toDate()];
break;case p.VIRTUAL_DATE_THIS_MONTH:c=[g().startOf("month").toDate(),g().endOf("month").toDate()];break;case p.VIRTUAL_DATE_THIS_QUARTER:c=[g().startOf("quarter").toDate(),g().endOf("quarter").toDate()];break;case p.VIRTUAL_DATE_THIS_YEAR:c=[g().startOf("year").toDate(),g().endOf("year").toDate()]}return c};return p})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(t,
f,k,q,e,r,m){return f("dojo.data.ItemFileWriteStore",r,{constructor:function(e){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(e){return m.toISOString(e,{zulu:!0})});e&&!1===e.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(e){if(!e)throw Error("assertion failed in ItemFileWriteStore");
},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(e,f){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof e&&"undefined"!=typeof e)throw Error("newItem() was passed something other than an object");var g=null,d=this._getIdentifierAttribute();if(d===Number)g=this._arrayOfAllItems.length;else{g=e[d];if("undefined"===typeof g)throw Error("newItem() was not passed an identity for the new item");if(t.isArray(g))throw Error("newItem() was not passed an single-valued identity");
}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[g]);this._assert("undefined"===typeof this._pending._newItems[g]);this._assert("undefined"===typeof this._pending._deletedItems[g]);var c={};c[this._storeRefPropName]=this;c[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[g]=c,c[d]=[g]);this._arrayOfAllItems.push(c);d=null;if(f&&f.parent&&f.attribute){var d={item:f.parent,attribute:f.attribute,oldValue:void 0},n=this.getValues(f.parent,
f.attribute);if(n&&0<n.length){var b=n.slice(0,n.length);d.oldValue=1===n.length?n[0]:n.slice(0,n.length);b.push(c);this._setValueOrValues(f.parent,f.attribute,b,!1);d.newValue=this.getValues(f.parent,f.attribute)}else this._setValueOrValues(f.parent,f.attribute,c,!1),d.newValue=c}else c[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(c);this._pending._newItems[g]=c;for(var h in e){if(h===this._storeRefPropName||h===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");
f=e[h];t.isArray(f)||(f=[f]);c[h]=f;if(this.referenceIntegrity)for(g=0;g<f.length;g++)n=f[g],this.isItem(n)&&this._addReferenceToMap(n,c,h)}this.onNew(c,d);return c},_removeArrayElement:function(e,f){f=k.indexOf(e,f);return-1!=f?(e.splice(f,1),!0):!1},deleteItem:function(e){this._assert(!this._saveInProgress);this._assertIsItem(e);var f=e[this._itemNumPropName],p=this.getIdentity(e);if(this.referenceIntegrity){var d=this.getAttributes(e);e[this._reverseRefMap]&&(e["backup_"+this._reverseRefMap]=t.clone(e[this._reverseRefMap]));
k.forEach(d,function(a){k.forEach(this.getValues(e,a),function(b){this.isItem(b)&&(e["backupRefs_"+this._reverseRefMap]||(e["backupRefs_"+this._reverseRefMap]=[]),e["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(b),attr:a}),this._removeReferenceFromMap(b,e,a))},this)},this);if(d=e[this._reverseRefMap])for(var c in d){var n=null;if(n=this._itemsByIdentity?this._itemsByIdentity[c]:this._arrayOfAllItems[c])for(var b in d[c]){var h=this.getValues(n,b)||[],a=k.filter(h,function(a){return!(this.isItem(a)&&
this.getIdentity(a)==p)},this);this._removeReferenceFromMap(e,n,b);a.length<h.length&&this._setValueOrValues(n,b,a,!0)}}}this._arrayOfAllItems[f]=null;e[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[p];this._pending._deletedItems[p]=e;e[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,e);this.onDelete(e);return!0},setValue:function(e,f,p){return this._setValueOrValues(e,f,p,!0)},setValues:function(e,f,p){return this._setValueOrValues(e,
f,p,!0)},unsetAttribute:function(e,f){return this._setValueOrValues(e,f,[],!0)},_setValueOrValues:function(e,f,p,d){this._assert(!this._saveInProgress);this._assertIsItem(e);this._assert(t.isString(f));this._assert("undefined"!==typeof p);var c=this._getIdentifierAttribute();if(f==c)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var c=this._getValueOrValues(e,f),g=this.getIdentity(e);if(!this._pending._modifiedItems[g]){var b={},h;for(h in e)b[h]=
h===this._storeRefPropName||h===this._itemNumPropName||h===this._rootItemPropName?e[h]:h===this._reverseRefMap?t.clone(e[h]):e[h].slice(0,e[h].length);this._pending._modifiedItems[g]=b}g=!1;if(t.isArray(p)&&0===p.length){if(g=delete e[f],p=void 0,this.referenceIntegrity&&c){h=c;t.isArray(h)||(h=[h]);for(var a=0;a<h.length;a++)b=h[a],this.isItem(b)&&this._removeReferenceFromMap(b,e,f)}}else{g=t.isArray(p)?p.slice(0,p.length):[p];if(this.referenceIntegrity)if(c){h=c;t.isArray(h)||(h=[h]);var u={};k.forEach(h,
function(a){this.isItem(a)&&(a=this.getIdentity(a),u[a.toString()]=!0)},this);k.forEach(g,function(a){if(this.isItem(a)){var b=this.getIdentity(a);u[b.toString()]?delete u[b.toString()]:this._addReferenceToMap(a,e,f)}},this);for(a in u)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a],e,f)}else for(a=0;a<g.length;a++)b=g[a],this.isItem(b)&&this._addReferenceToMap(b,e,f);e[f]=g;g=!0}if(d)this.onSet(e,f,c,p);return g},_addReferenceToMap:function(e,
f,p){f=this.getIdentity(f);var d=e[this._reverseRefMap];d||(d=e[this._reverseRefMap]={});(e=d[f])||(e=d[f]={});e[p]=!0},_removeReferenceFromMap:function(e,f,p){f=this.getIdentity(f);var d=e[this._reverseRefMap],c;if(d){for(c in d)c==f&&(delete d[c][p],this._isEmpty(d[c])&&delete d[c]);this._isEmpty(d)&&delete e[this._reverseRefMap]}},_dumpReferenceMap:function(){var e;for(e=0;e<this._arrayOfAllItems.length;e++){var f=this._arrayOfAllItems[e];f&&f[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(f)+
"] is referenced by: "+q.toJson(f[this._reverseRefMap]))}},_getValueOrValues:function(e,f){var g=void 0;this.hasAttribute(e,f)&&(e=this.getValues(e,f),g=1==e.length?e[0]:e);return g},_flatten:function(e){if(this.isItem(e))return{_reference:this.getIdentity(e)};if("object"===typeof e)for(var f in this._datatypeMap){var p=this._datatypeMap[f];if(t.isObject(p)&&!t.isFunction(p)){if(e instanceof p.type){if(!p.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+f+"]");
return{_type:f,_value:p.serialize(e)}}}else if(e instanceof p)return{_type:f,_value:e.toString()}}return e},_getNewFileContentString:function(){var e={},f=this._getIdentifierAttribute();f!==Number&&(e.identifier=f);this._labelAttr&&(e.label=this._labelAttr);e.items=[];for(f=0;f<this._arrayOfAllItems.length;++f){var p=this._arrayOfAllItems[f];if(null!==p){var d={},c;for(c in p)if(c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._reverseRefMap&&c!==this._rootItemPropName){var n=this.getValues(p,
c);if(1==n.length)d[c]=this._flatten(n[0]);else for(var b=[],h=0;h<n.length;++h)b.push(this._flatten(n[h])),d[c]=b}e.items.push(d)}}return q.toJson(e,!0)},_isEmpty:function(e){var f=!0;if(t.isObject(e))for(var p in e){f=!1;break}else t.isArray(e)&&0<e.length&&(f=!1);return f},save:function(f){this._assert(!this._saveInProgress);this._saveInProgress=!0;var g=this,p=function(){g._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};g._saveInProgress=!1;f&&f.onComplete&&f.onComplete.call(f.scope||
e.global)},d=function(c){g._saveInProgress=!1;f&&f.onError&&f.onError.call(f.scope||e.global,c)};if(this._saveEverything){var c=this._getNewFileContentString();this._saveEverything(p,d,c)}this._saveCustom&&this._saveCustom(p,d);this._saveEverything||this._saveCustom||p()},revert:function(){this._assert(!this._saveInProgress);for(var e in this._pending._modifiedItems){var f=this._pending._modifiedItems[e],p=null,p=this._itemsByIdentity?this._itemsByIdentity[e]:this._arrayOfAllItems[e];f[this._storeRefPropName]=
this;for(var d in p)delete p[d];t.mixin(p,f)}var c;for(e in this._pending._deletedItems)c=this._pending._deletedItems[e],c[this._storeRefPropName]=this,f=c[this._itemNumPropName],c["backup_"+this._reverseRefMap]&&(c[this._reverseRefMap]=c["backup_"+this._reverseRefMap],delete c["backup_"+this._reverseRefMap]),this._arrayOfAllItems[f]=c,this._itemsByIdentity&&(this._itemsByIdentity[e]=c),c[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(c);for(e in this._pending._deletedItems)c=this._pending._deletedItems[e],
c["backupRefs_"+this._reverseRefMap]&&(k.forEach(c["backupRefs_"+this._reverseRefMap],function(d){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[d.id]:this._arrayOfAllItems[d.id],c,d.attr)},this),delete c["backupRefs_"+this._reverseRefMap]);for(e in this._pending._newItems)f=this._pending._newItems[e],f[this._storeRefPropName]=null,this._arrayOfAllItems[f[this._itemNumPropName]]=null,f[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,f),this._itemsByIdentity&&
delete this._itemsByIdentity[e];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(e){return e?(e=this.getIdentity(e),(new Boolean(this._pending._newItems[e]||this._pending._modifiedItems[e]||this._pending._deletedItems[e])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(e,f,p,d){},onNew:function(e,f){},onDelete:function(e){},close:function(e){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(t,f,k,q,e,r,m,l,g){k=k("dojo.data.ItemFileReadStore",[r],{constructor:function(e){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=e.url;this._jsonData=e.data;this.data=null;this._datatypeMap=e.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(d){return g.fromISOString(d)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==e.urlPreventCache&&(this.urlPreventCache=e.urlPreventCache?!0:!1);void 0!==e.hierarchical&&(this.hierarchical=e.hierarchical?
!0:!1);e.clearOnClose&&(this.clearOnClose=!0);"failOk"in e&&(this.failOk=e.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(e){if(!this.isItem(e))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(e){if("string"!==typeof e)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(e,d,c){e=this.getValues(e,d);return 0<e.length?e[0]:c},getValues:function(e,
d){this._assertIsItem(e);this._assertIsAttribute(d);return(e[d]||[]).slice(0)},getAttributes:function(e){this._assertIsItem(e);var d=[],c;for(c in e)c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._rootItemPropName&&c!==this._reverseRefMap&&d.push(c);return d},hasAttribute:function(e,d){this._assertIsItem(e);this._assertIsAttribute(d);return d in e},containsValue:function(e,d,c){var f=void 0;"string"===typeof c&&(f=m.patternToRegExp(c,!1));return this._containsValue(e,d,c,f)},_containsValue:function(e,
d,c,g){return q.some(this.getValues(e,d),function(b){if(null!==b&&!f.isObject(b)&&g){if(b.toString().match(g))return!0}else if(c===b)return!0})},isItem:function(e){return e&&e[this._storeRefPropName]===this&&this._arrayOfAllItems[e[this._itemNumPropName]]===e?!0:!1},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this._assertIsItem(e.item)},getFeatures:function(){return this._features},getLabel:function(e){if(this._labelAttr&&this.isItem(e))return this.getValue(e,this._labelAttr)},
getLabelAttributes:function(e){return this._labelAttr?[this._labelAttr]:null},filter:function(e,d,c){var f=[],b,h;if(e.query){var a;b=e.queryOptions?e.queryOptions.ignoreCase:!1;var g={};for(h in e.query)a=e.query[h],"string"===typeof a?g[h]=m.patternToRegExp(a,b):a instanceof RegExp&&(g[h]=a);for(b=0;b<d.length;++b){var p=!0,l=d[b];if(null===l)p=!1;else for(h in e.query)a=e.query[h],this._containsValue(l,h,a,g[h])||(p=!1);p&&f.push(l)}}else for(b=0;b<d.length;++b)h=d[b],null!==h&&f.push(h);c(f,e)},
_fetchItems:function(g,d,c){var n=this;if(this._loadFinished)this.filter(g,this._getItemsArray(g.queryOptions),d);else if(this._jsonFileUrl!==this._ccUrl?(t.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:g,
filter:f.hitch(n,"filter"),findCallback:f.hitch(n,d)});else{this._loadInProgress=!0;var b=e.get({url:n._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});b.addCallback(function(a){try{n._getItemsFromLoadedData(a),n._loadFinished=!0,n._loadInProgress=!1,n.filter(g,n._getItemsArray(g.queryOptions),d),n._handleQueuedFetches()}catch(u){n._loadFinished=!0,n._loadInProgress=!1,c(u,g)}});b.addErrback(function(a){n._loadInProgress=!1;c(a,g)});var h=null;g.abort&&
(h=g.abort);g.abort=function(){var a=b;a&&-1===a.fired&&(a.cancel(),a=null);h&&h.call(g)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,n.filter(g,this._getItemsArray(g.queryOptions),d)}catch(a){c(a,g)}else c(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),g)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var e=0;e<this._queuedFetches.length;e++){var d=
this._queuedFetches[e],c=d.args,f=d.filter,d=d.findCallback;f?f(c,this._getItemsArray(c.queryOptions),d):this.fetchItemByIdentity(c)}this._queuedFetches=[]}},_getItemsArray:function(e){return e&&e.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(e){this.clearOnClose&&this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(e){function d(a){return null!==a&&"object"===typeof a&&(!f.isArray(a)||g)&&!f.isFunction(a)&&(a.constructor==Object||f.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&b.hierarchical}function c(a){b._arrayOfAllItems.push(a);for(var e in a){var h=a[e];if(h)if(f.isArray(h))for(var g=
0;g<h.length;++g){var n=h[g];d(n)&&c(n)}else d(h)&&c(h)}}var g=!1,b=this;this._labelAttr=e.label;var h,a;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=e.items;for(h=0;h<this._arrayOfTopLevelItems.length;++h)a=this._arrayOfTopLevelItems[h],f.isArray(a)&&(g=!0),c(a),a[this._rootItemPropName]=!0;var u={},p;for(h=0;h<this._arrayOfAllItems.length;++h)for(p in a=this._arrayOfAllItems[h],a){if(p!==this._rootItemPropName){var l=a[p];null!==l?f.isArray(l)||(a[p]=[l]):a[p]=[null]}u[p]=p}for(;u[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;u[this._itemNumPropName];)this._itemNumPropName+="_";for(;u[this._reverseRefMap];)this._reverseRefMap+="_";if(u=e.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=u,h=0;h<this._arrayOfAllItems.length;++h)if(a=this._arrayOfAllItems[h],e=a[u],e=e[0],Object.hasOwnProperty.call(this._itemsByIdentity,e)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
u+"].  Value collided: ["+e+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+u+"].  Value collided: ["+e+"]");}else this._itemsByIdentity[e]=a;else this._features["dojo.data.api.Identity"]=Number;for(h=0;h<this._arrayOfAllItems.length;++h)a=this._arrayOfAllItems[h],a[this._storeRefPropName]=this,a[this._itemNumPropName]=h;for(h=0;h<this._arrayOfAllItems.length;++h)for(p in a=this._arrayOfAllItems[h],
a)for(e=a[p],u=0;u<e.length;++u)if(l=e[u],null!==l&&"object"==typeof l){if("_type"in l&&"_value"in l){var m=l._type,k=this._datatypeMap[m];if(k)if(f.isFunction(k))e[u]=new k(l._value);else if(f.isFunction(k.deserialize))e[u]=k.deserialize(l._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
m+"'");}if(l._reference){l=l._reference;if(f.isObject(l))for(m=0;m<this._arrayOfAllItems.length;++m){var k=this._arrayOfAllItems[m],r=!0,q;for(q in l)k[q]!=l[q]&&(r=!1);r&&(e[u]=k)}else e[u]=this._getItemByIdentity(l);this.referenceIntegrity&&(l=e[u],this.isItem(l)&&this._addReferenceToMap(l,a,p))}else this.isItem(l)&&this.referenceIntegrity&&this._addReferenceToMap(l,a,p)}},_addReferenceToMap:function(e,d,c){},getIdentity:function(e){var d=this._features["dojo.data.api.Identity"];return d===Number?
e[this._itemNumPropName]:(e=e[d])?e[0]:null},fetchItemByIdentity:function(f){var d,c;if(this._loadFinished)d=this._getItemByIdentity(f.identity),f.onItem&&(c=f.scope?f.scope:t.global,f.onItem.call(c,d));else{var g=this;this._jsonFileUrl!==this._ccUrl?(t.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:f}):(this._loadInProgress=!0,c=e.get({url:g._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),c.addCallback(function(b){var c=f.scope?f.scope:t.global;try{g._getItemsFromLoadedData(b),g._loadFinished=!0,g._loadInProgress=!1,d=g._getItemByIdentity(f.identity),f.onItem&&f.onItem.call(c,d),g._handleQueuedFetches()}catch(a){g._loadInProgress=
!1,f.onError&&f.onError.call(c,a)}}),c.addErrback(function(b){g._loadInProgress=!1;f.onError&&f.onError.call(f.scope?f.scope:t.global,b)})):this._jsonData&&(g._getItemsFromLoadedData(g._jsonData),g._jsonData=null,g._loadFinished=!0,d=g._getItemByIdentity(f.identity),f.onItem&&(c=f.scope?f.scope:t.global,f.onItem.call(c,d)))}},_getItemByIdentity:function(e){var d=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,e)&&(d=this._itemsByIdentity[e]):Object.hasOwnProperty.call(this._arrayOfAllItems,
e)&&(d=this._arrayOfAllItems[e]);void 0===d&&(d=null);return d},getIdentityAttributes:function(e){e=this._features["dojo.data.api.Identity"];return e===Number?null:[e]},_forceLoad:function(){var f=this;this._jsonFileUrl!==this._ccUrl?(t.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var d=e.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});d.addCallback(function(c){try{if(!0!==f._loadInProgress&&!f._loadFinished)f._getItemsFromLoadedData(c),f._loadFinished=!0;else if(f._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(n){throw console.log(n),n;}});d.addErrback(function(c){throw c;
})}else this._jsonData&&(f._getItemsFromLoadedData(f._jsonData),f._jsonData=null,f._loadFinished=!0)}});f.extend(k,l);return k})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(t){var f={};t.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,q){for(var e="^",k=null,m=0;m<f.length;m++)switch(k=f.charAt(m),k){case "\\":e+=k;m++;e+=f.charAt(m);break;case "*":e+=".*";break;case "?":e+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":e+=
"\\";default:e+=k}e+="$";return q?new RegExp(e,"mi"):new RegExp(e,"m")};return f})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(t,f,k){var q={};t.setObject("dojo.data.util.simpleFetch",q);q.errorHandler=function(e,k){k.onError&&k.onError.call(k.scope||f.global,e,k)};q.fetchHandler=function(e,r){var m=r.abort||null,l=!1,g=r.start?r.start:0,p=r.count&&Infinity!==r.count?g+r.count:e.length;r.abort=function(){l=!0;m&&m.call(r)};var d=r.scope||
f.global;r.store||(r.store=this);r.onBegin&&r.onBegin.call(d,e.length,r);r.sort&&e.sort(k.createSortFunction(r.sort,this));if(r.onItem)for(var c=g;c<e.length&&c<p;++c){var n=e[c];l||r.onItem.call(d,n,r)}r.onComplete&&!l&&(c=null,r.onItem||(c=e.slice(g,p)),r.onComplete.call(d,c,r))};q.fetch=function(e){e=e||{};e.store||(e.store=this);this._fetchItems(e,t.hitch(this,"fetchHandler"),t.hitch(this,"errorHandler"));return e};return q})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(t){var f=
{};t.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,q){var e=-1;null===f&&(f=void 0);null===q&&(q=void 0);if(f==q)e=0;else if(f>q||null==f)e=1;return e};f.createSortFunction=function(k,q){function e(c,b,d,a){return function(e,f){e=a.getValue(e,c);f=a.getValue(f,c);return b*d(e,f)}}for(var r=[],m,l=q.comparatorMap,g=f.basicComparator,p=0;p<k.length;p++){m=k[p];var d=m.attribute;if(d){m=m.descending?-1:1;var c=g;l&&("string"!==typeof d&&"toString"in d&&(d=d.toString()),c=l[d]||g);
r.push(e(d,m,c,q))}}return function(c,b){for(var d=0;d<r.length;){var a=r[d++](c,b);if(0!==a)return a}return 0}};return f})},"jimu/Query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred jimu/utils jimu/ServiceDefinitionManager esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet".split(" "),function(t,f,k,q,e,r,m,l,g,p){var d=t(null,{queryType:0,nextPageIndex:1,pageSizeOption:null,layerDefinition:null,layerDefinitionDef:null,type1CountDef:null,
type2ObjectIdsDef:null,type3QueryDef:null,sdf:null,url:null,query:null,pageSize:1E3,constructor:function(c){this.sdf=m.getInstance();this.url=c.url;this.query=c.query;this.pageSizeOption=c.pageSize;this.query.outFields&&0!==this.query.outFields.length||(this.query.outFields=["*"]);this.pageSize=0<c.pageSize?c.pageSize:1E3;this.getFeatureCount()},getFeatureCount:function(){return this._getQueryType().then(f.hitch(this,function(c){return 1===c?this._getCountForQueryType1():2===c?this._getCountForQueryType2():
this._getCountForQueryType3()}))},getPageCount:function(){return this.getFeatureCount().then(f.hitch(this,function(c){return 0===c?0:Math.ceil(c/this.pageSize)}))},getAllFeatures:function(){return this.getPageCount().then(f.hitch(this,function(c){if(0<c){for(var d=[],b=1;b<=c;b++)d.push(this.queryByPage(b));return q(d).then(f.hitch(this,function(b){for(var a=[],c=0;c<b.length;c++)b[c].features&&0<b[c].features.length&&(a=a.concat(b[c].features));a=this._setOrderByFieldValue(a);b=b[0];b.features=a;
return b}))}this._getEmptyFeatureSet().then(f.hitch(this,function(b){return b}))}))},_setOrderByFieldValue:function(c){if(2===this.queryType||3===this.queryType){var d=this.query.outFields;c.sort(function(b,c){b=b.attributes[d];c=c.attributes[d];return"string"===typeof b&&"string"===typeof c?b.localeCompare(c):b<c?-1:b===c?0:1})}return c},_getEmptyFeatureSet:function(){var c=new e;this.layerDefinition&&this.layerDefinition.geometryType?c.resolve(this._getEmptyFeatureSetHandler()):this._getLayerDefinition().then(f.hitch(this,
function(){c.resolve(this._getEmptyFeatureSetHandler())}));return c},_getEmptyFeatureSetHandler:function(){var c=new p;c.features=[];c.geometryType=this.layerDefinition.geometryType;c.fields=[];var d=f.clone(this.layerDefinition.fields);0<=this.query.outFields.indexOf("*")?c.fields=d:c.fields=k.filter(d,f.hitch(this,function(b){return 0<=this.query.outFields.indexOf(b.name)}));return c},getCurrentPageIndex:function(){return this.nextPageIndex},queryNextPage:function(){var c=this.nextPageIndex;this.nextPageIndex++;
return this.queryByPage(c)},queryByPage:function(c){var d=null;0>=c?(d=new e,this._getEmptyFeatureSet().then(f.hitch(this,function(b){d.resolve(b)}))):d=this.getPageCount().then(f.hitch(this,function(b){c>b&&this._getEmptyFeatureSet().then(f.hitch(this,function(b){return b}));return 1===this.queryType?this._queryPageForType1(c):2===this.queryType?this._queryPageForType2(c):this._queryPageForType3(c)}));return d},_getQueryType:function(){var c=new e;if(0<this.queryType)c.resolve(this.queryType);else return this._getLayerDefinition().then(f.hitch(this,
function(c){return this.queryType=d.getQueryType(c)}));return c},_getDefStatus:function(c){return c?c.isFulfilled()?c.isResolved()?2:-1:1:0},_getLayerDefinition:function(){0>=this._getDefStatus(this.layerDefinitionDef)&&(this.layerDefinitionDef=this.sdf.getServiceDefinition(this.url).then(f.hitch(this,function(c){this.layerDefinition=c;var d=c.maxRecordCount;0<d&&(!(0<this.pageSizeOption)||this.pageSize>c.maxRecordCount)&&(this.pageSize=d);return this.layerDefinition})));return this.layerDefinitionDef},
_getCountForQueryType1:function(){0>=this._getDefStatus(this.type1CountDef)&&(this.type1CountDef=this._queryCount());return this.type1CountDef},_getCountForQueryType2:function(){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(c){return c.length}))},_getObjectIdsForQueryType2:function(){0>=this._getDefStatus(this.type2ObjectIdsDef)&&(this.type2ObjectIdsDef=this._queryIds());return this.type2ObjectIdsDef},_getCountForQueryType3:function(){return this._doQueryForQueryType3().then(f.hitch(this,
function(c){return(c.features||[]).length}))},_doQueryForQueryType3:function(){0>=this._getDefStatus(this.type3QueryDef)&&(this.type3QueryDef=this._query());return this.type3QueryDef},_queryPageForType1:function(c){return this._queryWithPaginationAndOrder((c-1)*this.pageSize)},_queryPageForType2:function(c){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(d){var b=(c-1)*this.pageSize;d=d.slice(b,b+this.pageSize);return this._queryByObjectIds(d)}))},_queryPageForType3:function(c){return this._doQueryForQueryType3().then(f.hitch(this,
function(d){var b=f.mixin({},d);b.features=[];var e=(c-1)*this.pageSize;b.features=(d.features||[]).slice(e,e+this.pageSize);return b}))},_tryLocaleNumber:function(c){var d=r.localizeNumber(c);if(null===d||void 0===d)d=c;return d},_tryLocaleDate:function(c){var d=r.localizeDate(c);d||(d=c.toLocaleDateString());return d},_getLayerIndexByLayerUrl:function(c){var d=c.lastIndexOf("/");c=c.slice(d+1,c.length);return parseInt(c,10)},_getServiceUrlByLayerUrl:function(c){var d=c.lastIndexOf("/");return c.slice(0,
d)},_isImageServiceLayer:function(c){return-1<c.indexOf("/ImageServer")},_isTable:function(c){return"Table"===c.type},_getObjectIdField:function(){return this.layerDefinition.objectIdField},_query:function(c){var d=new l;d.where=c||this.query.where;d.geometry=this.query.geometry;d.outSpatialReference=this.query.outSpatialReference;d.returnGeometry=this.query.returnGeometry;d.spatialRelationship=this.query.spatialRelationship;d.outFields=this.query.outFields;d.returnDistinctValues=this.query.returnDistinctValues;
return(new g(this.url)).execute(d)},_queryIds:function(){var c=new l;c.where=this.query.where;c.geometry=this.query.geometry;c.returnGeometry=!1;c.spatialRelationship=this.query.spatialRelationship;c.outSpatialReference=this.query.outSpatialReference;return(new g(this.url)).executeForIds(c).then(f.hitch(this,function(c){c||(c=[]);return c}))},_queryByObjectIds:function(c){var d=new e,b=new l;b.returnGeometry=this.query.returnGeometry;b.outSpatialReference=this.query.outSpatialReference;b.spatialRelationship=
this.query.spatialRelationship;b.outFields=this.query.outFields;b.objectIds=c;(new g(this.url)).execute(b).then(f.hitch(this,function(b){d.resolve(b)}),f.hitch(this,function(b){if(400===b.code){var a=this._getObjectIdField(),e="",h=c.length;k.forEach(c,f.hitch(this,function(b,c){e+=a+" \x3d "+b;c!==h-1&&(e+=" OR ")}));this._query(e).then(f.hitch(this,function(a){d.resolve(a)}),f.hitch(this,function(a){d.reject(a)}))}else d.reject(b)}));return d},_queryCount:function(){var c=new l;c.where=this.query.where;
c.geometry=this.query.geometry;c.outSpatialReference=this.query.outSpatialReference;c.spatialRelationship=this.query.spatialRelationship;c.returnGeometry=!1;return(new g(this.url)).executeForCount(c)},_queryWithPaginationAndOrder:function(c){var d=new l;d.where=this.query.where;d.geometry=this.query.geometry;d.outSpatialReference=this.query.outSpatialReference;d.returnGeometry=this.query.returnGeometry;d.spatialRelationship=this.query.spatialRelationship;d.outFields=this.query.outFields;d.returnDistinctValues=
this.query.returnDistinctValues;d.start=c;d.num=this.pageSize;(c=this.query.orderByFields)&&0<c.length&&(d.orderByFields=c,c=k.map(c,f.hitch(this,function(b){return b.split(" ")[0]})),k.forEach(c,f.hitch(this,function(b){0>d.outFields.indexOf(b)&&d.outFields.push(b)})));return(new g(this.url)).execute(d)}});d._isServiceSupportsOrderBy=function(c){var d=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsOrderBy&&(d=!0);return d};d._isServiceSupportsPagination=function(c){var d=!1;
c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsPagination&&(d=!0);return d};d._isSupportObjectIds=function(c){var d=0;c=c.currentVersion?c:c.toJson().layerDefinition;c.currentVersion&&(d=parseFloat(c.currentVersion));return 10<=d||c.hasOwnProperty("typeIdField")};d.getQueryType=function(c){var e=-1;return e=d._isServiceSupportsOrderBy(c)&&d._isServiceSupportsPagination(c)?1:d._isSupportObjectIds(c)?2:3};return d})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager",
"./utils"],function(t,f){function k(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(f){return f},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(f){f.widgetOnScreen&&f.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===f.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===f.widgetOnScreen.panel.uri)&&(f.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");
return f},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(f){var e=0;if(f.widgetOnScreen&&f.widgetOnScreen.widgets){for(var k=!1,e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/Splash/Widget"===f.widgetOnScreen.widgets[e].uri&&(k=!0);k||f.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});k=!1;for(e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/TimeSlider/Widget"===f.widgetOnScreen.widgets[e].uri&&
(k=!0);k||f.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});k=!1;for(e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/Swipe/Widget"===f.widgetOnScreen.widgets[e].uri&&(k=!0);k||f.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return f},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(k){(function(e){f.visitElement(e,
function(e){e.positionRelativeTo&&(e.position?e.position.relativeTo=e.positionRelativeTo:e.position={relativeTo:e.positionRelativeTo},e.panel&&(e.panel.position?e.panel.position.relativeTo=e.panel.positionRelativeTo:e.panel.position={relativeTo:e.panel.positionRelativeTo}))});var k=e.widgetOnScreen;k&&k.panel&&k.panel.positionRelativeTo&&(k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:k.panel.position={relativeTo:k.panel.positionRelativeTo});(k=e.widgetPool)&&k.panel&&k.panel.positionRelativeTo&&
(k.panel.position?k.panel.position.relativeTo=k.panel.positionRelativeTo:k.panel.position={relativeTo:k.panel.positionRelativeTo})})(k);k.widgetOnScreen&&k.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===k.widgetOnScreen.panel.uri&&(k.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(e){if(e.widgetOnScreen&&e.widgetOnScreen.widgets&&e.theme&&"FoldableTheme"===e.theme.name){var f=null,m=null;if(f=e.widgetOnScreen.widgets[4])void 0!==f.position.top?(f={position:{left:205,top:45}},
m={position:{left:255,top:45}}):(f={position:{left:205,bottom:55}},m={position:{left:255,bottom:55}}),e.widgetOnScreen.widgets.splice(7,0,f,m)}})(k);(function(){for(var e=0,f=0,m=!1,e=0;e<k.widgetOnScreen.widgets.length;e++)if("widgets/Geocoder/Widget"===k.widgetOnScreen.widgets[e].uri){m=!0;break}for(var l=!1,f=0;f<k.widgetOnScreen.widgets.length;f++)if("widgets/Search/Widget"===k.widgetOnScreen.widgets[f].uri){l=!0;break}!l&&m&&(e=k.widgetOnScreen.widgets[e],e.uri="widgets/Search/Widget",e.name=
"Search")})(k);(function(e){for(var f=0,f=e.widgetOnScreen.widgets.length-1;0<=f;f--){var m=e.widgetOnScreen.widgets[f];if("widgets/Swipe/Widget"===m.uri&&!m.closeable&&(e.widgetOnScreen.widgets.splice(f,1),!1!==m.visible)){m.closeable=!0;var l;a:{for(l=l=0;l<e.widgetOnScreen.widgets.length;l++)if(!e.widgetOnScreen.widgets[l].uri)break a;l=-1}0<=l&&(m.position=e.widgetOnScreen.widgets[l].position,e.widgetOnScreen.widgets[l]=m)}"widgets/TimeSlider/Widget"===m.uri&&(!1===m.visible?e.widgetOnScreen.widgets.splice(f,
1):m.closeable=!0)}})(k);k.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});k.loadingPage||(k.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return k},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(f){if(f.theme){var e=f.theme.name;if(("FoldableTheme"===e||"JewelryBoxTheme"===e)&&
f.widgetOnScreen){var k=f.widgetOnScreen.widgets;if(k&&0<k.length)for(var e="themes/"+e+"/widgets/HeaderController/Widget",m=null,l=0;l<k.length;l++)(m=k[l])&&m.uri===e&&m.position&&310===m.position.paddingRight&&(m.position.paddingRight=275)}}return f},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(f){f.keepAppState=!0;return f},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(f){return f},compatible:!0},
{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(f){return f},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(f){return f},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(f){return f},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(f){function e(f,g){if(!f||!g)return!1;for(var l in g)if(g.hasOwnProperty(l))if("object"===typeof g[l]){if(!e(f[l],
g[l]))return!1}else if(f[l]!==g[l])return!1;return!0}function k(f){function g(){var c=e(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),d=e(f[12],{position:{top:10,right:195}});return c&&d}function l(){var c=e(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),d=e(f[12],{position:{left:15,top:233}});return c&&d}function d(){var c=e(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),d=e(f[12],{position:{right:15,top:195}});return c&&d}(function(){var c=
e(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),d=e(f[12],{position:{left:240,top:53}});return c&&d})()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):g()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):l()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):d()&&f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,
top:159},version:"2.3"})}function m(f){function g(){var d=e(f[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=e(f[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),g=e(f[4],{position:{left:7,bottom:70}});return d&&c&&g}function l(){var d=e(f[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=e(f[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),g=e(f[4],{position:{left:7,bottom:70}});return d&&c&&g}(function(){var d=e(f[9],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}}),c=e(f[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),g=e(f[4],{position:{left:55,top:45}});return d&&c&&g}()||g()||l())&&f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:148,left:7},version:"2.3"})}(function(f,g,p){f=f.theme&&f.theme.name;if("FoldableTheme"===f)if(e(g[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(e(g[11],
{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),p&&p.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:12,top:211},version:"2.3"});else{if(e(g[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(f=0;f<g.length;f++){var d=g[f];e(d,{uri:"widgets/Scalebar/Widget",
position:{left:220,bottom:5}})&&(d.position.left=288);e(d,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(d.position.left=463)}p&&p.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===f)k(g);else if("BoxTheme"===f)g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===f)m(g);else if("LaunchpadTheme"===f){if(e(g[6],{uri:"widgets/MyLocation/Widget",
position:{left:25,top:215}})||e(g[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),p&&p.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===f?(e(g[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),e(g[6],{uri:"widgets/MyLocation/Widget",
position:{left:12,bottom:164}})&&g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===f&&e(g[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&g.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(f,f.widgetOnScreen.widgets,f.mobileLayout&&f.mobileLayout.widgetOnScreen&&f.mobileLayout.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",
upgrader:function(f){return f},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(f){function e(f,m){if(!f||!m)return!1;for(var l in m)if(m.hasOwnProperty(l))if("object"===typeof m[l]){if(!e(f[l],m[l]))return!1}else if(f[l]!==m[l])return!1;return!0}(function(f,m){f=f.theme&&f.theme.name;if("BillboardTheme"===f){f=e(m[8],{position:{left:60,top:53}});var l=e(m[8],{position:{left:15,top:53}});f||l?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,
top:8},version:"2.5"}):m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"})}else if("BoxTheme"===f){a:{f=0;for(l=m.length;f<l;f++){var g=m[f];if(g&&g.uri&&"themes/BoxTheme/widgets/BoxController/Widget"===g.uri){f=g;break a}}f=null}e(f,{position:{right:0,bottom:0}})?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:8},version:"2.5"})}else"DartTheme"===
f?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"FoldableTheme"===f?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"DashboardTheme"===f?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"JewelryBoxTheme"===f?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"LaunchpadTheme"===f?m.push({uri:"widgets/FullScreen/Widget",visible:!1,
position:{right:70,top:20},version:"2.5"}):"PlateauTheme"===f?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"TabTheme"===f&&(e(m[7],{position:{left:45,top:45}})?m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):m.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"}))})(f,f.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",
upgrader:function(f){return f},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",upgrader:function(f){return f},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(f){function e(e){var f=[];if("object"===typeof e)for(var l in e){var g=e[l];"FeatureStatistics"===g.type&&f.push(g)}return f}(function(f){(f=f.dataSource&&f.dataSource.dataSources)&&(f=e(f))&&f.length&&f.forEach(function(e){(e=e.dataSchema&&e.dataSchema.statistics)&&e.length&&
e.forEach(function(e){if(e&&"count"===e.statisticType&&"count"===e.outStatisticFieldName)e.outStatisticFieldName="STAT_COUNT";else{var f;f=(f=e.outStatisticFieldName)&&f.toUpperCase();e.outStatisticFieldName=f}})})})(f);return f},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(f){return f},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(f){return f},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",
upgrader:function(f){return f},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(f){return f},compatible:!0},{version:"2.13",description:"The version for Online 7.2",upgrader:function(f){if(f.theme&&"PlateauTheme"===f.theme.name&&f.widgetOnScreen&&f.widgetOnScreen.widgets)for(var e=f.widgetOnScreen.widgets,k=0;k<e.length;k++)if("widgets/AttributeTable/Widget"===e[k].uri&&e[k].position){e[k].position.relativeTo="browser";break}return f},compatible:!0}];this.isCompatible=
function(f,e){f=this.getVersionIndex(f);e=this.getVersionIndex(e);for(f+=1;f<=e;f++)if(!1===this.versions[f].compatible)return!1;return!0}}k.prototype=new t;return k.prototype.constructor=k})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(t,f,k){f=this.getVersionIndex(f);k=this.getVersionIndex(k);if(f>k)throw Error("New version should higher than old version.");for(f+=1;f<=k;f++)this.versions[f].upgrader&&(t=this.versions[f].upgrader(t));
return t};this.getVersionIndex=function(t){t=this.fixVersion(t);var f,k;for(k=0;k<this.versions.length;k++)this.versions[k].version===t&&(f=k);null===t&&(f=-1);void 0===f&&(f=this.versions.length-1);return f};this.fixVersion=function(t){return t?t:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E){var C=null,A;A=t(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,b){this._removeHash(a);this.urlParams=a||{};this.widgetManager=d.getInstance();f.mixin(this,b)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(f.hitch(this,function(c){var d=this.checkConfig(c);if(d)throw Error(d);this.rawAppConfig=f.clone(c);u.getInstance().setRawAppConfig(this.rawAppConfig);
c=this._upgradeAppConfig(c);this._processAfterTryLoad(c);this.appConfig=c;if(this.urlParams.id)return this.loadWidgetsManifest(c).then(f.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(c)})).then(f.hitch(this,function(a){return this.updateNecessaryAttrOfResourceUrlInAppConfig(a,this.urlParams.id)})).then(f.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(c);this._readAndSetSharedTheme(c);return this.getAppConfig()}));n.setPortalUrl(c.portalUrl);E.arcgisUrl=a.getBaseItemUrl(c.portalUrl);
return this._proesssWebTierAndSignin(c).then(f.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var d=a.getStandardPortalUrl(c.portalUrl),d=b.getPortal(d);return p.checkEssentialAppsLicense(this.urlParams.appid,d,n.isInBuilderWindow()).then(f.hitch(this,function(){return this._getAppConfigFromTemplateAppId(c.portalUrl,this.urlParams.appid).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)}))}),f.hitch(this,
function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}return this._processNotInPortalAppProtocol(c).then(f.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(f.hitch(this,function(b){b.appData.appConfig&&(a=b.appData.appConfig);a._appData=b.appData;a.templateConfig=b.templateData;a.isTemplateApp=!0;return a}))}))}return this._processNotInPortalAppProtocol(c)})).then(f.hitch(this,function(a){this._processAfterTryLoad(a);
this.appConfig=a;return a.map.itemId?a:(a.map["3D"]?b.getDefaultWebScene(a.portalUrl):b.getDefaultWebMap(a.portalUrl)).then(function(b){a.map.itemId=b;return a})})).then(f.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(f.hitch(this,function(a){return a._appData?a._appData.values&&a._appData.values.webmap?b.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(f.hitch(this,function(b){return p.template.mergeTemplateAppConfigToAppConfig(a,a._appData,b)})):p.template.mergeTemplateAppConfigToAppConfig(a,
a._appData):a})).then(f.hitch(this,function(a){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?this.updateNecessaryAttrOfResourceUrlInAppConfig(a,a.appItemId):a})).then(f.hitch(this,function(a){this.appConfig=a;this._configLoaded=!0;this._setDocumentTitle(a);this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),f.hitch(this,
function(a){var b=new m;b.reject(a);return b}))},processResourceInAppConfigForConfigLoader:function(a,c){var d=a.portalUrl,e=a.appItemId,g=c.appid,n=new m,u=f.clone(a);this.updateNecessaryAttrOfResourceUrlInAppConfig(u,g).then(function(){if("config"===c.mode){var f=this.getResourceUrlsOfAppConfig(a).result;0!==f.length?b.getItemResources(d,g).then(function(a){if(0===a.length)return f=f.map(function(a){return{resUrl:a}}),h.AddResourcesToItemForAppSave(d,f,e,g).then(function(){n.resolve(u)},function(a){console.warn("Add resource to template based app error:"+
a.message||a);n.resolve(u)});n.resolve(u)},function(a){console.warn("Get resource of template based item error:"+a.message||a);n.resolve(u)}):n.resolve(u)}else n.resolve(u)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+a.message||a);n.resolve(u)});return n},getResourceUrlsOfAppConfig:function(a){var b={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)},func:f.hitch(this,function(a){return a.value})};
return p.processItemResourceOfAppConfig(a,b)},updateNecessaryAttrOfResourceUrlInAppConfig:function(a,c){function d(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)}function e(a,b){a=g.processItemIDAndTokenOfResources(b.value,a);a=g.setResouceProtocolForHttps(a);var c=b.obj,d=b.key;"number"===typeof b.i?c[d][b.i]=a:c[d]=a;return!0}var h=a.portalUrl,g=this;return b.getPortal(h).getItemById(c).then(f.hitch(this,function(b){b={test:d,func:f.hitch(this,e,
{appId:c,isPublic:"public"===b.access,portalUrl:h})};return p.processItemResourceOfAppConfig(a,b).appConfig}))},setResouceProtocolForHttps:function(a){var b=a;"https:"===window.location.protocol&&(b=a.replace(/^http(s?):\/\//i,"https://"));return b},processItemIDAndTokenOfResources:function(a,b){0<a.indexOf("${itemId}")&&(a=a.replace("${itemId}",b.appId));/(\?|\&)token=.+/.test(a)&&(a=a.replace(/(\?|\&)token=.+/,""));b.isPublic||(b=n.getPortalCredential(b.portalUrl))&&(a+="?token\x3d"+b.token);return a},
_setDocumentTitle:function(a){!window.isBuilder&&a&&a.title&&(document.title=p.stripHTML(a.title))},getAppConfig:function(){var a=f.clone(this.appConfig);a.getConfigElementById=function(a){return p.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return p.getConfigElementsByName(this,a)};a.visitElement=function(a){p.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,b){a&&a.authorizedCrossOriginDomains&&
n.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);b&&b.authorizedCrossOriginDomains&&n.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains)},checkConfig:function(){return!1},processProxy:function(a){x.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;x.defaults.io.proxyUrl="";x.defaults.io.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(x.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&
k.forEach(a.httpProxy.rules,function(a){z.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._processEmptyGroups(a);this._addElementId(a);this._fixRepeatedId(a)},showError:function(a){a&&a.message&&(q.create("div",{"class":"app-error",innerHTML:p.sanitizeHTML(a.message)},document.body),q.setStyle(jimuConfig.loadingId,"display","none"))},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);
if(this.urlParams.config)return this.configFile=this.urlParams.config,g(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(a){n.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?n.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var c=a.getPortalUrlFromLocation(),d=new m;n.setPortalUrl(c);window.portalUrl=c;E.arcgisUrl=a.getBaseItemUrl(c);
var e;this.urlParams.token?e=n.registerToken(this.urlParams.token):(e=new m,e.resolve());e.then(f.hitch(this,function(){var e=b.getPortal(c);e.loadSelfInfo().then(f.hitch(this,function(b){this.portalSelf=b;b.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=a.setHttpsProtocol(window.location.href),d.reject()):this._processSignIn(c).then(f.hitch(this,function(){this._getAppConfigFromAppId(c,this.urlParams.id).then(f.hitch(this,function(a){return p.checkEssentialAppsLicense(this.urlParams.id,
e,n.isInBuilderWindow()).then(f.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)}),f.hitch(this,function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(a){d.resolve(a)},function(a){d.reject(a)})}))}))}),f.hitch(this,function(a){this.showError(a)}));return d}this.configFile="config.json";return g(this.configFile,{handleAs:"json"}).then(f.hitch(this,function(a){n.setPortalUrl(a.portalUrl);
a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?n.registerToken(this.urlParams.token).then(function(){return a}):a}))},_upgradeAppConfig:function(a){var b=window.wabVersion,c=a.wabVersion;a.configWabVersion=a.wabVersion;if(b===c)return a;var d=this.versionManager.getVersionIndex(c),e=this.versionManager.getVersionIndex(b);if(d>e)throw Error("Bad version number, "+c);a=this.versionManager.upgrade(a,c,b);a.wabVersion=b;return a},loadAndUpgradeAllWidgetsConfig:function(a){var b=
new m,d=[];c.visitElement(a,f.hitch(this,function(a){a.uri&&(a=this.widgetManager.tryLoadWidgetConfig(a),d.push(a))}));l(d).then(f.hitch(this,function(){b.resolve(a)}),function(a){b.reject(a)});return b},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);v.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme||(a.theme.sharedTheme={useHeader:!1,useLogo:!1},
a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.isPortalSupport&&
this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(b){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var c=
a.getPortalUrlFromLocation(),c=a.getStandardPortalUrl(c);a.isOnline(c)&&(c=a.updateUrlProtocolByOtherUrl(c,b.portalUrl),b.map.portalUrl&&a.isSamePortalUrl(b.portalUrl,b.map.portalUrl)&&(b.map.portalUrl=c),b.portalUrl=c,b.httpProxy&&b.httpProxy.url&&(b.httpProxy.url=a.getPortalProxyUrl(c)))}},_processWidgetJsons:function(a){c.visitElement(a,function(a,b){b.isWidget&&a.uri&&p.widgetJson.processWidgetJson(a)})},_processNoUriWidgets:function(a){var b=0;c.visitElement(a,function(a,c){c.isWidget&&!a.uri&&
(b++,a.placeholderIndex=b)})},_processEmptyGroups:function(a){var b=0;a.widgetOnScreen.groups&&k.forEach(a.widgetOnScreen.groups,function(a){if(!a.widgets||a.widgets&&0===a.widgets.length)b++,a.placeholderIndex=b})},_addElementId:function(a){var b=0,d;c.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var c=a.id.lastIndexOf("_");-1<c&&(d=a.id.substr(c+1),b=Math.max(b,d))}});c.visitElement(a,function(a){a.id||(b++,a.id=a.itemId?a.itemId+"_"+b:a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+
b)})},_setPortalUrl:function(b){if(b.portalUrl){var c=a.getPortalUrlFromLocation(),d=a.isOnline(c);a.isSamePortalUrl(b.portalUrl,c)||d||(window.appInfo.isRunInPortal=!1)}else window.isXT&&r("wab_portalurl")?b.portalUrl=r("wab_portalurl"):(window.appInfo.isRunInPortal=!0,b.portalUrl=a.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(b,c){b.portalUrl=a.setProtocol(b.portalUrl,c);b.map.portalUrl&&(b.map.portalUrl=a.setProtocol(b.map.portalUrl,c));b.httpProxy&&(b.httpProxy.url=a.setProtocol(b.httpProxy.url,
c),b.httpProxy&&b.httpProxy.rules&&k.forEach(b.httpProxy.rules,f.hitch(this,function(b){b.proxyUrl=a.setProtocol(b.proxyUrl,c)})))},_processInPortalAppProtocol:function(c){var d=new m,e=b.getPortal(c.portalUrl),h=f.hitch(this,function(b){if("https:"===window.location.protocol)this._changePortalUrlProtocol(c,"https");else{if(b){console.log("redirect from http to https");window.location.href=a.setHttpsProtocol(window.location.href);d.reject();return}this._changePortalUrlProtocol(c,"http")}this._checkLocale();
d.resolve(c)});e.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;"private"===a.access?(a=0===c.portalUrl.toLowerCase().indexOf("https://"),h(a)):h(a.allSSL)}),f.hitch(this,function(a){d.reject(a)}));return d},_processNotInPortalAppProtocol:function(c){var d=new m;c.portalUrl?b.getPortal(c.portalUrl).loadSelfInfo().then(f.hitch(this,function(b){this.portalSelf=b;var e="https:"===window.location.protocol;(b.allSSL||e)&&this._changePortalUrlProtocol(c,"https");0!==c.portalUrl.toLowerCase().indexOf("https://")||
e||n.isInConfigOrPreviewWindow()?d.resolve(c):(console.log("redirect from http to https"),window.location.href=a.setHttpsProtocol(window.location.href),d.reject())}),f.hitch(this,function(a){d.reject(a)})):d.resolve(c);return d},_proesssWebTierAndSignin:function(a){var c=new m,d=!1,e=a.portalUrl;this._processWebTier(a).then(f.hitch(this,function(a){d=a;return b.getPortal(e).loadSelfInfo()})).then(f.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(e,d)})).then(f.hitch(this,function(){c.resolve()}),
function(a){c.reject(a)});return c},_processWebTier:function(b){var c=new m,d=b.portalUrl;b.isWebTier?(n.addAuthorizedCrossOriginDomains([d]),n.isWebTierPortal(d).then(f.hitch(this,function(){var e=n.getPortalCredential(d);e&&e.ssl&&"http:"===window.location.protocol&&!n.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=a.setHttpsProtocol(window.location.href)):c.resolve(b.isWebTier)}),f.hitch(this,function(a){c.reject(a)}))):c.resolve(!1);return c},_processSignIn:function(c,
d){var e=new m,h=b.getPortal(c),g=a.getSharingUrl(c);window.appInfo.isRunInPortal?(d=v.checkSignInStatus(g),d.promise.always(f.hitch(this,function(){e.resolve()}))):(!n.isInBuilderWindow()&&!n.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!d&&n.registerOAuthInfo(c,this.rawAppConfig.appId),d=v.checkSignInStatus(g),d.promise.always(f.hitch(this,function(){n.xtGetCredentialFromCookie(c);h.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=
a;this._checkLocale();e.resolve()}))})));return e},_checkLocale:function(){if(!n.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||e.locale,a=a.toLowerCase();!this.urlParams.locale&&p.isLocaleChanged(e.locale,a)&&(r("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,c){var d=b.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,c).then(f.hitch(this,function(b){var c=b.appId,e=b.appData;return l([this._getAppConfigFromAppId(a,
c),d.getItemData(e.source)]).then(f.hitch(this,function(a){var b;e.appConfig?(b=e.appConfig,delete e.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=e;b._wabAppId=c;b.templateConfig=a;b.isTemplateApp=!0;return b}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,c){var d=b.getPortal(a);return d.getItemData(c).then(function(a){return d.getItemData(a.source).then(function(b){return{appData:a,templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,c){var d=new m,
e=b.getPortal(a);e.getItemData(c).then(f.hitch(this,function(a){e.getItemById(a.source).then(f.hitch(this,function(b){b=z.urlToObject(b.url);d.resolve({appId:b.query.id,appData:a})}))}),function(a){d.reject(a)});return d},_getAppConfigFromAppId:function(a,c){return b.getPortal(a).getItemData(c)},_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(a){function d(c,d,f){function h(b){return c.loadWidgetManifest(b).then(function(a){return a},function(c){console.log("Widget failed to load, it is removed.",
b.name);c.stack?console.error(c.stack):console.log(c);e(a,b)})}return d.itemId?b.getPortal(f).getItemById(d.itemId).then(function(a){d.uri=p.widgetJson.getUriFromItem(a);return h(d)},function(b){console.log("Widget is not loaded, it is removed.",d.name,b);e(a,d)}):h(d)}function e(a,b){function c(c){a[c]&&a[c].widgets&&(a[c].widgets=a[c].widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));
a[c]&&a[c].groups&&a[c].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}c("widgetOnScreen");c("widgetPool")}var h=[],g=new m;this.urlParams.manifest&&a._buildInfo&&a._buildInfo.widgetManifestsMerged&&delete a._buildInfo.widgetManifestsMerged;a._buildInfo&&a._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(f.hitch(this,
function(b){c.visitElement(a,f.hitch(this,function(c){c.widgets||!c.uri&&!c.itemId||(c.uri&&b[c.uri]?(this._addNeedValuesForManifest(b[c.uri],c.uri),p.widgetJson.addManifest2WidgetJson(c,b[c.uri])):h.push(d(this.widgetManager,c,a.portalUrl)))}));l(h).then(function(){g.resolve(a)})})):(c.visitElement(a,f.hitch(this,function(b){b.widgets||!b.uri&&!b.itemId||h.push(d(this.widgetManager,b,a.portalUrl))})),l(h).then(function(){g.resolve(a)}));setTimeout(function(){g.isResolved()||(e(a),g.resolve(a))},
6E4);return g},_addNeedValuesForManifest:function(a,b){f.mixin(a,p.getUriInfo(b));p.manifest.addManifestProperies(a);p.manifest.processManifestLabel(a,e.locale)},_loadMergedWidgetManifests:function(){return g(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_fixRepeatedId:function(a){var b=[];c.visitElement(a,function(a){0<=b.indexOf(a.id)&&(a.id+="_");b.push(a.id)})},_processUrlParams:function(a){var b=this.urlParams.itemid||this.urlParams.webmap;b&&a.map.itemId!==b&&(a.map.mapOptions&&
p.deleteMapOptions(a.map.mapOptions),a.map.itemId=b);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});A.getInstance=function(a,b){null===C?C=new A(a,b):(C.urlParams=a||{},C.options=b);return C};return A})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all",
"jimu/portalUtils","jimu/utils"],function(t,f,k,q){return{AddResourcesToItemForAppSave:function(e,r,m,l){r=r||[];if(0===r.length){var g=new t;g.resolve(r);return g}r=r.map(function(e){var d=e.resUrl.split("resources/")[1],c=new t;e.b64?(e=q.b64toBlob(e.b64),c.resolve({blob:e,fileName:d.split("/")[1],prefixName:d.split("/")[0]})):(e=e.resUrl,0<e.indexOf("${itemId}")&&(e=e.replace("${itemId}",m)),q.resourcesUrlToBlob(e).then(function(e){c.resolve({blob:e,fileName:d.split("/")[1],prefixName:d.split("/")[0]},
function(b){console.error(b.message||b);c.reject(b)})}));return c});return f(r).then(function(g){if(g instanceof Array&&0<g.length)return g=g.map(function(d){var c=m;l&&(c=l);return k.addResource(e,c,d.blob,d.fileName,d.prefixName)}.bind(this)),f(g).then(function(d){return d})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(t,
f,k,q,e,r,m,l,g){var p=null,d=t(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(c){this.rawAppConfig=c},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var c=q.stringify(this.rawAppConfig.map);this.mapMd5=l(c)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var c=new k,d={};if(g.isInConfigOrPreviewWindow()||
!this.rawAppConfig||!this.rawAppConfig.map)return c.resolve(d),c;var b=this._getAppStateKey(),f=m.get(b);f&&f.appStateMd5===this._getAppStateMd5()?(b=f.map&&f.map.extent,f=f.map&&f.map.layers,b&&(d.extent=new e(b.xmin,b.ymin,b.xmax,b.ymax,new r(b.spatialReference))),f&&(d.layers=f)):m.remove(b);c.resolve(d);return c},saveWabAppState:function(c,d){if(c&&!g.isInConfigOrPreviewWindow()){var b=this._getAppStateKey(),e={extent:{xmin:c.extent.xmin,xmax:c.extent.xmax,ymin:c.extent.ymin,ymax:c.extent.ymax,
spatialReference:{wkid:c.extent.spatialReference.wkid,wkt:c.extent.spatialReference.wkt}},layers:{}};d&&d.traversal&&d.traversal(f.hitch(this,function(a){e.layers[a.id]={visible:a.isVisible()}}));m.set(b,{map:e,appStateMd5:this._getAppStateMd5()})}}});d.getInstance=function(c){null===p&&(p=new d);p.urlParams=c;return p};return d})},"libs/storejs/store":function(){!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):
("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).store=t()}(function(){return function f(k,q,e){function r(g,l){if(!q[g]){if(!k[g]){var d="function"==typeof require&&require;if(!l&&d)return d(g,!0);if(m)return m(g,!0);l=Error("Cannot find module '"+g+"'");throw l.code="MODULE_NOT_FOUND",l;}l=q[g]={exports:{}};k[g][0].call(l.exports,function(c){var d=k[g][1][c];return r(d?d:c)},l,l.exports,f,k,q,e)}return q[g].exports}for(var m="function"==typeof require&&
require,l=0;l<e.length;l++)r(e[l]);return r}({1:[function(f,k,q){q=f("../src/store-engine");var e=f("../storages/all");f=f("../plugins/all");k.exports=q.createStore(e,f)},{"../plugins/all":2,"../src/store-engine":15,"../storages/all":17}],2:[function(f,k,q){k.exports=[f("./defaults"),f("./dump"),f("./events"),f("./observe"),f("./expire"),f("./json2"),f("./operations"),f("./update"),f("./v1-backcompat")]},{"./compression":3,"./defaults":4,"./dump":5,"./events":6,"./expire":7,"./json2":8,"./observe":11,
"./operations":12,"./update":13,"./v1-backcompat":14}],3:[function(f,k,q){var e=f("./lib/lz-string");k.exports=function(){return{get:function(f,m){f=f(m);if(!f)return f;m=e.decompress(f);return null==m?f:this._deserialize(m)},set:function(f,m,l){l=e.compress(this._serialize(l));f(m,l)}}}},{"./lib/lz-string":10}],4:[function(f,k,q){k.exports=function(){var e={};return{defaults:function(f,m){e=m},get:function(f,m){f=f();return void 0!==f?f:e[m]}}}},{}],5:[function(f,k,q){k.exports=function(){return{dump:function(e){var f=
{};return this.each(function(e,l){f[l]=e}),f}}}},{}],6:[function(f,k,q){f=f("../src/util");var e=f.bind,r=f.each,m=f.create,l=f.slice;k.exports=function(){var f=m(g,{_id:0,_subSignals:{},_subCallbacks:{}});return{watch:function(d,c,g){return f.on(c,e(this,g))},unwatch:function(d,c){f.off(c)},once:function(d,c,g){f.once(c,e(this,g))},set:function(d,c,e){var b=this.get(c);d();f.fire(c,e,b)},remove:function(d,c){var e=this.get(c);d();f.fire(c,void 0,e)},clearAll:function(d){var c={};this.each(function(d,
b){c[b]=d});d();r(c,function(c,b){f.fire(b,void 0,c)})}}};var g={_id:null,_subCallbacks:null,_subSignals:null,on:function(e,d){return this._subCallbacks[e]||(this._subCallbacks[e]={}),this._id+=1,this._subCallbacks[e][this._id]=d,this._subSignals[this._id]=e,this._id},off:function(e){delete this._subCallbacks[this._subSignals[e]][e];delete this._subSignals[e]},once:function(f,d){var c=this.on(f,e(this,function(){d.apply(this,arguments);this.off(c)}))},fire:function(e){var d=l(arguments,1);r(this._subCallbacks[e],
function(c){c.apply(this,d)})}}},{"../src/util":16}],7:[function(f,k,q){k.exports=function(){function e(e){f.get(e,Number.MAX_VALUE)<=(new Date).getTime()&&(this.raw.remove(e),f.remove(e))}var f=this.createStore(this.storage,null,this._namespacePrefix+"expire_mixin");return{set:function(e,l,g,p){return this.hasNamespace("expire_mixin")||f.set(l,p),e()},get:function(f,l){return this.hasNamespace("expire_mixin")||e.call(this,l),f()},remove:function(e,l){return this.hasNamespace("expire_mixin")||f.remove(l),
e()},getExpiration:function(e,l){return f.get(l)},removeExpiredKeys:function(f){var l=[];this.each(function(e,f){l.push(f)});for(f=0;f<l.length;f++)e.call(this,l[f])}}}},{}],8:[function(f,k,q){k.exports=function(){return f("./lib/json2"),{}}},{"./lib/json2":9}],9:[function(f,k,q){var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"object"!==("undefined"==
typeof JSON?"undefined":e(JSON))&&(JSON={});(function(){function f(a){return 10>a?"0"+a:a}function m(){return this.valueOf()}function l(a){return b.lastIndex=0,b.test(a)?'"'+a.replace(b,function(a){var b=k[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function g(b,c){var d,f,h,n=a,p=c[b];switch(p&&"object"===("undefined"==typeof p?"undefined":e(p))&&"function"==typeof p.toJSON&&(p=p.toJSON(b)),"function"==typeof q&&(p=q.call(c,b,p)),"undefined"==
typeof p?"undefined":e(p)){case "string":return l(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);case "object":if(!p)return"null";if(a+=u,h=[],"[object Array]"===Object.prototype.toString.apply(p)){c=p.length;for(b=0;b<c;b+=1)h[b]=g(b,p)||"null";return f=0===h.length?"[]":a?"[\n"+a+h.join(",\n"+a)+"\n"+n+"]":"["+h.join(",")+"]",a=n,f}if(q&&"object"===("undefined"==typeof q?"undefined":e(q)))for(c=q.length,b=0;b<c;b+=1)"string"==typeof q[b]&&(d=q[b],
f=g(d,p),f&&h.push(l(d)+(a?": ":":")+f));else for(d in p)Object.prototype.hasOwnProperty.call(p,d)&&(f=g(d,p),f&&h.push(l(d)+(a?": ":":")+f));return f=0===h.length?"{}":a?"{\n"+a+h.join(",\n"+a)+"\n"+n+"}":"{"+h.join(",")+"}",a=n,f}}var p=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,c=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,n=/(?:^|:|,)(?:\s*\[)+/g,b=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=m,Number.prototype.toJSON=m,String.prototype.toJSON=m);var a,u,k,q;"function"!=typeof JSON.stringify&&
(k={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(b,c,d){var f;if(a="",u="","number"==typeof d)for(f=0;f<d;f+=1)u+=" ";else"string"==typeof d&&(u=d);if(q=c,c&&"function"!=typeof c&&("object"!==("undefined"==typeof c?"undefined":e(c))||"number"!=typeof c.length))throw Error("JSON.stringify");return g("",{"":b})});"function"!=typeof JSON.parse&&(JSON.parse=function(a,b){function f(a,c){var d,h,g=a[c];if(g&&"object"===("undefined"==typeof g?"undefined":
e(g)))for(d in g)Object.prototype.hasOwnProperty.call(g,d)&&(h=f(g,d),void 0!==h?g[d]=h:delete g[d]);return b.call(a,c,g)}var g;if(a=String(a),h.lastIndex=0,h.test(a)&&(a=a.replace(h,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),p.test(a.replace(d,"@").replace(c,"]").replace(n,"")))return g=eval("("+a+")"),"function"==typeof b?f({"":g},""):g;throw new SyntaxError("JSON.parse");})})()},{}],10:[function(f,k,q){f=function(){function e(e,f){if(!m[e]){m[e]={};for(var d=0;d<
e.length;d++)m[e][e.charAt(d)]=d}return m[e][f]}var f=String.fromCharCode,m={},l={compressToBase64:function(e){if(null==e)return"";e=l._compress(e,6,function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e)});switch(e.length%4){default:case 0:return e;case 1:return e+"\x3d\x3d\x3d";case 2:return e+"\x3d\x3d";case 3:return e+"\x3d"}},decompressFromBase64:function(f){return null==f?"":""==f?null:l._decompress(f.length,32,function(g){return e("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",
f.charAt(g))})},compressToUTF16:function(e){return null==e?"":l._compress(e,15,function(e){return f(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:l._decompress(e.length,16384,function(f){return e.charCodeAt(f)-32})},compressToUint8Array:function(e){e=l.compress(e);for(var f=new Uint8Array(2*e.length),d=0,c=e.length;d<c;d++){var g=e.charCodeAt(d);f[2*d]=g>>>8;f[2*d+1]=g%256}return f},decompressFromUint8Array:function(e){if(null===e||void 0===e)return l.decompress(e);for(var g=
Array(e.length/2),d=0,c=g.length;d<c;d++)g[d]=256*e[2*d]+e[2*d+1];var n=[];return g.forEach(function(b){n.push(f(b))}),l.decompress(n.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":l._compress(e,6,function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(e)})},decompressFromEncodedURIComponent:function(f){return null==f?"":""==f?null:(f=f.replace(/ /g,"+"),l._decompress(f.length,32,function(g){return e("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",
f.charAt(g))}))},compress:function(e){return l._compress(e,16,function(e){return f(e)})},_compress:function(e,f,d){if(null==e)return"";var c,g,b,h={},a={},u="",l="",p="",m=2,k=3,r=2,q=[],w=0,B=0;for(b=0;b<e.length;b+=1)if(u=e.charAt(b),Object.prototype.hasOwnProperty.call(h,u)||(h[u]=k++,a[u]=!0),l=p+u,Object.prototype.hasOwnProperty.call(h,l))p=l;else{if(Object.prototype.hasOwnProperty.call(a,p)){if(256>p.charCodeAt(0)){for(c=0;c<r;c++)w<<=1,B==f-1?(B=0,q.push(d(w)),w=0):B++;g=p.charCodeAt(0);for(c=
0;8>c;c++)w=w<<1|1&g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g>>=1}else{g=1;for(c=0;c<r;c++)w=w<<1|g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g=0;g=p.charCodeAt(0);for(c=0;16>c;c++)w=w<<1|1&g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g>>=1}m--;0==m&&(m=Math.pow(2,r),r++);delete a[p]}else for(g=h[p],c=0;c<r;c++)w=w<<1|1&g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g>>=1;m--;0==m&&(m=Math.pow(2,r),r++);h[l]=k++;p=String(u)}if(""!==p){if(Object.prototype.hasOwnProperty.call(a,p)){if(256>p.charCodeAt(0)){for(c=0;c<r;c++)w<<=1,B==
f-1?(B=0,q.push(d(w)),w=0):B++;g=p.charCodeAt(0);for(c=0;8>c;c++)w=w<<1|1&g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g>>=1}else{g=1;for(c=0;c<r;c++)w=w<<1|g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g=0;g=p.charCodeAt(0);for(c=0;16>c;c++)w=w<<1|1&g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g>>=1}m--;0==m&&(m=Math.pow(2,r),r++);delete a[p]}else for(g=h[p],c=0;c<r;c++)w=w<<1|1&g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g>>=1;m--;0==m&&(m=Math.pow(2,r),r++)}g=2;for(c=0;c<r;c++)w=w<<1|1&g,B==f-1?(B=0,q.push(d(w)),w=0):B++,g>>=1;for(;;){if(w<<=
1,B==f-1){q.push(d(w));break}B++}return q.join("")},decompress:function(e){return null==e?"":""==e?null:l._decompress(e.length,32768,function(f){return e.charCodeAt(f)})},_decompress:function(e,l,d){var c,g,b,h,a,u,m=[],p=4,k=4,r=3;g="";var q=[],A=d(0),w=l,B=1;for(c=0;3>c;c+=1)m[c]=c;g=0;h=Math.pow(2,2);for(a=1;a!=h;)b=A&w,w>>=1,0==w&&(w=l,A=d(B++)),g|=(0<b?1:0)*a,a<<=1;switch(g){case 0:g=0;h=Math.pow(2,8);for(a=1;a!=h;)b=A&w,w>>=1,0==w&&(w=l,A=d(B++)),g|=(0<b?1:0)*a,a<<=1;u=f(g);break;case 1:g=0;
h=Math.pow(2,16);for(a=1;a!=h;)b=A&w,w>>=1,0==w&&(w=l,A=d(B++)),g|=(0<b?1:0)*a,a<<=1;u=f(g);break;case 2:return""}c=m[3]=u;for(q.push(u);;){if(B>e)return"";g=0;h=Math.pow(2,r);for(a=1;a!=h;)b=A&w,w>>=1,0==w&&(w=l,A=d(B++)),g|=(0<b?1:0)*a,a<<=1;switch(u=g){case 0:g=0;h=Math.pow(2,8);for(a=1;a!=h;)b=A&w,w>>=1,0==w&&(w=l,A=d(B++)),g|=(0<b?1:0)*a,a<<=1;m[k++]=f(g);u=k-1;p--;break;case 1:g=0;h=Math.pow(2,16);for(a=1;a!=h;)b=A&w,w>>=1,0==w&&(w=l,A=d(B++)),g|=(0<b?1:0)*a,a<<=1;m[k++]=f(g);u=k-1;p--;break;
case 2:return q.join("")}if(0==p&&(p=Math.pow(2,r),r++),m[u])g=m[u];else{if(u!==k)return null;g=c+c.charAt(0)}q.push(g);m[k++]=c+g.charAt(0);p--;c=g;0==p&&(p=Math.pow(2,r),r++)}}};return l}();"undefined"!=typeof k&&null!=k&&(k.exports=f)},{}],11:[function(f,k,q){f=f("./events");k.exports=[f,function(){return{observe:function(e,f,m){e=this.watch(f,m);return m(this.get(f)),e},unobserve:function(e,f){this.unwatch(f)}}}]},{"./events":6}],12:[function(f,k,q){var e="function"==typeof Symbol&&"symbol"==
typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};q=f("../src/util");var r=q.slice,m=q.assign;f=f("./update");k.exports=[f,function(){function f(e,f){var d,c=f[1],g=r(f,2);return this.update(c,[],function(b){d=Array.prototype[e].apply(b,g)}),d}return{push:function(e,l,d,c,n,b){return f.call(this,"push",arguments)},pop:function(e,l){return f.call(this,"pop",arguments)},shift:function(e,
l){return f.call(this,"shift",arguments)},unshift:function(e,l,d,c,n,b){return f.call(this,"unshift",arguments)},assign:function(f,l,d,c,n,b){var h=r(arguments,2);return this.update(l,{},function(a){if("object"!=("undefined"==typeof a?"undefined":e(a)))throw Error('store.assign called for non-object value with key "'+l+'"');return h.unshift(a),m.apply(Object,h)})}}}]},{"../src/util":16,"./update":13}],13:[function(f,k,q){k.exports=function(){return{update:function(e,f,m,l){3==arguments.length&&(l=
m,m=void 0);var g=this.get(f,m),p=l(g);this.set(f,void 0!=p?p:g)}}}},{}],14:[function(f,k,q){function e(c,d){return void 0!==this.get(d)}function r(c,d,b,e){null==e&&(e=b,b=null);null==b&&(b={});c=this.get(d,b);e=e(c);this.set(d,void 0===e?c:e)}function m(c){return this.clearAll.call(this)}function l(c,d){return this.each.call(this,function(b,c){d(c,b)})}function g(c){return this.dump.call(this)}function p(c,d){return JSON.stringify(d)}function d(c,d){if("string"==typeof d)try{return JSON.parse(d)}catch(b){return d||
void 0}}q=f("./dump");f=f("./json2");k.exports=[q,f,function(){return this.disabled=!this.enabled,{has:e,transact:r,clear:m,forEach:l,getAll:g,serialize:p,deserialize:d}}]},{"./dump":5,"./json2":8}],15:[function(f,k,q){function e(){var a="undefined"==typeof console?null:console;a&&(a.warn?a.warn:a.log).apply(a,arguments)}function r(a,f,k){k||(k="");a&&!c(a)&&(a=[a]);f&&!c(f)&&(f=[f]);var u=k?"__storejs_"+k+"_":"",r=k?new RegExp("^"+u):null;if(!/^[a-zA-Z0-9_\-]*$/.test(k))throw Error("store.js namespaces can only have alphanumerics + underscores and dashes");
var q=d({_namespacePrefix:u,_namespaceRegexp:r,_testStorage:function(a){try{a.write("__storejs__test__","__storejs__test__");var b="__storejs__test__"===a.read("__storejs__test__");return a.remove("__storejs__test__"),b}catch(w){return!1}},_assignPluginFnProp:function(a,b){var c=this[b];this[b]=function(){var b=m(arguments,0),d=this,e=[function(){if(c)return g(arguments,function(a,c){b[c]=a}),c.apply(d,b)}].concat(b);return a.apply(d,e)}},_serialize:function(a){return JSON.stringify(a)},_deserialize:function(a,
b){if(!a)return b;var c="";try{c=JSON.parse(a)}catch(B){c=a}return void 0!==c?c:b},_addStorage:function(a){this.enabled||this._testStorage(a)&&(this.storage=a,this.enabled=!0)},_addPlugin:function(a){var d=this;if(c(a))return void g(a,function(a){d._addPlugin(a)});if(!l(this.plugins,function(b){return a===b})){if(this.plugins.push(a),!n(a))throw Error("Plugins must be function values that return objects");var e=a.call(this);if(!b(e))throw Error("Plugins must return an object of function properties");
g(e,function(b,c){if(!n(b))throw Error("Bad plugin property: "+c+" from plugin "+a.name+". Plugins should only return functions.");d._assignPluginFnProp(b,c)})}},addStorage:function(a){e("store.addStorage(storage) is deprecated. Use createStore([storages])");this._addStorage(a)}},h,{plugins:[]});return q.raw={},g(q,function(a,b){n(a)&&(q.raw[b]=p(q,a))}),g(a,function(a){q._addStorage(a)}),g(f,function(a){q._addPlugin(a)}),q}f=f("./util");var m=f.slice,l=f.pluck,g=f.each,p=f.bind,d=f.create,c=f.isList,
n=f.isFunction,b=f.isObject;k.exports={createStore:r};var h={version:"2.0.12",enabled:!1,get:function(a,b){a=this.storage.read(this._namespacePrefix+a);return this._deserialize(a,b)},set:function(a,b){return void 0===b?this.remove(a):(this.storage.write(this._namespacePrefix+a,this._serialize(b)),b)},remove:function(a){this.storage.remove(this._namespacePrefix+a)},each:function(a){var b=this;this.storage.each(function(c,d){a.call(b,b._deserialize(c),(d||"").replace(b._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},
hasNamespace:function(a){return this._namespacePrefix=="__storejs_"+a+"_"},createStore:function(){return r.apply(this,arguments)},addPlugin:function(a){this._addPlugin(a)},namespace:function(a){return r(this.storage,this.plugins,a)}}},{"./util":16}],16:[function(f,k,q){(function(e){function f(c,b){return Array.prototype.slice.call(c,b||0)}function m(c,b){l(c,function(c,a){return b(c,a),!1})}function l(c,b){if(g(c))for(var d=0;d<c.length;d++){if(b(c[d],d))return c[d]}else for(d in c)if(c.hasOwnProperty(d)&&
b(c[d],d))return c[d]}function g(c){return null!=c&&"function"!=typeof c&&"number"==typeof c.length}var p=function(){return Object.assign?Object.assign:function(c,b,d,a){for(var e=1;e<arguments.length;e++)m(Object(arguments[e]),function(a,b){c[b]=a});return c}}(),d=function(){if(Object.create)return function(b,c,a,d){var e=f(arguments,1);return p.apply(this,[Object.create(b)].concat(e))};var c=function(){};return function(b,d,a,e){var h=f(arguments,1);return c.prototype=b,p.apply(this,[new c].concat(h))}}(),
c=function(){return String.prototype.trim?function(c){return String.prototype.trim.call(c)}:function(c){return c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}();k.exports={assign:p,create:d,trim:c,bind:function(c,b){return function(){return b.apply(c,Array.prototype.slice.call(arguments,0))}},slice:f,each:m,map:function(c,b){var d=g(c)?[]:{};return l(c,function(a,c){return d[c]=b(a,c),!1}),d},pluck:l,isList:g,isFunction:function(c){return c&&"[object Function]"==={}.toString.call(c)},isObject:function(c){return c&&
"[object Object]"==={}.toString.call(c)},Global:"undefined"!=typeof window?window:e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(f,k,q){k.exports=[f("./localStorage"),f("./oldFF-globalStorage"),f("./oldIE-userDataStorage"),f("./cookieStorage"),f("./sessionStorage"),f("./memoryStorage")]},{"./cookieStorage":18,"./localStorage":19,"./memoryStorage":20,"./oldFF-globalStorage":21,"./oldIE-userDataStorage":22,"./sessionStorage":23}],
18:[function(f,k,q){function e(e){for(var d=g.cookie.split(/; ?/g),c=d.length-1;0<=c;c--)if(l(d[c])){var f=d[c].split("\x3d"),b=unescape(f[0]),f=unescape(f[1]);e(f,b)}}function r(e){e&&m(e)&&(g.cookie=escape(e)+"\x3d; expires\x3dThu, 01 Jan 1970 00:00:00 GMT; path\x3d/")}function m(e){return(new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d")).test(g.cookie)}f=f("../src/util");q=f.Global;var l=f.trim;k.exports={name:"cookieStorage",read:function(e){if(!e||!m(e))return null;
e="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d\\s*((?:[^;](?!;))*[^;]?).*";return unescape(g.cookie.replace(new RegExp(e),"$1"))},write:function(e,d){e&&(g.cookie=escape(e)+"\x3d"+escape(d)+"; expires\x3dTue, 19 Jan 2038 03:14:07 GMT; path\x3d/")},each:e,remove:r,clearAll:function(){e(function(e,d){r(d)})}};var g=q.document},{"../src/util":16}],19:[function(f,k,q){function e(e){return r.localStorage.getItem(e)}var r=f("../src/util").Global;k.exports={name:"localStorage",
read:e,write:function(e,f){return r.localStorage.setItem(e,f)},each:function(f){for(var l=r.localStorage.length-1;0<=l;l--){var g=r.localStorage.key(l);f(e(g),g)}},remove:function(e){return r.localStorage.removeItem(e)},clearAll:function(){return r.localStorage.clear()}}},{"../src/util":16}],20:[function(f,k,q){k.exports={name:"memoryStorage",read:function(f){return e[f]},write:function(f,m){e[f]=m},each:function(f){for(var m in e)e.hasOwnProperty(m)&&f(e[m],m)},remove:function(f){delete e[f]},clearAll:function(f){e=
{}}};var e={}},{}],21:[function(f,k,q){function e(e){for(var f=r.length-1;0<=f;f--){var g=r.key(f);e(r[g],g)}}f=f("../src/util").Global;k.exports={name:"oldFF-globalStorage",read:function(e){return r[e]},write:function(e,f){r[e]=f},each:e,remove:function(e){return r.removeItem(e)},clearAll:function(){e(function(e,f){delete r[e]})}};var r=f.globalStorage},{"../src/util":16}],22:[function(f,k,q){function e(d){return d.replace(/^\d/,"___$\x26").replace(p,"___")}f=f("../src/util").Global;k.exports={name:"oldIE-userDataStorage",
write:function(d,c){if(!g){var f=e(d);l(function(b){b.setAttribute(f,c);b.save(r)})}},read:function(d){if(!g){var c=e(d),f=null;return l(function(b){f=b.getAttribute(c)}),f}},each:function(d){l(function(c){for(var e=c.XMLDocument.documentElement.attributes,b=e.length-1;0<=b;b--){var f=e[b];d(c.getAttribute(f.name),f.name)}})},remove:function(d){var c=e(d);l(function(d){d.removeAttribute(c);d.save(r)})},clearAll:function(){l(function(d){var c=d.XMLDocument.documentElement.attributes;d.load(r);for(var e=
c.length-1;0<=e;e--)d.removeAttribute(c[e].name);d.save(r)})}};var r="storejs",m=f.document,l=function(){if(!m||!m.documentElement||!m.documentElement.addBehavior)return null;var d,c,e;try{c=new ActiveXObject("htmlfile"),c.open(),c.write('\x3cscript\x3edocument.w\x3dwindow\x3c/script\x3e\x3ciframe src\x3d"/favicon.ico"\x3e\x3c/iframe\x3e'),c.close(),d=c.w.frames[0].document,e=d.createElement("div")}catch(b){e=m.createElement("div"),d=m.body}return function(b){var c=[].slice.call(arguments,0);c.unshift(e);
d.appendChild(e);e.addBehavior("#default#userData");e.load(r);b.apply(this,c);d.removeChild(e)}}(),g=(f.navigator?f.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),p=/[!"#$%&'()*+,/\\:;<=>?@[\]^`{|}~]/g},{"../src/util":16}],23:[function(f,k,q){function e(e){return r.sessionStorage.getItem(e)}var r=f("../src/util").Global;k.exports={name:"sessionStorage",read:e,write:function(e,f){return r.sessionStorage.setItem(e,f)},each:function(f){for(var l=r.sessionStorage.length-1;0<=l;l--){var g=
r.sessionStorage.key(l);f(e(g),g)}},remove:function(e){return r.sessionStorage.removeItem(e)},clearAll:function(){return r.sessionStorage.clear()}}},{"../src/util":16}]},{},[1])(1)})},"libs/md5/md5":function(){(function(t){function f(b,c){var a=(b&65535)+(c&65535);return(b>>16)+(c>>16)+(a>>16)<<16|a&65535}function k(b,c,a,d,e,g){b=f(f(c,b),f(d,g));return f(b<<e|b>>>32-e,a)}function q(b,c,a,d,e,f,g){return k(c&a|~c&d,b,c,e,f,g)}function e(b,c,a,d,e,f,g){return k(c&d|a&~d,b,c,e,f,g)}function r(b,c,
a,d,e,f,g){return k(a^(c|~d),b,c,e,f,g)}function m(b,c){b[c>>5]|=128<<c%32;b[(c+64>>>9<<4)+14]=c;var a,d,g,h,n=1732584193,l=-271733879,m=-1732584194,p=271733878;for(c=0;c<b.length;c+=16)a=n,d=l,g=m,h=p,n=q(n,l,m,p,b[c],7,-680876936),p=q(p,n,l,m,b[c+1],12,-389564586),m=q(m,p,n,l,b[c+2],17,606105819),l=q(l,m,p,n,b[c+3],22,-1044525330),n=q(n,l,m,p,b[c+4],7,-176418897),p=q(p,n,l,m,b[c+5],12,1200080426),m=q(m,p,n,l,b[c+6],17,-1473231341),l=q(l,m,p,n,b[c+7],22,-45705983),n=q(n,l,m,p,b[c+8],7,1770035416),
p=q(p,n,l,m,b[c+9],12,-1958414417),m=q(m,p,n,l,b[c+10],17,-42063),l=q(l,m,p,n,b[c+11],22,-1990404162),n=q(n,l,m,p,b[c+12],7,1804603682),p=q(p,n,l,m,b[c+13],12,-40341101),m=q(m,p,n,l,b[c+14],17,-1502002290),l=q(l,m,p,n,b[c+15],22,1236535329),n=e(n,l,m,p,b[c+1],5,-165796510),p=e(p,n,l,m,b[c+6],9,-1069501632),m=e(m,p,n,l,b[c+11],14,643717713),l=e(l,m,p,n,b[c],20,-373897302),n=e(n,l,m,p,b[c+5],5,-701558691),p=e(p,n,l,m,b[c+10],9,38016083),m=e(m,p,n,l,b[c+15],14,-660478335),l=e(l,m,p,n,b[c+4],20,-405537848),
n=e(n,l,m,p,b[c+9],5,568446438),p=e(p,n,l,m,b[c+14],9,-1019803690),m=e(m,p,n,l,b[c+3],14,-187363961),l=e(l,m,p,n,b[c+8],20,1163531501),n=e(n,l,m,p,b[c+13],5,-1444681467),p=e(p,n,l,m,b[c+2],9,-51403784),m=e(m,p,n,l,b[c+7],14,1735328473),l=e(l,m,p,n,b[c+12],20,-1926607734),n=k(l^m^p,n,l,b[c+5],4,-378558),p=k(n^l^m,p,n,b[c+8],11,-2022574463),m=k(p^n^l,m,p,b[c+11],16,1839030562),l=k(m^p^n,l,m,b[c+14],23,-35309556),n=k(l^m^p,n,l,b[c+1],4,-1530992060),p=k(n^l^m,p,n,b[c+4],11,1272893353),m=k(p^n^l,m,p,b[c+
7],16,-155497632),l=k(m^p^n,l,m,b[c+10],23,-1094730640),n=k(l^m^p,n,l,b[c+13],4,681279174),p=k(n^l^m,p,n,b[c],11,-358537222),m=k(p^n^l,m,p,b[c+3],16,-722521979),l=k(m^p^n,l,m,b[c+6],23,76029189),n=k(l^m^p,n,l,b[c+9],4,-640364487),p=k(n^l^m,p,n,b[c+12],11,-421815835),m=k(p^n^l,m,p,b[c+15],16,530742520),l=k(m^p^n,l,m,b[c+2],23,-995338651),n=r(n,l,m,p,b[c],6,-198630844),p=r(p,n,l,m,b[c+7],10,1126891415),m=r(m,p,n,l,b[c+14],15,-1416354905),l=r(l,m,p,n,b[c+5],21,-57434055),n=r(n,l,m,p,b[c+12],6,1700485571),
p=r(p,n,l,m,b[c+3],10,-1894986606),m=r(m,p,n,l,b[c+10],15,-1051523),l=r(l,m,p,n,b[c+1],21,-2054922799),n=r(n,l,m,p,b[c+8],6,1873313359),p=r(p,n,l,m,b[c+15],10,-30611744),m=r(m,p,n,l,b[c+6],15,-1560198380),l=r(l,m,p,n,b[c+13],21,1309151649),n=r(n,l,m,p,b[c+4],6,-145523070),p=r(p,n,l,m,b[c+11],10,-1120210379),m=r(m,p,n,l,b[c+2],15,718787259),l=r(l,m,p,n,b[c+9],21,-343485551),n=f(n,a),l=f(l,d),m=f(m,g),p=f(p,h);return[n,l,m,p]}function l(b){var c,a="";for(c=0;c<32*b.length;c+=8)a+=String.fromCharCode(b[c>>
5]>>>c%32&255);return a}function g(b){var c,a=[];a[(b.length>>2)-1]=void 0;for(c=0;c<a.length;c+=1)a[c]=0;for(c=0;c<8*b.length;c+=8)a[c>>5]|=(b.charCodeAt(c/8)&255)<<c%32;return a}function p(b){return l(m(g(b),8*b.length))}function d(b,c){var a=g(b),d=[],e=[];d[15]=e[15]=void 0;16<a.length&&(a=m(a,8*b.length));for(b=0;16>b;b+=1)d[b]=a[b]^909522486,e[b]=a[b]^1549556828;c=m(d.concat(g(c)),512+8*c.length);return l(m(e.concat(c),640))}function c(b){var c="",a,d;for(d=0;d<b.length;d+=1)a=b.charCodeAt(d),
c+="0123456789abcdef".charAt(a>>>4&15)+"0123456789abcdef".charAt(a&15);return c}function n(b,e,a){e?a?b=d(unescape(encodeURIComponent(e)),unescape(encodeURIComponent(b))):(b=d(unescape(encodeURIComponent(e)),unescape(encodeURIComponent(b))),b=c(b)):b=a?p(unescape(encodeURIComponent(b))):c(p(unescape(encodeURIComponent(b))));return b}"function"===typeof define&&define.amd?define(function(){return n}):t.md5=n})(this)},"jimu/dijit/AGOLLoading":function(){define(["dojo/_base/declare","dijit/_WidgetBase",
"dijit/_TemplatedMixin","dojo/text!./templates/AGOLLoading.html","dojo/_base/html"],function(t,f,k,q,e){return t([f,k],{baseClass:"jimu-agol-loading",declaredClass:"jimu.dijit.AGOLLoading",templateString:q,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&e.setStyle(this.domNode,"display","none");e.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||e.setStyle(this.imgDiv,
"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),e.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(e.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n){var b=null,h;h=t([q],{constructor:function(a,b){this.own(e.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)));this.own(e.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this.own(e.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)));this.own(e.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));this.own(e.subscribe("beforeMapDestory",f.hitch(this,this._onBeforeMapDestory)));this.own(e.subscribe("preloadModulesLoaded",
f.hitch(this,this._onPreloadModulesLoaded)));this.own(e.subscribe("openWidget",f.hitch(this,this._onOpenWidgetRequest)));this.own(e.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered)));n.isMobileUa()||this.own(r(window,"resize",p(f.hitch(this,this.resize),200)));this.id=b;this.preloadModulesLoadDef=new l},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",mapDiv:null,hlDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},
_onAppConfigLoaded:function(a){this.appConfig=f.clone(a);this.preloadModulesLoadDef.then(f.hitch(this,function(){this._loadLayoutManager(this.appConfig).then(f.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId).then(f.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadingAnim();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:
"jimu/layoutManagers/AbsolutePositionLayoutManager";var b=new l;d([a],f.hitch(this,function(a){a=a.getInstance();this.map&&a.setMap(this.map);b.resolve(a)}));return b},_loadingAnim:function(){window.isXT&&"config"===this.appConfig.mode||(k.addClass(jimuConfig.loadingId,"loading-fadeOut"),this.own(r(document.getElementById(jimuConfig.loadingId),"animationend",f.hitch(this,function(){k.setStyle(jimuConfig.loadingId,"display","none")}))))},_loadMap:function(a){this.mapManager=c.getInstance({appConfig:this.appConfig,
urlParams:this.urlParams},a);this.mapManager.showMap();this._lazyLoadResources()},_lazyLoadResources:function(){jimuConfig.lazyLoadCss&&d(jimuConfig.lazyLoadCss);d(["dynamic-modules/commonResources"])},_onMapLoaded:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},_loadTheme:function(a){var b=new l;d(["themes/"+a.name+"/main"],f.hitch(this,function(){g([this._loadThemeCommonStyle(a),
this._loadThemeCurrentStyle(a)]).then(f.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();b.resolve()}))}));return b},_loadThemeCommonStyle:function(a){k.addClass(this.domNode,a.name);return n.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){k.addClass(this.domNode,a.styles[0]);return n.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var b=
f.getObject("customStyles",!1,a);if(b){var c=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(c+=a);c=f.replace(c,b,/\$\{([^\}]+)\}/g);b=k.create("style",{type:"text/css"});try{b.appendChild(document.createTextNode(c))}catch(x){b.styleSheet.cssText=c}b.setAttribute("source","custom");document.head.appendChild(b)}},_getFixedThemeStyles:function(a){var b=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";if(a.customStyles.mainBackgroundColor&&
n.isLightColor(a.customStyles.mainBackgroundColor))var c=d.toUrl("jimu")+"/css/images/api_popup_light.png",b=b+(".esriPopup .titleButton {background: url("+c+") no-repeat}")+".esriPopup .titlePane {color: black}";"PlateauTheme"===a.name?b+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .jimu-widget-mylocation .place-holder.nohttps:hover, .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover, .jimu-widget-onscreen-icon:hover, .jimu-widget-onscreen-icon.jimu-state-selected{opacity: 1;}":
"BoxTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-main-background.jimu-widget-zoomslider{background-color: transparent !important}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-zoomslider .zoom:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover{background-color: ${mainBackgroundColor} !important; opacity: 1;}":
"TabTheme"===a.name?b+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DashboardTheme"===a.name?b+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name?b+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{color: ${mainBackgroundColor} !important; opacity: 0.6;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation:hover{color: ${mainBackgroundColor} !important; opacity: 1;}":
"PocketTheme"===a.name&&(b+=".jimu-main-background, .jimu-widget-homebutton, .jimu-widget-mylocation, .jimu-widget-onscreen-icon, .jimu-widget-onscreen-icon.jimu-state-selected, .jimu-widget-zoomslider .zoom, .jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .esriPopup .titlePane, .esriPopupMobile .titlePane, .esriPopup .pointer.top{background-color: ${mainBackgroundColor} !important;}.esriMobileNavigationBar{background-color: ${mainBackgroundColor} !important; background-image: none !important;}");
return b},_onAppConfigChanged:function(a,b,c){a=f.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,c);break;case "groupChange":this._onGroupChange(a,c);break;case "widgetPoolChange":this._onWidgetPoolChange(a,c);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,c);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,
c);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,c);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,c)}this.appConfig=a},_onMapChanged:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeMapDestory:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);
this._removeCustomStyle();g([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(f.hitch(this,function(b){var c=b[0];this.layoutManager.name!==c.name?(this.layoutManager.onLeave(),c.onEnter(a,this.mapId).then(f.hitch(this,function(){this.layoutManager=c;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var b=this.appConfig;e.publish("appConfigChanged",a,"mapChange",a);this.appConfig=b;this._loadLayoutManager(a).then(f.hitch(this,function(a){this.layoutManager=
a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,b){"backgroundColor"in b?k.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in b?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(k.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),k.setStyle(jimuConfig.loadingImageId,"width",
a.width+"px"),k.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(k.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),k.setStyle(jimuConfig.loadingImageId,"width","0px"),k.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in b&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(k.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),k.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),k.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):
(k.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),k.setStyle(jimuConfig.loadingGifId,"width","0px"),k.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_onWidgetChange:function(a,b){this.layoutManager.onWidgetChange(a,b)},_onGroupChange:function(a,
b){this.layoutManager.onGroupChange(a,b)},_onWidgetPoolChange:function(a,b){this.layoutManager.onWidgetPoolChange(a,b)},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onLayoutDefinitionChange:function(a,b){this.layoutManager.onLayoutDefinitionChange(a,b)},_onOnScreenGroupsChange:function(a,b){this.layoutManager.onOnScreenGroupsChange(a,b)},_onOnScreenOrderChange:function(a,b){this.layoutManager.onOnScreenOrderChange(a,b)},_removeThemeCommonStyle:function(a){k.removeClass(this.domNode,
a.name);k.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){k.removeClass(this.domNode,a.styles[0]);k.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){m('style[source\x3d"custom"]',document.head).forEach(function(a){k.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){d(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});
h.getInstance=function(a,c){null===b&&(b=new h(a,c),window._layoutManager=b);return b};return h})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point require ./utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w,B,F,D){var G=null,H=t(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,b){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=b;this.appStateManager=B.getInstance(this.urlParams);this.popupManager=F.getInstance(this);this.filterManager=D.getInstance();this.nls=window.jimuNls;r.subscribe("appConfigChanged",f.hitch(this,
this.onAppConfigChanged));r.subscribe("syncExtent",f.hitch(this,this.onSyncExtent));r.subscribe("mapContentModified",f.hitch(this,this.onMapContentModified));m(window,"resize",f.hitch(this,this.onWindowResize));m(window,"unload",f.hitch(this,this.onUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},
onUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&(this._mapMobileInfoWindow.destroy(),e("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(a){q.destroy(a)}),
e("div.esriMobileNavigationBar").forEach(function(a){q.destroy(a)})),this._mapMobileInfoWindow=new n(null,q.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);z.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!z.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onSyncExtent:function(a){this.map&&
(a=new u(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,b){k.forEach(a.map.basemaps,function(a,c){a.isOperationalLayer=!1;b(a,c)},this);k.forEach(a.map.operationallayers,function(a,c){a.isOperationalLayer=!0;b(a,c)},this)},_show3DLayersMap:function(a){x(["esri3d/Map"],f.hitch(this,function(b){var c;c=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,f.hitch(this,function(a){this.createLayer(c,"3D",a)}));c.usePlugin=b.usePlugin;this._publishMapEvent(c)}))},
_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(f.hitch(this,function(b){x(["esri3d/Map"],f.hitch(this,function(c){var d=new c(this.mapDivId,a.map.mapOptions);k.forEach(b.itemData.operationalLayers,function(a){this.createLayer(d,"3D",a)},this);k.forEach(b.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(d,"3D",a)},this);k.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(d,"3D",a)},this);d.toc=b.itemData.toc;d.bookmarks=
b.itemData.bookmarks;d.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;w.postProcessUrlParams(this.urlParams,a);console.timeEnd("Load Map");this.map?(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),r.publish("mapChanged",this.map,this.layerInfosObj)):(this.map=a,this.resetInfoWindow(!0),r.publish("mapLoaded",this.map,this.layerInfosObj))},_getWebsceneData:function(a){return h({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},
_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var b=this._processMapOptions(a.map.mapOptions)||{};b.isZoomSlider=!1;var c=a.map.portalUrl,d=a.map.itemId,b={mapOptions:b,bingMapsKey:a.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!a.mode&&a.map.appProxy&&a.map.appProxy.mapItemId===a.map.itemId){var e=[];k.forEach(a.map.appProxy.proxyItems,function(a){a.useProxy&&a.proxyUrl&&e.push({url:a.sourceUrl,mixin:{url:a.proxyUrl}})});0<e.length&&(b.layerMixins=e)}this._createWebMapRaw(c,
d,this.mapDivId,b).then(f.hitch(this,function(b){var c=b.map;c.hideZoomSlider();c.infoWindow.resize(270,316);c.itemId=a.map.itemId;c.itemInfo=b.itemInfo;c.webMapResponse=b;c.enableSnapping({snapKey:g.copyKey});q.setStyle(c.root,"zIndex",0);c._initialExtent=c.extent;this.layerInfosObj=E.getInstanceSyncForInit(c,c.itemInfo);this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(a){a.getLayerObject().then(f.hitch(this,function(a){a&&f.setObject("_wabProperties.originalRefreshinterval",a.refreshInterval,
a)}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))},this);a.map.mapRefreshInterval&&!a.map.mapRefreshInterval.useWebMapRefreshInterval&&this._updateRefreshInterval(a.map.mapRefreshInterval);this._showUnreachableLayersTitleMessage();this._publishMapEvent(c);setTimeout(f.hitch(this,this._checkAppState),500);this._addDataLoadingOnMapUpdate(c);this._hideError()}),f.hitch(this,function(a){console.error(a);this._showError(a);r.publish("mapCreatedFailed")}))},_handleRefreshLayer:function(a){var b=
a._mode._drawFeatures,c=a._mode._clearIIf,d=null;a._mode._drawFeatures=function(c,d){d&&"number"===typeof d.row&&"number"===typeof d.col&&a._mode._removeCell(d.row,d.col);b.apply(a._mode,arguments)};l.before(a,"refresh",function(){d=a._mode._cellMap;a._mode._clearIIf=function(){}});l.after(a,"refresh",function(){a._mode._cellMap=d;a._mode._clearIIf=c});m(a,"update-start",function(){a.isUpdating=!0});m(a,"update-end",function(){a.isUpdating=!1})},_showError:function(a){a&&a.message&&q.create("div",
{"class":"app-error load-map-error",innerHTML:a.message},document.body)},_hideError:function(){e("div.load-map-error",document.body).forEach(function(a){document.body.removeChild(a)})},_createWebMapRaw:function(b,c,e,g){return z.createWebMap(b,c,e,g).then(f.hitch(this,function(a){return a}),f.hitch(this,function(h){console.error(h);if(h&&h instanceof Error&&h.message){var n=f.getObject("arcgis.utils.baseLayerError",!1,p.cache["esri/nls/jsapi/"+d.locale]);if(n&&0<=h.message.indexOf(n))return new C({message:window.jimuNls.map.basemapNotAvailable+
window.jimuNls.map.displayDefaultBasemap}),a.getItem(c).then(f.hitch(this,function(a){a.itemData.spatialReference={wkid:102100,latestWkid:3857};a.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return z.createWebMap(b,a,e,g)}))}throw h;}))},_showUnreachableLayersTitleMessage:function(){var a=this.layerInfosObj.getUnreachableLayersTitle(),
b="",c=window.jimuNls.map.layerLoadedError||"The layer, ${layers} cannot be added to the map.";c&&a&&0<a.length&&(k.forEach(a,f.hitch(this,function(a){b=b+a+", "})),new C({message:c.replace("${layers}",b)}))},_addDataLoadingOnMapUpdate:function(a){var b=q.toDom('\x3cdiv class\x3d"map-loading"\x3eLoading...\x3c/div\x3e');q.place(b,a.root);a.updating&&q.addClass(b,"loading");m(a,"update-start",f.hitch(this,function(){q.addClass(b,"loading")}));m(a,"update-end",f.hitch(this,function(){q.removeClass(b,
"loading")}));m(a,"unload",f.hitch(this,function(){q.destroy(b);b=null}))},_checkAppState:function(){var a="extent center marker find query scale level".split(" "),b=this.appConfig.keepAppState;b&&k.forEach(a,function(a){a in this.urlParams&&(b=!1)},this);b&&this.appStateManager.getWabAppState().then(f.hitch(this,function(a){if(a.extent||a.layers){var b=new A({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});b.placeAt("main-page");m(b,"applyAppState",f.hitch(this,function(){this._applyAppState(a,
this.map)}));b.startup();b.show()}}))},_applyAppState:function(a,b){this.layerInfosObj.restoreState({layerOptions:a.layers||null});a.extent&&b.setExtent(a.extent)},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=f.clone(a),a.extent&&(a.extent=new u(a.extent)),a.center&&!f.isArrayLike(a.center)&&(a.center=new v(a.center)),a.infoWindow&&(a.infoWindow=new c(a.infoWindow,q.create("div",{},this.mapDivId))),a},createLayer:function(a,c,d){x([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer",
"2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer",
"3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[c+"_"+d.type]],f.hitch(this,function(c){var e,g={};e="label url type icon infoTemplate isOperationalLayer".split(" ");for(var h in d)0>e.indexOf(h)&&(g[h]=d[h]);d.infoTemplate?(e=new b(d.infoTemplate.title,d.infoTemplate.content),g.infoTemplate=e,c=new c(d.url,g),d.infoTemplate.width&&d.infoTemplate.height&&l.after(c,"onClick",f.hitch(this,function(){a.infoWindow.resize(d.infoTemplate.width,d.infoTemplate.height)}),
!0)):c=new c(d.url,g);c.isOperationalLayer=d.isOperationalLayer;c.label=d.label;c.icon=d.icon;a.addLayer(c)}))},onAppConfigChanged:function(a,b,c){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===b?c.lods&&this._recreateMap(a):"mapRefreshIntervalChange"===b&&this.map&&this.map.itemInfo.itemData&&this.layerInfosObj&&this._updateRefreshInterval(c)},onMapContentModified:function(){this._recreateMap(this.appConfig)},_updateRefreshInterval:function(a){var b=-1,b=a.useWebMapRefreshInterval?
-1:a.minutes;this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(a){a.getLayerObject().then(f.hitch(this,function(a){if(a){var c=f.getObject("_wabProperties.originalRefreshinterval",!1,a);0<c&&"function"===typeof a.setRefreshInterval&&(0>b?a.setRefreshInterval(c):a.setRefreshInterval(b))}}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))},this)},_recreateMap:function(a){this.map&&(r.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},
enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});H.getInstance=function(a,b){null===G&&(G=new H(a,b));return G};return H})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x){var z=t([v,c,n,b,u],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:x,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);p.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[z.ANCHOR_UPPERRIGHT,z.ANCHOR_LOWERRIGHT,z.ANCHOR_LOWERLEFT,z.ANCHOR_UPPERLEFT];
if(7>r("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+d.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",b=p.create("div",null,q.body());d.set(b,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var c=setTimeout(function(){p.destroy(b);clearTimeout(c);c=b=null},100);e.query(".sprite",this.domNode).forEach(function(b){b.style.backgroundImage="none";b.style.filter=
a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var c=d.set;c(this._topleft,{height:b+"px",marginLeft:a+"px"});c(this._topright,{width:a+"px",height:b+"px"});c(this._user,"width",a-8+"px");c(this._hide,"marginLeft",a-22+"px");c(this._title,"width",a-25+
"px");c(this._content,"height",b-37+"px");c(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});c(this._bottomright,{width:a-5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var c=d.set;c(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===z.ANCHOR_UPPERLEFT?c(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===z.ANCHOR_UPPERRIGHT?
c(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===z.ANCHOR_LOWERRIGHT?c(this._window,{left:"6px",right:null,top:"43px",bottom:null}):b===z.ANCHOR_LOWERLEFT&&c(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(b,c,d){if(b){b.spatialReference?(this.mapCoords=b,b=this.coords=this.map.toScreen(b,!0)):(this.mapCoords=
null,this.coords=b);var e=this.map._getFrameWidth();if(-1!==e&&(b.x%=e,0>b.x&&(b.x+=e),this.map.width>e))for(var f=(this.map.width-e)/2;b.x<f;)b.x+=e;c&&-1!==k.indexOf(this._ANCHORS,c)||(c=this._getAnchor(b));g.remove(this._pointer,this.anchor);c=this.anchor=this.fixedAnchor||c;this._adjustPosition(b,c);g.add(this._pointer,c);a.show(this.domNode);this.isShowing=!0;if(!d)this.onShow()}},hide:function(b,c){a.hide(this.domNode);this.isShowing=!1;if(!c)this.onHide()},showTitleBar:function(){a.show(this._titlebar);
a.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){a.hide(this._titlebar);a.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){a.show(this._content);a.show(this._border);this.isContentShowing=!0},hideContent:function(){a.hide(this._content);a.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));d.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+
"px"})},setFixedAnchor:function(a){a&&-1===k.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});f.mixin(z,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});r("extend-esri")&&f.setObject("dijit.InfoWindow",z,h);return z})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C){t=f([a,u],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:t.toUrl("./images/whitex.png"),dArrowIcon:t.toUrl("./images/whitedown.png"),lArrowIcon:t.toUrl("./images/whitel.png"),rArrowIcon:t.toUrl("./images/whiter.png"),constructor:function(a,b){this.initialize();k.mixin(this,a);this.domNode=p.byId(b);this._nls=k.mixin({},
C.widgets.popup);a=this.domNode;c.add(a,"esriPopupMobile");d.set(a,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
b=m.query(".titlePane",a)[0];this._arrowButton=m.query(".arrow",b)[0];this._pointerTop=m.query(".top",a)[0];this._pointerBottom=m.query(".bottom",a)[0];this._title=m.query(".title",b)[0];this._footer=m.query(".footer",b)[0];this._prev=m.query(".prev",b)[0];this._next=m.query(".next",b)[0];this._spinner=m.query(".spinner",b)[0];this._eventConnections=[q.connect(m.query(".close",b)[0],"onclick",this,this.hide),q.connect(this._arrowButton,"onclick",this,this._toggleView),q.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),q.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();E.hide(a);this.isShowing=!1},setMap:function(a){this.inherited(arguments);n.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(E.show(this.domNode),this.isShowing=!0,this.onShow())}else E.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(E.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);e.forEach(this._eventConnections,q.disconnect);n.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");c.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[q.connect(a,"onPanStart",this,this._onPanStart),q.connect(a,"onPan",this,this._onPan),q.connect(a,"onZoomStart",this,this._onZoomStart),q.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(e.forEach(a,q.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,b){var c=this._panOrigin;a=b.x;b=b.y;var d=c.left,e=c.top,f=c.right,c=c.bottom;d&&(d=parseFloat(d)+a+"px");e&&(e=parseFloat(e)+b+"px");f&&(f=parseFloat(f)-a+"px");c&&(c=parseFloat(c)-b+"px");h.set(this.domNode,{left:d,top:e,right:f,bottom:c})},_onZoomStart:function(){E.hide(this.domNode)},_onExtentChange:function(a,b,c){c&&(E.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(a){var d=a.x;a=a.y;var e=
b.getContentBox(this.map.container),f=e.w,e=e.h,g=0,n=a+10,l=118,u=f-18;18<d&&d<u?(g=d-130,0>g?g=0:g>f-260&&(g=f-260)):18>=d?g=d-18:d>=u&&(g=f-260+(d-u));118<d&&d<f-130?l=118:118>=d?18<d?l=d-12:18>=d&&(l=6):d>=f-130&&(d<u?l=118+d-(f-130):d>=u&&(l=118+u-(f-130)));a<=e/2?(h.set(this.domNode,{left:g+"px",top:n+"px",bottom:null}),h.set(this._pointerTop,{left:l+"px"}),c.add(this._pointerBottom,"hidden"),c.remove(this._pointerTop,"hidden")):(h.set(this.domNode,{left:g+"px",top:n-64+"px",bottom:null}),h.set(this._pointerBottom,
{left:l+"px"}),c.add(this._pointerTop,"hidden"),c.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){e.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?m.query(".pointer."+b,this.domNode).removeClass("hidden"):m.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();E.show(this.popupNavigationBar.container);E.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":E.hide(this.popupNavigationBar.container);E.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":E.hide(this.popupNavigationBar.container);E.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new x(a,n.create("div",{},r.body()));q.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});q.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);q.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();E.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},n.create("div",{},r.body()));c.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();q.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});q.connect(this.popupInfoView,"onSwipeLeft",this,function(){});q.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",b="\x26nbsp;",d=this.selectedIndex,e=this.features,f=this.deferreds,g=this._prevFeatureButton.parentNode,h=this._nextFeatureButton.parentNode,n=this._spinner,l=this._nls;e&&1<=e.length?(a=e[d].getTitle(),b=d+1+" of "+e.length,c.remove(this._arrowButton,"hidden"),0===d?(c.add(g,"hidden"),c.add(this._prev,"hidden")):(c.remove(g,"hidden"),c.remove(this._prev,"hidden")),d===e.length-1?(c.add(h,"hidden"),
c.add(this._next,"hidden")):(c.remove(h,"hidden"),c.remove(this._next,"hidden"))):(c.add(this._arrowButton,"hidden"),c.add(g,"hidden"),c.add(h,"hidden"),c.add(this._prev,"hidden"),c.add(this._next,"hidden"));this.setTitle(a,b);this.popupNavigationBar.getItems()[1]._node.innerHTML=b;f&&f.length?(c.remove(n,"hidden"),this.setTitle(l.NLS_searching+"...","\x26nbsp;")):(c.add(n,"hidden"),e&&e.length||this.setTitle("No Information","\x26nbsp;"))}});l("extend-esri")&&k.setObject("dijit.PopupMobile",t,z);
return t})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n){t=t(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(b,c){this.container=l.byId(c);this._touchBase=n(this.container,null);this._slideDiv=p.create("div",
null,this.container,"first");this.events=[];this._items=b.items;b.sections&&(this._sections=b.sections);g.add(this.container,"esriMobileInfoView");if(0===this._sections.length)p.create("div",{},this._slideDiv);else for(b=0;b<this._sections.length;b++)c=p.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv),p.create("div",{innerHTML:this._sections[b].title},c);for(b=0;b<this._items.length;b++){var a;c=0;this._items[b].section&&(c=this._items[b].section);switch(this._items[b].type){case "div":a=
p.create("div",{"class":"esriMobileInfoViewItem",style:this._items[b].style},this._slideDiv.childNodes[c]),a=p.create("div",{innerHTML:this._items[b].text},a)}this._items[b].className&&g.add(a,this._items[b].className);a._index=b;a._item=this._items[b];this._items[b]._node=a}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){k.forEach(this.events,q.disconnect);this._touchBase=null;e.query("img",this.container).forEach(function(b){b._index=null;
b._item=null;p.destroy(b);b=null});this._items=null;p.destroy(this._slideDiv);p.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(b){this._touchBase.setPreventDefault(b)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(q.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(q.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(q.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){q.disconnect(this.events.pop());q.disconnect(this.events.pop());q.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(b){},onUnSelect:function(b){},onCreate:function(b){},
onClick:function(b){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(b){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=b.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(b){this._moveDirection||(this._moveDirection=Math.abs(b.curY)>Math.abs(b.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(b.touches[0].clientY-
this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(b){this._endTime=new Date;this._deltaMovement=b.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===b.swipeDirection)this.onSwipeLeft();else if("right"===b.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<
Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var b,c;b=d.getContentBox(this.container);var a=0>this._velocity?.001:-.001;c=-(this._velocity*this._velocity)/(2*a);var e=-this._velocity/a,a=3*.6-0,f=1-a,g=0,n=0;if(b.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,n=300;else if(0<this.contentOffsetY+c){b=0;for(c=Math.floor(e/20);b<c;b++)if(g=(20*f*b^3)+(20*a*b^2)+0*b+0,g=0>this._velocity?-g:g,0<this.contentOffsetY+g){n=20*b;break}0===n&&(n=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+
c)+b.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=b.h-this._slideDiv.scrollHeight,b=0,c=Math.floor(e/20);b<c;b++){if(g=(20*f*b^3)+(20*a*b^2)+0*b+0,g=0>this._velocity?-g:g,Math.abs(this.contentOffsetY+g)>this._slideDiv.scrollHeight){n=20*b;break}}else n=e,this.contentOffsetY+=c;this._slideDiv.style.webkitTransition="-webkit-transform "+n+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var b=d.getContentBox(this.container);b.h>this._slideDiv.scrollHeight?
this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+b.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=b.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(b){this.contentOffsetY=b;this._slideDiv.style.webkitTransform="translate3d(0, "+b+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var b=document.defaultView.getComputedStyle(this._slideDiv,null),
b=new WebKitCSSMatrix(b.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(b.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(b,c){"ON"===c.toggleState?(c.toggleState="OFF",c.src&&(b.src=c.src.toString()),this.onUnSelect(c)):(c.toggleState="ON",c.srcAlt&&(b.src=c.srcAlt),this.onSelect(c))}});r("extend-esri")&&f.setObject("dijit.InfoView",t,c);return t})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(t,f,k,q,e,r){t=t(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(e,f){this.domNode=q.byId(e);this.events=[k.connect(this.domNode,"touchstart",this,this._touchStartHandler),k.connect(this.domNode,"touchmove",this,this._touchMoveHandler),k.connect(this.domNode,"touchend",this,this._touchEndHandler),k.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(e){this._preventDefault=e},disableOnClick:function(){k.disconnect(this.events.pop())},
_clickHandler:function(e){if(this._moved)e.preventDefault();else this.onclick(e)},_touchStartHandler:function(e){this._moved=!1;this.client_x=e.targetTouches[0].clientX;this.client_y=e.targetTouches[0].clientY;this.down_x=e.targetTouches[0].pageX;this.down_y=e.targetTouches[0].pageY;e.downX=this.down_x;e.downY=this.down_y;this.onTouchStart(e)},_touchMoveHandler:function(e){this._preventDefault&&e.preventDefault();this._moved=!0;this.up_x=e.targetTouches[0].pageX;this.cur_x=e.targetTouches[0].pageX-
this.down_x;this.cur_y=e.targetTouches[0].pageY-this.down_y;e.curX=this.cur_x;e.curY=this.cur_y;this.onTouchMove(e)},_touchEndHandler:function(e){this._moved?(e.curX=this.cur_x,e.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?e.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(e.swipeDirection="right")):(e.clientX=this.client_x,e.clientY=this.client_y);this.onTouchEnd(e)},onTouchStart:function(e){},onTouchMove:function(e){},onTouchEnd:function(e){},onclick:function(e){}});
e("extend-esri")&&f.setObject("dijit._TouchBase",t,r);return t})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c){t=t(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(c,b){this.container=l.byId(b);this._touchBase=d(this.container,null);this._slideDiv=p.create("div",
{},this.container,"first");this.events=[k.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=c.items;g.add(this.container,"esriMobileNavigationBar");b=p.create("div",{},this._slideDiv);for(c=0;c<this._items.length;c++){var e,a;switch(this._items[c].type){case "img":a=p.create("div",{"class":"esriMobileNavigationItem"},b);e=p.create("img",{src:this._items[c].src.toString(),style:{width:"100%",height:"100%"}},a);break;case "span":a=p.create("div",{"class":"esriMobileNavigationItem"},
b);e=p.create("span",{innerHTML:this._items[c].text},a);break;case "div":a=p.create("div",{"class":"esriMobileNavigationInfoPanel"},b),e=p.create("div",{innerHTML:this._items[c].text},a)}g.add(a,this._items[c].position);this._items[c].className&&g.add(e,this._items[c].className);e._index=c;e._item=this._items[c];this._items[c]._node=e}},startup:function(){this.onCreate(this._items)},destroy:function(){q.forEach(this.events,k.disconnect);this._touchBase=null;e.query("img",this.container).forEach(function(c){c._index=
null;c._item=null;p.destroy(c);c=null});this._items=null;p.destroy(this._slideDiv);p.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(c){this._markSelected(c._node,c)},onSelect:function(c){},onUnSelect:function(c){},onCreate:function(c){},_onClickHandler:function(c){if("img"===c.target.tagName.toLowerCase()){var b=c.target,d=b._item;e.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===d.toggleGroup&&this._markUnSelected(a,
a._item)},this);this._toggleNode(b,d)}},_toggleNode:function(c,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(c.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(c.src=b.srcAlt),this.onSelect(b))},_markSelected:function(c,b){b.toggleState="ON";b.srcAlt&&(c.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(c,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(c.src=b.src.toString()),this.onUnSelect(b))}});r("extend-esri")&&f.setObject("dijit.NavigationBar",t,c);
return t})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/topic dojo/Evented".split(" "),function(t,f,k,q,e,r,m,l,g){var p=1E3,d=1E4;return t([f,g],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(c){this.inherited(arguments);"animationDuration"in c&&(p=c.animationDuration);"autoCloseInterval"in c&&(d=c.autoCloseInterval)},
postCreate:function(){window.appInfo.isRunInMobile&&q.addClass(this.domNode,"mobile");var c=q.create("div",{"class":"appstate-header"});q.create("div",{"class":"appstate-title",innerHTML:this.nls.title},c);var d=q.create("div",{"class":"appstate-close"},c);q.place(c,this.domNode);c=q.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});q.place(c,this.domNode);this.own(e(c,"click",k.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(e(d,"click",k.hitch(this,
function(){this.hide()})));this.own(e(this.domNode,r.enter,k.hitch(this,function(){this._timerStop()})));this.own(e(this.domNode,r.leave,k.hitch(this,function(){this._timerStart()})))},show:function(){m.animateProperty({node:this.domNode,duration:p,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:k.hitch(this,function(){this.currentState=1})}).play();l.subscribe("splashPopupShow",k.hitch(this,function(){this._timerStop()}));l.subscribe("splashPopupHide",
k.hitch(this,function(){this._timerStart()}));this.timeoutHandler=setTimeout(k.hitch(this,this.hide),d)},hide:function(){0!==this.currentState&&m.animateProperty({node:this.domNode,duration:p,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:k.hitch(this,function(){this.currentState=0;q.setStyle(this.domNode,"display","none")})}).play()},_timerStart:function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(k.hitch(this,
this.hide),d))},_timerStop:function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z){function E(a,b){var c=a.center.split(";");1===c.length&&(c=a.center.split(","));if(2===c.length||3===c.length){a=parseFloat(c[0]);var d=parseFloat(c[1]);if(isNaN(a)||isNaN(d))a=parseFloat(c[0]),d=parseFloat(c[1]);if(!isNaN(a)&&!isNaN(d)){var e=4326;3!==c.length||isNaN(c[2])||(e=parseInt(c[2],10));c=new r(a,d,new g(e));J(c.spatialReference,b.spatialReference)?b.centerAt(c):L(c,b.spatialReference,function(a){b.centerAt(a[0])},function(){console.error("Project center point error.")})}}}
function C(a,b){var c=a.extent.split("wkt\x3d"),d=null;2===c.length?(d=c[1],c=c[0],c=c.split(",")):(c=a.extent.split(";"),1===c.length&&(c=a.extent.split(",")));if(4===c.length||5===c.length){a=parseFloat(c[0]);var e=parseFloat(c[1]),f=parseFloat(c[2]),h=parseFloat(c[3]);if(isNaN(a)||isNaN(a)||isNaN(a)||isNaN(a))a=parseFloat(c[0]),e=parseFloat(c[1]),f=parseFloat(c[2]),h=parseFloat(c[3]);if(isNaN(a)||isNaN(e)||isNaN(f)||isNaN(h))console.error("Wrong extent parameters.");else{var n=4326;5!==c.length||
isNaN(c[4])||(n=parseInt(c[4],10));c=null;c=d?new m(a,e,f,h,new g({wkt:d})):new m(a,e,f,h,new g({wkid:n}));J(b.spatialReference,c.spatialReference)?b.setExtent(c):L(c,b.spatialReference,function(a){b.setExtent(a[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function A(a,b){var c=null;if(a.markertemplate){c={title:"",content:"",isIncludeShareUrl:!1};try{var d=JSON.parse(decodeURIComponent(a.markertemplate));t.mixin(c,d)}catch(W){console.error("urlParams: \x26markertemplate JSON.parse error."+
W.stack)}}d=a.marker.split(";");1===d.length&&(d=a.marker.split(","));if(2<=d.length&&6>=d.length&&d[0].length&&!isNaN(d[0])&&d[1].length&&!isNaN(d[1])){var e=parseFloat(d[0]),f=parseFloat(d[1]),h=4326;3<=d.length&&d[2].length&&!isNaN(d[2])&&(h=parseInt(d[2],10));var l="";4<=d.length&&(l=d[3]);a=null;5<=d.length&&0===d[4].indexOf("http")&&(a=d[4]);var u=null;6===d.length&&(u=d[5]);var p=n.fromJson({type:"esriPMS",url:a,contentType:"image/png"}),m=null;u&&(m=n.fromJson({color:[0,0,0,255],type:"esriTS",
verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:u}));B(p).then(function(){var a=new r(e,f,new g({wkid:h}));J(a.spatialReference,b.spatialReference)?w(a,p,m,l,c,b):L(a,b.spatialReference,function(a){w(a[0],p,m,l,c,b)},function(){console.error("Project center point error.")})})}}function w(c,d,e,f,g,n){f=new a("",f);if(g){var l=z.getXyContent(g);g.isIncludeShareUrl&&(g=z.getShareUrl(n,
g,!0),g=z.getShareUrlContent(g),l+=g);f.setContent(l)}l=new h({id:"marker-feature-action-layer"});n.addLayer(l);f=new b(c,d,null,f);l.add(f);e&&(e.xoffset=d.width/2,e.yoffset=d.height/2+d.yoffset,d=new b(new r(c.toJson()),e),l.add(d),f._textSymbol=d);n.centerAt(c)}function B(a){var b=new k;a.url?v.getImagesSize(a.url).then(function(c){a.width=c[0];a.height=c[1];b.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";a.width=26;a.height=26;a.setOffset(0,a.height/2);b.resolve(a)}):
(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),b.resolve(a));return b}function F(a,b){var c=a.query.split(";");1===c.length&&(c=a.query.split(","));if(2!==c.length&&3!==c.length)console.error("query URL parameter is not correct.");else{var d=c[0];M("name",d,b).then(function(a){null===a?M("id",d,b).then(function(a){null===a?console.error("Invalid layer name or id."):D(b,a,c)}):D(b,a,c)})}}function D(a,b,c){var d=new u,e="";d.outSpatialReference=
a.spatialReference;if(2===c.length)d.where=c[1];else if(3===c.length&&(b.layerObject.url&&v.isHostedService(b.layerObject.url)&&v.containsNonLatinCharacter(c[2])&&(e="N"),f.forEach(b.layerObject.fields,function(a){if(a.alias.toLowerCase()===c[1].toLowerCase()||a.name.toLowerCase()===c[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(a.type)?d.where=a.name+"\x3d"+c[2]:-1<["esriFieldTypeString"].indexOf(a.type)&&
(d.where=c[1]+"\x3d"+e+"'"+c[2].replace(/\'/g,"''")+"'")},this),!d.where)){console.error("Invalid field name or type in query URL parameter.");return}d.maxAllowableOffset=1E-5;b.layerObject.queryFeatures(d).then(function(c){c=c.features;if(0===c.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===b.layerObject.geometryType&&1===c.length)a.setExtent(l.getExtentForScale(a,1E3)),a.centerAt(c[0].geometry);else{var d=v.graphicsExtent(c);a.setExtent(d)}G(a,b,c)}},function(a){console.error(a)})}
function G(a,b,c){function d(a){f.forEach(c,function(b){b.setInfoTemplate(a)})}function e(){a.infoWindow.setFeatures(c);a.infoWindow.show(H(c[0]))}if(a.getLayer(b.layerInfo.id))e();else{var g=b.layerInfo.getInfoTemplate();g?(d(g),e()):b.layerInfo.loadInfoTemplate().then(function(a){d(a);e()})}}function H(a){a=a.geometry;if("point"!==a.type)if("multipoint"===a.type)a=a.getPoint(0);else if("polyline"===a.type)a=a.getExtent().getCenter();else if("polygon"===a.type)a=a.getExtent().getCenter();else if("extent"===
a.type)a=a.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return a}function M(a,b,c){var d=new k,f=[];x.getInstance(c,c.itemInfo).then(function(c){c.traversal(function(c){if(d.isResolved())return!0;("id"===a&&c.id.toLowerCase()===b.toLowerCase()||"name"===a&&c.title.toLowerCase()===b.toLowerCase())&&f.push(e({layerType:c.getLayerType(),layerObject:c.getLayerObject()}).then(function(a){"FeatureLayer"===a.layerType&&d.resolve({layerInfo:c,layerObject:a.layerObject})},
function(a){console.error("Find layer error from query URL parameter",a);d.resolve(null)}))});e(f).then(function(){d.isResolved()||d.resolve(null)})});return d}function L(a,b,e,f){var g=[102113,102100,3857],h;4326===a.spatialReference.wkid&&K(g,b.wkid)?(a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99),a=c.geographicToWebMercator(a),(f=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(g=f.valid[1]-a.xmin,h=a.xmax-f.valid[0],g>h?a.xmax=f.valid[1]+h:a.xmin=f.valid[0]-g),a.spatialReference.wkid=
b.wkid,e([a],null)):K(g,a.spatialReference.wkid)&&4326===b.wkid?(a=c.webMercatorToGeographic(a),(f=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(g=f.valid[1]-a.xmin,h=a.xmax-f.valid[0],g>h?a.xmax=f.valid[1]+h:a.xmin=f.valid[0]-g),e([a],null)):(g=new p,g.geometries=[a],g.outSR=b,d.defaults.geometryService.project(g,function(a){!(a&&0<a.length&&a[0]&&"extent"===a[0].type)||isNaN(a[0].xmin)||isNaN(a[0].ymin)||isNaN(a[0].xmax)||isNaN(a[0].ymax)?a&&0<a.length&&a[0]&&"point"===a[0].type&&!isNaN(a[0].x)&&
!isNaN(a[0].y)&&e(a,null):e(a,null)},f))}function J(a,b){var c=[102113,102100,3857];return a&&b&&a.wkt===b.wkt&&(a.wkid===b.wkid||a.latestWkid&&a.latestWkid===b.wkid||b.latestWkid&&a.wkid===b.latestWkid||a.latestWkid&&a.latestWkid===b.latestWkid)||a&&b&&a.wkid&&b.wkid&&K(c,a.wkid)&&K(c,b.wkid)?!0:!1}function K(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}function N(a,b,c){var d=[];a&&a[b]&&a[b].split&&(d=a[b].split(";"));if(d&&0<d.length){var e={};e[b]=d;x.getInstance(c,c.itemInfo).then(function(a){a.setSimplificationState(e)})}}
return{postProcessUrlParams:function(a,b){for(var c=["showLayers","hideLayers","showLayersEncoded","hideLayersEncoded"],d=0,e=c.length;d<e;d++){var f=c[d];if(f in a){N(a,f,b);break}}if("extent"in a)return C(a,b);if("center"in a)return E(a,b);if("marker"in a)return A(a,b);if("find"in a)q.publish("publishData","framework","framework",{searchString:a.find},!0);else if("query"in a)return F(a,b)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),
function(t,f,k,q,e,r,m,l,g,p){var d={getBaseHrefUrl:function(c){var d="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",b="";window.isXT?b=window.location.protocol+"//"+window.location.host+window.appInfo.appPath:(b=g.urlToObject(window.location.href).query||{},b=b.appid?c+"apps/"+d+"/index.html?appid\x3d"+b.appid:b.id?c+"apps/"+d+"/index.html?id\x3d"+b.id:g.getAppHref());return b},addQueryParamToUrl:function(c,d,b,e){c=p.urlToObject(c);c.query||(c.query={});c.query[d]=b;d=c.path;
for(var a in c.query)b=c.query[a],!0===e&&(b=encodeURIComponent(b)),d=d===c.path?d+"?"+a+"\x3d"+b:d+"\x26"+a+"\x3d"+b;return d},getQueryParamFromUrl:function(c,d){c=p.urlToObject(c);c.query||(c.query={});return c.query[d]},removeQueryParamFromUrl:function(c,d,b){c=p.urlToObject(c);c.query&&delete c.query[d];d=c.path;for(var e in c.query){var a=c.query[e];!0===b&&(a=encodeURIComponent(a));d=d===c.path?d+"?"+e+"\x3d"+a:d+"\x26"+e+"\x3d"+a}return d},getShareUrlContent:function(c){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+
window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+c+"\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e"},getShareUrl:function(c,e,b){var f=d.getBaseHrefUrl(window.portalUrl),a="",g,n,l,p,m;e&&(e.longitude&&e.latitude?(g=e.longitude,n=e.latitude,a=e.longitude+","+e.latitude+","):e.x&&e.y&&e.spatialReference&&e.spatialReference.wkid&&(l=e.x,p=e.y,m=e.spatialReference.wkid,a=e.x+","+e.y+","+e.spatialReference.wkid));f=d.addQueryParamToUrl(f,
"marker",a,!0);f=d.addQueryParamToUrl(f+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:e.title,x:l,y:p,wkid:m,longitude:g,latitude:n,isIncludeShareUrl:b})));e=c.getLevel();return f="number"===typeof e&&-1!==e?d.addQueryParamToUrl(f,"level",c.getLevel(),!0):d.addQueryParamToUrl(f,"scale",c.getScale(),!0)},getXyContent:function(c){var d="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";c.longitude&&c.latitude?d+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+
window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+g.localizeNumber(parseFloat(c.longitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+g.localizeNumber(parseFloat(c.latitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e":c.x&&c.y&&(d+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+
g.localizeNumber(parseFloat(c.x).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+g.localizeNumber(parseFloat(c.y).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e");return d+"\x3c/div\x3e"},_isUserOwnTheApp:function(c){return c&&c.username&&c.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(c,d,b,g){var a=new e;g=q.getStandardPortalUrl(g);g=g+"/sharing/rest/content/users/"+(d?d.username?d.username:
d.email:b.email);if(r.isDefined(c.folderId)&&"/"!==c.folderId||r.isDefined(c.ownerFolder)&&"/"!==c.ownerFolder)g+="/"+(c.folderId||c.ownerFolder);g+="/items/"+c.id;f({url:g,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(t.hitch(this,function(b){a.resolve(b)}),t.hitch(this,function(b){console.error(b);a.reject(b)}));return a},_getProfile:function(c,d){var b=new e;c=q.getUserUrl(d,c.owner);f({url:c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(t.hitch(this,
function(c){b.resolve(c)}),t.hitch(this,function(c){console.error(c);b.reject(c)}));return b},_unshareItemById:function(c,d,b){var g=new e;b=q.getStandardPortalUrl(b);b+="/sharing/rest/content/items/"+d+"/unshare";d={f:"json"};d=t.mixin(d,c);f({url:b,handleAs:"json",content:d,callbackParamName:"callback"},{usePost:!0}).then(t.hitch(this,function(a){g.resolve(a)}),t.hitch(this,function(a){console.error(a);g.reject(a)}));return g},canSharePublic:function(c){return!c.selfUrl||!0!==c.canSharePublic&&
!1!==c.canSharePublic?!0:c.canSharePublic},unshareItemsByUser:function(c,d,b){var g=new e;b=q.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+c+"/unshareItems";c={f:"json"};c=t.mixin(c,d);f({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(t.hitch(this,function(a){g.resolve(a)}),t.hitch(this,function(a){console.error(a);g.reject(a)}));return g},unshareItems:function(c,d,b){var g=new e;b=q.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+(d.owner||
c.email)+"/unshareItems";c={f:"json"};c=t.mixin(c,d);f({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(t.hitch(this,function(a){g.resolve(a)}),t.hitch(this,function(a){console.error(a);g.reject(a)}));return g},shareItemsByUser:function(c,d,b){var g=new e;b=q.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+c+"/shareItems";c={f:"json"};c=t.mixin(c,d);f({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(t.hitch(this,function(a){g.resolve(a)}),
t.hitch(this,function(a){console.error(a);g.reject(a)}));return g},shareItems:function(c,d,b){var g=new e;b=q.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+(d.owner||c.email)+"/shareItems";c={f:"json"};c=t.mixin(c,d);f({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(t.hitch(this,function(a){g.resolve(a)}),t.hitch(this,function(a){console.error(a);g.reject(a)}));return g},getItemsGroups:function(c,d){var b=new e;d=q.getStandardPortalUrl(d);d+="/sharing/rest/content/items/"+
c.id+"/groups";f({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(t.hitch(this,function(c){b.resolve(c)}),t.hitch(this,function(c){console.error(c);b.reject(c)}));return b},isSharedToPublic:function(c){return window.isXT?!1:null===c?!0:"undefined"!==typeof c&&"undefined"!==typeof c.item&&"undefined"!==typeof c.item.access&&"public"===c.item.access?!0:!1},isShowSocialMediaLinks:function(c){return window.isXT?!0:null===c?!0:"undefined"!==typeof c&&"undefined"!==
typeof c.item&&"undefined"!==typeof c.item.access&&"private"===c.item.access?!1:!0},getItemShareInfo:function(c){var d=new e,b="";if(window.isXT)return d.resolve(null);b=g.urlToObject(g.getAppHref()).query||{};b=b.id||b.appid;if("undefined"===typeof b||""===b)return d.resolve(null);m.getPortal(c).getItemById(b).then(t.hitch(this,function(b){var a={};a.item=b;a.item&&"undefined"===typeof a.item.sharing&&a.item.access&&(a.item.sharing={access:a.item.access});d.resolve(a)}),t.hitch(this,function(b){console.log(b);
d.resolve(null)}));return d},getShareInfo:function(c){var f=m.getPortal(c),b=new e,h="";if(window.isXT)return b.resolve(null);h=g.urlToObject(g.getAppHref()).query||{};h=h.id||h.appid;if("undefined"===typeof h||""===h)return b.resolve(null);k({getUser:f.getUser(),loadSelfInfo:f.loadSelfInfo(),getItem:f.getItemById(h)}).then(t.hitch(this,function(a){var e={};e.item=a.getItem;e.item&&e.item.ownerFolder&&e.item.ownerFolder.length&&"/"!==e.item.ownerFolder&&(e.item.folderId=e.item.ownerFolder);"undefined"===
typeof e.item.sharing&&e.item.access&&(e.item.sharing={access:e.item.access});e.user=a.getUser;d._setUserRole(a.loadSelfInfo,e);e.currentUser=e.user;e.isAdmin=!1;e.userRole&&(e.userRole.isAdmin()||e.userRole.isCustom()&&e.userRole.canUpdateOrgItems())?(e.isAdmin=!0,e.item.owner!==e.currentUser.name?d._getProfile(e.item,c).then(t.hitch(this,function(a){e.itemUser=a;e.itemUser.orgId!==e.currentUser.orgId&&(e.isAdmin=!1);b.resolve(e)})):(e.itemUser=e.currentUser,b.resolve(e))):(e.currentUser&&(e.itemUser=
e.currentUser),b.resolve(e))}),t.hitch(this,function(a){console.log(a);b.resolve(null)}));return b},_setUserRole:function(c,d){d.userPortalUrl=c.urlKey?c.urlKey+"."+c.customBaseUrl:this.portalUrl;!c||c.code||c.message||(d.organization=c);if(c&&c.user)d.userRole=new l({id:c.user.roleId?c.user.roleId:c.user.role,role:c.user.role}),d._isCustomRole=d.userRole.isCustom(),d._roleCanShareToGroup=d._isCustomRole&&d.userRole.canShareItemToGroup(),d._roleCanShareToOrg=d._isCustomRole&&d.userRole.canShareItemToOrg(),
d._roleCanSharePublic=d._isCustomRole&&d.userRole.canShareItemToPublic(),d._roleCanShare=d._roleCanShareToGroup||d._roleCanShareToOrg||d._roleCanShareToPublic,d._roleCanUpdateItems=d._isCustomRole&&d.userRole.canUpdateOrgItems(),d._roleCanShareOthersItemsToGroup=d._isCustomRole&&d.userRole.canShareOthersItemsToGroup(),d._roleCanShareOthersItemsToOrg=d._isCustomRole&&d.userRole.canShareOthersItemsToOrg(),d._roleCanShareOthersItemsToPublic=d._isCustomRole&&d.userRole.canShareOthersItemsToPublic(),d._roleCanShareOthersItems=
d._isCustomRole&&(d.userRole.canShareOthersItemsToGroup()||d.userRole.canShareOthersItemsToOrg()||d._roleCanShareOthersItemsToPublic),d._orgUserCanSharePublicOrOverride=d.organization&&(!0===d.organization.canSharePublic&&(!d._isCustomRole||d._roleCanSharePublic||d._roleCanShareOthersItemsToPublic)||d.userRole.isAdmin());else return!1},getItemById:function(c,d){var b=new e;d=q.getStandardPortalUrl(d);d+="/sharing/rest/content/items/"+c.id;f({url:d,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(t.hitch(this,
function(c){b.resolve(c)}),t.hitch(this,function(c){console.error(c);b.reject(c)}));return b},disableWebMapPopup:function(c){c&&c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!1)},enableWebMapPopup:function(c){c&&c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!0)}};return d})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector".split(" "),
function(t,f,k,q,e,r,m,l,g,p){var d=null,c=t(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(c){f.mixin(this,c);this.popupMenu=g.getInstance();this.isInited=!1;this.featureActionManager=m.getInstance();q.subscribe("mapLoaded",f.hitch(this,this.onMapLoadedOrChanged));q.subscribe("mapChanged",f.hitch(this,this.onMapLoadedOrChanged));q.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged));q.subscribe("widgetsActionsRegistered",f.hitch(this,
this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&k.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&k.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=
k.create("span",{"class":"popup-menu-button"},r(".actionList",this.popupUnion.bigScreen.domNode)[0]);var c=r("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],c=k.create("div",{"class":"esriMobileInfoViewItem"},c);this.popupMenuButtonMobile=k.create("span",{"class":"popup-menu-button"},c);e(this.popupMenuButtonMobile,"click",f.hitch(this,this._onPopupMenuButtonClick));e(this.popupMenuButtonDesktop,"click",f.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(c){c=
k.position(c.target);this.menuActionsOfSelectedFeature&&this.popupMenu.setActions(this.menuActionsOfSelectedFeature);this.popupMenu.show(c)},_bindSelectionChangeEvent:function(){e(this.popupUnion.bigScreen,"selection-change",f.hitch(this,this._onSelectionChange));e(this.popupUnion.mobile,"selection-change",f.hitch(this,this._onSelectionChange))},_onSelectionChange:function(c){(this.selectedFeature=c.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),c=this.selectedFeature.getLayer(),
(this.selectedFeature.infoTemplate||c&&c.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){k.addClass(this.popupMenuButtonDesktop,"disabled");k.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){k.removeClass(this.popupMenuButtonDesktop,"disabled");k.removeClass(this.popupMenuButtonMobile,"disabled")},initPopupMenu:function(c){if(c){var b=l.toFeatureSet(c);this.featureActionManager.getSupportedActions(b).then(f.hitch(this,
function(c){var a="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent CreateLayer".split(" ");c=c.filter(f.hitch(this,function(b){return 0>a.indexOf(b.name)}));0===c.length?this._disablePopupMenu():this._enablePopupMenu();this.menuActionsOfSelectedFeature=c=c.map(f.hitch(this,function(a){a.data=b;return a}));this.popupMenu.setActions(c)}))}else this._disablePopupMenu(),this.popupMenu.setActions([])},onMapLoadedOrChanged:function(){this.isInited=
!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(c){try{this._relatedRecordsPopupProjector&&this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),
this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new p({originalFeature:c,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(b){console.warn(b.message)}}});c.getInstance=function(e){null===d&&(d=new c({mapManager:e}));return d};return c})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(t,f,k,q,e,r,m,l){var g=null,p=
t(null,{constructor:function(){this._actions=[];window.isBuilder?(q.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),q.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(q.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),q.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(q.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),q.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(q.subscribe("appConfigLoaded",
f.hitch(this,this._onAppConfigLoaded)),q.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(d){d=this._getFeatureSet(d);var c=[];k.forEach(this._actions,function(e){var b=this.testActionSupportFeature(e,d);b.action=e;c.push(b)},this);return r(c).then(f.hitch(this,function(c){return c.map(f.hitch(this,function(b,c){return{result:b,action:this._actions[c]}})).filter(function(b){return b.result}).map(function(b){return b.action})}))},
testActionSupportFeature:function(d,c){c=this._getFeatureSet(c);var f;c.features&&0<c.features.length&&(f=c.features[0].getLayer());d=d.isFeatureSupported(c,f);var b=new e;d&&"function"===typeof d.then?d.then(function(c){b.resolve(c)},function(c){console.error(c);b.resolve(!1)}):b.resolve(d);return b},registerAction:function(d){var c=new e;require([d.uri],f.hitch(this,function(e){var b=new e({map:this.map,appConfig:this.appConfig,label:d.label,name:d.name,widgetId:d.widgetId});k.some(this._actions,
function(c){return b.name===c.name&&b.widgetId===c.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",b.name),c.reject("Feature/FeatureSet action has been registered.",b.name)):(this._actions.push(b),c.resolve(b))}));return c},removeActionsByWidgetId:function(d){this._actions=k.filter(this._actions,function(c){return c.widgetId!==d},this)},getActionsByWidgetId:function(d){return k.filter(this._actions,function(c){return c.widgetId===d},this)},getActionsByActionName:function(d){return k.filter(this._actions,
function(c){return c.name===d},this)},registerWidgetFeatureActions:function(d){var c=new e;if(!d.featureActions||!d.uri)return c.resolve(),c;var f=[];k.forEach(d.featureActions,function(b){f.push(this.registerAction({uri:d.isRemote?d.amdFolder+b.uri+".js":d.amdFolder+b.uri,widgetId:d.id,name:b.name,label:d.manifest["i18nLabels_featureAction_"+b.name][window.dojoConfig.locale]||d.manifest["i18nLabels_featureAction_"+b.name].defaultLabel}))},this);return r(f)},registerAllWidgetFeatureActions:function(d){var c=
[];d.visitElement(f.hitch(this,function(d){d.uri&&d.visible&&c.push(this.registerWidgetFeatureActions(d))}));return r(c).then(function(){q.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(d){var c=[];k.forEach(this.getAllActions(),function(c){var b=d.getConfigElementById(c.widgetId);"framework"===c.widgetId||b&&b.uri&&!1!==b.visible||this.removeActionsByWidgetId(c.widgetId)},this);d.visitElement(f.hitch(this,function(d){d.uri&&d.visible&&0===this.getActionsByWidgetId(d.id).length&&
c.push(this.registerWidgetFeatureActions(d))}));0<c.length&&r(c).then(function(){q.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){k.forEach(m,function(d){this.registerAction({uri:d.uri,widgetId:"framework",label:window.jimuNls.featureActions[d.name],name:d.name})},this)},_getFeatureSet:function(d){return"[object Object]"===Object.prototype.toString.call(d)?d.features?d:l.toFeatureSet([d]):l.toFeatureSet(d)},_onAppConfigLoaded:function(d){this.appConfig=d=f.clone(d);this._setActionsAppConfig(d);
this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(d){this.appConfig=d=f.clone(d);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(d)},_onMapLoaded:function(d){this.map=d;this._setActionsMap(d)},_onMapChanged:function(d){this.map=d;this._setActionsMap(d)},_setActionsMap:function(d){k.forEach(this._actions,function(c){c.setMap(d)},this)},_setActionsAppConfig:function(d){k.forEach(this._actions,function(c){c.setAppConfig(d)},this)}});p.getInstance=
function(){null===g&&(g=new p,window._featureActionManager=g);return g};return p})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},
{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},
"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(t,f,k){return t(f,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){k.featureAction.zoomTo(this.map,f.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(t,f){return t(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,
appConfig:{},widgetId:null,constructor:function(k){f.mixin(this,k)},isFeatureSupported:function(f,q){return!0},onExecute:function(f,q){},setMap:function(f){this.map=f},setAppConfig:function(f){this.appConfig=f},getIcon:function(f){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+this.name+"_"+f+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+f+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","jimu/utils"],function(t,f,k){return t(f,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(f){return 0<f.features.length&&f.geometryType},onExecute:function(f){k.featureAction.panTo(this.map,f.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare","dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(t,f,k,q){return t([k],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(e,k){if(1>e.features.length||!k)return!1;
e=e.features[0];var m=f.getObject("renderer.symbol",!1,k);return e&&e.geometry&&(e.symbol||m)&&this.map.getLayer(k.id)},onExecute:function(e,f){q.featureAction.flash(e&&e.features,f)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(t,f,k){return t([f],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(f,e){return f&&f.features&&1===f.features.length&&e&&e.infoTemplate},onExecute:function(f){k.featureAction.showPopup(this.map,
f.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(t,f,k){return t(f,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length},onExecute:function(f){f=k.createDataSource({type:k.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(k.FORMAT_CSV);f.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./GeojsonConverters libs/polyfills/FileSaver".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a){function u(a,b){var c="",d=b.length,e=a.length,f="",g="",n;try{k.forEach(a,function(a){c="string"===typeof a?c+f+a:c+f+(a.alias||a.name);f=","});for(var c=c+"\r\n",l=0;l<d;l++){f="";n=b[l];for(var p=0;p<e;p++){var u=a[p];(g=n["string"===typeof u?u:u.name])||"number"===typeof g||(g="");g&&("esriFieldTypeDate"===u.type?g=h.localizeDateByFieldInfo(g,u.fieldInfo):!u.fieldInfo||"esriFieldTypeDouble"!==u.type&&"esriFieldTypeSingle"!==u.type&&"esriFieldTypeInteger"!==
u.type&&"esriFieldTypeSmallInteger"!==u.type||(g=h.localizeNumberByFieldInfo(g,u.fieldInfo)));g&&/[",\r\n]/g.test(g)&&(g='"'+g.replace(/(")/g,'""')+'"');c=c+f+g;f=","}c+="\r\n"}return c}catch(K){return""}}var v={createDataSource:function(a){return a.type===v.TYPE_TABLE?new E(a):a.type===v.TYPE_FEATURESET?new z(a):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},x=t(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,
constructor:function(){this.nls=window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(a){this.format=a},download:function(){this.getExportString().then(f.hitch(this,function(a){var b=this.filename+this.suffix;10>dojo.isIE?saveTextAs(a,b,"utf-8"):(a=new Blob([a],{type:"text/plain;charset\x3dutf-8"}),saveAs(a,b,!0))}))},exportToPortal:function(a,b){}}),z=t(x,{featureSet:null,constructor:function(a){this.inherited(arguments);this.featureSet=a.data;
this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===v.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===v.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var a=new e;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV},{value:v.FORMAT_FEATURESET,label:this.nls.toFeatureCollection},
{value:v.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},_getFeatureSet:function(){var a=new e;if(this.featureSet)a.resolve(this.featureSet);else if(this.url){var b=new r;b.returnGeometry=!0;b.outFields=["*"];this.queryTask=new m(this.url);this.queryTask.execute(b,f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getSpatialReference:function(a){if(a.spatialReference)return a.spatialReference;var b;k.some(a.features,function(a){if(a.geometry&&
a.geometry.spatialReference)return b=a.geometry.spatialReference,!0});return b},_projectToWGS84:function(a){var b=new e,f=this._getSpatialReference(a);if(f)if(4326===parseInt(f.wkid,10))b.resolve(a);else if(f.isWebMercator()){var f=new l,u=[];k.forEach(a.features,function(a){var b=new g;b.attributes=a.attributes;b.geometry=n.webMercatorToGeographic(a.geometry);u.push(b)});f.features=u;b.resolve(f)}else{f=new d;f.geometries=k.map(a.features,function(a){return a.geometry});f.outSR=new p(4326);var m=
c&&c.defaults&&c.defaults.geometryService;m&&"esri.tasks.GeometryService"===m.declaredClass||(m=h.getArcGISDefaultGeometryService());m.project(f).then(function(c){var d=new l,e=[];k.forEach(a.features,function(a,b){var d=new g;d.attributes=a.attributes;d.geometry=c[b];e.push(d)});d.features=e;b.resolve(d)},function(a){console.error(a);b.resolve([])})}else b.resolve([]);return b},_getAsFeatureSetString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(a=a.toJson())&&
(b=q.stringify(a));return b}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){return this._projectToWGS84(a)})).then(f.hitch(this,function(b){var c="";if(b&&b.features&&0<b.features.length){var d={type:"FeatureCollection",features:[]};k.forEach(b.features,function(b){d.features.push(a.arcgisToGeoJSON(b))});c=q.stringify(d)}return c}))},_getAsCSVString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var b="";a&&(b=this._createCSVFromFeatureSet(a));
return b}))},_createCSVFromFeatureSet:function(a){var b=this._generateFields(a),c=k.map(a.features,function(b){var c=f.clone(b.attributes);"esriGeometryPoint"!==a.geometryType&&"point"!==a.geometryType||!b.geometry||(c.x=b.geometry.x,c.y=b.geometry.y,b.geometry.spatialReference&&b.geometry.spatialReference.wkid&&(c.wkid=b.geometry.spatialReference.wkid));return c});return u(b,c)},_generateFields:function(a){var c=a.features[0],d,e,g;c._layer&&(d=c._layer.fields,g=c._layer.id);d=f.clone(d||a.fields);
if(!d||0===d.length)for(e in d=[],c=c.attributes,c)c.hasOwnProperty(e)&&d.push({name:e});if(e=b.getInstanceSync().getLayerInfoById(g)){var h=e.getPopupInfo();h||(h=e.layerObject.infoTemplate&&e.layerObject.infoTemplate.info);k.forEach(d,f.hitch(this,function(a){a.fieldInfo=this._findFieldInfo(h,a.name)}))}a.fieldAliases&&k.forEach(d,function(b){a.fieldAliases[b.name]&&(b.alias=a.fieldAliases[b.name])});if("esriGeometryPoint"===a.geometryType||"point"===a.geometryType)d.push({name:"x",type:"esriFieldTypeDouble",
alias:"x"}),d.push({name:"y",type:"esriFieldTypeDouble",alias:"y"}),d.push({name:"wkid",type:"esriFieldTypeInteger",alias:"wkid"});return d},_findFieldInfo:function(a,b){if(!a)return null;var c;k.some(a.fieldInfos,function(a){if(a.fieldName===b)return c=a,!0});return c}}),E=t(x,{table:null,constructor:function(a){this.inherited(arguments);this.table=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();
var a=new e;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV}]},_getTableData:function(){var a=new e;if(this.table)a.resolve(this.table);else if(this.url){var b=new r;b.outFields=["*"];this.queryTask=new m(this.url);this.queryTask.execute(b,f.hitch(this,function(b){var c={};c.fields=b.fields;c.datas=k.map(b.features,function(a){return a.attributes});a.resolve(c)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsCSVString:function(){return this._getTableData().then(f.hitch(this,
function(a){var b="";a&&(b="\ufeff"+u(a.fields,a.datas));return b}))}});return v})},"jimu/GeojsonConverters":function(){define([],function(){function t(e){var f;a:{f=e[0];for(var g=0;g<f.length;g++)if(f[g]!==e[e.length-1][g]){f=!1;break a}f=!0}f||e.push(e[0]);return e}function f(e){var f=0,g=0,p=e.length,d=e[g],c;for(g;g<p-1;g++)c=e[g+1],f+=(c[0]-d[0])*(c[1]+d[1]),d=c;return 0<=f}function k(e,f){for(var g=0;g<e.length-1;g++)for(var l=0;l<f.length-1;l++){var d;a:{var c=e[g],n=e[g+1],b=f[l],h=f[l+1],
a=(h[0]-b[0])*(c[1]-b[1])-(h[1]-b[1])*(c[0]-b[0]);d=(n[0]-c[0])*(c[1]-b[1])-(n[1]-c[1])*(c[0]-b[0]);c=(h[1]-b[1])*(n[0]-c[0])-(h[0]-b[0])*(n[1]-c[1]);if(0!==c&&(a/=c,d/=c,0<=a&&1>=a&&0<=d&&1>=d)){d=!0;break a}d=!1}if(d)return!0}return!1}function q(e){var l=[];e=e.slice(0);var g=t(e.shift().slice(0));if(4<=g.length)for(f(g)||g.reverse(),l.push(g),g=0;g<e.length;g++){var p=t(e[g].slice(0));4<=p.length&&(f(p)&&p.reverse(),l.push(p))}return l}function e(e){var f={},g;for(g in e)e.hasOwnProperty(g)&&(f[g]=
e[g]);return f}var r={arcgisToGeoJSON:function(m,l){var g={};"number"===typeof m.x&&"number"===typeof m.y&&(g.type="Point",g.coordinates=[m.x,m.y]);m.points&&(g.type="MultiPoint",g.coordinates=m.points.slice(0));m.paths&&(1===m.paths.length?(g.type="LineString",g.coordinates=m.paths[0].slice(0)):(g.type="MultiLineString",g.coordinates=m.paths.slice(0)));if(m.rings){var p=m.rings.slice(0),g=[],d=[],c,n;for(n=0;n<p.length;n++){var b=t(p[n].slice(0));4>b.length||(f(b)?g.push([b]):d.push(b))}for(b=[];d.length;){n=
d.pop();for(var h=!1,p=g.length-1;0<=p;p--){var a=c=g[p][0],u=n;c=k(a,u);for(var u=u[0],q=!1,x=-1,z=a.length,E=z-1;++x<z;E=x)(a[x][1]<=u[1]&&u[1]<a[E][1]||a[E][1]<=u[1]&&u[1]<a[x][1])&&u[0]<(a[E][0]-a[x][0])*(u[1]-a[x][1])/(a[E][1]-a[x][1])+a[x][0]&&(q=!q);a=q;if(!c&&a){g[p].push(n);h=!0;break}}h||b.push(n)}for(;b.length;){n=b.pop();d=!1;for(p=g.length-1;0<=p;p--)if(c=g[p][0],k(c,n)){g[p].push(n);d=!0;break}d||g.push([n.reverse()])}g=1===g.length?{type:"Polygon",coordinates:g[0]}:{type:"MultiPolygon",
coordinates:g}}if(m.geometry||m.attributes)g.type="Feature",g.geometry=m.geometry?r.arcgisToGeoJSON(m.geometry):null,g.properties=m.attributes?e(m.attributes):null,m.attributes&&(g.id=m.attributes[l]||m.attributes.OBJECTID||m.attributes.FID);return g},geojsonToArcGIS:function(f,l){l=l||"OBJECTID";var g={wkid:4326},p={};switch(f.type){case "Point":p.x=f.coordinates[0];p.y=f.coordinates[1];p.spatialReference=g;break;case "MultiPoint":p.points=f.coordinates.slice(0);p.spatialReference=g;break;case "LineString":p.paths=
[f.coordinates.slice(0)];p.spatialReference=g;break;case "MultiLineString":p.paths=f.coordinates.slice(0);p.spatialReference=g;break;case "Polygon":p.rings=q(f.coordinates.slice(0));p.spatialReference=g;break;case "MultiPolygon":l=p;f=f.coordinates.slice(0);for(var d=[],c=0;c<f.length;c++)for(var n=q(f[c]),b=n.length-1;0<=b;b--){var h=n[b].slice(0);d.push(h)}l.rings=d;p.spatialReference=g;break;case "Feature":f.geometry&&(p.geometry=r.geojsonToArcGIS(f.geometry,l));p.attributes=f.properties?e(f.properties):
{};f.id&&(p.attributes[l]=f.id);break;case "FeatureCollection":p=[];for(g=0;g<f.features.length;g++)p.push(r.geojsonToArcGIS(f.features[g],l));break;case "GeometryCollection":for(p=[],g=0;g<f.geometries.length;g++)p.push(r.geojsonToArcGIS(f.geometries[g],l))}return p}};return r})},"libs/polyfills/FileSaver":function(){(function(t,f){"function"==typeof define&&define.amd?define([],f):"undefined"!=typeof exports?f():(f(),t.FileSaver={})})(this,function(){function t(e,f){return"undefined"==typeof f?
f={autoBom:!1}:"object"!=typeof f&&(console.warn("Depricated: Expected third argument to be a object"),f={autoBom:!f}),f.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function f(e,f,g){var l=new XMLHttpRequest;l.open("GET",e);l.responseType="blob";l.onload=function(){r(l.response,f,g)};l.onerror=function(){console.error("could not download file")};l.send()}function k(e){var f=new XMLHttpRequest;return f.open("HEAD",
e,!1),f.send(),200<=f.status&&299>=f.status}function q(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(g){var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);e.dispatchEvent(f)}}var e="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,r=e.saveAs||("object"!=typeof window||window!==e?function(){}:"download"in HTMLAnchorElement.prototype?
function(m,l,g){var p=e.URL||e.webkitURL,d=document.createElement("a");l=l||m.name||"download";d.download=l;d.rel="noopener";"string"==typeof m?(d.href=m,d.origin===location.origin?q(d):k(d.href)?f(m,l,g):q(d,d.target="_blank")):(d.href=p.createObjectURL(m),setTimeout(function(){p.revokeObjectURL(d.href)},4E4),setTimeout(function(){q(d)},0))}:"msSaveOrOpenBlob"in navigator?function(e,l,g){if(l=l||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,g),l);else if(k(e))f(e,l,g);else{var p=
document.createElement("a");p.href=e;p.target="_blank";setTimeout(function(){q(p)})}}:function(m,l,g,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),"string"==typeof m)return f(m,l,g);l="application/octet-stream"===m.type;g=/constructor/i.test(e.HTMLElement)||e.safari;var d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||l&&g)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var b=c.result,b=d?b:b.replace(/^data:[^;]*;/,"data:attachment/file;");
p?p.location.href=b:location=b;p=null};c.readAsDataURL(m)}else{var n=e.URL||e.webkitURL,b=n.createObjectURL(m);p?p.location=b:location.href=b;p=null;setTimeout(function(){n.revokeObjectURL(b)},4E4)}});e.saveAs=r.saveAs=r;"undefined"!=typeof module&&(module.exports=r)})},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(t,f,k){return t(f,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(f){return 0<
f.features.length&&f.features[0].geometry},onExecute:function(f){f=k.createDataSource({type:k.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(k.FORMAT_FEATURESET);f.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(t,f,k){return t(f,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){f=k.createDataSource({type:k.TYPE_FEATURESET,
filename:"features",data:f});f.setFormat(k.FORMAT_GEOJSON);f.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(t,f,k){return t(f,{iconClass:"icon-statistics",isFeatureSupported:function(f,e){return 1<f.features.length&&e&&"esri.layers.GraphicsLayer"!==e.declaredClass&&0<this.getNumbericFields(e).length},onExecute:function(f,e){var r=new k;f={featureSet:f,layer:e,fieldNames:this.getNumbericFields(e).map(function(e){return e.name})};
r.showContentAsPopup(f)},getNumbericFields:function(f){return f.fields.filter(function(e){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when jimu/dijit/formSelect esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){return t([f],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;k.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=q.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=
a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new c({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(a,b){var c;h.isStatFromServer(this.statInfo)&&(c=new n,c.placeAt(b),c.show());h.getStatisticsResult(this.statInfo).then(k.hitch(this,function(a){c&&c.destroy();m(".esriAGOTableStatistics",b).remove();
a=this._createStatContent(a);q.place(a,b)}))},_getFieldAliaseFromStatInfo:function(a){var b=this.statInfo.featureSet;(b=b&&b.fieldAliases)&&"undefined"!==typeof b[a]?b=b[a]:this.statInfo.layer?(b=e.filter(this.statInfo.layer.fields,function(b){return b.name===a}),b=b[0]?b[0].alias:""):b=a;return b},_createFieldDom:function(a){var b;if(1<this.statInfo.fieldNames.length){b=q.create("div",{className:"header"},a);q.create("span",{innerHTML:this.nls.field+": "},b);var c=new p({options:this.statInfo.fieldNames.map(k.hitch(this,
function(a){return{value:a,label:this._getFieldAliaseFromStatInfo(a)}})),style:{width:"150px"},"aria-label":this.nls.field});this.own(r(c,"change",k.hitch(this,function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,a)})));c.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else b=q.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},
a);return b},_createStatContent:function(a){var b={},c="count sum min max ave stddev".split(" "),d,f,g,h,n,l,p,m;d=q.create("div",{className:"esriAGOTableStatistics",innerHTML:""});q.create("div",{className:"hzLine",innerHTML:""},d);f=q.create("table",{className:"attrTable",tabindex:"0",innerHTML:"",style:{cellpadding:0,cellspacing:0}},d);for(n in a)a.hasOwnProperty(n)&&(b[n.toLowerCase()]=a[n]);n=b.countfield;m=b.sumfield||"";p=b.minfield||"";l=b.maxfield||"";a=b.avgfield||"";b=b.stddevfield||"";
g=q.create("tbody",{},f);var k=this;e.forEach([n,m,p,l,a,b],function(a,b){""!==a&&(h=q.create("tr",{valign:"top"},g),q.create("td",{"class":"attrName",innerHTML:k.nls[c[b]]},h),q.create("td",{"class":"attrValue",innerHTML:a},h))});q.create("div",{className:"break",innerHTML:""},d);return d}})})},"jimu/dijit/formSelect":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/query dojo/_base/array dojo/dom-construct dijit/form/Select".split(" "),function(t,f,k,q,e,r,m,l){return t([l],
{postCreate:function(){this.inherited(arguments);var g=this["aria-label"],l=this["aria-labelledby"],d;g&&"focusNode"!==g?(d='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+g+"\x3c/caption\x3e",g=f.toDom(d),m.place(g,this.domNode,"first")):l?setTimeout(k.hitch(this,function(){var c=l.split(" "),g=[];r.forEach(c,function(b){(b=e("#"+b)[0])&&""!==b&&b.innerHTML&&g.push(b.innerHTML)});0<g.length&&(d='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+g.join(" ")+"\x3c/caption\x3e",
c=f.toDom(d),m.place(c,this.domNode,"first"))}),1E3):(this.setAttrs=function(){this.domNode.title="";var c=this.get("value");c&&(c=this.getOptions(c),this.domNode.title=c.label,f.setAttr(this.domNode,"aria-label",c.label))},this.setAttrs(),q(this,"change",k.hitch(this,this.setAttrs)))}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x){function z(a){return function(b){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(l.hitch(this,a,b))}}var E=f("dijit.form._SelectMenu",n,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(g(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;
l.isArray(b)&&(b=b[b.length-1]);b&&t.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,this.focusChild(c,!1))},this);a||this.inherited(arguments)}});e=f("dijit.form.Select"+(p("dojo-bidi")?"_NoBidi":""),[d,c,u],{baseClass:"dijitSelect dijitValidationTextBox",templateString:x,_buttonInputDisabled:p("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new E({id:this.id+"_menu",parentWidget:this});q.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var c=l.hitch(this,"_setValueAttr",a);a=new b({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,
onClick:c,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||!1});a.focusNode.setAttribute("role","option");return a}return new h({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(C){}},focusChild:function(a){a&&this.set("value",
a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=v.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{t.forEach(this._getChildren(),function(a){a.destroyRecursive()});
var c=new b({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(c)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);k.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(b){b=this.disabled||this.isValid(b);this._set("state",b?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",b?"false":"true");var c=b?"":this._missingMsg;c&&this.focused&&this._hasBeenBlurred?a.show(c,this.domNode,this.tooltipPosition,!this.isLeftToRight()):a.hide(this.domNode);this._set("message",c);return b},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);a.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=r.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(g(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[m.LEFT_ARROW];delete a[m.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
q.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(b){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(b),delete this.dropDown);a.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){a.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
p("dojo-bidi")&&(e=f("dijit.form.Select",e,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));e._Menu=E;e.prototype._onContainerKeydown=z("_onContainerKeydown");e.prototype._onContainerKeypress=z("_onContainerKeypress");return e})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n){return e("dijit.form._FormSelectWidget",n,{multiple:!1,options:null,store:null,_setStoreAttr:function(b){this._created&&this._deprecatedSetStore(b)},query:null,_setQueryAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:b})},queryOptions:null,_setQueryOptionsAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:b})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(b){var c=this.options||[];if(null==b)return c;if(g.isArrayLike(b))return t.map(b,"return this.getOptions(item);",this);g.isString(b)&&(b={value:b});g.isObject(b)&&(t.some(c,function(a,c){for(var d in b)if(!(d in a)||a[d]!=b[d])return!1;b=c;return!0})||(b=-1));return 0<=b&&b<c.length?c[b]:null},addOption:function(b){t.forEach(g.isArrayLike(b)?b:[b],function(b){b&&g.isObject(b)&&this.options.push(b)},this);this._loadChildren()},removeOption:function(b){b=this.getOptions(g.isArrayLike(b)?
b:[b]);t.forEach(b,function(b){b&&(this.options=t.filter(this.options,function(a){return a.value!==b.value||a.label!==b.label}),this._removeOptionItem(b))},this);this._loadChildren()},updateOption:function(b){t.forEach(g.isArrayLike(b)?b:[b],function(b){var a=this.getOptions({value:b.value}),c;if(a)for(c in b)a[c]=b[c]},this);this._loadChildren()},setStore:function(b,c,a){l.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(b,c,a)},_deprecatedSetStore:function(b,e,a){var h=this.store;a=a||{};if(h!==b){for(var n;n=this._notifyConnections.pop();)n.remove();b.get||(g.mixin(b,{_oldAPI:!0,get:function(a){var b=new f;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var d=new f(function(){e.abort&&e.abort()});d.total=new f;var e=this.fetch(g.mixin({query:a,onBegin:function(a){d.total.resolve(a)},
onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},b));return new c(d)}}),b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[k.after(b,"onNew",g.hitch(this,"_onNewItem"),!0),k.after(b,"onDelete",g.hitch(this,"_onDeleteItem"),!0),k.after(b,"onSet",g.hitch(this,"_onSetItem"),!0)]));this._set("store",b)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);a.query&&this._set("query",a.query);a.queryOptions&&this._set("queryOptions",a.queryOptions);b&&b.query&&(this._loadingStore=!0,this.onLoadDeferred=new f,this._queryRes=b.query(this.query,this.queryOptions),d(this._queryRes,g.hitch(this,function(c){if(this.sortByLabel&&!a.sort&&c.length)if(b.getValue)c.sort(q.createSortFunction([{attribute:b.getLabelAttributes(c[0])[0]}],b));else{var d=this.labelAttr;c.sort(function(a,b){return a[d]>b[d]?1:b[d]>
a[d]?-1:0})}a.onFetch&&(c=a.onFetch.call(this,c,a));t.forEach(c,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(g.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:e);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(c):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),g.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return h},_setValueAttr:function(b,c){this._onChangeActive||(c=null);if(this._loadingStore)this._pendingValue=b;else if(null!=b){b=g.isArrayLike(b)?t.map(b,function(a){return g.isObject(a)?a:{value:a}}):g.isObject(b)?[b]:[{value:b}];b=t.filter(this.getOptions(b),function(a){return a&&a.value});var a=this.getOptions()||[];this.multiple||b[0]&&b[0].value||!a.length||(b[0]=
a[0]);t.forEach(a,function(a){a.selected=t.some(b,function(b){return b.value===a.value})});a=t.map(b,function(a){return a.value});if("undefined"!=typeof a&&"undefined"!=typeof a[0]){var d=t.map(b,function(a){return a.label});this._setDisplay(this.multiple?d:d[0]);this.inherited(arguments,[this.multiple?a:a[0],c]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var b=t.map([].concat(this.get("selectedOptions")),function(b){return b&&"label"in b?b.label:b?b.value:null},this);return this.multiple?
b:b[0]},_setDisplayedValueAttr:function(b){this.set("value",this.getOptions("string"==typeof b?{label:b}:b))},_loadChildren:function(){this._loadingStore||(t.forEach(this._getChildren(),function(b){b.destroyRecursive()}),t.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var b=[].concat(this.value);if(b&&b[0]){var c=this;t.forEach(this._getChildren(),function(a){var d=t.some(b,function(b){return a.option&&
b===a.option.value});d&&!c.multiple&&(c.focusedChild=a);m.toggle(a.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);a.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var b=this.getOptions()||[];if(!this.multiple&&b.length){var c=t.filter(b,function(a){return a.selected})[0];if(c&&c.value)return c.value;b[0].selected=!0;return b[0].value}return this.multiple?t.map(t.filter(b,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(b,c){c&&c.parent||this._addOptionForItem(b)},_onDeleteItem:function(b){this.removeOption({value:this.store.getIdentity(b)})},_onSetItem:function(b){this.updateOption(this._getOptionObjForItem(b))},_getOptionObjForItem:function(b){var c=this.store,a=this.labelAttr&&this.labelAttr in b?b[this.labelAttr]:c.getLabel(b);return{value:a?c.getIdentity(b):null,label:a,item:b}},_addOptionForItem:function(b){var c=this.store;c.isItemLoaded&&!c.isItemLoaded(b)?c.loadItem({item:b,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(b=this._getOptionObjForItem(b),this.addOption(b))},constructor:function(b){this._oValue=(b||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);r.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?p("\x3e *",this.srcNodeRef).map(function(b){return"separator"===b.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:b.getAttribute("data-"+l._scopeName+"-value")||b.getAttribute("value"),
label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);k.after(this,"onChange",g.hitch(this,"_updateSelection"));var b=this.store;b&&(b.getIdentity||b.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(b,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var b;b=this._notifyConnections.pop();)b.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(t,f,k,q){return t("dijit.DropDownMenu",q,{templateString:k,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(e){this._moveToPopup(e);e.stopPropagation();e.preventDefault()},
_onLeftArrow:function(e){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else e.stopPropagation(),e.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){return f("dijit._MenuBase",[c,
h,b,n],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){e.toggle(this.domNode,"dijitMenuActive",a);e.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=d.byNode(a);return a.parentNode==this.containerNode&&
b&&b.focus},postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:r.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(b,m.enter),function(){a.onItemHover(d.byNode(this))}),l(this.containerNode,l.selector(b,m.leave),function(){a.onItemUnhover(d.byNode(this))}),l(this.containerNode,l.selector(b,p),function(b){a.onItemClick(d.byNode(this),b);b.stopPropagation()}),l(this.containerNode,l.selector(b,"focusin"),function(){a._onItemFocus(d.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,
b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=l.once(c.domNode,"mouseover",r.hitch(this,"_onPopupHover")));var d=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&d.focusChild(a);d._cleanUp()},onExecute:r.hitch(this,
"_cleanUp",!0),onClose:function(){d._mouseoverHandle&&(d._mouseoverHandle.remove(),delete d._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(q.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(t,f,k,q,e,r,m,l,g,p){return f("dijit._KeyNavContainer",[g,p,l],{connectKeyNavHandlers:function(d,c){var f=this._keyNavCodes={},b=r.hitch(this,"focusPrev"),g=r.hitch(this,"focusNext");t.forEach(d,function(a){f[a]=b});t.forEach(c,function(a){f[a]=g});f[e.HOME]=r.hitch(this,"focusFirstChild");f[e.END]=r.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){q.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);t.forEach(this.getChildren(),
r.hitch(this,"_startupChild"))},addChild:function(d,c){this.inherited(arguments);this._startupChild(d)},_startupChild:function(d){d.set("tabIndex","-1")},_getFirst:function(){var d=this.getChildren();return d.length?d[0]:null},_getLast:function(){var d=this.getChildren();return d.length?d[d.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(d){return(d=
m.byNode(d))&&d.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(t,f,k,q,e,r,m,l){return f("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);k.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var f=this._keyNavCodes={};f[q.HOME]=e.hitch(this,"focusFirstChild");f[q.END]=e.hitch(this,
"focusLastChild");f[this.isLeftToRight()?q.LEFT_ARROW:q.RIGHT_ARROW]=e.hitch(this,"_onLeftArrow");f[this.isLeftToRight()?q.RIGHT_ARROW:q.LEFT_ARROW]=e.hitch(this,"_onRightArrow");f[q.UP_ARROW]=e.hitch(this,"_onUpArrow");f[q.DOWN_ARROW]=e.hitch(this,"_onDownArrow")}var l=this,f="string"==typeof this.childSelector?this.childSelector:e.hitch(this,"childSelector");this.own(r(this.domNode,"keypress",e.hitch(this,"_onContainerKeypress")),r(this.domNode,"keydown",e.hitch(this,"_onContainerKeydown")),r(this.domNode,
"focus",e.hitch(this,"_onContainerFocus")),r(this.containerNode,r.selector(f,"focusin"),function(d){l._onChildFocus(m.getEnclosingWidget(this),d)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(e,f){e&&(this.focusedChild&&e!==this.focusedChild&&this._onChildBlur(this.focusedChild),e.set("tabIndex",this.tabIndex),e.focus(f?"end":"start"))},_onContainerFocus:function(e){e.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){k.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(e){k.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(e){e&&e!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),e.set("tabIndex",this.tabIndex),this.lastFocused=e,this._set("focusedChild",e))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(e,f,d,c){e&&this.focusChild(e)},_keyboardSearchCompare:function(e,f){var d=e.domNode;e=(e.label||(d.focusNode?
d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,f.length).toLowerCase();return f.length&&e==f?-1:0},_isFormElement:function(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||"BUTTON"===e.tagName},_onContainerKeydown:function(e){if(!this._isFormElement(document.activeElement)){var f=this._keyNavCodes[e.keyCode];f?(f(e,this.focusedChild),e.stopPropagation(),e.preventDefault(),this._searchString=""):e.keyCode!=q.SPACE||!this._searchTimer||
e.ctrlKey||e.altKey||e.metaKey||(e.stopImmediatePropagation(),e.preventDefault(),this._keyboardSearch(e," "))}},_onContainerKeypress:function(e){this._isFormElement(document.activeElement)||e.charCode<=q.SPACE||e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),e.stopPropagation(),this._keyboardSearch(e,String.fromCharCode(e.charCode).toLowerCase()))},_keyboardSearch:function(f,l){var d=null,c,g=0;e.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=l;var b=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;c=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var e=this.focusedChild||null;if(1==b||!e)if(e=this._getNextFocusableChild(e,1),!e)return;b=e;do{var a=this._keyboardSearchCompare(e,c);a&&0==g++&&(d=e);if(-1==a){g=-1;break}e=this._getNextFocusableChild(e,1)}while(e&&e!=b)})();this.onKeyboardSearch(d,f,c,g)},_onChildBlur:function(){},_getNextFocusableChild:function(e,f){var d=
e;do{if(e)e=this._getNext(e,f);else if(e=this[0<f?"_getFirst":"_getLast"](),!e)break;if(null!=e&&e!=d&&e.isFocusable())return e}while(e!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(e,f){if(e)for(e=e.domNode;e;)if((e=e[0>f?"previousSibling":"nextSibling"])&&"getAttribute"in e){var d=m.byNode(e);if(d)return d}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c){m=t("dijit.MenuItem"+(r("dojo-bidi")?"_NoBidi":""),[l,g,p,d],{templateString:c,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(c){this._set("label",c);var b="",d;d=c.search(/{\S}/);if(0<=d){var b=c.charAt(d+1),a=c.substr(0,d);c=c.substr(d+3);d=a+b+c;c=a+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+c}else d=c;this.domNode.setAttribute("aria-label",d+" "+this.accelKey);this.containerNode.innerHTML=c;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(c){!c||"label"in this.params||this._set("label",c.innerHTML)},buildRendering:function(){this.inherited(arguments);k.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&k.set(this.accelKeyNode,"id",this.id+"_accel");f.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==r("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(n){}},_setSelected:function(c){q.toggle(this.domNode,
"dijitMenuItemSelected",c)},setLabel:function(c){e.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",c)},setDisabled:function(c){e.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",c)},_setDisabledAttr:function(c){this.focusNode.setAttribute("aria-disabled",c?"true":"false");this._set("disabled",c)},_setAccelKeyAttr:function(c){this.accelKeyNode&&(this.accelKeyNode.style.display=
c?"":"none",this.accelKeyNode.innerHTML=c,k.set(this.containerNode,"colSpan",c?"1":"2"));this._set("accelKey",c)}});r("dojo-bidi")&&(m=t("dijit.MenuItem",m,{_setLabelAttr:function(c){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return m})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(t,f){return t("dijit._Contained",null,{_getSibling:function(f){var k=this.getParent();return k&&k._getSiblingOfChild&&k._getSiblingOfChild(this,
"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return f&&f.getIndexOfChild?f.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(t,f,k,q,e,r){return t("dijit.MenuSeparator",[k,q,e],{templateString:r,
buildRendering:function(){this.inherited(arguments);f.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(t,f,k,q){return t(f,{baseClass:"jimu-loading-indicator jimu-agol-loading",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&k.set(this.domNode,{display:"none"});
k.set(this.domNode,{width:"100%",height:"100%"});q.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&this.hidden&&(k.set(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(k.set(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),
function(t,f,k,q,e,r,m,l,g){function p(a){var b;b=new e;b.outFields=[a.fieldName];b.outStatistics=[];b.geometry=a.geometry;var d=c(a);t.forEach(d,function(c){var d=new k;d.statisticType=c;d.displayFeildName=a.fieldName;d.onStatisticField=a.fieldName;d.outStatisticFieldName=u[c];b.outStatistics.push(d)});b.where=a.filterExpression?a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(b.geometry=a.geometry);return(new q(a.layer.url)).execute(b).then(function(b){return b&&
b.features&&0<b.features.length?(b=b.features[0].attributes,h(a,b),b):[]})}function d(a){var b={countField:0,sumField:0},d=c(a),e=0,f=0;a.featureSet.features.forEach(function(c){var g=c.attributes[a.fieldName];null!==g&&"undefined"!==typeof g&&d.forEach(function(a){switch(a){case "count":b.countField++;break;case "sum":b.sumField+=g;break;case "min":b.minField="undefined"===typeof b.minField?g:Math.min(b.minField,g);break;case "max":b.maxField="undefined"===typeof b.maxField?g:Math.max(b.maxField,
g);break;case "avg":e++,f+=g}})});b.avgField=0===e?0:0===e?"":f/e;var g=a.featureSet.features.filter(function(b){b=b.attributes[a.fieldName];return null===b||"undefined"===typeof b?!1:!0}).map(function(b){return b.attributes[a.fieldName]});b.stddevField=n(g);h(a,b);return b}function c(b){return b.statisticTypes&&0<b.statisticTypes.length?a.filter(function(a){return-1<b.statisticTypes.indexOf(a)}):a}function n(a){var b=a.length;if(1>=b)return 0;var c=0;a.forEach(function(a){c+=a});var d=c/b,e=0;a.forEach(function(a){e+=
Math.pow(a-d,2)});return Math.sqrt(1/(b-1)*e)}function b(a){var b=l.getInstanceSync();return a.layer?b.getLayerOrTableInfoById(a.layer.id).loadInfoTemplate().then(function(a){var b={};a.info&&a.info.fieldInfos&&a.info.fieldInfos.forEach(function(a){b[a.fieldName]=a});return b}):f({})}function h(a,b){if(a.fieldInfos&&a.fieldInfos[a.fieldName])for(var c in b)"countField"!==c&&r.isDefined(b[c])&&(b[c]=null===b[c]||"undefined"===typeof b[c]?"":m.localizeNumberByFieldInfo(b[c],a.fieldInfos[a.fieldName]))}
var a="count sum min max avg stddev".split(" "),u={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};g.getStatisticsResult=function(a){return b(a).then(function(b){a.fieldInfos=b;if(a.featureSet)return f(d(a));if(a.layer){if(a.layer.url)return p(a);a.featureSet=m.toFeatureSet(a.layer.graphics);return f(d(a))}})};g.isStatFromServer=function(a){return a.layer&&a.layer.url};g.getStddevVal=n;g.getStatisticsResultFromClientSync=d})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n){return t(g,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(b,c){return 0<b.features.length&&b.features[0].geometry&&c&&c.geometryType&&c.fields&&c.objectIdField},onExecute:function(b,c){var a;b={layerDefinition:{geometryType:c.geometryType,fields:f.clone(c.fields),objectIdField:c.objectIdField},featureSet:b.toJson()};b=new r(b);(a=c._json?q.parse(c._json):null)&&a.drawingInfo&&a.drawingInfo.renderer?(a=a.drawingInfo.renderer,a=m.fromJson(a)):
a=m.fromJson(c.renderer.toJson());b.setRenderer(a);(c=c.getSelectionSymbol())&&b.setSelectionSymbol(l.fromJson(c.toJson()));this._popupAddLayer(b)},_popupAddLayer:function(b){var c,a=k.create("div",{style:"padding: 0 10px 0 10px;"}),g=(new d({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(a);k.setStyle(g.searchBtn,"display","none");var l=new p({content:a,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,
function(){b.name=n.stripHTML(g.getValue());this._addLayerToMap(b);l.close();c&&c.remove&&c.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){l.close();c&&c.remove&&c.remove()})}]});g.inputSearch.focus();l.disableButton(0);c=e(g.inputSearch,"keyup",function(){g.getValue()?l.enableButton(0):l.disableButton(0)})},_addLayerToMap:function(b){var d=c.getInstanceSync(),a=e(d,"layerInfosChanged",f.hitch(this,function(c){b.id===c.id&&(c.enablePopup(),
a.remove())}));this.map.addLayer(b)}})})},"jimu/dijit/Search":function(){define("dojo/_base/declare dojo/_base/html dojo/string dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(t,f,k,q,e,r){return t([e,r],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&f.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return k.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(e){this.doChange();(void 0!==e.keyCode?e.keyCode:e.which)===q.ENTER&&this.doSearch();e.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()},
doChange:function(){if(this.onChange)this.onChange(this.getValue())}})})},"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(t,f,k,q,e,r,m){return t(f,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(e){this._getMarkerLayer();return this._isSupportType(e)&&0<e.features.length&&e.features[0]&&e.features[0].geometry&&
!1===this._isFeatureInMarkerFeatureActionLayer(e)},onExecute:function(e,f){this._addMarker(e,f)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new q({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var e=this.map.snappingManager.layerInfos;e.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(e)}},_addMarker:function(f,
g){var l=f.features[0].geometry,d={};g=g.displayField||f.displayFieldName||g.objectIdField;d.title="";f.features[0].attributes&&g&&(d.title=f.features[0].attributes[g],d.title||(d.title=""));g={};if("point"===l.type)g=l;else if("polygon"===l.type||"polyline"===l.type||"multipoint"===l.type)g=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:l.getExtent().getCenter();g.getLongitude()&&g.getLatitude()?(d.longitude=g.getLongitude(),d.latitude=g.getLatitude()):g.x&&g.y&&
(d.x=g.x,d.y=g.y);var c="";l&&l.spatialReference&&l.spatialReference.wkid&&(c=l.spatialReference.wkid);d.spatialReference={wkid:c};l=m.getXyContent(d);d=m.getShareUrl(this.map,d,!0);d=m.getShareUrlContent(d);d=l+d;l=new e(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");l.width=26;l.height=26;l.setOffset(0,l.height/2);g=new k(g,l,null,null);g._markerFeatureactionGraphic=f.features[0];g.infoTemplate=this._setInfoTemplate(d);this._markerLayer.add(g);this._closePopupWindow()},_setInfoTemplate:function(e){var f=
new r;f.setContent(e);return f},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(e){return e.features[0]&&e.features[0]._graphicsLayer&&e.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===e.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(e){if(e&&e.geometryType){if(e.features&&e.features.length&&1<e.features.length)return!1;e=e.geometryType;return"point"===e||"polygon"===e||"polyline"===
e||"multipoint"===e}return!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(t,f,k){return t(f,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(f){this._getMarkerLayer();return 0<f.features.length&&f.geometryType&&f.features[0]&&f.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(f)},onExecute:function(f){this._removeMarker(f)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new k({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var f=this.map.snappingManager.layerInfos;f.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(f)}},_removeMarker:function(f){f=f.features[0];f._textSymbol&&this._markerLayer.remove(f._textSymbol);this._markerLayer.remove(f);this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(f){return f.features[0]&&
f.features[0]._graphicsLayer&&f.features[0]._graphicsLayer.id?"marker-feature-action-layer"===f.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils esri/IdentityManager jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){return t(c,{name:"SaveToMyContent",
iconClass:"icon-save",isFeatureSupported:function(b){return 0>=b.features.length||!b.features[0].geometry?!1:!0},onExecute:function(c,a){this.checkPrivilege().then(f.hitch(this,function(e){if(e)var g=new b({appConfig:this.appConfig}),h=new n({content:g,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){g.showBusy();h.disableButton(0);g.validate().then(f.hitch(this,function(b){b.valid?this._addItem(c,
a,g):(g.hideBusy(),h.enableButton(0))}))})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){h.close()})}]});else new d({message:window.jimuNls.noEditPrivileges})}))},checkPrivilege:function(){var b=g.getStandardPortalUrl(this.appConfig.portalUrl),a=l.getPortal(b);if(a){if(a.haveSignIn())return this._hasPrivilege(a);m.useSignInPage=!1;return a.signIn().then(f.hitch(this,function(){m.useSignInPage=!0;return this._hasPrivilege(a)}),f.hitch(this,function(){m.useSignInPage=
!0}))}b=new e;b.resolve(!1);return b},_hasPrivilege:function(b){return b.loadSelfInfo().then(f.hitch(this,function(a){if(a&&a.user){var b=new p({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role});a.user.privileges&&b.setPrivileges(a.user.privileges);return b.canCreateItem()&&b.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(b,a,c){var e=c.getName(),g=c.getFolderId(),h=c.popup;a=a||{};var n={name:a.name||a.id,type:a.type||"Feature Layer",displayField:a.displayField,
description:a.description,copyrightText:a.copyright,geometryType:a.geometryType||b.geometryType,fields:a.fields||b.fields,objectIdField:a.objectIdField};b.features[0].geometry&&(a=r.graphicsExtent(b.features),n.initialExtent=a,n.fullExtent=a,n.extent=a);!n.objectIdField&&n.fields&&k.some(n.fields,function(a){if("esriFieldTypeOID"===a.type)return n.objectIdField=a.name,!0});b={layers:[{layerDefinition:n,featureSet:b.toJson()}]};c.addItem({name:e,title:e,type:"Feature Collection",typeKeywords:"WAB_created",
text:q.stringify(b)},g).then(f.hitch(this,function(a){!0===a.success?h.close():(c.hideBusy(),h.enableButton(0),new d({message:a.error?a.error.message:""}))}),function(a){c.hideBusy();h.enableButton(0);new d({message:a.message})})}})})},"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d){return t([e,r,m],{baseClass:"jimu-item-form",templateString:l,appConfig:null,folderStore:null,portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var c=p.getStandardPortalUrl(this.appConfig.portalUrl);g.getPortal(c).getUser().then(f.hitch(this,function(c){this.portalUser=c;return c.getContent()})).then(f.hitch(this,function(c){this.folderStore=this._createFolderStore(c.folders,this.portalUser.username);
this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr","name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var c=new q;this.itemForm.validate()?c.resolve({valid:!0}):
c.resolve({valid:!1,message:"param requried"});return c},addItem:function(c,d){if(this.portalUser)return this.portalUser.addItem(c,d);c=new q;c.resolve({error:{message:"portalUser is null"}});return c},_createFolderStore:function(c,e){var b=new d({data:{identifier:"id",label:"name",items:[]}});b.newItem({name:e,id:""});k.forEach(c,function(c){b.newItem({name:c.title,id:c.id})});return b}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox",
"./ComboBoxMixin"],function(t,f,k,q,e){return t("dijit.form.FilteringSelect",[q,e],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(e,f,l,g){f&&f[this.searchAttr]!==this._lastQuery||!f&&e.length&&this.store.getIdentity(e[0])!=this._lastQuery||(e.length?this.set("item",e[0],g):this.set("value",
"",g||void 0===g&&!this.focused,this.textbox.value,null))},_openResultList:function(e,f,l){f[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(e,m,l,g){this._onChangeActive||(m=null);if(void 0===g){if(null===e||""===e)if(e="",!f.isString(l)){this._setDisplayedValueAttr(l||"",m);return}var p=this;this._lastQuery=e;k(this.store.get(e),
function(d){p._callbackSetLabel(d?[d]:[],void 0,void 0,m)})}else this.valueNode.value=e,this.inherited(arguments,[e,m,l,g])},_setItemAttr:function(e,f,l){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(e){return e.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(e,m){null==e&&(e="");if(!this._created){if(!("displayedValue"in this.params))return;m=!1}if(this.store){this.closeDropDown();var l=f.clone(this.query),g=this._getDisplayQueryString(e),
p;this.store._oldAPI?p=g:(p=this._patternToRegExp(g),p.toString=function(){return g});this._lastQuery=l[this.searchAttr]=p;this._lastDisplayedValue=this.textbox.value=e;this._set("displayedValue",e);var d=this,c={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};f.mixin(c,this.fetchProperties);this._fetchHandle=this.store.query(l,c);k(this._fetchHandle,function(e){d._fetchHandle=null;d._callbackSetLabel(e||[],l,c,m)},function(c){d._fetchHandle=null;d._cancelingQuery||console.error("dijit.form.FilteringSelect: "+
c.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(t,f,k,q){return t("dijit.form.MappedTextBox",q,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(e){return e.toString?e.toString():""},toString:function(){var e=this.filter(this.get("value"));return null!=
e?"string"==typeof e?e:this.serialize(e,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=k.place("\x3cinput type\x3d'hidden'"+(this.name&&!f("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(t,f,k,q,e,r,m,l,g){return t("dijit.form.ComboBoxMixin",[l,r],{dropDownClass:m,hasDownArrow:!0,templateString:g,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(e){this._set("hasDownArrow",e);this._buttonNode.style.display=e?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(g){g.get||q.mixin(g,{_oldAPI:!0,get:function(d){var c=new f;this.fetchItemByIdentity({identity:d,
onItem:function(d){c.resolve(d)},onError:function(d){c.reject(d)}});return c.promise},query:function(d,c){var g=new f(function(){b.abort&&b.abort()});g.total=new f;var b=this.fetch(q.mixin({query:d,onBegin:function(b){g.total.resolve(b)},onComplete:function(b){g.resolve(b)},onError:function(b){g.reject(b)}},c));return e(g)}});this._set("store",g)},postMixInProperties:function(){var e=this.params.store||this.store;e&&this._setStoreAttr(e);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var d=this.declaredClass;q.mixin(this.store,{getValue:function(c,e){k.deprecated(d+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return c[e]},getLabel:function(c){k.deprecated(d+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return c.name},fetch:function(c){k.deprecated(d+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
q.hitch(this,function(d){(new d({objectStore:this})).fetch(c)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(t,f,k,q,e,r,m,l,g,p,d){f=f("dijit.form._AutoCompleterMixin",d,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(c){var d=0;if("number"==typeof c.selectionStart)d=c.selectionStart;else if(l("ie")){var b=c.ownerDocument.selection.createRange().duplicate();c=c.createTextRange();b.move("character",0);c.move("character",0);try{c.setEndPoint("EndToEnd",b),d=String(c.text).replace(/\r/g,"").length}catch(h){}}return d},_setCaretPos:function(c,d){d=parseInt(d);p.selectInputText(c,d,d)},_setDisabledAttr:function(c){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",c?"true":"false")},_onKey:function(c){if(!(32<=c.charCode)){var d=c.charCode||c.keyCode;if(d!=q.ALT&&d!=q.CTRL&&d!=q.META&&d!=q.SHIFT){var b=this.dropDown,e=null;this._abortQuery();this.inherited(arguments);if(!(c.altKey||c.ctrlKey||c.metaKey))switch(this._opened&&(e=b.getHighlightedOption()),d){case q.PAGE_DOWN:case q.DOWN_ARROW:case q.PAGE_UP:case q.UP_ARROW:this._opened&&this._announceOption(e);c.stopPropagation();c.preventDefault();break;case q.ENTER:if(e){if(e==
b.nextButton){this._nextSearch(1);c.stopPropagation();c.preventDefault();break}else if(e==b.previousButton){this._nextSearch(-1);c.stopPropagation();c.preventDefault();break}c.stopPropagation();c.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case q.TAB:d=this.get("displayedValue");if(b&&(d==b._messages.previousMessage||d==b._messages.nextMessage))break;e&&this._selectOption(e);case q.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(c){var d=this.focusNode;p.selectInputText(d,d.value.length);var b=this.ignoreCase?"toLowerCase":"substr";0==c[b](0).indexOf(this.focusNode.value[b](0))?(b=this.autoComplete?this._getCaretPos(d):d.value.length,b+1>d.value.length&&(d.value=c,p.selectInputText(d,b))):(d.value=c,p.selectInputText(d))},_openResultList:function(c,d,b){var f=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();c.length||0!=b.start?(this._nextSearch=this.dropDown.onPage=e.hitch(this,
function(a){c.nextPage(-1!==a);this.focus()}),this.dropDown.createOptions(c,b,e.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in b?(b.direction?this.dropDown.highlightFirstOption():b.direction||this.dropDown.highlightLastOption(),f&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(d[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var c=this.get("displayedValue"),d=this.dropDown;!d||c!=d._messages.previousMessage&&c!=d._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",c)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(c,d,b){var e="";c&&(b||(b=this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]),e=this._getValueField()!=this.searchAttr?this.store.getIdentity(c):b);this.set("value",e,d,b,c)},_announceOption:function(c){if(c){var d;
if(c==this.dropDown.nextButton||c==this.dropDown.previousButton)d=c.innerHTML,this.item=void 0,this.value="";else{var b=this.dropDown.items[c.getAttribute("item")];d=(this.store._oldAPI?this.store.getValue(b,this.searchAttr):b[this.searchAttr]).toString();this.set("item",b,!1,d)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",k.get(c,"id"));this._autoCompleteText(d)}},_selectOption:function(c){this.closeDropDown();c&&
this._announceOption(c);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(c){if(!this.dropDown){var d=this.id+"_popup";this.dropDown=new (e.isString(this.dropDownClass)?e.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:e.hitch(this,
this._selectOption),id:d,dir:this.dir,textDir:this.textDir})}this._lastInput=c;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new g({},this.srcNodeRef),!("value"in this.params))){var c=this.item=this.store.fetchSelectedItem();if(c){var d=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(c,d):c[d]}}},postCreate:function(){var c=r('label[for\x3d"'+
this.id+'"]');c.length&&(c[0].id||(c[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",c[0].id));this.inherited(arguments);t.after(this,"onSearch",e.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(c){c=this.labelFunc(c,this.store);var d=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(c=this.doHighlight(c,this._lastInput),d="html");return{html:"html"==d,label:c}},doHighlight:function(c,d){var b=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),e=this.queryExpr.indexOf("${0}");d=m.escapeString(d);return this._escapeHtml(c.replace(new RegExp((0==e?"^":"")+"("+d+")"+(e==this.queryExpr.length-4?"$":""),b),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(c){return c=String(c).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(c,d){return(d._oldAPI?d.getValue(c,this.labelAttr||this.searchAttr):c[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(c,d,b,e){this._set("item",e||null);null==c&&(c="");this.inherited(arguments)}});l("dojo-bidi")&&f.extend({_setTextDirAttr:function(c){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",c)}});return f})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(t,f,k,q,e,r){function m(e){return{id:e.value,value:e.value,name:k.trim(e.innerText||e.textContent||"")}}return t("dijit.form.DataList",e,{constructor:function(e,g){this.domNode=f.byId(g);k.mixin(this,e);this.id&&r.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:q("option",this.domNode).map(m)}])},destroy:function(){r.remove(this.id)},fetchSelectedItem:function(){var e=q("\x3e option[selected]",this.domNode)[0]||q("\x3e option",this.domNode)[0];return e&&m(e)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(t,f,k,q,e,r,m){return t("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(e){this._set("list",e)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(e){return new RegExp("^"+e.replace(/(\\.)|(\*)|(\?)|\W/g,function(e,f,d,c){return d?".*":
c?".":f?f:"\\"+e})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(e){if(!this.disabled&&
!this.readOnly){e=e.charOrCode;this._prev_key_backspace=!1;if(e==f.DELETE||e==f.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(f){this._abortQuery();var g=this,l=k.clone(this.query),d={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},c=e.substitute(this.queryExpr,
[f.replace(/([\\\*\?])/g,"\\$1")]),n,b=function(){var c=g._fetchHandle=g.store.query(l,d);g.disabled||g.readOnly||n!==g._lastQuery||r(c,function(a){g._fetchHandle=null;g.disabled||g.readOnly||n!==g._lastQuery||r(c.total,function(c){a.total=c;var e=g.pageSize;if(isNaN(e)||e>a.total)e=a.total;a.nextPage=function(c){d.direction=c=!1!==c;d.count=e;c?(d.start+=a.length,d.start>=a.total&&(d.count=0)):(d.start-=e,0>d.start&&(d.count=Math.max(e+d.start,0),d.start=0));0>=d.count?(a.length=0,g.onSearch(a,l,
d)):b()};g.onSearch(a,l,d)})},function(a){g._fetchHandle=null;g._cancelingQuery||console.error(g.declaredClass+" "+a.toString())})};k.mixin(d,this.fetchProperties);this.store._oldAPI?n=c:(n=this._patternToRegExp(c),n.toString=function(){return c});this._lastQuery=l[this.searchAttr]=n;this._queryDeferHandle=this.defer(b,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var e=this.list;e&&(this.store=m.byId(e))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(t,f,k,q,e,r,m,l){return t("dijit.form._ComboBoxMenu",[e,r,l,m],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(f.add(this.previousButton,"dijitMenuItemRtl"),f.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var e=this.ownerDocument.createElement("div");e.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");e.setAttribute("role","option");return e},onHover:function(e){f.add(e,"dijitMenuItemHover")},onUnhover:function(e){f.remove(e,
"dijitMenuItemHover")},onSelect:function(e){f.add(e,"dijitMenuItemSelected")},onDeselect:function(e){f.remove(e,"dijitMenuItemSelected")},_page:function(e){var f=0,d=this.domNode.scrollTop,c=k.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();f<c;){var g=this.getHighlightedOption();if(e){if(!g.previousSibling||"none"==g.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!g.nextSibling||"none"==g.nextSibling.style.display)break;this.selectNextNode()}g=
this.domNode.scrollTop;f+=(g-d)*(e?-1:1);d=g}},handleKey:function(e){switch(e.keyCode){case q.DOWN_ARROW:return this.selectNextNode(),!1;case q.PAGE_DOWN:return this._page(!1),!1;case q.UP_ARROW:return this.selectPreviousNode(),!1;case q.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(t,f,k,q,e){var r=f("dijit.form._ComboBoxMenuMixin"+
(q("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=e.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(e){this._set("value",e);this.onChange(e)},onClick:function(e){if(e==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(e==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(e)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(e,f){var g=this._createMenuItem();e=f(e);e.html?g.innerHTML=e.label:g.appendChild(g.ownerDocument.createTextNode(e.label));""==g.innerHTML&&(g.innerHTML="\x26#160;");return g},createOptions:function(e,f,g){this.items=e;this.previousButton.style.display=0==f.start?"none":"";k.set(this.previousButton,"id",this.id+
"_prev");t.forEach(e,function(d,c){d=this._createOption(d,g);d.setAttribute("item",c);k.set(d,"id",this.id+c);this.nextButton.parentNode.insertBefore(d,this.nextButton)},this);var l=!1;e.total&&!e.total.then&&-1!=e.total?f.start+f.count<e.total?l=!0:f.start+f.count>e.total&&f.count==e.length&&(l=!0):f.count==e.length&&(l=!0);this.nextButton.style.display=l?"":"none";k.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var e=this.containerNode;2<e.childNodes.length;)e.removeChild(e.childNodes[e.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});q("dojo-bidi")&&(r=f("dijit.form._ComboBoxMenuMixin",
r,{_createOption:function(){var e=this.inherited(arguments);this.applyTextDir(e);return e}}));return r})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(t,f,k,q){return t("dijit.form._ListMouseMixin",q,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(e,f){this._setSelectedAttr(f,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(f)})},_onMouseDown:function(e,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(f,!1)},_onMouseUp:function(e,f){this._isDragging=!1;var m=this.selected,l=this._hoveredNode;m&&f==m?this.defer(function(){this._onClick(e,
m)}):l&&this.defer(function(){this._onClick(e,l)})},_onMouseOut:function(e,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(e,f){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=f;this.onHover(f);this._isDragging&&this._setSelectedAttr(f,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(t,f,k){return t("dijit.form._ListBase",null,{selected:null,_listConnect:function(k,e){var r=this;return r.own(f(r.containerNode,f.selector(function(e,f,g){return e.parentNode==g},k),function(f){r[e](f,this)}))},selectFirstNode:function(){for(var f=this.containerNode.firstChild;f&&"none"==f.style.display;)f=f.nextSibling;this._setSelectedAttr(f,!0)},selectLastNode:function(){for(var f=this.containerNode.lastChild;f&&"none"==f.style.display;)f=f.previousSibling;this._setSelectedAttr(f,
!0)},selectNextNode:function(){var f=this.selected;if(f){for(f=f.nextSibling;f&&"none"==f.style.display;)f=f.nextSibling;f?this._setSelectedAttr(f,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var f=this.selected;if(f){for(f=f.previousSibling;f&&"none"==f.style.display;)f=f.previousSibling;f?this._setSelectedAttr(f,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(f,e){if(this.selected!=f){var r=this.selected;if(r)this.onDeselect(r);
f&&(e&&k.scrollIntoView(f),this.onSelect(f));this._set("selected",f)}else if(f)this.onSelect(f)}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(t,f,k,q,e){return t([f,k],{baseClass:"jimu-loading-shelter jimu-agol-loading",declaredClass:"jimu.dijit.LoadingShelter",templateString:q,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=
window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&e.setStyle(this.domNode,"display","none");e.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||e.setStyle(this.loadingNode,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),e.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&
!this.hidden&&(e.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array jimu/accessibleUtils dojo/on dojo/keys dijit/a11yclick dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n){var b=null,h=t([p,d],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv role\x3d"title" class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode" tabindex\x3d"0"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._setFocusedNodeBeforeOpen();this.inherited(arguments);this.hide();this.menuItems=[];this.own(r(this.domNode,"click",k.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||f.isDescendant(a,this.menuNode)||this.hide()})));this._a11y_addEvents()},_setFocusedNodeBeforeOpen:function(){this.focusedNodeBeforeOpen=document.activeElement},_a11y_addEvents:function(){this.own(r(this.labelNode,"keydown",k.hitch(this,function(a){a.shiftKey&&a.keyCode===m.TAB&&(a.preventDefault(),
this.hide())})));this.own(r(this.closeBtn,l,k.hitch(this,this.hide)));this.own(r(this.menuContent,"focus",k.hitch(this,function(){this.currentMenuItem=this.menuItems[0].domNode;q.forEach(this.menuItems,function(a){f.hasClass(a.domNode,"selected")&&(this.currentMenuItem=a.domNode)});this.currentMenuItem.focus()})));this.own(r(this.menuContent,"keydown",k.hitch(this,function(a){a.keyCode===m.ESCAPE&&(a.stopPropagation(),this.hide());if(f.hasClass(a.target,"popup-menu-item"))if(a.keyCode!==m.TAB||(!a.shiftKey||
this.hasTitle)&&a.shiftKey){var b;a.keyCode===m.DOWN_ARROW?b=this.currentMenuItem.nextSibling?this.currentMenuItem.nextSibling:this.currentMenuItem:a.keyCode===m.UP_ARROW?b=this.currentMenuItem.previousSibling?this.currentMenuItem.previousSibling:this.currentMenuItem:a.keyCode===m.HOME?b=this.menuItems[0].domNode:a.keyCode===m.END&&(b=this.menuItems[this.menuItems.length-1].domNode);b&&(this.currentMenuItem=b,b.focus())}else a.preventDefault(),this.hide()})))},setActions:function(a){this.clearActions();
q.forEach(a,k.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];f.empty(this.menuContent)},_addMenuItem:function(a){var b=new n({action:a});f.place(b.domNode,this.menuContent);b.startup();this.menuItems.push(b);this.own(r(b,"click",k.hitch(this,function(a){a?(a=0<=["ShowStatistics","SaveToMyContent","ChangeSymbol"].indexOf(b.action.name),e.isInNavMode()&&a||this.hide()):this.hide()})))},markAsSelected:function(a){q.forEach(this.menuItems,
function(b){b.action.label===a.label?b.setSelected(!0):b.setSelected(!1)})},prepareActions:function(a,b){return c.getInstance().getSupportedActions(a).then(k.hitch(this,function(c){!1===b&&(c=q.filter(c,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));q.forEach(c,function(b){b.data=a},this);this.setActions(c)}))},hide:function(){f.setStyle(this.domNode,"display","none");this.focusedNodeBeforeOpen&&this.focusedNodeBeforeOpen.focus()},show:function(a,b){if(0===this.menuItems.length)f.setStyle(this.domNode,
"display","none");else{"string"===typeof b&&""!==b?(this.labelNode.innerHTML=b,f.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",f.setStyle(this.titleNode,"display","none"));var c=a.y+a.h,d;a=window.isRTL?a.x:a.x+a.w;f.setStyle(this.domNode,"display","");f.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});d=g.getMarginSize(this.menuNode);f.setStyle(this.menuNode,{left:(window.isRTL?a+d.w>window.innerWidth?window.innerWidth-d.w:0>a?0:a:0>a-d.w?0:a>window.innerWidth?
window.innerWidth-d.w:a-d.w)+"px",top:(d.h>window.innerHeight?0:c+d.h>window.innerHeight?window.innerHeight-d.h:c+d.h+5<window.innerHeight?c+5:c)+"px"});"string"===typeof b&&""!==b?(this.labelNode.focus(),this.hasTitle=!0):(this.menuContent.focus(),this.hasTitle=!1)}}});h.getInstance=function(){null===b&&(b=new h,f.place(b.domNode,document.body),b.startup());b.setActions([]);return b};return h})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/keys dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),
function(t,f,k,q,e,r,m,l,g,p){return t([g,p,l],{baseClass:"popup-menu-item",templateString:'\x3cdiv role\x3d"option" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"icon jimu-float-leading" data-dojo-attach-point\x3d"iconContainer"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=
this.action.label,this.labelNode.title=this.action.label,this.action.iconClass?("no-icon"===this.action.iconClass&&f.addClass(this.iconContainer,"no-icon"),f.addClass(this.iconNode,this.action.iconClass)):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(e(this.domNode,m.enter,k.hitch(this,this._useHoverIcon))),this.own(e(this.domNode,m.leave,k.hitch(this,this._useNormalIcon))));this.own(e(this.domNode,"click",k.hitch(this,this._clickHandler)));this.own(e(this.domNode,
"keydown",k.hitch(this,function(d){d.keyCode===r.ENTER&&this._clickHandler(d,!0)})))},setSelected:function(d){d?f.addClass(this.domNode,"selected"):f.removeClass(this.domNode,"selected")},_useNormalIcon:function(){this.action.iconClass?f.removeClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?f.addClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+
this.action.getIcon("hover")+")")},_clickHandler:function(d,c){q.stop(d);if(this.action){var e;this.action.data.features&&0<this.action.data.features.length&&(e=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,e)}this.emit("click",{isEnter:c})}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/has dojo/query dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils esri/dijit/PopupTemplate jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E){var C=t([g,p],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new d;this.layerInfosObj=E.getInstanceSync();var a=f.getObject("_wabProperties.referToFeatureLayerId",!1,this.originalFeature)||this.originalFeature.getLayer().id;this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(a);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?q.addClass(this.previouBtn,"icon-arrow-forward"):q.addClass(this.previouBtn,
"icon-arrow-back");a=this._createOperation({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(a);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new C.PopupUIController(this):new C.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(a){a=a.data.oriJimuLayerInfo;
var b=new l;a.getRelatedTableInfoArray().then(f.hitch(this,function(a){b.resolve(a)}));return b},_getRelatedRecordsByRelatedQuery:function(a){return a.oriJimuLayerInfo.getRelatedRecords(a.feature,a.destJimuLayerInfo,a.relationshipIndex)},_ignoreCaseToGetFieldObject:function(a,b){var c=null;b&&a&&a.fields&&k.some(a.fields,function(a){if(a.name.toLowerCase()===b.toLowerCase())return c=a,!0});return c},getLocaleDateTime:function(a){return v.localizeDate(new Date(a),{fullYear:!0,formatLength:"medium"})},
_getDisplayTitleOfRelatedRecord:function(a,b,c){var d=a.getInfoTemplate();return(a="popupTitle"===c&&d?"function"===typeof d.title?d.title(b):d.title:this._getDisplayTitleFromPopup(a,b,c))?a:""},_getDisplayTitleFromPopup:function(a,b,c){(a=this._getPopupTemplateWithOnlyDisplayField(a,c))?(b.setInfoTemplate(a),c=this.popupUIController.getDisplayTitle(b),b.setInfoTemplate(null)):c=b.attributes[c];return c},_getPopupTemplateWithOnlyDisplayField:function(a,b){a=a._getCustomPopupInfo(a.layerObject,[b]);
return new u(a)},_canShowRelatedData:function(a){var b=!0;(a=a.getPopupInfo())&&a.relatedRecordsInfo&&(b=!1!==a.relatedRecordsInfo.showRelatedRecords);return b},setPopupContent:function(a){this._clearPage();a.data.destJimuLayerInfo?a.data.relatedFeature||this.showRelatedRecords(a):this.showFeature(a);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(a){var b=a.data,c=b.oriJimuLayerInfo.layerObject,d=f.getObject("_wabProperties.originalLayerName",
!1,c)||b.oriJimuLayerInfo.title,c=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,c),e=this._getDisplayTitleOfRelatedRecord(b.oriJimuLayerInfo,b.feature,c);"popupTitle"!==c&&(e=d+": "+e);this._setOperationTitle(e);f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,b.oriJimuLayerInfo.layerObject);b.oriJimuLayerInfo.loadInfoTemplate().then(f.hitch(this,function(c){b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(c);this.popupUIController.setFeature(a.data.feature);
b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(null)}));this.showRelatedTables(a);this.popupManager.initPopupMenu([a.data.feature]);this.popupUIController.updateZoomToBtn([a.data.feature])},showRelatedRecords:function(a){var b=a.data,c=f.getObject("_wabProperties.originalLayerName",!1,b.destJimuLayerInfo.layerObject)||b.destJimuLayerInfo.title;this._setOperationTitle(c);this._clearPage();f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",b,b.destJimuLayerInfo.layerObject);
f.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",b.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(b).then(f.hitch(this,function(c){0<c.length?this._setTitle(window.jimuNls.popup.relatedRecords):this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var d=this._showFieldSelector(b.destJimuLayerInfo);k.forEach(c,function(c,g){c._layer=
b.destJimuLayerInfo.layerObject;var h=this._getDisplayTitleOfRelatedRecord(b.destJimuLayerInfo,c,d);g=q.create("div",{"class":"item record-item "+(0===g%2?"oddLine":"evenLine"),innerHTML:h},this.contentBox);g.relatedRecord=c;g=e(g,"click",f.hitch(this,function(){this._addOperation(a);var d=this._createOperation({feature:c,oriJimuLayerInfo:b.destJimuLayerInfo,relationshipIndex:b.relationshipIndex});this.setPopupContent(d)}));this._temporaryData.eventHandles.push(g)},this);this.popupManager.initPopupMenu(c);
this.popupUIController.updateZoomToBtn(c)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(a){this._canShowRelatedData(a.data.oriJimuLayerInfo)&&this._getRelatedTableInfoArray(a).then(f.hitch(this,function(b){0<b.length&&this._setTitle(window.jimuNls.popup.relatedTables);var c={};k.forEach(b,function(b,d){void 0===c[b.id]?c[b.id]=0:c[b.id]++;d=q.create("div",{"class":"item table-item "+(0===d%2?"oddLine":"evenLine"),innerHTML:b.title},this.contentBox);var g=c[b.id];d=
e(d,"click",f.hitch(this,function(){b.getLayerObject().then(f.hitch(this,function(){this._addOperation(a);var c=this._createOperation({feature:a.data.feature,oriJimuLayerInfo:a.data.oriJimuLayerInfo,destJimuLayerInfo:b,relationshipIndex:g});this.setPopupContent(c)}))}));this._temporaryData.eventHandles.push(d)},this)}))},_createOperation:function(a){return new C.Operation({feature:a.feature||null,oriJimuLayerInfo:a.oriJimuLayerInfo||null,destJimuLayerInfo:a.destJimuLayerInfo||null,relatedFeature:a.relatedFeature||
null,relationshipIndex:a.relationshipIndex||0},this)},_addOperation:function(a){this.undoManager.add(a)},_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){q.empty(this.contentBox);k.forEach(this._temporaryData.eventHandles,function(a){a&&a.remove&&a.remove()},this);this._temporaryData.eventHandles=[];k.forEach(this._temporaryData.dijits,function(a){a&&a.destroy&&a.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(a,b){a&&q.create("div",{"class":"title-box "+
(b?b:""),innerHTML:a},this.contentBox)},_setOperationTitle:function(a){q.setAttr(this.operationTitle,"innerHTML",a);q.setAttr(this.operationTitle,"title",a)},_showFieldSelector:function(a){var b="objecid",c=m(".title-box",this.contentBox)[0],d=a.layerObject,g=[];if(!c||!a)return b;var h=a.getPopupInfo();h&&h.title&&g.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});var n=[];h&&h.fieldInfos?k.forEach(h.fieldInfos,function(a){var b={};a.visible&&(b.name=a.fieldName,b.alias=a.label,
n.push(b))}):n=d.fields;k.forEach(n,function(a){"globalid"!==a.name.toLowerCase()&&"shape"!==a.name.toLowerCase()&&g.push({label:a.alias||a.name,value:a.name})});c=(new z({items:g})).placeAt(c);c.domNode.title=window.jimuNls.popup.chooseFieldTip;var l=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,d),p=this._ignoreCaseToGetFieldObject(a.layerObject,a.layerObject.displayField||a.layerObject.objectIdField),u=x.getInstance().getAppConfig();l?b=l:"2.3"===u.configWabVersion&&
p&&p.name?b=p.name:h&&h.title?b="popupTitle":p&&p.name?b=p.name:0<g.length&&(b=g[0].value);b&&(c.setHighlightValue(b),f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,d));this._temporaryData.dijits.push(c);a=e(c,"click-item",f.hitch(this,function(a,b){m(".item.record-item",this.contentBox).forEach(f.hitch(this,function(c){f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,d);var e=this._getDisplayTitleOfRelatedRecord(a,c.relatedRecord,b);c.innerHTML=e}))},
a));this._temporaryData.eventHandles.push(a);return b}});C.Operation=t([c],{constructor:function(a,b){this.data=a;this.relatedRecordsPopupProjector=b},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});C.PopupUIController=t([],{constructor:function(a){this.rrPopupProjector=a;this.popup=a.popup;this.initTempPopup();this._initTempPopupForDisplayTitle();this._initZoomToBtn();this._setScrollable()},initTempPopup:function(){this._tempPopup=new b({},q.create("div"))},_initTempPopupForDisplayTitle:function(){this._tempPopupForDisplayTitle=
new b({},q.create("div"));this._tempPopupForDisplayTitle.show()},destroy:function(){this._tempPopup.destroy();this._tempPopupForDisplayTitle.destroy();this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&q.destroy(this._zoomToBtnANode);this.toucemoveScrollHandle&&this.toucemoveScrollHandle.remove&&this.toucemoveScrollHandle.remove()},addDomNode:function(a){setTimeout(f.hitch(this,function(){q.place(a,this._getRefDomNode(),"after")}),
1)},setFeature:function(a){this._tempPopup.setFeatures([a]);if(a=m(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(a),q.place(this.rrPopupProjector.domNode,a,"after"),this._unsetScrollable()},setContent:function(a){var b=m(".related-records-popup-projector").parent()[0];b&&b.removeChild(this.rrPopupProjector.domNode);this.popup.setContent(a);this._unsetScrollable()},_setScrollable:function(){var a=m(".contentPane",this.popup.domNode)[0];r("esri-touch")&&a&&(this.toucemoveScrollHandle=
e(a,"touchmove",f.hitch(this,function(b){b.preventDefault();m(".esriViewPopup",this.popup.domNode)[0]&&(b=a.firstChild,b instanceof Text&&(b=a.childNodes[1]),this.rrPopupProjector.domNode&&q.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+b._currentX+"px, "+b._currentY+"px)"}))})))},_unsetScrollable:function(){q.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"none","-webkit-transform":"none"});
q.setStyle(this.rrPopupProjector.domNode,{"-webkit-transition-property":"none","-webkit-transform":"none"})},getDisplayTitle:function(a){this._tempPopupForDisplayTitle.setFeatures([a]);return(a=m("td.attrValue",this._tempPopupForDisplayTitle.domNode)[0])&&a.innerHTML},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return m(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",
!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var a=m(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=m(".action",a)[0];this._zoomToBtnANode=q.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},a);this._zoomToBtn=q.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&q.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&
q.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&q.setStyle(this._oldZoomToBtnANdoe,"display","none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&q.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(b){this._hideOldZoomToBtn();!b||1>b.length||!b[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),
this._zoomToBtnClickHandle=e(this._zoomToBtn,"click",f.hitch(this,function(){var c=null;try{c=a.graphicsExtent(b)}catch(B){console.error(B)}c&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(c),this.popup.hide())})))},changeRefDomNode:function(){q.setStyle(this.rrPopupProjector.operationBox,"display","block");q.addClass(this.rrPopupProjector.domNode,"second-page-mode");var a=this._getViewPopupDomNode();a&&q.addClass(a,"second-page-mode")},revertRefDomNode:function(){q.setStyle(this.rrPopupProjector.operationBox,
"display","none");q.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});C.PopupMobileUIController=t([C.PopupUIController],{initTempPopup:function(){this._tempPopup=new h({},q.create("div"))},setFeature:function(a){this._tempPopup.setFeatures([a]);a=m(".esriMobileInfoView.esriMobilePopupInfoView",this._tempPopup.domNode)[0];if(a=m(".esriViewPopup",a)[0])this.setContent(a),q.place(this.rrPopupProjector.domNode,a,"after")},updateZoomToBtn:function(){},
_initZoomToBtn:function(){},_getRefDomNode:function(){return m(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var a=m(".esriMobileInfoView.esriMobilePopupInfoView")[0];return m(".esriViewPopup",a)[0]}});return C})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),function(t,f,k,q,e,r){t=t([r],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,
canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(e){e=e||{};e.maxOperations&&(this.maxOperations=e.maxOperations);this._historyStack=[]},add:function(e){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,e);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},
undo:function(){if(0===this.position)return null;var e=this.peekUndo();this.position--;e?(e=e.performUndo(),this.onUndo(),this._checkAvailability(),q(e).then(f.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var e=this.peekRedo();this.position++;e?(e=e.performRedo(),this.onRedo(),this._checkAvailability(),q(e).then(f.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=
this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},
peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(e){return this._historyStack[e]},remove:function(e){0<this._historyStack.length&&(this._historyStack.splice(e,1),0<this.position&&e<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});k("extend-esri")&&(e.UndoManager=
t);return t})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(t,f,k){t=t(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(f){f=f||{};f.label&&(this.label=f.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});f("extend-esri")&&(k.OperationBase=t);return t})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),
function(t,f,k,q,e,r,m,l,g){return t([f,k,g],{baseClass:"jimu-dijit-dropdownmenu",declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuClass:"",dropdownMenuItemClass:"dropdown-menu-item",items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=r.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');
this.itemsContainer=r.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container '+this.dropdownMenuClass+'"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*this.paddingOffsetY+"px";e.forEach(this.items,q.hitch(this,function(e){var d=r.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+e.label+"\x3c/div\x3e");d.itemInfo=e;d.title=e.label;r.place(d,this.itemsContainer)}));
this.own(m(this.domNode,"click",q.hitch(this,this._onIconClick)));this.own(m(this.shelter,"click",q.hitch(this,this._onShelterClick)));this.own(m(this.itemsContainer,"click",q.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},_onIconClick:function(e,d){e.stopPropagation();this.isShowing()?this.hideMenu():(e=r.position(d||e.target||e.srcElement),this.showMenu(e))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(e){e.stopPropagation();
e=e.target||e.srcElement;r.hasClass(e,this.dropdownMenuItemClass)&&(e=e.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(e),this.emit("click-item",e));this.hideMenu()},clearHighlightValue:function(){l("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},setHighlightValue:function(e){this.clearHighlightValue();l("."+this.dropdownMenuItemClass,this.itemsContainer).some(q.hitch(this,function(d){return d.itemInfo.value===e?(r.addClass(d,"selected"),!0):
!1}))},getHighlightValue:function(){var e=l("."+this.dropdownMenuItemClass+".selected",this.itemsContainer)[0];return e?e.itemInfo.value:null},getHighlightLabel:function(){var f=this.getHighlightValue(),d="";e.some(this.items,function(c){return c.value===f?(d=c.label,!0):!1},this);return d},isShowing:function(){return r.hasClass(this.domNode,"showing")},showMenu:function(e){this.itemsContainer.style.top=e.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===window.isRTL?(this.itemsContainer.style.left=
e.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=window.innerWidth-(e.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");r.place(this.shelter,document.body);r.place(this.itemsContainer,document.body);r.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);r.removeClass(this.domNode,"showing")},
destroy:function(){this.hideMenu();r.destroy(this.itemsContainer);r.destroy(this.shelter);this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(t,f,k,q,e){var r=null,m=t(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(k.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):
(k.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),k.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));k.subscribe("widgetDestroyed",f.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(e,g){return f.getObject(e+".filterExprs."+g,!1,this._filters)},applyWidgetFilter:function(e,f,p,d,c,n){var b="object"===typeof e?e:null;b&&(e=b.layerId,f=b.widgetId,p=b.expression,d=b.enableMapFilter,c=b.useAND,n=b.zoomAfterFilter);this._setFilterExp(e,f,p,d,c);f=this.layerInfos.getLayerInfoById(e)||
this.layerInfos.getTableInfoById(e);e=this._getFilterExp(e);null!==e&&f&&f.setFilter(e,{zoomAfterFilter:n})},_onMapLoaded:function(){this.layerInfos=e.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=e.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(e){for(var f in this._filters)if(this._filters[f]){var l=this._filters[f];if(l){var d=l.filterExprs,l=l.mapFilterControls;d&&delete d[e];l&&delete l[e]}}},_traversalFilter:function(){this.layerInfos.traversalAll(f.hitch(this,
function(e){this._filters[e.id]||(this._filters[e.id]={definitionExpression:e.getFilter(),filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(e){e=f.getObject(e+".mapFilterControls",!1,this._filters);var g=0,l;for(l in e){var d=e[l];d.priority>g&&(g=d.priority)}return g},_getMapFilterControl:function(e){e=f.getObject(e+".mapFilterControls",!1,this._filters);var g=0,l=null,d;for(d in e){var c=e[d];c.priority>g&&(g=c.priority,l=c)}return l},_setFilterExp:function(e,g,p,d,c){var n=
e+".filterExprs."+g,b=e+".mapFilterControls."+g;p?(f.setObject(n,p,this._filters),q.isDefined(d)&&(e=this._getPriorityOfMapFilter(e),f.setObject(b,{enable:d,useAND:c,priority:e+1},this._filters))):(f.getObject(n,!1,this._filters)&&delete this._filters[e].filterExprs[g],f.getObject(b,!1,this._filters)&&delete this._filters[e].mapFilterControls[g])},_getFilterExp:function(e){if(!this._filters[e])return null;var f=[],l=this._filters[e].definitionExpression,d=this._filters[e].filterExprs;e=this._getMapFilterControl(e);
for(var c in d){var n=d[c];n&&f.push("("+n+")")}f=f.join(" AND ");return l&&e&&e.enable||l&&null===e?f?e&&!1===e.useAND?"("+l+") OR "+f:"("+l+") AND "+f:l:f}});m.getInstance=function(){if(null===r)r=new m,window._filterManager=r;else return r};return m})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(t,f,k){var q=null,e;e=t(null,{constructor:function(e){k.subscribe("publishData",f.hitch(this,this.onDataPublished));k.subscribe("fetchData",f.hitch(this,
this.onFetchData));k.subscribe("clearAllData",f.hitch(this,this.onClearAllData));k.subscribe("removeData",f.hitch(this,this.onRemoveData));k.subscribe("clearDataHistory",f.hitch(this,this.onClearDataHistory));this.widgetManager=e},_dataStore:{},onDataPublished:function(e,f,l,g){"undefined"===typeof g&&(g=!1);this._dataStore[f]?(this._dataStore[f].current=l,g&&(this._dataStore[f].history?this._dataStore[f].history.push(l):this._dataStore[f].history=[l])):(this._dataStore[f]={current:l},g&&(this._dataStore[f].history=
[l]))},onFetchData:function(e){var f;if(e)"framework"===e?this._dataStore[e]?k.publish("dataFetched","framework","framework",this._dataStore[e].current,this._dataStore[e].history):k.publish("noData","framework","framework"):(f=this.widgetManager.getWidgetById(e))?this._dataStore[e]?k.publish("dataFetched",f.name,e,this._dataStore[e].current,this._dataStore[e].history):k.publish("noData",f.name,e):k.publish("noData",void 0,e);else{for(var l in this._dataStore)(f=this.widgetManager.getWidgetById(l))&&
k.publish("dataFetched",f.name,l,this._dataStore[l].current,this._dataStore[l].history);f||k.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};k.publish("allDataCleared")},onRemoveData:function(e){delete this._dataStore[e];k.publish("dataRemoved",e)},onClearDataHistory:function(e){this._dataStore[e]&&(this._dataStore[e].history=[]);k.publish("dataHistoryCleared",e)}});e.getInstance=function(f){null===q&&(q=new e(f));return q};return e})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n){var b=null,h=t(null,{constructor:function(){window.isBuilder?(e.subscribe("app/mapLoaded",k.hitch(this,this._onMapLoaded)),e.subscribe("app/mapChanged",k.hitch(this,this._onMapChanged))):(e.subscribe("mapLoaded",k.hitch(this,this._onMapLoaded)),e.subscribe("mapChanged",k.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(a){var b=a.geometryType,e=new d(d.STYLE_CIRCLE,16,null,p.fromArray([0,255,255])),f=new c(c.STYLE_SOLID,p.fromArray([0,
255,255]),2),g=new n(n.STYLE_SOLID,f,p.fromArray([0,255,255,.3]));"esriGeometryPoint"===b?a.setSelectionSymbol(e):"esriGeometryPolyline"===b?a.setSelectionSymbol(f):"esriGeometryPolygon"===b&&a.setSelectionSymbol(g)},updateSelectionByFeatures:function(a,b,c){0<b.length&&(b=q.map(b,k.hitch(this,function(b){var c=null,c=0<=a.graphics.indexOf(b)?new g(b.toJson()):b;c.wabIsTemp=!0;return c})));a.getSelectionSymbol()||this.setSelectionSymbol(a);var d=new f;a._selectHandler({features:b},c,null,null,d);
this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a,b,c));return d},getDisplayLayer:function(a){return this._displayLayers[a]},setSelection:function(a,b){return this.updateSelectionByFeatures(a,b,r.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,r.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,r.SELECTION_SUBTRACT)},
clearSelection:function(a){var b=new f;this.clearDisplayLayer(a);a.clearSelection();b.resolve();return b},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(a,b,c){return q.filter(a.graphics,k.hitch(this,function(a){return c?l.contains(b,a.geometry):l.intersects(b,a.geometry)}))},getUnionGeometryBySelectedFeatures:function(a){var b=null;a=a.getSelectedFeatures();0<a.length&&(b=q.map(a,k.hitch(this,function(a){return a.geometry})),b=l.union(b));
return b},_createDisplayLayer:function(a){var b=new m;b.fields=a.fields;b.id="displayLayer_of_"+a.id;this.map.addLayer(b);return b},_updateDisplayLayer:function(a,b,c){var d=this._displayLayers[a.id],e=a.getSelectionSymbol();a.hasWebGLSurface()?this._updateDisplayLayerWebGL(a,d,e,b,c):(b=a.getSelectedFeatures(),this.clearDisplayLayer(a),q.forEach(b,k.hitch(this,function(a){a.setSymbol(null);a=new g(a.toJson());a.setSymbol(e);d.add(a)})))},_updateDisplayLayerWebGL:function(a,b,c,d,e){e===r.SELECTION_NEW&&
(a._selectedFeaturesWebGL={});e===r.SELECTION_NEW||e===r.SELECTION_ADD?q.forEach(d,k.hitch(this,function(b){a._selectedFeaturesWebGL[b.attributes[a.objectIdField]]=b})):e===r.SELECTION_SUBTRACT&&q.forEach(d,k.hitch(this,function(b){b=b.attributes[a.objectIdField];b in a._selectedFeaturesWebGL&&delete a._selectedFeaturesWebGL[b]}));this.clearDisplayLayer(a);for(var f in a._selectedFeaturesWebGL)d=new g(a._selectedFeaturesWebGL[f].toJson()),d.setSymbol(c),b.add(d)},_isLayerNeedDisplayLayer:function(a){return a.hasWebGLSurface()||
!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});h.getInstance=function(){b||(b=new h,window._selectionManager=b);return b};return h})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(t,f,k,q,e,r,m,l,g,p){return t([r,m,l],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,
position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(e.subscribe("publishData",f.hitch(this,this._onReceiveData)));this.own(e.subscribe("dataFetched",f.hitch(this,this._onReceiveData)));this.own(e.subscribe("noData",f.hitch(this,this._onNoData)));this.own(e.subscribe("dataSourceDataUpdated",
f.hitch(this,this.onDataSourceDataUpdate)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(d){},onSignOut:function(){},onPositionChange:function(d){this.setPosition(d)},setPosition:function(d,c){this.position=d;var e=g.getPositionStyle(this.position);e.position="absolute";c||(c="map"===d.relativeTo?this.map.id:
window.jimuConfig.layoutId);q.place(this.domNode,c);q.setStyle(this.domNode,e);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return q.getMarginBox(this.domNode)},setMap:function(d){this.map=d},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){},onConfigChanged:function(d){},onAppConfigChanged:function(d,c,e){},onAction:function(d,c){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===
this.gid||"widgetPool"===this.gid)return p.getInstance().getPanelById(this.id+"_panel");var d=p.getInstance().getPanelById(this.gid+"_panel");return d?d:p.getInstance().getPanelById(this.id+"_panel")},publishData:function(d,c){"undefined"===typeof c&&(c=!1);e.publish("publishData",this.name,this.id,d,c)},fetchData:function(d){d?e.publish("fetchData",d):0!==this.listenWidgetIds.length?k.forEach(this.listenWidgetIds,function(c){e.publish("fetchData",c)},this):e.publish("fetchData")},fetchDataByName:function(d){d=
this.widgetManager.getWidgetsByName(d);k.forEach(d,function(c){this.fetchData(c.id)},this)},openWidgetById:function(d){return this.widgetManager.triggerWidgetOpen(d)},_onReceiveData:function(d,c,e,b){if(c!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onReceiveData(d,c,e,b)},onReceiveData:function(d,c,e,b){},updateDataSourceData:function(d,c){e.publish("updateDataSourceData","widget~"+this.id+"~"+d,c)},onDataSourceDataUpdate:function(d,c){},_onNoData:function(d,
c){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onNoData(d,c)},onNoData:function(d,c){}})})},"jimu/dijit/BindLabelPropsMixin":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/query","dojo/_base/array","jimu/utils"],function(t,f,k,q,e){return t("jimu-bind-label-props-mixin",null,{isRenderIdForAttrs:!1,buildRendering:function(){this.inherited(arguments);if(this.isRenderIdForAttrs){var r=k("[data-a11y-label-id],[data-a11y-label-by], [data-label-for], [data-label-id]",
this.domNode);(f.getAttr(this.domNode,"data-a11y-label-id")||f.getAttr(this.domNode,"data-a11y-label-by")||f.getAttr(this.domNode,"data-label-for")||f.getAttr(this.domNode,"data-label-id"))&&r.unshift(this.domNode);var m={},l=[],g={},p,d=0,c="jimuUniqName_"+e.getUUID();q.forEach(r,function(a){var b=f.getAttr(a,"data-a11y-label-id"),e=f.getAttr(a,"data-a11y-label-by"),h=f.getAttr(a,"data-label-for"),n=f.getAttr(a,"data-label-id");b?(f.removeAttr(a,"data-a11y-label-id"),p=c+"_"+d,f.setAttr(a,"id",p),
m[b]=p,d++):e?l.push(a):h?(g.hasOwnProperty(h)||(g[h]={}),g[h].forDom=a):(g.hasOwnProperty(n)||(g[n]={}),g[n].idDom=a)});for(var n in l){var r=l[n],b=f.getAttr(r,"data-a11y-label-by").split(" "),h=[];q.forEach(b,function(a){h.push(m[a])});f.removeAttr(r,"data-a11y-label-by");f.setAttr(r,"aria-labelledby",h.join(" "))}for(var a in g)p=c+"_"+d,n=g[a].forDom,r=g[a].idDom,n&&(f.removeAttr(n,"data-label-for"),f.setAttr(n,"for",p)),r&&(f.removeAttr(r,"data-label-id"),f.setAttr(r,"id",p)),d++}}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n){var b,h=null;b=t(null,{constructor:function(){this.panels=[];this.widgetManager=n.getInstance();l(window,"resize",f.hitch(this,this.onWindowResize));this.activePanel=null;g.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart));g.subscribe("widgetActived",f.hitch(this,this._onWidgetActived))},showPanel:function(a){var b=new r,d=this.getPanelById(a.id+"_panel");d?("closed"===d.state&&this.openPanel(d),b.resolve(d)):m({Panel:this._loadPanelClass(a.panel.uri),
nls:this._loadThemeI18N(a.panel.uri)}).then(f.hitch(this,function(d){var e=a.id+"_panel",g=this.getPanelById(e),h={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:e,gid:a.gid,nls:d.nls};f.mixin(h,a.panel.options);try{g=new d.Panel(h),console.log("panel ["+e+"] created.")}catch(A){console.log("create panel error: "+A+", panelId: "+e);b.reject(A);return}g.setPosition(a.panel.position);c.setVerticalCenter(g.domNode);
this.openPanel(g);g.domNode.addEventListener("click",f.hitch(this,this._onPanelClick,g),{capture:!0});b.resolve(g)}));return b},setMap:function(a){this.map=a;l(this.map,"resize",f.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===
a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new r;if("string"===typeof a){if(a=this.getPanelById(a),!a)return b.reject(),b}else this.panels.some(function(b){return b.id===a.id})||this.panels.push(a);if(!a.started)try{a.started=!0,a.startup()}catch(v){console.error("fail to startup panel "+a.id+". "+v.stack)}if("opened"===a.state)return this._activePanel(a),b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(f.hitch(this,function(){q.setStyle(a.domNode,
"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new r;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(f.hitch(this,function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&q.setStyle(a.domNode,"display","none")}))},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(u){console.log(console.error("fail to minimize panel "+a.id+". "+u.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(u){console.log(console.error("fail to maximize panel "+a.id+". "+u.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(u){console.log(console.error("fail to noralize panel "+a.id+". "+u.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===
a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);
try{a.destroy()}catch(u){console.log(console.error("fail to destroy panel "+a.id+". "+u.stack))}}},destroyAllPanels:function(){var a=k.map(this.panels,function(a){return a.id});k.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return p();var b=new r;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(q.setStyle(a.domNode,{opacity:0,display:""}),
e.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return p();var b=new r;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?e.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a))return{};var b=q.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?(c=0,this.panels.filter(function(b){return"minimized"===b.windowState&&"closed"!==b.state&&b.id!==
a.id}).some(function(a){return 0===a._mobileBottom})&&(c=a.titleHeight),a._mobileBottom=c,b.h>b.w?{left:0,right:0,top:"auto",bottom:c,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:c,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,
borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}):b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,
borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},activatePanel:function(a){"closed"!==a.state&&this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&q.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&
(this.activePanel.setState("opened"),q.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),!1===b.inPanel&&q.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==
this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&q.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){k.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&
a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),q.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new r;d([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new r;a.startWith("themes")?(a=a.split("/"),d(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});
return b}});b.getInstance=function(){null===h&&(h=new b,window._panelManager=h);return h};return b})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(t,f,k,q){return t([q],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&
this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&f.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(e){this.loading=e;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(e){this.widget=e;this.loading&&this.loading.destroy();k.place(e.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(e){console.error("destroy widget error. widget: ["+
this.widget.uri+"], "+e.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./a11y/BaseWidgetPanel ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(t,f,k,q,e,r,m,l,g,p){t=t([e,r],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,
animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var d=this.getAllWidgetConfigs();Array.isArray(this.config.widgets)?(d=this.config.widgets,1<d.length&&this._addTagToGroupPanel()):d=[this.config];k.forEach(d,function(c,d){var b,e;!1!==c.visible&&(e=new l,b=this.createFrame(c),this._initFrameEvents(b,c,d),this.addChild(b),b.setLoading(e),this.widgetManager.loadWidget(c).then(f.hitch(this,function(a){b.setWidget(a);
a.startup()})))},this)},getAllWidgetConfigs:function(){var d=[];return d=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(d){for(var c=this.getChildren(),e=0;e<c.length;e++)if(c[e].getWidget()&&c[e].getWidget().id===d)return c[e].getWidget()},getWidgets:function(){return this.getChildren().map(function(d){return d.getWidget()})},createFrame:function(d){return new g},setPosition:function(d,c){this.position=d;var e=p.getPositionStyle(this.position);e.position=
"absolute";c||(c="map"===d.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(e.display="none");q.place(this.domNode,c);q.setStyle(this.domNode,e)},getPosition:function(){return this.position},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){this.getChildren().forEach(function(d){d.resize()})},onPositionChange:function(d){this.setPosition(d)},onOpen:function(){k.forEach(this.getChildren(),function(d){d.getWidget()&&
this.widgetManager.openWidget(d.getWidget())},this);this._onOpenAndFocus()},onClose:function(){k.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.closeWidget(d.getWidget())},this)},onMaximize:function(){k.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.maximizeWidget(d.getWidget())},this)},onMinimize:function(){k.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.minimizeWidget(d.getWidget())},this)},onNormalize:function(){k.forEach(this.getChildren(),
function(d){d.getWidget()&&this.widgetManager.normalizeWidget(d.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(d){this._updateConfig(d)},reloadWidget:function(d){this.isWidgetInPanel(d)&&(this._updateConfig(d),this.getChildren().forEach(function(c){c.getWidget()&&c.getWidget().id===d.id&&(c.getWidget().destroy(),c.setLoading(new l),this.widgetManager.loadWidget(d).then(f.hitch(this,function(d){c.setWidget(d);d.startup();"closed"===this.state&&this.widgetManager.closeWidget(d)})))},
this))},isWidgetInPanel:function(d){return k.some(this.getAllWidgetConfigs(),function(c){if(d.id===c.id)return!0})?!0:!1},_updateConfig:function(d){if(Array.isArray(this.config.widgets)){for(var c=-1,e=0;e<this.config.widgets.length;e++)this.config.widgets[e].id===d.id&&(c=e);0<c&&(this.config.widgets[c]=d)}else this.config=d},destroy:function(){this.getChildren().forEach(function(d){try{d.domNode&&d.destroy()}catch(c){console.error("destroy widget frame error."+c.stack)}});this.inherited(arguments)}});
t.extend(m);return t})},"jimu/a11y/BaseWidgetPanel":function(){define("dojo/_base/lang dojo/_base/html dojo/query dojo/on dojo/keys ./../utils".split(" "),function(t,f,k,q,e,r){var m={frameSectionIndex:"91"};m.panelNls=window.jimuNls.panelHeader;m._addTagToGroupPanel=function(){var e=this.config.widgets;this.isGroupPanel=!0;e.forEach(function(e){e.inGroupPanel=!0})};m._setAriaLabel=function(e,g){var l;e.folded?(l=m.panelNls.expanded,f.setStyle(e.containerNode,"display","inherit")):(l=m.panelNls.collapsed,
f.setStyle(e.containerNode,"display","none"));g=r.getSubstituteString(g,l);f.setAttr(e.titleNode,"aria-label",g)};m._initFrameEvents=function(l,g,p){if(this.isGroupPanel){var d=r.getSubstituteString(g.label,m.panelNls.expanded);g=r.getSubstituteString(g.label,m.panelNls.pressToFocus);f.setAttr(l.titleNode,"aria-label",d);f.setAttr(l.titleNode,"tabindex",m.frameSectionIndex);f.setAttr(l.containerNode,"aria-label",g);f.setAttr(l.containerNode,"tabindex",m.frameSectionIndex);0===p?this.firstTitleNode=
l.titleNode:p===this.config.widgets.length-1&&(this.lastTitleNode=l.titleNode,this.lastContent=l.containerNode);this.own(q(l.titleNode,"click",t.hitch(this,function(){l.foldEnable&&this._setAriaLabel(l,l.label)})));this.own(q(l.titleNode,"keydown",t.hitch(this,function(c){f.hasClass(c.target,"title")&&(c.keyCode===e.TAB?c.target===this.firstTitleNode&&c.shiftKey?(c.preventDefault(),this.lastContent.focus()):c.target!==this.lastTitleNode||c.shiftKey||"none"!==f.getStyle(this.lastContent,"display")||
(c.preventDefault(),this.firstTitleNode.focus()):!l.foldEnable||c.keyCode!==e.ENTER&&c.keyCode!==e.SPACE||(c.stopPropagation(),this._setAriaLabel(l,l.label),l.onFoldableNodeClick()))})));this.own(q(l.containerNode,"keydown",t.hitch(this,function(c){var d=c.target;f.hasClass(d,"jimu-panel-content")?c.keyCode===e.ENTER?(c=k(".jimu-widget",d)[0])&&r.focusFirstFocusNode(c):c.target!==this.lastContent||c.shiftKey||c.keyCode!==e.TAB||(c.preventDefault(),this.firstTitleNode.focus()):c.keyCode===e.ESCAPE&&
(c.stopPropagation(),l.containerNode.focus())})))}};m._onOpenAndFocus=function(){this.config.openAtStart&&!this._isFirstOpenAtStart?this._isFirstOpenAtStart=!0:this.isGroupPanel&&this.firstTitleNode&&this.firstTitleNode.focus()};return m})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(t,f,k,q,e){return t([q,e],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(k(window,"resize",
f.hitch(this,this._onWindowResize)))},getConfig:function(){},getDataSources:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(t,f,k,q,e,r){return{cloneSymbol:function(f){if(!f)return null;var l=null;try{var g=f.toJson(),l=e.fromJson(g)}catch(p){console.error(p)}return l},getDefaultMarkerSymbol:function(){return e.fromJson({style:"esriSMSCircle",
color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return e.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return e.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return e.fromJson({color:[255,
255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return e.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return e.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var e=
t.toUrl("jimu/css/images/grey_pin.png"),e=new r(e,16,16);e.setOffset(0,8);return e},createSymbolNode:function(m,l){var g=32,p=32,d=k.create("div",{},document.body);k.setStyle(d,"display","inline-block");if(l)g=l.width,p=l.height;else if(g=80,p=30,this.isSimpleMarkerSymbol(m))p=g=Math.min(m.size+12,125);else if(this.isPictureMarkerSymbol(m)){if(!m.url||"http://"===m.url||-1===m.url.indexOf("http://")&&-1===m.url.indexOf("https://")&&-1===m.url.indexOf("data:"))return;p=g=Math.min(Math.max(m.width,
m.height),125)}else if(this.isSimpleLineSymbol(m)||this.isCartographicLineSymbol(m))g=190,p=20;var c=q.createSurface(d,g,p);if("vml"===q.renderer){var n=c.getEventSource();k.setStyle(n,"position","relative");k.setStyle(n.parentNode,"position","relative")}var n=null,n=l?e.getShapeDescriptors(m):this.isSimpleLineSymbol(m)||this.isCartographicLineSymbol(m)?this._getLineShapeDesc(m):e.getShapeDescriptors(m),b;try{b=c.createShape(n.defaultShape),n.fill&&b.setFill(n.fill),n.stroke&&b.setStroke(n.stroke)}catch(h){c.clear();
c.destroy();return}m=c.getDimensions();m={dx:m.width/2,dy:m.height/2};c=b.getBoundingBox();l=c.width;c=c.height;if(l>g||c>p)g=((g<p?g:p)-5)/(l>c?l:c),f.mixin(m,{xx:g,yy:g});b.applyTransform(m);d&&k.addClass(d,"symbol");return d},_getLineShapeDesc:function(e){var f=null;if(this.isSimpleLineSymbol(e)||this.isCartographicLineSymbol(e))f={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:e.getStroke()};return f},isSimpleMarkerSymbol:function(e){return e&&"esri.symbol.SimpleMarkerSymbol"===
e.declaredClass},isPictureMarkerSymbol:function(e){return e&&"esri.symbol.PictureMarkerSymbol"===e.declaredClass},isSimpleLineSymbol:function(e){return e&&"esri.symbol.SimpleLineSymbol"===e.declaredClass},isCartographicLineSymbol:function(e){return e&&"esri.symbol.CartographicLineSymbol"===e.declaredClass},isSimpleFillSymbol:function(e){return e&&"esri.symbol.SimpleFillSymbol"===e.declaredClass},isPictureFillSymbol:function(e){return e&&"esri.symbol.PictureFillSymbol"===e.declaredClass},isTextSymbol:function(e){return e&&
"esri.symbol.TextSymbol"===e.declaredClass}}})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(t,f,k){return t(null,{constructor:function(){this.panelManager=k.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(f){},getConfigById:function(f){for(var e=this.getAllConfigs(),k=0;k<e.length;k++)if(e[k].id===
f)return e[k]},getAllConfigs:function(){var k=[],k=k.concat(this.getWidgetConfigs(),this.getGroupConfigs()),k=f.filter(k,function(e){return e.visible});return k.sort(function(e,f){return e.index-f.index})},getAllConfigsIncludeInvisible:function(){var f=[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs());return f.sort(function(e,f){return e.index-f.index})},isControlled:function(k){return f.some(this.getAllConfigsIncludeInvisible(),function(e){return e.id===k})},widgetIsControlled:function(k){return f.some(this.getAllConfigsIncludeInvisible(),
function(e){return e.id===k?!0:f.some(e.widgets,function(e){return e.id===k})})},getGroupConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.groups&&f.forEach(this.appConfig.widgetPool.groups,function(e){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(e.id)&&k.push(e):"all"===this.controlledGroups&&k.push(e))},this);return k},getWidgetConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.widgets&&
f.forEach(this.appConfig.widgetPool.widgets,function(e){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(e.id)&&k.push(e):"all"===this.controlledWidgets&&k.push(e))},this);return k}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(t,f,k,q,e,r,m,l){var g=null,p=null,d=!1;t=t(null,function(){});var c=
require.toUrl("jimu"),n=r(c+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),b=r(c+"/SpatialReference/transform.json",{handleAs:"json"});t.loadResource=function(){var c=new q;if(g&&p)return c.resolve(),c;e([n,b]).then(function(a){g=a[0];p=a[1];d=!0;c.resolve()},function(a){console.error(a);d=!1;c.reject(a)});return c};t.getAllCSUnits=function(){if(d){var b=[];k.forEach(g.wkids,f.hitch(this,function(a){a=this.getCSUnit(a);-1===k.indexOf(b,a)&&b.push(a)}));return b}};t.convertUnit=function(b,
a,c){if(d)return l.convertUnit(b,a,c)};t.getUnitRate=function(b,a){if(d)return l.getUnitRate(b,a)};t.isProjectUnit=function(b){if(d)return l.isProjectUnit(b)};t.isGeographicUnit=function(b){if(d)return l.isGeographicUnit(b)};t.getGeographicUnits=function(){if(d)return l.getGeographicUnits()};t.getProjectUnits=function(){if(d)return l.getProjectUnits()};t.getCSUnit=function(b){if(d){b=this.getCSStr(b);var a=0,c=0,a=b.lastIndexOf("UNIT"),c=b.indexOf(",",a);return b.slice(a+6,c-1)}};t.isSameSR=function(b,
a){if(d)return b=this.indexOfWkid(b),a=this.indexOfWkid(a),g.labels[b]===g.labels[a]};t.isValidWkid=function(b){if(d)return-1<this.indexOfWkid(b)};t.getSRLabel=function(b){if(d&&this.isValidWkid(b))return b=this.indexOfWkid(b),g.labels[b]};t.indexOfWkid=function(b){if(d)return k.indexOf(g.wkids,b)};t.isWebMercator=function(b){return m.prototype._isWebMercator?m.prototype._isWebMercator.apply({wkid:parseInt(b,10)},[]):(new m(parseInt(b,10))).isWebMercator()};t.standardizeWkid=function(b){return this.isWebMercator(b)?
3857:parseInt(b,10)};t.isValidTfWkid=function(b){if(d)return-1<this.indexOfTfWkid(b)};t.getTransformationLabel=function(b){if(d)return this.isValidTfWkid(b)?(b=this.indexOfTfWkid(b),p.labels[b]):""};t.indexOfTfWkid=function(b){if(d)return k.indexOf(p.tfWkids,b)};t.isGeographicCS=function(b){if(d)return this.isValidWkid(b)?g.details[this.indexOfWkid(b)].startWith("GEOGCS"):!1};t.isProjectedCS=function(b){if(d)return this.isValidWkid(b)?g.details[this.indexOfWkid(b)].startWith("PROJCS"):!1};t.getGeoCSByProj=
function(b){if(d&&this.isProjectedCS(b))return b=this.getSpheroidStr(b),b=k.indexOf(g.details,b),g.wkids[b]};t.getSpheroidStr=function(b){if(d){if(this.isGeographicCS(b))return g.details[this.indexOfWkid(b)];if(this.isProjectedCS(b)){b=g.details[this.indexOfWkid(b)];var a=b.indexOf("GEOGCS"),c=b.indexOf("PROJECTION")-1;return b.slice(a,c)}return null}};t.getCSStr=function(b){if(d)return g.details[this.indexOfWkid(b)]};t.isSameSpheroid=function(b,a){if(d)return b=this.getSpheroidStr(b),a=this.getSpheroidStr(a),
b&&a&&b===a?!0:!1};return t})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(t,f){var k="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),q="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),
e={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,
DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};t=t(null,function(){});t.convertUnit=function(f,k,l){return e[f.toUpperCase()]/e[k.toUpperCase()]*l};t.getUnitRate=function(f,k){return e[f.toUpperCase()]/e[k.toUpperCase()]};t.isProjectUnit=function(e){return-1<f.indexOf(k,e.toUpperCase())};t.isGeographicUnit=function(e){return-1<f.indexOf(q,e.toUpperCase())};t.getGeographicUnits=
function(){return q};t.getProjectUnits=function(){return k};return t})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(t,f,k,q,e,r,m,l){return t(f,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){m.create("div",{"class":"jimu-radio-inner"},
this.domNode);this.checked&&r.add(this.domNode,"jimu-radio-checked");this.own(e(this.domNode,"click",k.hitch(this,function(){this.checked||this.check()})))},check:function(e){void 0===e&&(e=!0);this.checked=!0;r.add(this.domNode,"jimu-radio-checked");e&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(e){void 0===e&&(e=!0);this.checked=!1;r.remove(this.domNode,"jimu-radio-checked");e&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(e){null!==this.group&&
q.forEach(l.toArray(),function(f){f.id!==this.id&&f["class"]===this["class"]&&f.group===this.group&&(e?f.check(!1):f.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/Evented ./a11y/CheckBox".split(" "),function(t,f,k,q,e,r,m){t=t([f,r],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,disabled:!1,status:!0,label:"",title:"",postCreate:function(){this.checkNode=
q.create("div",{"class":"checkbox jimu-float-leading jimu-icon jimu-icon-checkbox"},this.domNode);this.labelNode=q.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&(q.addClass(this.checkNode,"checked"),q.addClass(this.checkNode,"jimu-icon-checked"));this.status=this._getStatusByDisabled(this.disabled);this.status||(q.addClass(this.domNode,"jimu-state-disabled"),q.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);
this.own(this.watch("disabled",k.hitch(this,function(){this.setStatus(this._getStatusByDisabled(this.disabled))})));this._udpateLabelClass();this.a11y_init()},setLabel:function(e){this.label=e;this.labelNode.innerHTML=this.label;this.labelNode.title=this.label;this.a11y_updateAriaLabel(e);this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?q.removeClass(this.labelNode,"not-visible"):q.addClass(this.labelNode,"not-visible"))},setValue:function(e){this.status&&
(!0===e?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(f){f=!!f;var g=this.status!==f;(this.status=f)?(e.remove(this.domNode,"jimu-state-disabled"),q.removeClass(this.checkNode,"jimu-state-disabled")):(e.add(this.domNode,"jimu-state-disabled"),q.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);g&&this.emit("status-change",f)},getStatus:function(){return this.status},check:function(e){if(this.status&&(this.checked=!0,this.a11y_changeAriaCheckedAttr(),
q.addClass(this.checkNode,"checked jimu-icon-checked"),q.removeClass(this.checkNode,"checked jimu-icon-checkbox"),!e))this.onStateChange()},uncheck:function(e){if(this.status&&(this.checked=!1,this.a11y_changeAriaCheckedAttr(),q.removeClass(this.checkNode,"checked"),q.removeClass(this.checkNode,"jimu-icon-checked"),q.addClass(this.checkNode,"jimu-icon-checkbox"),!e))this.onStateChange()},onStateChange:function(){if(this.onChange&&k.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",
this.checked)},focus:function(){this.checkNode&&this.checkNode.focus&&this.checkNode.focus()},_getStatusByDisabled:function(e){return!0===e||"true"===e||"disabled"===e?!1:!0}});t.extend(m);return t})},"jimu/dijit/a11y/CheckBox":function(){define(["dojo/_base/lang","dojo/on","dojo/_base/html","dijit/a11yclick"],function(t,f,k,q){return{a11y_init:function(){k.setAttr(this.domNode,"tabindex","0");k.setAttr(this.domNode,"role","checkbox");this.setLabel(this.label);this.a11y_changeAriaCheckedAttr();this.own(f(this.domNode,
"focus",t.hitch(this,function(){k.addClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(f(this.domNode,"blur",t.hitch(this,function(){k.removeClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(f(this.domNode,q,t.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})))},a11y_changeAriaCheckedAttr:function(){k.setAttr(this.domNode,"aria-checked",this.checked?"true":"false")},a11y_setDisabled:function(e){e=e.toString();"false"===e?k.removeAttr(this.domNode,"disabled"):
k.setAttr(this.domNode,"disabled",e);k.setAttr(this.domNode,"aria-disabled",e)},a11y_updateAriaLabel:function(e){""===this.label?(k.setAttr(this.domNode,"title",this.title),k.setAttr(this.domNode,"aria-label",this.title)):k.setAttr(this.domNode,"aria-label",this.title?this.title:e)}}})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr dojo/Deferred dojox/gfx dojo/promise/all jimu/utils jimu/symbolUtils jimu/portalUrlUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font esri/arcgis/Portal esri/request jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency jimu/dijit/LoadingIndicator jimu/dijit/formSelect dijit/form/NumberSpinner".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w,B,F,D,G,H,M){return t([f,k,q,e,m],{templateString:r,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,symbol:null,type:null,DEFAULT_PORTAL_URL:"//arcgis.com/",_portalLoadTimeoutInMs:3E3,_isOnline:!0,_localTypes:"basic A-Z arrows business cartographic nationalParkService outdoorRecreation peoplePlaces safetyHealth shapes transportation damage disasters emergencyManagement generalInfrastructure localGovernment numbers pointsOfInterest stateGovernment FireFly".split(" "),
cropImage:!1,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser;this._setTemplateNls()},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(d(document.body,"click",l.hitch(this,this._onBodyClicked)));(this._isIE8=8===c("ie"))&&g.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=
a&&a.declaredClass;b&&"string"===typeof b&&0<=b.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();
if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){return this._getSymbol(!1)},getValidSymbol:function(){return this._getSymbol(!0)},_getSymbol:function(a){var b=null;"marker"===this.type?b=this._getPointSymbolBySetting(a):"line"===this.type?b=this._getLineSymbolBySetting(a):"fill"===this.type?
b=this._getFillSymbolBySetting(a):"text"===this.type&&(b=this._getTextSymbolBySetting(a));a=null;b&&(a=this._cloneSymbol(b));return a},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),b=0,c=a.length;b<c;b++){var d=a[b];this[d]&&this[d].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},
_tryHideDropDownOfSelectDijit:function(a,b){var c=b.domNode,d=b.dropDown.domNode,c=a===c||g.isDescendant(a,c);a=a===d||g.isDescendant(a,d);if(!c&&!a)b.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){n(".symbol-section",this.domNode).style("display","none")},_showSection:function(a){this._hideAllSections();n("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return v.getAncestorDom(a,b,c)},
_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=E.fromJson(c)}catch(N){console.error(N)}return b},_createSymbolIconTable:function(a,b,c){var d=this.type+"-icon-table";a=g.toDom('\x3ctable class\x3d"'+("icon-table "+d+" "+(d+"-"+a))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var d=n("tbody",a)[0],e=Math.ceil(b.length/8),f=0;f<e;f++)g.create("tr",{},d);var h=n("tr",
a);p.forEach(b,l.hitch(this,function(a,b){var d=l.clone(a),e=E.fromJson(a);b=g.create("td",{},h[Math.floor(b/8)]);g.addClass(b,"symbol-td-item");e=this._createSymbolNode(e);g.addClass(e,"symbol-div-item");var f=e.firstChild;g.addClass(f,"svg-node");if(this._isIE8&&"point"===c)if(window.isRTL){if("Cross"===a.name||"X"===a.name)g.setStyle(f,"right","-20px"),g.setStyle(e,"marginTop","20px")}else"Cross"!==a.name&&"X"!==a.name||g.setStyle(e,"marginTop","20px");e.symbol=d;g.place(e,b)}));return a},_updatePreview:function(a){var b=
this._cloneSymbol(this.symbol);g.empty(a);(b=x.createSymbolNode(b))||(b=g.create("div"));g.place(b,a)},_createSymbolNode:function(a){(a=x.createSymbolNode(a,{width:36,height:36}))||(a=g.create("div"));g.setStyle(a,{width:"36px",height:"36px"});return a},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");
this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new C({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(d(this.pointIconTables,
".symbol-div-item:click",l.hitch(this,this._onPointSymIconItemClick)));this.own(d(this.pointSymClassSelect,"change",l.hitch(this,this._onPointSymClassSelectChange)));this.own(d(this.pointSize,"change",l.hitch(this,this._onPointSymbolChange)));this.own(d(this.pointColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(d(this.pointAlpha,"change",l.hitch(this,this._onPointSymbolChange)));this.own(d(this.pointOutlineColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(d(this.pointOutlineWidth,
"change",l.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&
this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&
(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]?(a=this.pointSymClassSelect.getOptions(a),this.pointSymClassSelect.domNode.title=a?a.label:""):this._requestPointSymJson(a)}},_hideAllPointSymIconTable:function(){n(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();
var a=this.pointSymClassSelect.get("value"),a=n(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_getLocalSymbols:function(a){a=a||this.pointSymClassSelect.get("value");a=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");return b(a,{handleAs:"json"})},_getPortalSymbolsByType:function(a){var b=new h;a?this._fetchSymbols(a).then(l.hitch(this,function(a){b.resolve(a)}),l.hitch(this,function(a){b.reject(a)})):b.reject(null);return b},_requestPointSymJson:function(a){this.pointSymClassSelect["def"+
a]||(this.loadingShelter.show(),!this._isOnline&&window.isXT?this._offLineGetSymbols(a):this._symbolTypes?this._handleGetPointSymbols(l.hitch(this,this._getPortalSymbolsByType),a):this._initPortal().then(l.hitch(this,this._fetchSymbolTypes)).then(l.hitch(this,function(b){this.domNode&&(this._clearOptions(),this._createOptions(b),this._handleGetPointSymbols(l.hitch(this,this._getPortalSymbolsByType),a))}),l.hitch(this,function(b){this.domNode&&(window.isXT?this._offLineGetSymbols(a):(this.loadingShelter.hide(),
console.error("Fetching symbols failed",b)))})))},_offLineGetSymbols:function(a){this._isOnline=!1;if(0===this.pointSymClassSelect.options.length){var b=[];p.forEach(this._localTypes,l.hitch(this,function(a,c){b.push({id:c,title:this.nls[a]||a})}));this._clearOptions();this._createOptions(b)}this._handleGetPointSymbols(l.hitch(this,this._getLocalSymbols),a)},_clearOptions:function(){this.pointSymClassSelect&&this.pointSymClassSelect.removeOption(this.pointSymClassSelect.options)},_createOptions:function(a){if(this.pointSymClassSelect){var b=
[],c="",d=!1;"[object Array]"===Object.prototype.toString.call(a)&&0<a.length&&p.forEach(a,l.hitch(this,function(a){c=a.title||a.name;d=c===this.nls.basic?!0:!1;c&&(a.id||0===a.id)&&b.push({label:c,value:a.id,selected:d})}));b.push({label:this.nls.customImage,value:"custom"});this.pointSymClassSelect.addOption(b)}},_initPortal:function(){var a=new h;if(this._portal)a.resolve();else{var b=z.getStandardPortalUrl(window.portalUrl),c=new G.Portal(b?b:this.DEFAULT_PORTAL_URL);if(c.loaded)return this._portal=
c,a.resolve(),a.promise;this.own(c.on("load",l.hitch(this,function(){this._portal=c;a.resolve()})));setTimeout(function(){a.reject()},this._portalLoadTimeoutInMs)}return a},_handleGetPointSymbols:function(a,b){if(this.pointSymClassSelect){var c=b||this.pointSymClassSelect.get("value");b="def"+c;a=a(c);this.pointSymClassSelect[b]=a;a.then(l.hitch(this,function(a){this.domNode&&(this.loadingShelter.hide(),this._getPointSymbolsSucess(c,a))}),l.hitch(this,function(a){this.domNode&&(this.loadingShelter.hide(),
console.error("Fetching symbols failed",a))}))}},_getPointSymbolsSucess:function(a,b){if(this.domNode){var c=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=c?c.label:"";a=this._createSymbolIconTable(a,b,"point");g.place(a,this.pointIconTables);this._showSelectedPointSymIconTable()}},_fetchSymbols:function(a){var b=[],c=new h,b=this._symbolTypes.filter(function(b){return b.id===a});this._getSymbolListData(b).then(l.hitch(this,function(a){c.resolve(a)}),l.hitch(this,function(a){console.warn("fetch symbols failed",
a);c.reject(a)}));return c},_getSymbolListData:function(a){a=p.filter(a,function(a){return a.dataUrl});a=p.map(a,function(a){return H({url:a.dataUrl}).promise});return u(a).then(function(a){return a[0]})},_fetchSymbolTypes:function(){var a=new h;this._symbolTypes?a.resolve(this._symbolTypes):this._getSymbolListGroupId().then(l.hitch(this,this._getSymbolListItems)).then(l.hitch(this,function(b){this._symbolTypes=b;a.resolve(b)}),l.hitch(this,function(b){console.warn("fetch symbol types failed",b);
a.reject(b)}));return a},_getSymbolListGroupId:function(){var a=new h;this._portal||a.reject("no portal");this._portal.queryGroups({q:this._portal.symbolSetsGroupQuery}).then(function(b){a.resolve(b.results[0].id)},l.hitch(this,function(b){console.warn("get symbol list group id failed",b);a.reject(b)}));return a},_getSymbolListItems:function(b){var c=new h,d=this._portal;b="group:"+b+' AND type:"Symbol Set"';var e=[];this._portal||c.reject("no portal");b="vml"===a.renderer?b+' AND -typekeywords:"by value"':
b+' AND (typekeywords:"by value" AND typekeywords:"marker")';d.queryItems({q:b,num:20,sortField:"title"}).then(l.hitch(this,function(a){var b,d,f,g;p.forEach(a.results,function(a){b=a.typeKeywords.join(" ");-1<b.indexOf("marker")&&(d=a.title,f={name:d,id:a.id,title:a.title,keywords:b,dataUrl:a.itemDataUrl},(g=-1<b.indexOf("default"))?(f.defaultType=!0,e.unshift(f)):e.push(f))},this);0<e.length?c.resolve(e):c.reject()}),function(){c.reject()});return c},_onPointSymIconItemClick:function(a){if(a=this._getAncestor(a.target||
a.srcElement,function(a){return g.hasClass(a,"symbol-div-item")},5))if(n(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),g.addClass(a,"selected-symbol-div-item"),a=a.symbol){this.symbol=E.fromJson(a);a=g.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange();var b=g.getStyle(this.pointColorTr,"display");a!==b&&this.emit("resize")}},
_showSimpleMarkerSymSettings:function(){g.addClass(this.pointCustomImageTr,"hidden");g.removeClass(this.pointIconTablesTr,"hidden");g.removeClass(this.pointColorTr,"hidden");g.removeClass(this.pointOpacityTr,"hidden");g.removeClass(this.pointOutlineColorTr,"hidden");g.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){g.addClass(this.pointCustomImageTr,"hidden");g.removeClass(this.pointIconTablesTr,"hidden");g.addClass(this.pointColorTr,"hidden");g.addClass(this.pointOpacityTr,
"hidden");g.addClass(this.pointOutlineColorTr,"hidden");g.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){g.removeClass(this.pointCustomImageTr,"hidden");g.addClass(this.pointIconTablesTr,"hidden");g.addClass(this.pointColorTr,"hidden");g.addClass(this.pointOpacityTr,"hidden");g.addClass(this.pointOutlineColorTr,"hidden");g.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(a){if(!this.symbol||a&&!this.pointSize.validate())return null;
var b=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){if(a&&!this.pointOutlineWidth.validate())return null;this.symbol.setSize(b);a=this.pointColor.getColor();b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);a=this.pointOutlineColor.getColor();var b=parseFloat(this.pointOutlineWidth.get("value")),c=new w;c.setStyle(w.STYLE_SOLID);c.setColor(a);c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(b),
this.symbol.setHeight(b));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new M({cropImage:this.cropImage,customZIndex:this.customZIndex,showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});g.addClass(this.imageChooser.domNode,"custom-image-chooser");this.own(d(this.imageChooser,"change",l.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},
_onImageChange:function(a,b){this.imageNameNode.innerHTML=b.fileName;a=a.replace(/^data:image\/.*;base64,/,"");b=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=new A({type:"esriPMS",url:null,imageData:a,contentType:"image/png",color:null,width:b,height:b,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));
this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(d(this.lineIconTables,".symbol-div-item:click",l.hitch(this,this._onLineSymIconItemClick)));this.own(d(this.lineColor,"change",l.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineStylesSelect,"change",l.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineAlpha,"change",l.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineWidth,"change",l.hitch(this,this._onLineSymbolChange)))},
_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},
isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(a){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");b(c,{handleAs:"json"}).then(l.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(a,b,"line"),g.place(b,this.lineIconTables))}),l.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return g.hasClass(a,
"symbol-div-item")},5))if(n(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),g.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=E.fromJson(a),this._initLineSettings(a),this._onLineSymbolChange()},_getLineSymbolBySetting:function(a){if(a&&!this.lineWidth.validate())return null;this.symbol=new w;a=this.lineColor.getColor();var b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);
this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(d(this.fillIconTables,".symbol-div-item:click",l.hitch(this,this._onFillSymIconItemClick)));this.own(d(this.fillColor,"change",l.hitch(this,
this._onFillSymbolChange)));this.own(d(this.fillAlpha,"change",l.hitch(this,this._onFillSymbolChange)));this.own(d(this.fillOutlineColor,"change",l.hitch(this,this._onFillSymbolChange)));this.own(d(this.fillOutlineWidth,"change",l.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),
a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(a){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");b(c,{handleAs:"json"}).then(l.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(a,b,"fill"),g.place(b,this.fillIconTables))}),l.hitch(this,
function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return g.hasClass(a,"symbol-div-item")},5))if(n(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),g.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=E.fromJson(a),this._initFillSettings(a),this._onFillSymbolChange()},_getFillSymbolBySetting:function(a){if(a&&!this.fillOutlineWidth.validate())return null;
this.symbol=new B;var b=this.fillColor.getColor();b.a=this.fillAlpha.getAlpha();a=this.fillOutlineColor.getColor();var c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(b);this.symbol.setStyle(B.STYLE_SOLID);b=new w;b.setStyle(w.STYLE_SOLID);b.setColor(a);b.setWidth(c);this.symbol.setOutline(b);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());
this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(d(this.inputText,"change",l.hitch(this,this._onTextSymbolChange)));this.own(d(this.textColor,"change",l.hitch(this,this._onTextSymbolChange)));this.own(d(this.textFontSize,"change",l.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=
!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(a){var b=this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";g.setStyle(this.textPreview,{color:b,fontSize:c,fontFamily:a});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(a){if(a&&
(""===this.inputText.value.replace(/^\s+|\s+$/g,"")||!this.textFontSize.validate()))return null;this.symbol=new F;a=this.inputText.value;var b=this.textColor.getColor(),c=parseInt(this.textFontSize.get("value"),10),d=new D;d.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(d);this._updateTextPreview(d.family);return this.symbol},_setTemplateNls:function(){"undefined"===typeof this.nls.damage&&(this.nls.damage="Damage");"undefined"===typeof this.nls.disasters&&(this.nls.disasters=
"Disasters");"undefined"===typeof this.nls.emergencyManagement&&(this.nls.emergencyManagement="Emergency Management");"undefined"===typeof this.nls.generalInfrastructure&&(this.nls.generalInfrastructure="General Infrastructure");"undefined"===typeof this.nls.localGovernment&&(this.nls.localGovernment="Local Government");"undefined"===typeof this.nls.numbers&&(this.nls.numbers="Numbers");"undefined"===typeof this.nls.pointsOfInterest&&(this.nls.pointsOfInterest="Points of Interest");"undefined"===
typeof this.nls.stateGovernment&&(this.nls.stateGovernment="State Government")}})})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../urlUtils ../Evented ../IdentityManager".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c){var n={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},b=function(a){function c(c){a[c]||(a[c]=function(){var d=arguments;return q.when(a,
function(a){Array.prototype.unshift.call(d,a.results||a);return b(e[c].apply(e,d))})})}if(!a)return a;a.then&&(a=f.delegate(a));a.total||(a.total=q.when(a,function(a){return g.isDefined(a.total)?a.total:a.length||0}));c("forEach");c("filter");c("map");c("some");c("every");return a},h={useSSL:function(a,b){var c=n&&n.self||{};if(c&&!c.isPortal)return-1!==a.indexOf("https:")||c.allSSL?b.replace("http:","https:"):b;var d=h.getLocation(b);return-1<c.portalHostname.toLowerCase().indexOf(d.hostname.toLowerCase())&&
d.port&&"80"!==d.port&&"443"!==d.port?(b=d.pathname,b=0===b.indexOf("/")?b:"/"+b,c.allSSL||-1<a.indexOf("https:")?"https://"+d.hostname+(c.httpsPort&&"443"!==c.httpsPort?":"+c.httpsPort:"")+b+d.search:"http://"+d.hostname+(c.httpPort&&"80"!==c.httpPort?":"+c.httpPort:"")+b+d.search):-1!==a.indexOf("https:")||c.allSSL?b.replace("http:","https:"):b},formatUrl:function(a){var b=n.currentToken;return-1!==a.indexOf("null")?null:h.useSSL(window.location.protocol,b?a+(-1!==a.indexOf("?")?"\x26":"?")+("token\x3d"+
b):a)},getLocation:function(a){var b=document.createElement("a");b.href=a;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,b,c){c=c?c.listings||c.notifications||c.userInvitations||c.tags||c.items||c.groups||c.comments||c.provisions||c.results||c:[];return e.map(c,function(c){c=f.mixin(c,b||{});return a?new a(c):c})},clearFieldsFromObject:function(a,b){var c,d=a.length;if(f.isArray(a))for(c=0;c<d;c++)delete b[a[c]];
else for(c in a)delete b[c];return b},requestToTypedArray:function(a,c,d,e,g){return b(h.request(a,c,d).then(f.partial(h.resultsToTypedArray,e,g)))},request:function(a,b,c){var d;b&&b.portal&&delete b.portal;b&&b.form&&(d=b.form,delete b.form);b=f.mixin(f.mixin({},b||{}),n.requestParams);c=f.mixin(c||{},n.options);return p({url:h.useSSL(window.location.protocol,a.url||a),content:b,callbackParamName:"callback",timeout:c&&c.timeout||0,form:d},c)},formatQueryParams:function(a,b,c){a=f.mixin(f.mixin({},
a),f.isString(b)?{q:b}:b||{});a.q=!c&&n.extraQuery?"("+a.q+")"+n.extraQuery:a.q;return a}},a=t([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){f.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),u=t([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){f.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),v=t([],{declaredClass:"esri.arcgis.PortalItem",
constructor:function(a){f.mixin(this,a);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content/","/content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")+"/"):null;this.itemDataUrl=h.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=h.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();
this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a=this.type;return{source:-1<e.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===a?a:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(b){var c=
f.isString(b)?{comment:b}:b;return h.request(this.itemUrl+"/addComment",c,{usePost:!0}).then(f.hitch(this,function(b){return new a(f.mixin(c,{id:b.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return h.request(a.url+"/update",{comment:a.comment},{usePost:!0}).then(function(b){a.id=b.commentId;return a});throw Error();},getComments:function(){return h.requestToTypedArray(this.itemUrl+"/comments",null,null,a,{item:this})},deleteComment:function(a){if(a&&a.url)return h.request(a.url+
"/delete",null,{usePost:!0});throw Error();},addRating:function(a){var b=f.isObject(a)?a:{rating:parseFloat(a)};return h.request(this.itemUrl+"/addRating",b,{usePost:!0}).then(f.hitch(this,function(a){return new u(f.mixin(b,{id:a.ratingId,item:this}))}))},getRating:function(){return h.request(this.itemUrl+"/rating").then(f.hitch(this,function(a){return new u(f.mixin(a,{item:this}))}))},deleteRating:function(){return h.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var a=
this.type,b=this.typeKeywords||[],c=a;"Feature Service"===a||"Feature Collection"===a?c=-1<e.indexOf(b,"Table")?"Table":-1<e.indexOf(b,"Route Layer")?"Route Layer":-1<e.indexOf(b,"Markup")?"Markup":"Feature Layer":"Image Service"===a?c=-1<e.indexOf(b,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?c="Scene Layer":"Scene Package"===a?c="Scene Layer Package":"Stream Service"===a?c="Feature Layer":"Geoprocessing Service"===a&&this.portal&&this.portal.isPortal?c=-1<e.indexOf(b,
"Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===a?c="Locator":"Microsoft Powerpoint"===a?c="Microsoft PowerPoint":"GeoJson"===a?this.type=c="GeoJSON":"Globe Service"===a?c="Globe Layer":"Vector Tile Service"===a?c="Tile Layer":"netCDF"===a?c="NetCDF":"Map Service"===a?c=-1===e.indexOf(b,"Spatiotemporal")&&(-1<e.indexOf(b,"Hosted Service")||-1<e.indexOf(b,"Tiled"))&&-1===e.indexOf(b,"Relational")?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")?c=a.replace(/(add in)/ig,
"Add-In"):"datastore catalog service"===a?c="Big Data File Share":"Compact Tile Package"===a&&(c="Tile Package (tpkx)");return c},_getIconUrl:function(){var a=this.type&&this.type.toLowerCase()||"",b=this.typeKeywords||[],c=!1,d=!1,f=!1,g=!1,h=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a||"wfs"===a?(c=-1<e.indexOf(b,"Hosted Service"),"feature service"===a||"feature collection"===a||"kml"===a||"wfs"===a?(g=-1<e.indexOf(b,"Table"),d=-1<e.indexOf(b,"Route Layer"),
f=-1<e.indexOf(b,"Markup"),a=(h=-1!==e.indexOf(b,"Spatiotemporal"))&&g?"spatiotemporaltable":g?"table":d?"routelayer":f?"markup":h?"spatiotemporal":c?"featureshosted":"features"):"map service"===a||"wms"===a||"wmts"===a?(h=-1!==e.indexOf(b,"Spatiotemporal"),a=c||-1<e.indexOf(b,"Tiled")||"wmts"===a?"maptiles":h?"spatiotemporal":"mapimages"):a="scene service"===a?-1<e.indexOf(b,"Line")?"sceneweblayerline":-1<e.indexOf(b,"3DObject")?"sceneweblayermultipatch":-1<e.indexOf(b,"Point")?"sceneweblayerpoint":
-1<e.indexOf(b,"IntegratedMesh")?"sceneweblayermesh":-1<e.indexOf(b,"PointCloud")?"sceneweblayerpointcloud":-1<e.indexOf(b,"Polygon")?"sceneweblayerpolygon":-1<e.indexOf(b,"Building")?"sceneweblayerbuilding":"sceneweblayer":"image service"===a?-1<e.indexOf(b,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"datastore catalog service"===a?"datastorecollection":"geocoding service"===a?"geocodeservice":"geoprocessing service"===
a?-1<e.indexOf(b,"Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?-1<e.indexOf(b,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===
a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<e.indexOf(b,"ArcGIS Pro")||"explorer map"===a&&e.indexOf(b,"Explorer Document")?"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a||"360 vr experience"===a||"netcdf"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"arcgis pro add in"===a||"arcgis pro configuration"===
a?"addindesktop":"rule package"===a||"file geodatabase"===a||"sqlite geodatabase"===a||"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"form"===a||"document link"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"explorer map"===a&&-1<e.indexOf(b,"Explorer Mapping Application")||-1<e.indexOf(b,"Document")?"datafilesgray":
"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"scene package"===a?"scenepackage":"mobile scene package"===a?"mobilescenepackage":"tile package"===a||"compact tile package"===a?"tilepackage":"task file"===a?"taskfile":"report template"===a?"report-template":
"statistical data collection"===a?"statisticaldatacollection":"insights workbook"===a?"workbook":"insights model"===a?"insightsmodel":"insights page"===a?"insightspage":"insights theme"===a?"insightstheme":"hub initiative"===a?"hubinitiative":"hub page"===a?"hubpage":"hub site application"===a?"hubsite":"relational database connection"===a?"relationaldatabaseconnection":"big data file share"===a?"datastorecollection":"image collection"===a?"imagecollection":"desktop style"===a?"desktopstyle":"style"===
a?"style":"dashboard"===a?"dashboard":"raster function template"===a?"rasterprocessingtemplate":"vector tile package"===a?"vectortilepackage":"ortho mapping project"===a?"orthomappingproject":"ortho mapping template"===a?"orthomappingtemplate":"solution"===a?"solutions":"geopackage"===a?"geopackage":"deep learning package"===a?"deeplearningpackage":"real time analytic"===a?"realtimeanalytics":"big data analytic"===a?"bigdataanalytics":"feed"===a?"feed":"excalibur imagery project"===a?"excaliburimageryproject":
"notebook"===a?"notebook":"storymap"===a?"storymap":"survey123 add in"===a?"survey123addin":"mission"===a?"mission":"quickcapture project"===a?"quickcaptureproject":"pro report"===a?"proreport":"urban model"===a?"urbanmodel":"web experience"===a?"experiencebuilder":"maps";return a?m.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,b=!1;if(-1<e.indexOf(a,"Requires Subscription")||-1<e.indexOf(a,"Requires Credits"))b=!0;return b},_getPremiumIconUrl:function(){var a=
this.typeKeywords,b;this.isPremiumContent&&(b=-1<e.indexOf(a,"Requires Credits")?"premiumcredits":"premiumitem");return b?m.toUrl("../css/images/item_type_icons/"+b+"16.png"):null},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),x=t([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(a){f.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+
this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?h.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?h.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?h.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",
creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var b in this.listingProperties)this[b]&&(this.listingProperties[b]=this[b]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=e.map(this.screenshots,f.hitch(this,function(a){return h.formatUrl(this.url+"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?h.formatUrl(this.portal.portalUrl+
"/portals/self/resources/"+this.vendor.thumbnail):h.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return h.requestToTypedArray(this.commentsUrl,null,null,a,{item:this})},getVendor:function(){return this.vendor}}),z=t([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){f.mixin(this,a);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?
new Date(this.endDate):null;this.listing=a.listing?new x(f.mixin(a.listing,{portal:this.portal})):null}}),E=t([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=h.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return h.request(this.url+"/users")},
queryItems:function(a,b){a=h.formatQueryParams({},a,b);a.q="group:"+this.id+(a.q?" "+a.q:"");return this.portal.queryItems(a)},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),C=t([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return h.requestToTypedArray(this.url,
null,null,v,{portal:this.portal,folderId:this.id})}}),A=t([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=this.thumbnail?h.formatUrl(this.url+"/info/"+this.thumbnail):null;this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},
getGroups:function(){return b(h.request(this.url).then(f.hitch(this,function(a){return h.resultsToTypedArray(E,{portal:this.portal},a.groups)})))},getNotifications:function(){return h.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return h.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return h.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return b(this.getContent(null,
{num:1}).then(function(a){return a.folders}))},getItems:function(a){return b(this.getContent(a).then(function(a){return a.items}))},getItem:function(a){return h.request(this.portal.portalUrl+"content/items/"+a).then(f.hitch(this,function(a){return new v(f.mixin(a,{portal:this.portal}))}))},getContent:function(a,b){var c=this.url.replace("/community/","/content/")+(a?"/"+a:"");return h.request(c,b).then(f.hitch(this,function(b){b.folders=h.resultsToTypedArray(C,{portal:this.portal},b.folders);b.items=
h.resultsToTypedArray(v,{portal:this.portal,folderId:a},b.items);return b}))},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}});t={Portal:t([c],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(a){a=f.isObject(a)?a:{url:a};this.registerConnectEvents();n={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};a.self?(n.self=a.self,f.mixin(this,{url:a.url||d.getProtocolForWebResource()+
"//"+(a.self.urlKey?a.self.urlKey+"."+a.self.customBaseUrl:a.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",a=a.self.user?this.signIn():this.init(this.url)):(a.url&&f.mixin(this,{url:a.url}),a=this.init(this.url));a.then(f.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(a,b){a=(a||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==a.indexOf("/sharing")?a+"/":a+"/sharing/rest/";return this._getSelf(this.portalUrl).then(f.hitch(this,
function(a){n.self=f.mixin({},a);(a=a.user)&&b&&(n.currentToken=b&&b.token,n.loggedInUser=new A(f.mixin(a,{portal:this,credential:b})));n.self.id&&!1===n.self.canSearchPublic&&(n.extraQuery=" AND orgid:"+n.self.id);f.mixin(this,n.self);this.thumbnailUrl=h.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length?!0:!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),
f.hitch(this,function(a){this.onError(a);throw a;}))},signIn:function(){var a=new q,b=f.hitch(this,function(){this._onSignIn().then(f.hitch(this,function(){a.resolve(n.loggedInUser)}),f.hitch(this,function(b){a.reject(b)}))});if(n&&n.self)n&&n.loggedInUser?setTimeout(function(){a.resolve(n.loggedInUser)},0):b();else this.on("load",f.hitch(this,function(){b()}));return a},signOut:function(){n.loggedInUser.credential&&n.loggedInUser.credential.destroy();n.loggedInUser=null;n.options.disableIdentityLookup=
!0;h.clearFieldsFromObject(n.self,this);n.self=null;return this.init(this.url)},getPortalUser:function(){return n.loggedInUser},addResource:function(a,b){return h.request(this.portalUrl+"portals/self/addResource",{key:a,text:b},{usePost:!0})},update:function(a){return h.request(this.portalUrl+"portals/self/update",a,{usePost:!0})},queryGroups:function(a,b){return this._queryPortal(this.portalUrl+"community/groups",h.formatQueryParams({},a,b),E)},queryItems:function(a,b){return this._queryPortal(this.portalUrl+
"search",h.formatQueryParams({},a,b),v)},queryListings:function(a){a=h.formatQueryParams({},a,!0);var b="";a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?(a.q=a.q.toLowerCase().replace("mylistings:true",""),b="?mylistings\x3dtrue"):a.q||(a.q='""');return this._queryPortal(this.portalUrl+"content/listings"+b,a,x)},queryCustomerList:function(a,b){a=h.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",a)},getProvisions:function(){return this.getCustomers().then(f.hitch(this,
function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(f.hitch(this,function(a){return a.interests}))},getTrials:function(){return this.getCustomers().then(f.hitch(this,function(a){return a.trials}))},getCustomers:function(a){return h.request(this.portalUrl+"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},
getPurchases:function(){return h.request(this.portalUrl+"portals/self/purchases").then(f.hitch(this,function(a){a.interests=e.map(a.interests,function(a){return f.mixin(a.provision,{listing:a.listing})});a.purchases=e.map(a.purchases,function(a){return f.mixin(a.provision,{listing:a.listing})});a.trials=e.map(a.trials,function(a){return f.mixin(a.provision,{listing:a.listing})});a.interests=h.resultsToTypedArray(z,{portal:this},a.interests);a.trials=h.resultsToTypedArray(z,{portal:this},a.trials);
a.purchases=h.resultsToTypedArray(z,{portal:this},a.purchases);return a}))},queryUsers:function(a,b){return this._queryPortal(this.portalUrl+"community/users",h.formatQueryParams({sortField:"username"},a,b),A)},_onSignIn:function(){n.options.disableIdentityLookup=!1;n.self=null;return l.id.getCredential(this.portalUrl).then(f.hitch(this,"init",this.url)).then(function(){return n.loggedInUser},f.hitch(this,function(a){n.options.disableIdentityLookup=!0;this.onError(a);throw a;}))},_getSelf:function(a){var b;
a+="portals/self";n.self?(b=new q,setTimeout(function(){b.resolve(n.self)},0)):b=h.request(a,{culture:k.locale});return b},_queryPortal:function(a,c,d){var e=f.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},c),g=["start","query","num","nextStart"];a=h.request(a,e).then(f.hitch(this,function(a){a.results=h.resultsToTypedArray(d,{portal:this},a);a.queryParams=f.mixin({},e);a.nextQueryParams=f.mixin(e,{start:a.nextStart});return h.clearFieldsFromObject(g,a)}));a=f.delegate(a);a.queryParams=
f.mixin({},e);a.nextQueryParams=q.when(a,function(a){return a.nextQueryParams});return b(a)}}),PortalFolder:C,PortalGroup:E,PortalItem:v,PortalUser:A,PortalComment:a,PortalRating:u,PortalUtil:h,PortalResult:b,PortalListing:x};r("extend-esri")&&f.mixin(f.getObject("arcgis",!0,l),t);return t})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){var a=0;t=f([k,q,t],{templateString:l,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,stretchImg:!0,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,customZIndex:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},
postCreate:function(){this._initial();d.file.supportHTML5()||g("safari")||!d.file.isEnabledFlash()||d.file.loadFileAPI().then(e.hitch(this,function(){r.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(a){this.goldenWidth=a.width;this.goldenHeight=a.height},disableChooseImage:function(){r.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&r.addClass(this.displayText,"disable-label");r.removeAttr(this.domNode,"title")},enableChooseImage:function(){r.setStyle(this.fileForm,
"display","block");this.label&&"string"===typeof this.label&&r.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(a){this.defaultSelfSrc=a;this.imageData=this.selfImg.src=a},getImageData:function(){return this.imageData},_initial:function(){this._initFileForm();this._processProperties();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=this.label,r.setStyle(this.hintText,"display",
"block"));this.showSelfImg&&r.setStyle(this.hintImage,"display","block");!1===this.stretchImg?r.addClass(this.selfImg,"no-stretch-img"):r.removeClass(this.selfImg,"no-stretch-img");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var a="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?a=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(a=this.format.join(","));r.setAttr(this.fileInput,"accept",
a)}d.file.supportHTML5()||g("safari")||!d.file.isEnabledFlash()||r.setStyle(this.fileInput,{width:"100%",height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_newMessage:function(a){this.msgPopupOpen=!0;this.msgPopup=new b({customZIndex:this.customZIndex,message:a})},_porcessMaskClick:function(){r.setAttr(this.fileInput,"id","imageChooser_"+a);r.setAttr(this.mask,"for","imageChooser_"+a);a++;m.once(this.mask,"click",e.hitch(this,function(a){a.stopPropagation();if(g("safari")&&7>g("safari"))this._newMessage(this.nls.unsupportReaderAPI),
a.preventDefault();else{if(!d.file.supportHTML5()){if(!d.file.isEnabledFlash()){var b=r.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,target:"_blank"});this._newMessage(b);a.preventDefault();return}if(!d.file.supportFileAPI()){this._newMessage(this.nls.unsupportReaderAPI);a.preventDefault();return}}r.setStyle(this.fileInput,"display","none");setTimeout(e.hitch(this,function(){r.setStyle(this.fileInput,"display","block")}),200)}}))},_addTip:function(){if(this.showTip){var a=
p.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);r.setAttr(this.domNode,"title",a)}else r.setAttr(this.domNode,"title","")},_onFileInputChange:function(a){var b=a.target.files&&a.target.files[0]||a.files&&a.files[0];if(this.format&&-1===this.format.indexOf(b.type))this._newMessage(this.nls.invalidType),this._initFileForm();else{var c=1024*this.maxSize;d.file.readFile(a,"image/*",c,e.hitch(this,function(a,d,e){a?(d=this.nls[a.errCode],"exceed"===a.errCode&&(d=
d.replace("1024",c/1024)),this._newMessage(d)):(this.fileProperty.fileName=d,this.cropImage&&"image/gif"!==b.type?this._cropImageByUser(e,b.type):this._readFileData(e));this._initFileForm()}))}},_initFileForm:function(){this.mask&&r.destroy(this.mask);this.fileInput&&r.destroy(this.fileInput);this.fileForm&&r.destroy(this.fileForm);this.fileForm=r.create("form",{"data-dojo-attach-point":"fileForm"},this.domNode);this.mask=r.create("label",{"data-dojo-attach-point":"mask"},this.fileForm);this.fileInput=
r.create("input",{type:"file","data-dojo-attach-point":"fileInput"},this.fileForm);this._porcessMaskClick();m.once(this.fileInput,"change",e.hitch(this,this._onFileInputChange))},_readFileData:function(a){this.onImageChange(a,this.fileProperty);this.displayImg&&r.setAttr(this.displayImg,"src",a);this.showSelfImg&&(this.selfImg?r.setAttr(this.selfImg,"src",a):this.selfImg.src=a,(a=r.getMarginBox(this.hintImage))&&a.w&&a.h&&(r.style(this.selfImg,"maxWidth",a.w+"px"),r.style(this.selfImg,"maxHeight",
a.h+"px")))},_cropImageByUser:function(a,b){var d=new c({imageSrc:a,type:b,nls:e.clone(this.nls),goldenWidth:this.goldenWidth,goldenHeight:this.goldenHeight}),f=new h({hidden:!0});this.cropPopupOpen=!0;this.cropPopup=new n({titleLabel:this.nls.cropImage,content:d,customZIndex:this.customZIndex,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:e.hitch(this,function(){f.show();var a=d.getData();a&&this._readFileData(a);this.cropPopup.close();d.destroy();f.hide()})}]});f.placeAt(this.cropPopup.domNode);
d.startup();r.addClass(this.cropPopup.domNode,"image-chooser-crop-popup")},onImageChange:function(a){this.imageData=a;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});t.GIF="image/gif";t.JPEG="image/jpeg";t.PNG="image/png";return t})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html jimu/dijit/Message libs/cropperjs/cropperjs xstyle/css!libs/cropperjs/cropper.css dojo/NodeList-dom".split(" "),
function(t,f,k,q,e,r,m,l,g){return t([e,r],{templateString:m,imageSrc:null,type:null,goldenWidth:4,goldenHeight:3,_haveShowReadErrMsg:!1,postCreate:function(){this.type||(this.type="image/jpeg");this.setImageSrc(this.imageSrc);this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this._checkImgError();this.own(q(this.baseImage,"load",k.hitch(this,function(){f.setStyle(this.loadingImg,"display","none");this._initCropper()})))},_initCropper:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();
this.cropper=new g(this.baseImage,{aspectRatio:this.goldenWidth/this.goldenHeight,preview:".img-preview"})},setImageSrc:function(e){f.setAttr(this.baseImage,"src",e)},getData:function(){try{var e=this.cropper.getCroppedCanvas();this.cropper.getCroppedCanvas();return e.toDataURL(this.type||"image/jpeg")}catch(d){return this._readError(),null}},destroy:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();this.inherited(arguments)},_checkImgError:function(){setTimeout(k.hitch(this,function(){"none"!==
f.getStyle(this.loadingImg,"display")&&this._readError()}),5E3)},_readError:function(){this._haveShowReadErrMsg||(new l({message:this.nls.readError}),this._haveShowReadErrMsg=!0)}})})},"libs/cropperjs/cropperjs":function(){!function(t,f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define(f):(t=t||self).Cropper=f()}(this,function(){function t(a){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:
function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}function k(a){if(!(a=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}(a)||function(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}(a)))throw new TypeError("Invalid attempt to spread non-iterable instance");
return a}function q(a){return"number"==typeof a&&!U(a)}function e(a){return"object"===t(a)&&null!==a}function r(a){if(!e(a))return!1;try{var b=a.constructor,c=b.prototype;return b&&c&&ca.call(c,"isPrototypeOf")}catch(na){return!1}}function m(a){return"function"==typeof a}function l(a){return Array.from?Array.from(a):y.call(a)}function g(a,b){return a&&m(b)&&(Array.isArray(a)||q(a.length)?l(a).forEach(function(c,d){b.call(a,c,d,a)}):e(a)&&Object.keys(a).forEach(function(c){b.call(a,a[c],c,a)})),a}
function p(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1E11;return ga.test(a)?Math.round(a*b)/b:a}function d(a,b){var c=a.style;g(b,function(a,b){la.test(b)&&q(a)&&(a="".concat(a,"px"));c[b]=a})}function c(a,b){if(b)if(q(a.length))g(a,function(a){c(a,b)});else if(a.classList)a.classList.add(b);else{var d=a.className.trim();d?0>d.indexOf(b)&&(a.className="".concat(d," ").concat(b)):a.className=b}}function n(a,b){b&&(q(a.length)?g(a,function(a){n(a,b)}):a.classList?a.classList.remove(b):
0<=a.className.indexOf(b)&&(a.className=a.className.replace(b,"")))}function b(a,d,e){d&&(q(a.length)?g(a,function(a){b(a,d,e)}):e?c(a,d):n(a,d))}function h(a){return a.replace(ea,"$1-$2").toLowerCase()}function a(a,b){return e(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-".concat(h(b)))}function u(a,b,c){e(c)?a[b]=c:a.dataset?a.dataset[b]=c:a.setAttribute("data-".concat(h(b)),c)}function v(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},e=c;b.trim().split(ma).forEach(function(b){if(!fa){var f=
a.listeners;f&&f[b]&&f[b][c]&&(e=f[b][c],delete f[b][c],0===Object.keys(f[b]).length&&delete f[b],0===Object.keys(f).length&&delete a.listeners)}a.removeEventListener(b,e,d)})}function x(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},e=c;b.trim().split(ma).forEach(function(b){if(d.once&&!fa){var f=a.listeners,g=void 0===f?{}:f;e=function(){delete g[b][c];a.removeEventListener(b,e,d);for(var f=arguments.length,h=Array(f),n=0;n<f;n++)h[n]=arguments[n];c.apply(a,h)};g[b]||(g[b]=
{});g[b][c]&&a.removeEventListener(b,g[b][c],d);g[b][c]=e;a.listeners=g}a.addEventListener(b,e,d)})}function z(a,b,c){var d;return m(Event)&&m(CustomEvent)?d=new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}):(d=document.createEvent("CustomEvent")).initCustomEvent(b,!0,!0,c),a.dispatchEvent(d)}function E(a){a=a.getBoundingClientRect();return{left:a.left+(window.pageXOffset-document.documentElement.clientLeft),top:a.top+(window.pageYOffset-document.documentElement.clientTop)}}function C(a){a=a.match(ha);
return null!==a&&(a[1]!==da.protocol||a[2]!==da.hostname||a[3]!==da.port)}function A(a){var b="timestamp\x3d".concat((new Date).getTime());return a+(-1===a.indexOf("?")?"?":"\x26")+b}function w(a){var b=a.rotate,c=a.scaleX,d=a.scaleY,e=a.translateX;a=a.translateY;var f=[];q(e)&&0!==e&&f.push("translateX(".concat(e,"px)"));q(a)&&0!==a&&f.push("translateY(".concat(a,"px)"));q(b)&&0!==b&&f.push("rotate(".concat(b,"deg)"));q(c)&&1!==c&&f.push("scaleX(".concat(c,")"));q(d)&&1!==d&&f.push("scaleY(".concat(d,
")"));b=f.length?f.join(" "):"none";return{WebkitTransform:b,msTransform:b,transform:b}}function B(a,b){var c=a.pageX;a=a.pageY;var d={endX:c,endY:a};return b?d:T({startX:c,startY:a},d)}function F(a){var b=a.aspectRatio,c=a.height,d=a.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"contain",f=0<d&&d<1/0,g=0<c&&c<1/0;f&&g?(f=c*b,"contain"===e&&d<f||"cover"===e&&f<d?c=d/b:d=c*b):f?c=d/b:g&&(d=c*b);return{width:d,height:c}}function D(a){var b;a=new DataView(a);try{var c,d,e;if(255===
a.getUint8(0)&&216===a.getUint8(1))for(var f=a.byteLength,g=2;g+1<f;){if(255===a.getUint8(g)&&225===a.getUint8(g+1)){d=g;break}g+=1}if(d){var f=d+10,h=d+4;d=4;g="";for(d+=h;h<d;h+=1)g+=ka(a.getUint8(h));if("Exif"===g){var n=a.getUint16(f);if(((c=18761===n)||19789===n)&&42===a.getUint16(f+2,c)){var l=a.getUint32(f+4,c);8<=l&&(e=f+l)}}}if(e){var k,p,m=a.getUint16(e,c);for(p=0;p<m;p+=1)if(k=e+12*p+2,274===a.getUint16(k,c)){k+=8;b=a.getUint16(k,c);a.setUint16(k,1,c);break}}}catch(ra){b=1}return b}var G=
"undefined"!=typeof window,H=G?window:{},M=!!G&&"ontouchstart"in H.document.documentElement,L=!!G&&"PointerEvent"in H,J="".concat("cropper","-crop"),K="".concat("cropper","-disabled"),N="".concat("cropper","-hidden"),P="".concat("cropper","-hide"),Q="".concat("cropper","-invisible"),O="".concat("cropper","-modal"),R="".concat("cropper","-move"),I="".concat("cropper","Action"),V="".concat("cropper","Preview"),Y=L?"pointerdown":M?"touchstart":"mousedown",S=L?"pointermove":M?"touchmove":"mousemove",
Z=L?"pointerup pointercancel":M?"touchend touchcancel":"mouseup",aa=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,ba=/^data:image\/jpeg;base64,/,W=/^img|canvas$/i,X={viewMode:0,dragMode:"crop",initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,
cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},U=Number.isNaN||H.isNaN,ca=Object.prototype.hasOwnProperty,y=Array.prototype.slice,T=Object.assign||function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return e(a)&&0<c.length&&c.forEach(function(b){e(b)&&Object.keys(b).forEach(function(c){a[c]=
b[c]})}),a},ga=/\.\d*(?:0|9){12}\d*$/,la=/^width|height|left|top|marginLeft|marginTop$/,ea=/([a-z\d])([A-Z])/g,ma=/\s\s*/,fa=function(){var a=!1;if(G){var b=!1,c=function(){},d=Object.defineProperty({},"once",{get:function(){return a=!0,b},set:function(a){b=a}});H.addEventListener("test",c,d);H.removeEventListener("test",c,d)}return a}(),da=H.location,ha=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i,ka=String.fromCharCode,ia=/^data:.*,/,oa=H.Cropper,M=function(){function a(b){var c=1<arguments.length&&void 0!==
arguments[1]?arguments[1]:{};if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(!b||!W.test(b.tagName))throw Error("The first argument is required and must be an \x3cimg\x3e or \x3ccanvas\x3e element.");this.element=b;this.options=T({},X,r(c)&&c);this.disabled=this.cropped=!1;this.pointers={};this.sizing=this.sized=this.replaced=this.reloading=this.ready=!1;this.init()}var b,d;return d=[{key:"noConflict",value:function(){return window.Cropper=oa,a}},{key:"setDefaults",
value:function(a){T(X,r(a)&&a)}}],b=[{key:"init",value:function(){var a,b=this.element,c=b.tagName.toLowerCase();if(!b.cropper){if(b.cropper=this,"img"===c){if(this.isImg=!0,a=b.getAttribute("src")||"",!(this.originalUrl=a))return;a=b.src}else"canvas"===c&&window.HTMLCanvasElement&&(a=b.toDataURL());this.load(a)}}},{key:"load",value:function(a){var b=this;if(a){this.url=a;this.imageData={};var c=this.element,d=this.options;if(d.rotatable||d.scalable||(d.checkOrientation=!1),d.checkOrientation&&window.ArrayBuffer)if(ba.test(a))this.read((e=
a.replace(ia,""),f=atob(e),h=new ArrayBuffer(f.length),g(n=new Uint8Array(h),function(a,b){n[b]=f.charCodeAt(b)}),h));else{var e,f,h,n,l=new XMLHttpRequest;e=this.clone.bind(this);this.reloading=!0;(this.xhr=l).onabort=e;l.onerror=e;l.ontimeout=e;l.onprogress=function(){"image/jpeg"!==l.getResponseHeader("content-type")&&l.abort()};l.onload=function(){b.read(l.response)};l.onloadend=function(){b.reloading=!1;b.xhr=null};d.checkCrossOrigin&&C(a)&&c.crossOrigin&&(a=A(a));l.open("GET",a);l.responseType=
"arraybuffer";l.withCredentials="use-credentials"===c.crossOrigin;l.send()}else this.clone()}}},{key:"read",value:function(a){var b=this.options,c=this.imageData,d=D(a),e=0,f=1,g=1;1<d&&(this.url=function(a,b){var c=[];for(a=new Uint8Array(a);0<a.length;)c.push(ka.apply(null,l(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(b,";base64,").concat(btoa(c.join("")))}(a,"image/jpeg"),a=function(a){var b=0,c=1,d=1;switch(a){case 2:c=-1;break;case 3:b=-180;break;case 4:d=-1;break;case 5:b=
90;d=-1;break;case 6:b=90;break;case 7:b=90;c=-1;break;case 8:b=-90}return{rotate:b,scaleX:c,scaleY:d}}(d),e=a.rotate,f=a.scaleX,g=a.scaleY);b.rotatable&&(c.rotate=e);b.scalable&&(c.scaleX=f,c.scaleY=g);this.clone()}},{key:"clone",value:function(){var a,b,d=this.element,e=this.url;this.options.checkCrossOrigin&&C(e)&&(b=(a=d.crossOrigin)?e:(a="anonymous",A(e)));this.crossOrigin=a;this.crossOriginUrl=b;var f=document.createElement("img");a&&(f.crossOrigin=a);f.src=b||e;(this.image=f).onload=this.start.bind(this);
f.onerror=this.stop.bind(this);c(f,P);d.parentNode.insertBefore(f,d.nextSibling)}},{key:"start",value:function(){var a=this,b=this.isImg?this.element:this.image;b.onload=null;b.onerror=null;this.sizing=!0;var c=H.navigator&&/^(?:.(?!chrome|android))*safari/i.test(H.navigator.userAgent),d=function(b,c){T(a.imageData,{naturalWidth:b,naturalHeight:c,aspectRatio:b/c});a.sizing=!1;a.sized=!0;a.build()};if(!b.naturalWidth||c){var e=document.createElement("img"),f=document.body||document.documentElement;
(this.sizingImage=e).onload=function(){d(e.width,e.height);c||f.removeChild(e)};e.src=b.src;c||(e.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",f.appendChild(e))}else d(b.naturalWidth,b.naturalHeight)}},{key:"stop",value:function(){var a=this.image;a.onload=null;a.onerror=null;a.parentNode.removeChild(a);this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var a=
this.element,b=this.options,d=this.image,e=a.parentNode,f=document.createElement("div");f.innerHTML='\x3cdiv class\x3d"cropper-container" touch-action\x3d"none"\x3e\x3cdiv class\x3d"cropper-wrap-box"\x3e\x3cdiv class\x3d"cropper-canvas"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-drag-box"\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-crop-box"\x3e\x3cspan class\x3d"cropper-view-box"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-h"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-v"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-center"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-face"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-ne" data-cropper-action\x3d"ne"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-nw" data-cropper-action\x3d"nw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-sw" data-cropper-action\x3d"sw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-se" data-cropper-action\x3d"se"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
var f=f.querySelector(".".concat("cropper","-container")),g=f.querySelector(".".concat("cropper","-canvas")),h=f.querySelector(".".concat("cropper","-drag-box")),l=f.querySelector(".".concat("cropper","-crop-box")),k=l.querySelector(".".concat("cropper","-face"));this.container=e;this.cropper=f;this.canvas=g;this.dragBox=h;this.cropBox=l;this.viewBox=f.querySelector(".".concat("cropper","-view-box"));this.face=k;g.appendChild(d);c(a,N);e.insertBefore(f,a.nextSibling);this.isImg||n(d,P);this.initPreview();
this.bind();b.initialAspectRatio=Math.max(0,b.initialAspectRatio)||NaN;b.aspectRatio=Math.max(0,b.aspectRatio)||NaN;b.viewMode=Math.max(0,Math.min(3,Math.round(b.viewMode)))||0;c(l,N);b.guides||c(l.getElementsByClassName("".concat("cropper","-dashed")),N);b.center||c(l.getElementsByClassName("".concat("cropper","-center")),N);b.background&&c(f,"".concat("cropper","-bg"));b.highlight||c(k,Q);b.cropBoxMovable&&(c(k,R),u(k,I,"all"));b.cropBoxResizable||(c(l.getElementsByClassName("".concat("cropper",
"-line")),N),c(l.getElementsByClassName("".concat("cropper","-point")),N));this.render();this.ready=!0;this.setDragMode(b.dragMode);b.autoCrop&&this.crop();this.setData(b.data);m(b.ready)&&x(a,"ready",b.ready,{once:!0});z(a,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),n(this.element,N))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?
(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],f(a.prototype,b),d&&f(a,d),a}();return T(M.prototype,{render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.cropped&&this.renderCropBox()},initContainer:function(){var a=this.element,b=this.options,e=this.container,f=this.cropper;c(f,N);n(a,N);b={width:Math.max(e.offsetWidth,Number(b.minContainerWidth)||200),height:Math.max(e.offsetHeight,
Number(b.minContainerHeight)||100)};d(f,{width:(this.containerData=b).width,height:b.height});c(a,N);n(f,N)},initCanvas:function(){var a=this.containerData,b=this.imageData,c=this.options.viewMode,d=90==Math.abs(b.rotate)%180,e=d?b.naturalHeight:b.naturalWidth,f=d?b.naturalWidth:b.naturalHeight,g=e/f,d=a.width,h=a.height;a.height*g>a.width?3===c?d=a.height*g:h=a.width/g:3===c?h=a.width/g:d=a.height*g;e={aspectRatio:g,naturalWidth:e,naturalHeight:f,width:d,height:h};e.left=(a.width-d)/2;e.top=(a.height-
h)/2;e.oldLeft=e.left;e.oldTop=e.top;this.canvasData=e;this.limited=1===c||2===c;this.limitCanvas(!0,!0);this.initialImageData=T({},b);this.initialCanvasData=T({},e)},limitCanvas:function(a,b){var c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=c.viewMode,h=e.aspectRatio,n=this.cropped&&f;a&&(a=Number(c.minCanvasWidth)||0,c=Number(c.minCanvasHeight)||0,1<g?(a=Math.max(a,d.width),c=Math.max(c,d.height),3===g&&(a<c*h?a=c*h:c=a/h)):0<g&&(a?a=Math.max(a,n?f.width:0):c?c=Math.max(c,
n?f.height:0):n&&((a=f.width)<(c=f.height)*h?a=c*h:c=a/h)),h=F({aspectRatio:h,width:a,height:c}),a=h.width,c=h.height,e.minWidth=a,e.minHeight=c,e.maxWidth=1/0,e.maxHeight=1/0);b&&((n?0:1)<g?(b=d.width-e.width,h=d.height-e.height,e.minLeft=Math.min(0,b),e.minTop=Math.min(0,h),e.maxLeft=Math.max(0,b),e.maxTop=Math.max(0,h),n&&this.limited&&(e.minLeft=Math.min(f.left,f.left+(f.width-e.width)),e.minTop=Math.min(f.top,f.top+(f.height-e.height)),e.maxLeft=f.left,e.maxTop=f.top,2===g&&(e.width>=d.width&&
(e.minLeft=Math.min(0,b),e.maxLeft=Math.max(0,b)),e.height>=d.height&&(e.minTop=Math.min(0,h),e.maxTop=Math.max(0,h))))):(e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=d.width,e.maxTop=d.height))},renderCanvas:function(a,b){var c=this.canvasData,e=this.imageData;if(b){var f;b=e.naturalWidth*Math.abs(e.scaleX||1);f=e.naturalHeight*Math.abs(e.scaleY||1);e=e.rotate||0;if(90==(e=Math.abs(e)%180))f={width:f,height:b};else{var g=e%90*Math.PI/180,h=Math.sin(g),n=Math.cos(g),g=b*n+f*h;b=b*h+f*n;f=90<e?
{width:b,height:g}:{width:g,height:b}}b=f.width;f=f.height;e=b/c.naturalWidth*c.width;h=f/c.naturalHeight*c.height;c.left-=(e-c.width)/2;c.top-=(h-c.height)/2;c.width=e;c.height=h;c.aspectRatio=b/f;c.naturalWidth=b;c.naturalHeight=f;this.limitCanvas(!0,!1)}(c.width>c.maxWidth||c.width<c.minWidth)&&(c.left=c.oldLeft);(c.height>c.maxHeight||c.height<c.minHeight)&&(c.top=c.oldTop);c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth);c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight);
this.limitCanvas(!1,!0);c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft);c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop);c.oldLeft=c.left;c.oldTop=c.top;d(this.canvas,T({width:c.width,height:c.height},w({translateX:c.left,translateY:c.top})));this.renderImage(a);this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(a){var b=this.canvasData,c=this.imageData,e=b.width/b.naturalWidth*c.naturalWidth,f=b.height/b.naturalHeight*c.naturalHeight;T(c,{width:e,height:f,left:(b.width-
e)/2,top:(b.height-f)/2});d(this.image,T({width:c.width,height:c.height},w(T({translateX:c.left,translateY:c.top},c))));a&&this.output()},initCropBox:function(){var a=this.options,b=this.canvasData,c=a.aspectRatio||a.initialAspectRatio,a=Number(a.autoCropArea)||.8,d={width:b.width,height:b.height};c&&(b.height*c>b.width?d.height=d.width/c:d.width=d.height*c);this.cropBoxData=d;this.limitCropBox(!0,!0);d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth);d.height=Math.min(Math.max(d.height,d.minHeight),
d.maxHeight);d.width=Math.max(d.minWidth,d.width*a);d.height=Math.max(d.minHeight,d.height*a);d.left=b.left+(b.width-d.width)/2;d.top=b.top+(b.height-d.height)/2;d.oldLeft=d.left;d.oldTop=d.top;this.initialCropBoxData=T({},d)},limitCropBox:function(a,b){var c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=this.limited,h=c.aspectRatio;if(a){a=Number(c.minCropBoxWidth)||0;var c=Number(c.minCropBoxHeight)||0,n=g?Math.min(d.width,e.width,e.width+e.left,d.width-e.left):d.width,
l=g?Math.min(d.height,e.height,e.height+e.top,d.height-e.top):d.height;a=Math.min(a,d.width);c=Math.min(c,d.height);h&&(a&&c?a<c*h?c=a/h:a=c*h:a?c=a/h:c&&(a=c*h),n<l*h?l=n/h:n=l*h);f.minWidth=Math.min(a,n);f.minHeight=Math.min(c,l);f.maxWidth=n;f.maxHeight=l}b&&(f.maxTop=g?(f.minLeft=Math.max(0,e.left),f.minTop=Math.max(0,e.top),f.maxLeft=Math.min(d.width,e.left+e.width)-f.width,Math.min(d.height,e.top+e.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=d.width-f.width,d.height-f.height))},renderCropBox:function(){var a=
this.options,b=this.containerData,c=this.cropBoxData;(c.width>c.maxWidth||c.width<c.minWidth)&&(c.left=c.oldLeft);(c.height>c.maxHeight||c.height<c.minHeight)&&(c.top=c.oldTop);c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth);c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight);this.limitCropBox(!1,!0);c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft);c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop);c.oldLeft=c.left;c.oldTop=c.top;a.movable&&a.cropBoxMovable&&u(this.face,I,
c.width>=b.width&&c.height>=b.height?"move":"all");d(this.cropBox,T({width:c.width,height:c.height},w({translateX:c.left,translateY:c.top})));this.cropped&&this.limited&&this.limitCanvas(!0,!0);this.disabled||this.output()},output:function(){this.preview();z(this.element,"crop",this.getData())}},{initPreview:function(){var a=this.crossOrigin,b=this.options.preview,c=a?this.crossOriginUrl:this.url,d=document.createElement("img");if(a&&(d.crossOrigin=a),d.src=c,this.viewBox.appendChild(d),this.viewBoxImage=
d,b)d=b,"string"==typeof b?d=this.element.ownerDocument.querySelectorAll(b):b.querySelector&&(d=[b]),g(this.previews=d,function(b){var d=document.createElement("img");u(b,V,{width:b.offsetWidth,height:b.offsetHeight,html:b.innerHTML});a&&(d.crossOrigin=a);d.src=c;d.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"';b.innerHTML="";b.appendChild(d)})},resetPreview:function(){g(this.previews,
function(b){var c=a(b,V);d(b,{width:c.width,height:c.height});b.innerHTML=c.html;if(e(b[V]))try{delete b[V]}catch(ja){b[V]=void 0}else if(b.dataset)try{delete b.dataset[V]}catch(ja){b.dataset[V]=void 0}else b.removeAttribute("data-".concat(h(V)))})},preview:function(){var b=this.imageData,c=this.canvasData,e=this.cropBoxData,f=e.width,h=e.height,n=b.width,l=b.height,k=e.left-c.left-b.left,p=e.top-c.top-b.top;this.cropped&&!this.disabled&&(d(this.viewBoxImage,T({width:n,height:l},w(T({translateX:-k,
translateY:-p},b)))),g(this.previews,function(c){var e=a(c,V),g=e.width,e=e.height,m=g,u=e,r=1;f&&(u=h*(r=g/f));h&&e<u&&(m=f*(r=e/h),u=e);d(c,{width:m,height:u});d(c.getElementsByTagName("img")[0],T({width:n*r,height:l*r},w(T({translateX:-k*r,translateY:-p*r},b))))}))}},{bind:function(){var a=this.element,b=this.options,c=this.cropper;m(b.cropstart)&&x(a,"cropstart",b.cropstart);m(b.cropmove)&&x(a,"cropmove",b.cropmove);m(b.cropend)&&x(a,"cropend",b.cropend);m(b.crop)&&x(a,"crop",b.crop);m(b.zoom)&&
x(a,"zoom",b.zoom);x(c,Y,this.onCropStart=this.cropStart.bind(this));b.zoomable&&b.zoomOnWheel&&x(c,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0});b.toggleDragModeOnDblclick&&x(c,"dblclick",this.onDblclick=this.dblclick.bind(this));x(a.ownerDocument,S,this.onCropMove=this.cropMove.bind(this));x(a.ownerDocument,Z,this.onCropEnd=this.cropEnd.bind(this));b.responsive&&x(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var a=this.element,b=this.options,c=this.cropper;
m(b.cropstart)&&v(a,"cropstart",b.cropstart);m(b.cropmove)&&v(a,"cropmove",b.cropmove);m(b.cropend)&&v(a,"cropend",b.cropend);m(b.crop)&&v(a,"crop",b.crop);m(b.zoom)&&v(a,"zoom",b.zoom);v(c,Y,this.onCropStart);b.zoomable&&b.zoomOnWheel&&v(c,"wheel",this.onWheel,{passive:!1,capture:!0});b.toggleDragModeOnDblclick&&v(c,"dblclick",this.onDblclick);v(a.ownerDocument,S,this.onCropMove);v(a.ownerDocument,Z,this.onCropEnd);b.responsive&&v(window,"resize",this.onResize)}},{resize:function(){var a=this.options,
b=this.container,c=this.containerData,d=Number(a.minContainerWidth)||200,e=Number(a.minContainerHeight)||100;if(!(this.disabled||c.width<=d||c.height<=e)){var f,h,n=b.offsetWidth/c.width;if(1!==n||b.offsetHeight!==c.height)a.restore&&(f=this.getCanvasData(),h=this.getCropBoxData()),this.render(),a.restore&&(this.setCanvasData(g(f,function(a,b){f[b]=a*n})),this.setCropBoxData(g(h,function(a,b){h[b]=a*n})))}},dblclick:function(){var a;this.disabled||"none"===this.options.dragMode||this.setDragMode((a=
this.dragBox,(a.classList?a.classList.contains(J):-1<a.className.indexOf(J))?"move":"crop"))},wheel:function(a){var b=this,c=Number(this.options.wheelZoomRatio)||.1,d=1;this.disabled||(a.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){b.wheeling=!1},50),a.deltaY?d=0<a.deltaY?1:-1:a.wheelDelta?d=-a.wheelDelta/120:a.detail&&(d=0<a.detail?1:-1),this.zoom(-d*c,a)))},cropStart:function(b){var d=b.buttons,e=b.button;if(!(this.disabled||q(d)&&1!==d||q(e)&&0!==e||b.ctrlKey)){var d=
this.options,f=this.pointers;b.changedTouches?g(b.changedTouches,function(a){f[a.identifier]=B(a)}):f[b.pointerId||0]=B(b);d=1<Object.keys(f).length&&d.zoomable&&d.zoomOnTouch?"zoom":a(b.target,I);aa.test(d)&&!1!==z(this.element,"cropstart",{originalEvent:b,action:d})&&(b.preventDefault(),this.action=d,this.cropping=!1,"crop"===d&&(this.cropping=!0,c(this.dragBox,O)))}},cropMove:function(a){var b=this.action;if(!this.disabled&&b){var c=this.pointers;a.preventDefault();!1!==z(this.element,"cropmove",
{originalEvent:a,action:b})&&(a.changedTouches?g(a.changedTouches,function(a){T(c[a.identifier]||{},B(a,!0))}):T(c[a.pointerId||0]||{},B(a,!0)),this.change(a))}},cropEnd:function(a){if(!this.disabled){var c=this.action,d=this.pointers;a.changedTouches?g(a.changedTouches,function(a){delete d[a.identifier]}):delete d[a.pointerId||0];c&&(a.preventDefault(),Object.keys(d).length||(this.action=""),this.cropping&&(this.cropping=!1,b(this.dragBox,O,this.cropped&&this.options.modal)),z(this.element,"cropend",
{originalEvent:a,action:c}))}}},{change:function(a){var b=this.canvasData,c=this.containerData,d=this.cropBoxData,e=this.pointers,f=this.action,h=this.options.aspectRatio,l=d.left,k=d.top,p=d.width,m=d.height,u=l+p,r=k+m,q=0,x=0,t=c.width,v=c.height,z=!0;!h&&a.shiftKey&&(h=p&&m?p/m:1);this.limited&&(q=d.minLeft,x=d.minTop,t=q+Math.min(c.width,b.width,b.left+b.width),v=x+Math.min(c.height,b.height,b.top+b.height));var C,w,b=e[Object.keys(e)[0]],A=b.endX-b.startX,B=b.endY-b.startY,c=function(a){switch(a){case "e":u+
A>t&&(A=t-u);break;case "w":l+A<q&&(A=q-l);break;case "n":k+B<x&&(B=x-k);break;case "s":r+B>v&&(B=v-r)}};switch(f){case "all":l+=A;k+=B;break;case "e":if(0<=A&&(t<=u||h&&(k<=x||v<=r))){z=!1;break}c("e");0>(p+=A)&&(f="w",l-=p=-p);h&&(m=p/h,k+=(d.height-m)/2);break;case "n":if(0>=B&&(k<=x||h&&(l<=q||t<=u))){z=!1;break}c("n");m-=B;k+=B;0>m&&(f="s",k-=m=-m);h&&(p=m*h,l+=(d.width-p)/2);break;case "w":if(0>=A&&(l<=q||h&&(k<=x||v<=r))){z=!1;break}c("w");p-=A;l+=A;0>p&&(f="e",l-=p=-p);h&&(m=p/h,k+=(d.height-
m)/2);break;case "s":if(0<=B&&(v<=r||h&&(l<=q||t<=u))){z=!1;break}c("s");0>(m+=B)&&(f="n",k-=m=-m);h&&(p=m*h,l+=(d.width-p)/2);break;case "ne":if(h){if(0>=B&&(k<=x||t<=u)){z=!1;break}c("n");m-=B;k+=B;p=m*h}else c("n"),c("e"),0<=A?u<t?p+=A:0>=B&&k<=x&&(z=!1):p+=A,0>=B?x<k&&(m-=B,k+=B):(m-=B,k+=B);0>p&&0>m?(f="sw",k-=m=-m,l-=p=-p):0>p?(f="nw",l-=p=-p):0>m&&(f="se",k-=m=-m);break;case "nw":if(h){if(0>=B&&(k<=x||l<=q)){z=!1;break}c("n");m-=B;k+=B;p=m*h;l+=d.width-p}else c("n"),c("w"),0>=A?q<l?(p-=A,l+=
A):0>=B&&k<=x&&(z=!1):(p-=A,l+=A),0>=B?x<k&&(m-=B,k+=B):(m-=B,k+=B);0>p&&0>m?(f="se",k-=m=-m,l-=p=-p):0>p?(f="ne",l-=p=-p):0>m&&(f="sw",k-=m=-m);break;case "sw":if(h){if(0>=A&&(l<=q||v<=r)){z=!1;break}c("w");p-=A;l+=A;m=p/h}else c("s"),c("w"),0>=A?q<l?(p-=A,l+=A):0<=B&&v<=r&&(z=!1):(p-=A,l+=A),0<=B?r<v&&(m+=B):m+=B;0>p&&0>m?(f="ne",k-=m=-m,l-=p=-p):0>p?(f="se",l-=p=-p):0>m&&(f="nw",k-=m=-m);break;case "se":if(h){if(0<=A&&(t<=u||v<=r)){z=!1;break}c("e");m=(p+=A)/h}else c("s"),c("e"),0<=A?u<t?p+=A:
0<=B&&v<=r&&(z=!1):p+=A,0<=B?r<v&&(m+=B):m+=B;0>p&&0>m?(f="nw",k-=m=-m,l-=p=-p):0>p?(f="sw",l-=p=-p):0>m&&(f="ne",k-=m=-m);break;case "move":this.move(A,B);z=!1;break;case "zoom":this.zoom((C=T({},e),w=[],g(e,function(a,b){delete C[b];g(C,function(b){var c=Math.abs(a.startX-b.startX),d=Math.abs(a.startY-b.startY),e=Math.abs(a.endX-b.endX);b=Math.abs(a.endY-b.endY);c=Math.sqrt(c*c+d*d);w.push((Math.sqrt(e*e+b*b)-c)/c)})}),w.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),w[0]),a);z=!1;break;case "crop":A&&
B?(a=E(this.cropper),l=b.startX-a.left,k=b.startY-a.top,p=d.minWidth,m=d.minHeight,0<A?f=0<B?"se":"ne":0>A&&(l-=p,f=0<B?"sw":"nw"),0>B&&(k-=m),this.cropped||(n(this.cropBox,N),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))):z=!1}z&&(d.width=p,d.height=m,d.left=l,d.top=k,this.action=f,this.renderCropBox());g(e,function(a){a.startX=a.endX;a.startY=a.endY})}},{crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&c(this.dragBox,
O),n(this.cropBox,N),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=T({},this.initialImageData),this.canvasData=T({},this.initialCanvasData),this.cropBoxData=T({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(T(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),
n(this.dragBox,O),c(this.cropBox,N)),this},replace:function(a){var b=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&a&&(this.isImg&&(this.element.src=a),b?(this.url=a,this.image.src=a,this.ready&&(this.viewBoxImage.src=a,g(this.previews,function(b){b.getElementsByTagName("img")[0].src=a}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(a))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,n(this.cropper,K)),
this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,c(this.cropper,K)),this},destroy:function(){var a=this.element;return a.cropper&&(a.cropper=void 0,this.isImg&&this.replaced&&(a.src=this.originalUrl),this.uncreate()),this},move:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a,c=this.canvasData,d=c.left,c=c.top;return this.moveTo(void 0===a?a:d+Number(a),void 0===b?b:c+Number(b))},moveTo:function(a){var b=1<arguments.length&&void 0!==arguments[1]?
arguments[1]:a,c=this.canvasData,d=!1;return a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.movable&&(q(a)&&(c.left=a,d=!0),q(b)&&(c.top=b,d=!0),d&&this.renderCanvas(!0)),this},zoom:function(a,b){var c=this.canvasData;return a=0>(a=Number(a))?1/(1-a):1+a,this.zoomTo(c.width*a/c.naturalWidth,null,b)},zoomTo:function(a,b,c){var d,e,f,h=this.options,n=this.canvasData,l=n.width,k=n.height,p=n.naturalWidth,m=n.naturalHeight;if(0<=(a=Number(a))&&this.ready&&!this.disabled&&h.zoomable){h=
p*a;m*=a;if(!1===z(this.element,"zoom",{ratio:a,oldRatio:l/p,originalEvent:c}))return this;c?(b=this.pointers,a=E(this.cropper),c=b&&Object.keys(b).length?(f=e=d=0,g(b,function(a){var b=a.startY;d+=a.startX;e+=b;f+=1}),{pageX:d/=f,pageY:e/=f}):{pageX:c.pageX,pageY:c.pageY},n.left-=(c.pageX-a.left-n.left)/l*(h-l),n.top-=(c.pageY-a.top-n.top)/k*(m-k)):r(b)&&q(b.x)&&q(b.y)?(n.left-=(b.x-n.left)/l*(h-l),n.top-=(b.y-n.top)/k*(m-k)):(n.left-=(h-l)/2,n.top-=(m-k)/2);n.width=h;n.height=m;this.renderCanvas(!0)}return this},
rotate:function(a){return this.rotateTo((this.imageData.rotate||0)+Number(a))},rotateTo:function(a){return q(a=Number(a))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=a%360,this.renderCanvas(!0,!0)),this},scaleX:function(a){var b=this.imageData.scaleY;return this.scale(a,q(b)?b:1)},scaleY:function(a){var b=this.imageData.scaleX;return this.scale(q(b)?b:1,a)},scale:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a,c=this.imageData,d=!1;return a=
Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.scalable&&(q(a)&&(c.scaleX=a,d=!0),q(b)&&(c.scaleY=b,d=!0),d&&this.renderCanvas(!0,!0)),this},getData:function(){var a,b=0<arguments.length&&void 0!==arguments[0]&&arguments[0],c=this.options,d=this.imageData,e=this.canvasData,f=this.cropBoxData;if(this.ready&&this.cropped){a={x:f.left-e.left,y:f.top-e.top,width:f.width,height:f.height};var h=d.width/d.naturalWidth;if(g(a,function(b,c){a[c]=b/h}),b)b=Math.round(a.y+a.height),e=Math.round(a.x+
a.width),a.x=Math.round(a.x),a.y=Math.round(a.y),a.width=e-a.x,a.height=b-a.y}else a={x:0,y:0,width:0,height:0};return c.rotatable&&(a.rotate=d.rotate||0),c.scalable&&(a.scaleX=d.scaleX||1,a.scaleY=d.scaleY||1),a},setData:function(a){var b=this.options,c=this.imageData,d=this.canvasData,e={};if(this.ready&&!this.disabled&&r(a)){var f=!1;b.rotatable&&q(a.rotate)&&a.rotate!==c.rotate&&(c.rotate=a.rotate,f=!0);b.scalable&&(q(a.scaleX)&&a.scaleX!==c.scaleX&&(c.scaleX=a.scaleX,f=!0),q(a.scaleY)&&a.scaleY!==
c.scaleY&&(c.scaleY=a.scaleY,f=!0));f&&this.renderCanvas(!0,!0);b=c.width/c.naturalWidth;q(a.x)&&(e.left=a.x*b+d.left);q(a.y)&&(e.top=a.y*b+d.top);q(a.width)&&(e.width=a.width*b);q(a.height)&&(e.height=a.height*b);this.setCropBoxData(e)}return this},getContainerData:function(){return this.ready?T({},this.containerData):{}},getImageData:function(){return this.sized?T({},this.imageData):{}},getCanvasData:function(){var a=this.canvasData,b={};return this.ready&&g("left top width height naturalWidth naturalHeight".split(" "),
function(c){b[c]=a[c]}),b},setCanvasData:function(a){var b=this.canvasData,c=b.aspectRatio;return this.ready&&!this.disabled&&r(a)&&(q(a.left)&&(b.left=a.left),q(a.top)&&(b.top=a.top),q(a.width)?(b.width=a.width,b.height=a.width/c):q(a.height)&&(b.height=a.height,b.width=a.height*c),this.renderCanvas(!0)),this},getCropBoxData:function(){var a,b=this.cropBoxData;return this.ready&&this.cropped&&(a={left:b.left,top:b.top,width:b.width,height:b.height}),a||{}},setCropBoxData:function(a){var b,c,d=this.cropBoxData,
e=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&r(a)&&(q(a.left)&&(d.left=a.left),q(a.top)&&(d.top=a.top),q(a.width)&&a.width!==d.width&&(b=!0,d.width=a.width),q(a.height)&&a.height!==d.height&&(c=!0,d.height=a.height),e&&(b?d.height=d.width/e:c&&(d.width=d.height*e)),this.renderCropBox()),this},getCroppedCanvas:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var b,c,d,e,f,g,h,n,l,m,u,r,q,
x,t,v,z,E,C,w,A,B,D,G,H,y,M,L,J,Q,O,I,P,K,N,R,V,S,Y,U=this.canvasData,aa=(b=this.image,c=this.imageData,d=c.aspectRatio,e=c.naturalWidth,f=c.naturalHeight,g=c.rotate,h=void 0===g?0:g,n=c.scaleX,l=void 0===n?1:n,m=c.scaleY,u=void 0===m?1:m,r=U.aspectRatio,q=U.naturalWidth,x=U.naturalHeight,t=a.fillColor,v=void 0===t?"transparent":t,z=a.imageSmoothingEnabled,E=void 0===z||z,C=a.imageSmoothingQuality,w=void 0===C?"low":C,A=a.maxWidth,B=void 0===A?1/0:A,D=a.maxHeight,G=void 0===D?1/0:D,H=a.minWidth,y=
void 0===H?0:H,M=a.minHeight,L=void 0===M?0:M,J=document.createElement("canvas"),Q=J.getContext("2d"),O=F({aspectRatio:r,width:B,height:G}),I=F({aspectRatio:r,width:y,height:L},"cover"),P=Math.min(O.width,Math.max(I.width,q)),K=Math.min(O.height,Math.max(I.height,x)),N=F({aspectRatio:d,width:B,height:G}),R=F({aspectRatio:d,width:y,height:L},"cover"),V=Math.min(N.width,Math.max(R.width,e)),S=Math.min(N.height,Math.max(R.height,f)),Y=[-V/2,-S/2,V,S],J.width=p(P),J.height=p(K),Q.fillStyle=v,Q.fillRect(0,
0,P,K),Q.save(),Q.translate(P/2,K/2),Q.rotate(h*Math.PI/180),Q.scale(l,u),Q.imageSmoothingEnabled=E,Q.imageSmoothingQuality=w,Q.drawImage.apply(Q,[b].concat(k(Y.map(function(a){return Math.floor(p(a))})))),Q.restore(),J);if(!this.cropped)return aa;d=this.getData();e=d.x;c=d.y;b=d.width;d=d.height;U=aa.width/Math.floor(U.naturalWidth);1!==U&&(e*=U,c*=U,b*=U,d*=U);h=b/d;f=F({aspectRatio:h,width:a.maxWidth||1/0,height:a.maxHeight||1/0});g=F({aspectRatio:h,width:a.minWidth||0,height:a.minHeight||0},"cover");
h=F({aspectRatio:h,width:a.width||(1!==U?aa.width:b),height:a.height||(1!==U?aa.height:d)});U=h.width;h=h.height;U=Math.min(f.width,Math.max(g.width,U));h=Math.min(f.height,Math.max(g.height,h));f=document.createElement("canvas");g=f.getContext("2d");f.width=p(U);f.height=p(h);g.fillStyle=a.fillColor||"transparent";g.fillRect(0,0,U,h);h=a.imageSmoothingEnabled;a=a.imageSmoothingQuality;g.imageSmoothingEnabled=void 0===h||h;a&&(g.imageSmoothingQuality=a);var Z,T,W,X,ba,ca,a=aa.width;h=aa.height;e<=
-b||a<e?ba=W=Z=e=0:0>=e?(W=-e,e=0,ba=Z=Math.min(a,b+e)):e<=a&&(W=0,ba=Z=Math.min(b,a-e));0>=Z||c<=-d||h<c?ca=X=T=c=0:0>=c?(X=-c,c=0,ca=T=Math.min(h,d+c)):c<=h&&(X=0,ca=T=Math.min(d,h-c));Z=[e,c,Z,T];0<ba&&0<ca&&(T=U/b,Z.push(W*T,X*T,ba*T,ca*T));return g.drawImage.apply(g,[aa].concat(k(Z.map(function(a){return Math.floor(p(a))})))),f},setAspectRatio:function(a){var b=this.options;return this.disabled||void 0===a||(b.aspectRatio=Math.max(0,a)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),
this},setDragMode:function(a){var c=this.options,d=this.dragBox,e=this.face;if(this.ready&&!this.disabled){var f="crop"===a,g=c.movable&&"move"===a;a=f||g?a:"none";c.dragMode=a;u(d,I,a);b(d,J,f);b(d,R,g);c.cropBoxMovable||(u(e,I,a),b(e,J,f),b(e,R,g))}return this}}),M})},"xstyle/css":function(){define(["require"],function(t){function f(f,q,e){var k=document.documentElement;f=k.insertBefore(document.createElement(f),k.firstChild);f.id=q;q=(f.currentStyle||getComputedStyle(f,null)||{})[e];k.removeChild(f);
return q}return{load:function(k,q,e,r){function m(d){var c=f("x-parse",null,"content"),g=d&&(d.sheet||d.styleSheet);c&&"none"!=c&&"normal"!=c?q([eval(c)],function(b){d?b.process(d,e):(b.processAll(),e(g))}):e(g)}var l=q.toUrl(k),g;l.match(/!$/)&&(g={wait:!1},l=l.slice(0,-1));var p=q.cache&&q.cache["url:"+l];if(null!=p)p.xCss&&(p=p.cssText),"string"==typeof p?t(["./core/load-css"],function(d){m(d.insertCss(p))}):m();else{if("none"==f("div",k.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return m();
t(["./core/load-css"],function(d){d(l,m,g)})}}}})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorSelector jimu/utils".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c){return t([f,k],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:'\x3cdiv role\x3d"button" tabindex\x3d"0"data-dojo-attach-event\x3d"onclick:_domNodeClick,onkeydown:_domNodeKeydown" aria-pressed\x3d"false"\x3e\x3c/div\x3e',
_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");e.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){p.close(this.tooltipDialog);
this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(c){var b=this.tooltipDialog.domNode;return c===b||e.isDescendant(c,b)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){p.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0;this.picker.cursorNode.focus()},_hideTooltipDialog:function(){this._isTooltipDialogOpened=!1;this.onClose();p.close(this.tooltipDialog)},
_createTooltipDialog:function(){var c=e.create("div");this.tooltipDialog=new g({content:c});e.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");this.own(r(this.tooltipDialog.domNode,"keydown",q.hitch(this,function(a){a.keyCode===m.ESCAPE&&(this._hideTooltipDialog(),this.domNode.focus(),e.setAttr(this.domNode,"aria-pressed","false"))})));var b=new d({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:q.hitch(this,function(a){this.ensureMode||
(a=new l(a),this.setColor(a))})});b.placeAt(c);b.startup();if(this.ensureMode){var f=e.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},c);this.own(r(f,"click",q.hitch(this,function(){this._hideTooltipDialog()})));"undefined"===typeof this.showOk&&(f=e.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},c),this.own(r(f,"click",q.hitch(this,function(){var a=this.picker.get("value");this.setColor(new l(a));
this._hideTooltipDialog()}))));c=e.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},c);this.own(r(c,"click",q.hitch(this,function(){var a=this.picker.get("value");this.setColor(new l(a))})))}this.own(r(document.body,"click",q.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=b},_domNodeClick:function(c){c.stopPropagation();c.preventDefault();this._isTooltipDialogOpened?(this._hideTooltipDialog(),
e.setAttr(this.domNode,"aria-pressed","false")):(this._showTooltipDialog(),e.setAttr(this.domNode,"aria-pressed","true"))},_domNodeKeydown:function(c){c.keyCode!==m.ENTER&&c.keyCode!==m.SPACE||this._domNodeClick(c)},setColor:function(c,b){if(c instanceof l){var d=this.color,a="";d&&(a=d.toHex());d=c.toHex();this.color=c;e.setStyle(this.domNode,"backgroundColor",d);if(a!==d&&(this.picker.set("value",d),!1!==b))this.onChange(new l(d))}},getColor:function(){return this.color},_changeLabel:function(d){e.empty(this.domNode);
e.create("span",{innerHTML:d.toHex(),className:"color-label",style:{color:c.invertColor(d.toHex())}},this.domNode)},onChange:function(c){this.showLabel&&this._changeLabel(c)},onClose:function(){},getPopup:function(){return this.tooltipDialog||null},setLabel:function(c){e.empty(this.domNode);e.create("span",{innerHTML:c||"",className:"text-label"},this.domNode)},isTooltipDialogOpened:function(){return this._isTooltipDialogOpened}})})},"jimu/dijit/ColorSelector":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dojox/widget/ColorPicker dijit/_base/focus dojo/fx dojo/_base/lang dojo/_base/html dojo/sniff".split(" "),
function(t,f,k,q,e,r,m,l,g){return f([k,q,t],{baseClass:"jimu-color-selector",declaredClass:"jimu.dijit.ColorSelector",_setPoint:function(f){f&&e.focus(f.target);if(!this._CURSOR_WIDTH||!this._CURSOR_HEIGHT){var d=l.getMarginBox(this.cursorNode);d.w&&d.h&&(this._CURSOR_WIDTH=d.w/2,this._CURSOR_HEIGHT=d.h/2)}this._BORDER_WIDTH&&this._BORDER_HEIGHT||(d=l.getBorderExtents(f.target||f.srcElement),d.w&&d.h&&(this._BORDER_WIDTH=d.w,this._BORDER_HEIGHT=d.h));var c=d=0;g("ff")||g("ie")||g("MSIE")?(d=f.offsetX,
c=f.offsetY):f.offsetX&&f.offsetY&&(d=f.offsetX+this._BORDER_WIDTH,c=f.offsetY+this._BORDER_HEIGHT);f=c-this._CURSOR_HEIGHT;d-=this._CURSOR_WIDTH;this.animatePoint?r.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:d,onEnd:m.hitch(this,function(){this._updateColor(!0);e.focus(this.cursorNode)})}).play():(l.style(this.cursorNode,{left:d+"px",top:f+"px"}),this._updateColor(!0))},_setHuePoint:function(f){f=f.offsetY-this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?r.slideTo({node:this.hueCursorNode,
duration:this.slideDuration,top:f,left:0,onEnd:m.hitch(this,function(){this._updateColor(!0);e.focus(this.hueCursorNode)})}).play():(l.style(this.hueCursorNode,"top",f+"px"),this._updateColor(!0))}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A){t.experimental("dojox.widget.ColorPicker");return f("dojox.widget.ColorPicker",u,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:A,postMixInProperties:function(){d.contains(l.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=h.getUniqueId(this.id);k.mixin(this,z.getLocalization("dojox.widget","ColorPicker"));k.mixin(this,z.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>m("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new b.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new b.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(r.subscribe("/dnd/move/stop",k.hitch(this,"_clearTimer"))),this._subs.push(r.subscribe("/dnd/move/start",
k.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:c.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,k.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=x.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(b){if(b.node==this.cursorNode||b.node==this.hueCursorNode)a.focus(b.node),p.setSelectable(this.domNode,!1),this._timer=setInterval(k.hitch(this,"_updateColor"),45)},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),p.setSelectable(this.domNode,!0))},_setHue:function(a){e.style(this.colorUnderlay,"backgroundColor",x.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,b,d){if(-1!==a){a=e.style(this.hueCursorNode,"top");b=this.PICKER_HUE_SELECTOR_H/2;a+=b;var f=!1;d.charOrCode==c.UP_ARROW?0<a&&(--a,f=!0):d.charOrCode==c.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,f=!0);f&&e.style(this.hueCursorNode,"top",a-b+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
b,d){b=this.PICKER_SAT_SELECTOR_H/2;var f=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=e.style(this.cursorNode,"top");var g=e.style(this.cursorNode,"left");a+=b;var g=g+f,h=!1;d.charOrCode==c.UP_ARROW?0<a&&(--a,h=!0):d.charOrCode==c.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,h=!0):d.charOrCode==c.LEFT_ARROW?0<g&&(--g,h=!0):d.charOrCode==c.RIGHT_ARROW&&g<this.PICKER_SAT_VAL_W&&(g+=1,h=!0);h&&(g-=f,e.style(this.cursorNode,"top",a-b+"px"),e.style(this.cursorNode,"left",g+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2,b=e.style(this.hueCursorNode,"top")+b,c=e.style(this.cursorNode,"top")+c,d=e.style(this.cursorNode,"left")+d,b=Math.round(360-b/this.PICKER_HUE_H*360),d=x.fromHsv(b,d/this.PICKER_SAT_VAL_W*100,100-c/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(d);this._updateValue(d,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
x.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=x.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=x.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){a=a.toHex();this.value=this.valueNode.value=a;if(b&&(!this._timer||this.liveUpdate))this.onChange(a)},_updatePickerLocations:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;d=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-d;c=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-c;this.animatePoint?(n.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),n.slideTo({node:this.cursorNode,duration:this.slideDuration,top:c,left:d}).play()):(e.style(this.hueCursorNode,"top",b+"px"),
e.style(this.cursorNode,{left:d+"px",top:c+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(b){var c=
this.PICKER_HUE_SELECTOR_H/2;b=b.layerY||b.y-b.target.getBoundingClientRect().top;b-=c;this.animatePoint?n.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0,onEnd:k.hitch(this,function(){this._updateColor(!0);a.focus(this.hueCursorNode)})}).play():(e.style(this.hueCursorNode,"top",b+"px"),this._updateColor(!0))},_setPoint:function(b){var c=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2,f=b.layerY||b.y-b.target.getBoundingClientRect().top,f=f-c,c=b.layerX||b.x-
b.target.getBoundingClientRect().left,c=c-d;b&&a.focus(b.target);this.animatePoint?n.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:c,onEnd:k.hitch(this,function(){this._updateColor(!0);a.focus(this.cursorNode)})}).play():(e.style(this.cursorNode,{left:c+"px",top:f+"px"}),this._updateColor(!0))},_handleKey:function(a){},focus:function(){this.focused||a.focus(this.focusNode)},_stopDrag:function(a){g.stop(a)},destroy:function(){this.inherited(arguments);q.forEach(this._subs,function(a){r.unsubscribe(a)});
delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(t){return t})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(t,f,k,q){t=f.getObject("color",!0,t);t.Color=k;t.blend=k.blendColors;t.fromRgb=k.fromRgb;t.fromHex=k.fromHex;t.fromArray=k.fromArray;t.fromString=k.fromString;t.greyscale=q.makeGrey;f.mixin(t,{fromCmy:function(e,r,m){f.isArray(e)?(r=e[1],m=e[2],e=e[0]):f.isObject(e)&&(r=e.m,m=e.y,e=e.c);return new k({r:Math.round(255*
(1-e/100)),g:Math.round(255*(1-r/100)),b:Math.round(255*(1-m/100))})},fromCmyk:function(e,r,m,l){f.isArray(e)?(r=e[1],m=e[2],l=e[3],e=e[0]):f.isObject(e)&&(r=e.m,m=e.y,l=e.b,e=e.c);l/=100;return new k({r:Math.round(255*(1-Math.min(1,e/100*(1-l)+l))),g:Math.round(255*(1-Math.min(1,r/100*(1-l)+l))),b:Math.round(255*(1-Math.min(1,m/100*(1-l)+l)))})},fromHsl:function(e,r,m){f.isArray(e)?(r=e[1],m=e[2],e=e[0]):f.isObject(e)&&(r=e.s,m=e.l,e=e.h);r/=100;for(m/=100;0>e;)e+=360;for(;360<=e;)e-=360;var l,g;
120>e?(l=(120-e)/60,g=e/60,e=0):240>e?(l=0,g=(240-e)/60,e=(e-120)/60):(l=(e-240)/60,g=0,e=(360-e)/60);l=2*r*Math.min(l,1)+(1-r);g=2*r*Math.min(g,1)+(1-r);e=2*r*Math.min(e,1)+(1-r);.5>m?(l*=m,g*=m,e*=m):(l=(1-m)*l+2*m-1,g=(1-m)*g+2*m-1,e=(1-m)*e+2*m-1);return new k({r:Math.round(255*l),g:Math.round(255*g),b:Math.round(255*e)})}});t.fromHsv=function(e,r,m){f.isArray(e)?(r=e[1],m=e[2],e=e[0]):f.isObject(e)&&(r=e.s,m=e.v,e=e.h);360==e&&(e=0);r/=100;m/=100;var l,g,p;if(0==r)g=p=l=m;else{var d=e/60;e=Math.floor(d);
var c=d-e,d=m*(1-r),n=m*(1-r*c);r=m*(1-r*(1-c));switch(e){case 0:l=m;g=r;p=d;break;case 1:l=n;g=m;p=d;break;case 2:l=d;g=m;p=r;break;case 3:l=d;g=n;p=m;break;case 4:l=r;g=d;p=m;break;case 5:l=m,g=d,p=n}}return new k({r:Math.round(255*l),g:Math.round(255*g),b:Math.round(255*p)})};f.extend(k,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var e,f=this.r/255,k=this.g/255,l=this.b/255;e=Math.min(1-f,1-k,1-
l);return{c:Math.round((1-f-e)/(1-e)*100),m:Math.round((1-k-e)/(1-e)*100),y:Math.round((1-l-e)/(1-e)*100),b:Math.round(100*e)}},toHsl:function(){var e=this.r/255,f=this.g/255,k=this.b/255,l=Math.min(e,k,f),g=Math.max(e,f,k),p=g-l,d=0,c=0,l=(l+g)/2;0<l&&1>l&&(c=p/(.5>l?2*l:2-2*l));0<p&&(g==e&&g!=f&&(d+=(f-k)/p),g==f&&g!=k&&(d+=2+(k-e)/p),g==k&&g!=e&&(d+=4+(e-f)/p),d*=60);return{h:d,s:Math.round(100*c),l:Math.round(100*l)}},toHsv:function(){var e=this.r/255,f=this.g/255,k=this.b/255,l=Math.max(e,f,
k),g=l-Math.min(e,k,f),p=null,d=0==l?0:g/l;0==d?p=0:(p=e==l?60*(f-k)/g:f==l?120+60*(k-e)/g:240+60*(e-f)/g,0>p&&(p+=360));return{h:p,s:Math.round(100*d),v:Math.round(100*l)}}});return t})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(t,f,k,q){var e={};f.setObject("dojo.colors",e);var r=function(e,f,k){0>k&&++k;1<k&&--k;var d=6*k;return 1>d?e+(f-e)*d:1>2*k?f:2>3*k?e+(f-e)*(2/3-k)*6:e};t.colorFromRgb=k.fromRgb=function(e,f){var g=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);
if(g){e=g[2].split(/\s*,\s*/);var d=e.length,g=g[1];if("rgb"==g&&3==d||"rgba"==g&&4==d)return g=e[0],"%"==g.charAt(g.length-1)?(g=q.map(e,function(b){return 2.56*parseFloat(b)}),4==d&&(g[3]=e[3]),k.fromArray(g,f)):k.fromArray(e,f);if("hsl"==g&&3==d||"hsla"==g&&4==d){var g=(parseFloat(e[0])%360+360)%360/360,c=parseFloat(e[1])/100,n=parseFloat(e[2])/100,c=.5>=n?n*(c+1):n+c-n*c,n=2*n-c,g=[256*r(n,c,g+1/3),256*r(n,c,g),256*r(n,c,g-1/3),1];4==d&&(g[3]=e[3]);return k.fromArray(g,f)}}return null};var m=
function(e,f,k){e=Number(e);return isNaN(e)?k:e<f?f:e>k?k:e};k.prototype.sanitize=function(){this.r=Math.round(m(this.r,0,255));this.g=Math.round(m(this.g,0,255));this.b=Math.round(m(this.b,0,255));this.a=m(this.a,0,1);return this};e.makeGrey=k.makeGrey=function(e,f){return k.fromArray([e,e,e,f])};f.mixin(k.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,
226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,
150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],
hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,
136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],
navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,
87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return k})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dojo/_base/config dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule ./a11y/_Transparency".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){t=t([k,q,e,r],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:m,nls:null,_nls0:"0%",_nls50:"50%",_nls100:"100%",alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency;var b=f.locale||"",b=b.toLowerCase();"ar"===b?(this._nls0="\u066a0",this._nls50="\u066a50",this._nls100="\u066a100"):"tr"===b&&(this._nls0="%0",this._nls50="%50",this._nls100="%100")},postCreate:function(){this.inherited(arguments);"number"===
typeof this.alpha&&this.setAlpha(this.alpha);this.a11y_initAriaAttrs()},setAlpha:function(b){this.opacitySlider.set("value",Math.round(100-100*b))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var b=this.getAlpha();this.emit("change",b)}});t.extend(b);return t})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E){var C=f("dijit.form._SliderMover",d,{onMouseMove:function(a){var b=this.widget,c=b._abspos;c||(c=b._abspos=e.position(b.sliderBarContainer,!0),b._setPixelValue_=l.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(a){d.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,
!0)}});k=f("dijit.form.HorizontalSlider",[x,z],{templateString:E,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:h.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case m.HOME:this._setValueAttr(this.minimum,!1);break;case m.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?m.RIGHT_ARROW:m.LEFT_ARROW:case !1===this._descending?m.DOWN_ARROW:m.UP_ARROW:case !1===this._descending?m.PAGE_DOWN:m.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?m.LEFT_ARROW:m.RIGHT_ARROW:case !1===this._descending?m.UP_ARROW:m.DOWN_ARROW:case !1===this._descending?m.PAGE_UP:m.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(b){this.disabled||this.readOnly||(g("ie")||a.focus(this.sliderHandle),b.stopPropagation(),b.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(b){if(!this.disabled&&!this.readOnly&&
this.clickSelect){a.focus(this.sliderHandle);b.stopPropagation();b.preventDefault();var c=e.position(this.sliderBarContainer,!0),d=b[this._mousePixelCoord]-c[this._startingPixelCoord];this._setPixelValue(this._isReversed()?c[this._pixelCount]-d:d,c[this._pixelCount],!0);this._movable.onMouseDown(b)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
d.style[this._progressPixelSize]){var f=this,g={},h=parseFloat(d.style[this._progressPixelSize]),n=this.slideDuration*(c-h/100);0!=n&&(0>n&&(n=0-n),g[this._progressPixelSize]={start:h,end:100*c,units:"%"},this._inProgressAnim=q.animateProperty({node:d,duration:n,onAnimate:function(a){e.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:g}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=
100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var c=r.getComputedStyle(this.sliderBarContainer),d=e.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=d[this._pixelCount];c--;a=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>a&&(a=0);a>c&&(a=c);a=a*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==m.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==m.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(t.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var a=c('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(u.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),u.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(b(this.domNode,
n.wheel,l.hitch(this,"_mouseWheeled")));var a=f(C,{widget:this});this._movable=new p(this.sliderHandle,{mover:a});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});k._Mover=C;return k})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(t,f,k,q,e,r){t=t("dijit.form.HorizontalRuleLabels",
r,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(e){return e},_genHTML:function(e,f){f=
this.labels[f];return this._positionPrefix+this._calcPosition(e)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(f)+this._labelPrefix+f+this._suffix},_genDirectionHTML:function(e){return""},getLabels:function(){var e=this.labels;!e.length&&this.srcNodeRef&&(e=q("\x3e li",this.srcNodeRef).map(function(d){return String(d.innerHTML)}));if(!e.length&&1<this.count)for(var e=[],f=this.minimum,g=(this.maximum-f)/(this.count-1),p=0;p<this.count;p++)e.push(p<this.numericMargin||p>=this.count-this.numericMargin?
"":k.format(f,this.constraints)),f+=g;return e},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});f("dojo-bidi")&&t.extend({_setTextDirAttr:function(f){this.textDir!=f&&(this._set("textDir",f),q(".dijitRuleLabelContainer",this.domNode).forEach(e.hitch(this,function(e){e.style.direction=this.getTextDir(e.innerText||e.textContent||"")})))},_genDirectionHTML:function(e){return this.textDir?"direction:"+this.getTextDir(e)+";":""}});
return t})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(t,f,k){return t("dijit.form.HorizontalRule",[f,k],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(f){return this._positionPrefix+f+this._positionSuffix+
this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var f;if(1==this.count)f=this._genHTML(50,0);else{var e,k=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){f=this._genHTML(0,0);for(e=1;e<this.count-1;e++)f+=this._genHTML(k*e,e);f+=this._genHTML(100,this.count-1)}else{f=this._genHTML(100,0);for(e=1;e<this.count-1;e++)f+=this._genHTML(100-k*e,e);f+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=f}})})},"jimu/dijit/a11y/_Transparency":function(){define(["dojo/_base/html"],
function(t){return{a11y_initAriaAttrs:function(){var f=this["aria-labelledby"];f&&(t.removeAttr(this.domNode,"aria-labelledby"),t.setAttr(this.opacitySlider.focusNode,"aria-labelledby",f))}}})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(t,f,k,q){return t("dijit.form.NumberSpinner",[k,q.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(e,f){var k=this.constraints,l=isNaN(e),g=!isNaN(k.max),p=
!isNaN(k.min);l&&0!=f&&(e=0<f?p?k.min:g?k.max:0:g?this.constraints.max:p?k.min:0);f=e+f;if(l||isNaN(f))return e;g&&f>k.max&&(f=k.max);p&&f<k.min&&(f=k.min);return f},_onKeyDown:function(e){if(!(this.disabled||this.readOnly||e.keyCode!=f.HOME&&e.keyCode!=f.END||e.ctrlKey||e.altKey||e.metaKey||"undefined"==typeof this.get("value"))){var k=this.constraints[e.keyCode==f.HOME?"min":"max"];"number"==typeof k&&this._setValueAttr(k,!1);e.stopPropagation();e.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(t,f,k,q,e,r,m,l,g,p){return t("dijit.form._Spinner",l,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:g,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(d){return d},_arrowPressed:function(d,c,e){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),c*e),!1),p.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(d,c,e){var b=this.smallDelta;c==this.textbox&&(c=e.keyCode,b=c==f.PAGE_UP||c==f.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==f.UP_ARROW||c==f.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==d?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,b)},_wheelTimer:null,_mouseWheeled:function(d){if(this.focused){d.stopPropagation();d.preventDefault();var c=d.wheelDelta/120;Math.floor(c)!=c&&(c=0<d.wheelDelta?1:-1);d=d.detail?-1*d.detail:c;if(0!==d){var e=
this[0<d?"upArrowNode":"downArrowNode"];this._arrowPressed(e,d,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(e)},50)}}},_setConstraintsAttr:function(d){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(d,c){this.focusNode.setAttribute("aria-valuenow",d);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(r(this.domNode,e.wheel,k.hitch(this,"_mouseWheeled")),m.addListener(this.upArrowNode,this.textbox,{keyCode:f.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),m.addListener(this.downArrowNode,this.textbox,
{keyCode:f.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),m.addListener(this.upArrowNode,this.textbox,{keyCode:f.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),m.addListener(this.downArrowNode,this.textbox,{keyCode:f.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(t,f,k){return t("dijit.form.RangeBoundTextBox",k,{rangeMessage:"",rangeCheck:function(f,e){return("min"in e?0<=this.compare(f,e.min):!0)&&("max"in e?0>=this.compare(f,e.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var f=this.get("value");
if(null==f)return!1;var e=!1;"min"in this.constraints&&(e=this.constraints.min,e=0>this.compare(f,"number"==typeof e&&0<=e&&0!=f?0:e));!e&&"max"in this.constraints&&(e=this.constraints.max,e=0<this.compare(f,"number"!=typeof e||0<e?e:0));return e},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(f){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(f))},getErrorMessage:function(f){var e=
this.get("value");return null==e||""===e||"number"==typeof e&&isNaN(e)||this.isInRange(f)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=f.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(t,f,k,q,e,r){var m=
function(e){e=e||{};var f=k.getLocalization("dojo.cldr","number",k.normalizeLocale(e.locale)),d=e.pattern?e.pattern:f[(e.type||"decimal")+"Format"];e="number"==typeof e.places?e.places:"string"===typeof e.places&&0<e.places.length?e.places.replace(/.*,/,""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:f.decimal,places:e}},l=t("dijit.form.NumberTextBoxMixin",null,{pattern:function(e){return"("+(this.focused&&this.editOptions?this._regExpGenerator(f.delegate(e,this.editOptions))+
"|":"")+this._regExpGenerator(e)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:e.format,_regExpGenerator:e.regexp,_decimalInfo:m(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(e){var f="number"==typeof e.places?e.places:0;f&&f++;"number"!=typeof e.max&&(e.max=9*Math.pow(10,15-f));"number"!=typeof e.min&&(e.min=-9*Math.pow(10,15-f));this.inherited(arguments,[e]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&
this.set("value",this.value);this._decimalInfo=m(e)},_onFocus:function(e){if(!this.disabled&&!this.readOnly){var f=this.get("value");"number"!=typeof f||isNaN(f)||(f=this.format(f,this.constraints),void 0!==f&&(this.textbox.value=f,"mouse"!==e&&this.textbox.select()));this.inherited(arguments)}},format:function(e,l){var d=String(e);if("number"!=typeof e)return d;if(isNaN(e))return"";if(!("rangeCheck"in this&&this.rangeCheck(e,l))&&!1!==l.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&
this.focused&&(l=f.mixin({},l,this.editOptions));return this._formatter(e,l)},_parser:e.parse,parse:function(e,l){var d=f.mixin({},l,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=d.places){var c=d.places,c="number"===typeof c?c:Number(c.split(",").pop());d.places="0,"+c}d=this._parser(e,d);this.editOptions&&this.focused&&isNaN(d)&&(d=this._parser(e,l));return d},_getDisplayedValueAttr:function(){var e=this.inherited(arguments);return isNaN(e)?this.textbox.value:e},filter:function(f){if(null==
f||"string"==typeof f&&""==f)return NaN;"number"!=typeof f||isNaN(f)||0==f||(f=e.round(f,this._decimalInfo.places));return this.inherited(arguments,[f])},serialize:function(e,f){return"number"!=typeof e||isNaN(e)?"":this.inherited(arguments)},_setBlurValue:function(){var e=f.hitch(f.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(e,!0)},_setValueAttr:function(e,f,d){if(void 0!==e&&void 0===d)if(d=String(e),"number"==typeof e)if(isNaN(e))d="";else{if("rangeCheck"in this&&this.rangeCheck(e,
this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else e?e=void 0:(d="",e=NaN);this.inherited(arguments,[e,f,d])},_getValueAttr:function(){var g=this.inherited(arguments);if(isNaN(g)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+e._realNumberRegexp(f.delegate(this.constraints))+"$")).test(this.textbox.value))return g=Number(this.textbox.value),isNaN(g)?void 0:g}else return g},isValid:function(e){if(!this.focused||
this._isEmpty(this.textbox.value))return this.inherited(arguments);var f=this.get("value");return!isNaN(f)&&this.rangeCheck(f,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var e="number"==typeof this.constraints.min,f="number"==typeof this.constraints.max,d=this.get("value");if(isNaN(d)||!e&&!f)return this.inherited(arguments);var c=d|0,n=0>d,b=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
h=(this.maxLength||20)-this.textbox.value.length,a=b?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",c=b?c+"."+a:c+"",h=q.rep("9",h),b=d;n?b=Number(c+h):d=Number(c+h);return!(e&&d<this.constraints.min||f&&b>this.constraints.max)}});t=t("dijit.form.NumberTextBox",[r,l],{baseClass:"dijitTextBox dijitNumberTextBox"});t.Mixin=l;return t})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(t,f,k,q,e,r,m,l){return t([l],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=f.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=f.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=f.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);f.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(q(this,"Change",k.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(e,f){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof e&&(this._fetchHandle=r.after(this,"onFetch",e),this.own(this._fetchHandle));"function"===typeof f&&(this._fetchErrHandle=r.after(this,"onFetchError",f),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(e){return e},onFetchError:function(e){},getStatus:function(){return this._status},_onServiceUrlChange:function(f){var g=new e;g.then(k.hitch(this,function(){this._valid()}),k.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();f?m({url:k.trim(f||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(k.hitch(this,function(d){this.onFetch({url:this.getValue(),data:d})?g.resolve("success"):g.reject("error")}),k.hitch(this,function(d){g.reject(d)})):g.reject("error")},_validating:function(){this._status="validating";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox dijit/form/Select".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n){return t([f,k,q],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,singleClickEdit:!1,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(d.bindClickAndDblclickEvents(this.tableInBodySection,e.hitch(this,function(a){if(a=d.getAncestorDom(a.target||a.srcElement,function(a){return r.hasClass(a,"simple-table-row")&&r.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),e.hitch(this,function(a){if(a=d.getAncestorDom(a.target||a.srcElement,function(a){return r.hasClass(a,"simple-table-row")&&r.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var b=Math.random().toString();this._name="jimu_table_"+b.slice(2,b.length);if(this.fields&&0<this.fields.length){var f=r.create("tr",{},this.thead);m.forEach(this.fields,e.hitch(this,function(a){var b="auto";"actions"===a.type&&(a.name="actions");a.hidden?b=1:void 0!==a.width&&null!==a.width?b=a.width:"actions"!==a.type||a.name||(a.width=this._calculateActionsWidth(a)+20,b=a.width);r.create("col",{width:b},this.headColgroup);
r.create("col",{width:b},this.bodyColgroup);b=r.create("th",{innerHTML:a.title,title:a.title},f);if("checkbox"===a.type){b.innerHTML="";var d=new c({label:a.title});this.own(l(d.domNode,"click",e.hitch(this,function(){d.getValue()?this._checkAllTdCheckBoxes(a.name):this._uncheckAllTdCheckBoxes(a.name)})));d.placeAt(b)}r.addClass(b,"simple-table-field");a.hidden&&r.addClass(b,"hidden-column");a["class"]&&r.addClass(b,a["class"]);r.addClass(b,a.name)}))}else this.fields=null},_getThCheckBox:function(b){var c=
null;b=g(".simple-table-field."+b+" .jimu-checkbox",this.thead)[0];return c=p.byNode(b)},_getAllEnabledTdCheckBoxes:function(b){b=g(".simple-table-cell."+b+" .jimu-checkbox",this.tbody);b=m.map(b,function(b){return p.byNode(b)});return b=m.filter(b,function(b){return b.getStatus()})},_checkAllTdCheckBoxes:function(b){b=this._getAllEnabledTdCheckBoxes(b);m.forEach(b,function(b){b.getValue()||b.setValue(!0)})},_uncheckAllTdCheckBoxes:function(b){b=this._getAllEnabledTdCheckBoxes(b);m.forEach(b,function(b){b.getValue()&&
b.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(b){setTimeout(e.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(b)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(b){var c=this._getAllEnabledTdCheckBoxes(b),c=m.filter(c,e.hitch(this,function(a){return a.getStatus()}));0!==c.length&&(b=this._getThCheckBox(b),m.every(c,function(a){return a.getValue()})?b.getValue()||b.setValue(!0):b.getValue()&&b.setValue(!1))},clear:function(){var b=this._getNotEmptyRows(),
c=m.map(b,e.hitch(this,function(a){return this.getRowData(a)}));r.empty(this.tbody);m.forEach(b,e.hitch(this,function(a,b){this._onDeleteRow(a,c[b])}));this.updateUI();this._rowIndex=0;this._onClearRows(b)},addRows:function(b){var c=[];this.fields&&b&&0<b.length&&m.forEach(b,e.hitch(this,function(a){c.push(this.addRow(a,-1,!0))}));this.updateUI();return c},addRow:function(b,c,a){this._rowIndex++;var d={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==
typeof b)return d;var f=m.filter(this.fields,e.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=m.filter(f,e.hitch(this,function(a){return 0<this.getRowDataArrayByFieldValue(a.name,b[a.name]).length}));if(0<f.length)return d.errorCode=this.REPEATING_ERROR,d.errorMessage="repeating data",d.repeatFields=f,d;var g=r.create("tr",{"class":"simple-table-row not-empty"},this.tbody);r.setAttr(g,"rowId","row"+this._rowIndex);m.forEach(this.fields,e.hitch(this,function(a){var c=b[a.name],d=
a.type,e=null;"actions"===d?e=this._createActionsTd(g,a):("text"===d?e=this._createTextTd(g,a,c):"radio"===d?e=this._createRadioTd(g,a,c):"checkbox"===d?e=this._createCheckboxTd(g,a,c):"empty"===d?e=this._createEmptyTd(g,a):"extension"===d?e=this._createExtensionTd(g,a,c):"dropdown"===d&&(e=this._createDropdownTd(g,a,c)),a.hidden&&r.addClass(e,"hidden-column"))}));a||(this.updateUI(),a=this.getRows(),"number"===typeof c&&0<=c&&c<a.length&&r.place(g,a[c],"before"));d.success=!0;d.tr=g;d.errorMessage=
null;this._onAddRow(g);return d},deleteRow:function(b){if(b){var c=this.getRowData(b);r.destroy(b);this.updateUI();this._onDeleteRow(b,c)}},selectRow:function(b){this.selectable&&(g(".simple-table-row",this.tbody).removeClass("jimu-state-active"),r.addClass(b,"jimu-state-active"),this._onSelectRow(b))},updateUI:function(){this._updateRowClassName();this._updateHeight();r.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
r.addClass(this.domNode,this._classVerticalScroll);m.forEach(this.fields,e.hitch(this,function(b){"checkbox"===b.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(b.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var b=r.getContentBox(this.tableInBodySection).w,c="100%";"number"===typeof b&&0<b&&(c=b+"px");r.setStyle(this.tableInHeadSection,"width",c)}},_updateHeight:function(){var b=this.getRows();this.autoHeight&&r.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<b.length?b.length:1)+1+"px");b&&0<b.length&&this.bodyTableDiv&&(b=r.getMarginSize(b[0]))&&b.h&&r.setStyle(this.bodyTableDiv,"backgroundSize","1px "+b.h+"px")},_updateRowClassName:function(){var b=g("."+this._classFirstSimpleTableRow,this.tbody)[0];b&&(b=g("."+this._classRowUpDiv,b)[0])&&r.removeClass(b,this._classJimuStateDisabled);(b=g("."+this._classLastSimpleTableRow,this.tbody)[0])&&(b=g("."+this._classRowDownDiv,b)[0])&&r.removeClass(b,this._classJimuStateDisabled);b=g("."+this._classSimpleTableRow,
this.tbody);b.removeClass("odd");b.removeClass("even");b.removeClass(this._classFirstSimpleTableRow);b.removeClass(this._classLastSimpleTableRow);m.forEach(b,e.hitch(this,function(a,b){0===b%2?r.addClass(a,"odd"):r.addClass(a,"even")}));if(0<b.length){var c=b[0];r.addClass(c,this._classFirstSimpleTableRow);(c=g("."+this._classRowUpDiv,c)[0])&&r.addClass(c,this._classJimuStateDisabled);b=b[b.length-1];r.addClass(b,this._classLastSimpleTableRow);(b=g("."+this._classRowDownDiv,b)[0])&&r.addClass(b,this._classJimuStateDisabled)}},
_createTextTd:function(b,c,a){var d=null;return d=c.editable?this._createEditableTextTd(b,c,a):this._createNormalTextTd(b,c,a)},_createNormalTextTd:function(b,c,a){var d=r.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');r.addClass(d,c.name);var e=g("div",d)[0];e.innerHTML=a||"";e.title=a||"";c["class"]&&r.addClass(d,c["class"]);r.place(d,b);return d},_createEditableTextTd:function(b,c,a){var d=r.toDom('\x3ctd class\x3d"editable-text-td '+
c.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');r.addClass(d,"simple-table-cell");r.place(d,b);c["class"]&&r.addClass(d,c["class"]);var f=g("div",d)[0],h=g("input",d)[0];f.innerHTML=a||"";""!==f.innerHTML&&(f.title=f.innerText||f.innerHTML);h.value=f.innerHTML;this.own(l(f,this.singleClickEdit?"click":"dblclick",e.hitch(this,function(a){this.singleClickEdit||a.stopPropagation();h.value=f.innerText||
f.innerHTML;r.setStyle(f,"display","none");r.setStyle(h,"display","inline");h.focus();h.select&&h.select()})));this.own(l(h,"blur",e.hitch(this,function(){h.value=e.trim(h.value);var a=f.innerText||f.innerHTML,d=h.value;""!==d?c.unique?0<this.getRowDataArrayByFieldValue(c.name,d,b).length?h.value=a:f.innerHTML=d:f.innerHTML=d:h.value=a;r.setStyle(h,"display","none");r.setStyle(f,"display","block")})));return d},_createRadioTd:function(b,c,a){var d=r.toDom('\x3ctd class\x3d"radio-td '+c.name+'"\x3e\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" /\x3e\x3c/td\x3e');
r.addClass(d,"simple-table-cell");r.place(d,b);c["class"]&&r.addClass(d,c["class"]);b=g("input",d)[0];b.name=c.radio&&"row"===c.radio?this._name+this._rowIndex:this._name+c.name;b.checked=!0===a;return d},_createCheckboxTd:function(b,d,a){var f=r.toDom('\x3ctd class\x3d"checkbox-td '+d.name+'"\x3e\x3c/td\x3e');r.addClass(f,"simple-table-cell");r.place(f,b);d["class"]&&r.addClass(f,d["class"]);var g=new c({onChange:e.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(d.name);
"function"===typeof d.onChange&&setTimeout(e.hitch(this,function(){d.onChange(b,g)}),200)})});this.own(l(g,"status-change",e.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(d.name)})));this._setValueForCheckBox(g,a);g.placeAt(f);return f},_createActionsTd:function(b,c){var a=r.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');r.addClass(a,"simple-table-cell");var d=g(".action-item-parent",a)[0];r.place(a,
b);c["class"]&&r.addClass(a,c["class"]);m.forEach(c.actions,e.hitch(this,function(a){"up"===a?(a=r.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},d),a.title=this.nls.moveUp,this.own(l(a,"click",e.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowUp(b)){a=g(".simple-table-row",this.tbody);var c=m.indexOf(a,b);0<c&&(a=a[c-1])&&(r.place(b,a,"before"),this.updateUI(),this.emit("row-up",b))}})))):"down"===a?(a=r.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},
d),a.title=this.nls.moveDown,this.own(l(a,"click",e.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowDown(b)){a=g(".simple-table-row",this.tbody);var c=m.indexOf(a,b);c<a.length-1&&(a=a[c+1])&&(r.place(b,a,"after"),this.updateUI(),this.emit("row-down",b))}})))):"edit"===a?(a=r.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},d),a.title=this.nls.edit,this.own(l(a,"click",e.hitch(this,function(a){a.stopPropagation();this.onBeforeRowEdit(b)&&
this._onActionsEdit(b)})))):"delete"===a&&(a=r.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},d),a.title=this.nls.deleteRow,this.own(l(a,"click",e.hitch(this,function(a){a.stopPropagation();this.onBeforeRowDelete(b)&&this.deleteRow(b)}))))}));c=this._calculateActionsWidth(c)+"px";r.setStyle(d,"width",c);return a},_calculateActionsWidth:function(b){return 20*m.map(b.actions,function(b){return"up"===b||"down"===b||"edit"===b||"delete"===b}).length},
_createEmptyTd:function(b,c){b=r.create("td",{"class":c.name},b);r.addClass(b,"simple-table-cell");r.addClass(b,"empty-text-td");c["class"]&&r.addClass(b,c["class"]);return b},_createExtensionTd:function(b,c,a){b=r.create("td",{"class":c.name},b);r.addClass(b,"simple-table-cell");r.addClass(b,"extension-td");c["class"]&&r.addClass(b,c["class"]);c.create&&"function"===typeof c.create&&c.create(b);c.setValue&&"function"===typeof c.setValue&&c.setValue(b,a);return b},_createDropdownTd:function(b,c,a){b=
r.create("td",{"class":c.name},b);r.addClass(b,"simple-table-cell");r.addClass(b,"dropdown-td");c["class"]&&r.addClass(b,c["class"]);(new n({options:a})).placeAt(b);return b},editRow:function(b,c){var a={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof c||!r.isDescendant(b,this.tbody))return a;var d=e.mixin([],this.fields),d=m.filter(d,e.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),d=m.filter(d,e.hitch(this,function(a){return 0<
this.getRowDataArrayByFieldValue(a.name,c[a.name],b).length}));if(0<d.length)return a.errorCode=this.REPEATING_ERROR,a.errorMessage="repeating data",a.repeatFields=d,a;var f=g(".simple-table-cell",b);m.forEach(this.fields,e.hitch(this,function(a,b){if(c.hasOwnProperty(a.name)){b=f[b];var d=c[a.name],e=a.type;"text"===e?a.editable?this._editEditableText(b,a,d):this._editNormalText(b,a,d):"radio"===e?this._editRadio(b,a,d):"checkbox"===e?this._editCheckbox(b,a,d):"extension"===e?this._editExtension(b,
a,d):"dropdown"===e&&this._editDropdown(b,a,d)}}));a.success=!0;a.tr=b;a.errorMessage=null;this._onEditRow(b);return a},_editNormalText:function(b,c,a){b=g("div",b)[0];b.innerHTML=a||"";b.title=b.innerHTML},_editEditableText:function(b,c,a){c=g("div",b)[0];c.innerHTML=a||"";g("input",b)[0].value=c.innerHTML},_editRadio:function(b,c,a){g("input",b)[0].checked=!0===a},_editCheckbox:function(b,c,a){b=g(".jimu-checkbox",b)[0];b=p.byNode(b);this._setValueForCheckBox(b,a)},_setValueForCheckBox:function(b,
c){null===c?b.setStatus(!1):(b.setStatus(!0),c!==b.getValue()&&b.setValue(c))},_editExtension:function(b,c,a){c.setValue&&"function"===typeof c.setValue&&c.setValue(b,a)},_editDropdown:function(b,c,a){b=g(".dijitSelect",b)[0];p.byNode(b).set("value",a)},_getAllRows:function(){return g(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var b=this._getAllRows();return m.filter(b,e.hitch(this,function(b){return!r.hasClass(b,"empty")}))},_getEmptyRows:function(){var b=this._getAllRows();return m.filter(b,
e.hitch(this,function(b){return r.hasClass(b,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var b=null,c=g(".simple-table-row",this.tbody),c=m.filter(c,e.hitch(this,function(a){return!r.hasClass(a,"empty")&&r.hasClass(a,"jimu-state-active")}));0<c.length&&(b=c[0]);return b},getSelectedRowData:function(){var b=null,c=this.getSelectedRow();c&&(b=this._getRowDataByTr(c));return b},getData:function(b){var c=this._getNotEmptyRows();b&&(c=m.filter(c,e.hitch(this,
function(a){return a!==b})));return m.map(c,e.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(b){return this._getRowDataByTr(b)},_getRowDataByTr:function(b){var c=null;if(b)c={};else return null;m.forEach(this.fields,e.hitch(this,function(a){var d=a.type;if("actions"!==d){var e=a.name;c[e]=null;var f=g(".simple-table-cell."+e,b)[0];f&&("text"===d?(a=g("div",f)[0],c[e]=a.innerText||a.innerHTML):"radio"===d?(a=g("input",f)[0],c[e]=a.checked):"checkbox"===d?(a=g(".jimu-checkbox",
f)[0],a=p.byNode(a),a.getStatus()?c[e]=a.getValue():c[e]=null):"extension"===d?a.getValue&&"function"===typeof a.getValue&&(c[e]=a.getValue(f,a)):"dropdown"===d&&(a=g(".dijitSelect",f)[0],a=p.byNode(a),c[e]=a.get("value")))}}));return c},getRowDataArrayByFieldValue:function(b,c,a){var d=[];if(!this.fields||!m.some(this.fields,e.hitch(this,function(a){return a.name===b})))return[];a=this.getData(a);return d=m.filter(a,e.hitch(this,function(a){return a[b]==c}))},moveToTop:function(b){b&&b.parentNode===
this.tbody&&r.place(b,this.tbody,"first")},_onClickRow:function(b){this.emit("row-click",b)},_onDblClickRow:function(b){this.emit("row-dblclick",b)},_onSelectRow:function(b){this.emit("row-select",b)},_onAddRow:function(b){this.emit("row-add",b)},_onEditRow:function(b){this.emit("row-edit",b)},_onDeleteRow:function(b,c){this.emit("row-delete",b,c)},_onEnterRow:function(b){this.emit("row-enter",b)},_onClearRows:function(b){this.emit("rows-clear",b)},_onActionsEdit:function(b){this.emit("actions-edit",
b)},onBeforeRowUp:function(b){return!0},onBeforeRowDown:function(b){return!0},onBeforeRowEdit:function(b){return!0},onBeforeRowDelete:function(b){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(t,f,k,q,e,r,m,l,g,p,d){return t([l,g,m],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new p(null,this.containerNode);this.own(e(this.containerNode,"keydown",f.hitch(this,function(c){c.keyCode===r.ESCAPE&&(c.stopPropagation(),this._currentCtrlNode.focus())})));var c=1/this.tabs.length*100;this.isNested&&q.addClass(this.domNode,"nested");k.forEach(this.tabs,function(d){this._createTab(d,c)},this);this.own(e(this.controlNode,"keydown",f.hitch(this,function(c){var b=c.target,d;
c.keyCode===r.RIGHT_ARROW?d=b.nextElementSibling?b.nextElementSibling:this.controlNodes[0]:c.keyCode===r.LEFT_ARROW?d=b.previousElementSibling?b.previousElementSibling:this.controlNodes[this.controlNodes.length-1]:c.keyCode===r.HOME?d=this.controlNodes[0]:c.keyCode===r.END&&(d=this.controlNodes[this.controlNodes.length-1]);d&&(b=d,d.focus())})))}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);d.setVerticalCenter(this.domNode)},
_createTab:function(c,d){d=q.create("div",{innerHTML:c.title,"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":d+"%"},label:c.title},this.controlNode);this.viewStack.viewType=c.content.domNode?"dijit":"dom";c.content.label=c.title;this.viewStack.addView(c.content);this.own(e(d,"click",f.hitch(this,function(b){this.onSelect(c.title,b)})));this.own(e(d,"keydown",f.hitch(this,function(b){if(b.keyCode===r.ENTER||b.keyCode===r.SPACE)this.onSelect(c.title,b)})));d.label=c.title;this.controlNodes.push(d)},
onSelect:function(c,d){q.hasClass(d.target,"jimu-state-selected")||this.selectTab(c,d)},selectTab:function(c){this._selectControl(c);this.viewStack.switchView(c);this.emit("tabChanged",c)},_selectControl:function(c){k.forEach(this.controlNodes,function(d){q.removeClass(d,"jimu-state-selected");q.setAttr(d,"tabindex","-1");d.label===c&&(this._currentCtrlNode=d,q.addClass(d,"jimu-state-selected"),q.setAttr(d,"tabindex","0"))},this)}})})},"jimu/dijit/ViewStack":function(){define("dojo/_base/declare dojo/_base/fx dojo/_base/lang dojo/_base/html dojo/_base/array dijit/_WidgetBase".split(" "),
function(t,f,k,q,e,r){return t(r,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);e.forEach(this.views,k.hitch(this,function(e){1===e.nodeType?(q.place(e,this.domNode),q.addClass(e,"view"),q.setStyle(e,"display","none")):e.domNode&&(q.place(e.domNode,this.domNode),q.addClass(e.domNode,"view"),q.setStyle(e.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&
this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var e="",f=this.getSelectedView();f&&(e=f.label);return e},getViewByLabel:function(e){for(var f=0;f<this.views.length;f++)if(e===this.views[f].label)return this.views[f];return null},addView:function(e){this.views.push(e);1===e.nodeType?(q.place(e,this.domNode),q.addClass(e,"view")):e.domNode&&(q.place(e.domNode,this.domNode),q.addClass(e.domNode,"view"))},removeView:function(f){var l=this.views.length;
this.views=e.filter(this.views,function(e){return f!==e});l!==this.views.length&&(1===f.nodeType?q.destroy(f):f.domNode&&f.destroyRecursive())},switchView:function(e){var l,g;l="number"===typeof e?this.views[e]:"string"===typeof e?this.getViewByLabel(e):e;this.views.forEach(k.hitch(this,function(e){if(e)if(1===e.nodeType?g=e:e.domNode&&(g=e.domNode),e===l){if(q.setStyle(g,"display","block"),f.fadeIn({node:g}).play(),e.domNode)if(!e._started)e.startup(),e._started=!0;else if("function"===typeof e.onShown)e.onShown()}else if(q.setStyle(g,
"display","none"),f.fadeOut({node:g}).play(),e.domNode&&"function"===typeof e.onHidden)e.onHidden()}));this._currentView=l;this.onViewSwitch(l)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c){return t([g,p,m],{templateString:d,
baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,selected:"",tabs:null,average:!0,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(c){k.forEach(this.tabItems,f.hitch(this,function(b,d){q.removeClass(b,"jimu-state-active");q.setAttr(b,"tabindex","-1");b.label===c&&(q.addClass(b,"jimu-state-active"),q.setAttr(b,"tabindex","0"),this._currentIndex=
d)}));this.viewStack.switchView(c);this.emit("tabChanged",c)},addTab:function(c){if(!this.average){var b=l("td:last-child",this.tabTr);0<b.length&&q.destroy(b[0])}0<k.filter(this.tabs,function(b){return b.title===c.title}).length?console.error("tab title conflict: "+c.title):(this.tabs.push(c),this._createTab(c),this.average||this._addEmptyTab())},_addEmptyTab:function(){var c=q.toDom('\x3ctd nowrap class\x3d"tab-item-td tab-item-td-empty" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
q.place(c,this.tabTr)},removeTab:function(c){var b=-1;if(k.some(this.tabs,function(a,d){if(a.title===c)return b=d,!0})){var d=this.tabs.splice(b,1)[0];k.some(this.tabItems,function(a,b){if(a.label===c)return this.tabItems.splice(b,1),q.destroy(a),!0},this);this.viewStack.removeView(d.content)}},showShelter:function(){q.setStyle(this.shelter,"display","block")},hideShelter:function(){q.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new c(null,this.containerNode);this.own(e(this.containerNode,"keydown",f.hitch(this,function(c){c.keyCode===r.ESCAPE&&(c.stopPropagation(),this.tabItems[this._currentIndex].focus())})));this.tabItems=[];k.forEach(this.tabs,function(c){this._createTab(c)},this);this.own(e(this.tabTr,"keydown",f.hitch(this,function(c){var b=c.target,d;c.keyCode===r.RIGHT_ARROW?d=b.nextElementSibling?!this.average&&q.hasClass(b.nextElementSibling,"tab-item-td-empty")?this.tabItems[0]:
b.nextElementSibling:this.tabItems[0]:c.keyCode===r.LEFT_ARROW?d=b.previousElementSibling?b.previousElementSibling:this.tabItems[this.tabItems.length-1]:c.keyCode===r.HOME?d=this.tabItems[0]:c.keyCode===r.END&&(d=this.tabItems[this.tabItems.length-1]);d&&(b=d,d.focus())})));this.average?(this.controlTable.style.tableLayout="fixed",q.addClass(this.domNode,"average")):this._addEmptyTab()},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(c){var b=q.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
b.label=c.title||"";b.title=c.title;q.place(b,this.tabTr);var d=l(".tab-item-div",b)[0];d.innerHTML=b.label;d.label=b.label;c.content.label=b.label;this.viewStack.addView(c.content);this.own(e(b,"click",f.hitch(this,function(a){this._onSelect(c.title,a)})));this.own(e(b,"keydown",f.hitch(this,function(a){a.keyCode!==r.ENTER&&a.keyCode!==r.SPACE||this._onSelect(c.title,a)})));this.tabItems.push(b)},_onSelect:function(c,b){q.hasClass(b.target,"jimu-state-active")||this.selectTab(c)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(t,f,k,q){return t([q],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(f.hitch(this,function(e){this._placeItem(e)}));this.resize()},_placeItem:function(e){e.domNode?k.place(e.domNode,this.domNode):k.place(e,this.domNode)},addItem:function(e){this.items.push(e);this._placeItem(e);
this.resize()},addItems:function(e){this.items=this.items.concat(e);this.items.forEach(f.hitch(this,function(e){this._placeItem(e)}));this.resize()},removeItem:function(e){var f;for(f=0;f<this.items.length;f++)if(this.items[f].label===e){this.items[f].domNode?this.items[f].destroy():k.destroy(this.items[f]);this.items.splice(f,1);this.resize();break}},empty:function(){var e;for(e=0;e<this.items.length;e++)this.items[e].domNode?this.items[e].destroy():k.destroy(this.items[e]);this.items=[]},resize:function(){var e,
r,m;e=k.getMarginBox(this.domNode);r=this.getItemSize(e);m=Math.floor((e.w+this.hmargin)/(r.width+this.hmargin));this.items.forEach(f.hitch(this,function(e,f){this.setItemPosition(e,f,r,m)}))},getItemSize:function(e){var f={},k;if("fixWidth"===this.strategy)f.width=this.itemSize.width,f.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(k=0;k<this.itemSize.length;k++){if(e.w<=this.itemSize[k].screenWidth){f.width=this.itemSize[k].width;f.height=this.itemSize[k].height;break}}else"fixCols"===
this.strategy&&(f.width=(e.w-this.hmargin*(this.maxCols-1))/this.maxCols,f.height="number"===typeof this.itemSize.height?this.itemSize.height:f.width*parseFloat(this.itemSize.height.substring(0,this.itemSize.height.length-1))/100);return f},setItemPosition:function(e,f,m,l){f++;var g=f%l;f=Math.ceil(f/l);0===g&&(g=l);l={position:"absolute",top:(this.vmargin+m.height)*(f-1)+"px"};l[window.isRTL?"right":"left"]=(this.hmargin+m.width)*(g-1)+"px";0<=m.width&&(l.width=m.width+"px");0<=m.height&&(l.height=
m.height+"px");k.setStyle(e.domNode?e.domNode:e,l)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u){var v={};return t([f,k,q,
c],{templateString:e,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);var a={};this.drawLayerId&&(a.id=this.drawLayerId);
this.drawLayer=new b(a);this._initDefaultSymbols();this._initTypes();a=d(".draw-item",this.domNode);a.forEach(function(a){m.setAttr(a,"role","button");m.setAttr(a,"tabindex","0")});this.own(a.on(p,r.hitch(this,this._onItemClick)));m.setAttr(this.btnClear,"role","button");m.setAttr(this.btnClear,"tabindex","0");this.own(g(this.btnClear,p,r.hitch(this,this._onClickClear)));this.own(g(document.body,"keydown",r.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=
!!a.metaKey})));this.own(g(document.body,"keyup",r.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);m.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable();v[this.id]=this},enable:function(){this._isDisabled=!1;m.addClass(this.domNode,"enabled");m.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;m.addClass(this.domNode,"disabled");m.removeClass(this.domNode,
"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=d(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&
this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;delete v[this.id];this.inherited(arguments)},setMap:function(a){a&&(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new h(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(g(this.drawToolBar,"draw-end",r.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;
this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();d(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),
this.emit("draw-deactivate"))},activate:function(a){var b=null,c=d(".draw-item",this.domNode);"TEXT"===a?(a="POINT",b=this.textIcon):(c=c.filter(function(b){return b.getAttribute("data-geotype")===a}),0<c.length&&(b=c[0]));b&&this._activate(b)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c,d,e,f){this.emit("draw-end",a,b,c,d,e,f)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},
removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){m.removeClass(this.domNode,"hidden")},hide:function(){m.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return d(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var b={style:"esriSMSCircle",color:[0,
0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},c={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},d={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=a.fromJson(b));this.polylineSymbol||(this.polylineSymbol=a.fromJson(c));this.polygonSymbol||(this.polygonSymbol=a.fromJson(d))},_initTypes:function(){this.geoTypes&&
0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=
this.geoTypes.concat(["TEXT"])));var a=d(".draw-item",this.domNode);a.style("display","none");l.forEach(a,r.hitch(this,function(a){var b=a.getAttribute("data-geotype"),b=0<=l.indexOf(this.geoTypes,b);m.setStyle(a,"display",b?"block":"none")}))},_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,m.hasClass(a,"draw-item")&&(m.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){this._deactiveAllDrawBoxes();d(".draw-item",this.domNode).removeClass("jimu-state-active");
m.addClass(a,"jimu-state-active");var b=a.getAttribute("data-geotype"),c=a.getAttribute("data-commontype"),e=h[b];"TEXT"===b&&(e=h.POINT);this.disableWebMapPopup();this.drawToolBar.activate(e);this.emit("draw-activate",e);this.onIconSelected(a,b,c)},_onDrawEnd:function(a){var b=d(".draw-item.jimu-state-active",this.domNode)[0],c=b.getAttribute("data-geotype"),b=b.getAttribute("data-commontype"),e=null,e="extent"===a.geometry.type?u.fromExtent(a.geometry):a.geometry;e.geoType=c;e.commonType=b;a=e.type;
var f=null,f="point"===a||"multipoint"===a?m.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,e=new n(e,f,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(e);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(e,c,b,this._shiftKey,this._ctrlKey,this._metaKey)},_deactiveAllDrawBoxes:function(){var a;l.forEach(Object.keys(v),r.hitch(this,function(b){(a=v[b])&&a.drawToolBar&&
b!==this.id&&a.deactivate()}))}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E,C,A,w,B,F){var D=t(h,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(b,c){this.markerSymbol=new a(a.STYLE_SOLID,10,new u(u.STYLE_SOLID,new e([255,0,0]),2),new e([0,0,0,.25]));this.lineSymbol=new u(u.STYLE_SOLID,new e([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new u(u.STYLE_SOLID,new e([255,0,0]),2),new e([0,0,0,.25]));this._points=[];this._mouse=!m("esri-touch")&&!m("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=f.mixin(f.mixin({},this._defaultOptions),c||{});if(l("ios")||l("android"))this._options.showTooltips=!1;this._onKeyDownHandler=f.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=f.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=f.hitch(this,this._onMouseUpHandler);this._onClickHandler=f.hitch(this,this._onClickHandler);this._onMouseMoveHandler=f.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=f.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=f.hitch(this,this._onDblClickHandler);this._updateTooltip=f.hitch(this,this._updateTooltip);this._hideTooltip=f.hitch(this,this._hideTooltip);this._redrawGraphic=f.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,d=q.connect,e=D;this._options=f.mixin(f.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.TRIANGLE:case e.CIRCLE:case e.ELLIPSE:case e.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));m("esri-touch")&&!m("esri-pointer")&&
(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POINT:this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);break;case e.LINE:case e.EXTENT:case e.FREEHAND_POLYLINE:case e.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));m("esri-touch")&&!m("esri-pointer")&&(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POLYLINE:case e.POLYGON:case e.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=d(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=d(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=d(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=q.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case D.CIRCLE:case D.ELLIPSE:case D.TRIANGLE:case D.ARROW:case D.LEFT_ARROW:case D.RIGHT_ARROW:case D.UP_ARROW:case D.DOWN_ARROW:case D.RECTANGLE:case D.LINE:case D.EXTENT:case D.FREEHAND_POLYLINE:case D.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case D.POLYLINE:case D.POLYGON:case D.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,d=
D,b=b.slice(0,b.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>b.length)return;a=new C(c);a.addPath([].concat(b));break;case d.POLYGON:if(!this._graphic||3>b.length)return;a=new A(c);b=[].concat(b,[b[0].offset(0,0)]);A.prototype.isClockwise(b)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());a.addRing(b);break;case d.MULTI_POINT:a=new w(c),k.forEach(b,function(b){a.addPoint(b)})}q.disconnect(this._onMouseMoveHandler_connect);
this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=E.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=z.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var d=a.x;a=a.y;var e=b.x;b=b.y;return{x:Math.min(d,e),y:Math.max(a,b),width:Math.abs(d-e),height:Math.abs(a-b),spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=
!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,d=D;b=this.map;var e=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case d.LINE:this._graphic=b.graphics.add(new x(new C({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:e}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new C(e);c.addPath(this._points);this._graphic=b.graphics.add(new x(c,
this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:case d.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new A(e),c.addRing(this._points),this._graphic=b.graphics.add(new x(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}m("esri-touch")&&a.preventDefault();if(1===this._points.length)this.onDrawStart()},
_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this._graphic.geometry;switch(this._geometryType){case D.POLYLINE:case D.POLYGON:var c=this._points.length,d=!!b.getPoint(0,c);a=a.offset(0,0);d?b.setPoint(0,c,a):b.insertPoint(0,c,a);this._graphic.setGeometry(b)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(m("esri-touch")&&!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&
(b=this.map.snappingManager._snappingPoint);var c=this._points[0],d=b||a.mapPoint,e=this.map,g=e.spatialReference;b=this._graphic;var h=D,n=e.toScreen(c),l=e.toScreen(d),k=[],k=l.x-n.x,l=l.y-n.y,p=Math.sqrt(k*k+l*l);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();b.geometry=A.createCircle({center:n,r:p,numberOfPoints:60,map:e});b.setGeometry(b.geometry);break;case h.ELLIPSE:this._hideTooltip();b.geometry=A.createEllipse({center:n,longAxis:k,shortAxis:l,numberOfPoints:60,map:e});b.setGeometry(b.geometry);
break;case h.TRIANGLE:this._hideTooltip();k=[[0,-p],[.8660254037844386*p,.5*p],[-.8660254037844386*p,.5*p],[0,-p]];b.geometry=this._toPolygon(k,n.x,n.y);b.setGeometry(b.geometry);break;case h.ARROW:this._hideTooltip();c=l/p;e=k/p;d=.25*e*p;g=.25*p/(l/k);p*=.25*c;k=[[k,l],[k-d*(1+24/g),l+24*e-p],[k-d*(1+12/g),l+12*e-p],[-12*c,12*e],[12*c,-12*e],[k-d*(1-12/g),l-12*e-p],[k-d*(1-24/g),l-24*e-p],[k,l]];b.geometry=this._toPolygon(k,n.x,n.y);b.setGeometry(b.geometry);break;case h.LEFT_ARROW:this._hideTooltip();
k=0>=k?[[k,0],[.75*k,l],[.75*k,.5*l],[0,.5*l],[0,-.5*l],[.75*k,-.5*l],[.75*k,-l],[k,0]]:[[0,0],[.25*k,l],[.25*k,.5*l],[k,.5*l],[k,-.5*l],[.25*k,-.5*l],[.25*k,-l],[0,0]];b.geometry=this._toPolygon(k,n.x,n.y);b.setGeometry(b.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();k=0<=k?[[k,0],[.75*k,l],[.75*k,.5*l],[0,.5*l],[0,-.5*l],[.75*k,-.5*l],[.75*k,-l],[k,0]]:[[0,0],[.25*k,l],[.25*k,.5*l],[k,.5*l],[k,-.5*l],[.25*k,-.5*l],[.25*k,-l],[0,0]];b.geometry=this._toPolygon(k,n.x,n.y);b.setGeometry(b.geometry);
break;case h.UP_ARROW:this._hideTooltip();k=0>=l?[[0,l],[-k,.75*l],[-.5*k,.75*l],[-.5*k,0],[.5*k,0],[.5*k,.75*l],[k,.75*l],[0,l]]:[[0,0],[-k,.25*l],[-.5*k,.25*l],[-.5*k,l],[.5*k,l],[.5*k,.25*l],[k,.25*l],[0,0]];b.geometry=this._toPolygon(k,n.x,n.y);b.setGeometry(b.geometry);break;case h.DOWN_ARROW:this._hideTooltip();k=0<=l?[[0,l],[-k,.75*l],[-.5*k,.75*l],[-.5*k,0],[.5*k,0],[.5*k,.75*l],[k,.75*l],[0,l]]:[[0,0],[-k,.25*l],[-.5*k,.25*l],[-.5*k,l],[.5*k,l],[.5*k,.25*l],[k,.25*l],[0,0]];b.geometry=this._toPolygon(k,
n.x,n.y);b.setGeometry(b.geometry);break;case h.RECTANGLE:this._hideTooltip();k=[[0,0],[k,0],[k,l],[0,l],[0,0]];b.geometry=this._toPolygon(k,n.x,n.y);b.setGeometry(b.geometry);break;case h.LINE:b.setGeometry(f.mixin(b.geometry,{paths:[[[c.x,c.y],[d.x,d.y]]]}));break;case h.EXTENT:b&&e.graphics.remove(b,!0);b=new B(this._normalizeRect(c,d,g));b._originOnly=!0;this._graphic=e.graphics.add(new x(b,this.fillSymbol),!0);e.snappingManager&&e.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:this._hideTooltip();
if(!1===this._canDrawFreehandPoint(a)){m("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry);break;case h.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){m("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry)}m("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;
var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,d=this._options.tolerance;if((0>b?-1*b:b)<d&&(0>c?-1*c:c)<d)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},_onMouseUpHandler:function(a){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;
var d=this.map.spatialReference,e=D,f;switch(this._geometryType){case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:f=this._graphic.geometry;break;case e.LINE:f=new C({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:d});break;case e.EXTENT:f=(new B(this._normalizeRect(c,b,d))).getExtent();break;case e.FREEHAND_POLYLINE:f=new C(d);f.addPath([].concat(this._points,[b.offset(0,0)]));break;case e.FREEHAND_POLYGON:f=
new A(d),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),A.prototype.isClockwise(c)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),c.reverse()),f.addRing(c)}m("esri-touch")&&a.preventDefault();this._clear();this._drawEnd(f)}else this._clear()},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);b=b||a.mapPoint;a=this.map;
var c=a.toScreen(b),d=D;this._points.push(b.offset(0,0));switch(this._geometryType){case d.POINT:this.onDrawStart();this._drawEnd(b.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===this._points.length?(b=new C(a.spatialReference),b.addPath(this._points),this._graphic=a.graphics.add(new x(b,this.lineSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=q.connect(a,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([b.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case d.POLYGON:1===this._points.length?(b=new A(a.spatialReference),b.addRing(this._points),this._graphic=a.graphics.add(new x(b,this.fillSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=q.connect(a,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([b.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));
break;case d.MULTI_POINT:b=this._points;1===b.length?(c=new w(a.spatialReference),c.addPoint(b[b.length-1]),this._graphic=a.graphics.add(new x(c,this.markerSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(b[b.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case d.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.LEFT_ARROW:this._addShape([[0,
0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case d.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,
24],[0,-48]],c.x,c.y);break;case d.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case d.CIRCLE:this._clear();this.onDrawStart();this._drawEnd(A.createCircle({center:c,r:48,numberOfPoints:60,map:a}));break;case d.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(A.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,map:a}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this.onDrawStart();
this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var d=this.map,e=new A(d.spatialReference);e.addRing(k.map(a,function(a){return d.toMap({x:a[0]+b,y:a[1]+c})}));return e},_onDblClickHandler:function(a){var b,c=this._points,d=this.map.spatialReference,e=D;m("esri-touch")&&c.push(a.mapPoint);var f=c[c.length-1],g=c[c.length-2],c=f&&g&&f.x===g.x&&f.y===g.y?c.slice(0,c.length-1):c.slice(0,c.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>c.length){q.disconnect(this._onMouseMoveHandler_connect);
this._clear();this._onClickHandler(a);return}b=new C(d);b.addPath([].concat(c));break;case e.POLYGON:if(!this._graphic||2>c.length){q.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new A(d);a=[].concat(c,[c[0].offset(0,0)]);A.prototype.isClockwise(a)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case e.MULTI_POINT:b=new w(d),
k.forEach(c,function(a){b.addPoint(a)})}q.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===g.ESCAPE&&(q.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||(this._tooltip=p.create("div",{"class":"esriMapTooltip"},this.map.container),c.isBodyLtr()||d.set(this._tooltip,"direction","rtl"),this._tooltip.style.display=
"none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=q.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=q.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=q.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(q.disconnect(this._onTooltipMouseEnterHandler_connect),q.disconnect(this._onTooltipMouseLeaveHandler_connect),q.disconnect(this._onTooltipMouseMoveHandler_connect),
p.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case D.POINT:c=F.toolbars.draw.addPoint;break;case D.ARROW:case D.LEFT_ARROW:case D.RIGHT_ARROW:case D.UP_ARROW:case D.DOWN_ARROW:case D.TRIANGLE:case D.RECTANGLE:case D.CIRCLE:case D.ELLIPSE:c=F.toolbars.draw.addShape;break;case D.LINE:case D.EXTENT:case D.FREEHAND_POLYLINE:case D.FREEHAND_POLYGON:c=
F.toolbars.draw.freehand;break;case D.POLYLINE:case D.POLYGON:c=F.toolbars.draw.start;1===a?c=F.toolbars.draw.resume:2<=a&&(c=F.toolbars.draw.complete);break;case D.MULTI_POINT:c=F.toolbars.draw.addMultipoint,1<=a&&(c=F.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+r.body().scrollLeft-r.body().clientLeft,a=a.clientY+r.body().scrollTop-r.body().clientTop);b.style.display="none";d.set(b,{left:c+
this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,d){(c||this.map.wrapAround180)&&(a=this._graphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});f.mixin(D,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",
LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});m("extend-esri")&&f.setObject("toolbars.Draw",D,n);return D})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(t,f,k,q,e){t=t([e],{declaredClass:"esri.toolbars._Toolbar",constructor:function(e){this.map=e},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",
box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(e,f,l,g){var k=this.map;e&&(this._mapNavState={isDoubleClickZoom:k.isDoubleClickZoom,isClickRecenter:k.isClickRecenter,isPan:k.isPan,isRubberBandZoom:k.isRubberBandZoom,isKeyboardNavigation:k.isKeyboardNavigation,isScrollWheelZoom:k.isScrollWheelZoom},k.disableDoubleClickZoom(),k.disableClickRecenter(),k.disablePan(),k.disableRubberBandZoom(),
k.disableKeyboardNavigation());f&&k.hideZoomSlider();l&&k.hidePanArrows();g&&k.graphics.disableMouseEvents()},_activateMapTools:function(e,f,k,g){var l=this.map,d=this._mapNavState;e&&d&&(d.isDoubleClickZoom&&l.enableDoubleClickZoom(),d.isClickRecenter&&l.enableClickRecenter(),d.isPan&&l.enablePan(),d.isRubberBandZoom&&l.enableRubberBandZoom(),d.isKeyboardNavigation&&l.enableKeyboardNavigation(),d.isScrollWheelZoom&&l.enableScrollWheelZoom());f&&l.showZoomSlider();k&&l.showPanArrows();g&&l.graphics.enableMouseEvents()},
_deactivateScrollWheel:function(){var e=this.map;this._scrollWheelState={isScrollWheelZoom:e.isScrollWheelZoom,isScrollWheelPan:e.isScrollWheelPan};e.disableScrollWheelZoom();e.disableScrollWheelPan()},_activateScrollWheel:function(){var e=this.map,f=this._scrollWheelState;f&&(f.isScrollWheelZoom&&e.enableScrollWheelZoom(),f.isScrollWheelPan&&e.enableScrollWheelPan())}});k("extend-esri")&&f.setObject("toolbars._Toolbar",t,q);return t})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare",
"dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(t,f,k,q){return t([k],{declaredClass:"jimu.dijit.URLInput",required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:"Invalid Url"},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-url-input")},validator:function(e){if(!1===this.required&&
""===e)return!0;if(isFinite(e))return!1;var f="^"+q.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),f=new RegExp(f,"g");f.lastIndex=0;f=f.test(e);return this.rest?(e=/\/rest\/services/gi.test(e),f&&e):f}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(t,f,k){var q=t.getObject("validate.regexp",!0,k);return q=k.validate.regexp={ipAddress:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowDottedDecimal&&(e.allowDottedDecimal=
!0);"boolean"!=typeof e.allowDottedHex&&(e.allowDottedHex=!0);"boolean"!=typeof e.allowDottedOctal&&(e.allowDottedOctal=!0);"boolean"!=typeof e.allowDecimal&&(e.allowDecimal=!0);"boolean"!=typeof e.allowHex&&(e.allowHex=!0);"boolean"!=typeof e.allowIPv6&&(e.allowIPv6=!0);"boolean"!=typeof e.allowHybrid&&(e.allowHybrid=!0);var f=[];e.allowDottedDecimal&&f.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");e.allowDottedHex&&f.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");
e.allowDottedOctal&&f.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");e.allowDecimal&&f.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");e.allowHex&&f.push("0[xX]0*[\\da-fA-F]{1,8}");e.allowIPv6&&f.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");e.allowHybrid&&f.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
e="";0<f.length&&(e="("+f.join("|")+")");return e},host:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowIP&&(e.allowIP=!0);"boolean"!=typeof e.allowLocal&&(e.allowLocal=!1);"boolean"!=typeof e.allowPort&&(e.allowPort=!0);"boolean"!=typeof e.allowNamed&&(e.allowNamed=!1);var f=e.allowPort?"(\\:\\d+)?":"",k="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";e.allowIP&&(k+="|"+q.ipAddress(e));e.allowLocal&&(k+="|localhost");
e.allowNamed&&(k+="|^[^-][a-zA-Z0-9_-]*");return"("+k+")"+f},url:function(e){e="object"==typeof e?e:{};"scheme"in e||(e.scheme=[!0,!1]);return f.buildGroupRE(e.scheme,function(e){return e?"(https?|ftps?)\\://":""})+q.host(e)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowCruft&&(e.allowCruft=!1);e.allowPort=!1;var f="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+q.host(e);
e.allowCruft&&(f="\x3c?(mailto\\:)?"+f+"\x3e?");return f},emailAddressList:function(e){e="object"==typeof e?e:{};"string"!=typeof e.listSeparator&&(e.listSeparator="\\s;,");var f=q.emailAddress(e);return"("+f+"\\s*["+e.listSeparator+"]\\s*)*"+f+"\\s*["+e.listSeparator+"]?\\s*"},numberFormat:function(e){e="object"==typeof e?e:{};"undefined"==typeof e.format&&(e.format="###-###-####");return f.buildGroupRE(e.format,function(e){return f.escapeString(e,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},
ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowTerritories&&(e.allowTerritories=!0);"boolean"!=typeof e.allowMilitary&&(e.allowMilitary=!0);var f="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";e.allowTerritories&&(f+="|AS|FM|GU|MH|MP|PW|PR|VI");
e.allowMilitary&&(f+="|AA|AE|AP");return"("+f+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/CustomColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a){return f([k,e,q,t],{templateString:"\x3cdiv\x3e\x3c/div\x3e",
baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!1,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!1},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);this.value=this.value?new g(this.value):new g("#fff");this._createContent()},initUI:function(){this._toggleCustomColorPicker("init",
!1)},_createContent:function(){this.appearance=r.mixin(this._defaultAppearance,this.appearance);var a=m.create("div",{"class":"jimu-colorpalette"},this.domNode);this.initPanel=m.create("div",{"class":"init-panel"},a);this.customPanel=m.create("div",{"class":"custom-panel hide"},a);this.appearance.showTransparent&&this._createSpecialColors(this.initPanel);this.appearance.showColorPalette&&this._createColorChooser(this.initPanel);this.appearance.showCoustom&&this._createCustomColorPicker(this.initPanel);
this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(this.initPanel)},setColor:function(a){this._isColorEqual(a)||(this.value=new g(a),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new g("transparent"),!1),this.picker.setColor(new g("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},
getColor:function(){return this.value},changeColor:function(a){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex());this.emit("change",this.value);!0===this.appearance.closeDialogWhenChange&&!1!==a&&this._closeDialog()},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){b.close(this.tooltipDialog);this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(b){b=m.create("div",
{"class":"special-color"},b);this.transparentBtn=m.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},b);this.own(l(this.transparentBtn,a,r.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new g("transparent"));this.changeColor()},_setSpatialColor:function(a){if(this.transparentBtn){var b=
p(".btn-wapper",this.transparentBtn)[0];m.removeClass(b,"selected");a&&a.toString&&a.toString()===this._TRANSPARENT_STR&&m.addClass(b,"selected")}},_createColorChooser:function(a){this.colorChooser=new d({});this.colorChooser.placeAt(a);this.own(l(this.colorChooser,"change",r.hitch(this,function(a){a=new g(a);this.setColor(a);this.changeColor()})))},_createCustomColorPicker:function(){this.coustomtBtn=m.create("div",{"class":"coustom btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+
this.nls.custom+"\x3c/div\x3e\x3c/div\x3e"},this.initPanel);this.own(l(this.coustomtBtn,"click",r.hitch(this,function(){this._toggleCustomColorPicker("custom")})));this.picker=new c({showOk:this.appearance.showColorPickerOK,showApply:this.appearance.showColorPickerApply,value:this.value.toHex()});this.picker.placeAt(this.customPanel);this.picker.setColor(this.value);this.own(l(this.picker,"ok",r.hitch(this,function(a){this.setColor(new g(a));this.changeColor();this._addAColorRecord(a);this._toggleCustomColorPicker("init");
this._closeDialog()})));this.own(l(this.picker,"apply",r.hitch(this,function(a){this.setColor(new g(a));this.changeColor(!1);this._addAColorRecord(a)})));this.own(l(this.picker,"cancel",r.hitch(this,function(){this._toggleCustomColorPicker("init");this._closeDialog()})))},_toggleCustomColorPicker:function(a,b){"custom"===a?(m.removeClass(this.customPanel,"hide"),m.addClass(this.initPanel,"hide")):(m.addClass(this.customPanel,"hide"),m.removeClass(this.initPanel,"hide"));"undefined"!==typeof b&&!1===
b||this.emit("change-style")},_createCoustomRecord:function(a){this.colorRecords=new n({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(a);this.own(l(this.colorRecords,"choose",r.hitch(this,function(a){this.setColor(new g(a));this.changeColor()})))},_addAColorRecord:function(a){this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(a)},_isColorEqual:function(a){return this.value.toString()===(new g(a)).toString()?!0:!1},_changeLabel:function(a){m.empty(this.domNode);
m.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:h.invertColor(a.toHex())}},this.domNode)},onOpen:function(){this.openDialog()},openDialog:function(){this.initUI()},_closeDialog:function(){this.emit("close")},onClose:function(){this._closeDialog()}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c){return f([k,q,e,t],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=p.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;this._col=this.colorsArray[0].length;for(var e=0;e<this._row;e++)for(var b=m.create("tr",{role:"row"},this.gridNode),f=0;f<this._col;f++){var a=this.colorsArray[e][f],g=d.named[a],k="";g?k=a:"rgb(0,0,1)"===
a&&(k="black",g="rgb(0,0,1)");a=this.colorTitleNls[k];g=(new d(g)).toString();this["record"+f]=m.create("td",{"class":"dijitPaletteCell","data-title":g,role:"gridcell"},b);var p=m.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+f]);m.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),alt:a,title:a,"data-title":k,width:"16px",height:"16px",style:"background-color: "+g},p)}this.own(l(this.gridNode,c,r.hitch(this,this.onColorClick)))},onColorClick:function(c){for(var b=
c.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=m.getAttr(b,"data-title");b=(new d(b)).toString();this.setColor(b);c.stopPropagation();c.preventDefault()},_onChange:function(c){this.emit("change",c)},setColor:function(c,b){c=new d(c);for(var e=null,a=g("td",this.domNode),f=0,n=a.length;f<n;f++)m.removeClass(a[f],"dijitPaletteCellSelected");f=0;for(n=a.length;f<n;f++)if(c.toString()===m.getAttr(a[f],"data-title")){e=a[f];break}e&&m.addClass(e,"dijitPaletteCellSelected");
(e&&"undefined"===typeof b||!0===b)&&this._onChange(c)}})})},"jimu/dijit/CustomColorPicker":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color jimu/dijit/ColorSelector".split(" "),function(t,f,k,q,e,r,m,l,g){return f([k,q,t],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,
ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");r.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createDialog(this.domNode)},destroy:function(){this.picker.destroy();this.inherited(arguments)},_handlerOk:function(e){e&&e.stopPropagation&&e.preventDefault&&(e.stopPropagation(),e.preventDefault());this.emit("ok",
this.color)},_handlerApply:function(e){e&&e.stopPropagation&&e.preventDefault&&(e.stopPropagation(),e.preventDefault());this.emit("apply",this.color)},_handlerCancel:function(e){e&&e.stopPropagation&&e.preventDefault&&(e.stopPropagation(),e.preventDefault());this.emit("cancel")},_createDialog:function(){var f=r.create("div",{"class":"dojox-color-picker-container"},this.domNode),d=new g({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:e.hitch(this,function(c){c=
new l(c);this.setColor(c)})});d.placeAt(f);d.startup();f=r.create("div",{"class":"btns-container jimu-float-trailing"},f);if(!0===this.showOk){var c=r.create("div",{"class":"jimu-btn jimu-float-leading ok",title:this.nls.ok,innerHTML:this.nls.ok},f);this.own(m(c,"click",e.hitch(this,function(c){var b=this.picker.get("value");this.setColor(new l(b));this._handlerOk(c)})))}!0===this.showApply&&(c=r.create("div",{"class":"jimu-btn jimu-float-leading apply",title:this.nls.apply,innerHTML:this.nls.apply},
f),this.own(m(c,"click",e.hitch(this,function(c){var b=this.picker.get("value");this.setColor(new l(b));this._handlerApply(c)}))));f=r.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-leading",title:this.nls.cancel,innerHTML:this.nls.cancel},f);this.own(m(f,"click",e.hitch(this,function(c){this._handlerCancel(c)})));this.picker=d},setColor:function(e){if(e instanceof l){var d=this.color,c="";d&&(c=d.toHex());d=e.toHex();this.color=e;c!==d&&this.picker.set("value",d)}},getColor:function(){return this.color},
onClose:function(){}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n){return f([k,q,e,t],{templateString:c,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",recordsLength:10,colorList:null,
postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(b){this.colorList.unshift(b);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(b){b=new p(b);for(var c=null,a=g("td",this.domNode),d=0,e=a.length;d<e;d++)m.removeClass(a[d],"dijitPaletteCellSelected");d=0;for(e=a.length;d<e;d++)if(b.toString()===m.getAttr(a[d],"title")){c=a[d];
break}c&&(m.addClass(c,"dijitPaletteCellSelected"),this.onChoose(b))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var b=0;b<this.recordsLength;b++){var c=this["record"+b];if(c&&this.colorList[b]&&this.colorList[b].toString){var a=this.colorList[b].toString();m.setAttr(c,"title",a);c=this._findImg(c);m.setStyle(c,"background-color",a);m.setAttr(c,"alt",a);m.setAttr(c,"title",a)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var b=0;b<this.recordsLength;b++){this["record"+
b]=m.create("td",{"class":"dijitPaletteCell",tabindex:b,title:"",role:"gridcell"},this.container);var c=m.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+b]);m.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},c)}this.own(l(this.gridNode,n,r.hitch(this,this.onRecordClick)))},onRecordClick:function(b){for(var c=b.target;"TD"!==c.tagName;){if(!c.parentNode||c===this.gridNode)return;c=c.parentNode}c=m.getAttr(c,
"title");c=(new p(c)).toString();this.onChoose(c);b.stopPropagation();b.preventDefault()},onChoose:function(b){this.emit("choose",b)},_findImg:function(b){var c=null;return b.nodeName&&"IMG"===b.nodeName.toUpperCase()?b:c=g(".dijitColorPaletteSwatch",b)[0]},_setCookie:function(b){for(var c=[],a=0,e=this.recordsLength;a<e;a++){var f=this.colorList[a];f&&f.toString&&(c[a]=f.toString())}this._cleanCookie(b);try{var g=JSON.stringify(c);d(b,g,{expires:1E3,path:"/"})}catch(z){console.error("ColorRecords: cookieList JSON.stringify error."+
z.stack)}},_getCookie:function(b){b=d(b);if("undefined"!==typeof b)try{var c=JSON.parse(b);if(c&&"undefined"!==typeof c.length){b=0;for(var a=this.recordsLength;b<a;b++){var e=c[b];e&&e.toString&&(this.colorList[b]=new p(e.toString()))}}}catch(v){console.error("ColorRecords: cookieList JSON.parse error."+v.stack)}},_cleanCookie:function(b){d(b,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle ./a11y/OnScreenWidgetPanel dojo/touch".split(" "),
function(t,f,k,q,e,r,m,l,g,p){t=t([m,r],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"btns-container"\x3e\x3cdiv tabindex\x3d"0" class\x3d"foldable-btn jimu-vcenter" aria-label\x3d"${headerNls.foldWindow}" role\x3d"button"data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked,onkeydown:_onFoldableBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"max-btn jimu-vcenter" aria-label\x3d"${headerNls.maxWindow}" role\x3d"button"data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked,onkeydown:_onMaxBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"close-btn jimu-vcenter" aria-label\x3d"${headerNls.closeWindow}" role\x3d"button"data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,onkeydown:_onCloseBtnKey"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postMixInProperties:function(){this.headerNls=window.jimuNls.panelHeader},postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w);this.a11y_init()},_onMaxBtnClicked:function(d){d.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?(k.setAttr(this.maxNode,"aria-label",
this.headerNls.maxWindow),this.panelManager.normalizePanel(this)):(k.setAttr(this.maxNode,"aria-label",this.headerNls.restoreWindow),this.panelManager.maximizePanel(this),k.removeClass(this.foldableNode,"fold-up"),k.addClass(this.foldableNode,"fold-down"),k.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)),this._setMobilePosition());this.panelManager.activatePanel(this)},_onFoldableBtnClicked:function(d){d&&d.stopPropagation();this._getPositionInfo().isRunInMobile&&("minimized"===
this.windowState?(k.removeClass(this.foldableNode,"fold-up"),k.addClass(this.foldableNode,"fold-down"),k.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow),this.panelManager.normalizePanel(this)):(k.removeClass(this.foldableNode,"fold-down"),k.addClass(this.foldableNode,"fold-up"),k.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow),this.panelManager.minimizePanel(this)),k.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow),this._setMobilePosition())},_onCloseBtnClicked:function(d){d.preventDefault();
d.stopPropagation();this.panelManager.closePanel(this)},_normalizePositionObj:function(d){var c=this._getLayoutBox();d.left=isFinite(d.left)?d.left:c.w-d.right;d.top=isFinite(d.top)?d.top:c.h-d.bottom;delete d.right;delete d.bottom;this.position=f.mixin(f.clone(this.position),d)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||
400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();this.resizeHandle=(new g({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(d,c){this.disableMoveable();var g=k.getMarginBox(jimuConfig.layoutId);g.l=g.l-d+
c;g.w+=2*(d-c);this.moveable=new e.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode,within:!0});this.own(q(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(q(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);window.appInfo.isRunInMobile&&(this._setMobilePosition(),
l.isInNavMode()&&"minimized"===this.windowState&&this._onFoldableBtnClicked());this.inherited(arguments)},_switchToMobileUI:function(){k.removeClass(this.titleNode,"title-normal");k.addClass(this.titleNode,"title-full");k.setStyle(this.foldableNode,"display","block");k.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(k.removeClass(this.foldableNode,"fold-up"),k.addClass(this.foldableNode,"fold-down"),k.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)):(k.removeClass(this.foldableNode,
"fold-down"),k.addClass(this.foldableNode,"fold-up"),k.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow))},_switchToDesktopUI:function(){k.removeClass(this.titleNode,"title-full");k.addClass(this.titleNode,"title-normal");k.setStyle(this.foldableNode,"display","none");k.setStyle(this.maxNode,"display","none")},resize:function(d){var c=this._getPositionInfo(),e={left:c.position.left,top:c.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};d&&(d.t=this.domNode.offsetTop,
e.left=isFinite(d.l)?d.l:e.left,e.top=isFinite(d.t)?d.t:e.top,e.width=isFinite(d.w)?d.w:e.width,e.height=isFinite(d.h)?d.h:e.height,this._normalizePositionObj(f.clone(e)),this.makePositionInfoBox(),e.width=this._positionInfoBox.w,e.height=this._positionInfoBox.h);c.position=e;this._onResponsible(c);this.inherited(arguments)},_onResponsible:function(d){d.isRunInMobile?(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(d.position),
this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(d){this._normalizePositionObj(d);this.makePositionInfoBox();d=this._getPositionInfo();this._onResponsible(d)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var d=jimuConfig.layoutId,d="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return k.getMarginBox(d)},_getPositionInfo:function(){var d=
{isRunInMobile:!1,position:{left:0,top:5}},c=this._getLayoutBox(),e=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return d.isRunInMobile=!0,d;window.isRTL?(d.position.left=c.w-e,d.position.left+this._positionInfoBox.w>c.w&&(d.position.left-=this._positionInfoBox.w,0>d.position.left&&(d.position.left=c.w-this._positionInfoBox.w))):(d.position.left=e,d.position.left+this._positionInfoBox.w>c.w&&(d.position.left=c.w>this._positionInfoBox.w?c.w-this._positionInfoBox.w:0));e=this._positionInfoBox.t;
c=c.h-e;e>=c?e>=this._positionInfoBox.h&&(d.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):c>=this._positionInfoBox.h&&(d.position.top=this._positionInfoBox.t+40+3);return d},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==k.byId(jimuConfig.layoutId)&&k.place(this.domNode,jimuConfig.layoutId);var d=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(d.zIndex=this.position.zIndex);var c=l.getPositionStyle(d);f.mixin(c,
d.borderRadiusStyle);k.setStyle(this.domNode,c)},_setDesktopPosition:function(d){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==k.byId(jimuConfig.mapId)&&k.place(this.domNode,jimuConfig.mapId);k.setStyle(this.domNode,{left:d.left+"px",right:"auto",top:d.top+"px",width:(d.width||this.position.width||this._originalBox.w)+"px",height:(d.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(d){k.setStyle(d.node,"opacity",.9)},onMoveStop:function(d){k.setStyle(d.node,
"opacity",1);d=k.getMarginBox(d.node);this._normalizePositionObj(f.clone({left:d.l,top:d.t,width:d.w,height:d.h}));this.makePositionInfoBox()}});t.extend(p);return t})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),function(t,
f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u){t.experimental("dojox.layout.ResizeHandle");var v=n("dojox.layout._ResizeHelper",a,{show:function(){c.set(this.domNode,"display","")},hide:function(){c.set(this.domNode,"display","none")},resize:function(a){d.setMarginBox(this.domNode,a)}});return n("dojox.layout.ResizeHandle",[a,u],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,
constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,b.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=h.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(m.body()),
p.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=f.partial(p.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(k.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=h.byId(this.targetId))?this.targetWidget.domNode:g.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var f=d.position(this.targetDomNode,!0);this._resizeHelper.resize({l:f.x,t:f.y,w:f.w,h:f.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:f.x,t:f.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var f=c.getComputedStyle(this.targetDomNode),n="border-model"===d.boxModel?{w:0,h:0}:d.getPadBorderExtents(this.targetDomNode,f),l=d.getMarginExtents(this.targetDomNode,f);this.startSize={w:c.get(this.targetDomNode,"width",f),h:c.get(this.targetDomNode,"height",f),pbw:n.w,pbh:n.h,mw:l.w,mh:l.h};this.isLeftToRight()||"absolute"!=c.get(this.targetDomNode,"position")||(f=d.position(this.targetDomNode,!0),this.startPosition={l:f.x,t:f.y});this._pconnects=[k.connect(m.doc,b.move,this,"_updateSizing"),
k.connect(m.doc,b.release,this,"_endSizing")];e.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(w){return!1}this._activeResizeLastEvent=a;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
d:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(c=c||this.startPosition)&&this._resizeX&&(e.l=c.l+d,e.w!=a&&(e.l+=a-e.w),e.t=c.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(a){var b=this.targetWidget&&f.isFunction(this.targetWidget.resize),d=this._getNewCoords(a,b&&"margin");if(!1!==d&&(b?this.targetWidget.resize(d):this.animateSizing?l[this.animateMethod]([r.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:d.w}},duration:this.animateDuration}),r.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:d.h}},
duration:this.animateDuration})]).play():c.set(this.targetDomNode,{width:d.w+"px",height:d.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){q.forEach(this._pconnects,k.disconnect);var b=f.partial(k.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/a11y/OnScreenWidgetPanel":function(){define(["dojo/_base/lang","dojo/on",
"dojo/_base/html","dojo/keys"],function(t,f,k,q){return{a11y_init:function(){k.setAttr(this.domNode,"role","application");this.own(f(this.domNode,"keydown",t.hitch(this,function(e){k.hasClass(e.target,"close-btn")||e.keyCode!==q.ESCAPE||(e.stopPropagation(),this.closeNode.focus())})))},_onMaxBtnKeyDown:function(e){e.keyCode!==q.ENTER&&e.keyCode!==q.SPACE||this._onMaxBtnClicked(e)},_onFoldableBtnKeyDown:function(e){e.keyCode===q.ENTER||e.keyCode===q.SPACE?this._onFoldableBtnClicked(e):e.keyCode===
q.TAB&&e.shiftKey&&e.preventDefault()},_onCloseBtnKey:function(e){e.keyCode===q.ENTER||e.keyCode===q.SPACE?this._onCloseBtnClicked(e):e.keyCode===q.TAB&&e.shiftKey&&(window.appInfo.isRunInMobile||e.preventDefault())}}})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo".split(" "),function(t,f,k,q,e,r){return t(r,{constructor:function(e,f,g,k){this.noLegend=k},_initVisible:function(){var e=!1,f=this.originOperLayer.mapService;
this.originOperLayer.mapService&&f.layerInfo._subLayerVisible[f.subId]&&(e=!0);this._visible=e},_setTopLayerVisible:function(e){var f;if(this.originOperLayer.mapService&&(f=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){f.layerInfo._subLayerVisible[f.subId]=e?!0:!1;this._visible=e;var g={};this.traversal(function(e){0===e.getSubLayers().length&&(g[e.originOperLayer.mapService.subId]=e.isVisbleOrInvisilbe())});f.layerInfo._setSubLayerVisible(g)}},setLayerVisiblefromTopLayer:function(){},
_visibleChanged:function(e){},_sevVisible:function(e){this.visible=e},obtainNewSubLayers:function(){var e=[];f.forEach(this.originOperLayer.subLayers,function(f){f.parentLayerInfo=this;f=this._layerInfoFactory.create(f);e.push(f);f.init()},this);return e},getOpacity:function(){},setOpacity:function(e){},getLayerObject:function(){var f=new q;this.layerObject.empty?e({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(k.hitch(this,function(e){var g=
this.layerObject.url;this.layerObject=e;this.layerObject.url=g;this.layerObject.id=this.id;f.resolve(this.layerObject)}),function(e){f.reject(e)}):f.resolve(this.layerObject);return f},getLayerType:function(){var e=new q;e.resolve("GroupLayer");return e},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getScaleRange:function(){var e=this.originOperLayer.mapService;return(e=e.layerInfo._getJsapiLayerInfoById(e.subId))&&
0<=e.minScale&&0<=e.maxScale?{minScale:e.minScale,maxScale:e.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/dijit/Filter":function(){define("dojo/on dijit/a11yclick dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet jimu/dijit/formSelect ./LoadingIndicator".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E){return q([e,r,m,g,k],{templateString:l,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,autoSwitchMode:!0,_validOptions:!1,_layerDefinition:null,_popupFieldsInfo:[],_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,mode:"desktop",noFilterTip:"",enableAskForValues:!1,mobileBreakWidth:600,runtime:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.add=window.jimuNls.common.add;
this.nls.apply=window.jimuNls.common.apply;this.layerInfosObj=d.getInstanceSync();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._setDesktopMode();this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=this.noFilterTip);this._bindBtnsEvent()},startup:function(){this.inherited(arguments);this.autoUpdateMode()},resize:function(){this.autoUpdateMode()},_bindBtnsEvent:function(){this.own(t(this.btnAddExpDesktop,f,b.hitch(this,function(){this._onBtnAddExpClick()})));
this.own(t(this.btnAddSetDesktop,f,b.hitch(this,function(){this._onBtnAddSetClick()})));this.own(t(this.btnAddExpMobile,f,b.hitch(this,function(){this._onBtnAddExpClick()})));this.own(t(this.btnAddSetMobile,f,b.hitch(this,function(){this._onBtnAddSetClick()})))},autoUpdateMode:function(){this.autoSwitchMode&&(this._clearMode(),this.domNode.clientWidth>=this.mobileBreakWidth?this._setDesktopMode():this._setMobileMode())},setMode:function(a){"desktop"===a?this._setDesktopMode():"mobile"===a&&this._setMobileMode()},
_setMode:function(a){this.mode=a;this._setModeClass(this.mode)},_setModeClass:function(a){h.removeClass(this.domNode,"desktop-mode");h.removeClass(this.domNode,"mobile-mode");h.addClass(this.desktopAddSection,"hidden");h.addClass(this.mobileAddSection,"hidden");a&&h.addClass(this.domNode,a+"-mode")},_clearMode:function(){this._setModeClass("")},_setDesktopMode:function(){this._setMode("desktop");h.removeClass(this.desktopAddSection,"hidden")},_setMobileMode:function(){this._setMode("mobile");h.removeClass(this.mobileAddSection,
"hidden")},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this._layerDefinition=null,this._popupFieldsInfo=[],this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(a){var b=new v;this.isBuilding()?b.reject("Filter is already building."):(this._def=null,this.reset(),this.url=a.url,this.isHosted=p.isHostedService(this.url),this._layerDefinition=a.layerDefinition,
this.featureLayerId=a.featureLayerId,a.partsObj?(this.partsObj=this._updatePartsObj(a.partsObj),this._def=this._init("partsObj")):(this.expr=a.expr||"1\x3d1",this._def=this._init("expr")),b=this._def);return b},buildByExpr:function(a,b,c){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");return this.build({url:a,expr:b,layerDefinition:c,featureLayerId:this.featureLayerId})},buildByFilterObj:function(a,b,c){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");
return this.build({url:a,partsObj:b,layerDefinition:c,featureLayerId:this.featureLayerId})},_updatePartsObj:function(c){a.forEach(c,b.hitch(this,function(c){c.parts?a.forEach(c.parts,b.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):c.interactiveObj&&!0===c.interactiveObj.cascade?c.interactiveObj.cascade="previous":!1===c.interactiveObj.cascade&&(c.interactiveObj.cascade=
"none")}));return c},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(a,c){var d=new v;c?d.resolve(c):(this.loading.show(),x({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(b.hitch(this,function(a){this.domNode?(this.loading.hide(),d.resolve(a)):d.reject()}),b.hitch(this,function(a){console.error(a);d.reject();this.domNode&&this.loading.hide()})));return d},_validateLayerDefinition:function(a){return this._isObject(a)},_init:function(d){var e=
new v;if(!this._isString(this.url))return e.reject(),e;var f=b.hitch(this,function(){setTimeout(b.hitch(this,function(){this.emit("change");e.resolve()}),1500)}),g=b.hitch(this,function(){h.addClass(this.errorSection,"hidden");this.removeAllFilters();var g;this.featureLayerId&&(this._tryOverrideFieldAliases(this.featureLayerId,this._layerDefinition),g=this.layerInfosObj.getLayerOrTableInfoById(this.featureLayerId).getPopupInfo());var n=this._layerDefinition.fields;n&&0<n.length?(this._popupFieldsInfo=
g?p.completePopupFieldFromLayerField(n,g.fieldInfos):n,(n=a.filter(n,b.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)})))&&0<n.length?(this._validOptions=!0,h.removeClass(this.btnAddSetDesktop,"jimu-state-disabled"),h.removeClass(this.btnAddExpDesktop,"jimu-state-disabled"),h.removeClass(this.btnAddSetMobile,"jimu-state-disabled"),h.removeClass(this.btnAddExpMobile,"jimu-state-disabled"),this.createFieldsStore(),this.valueProviderFactory=new c({url:this.url,layerDefinition:this._layerDefinition,
featureLayerId:this.featureLayerId}),"expr"===d?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?f():e.reject()):e.reject():"partsObj"===d?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),f()):e.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),f()):this._isString(this.expr)?this._parseExpr(this.expr)?f():e.reject():(this.removeAllFilters(),f())):(this._showErrorOptions(this.nls.error.noFilterFields),
e.reject())):(g&&(this._popupFieldsInfo=g.fieldInfos),e.reject())});this._validateLayerDefinition(this._layerDefinition)?g():(this.loading.show(),x({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(b.hitch(this,function(a){this.domNode?(this.loading.hide(),this._layerDefinition=a,g()):e.reject()}),b.hitch(this,function(a){console.error(a);e.reject();this.domNode&&this.loading.hide()})));return e},_tryOverrideFieldAliases:function(c,d){if(c=this.layerInfosObj.getLayerOrTableInfoById(c))if(c=
c.getPopupInfo())if(c=c.fieldInfos,d=d.fields,c&&0<c.length&&d&&0<d.length){var e={};a.forEach(c,b.hitch(this,function(a){a.fieldName&&(e[a.fieldName]=a)}));a.forEach(d,b.hitch(this,function(a){var b=e[a.name];b&&b.label&&(a.alias=b.label)}))}},toJson:function(){var c={logicalOperator:this.allAnySelect.value,parts:[]},d=this._getAllSingleFiltersAndFilterSets();if(0===d.length)return c.expr="1\x3d1",c;a.forEach(d,b.hitch(this,function(a){a=a.toJson();c.parts.push(a)}));return a.every(c.parts,b.hitch(this,
function(a){return!!a}))&&0<c.parts.length?(c.expr=this.getExprByFilterObj(c),c):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var a=b.clone(this._layerDefinition.fields);0===this.setFieldsStoreByFieldInfos(a)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},_parsePartsObj:function(a){this._validatePartsObj(a)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(a))},_parseExpr:function(a){this._destroyAllFilters();
var b=null;if(!this._validateLayerDefinition(this._layerDefinition))return b;if(!a||"string"!==typeof a)return this._showErrorOptions(this.nls.error.invalidSQL),b;if("1\x3d1"===this.expr.replace(/\s/gi,""))return b={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{b=this.getFilterObjByExpr(a)}catch(w){b=null,console.error(w)}b?this._buildEditUIByPartsObj(b):this._showErrorOptions(this.nls.error.cantParseSQL);return b},_buildEditUIByPartsObj:function(c){c&&(this._destroyAllFilters(),a.forEach(c.parts,
b.hitch(this,function(a){a.parts?this._addFilterSet(a):a.fieldObj&&a.operator&&a.valueObj&&this._addSingleFilter(a)})),this.allAnySelect.value=c.logicalOperator,this._setFilterMsgUI(c.parts.length))},_addSingleFilter:function(a){a={url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,part:a,OPERATORS:b.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,
isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};a=new z(a);a.placeAt(this.allExpsBox);a.startup();this.own(u.after(a,"_destroySelf",b.hitch(this,function(){this._checkFilterNumbers();this._focusOnMobileAdd();this.emit("change")})));this.own(t(a,"change",b.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_focusOnMobileAdd:function(){h.hasClass(this.mobileAddSection,"hidden")||this.btnAddExpMobile.focus()},_addFilterSet:function(a){a=
{url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,partsObj:a,OPERATORS:b.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};a=new E(a);a.placeAt(this.allExpsBox);a.startup();this.own(u.after(a,"_destroySelf",b.hitch(this,function(){this._checkFilterNumbers();
this._focusOnMobileAdd();this.emit("change")})));this.own(t(a,"change",b.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_destroyAllFilters:function(){for(var a=this._getAllSingleFiltersAndFilterSets();0<a.length;)a[0].destroy(),a.splice(0,1);this._checkFilterNumbers()},_getAllSingleFiltersAndFilterSetsDoms:function(){var c=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&a.forEach(this.allExpsBox.childNodes,b.hitch(this,function(a){(h.hasClass(a,
"jimu-single-filter")||h.hasClass(a,"jimu-filter-set"))&&c.push(a)}));return c},_getAllSingleFiltersAndFilterSets:function(){var c=this._getAllSingleFiltersAndFilterSetsDoms();return a.map(c,b.hitch(this,function(a){return n.byNode(a)}))},_setFilterMsgUI:function(a){2>a?(this.allAnySelect.value="AND",h.setStyle(this.allAnySelect.domNode,"display","none"),h.setStyle(this.oneOrZeroMsg,"display","block")):(h.setStyle(this.oneOrZeroMsg,"display","none"),h.setStyle(this.allAnySelect.domNode,"display",
"inline-table"))},_checkFilterNumbers:function(){var a=this._getAllSingleFiltersAndFilterSetsDoms();this._setFilterMsgUI(a.length);0<a.length?h.addClass(this.noFilterTipSection,"hidden"):h.removeClass(this.noFilterTipSection,"hidden");this.emit("filter-number-change")},_showErrorOptions:function(a){console.error(a);h.addClass(this.errorSection,"hidden");this.errorTip.innerHTML=a;this.loading.hide()},_onBtnApplyClicked:function(){this.emit("apply")},_onBtnAddSetClick:function(){this._layerDefinition&&
this._validOptions&&(this._addFilterSet(),this.emit("change"))},_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&(this._addSingleFilter(),this.emit("change"))}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./AdvancedListValueProvider ./PredefinedValueProvider ./NumberListValueProvider ./DateIsInValueProvider jimu/utils jimu/LayerInfos/LayerInfos".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){var h={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},
values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",
supportAskForValue:!0}},dateOperatorIsNotIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},
dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},a=k([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(a){t.mixin(this,a);this.nls=window.jimuNls.filterBuilder;a=b.getInstanceSync();this.featureLayerId&&(this.layerInfo=a.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(a,
b){var c=[];if(b=h[b])b.value&&c.push("value"),b.field&&0<this._getSameShortTypeFieldNames(a).length&&c.push("field"),b.unique&&this.url&&(this._isStreamServer(this.url)||c.push("unique")),b.multiple&&this.url&&(this._isStreamServer(this.url)||c.push("multiple")),b.uniquePredefined&&this.url&&(this._isStreamServer(this.url)||c.push("uniquePredefined")),b.multiplePredefined&&this.url&&(this._isStreamServer(this.url)||c.push("multiplePredefined"));return c},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,
"");return/\/StreamServer$/gi.test(a)},_getSameShortTypeFieldNames:function(b){var c=[],d=this._getFieldInfo(this.layerDefinition,b),e=a.getShortTypeByEsriType(d.type);f.forEach(this.layerDefinition.fields,t.hitch(this,function(d){d.name!==b&&a.getShortTypeByEsriType(d.type)===e&&c.push(d.name)}));return c},_getSameShortTypeFieldNameLabels:function(b){var c=[],d=this._getFieldInfo(this.layerDefinition,b),e=a.getShortTypeByEsriType(d.type);f.forEach(this.layerDefinition.fields,t.hitch(this,function(d){d.name!==
b&&a.getShortTypeByEsriType(d.type)===e&&c.push({value:d.name,label:d.alias})}));return c},getValueProvider:function(a,b){var f=null,k=t.clone(h[a.operator]);if(k){var u=a.valueObj.type,v=a.fieldObj.name,A=this._getFieldInfo(this.layerDefinition,v),w=k[u],B=w.normalProviderType,F=null,D=n.getCodedValueListForCodedValueOrSubTypes(this.layerDefinition,v);"field"===u?(v=this._getSameShortTypeFieldNameLabels(v),0<v.length&&(F=v)):D&&0<D.length&&w.codedValueProviderType&&(B=w.codedValueProviderType);a=
{nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:a,fieldInfo:A,codedValues:D,staticValues:F,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:k,filterCodedValueIfPossible:!!w.filterCodedValueIfPossible,runtime:b};if("BLANK_VALUE_PROVIDER"===B)f=new q(a);else if("SIMPLE_VALUE_PROVIDER"===B)f=new e(a);else if("TWO_NUMBERS_VALUE_PROVIDER"===B)f=new r(a);else if("TWO_DATES_VALUE_PROVIDER"===B)f=new m(a);else if("LIST_VALUE_PROVIDER"===B)a.showNullValues=!1,"value"===
u||"field"===u?f=new l(a):(a.providerType=B,a.selectUI="dropdown",f=new g(a));else if("NUMBER_LIST_VALUE_PROVIDER"===B)f=new d(a);else if("DATE_IS_IN_VALUE_PROVIDER"===B)f=new c(a);else if("ADVANCED_LIST_VALUE_PROVIDER"===B)a.providerType=B,a.selectUI="dropdown",f=new g(a);else if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===B||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===B)a.providerType=B,a.selectUI=a.partObj.valueObj?a.partObj.valueObj.selectUI:null,f=b?new g(a):new p(a)}return f},_getFieldInfo:function(a,b){a=
a.fields;for(var c=0;c<a.length;c++){var d=a[c];if(b===d.name)return d}return null}});a.getOperatorInfo=function(a){return t.clone(h[a])};a.getOperatorsByShortType=function(a,b){var c=[];"string"===a?c="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsAnyOf stringOperatorIsNoneOf stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):"number"===a?c="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsAtMost numberOperatorIsLessThan numberOperatorIsGreaterThan numberOperatorIsAnyOf numberOperatorIsNoneOf numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):
"date"===a&&(c="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsIn dateOperatorIsNotIn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "),b&&c.splice(8,0,"dateOperatorInTheLast","dateOperatorNotInTheLast"));return c};a.getShortTypeByEsriType=function(a){var b=null;"esriFieldTypeString"===a?b="string":"esriFieldTypeDate"===a?b="date":0<=["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a)&&(b="number");return b};return a})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(t,f,k){return f([k],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);t.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},
setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils esri/lang".split(" "),function(t,f,k,q,e,r,m,l,g,p){return r([m,l,f],{baseClass:"jimu-filter-value-provider",fieldName:null,shortType:null,_enabled:!1,
cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&this.codedValues&&
this.filterCodedValueIfPossible&&g.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&e.some(this.popupInfo.fieldInfos,k.hitch(this,function(d){return d.fieldName===this.fieldName?(this.fieldPopupInfo=d,!0):!1}))},getDijits:function(){return[]},bindChangeEvents:function(){var d=this.getDijits();e.forEach(d,k.hitch(this,function(c){c.declaredClass&&
0===c.declaredClass.indexOf("dijit.")&&q.addClass(c.domNode,c.declaredClass.replace(/\./g,"-"));this.own(t(c,"change",k.hitch(this,this._onChanged)));this.own(t(c,"enter",k.hitch(this,this._onEnter)))}))},_onChanged:function(){this._onEnterTriggered||this.emit("change")},_onEnterTriggered:!1,_onEnter:function(){this._onEnterTriggered=!0;this.emit("change");this.emit("enter");setTimeout(k.hitch(this,function(){this._onEnterTriggered=!1}),100)},tryLocaleNumber:function(d){var c=g.localizeNumber(d);
if(null===c||void 0===c)c=d;return c},getPartObject:function(){var d=this.getValueObject();if(!d)return null;var c=k.clone(this.partObj);c.valueObj=d;return c},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var d=1,c=this.getDijits();0<c.length&&(d=e.map(c,k.hitch(this,function(c){return"function"===typeof c.getStatus?c.getStatus():this.getStatusForDijit(c)})),d=Math.min.apply(d,d));return d},
getStatusForDijit:function(d){return d.validate()?d.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var d="1\x3d1",d=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var c=this.getCascadeFilterExpr(),d="("+d+") AND ("+c+")";return d},getLayerFilterExpr:function(){var d=
"1\x3d1";this.layerInfo&&(d=this.layerInfo.getFilter());d||(d="1\x3d1");return d},_getWebMapFilterExpr:function(){var d="";this.layerInfo&&(d=this.layerInfo.getFilterOfWebmap());d||(d="1\x3d1");return d},getDropdownFilterExpr:function(){var d="1\x3d1",d=this._getWebMapFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var c=this.getCascadeFilterExpr(),d="("+d+") AND ("+c+")";return d},getCascadeFilterExpr:function(){return"1\x3d1"},getDropdownFilterPartsObj:function(){var d={parts:[]};
if("all"===this.cascade||"previous"===this.cascade)d=this.getCascadeFilterPartsObj();return d},getCascadeFilterPartsObj:function(){return{}},getCodedValueListByPartsObj:function(d,c,e,b){var f=g.getFieldInfoByFieldName(d.fields,c),a=d.typeIdField,n=null;e=e.parts;for(var k in e){var l=e[k];if(l.fieldObj.name===a){a=l.valueObj.value;n=g._getCodedValueBySubTypeId(d,c,a,f);break}}var p;n||(n=b?b:g._getAllCodedValue(d,f));n&&0<n.length&&(p=n[0].value);return{selectedValue:p,valueLabels:n}},isDefined:function(d){return p.isDefined(d)},
disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled},destroy:function(){this.inherited(arguments)}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/keys jimu/utils ./ValueProvider dijit/form/ValidationTextBox dijit/form/NumberTextBox ./DateValueSelector".split(" "),function(t,f,k,q,e,r,m,l){return f([e],{templateString:"\x3cdiv\x3e\x3c/div\x3e",_dijit:null,customId:null,postCreate:function(){this.inherited(arguments);
this.customId=this.partObj.vpId;t.addClass(this.domNode,"jimu-filter-simple-value-provider");var e=null;"string"===this.shortType?(e={required:!1,trim:!0,intermediateChanges:!1},this.customId&&(e.id=this.customId),this._dijit=new r(e),this._dijit.startup(),this._dijit.on("keydown",function(e){(e.keyCode||e.which)===k.ENTER&&this._dijit.emit("enter")}.bind(this))):"number"===this.shortType?(e={required:!1,intermediateChanges:!1,constraints:{pattern:"#####0.##########"}},this.customId&&(e.id=this.customId),
this._dijit=new m(e),this._dijit.startup(),this._dijit.on("keydown",function(e){(e.keyCode||e.which)===k.ENTER&&this._dijit.emit("enter")}.bind(this))):(e={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo},this.customId&&(e.customId=this.customId,e.prompt=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint),this._dijit=new l(e));!this.customId||"string"!==this.shortType&&"number"!==this.shortType||(e=t.toDom('\x3clabel for\x3d"'+this.customId+'" class\x3d"screen-readers-only"\x3e'+
this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e"),t.place(e,this.domNode));t.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},getDijits:function(){return[this._dijit]},setValueObject:function(e){this.isDefined(e.value)&&("date"===this.shortType?this._dijit.setValueObject(e):this._dijit.set("value",e.value))},getValueObject:function(){if(this.isValidValue())if("date"===this.shortType){var e=this._dijit.getValueObject();if(e&&e.value)return e.isValid=
!0,e.type=this.partObj.valueObj.type,e}else return e=this._dijit.get("value"),e="number"===this.shortType?parseFloat(e):q.sanitizeHTML(e),{isValid:!0,type:this.partObj.valueObj.type,value:e};return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:null}:null},setRequired:function(e){this._dijit.set("required",e)}})})},"jimu/dijit/_filter/DateValueSelector":function(){define("dojo/aspect dojo/Evented dojo/on dojo/keys dojo/query dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase jimu/filterUtils jimu/utils jimu/dijit/Popup jimu/dijit/formSelect jimu/dijit/dateTimePicker".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){return g([p,f],{virtualDates:null,customId:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-date-value-selector");this.dateTypeSelect=new b({"aria-label":this.prompt});r.addClass(this.dateTypeSelect.domNode,"date-type-select");r.addClass(this.dateTypeSelect.domNode,"restrict-select-width");this.dateTypeSelect.placeAt(this.domNode);
this.own(k(this.dateTypeSelect,"change",m.hitch(this,function(){this._onDateTypeSelectChanged()})));this.virtualDates&&0<this.virtualDates.length||(this.virtualDates=[d.VIRTUAL_DATE_TODAY,d.VIRTUAL_DATE_YESTERDAY,d.VIRTUAL_DATE_TOMORROW]);this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});this.dateTypeSelect.addOption({value:"custom",label:this.nls.custom});l.map(this.virtualDates,m.hitch(this,function(a){var b={value:a,label:a};switch(a){case d.VIRTUAL_DATE_TODAY:b.label=this.nls.today;
break;case d.VIRTUAL_DATE_YESTERDAY:b.label=this.nls.yesterday;break;case d.VIRTUAL_DATE_TOMORROW:b.label=this.nls.tomorrow}this.dateTypeSelect.addOption(b)}));this.dateTypeSelect.startup();this.own(k(r.byId("main-page"),"click",m.hitch(this,function(){this.hideDateTimePopup()})));this.own(t.before(this.dateTypeSelect,"openDropDown",m.hitch(this,function(){this.hideDateTimePopup();"custom"===this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&(this.dateTypeSelect.textDirNode.innerText=
this.dateTimeObj.value);"custom"!==this.dateTypeSelect.getValue()&&this.dateTimePopup&&this.dateTimePopup.hide()})));this.own(t.after(this.dateTypeSelect,"closeDropDown",m.hitch(this,function(){this.customId||r.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText);this.dateTypeSelect.textDirNode.title="";setTimeout(m.hitch(this,function(){"custom"===this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&this.dateTypeSelect.textDirNode&&(this.dateTypeSelect.textDirNode.innerText=
this.dateTimeObj.value,this.dateTypeSelect.textDirNode.title=this.dateTimeObj.value);this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===r.getStyle(this.dateTimePopup.domNode,"display")&&this.dateTimePicker&&this.dateTimePicker.calendar&&this.dateTimePicker.calendar.focus()}),200)})));this.own(t.after(this.dateTypeSelect.dropDown,"onItemClick",m.hitch(this,function(a){a&&"custom"===a.option.value&&this.showDateTimePopup()}),!0));this.popupInfo&&this.popupInfo.fieldInfos&&(this.fieldInfo=this.popupInfo.fieldInfos.filter(m.hitch(this,
function(a){return a.fieldName===this._fieldInfo.name}))[0])},hideDateTimePopup:function(){this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===r.getStyle(this.dateTimePopup.domNode,"display")&&(this.dateTimePicker&&!0===this.dateTimePopupClick?this.dateTimePopupClick=!1:this.dateTimePopup.hide())},getDijits:function(){return[]},setValueObject:function(a){if(a.virtualDate&&"custom"!==a.virtualDate)this.dateTypeSelect.set("value",a.virtualDate,!1),this.customId||r.setAttr(this.dateTypeSelect,
"aria-label",a.virtualDate);else if(this.dateTypeSelect.set("value","custom",!1),a.value){var b=c.getDateByDateTimeStr(a.value),d=c.localizeDateTimeByFieldInfo(b,this.fieldInfo,a.enableTime,a.timeAccuracy);this.dateTimeObj={date:b,value:d};this.dateTypeSelect.textDirNode.innerText=d;this.dateTypeSelect.textDirNode.title=d;this.enableTime=a.enableTime;this.timeAccuracy=a.timeAccuracy;this.customId||r.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText)}},getValueObject:function(){return this.isValidValue()?
this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var a={value:null,virtualDate:""},b=this.dateTypeSelect.get("value"),e=null;"custom"===b?(e=this.dateTimeObj.date,a.value=e?c.getDateTimeStr(e):null,a.virtualDate="",a.enableTime=this.enableTime?this.enableTime:!1,a.timeAccuracy=this.timeAccuracy?this.timeAccuracy:""):(e=d.getRealDateByVirtualDate(b),a.virtualDate=b,e?a.value=c.getDateTimeStr(e,"YYYY-MM-DD"):a=null);return a},setRequired:function(){},
getStatus:function(){return"custom"===this.dateTypeSelect.get("value")?this.dateTimePicker?this._getStatusForDijit(this.dateTimePicker):this.dateTimeObj?1:0:""===this.dateTypeSelect.get("value")?0:1},_getStatusForDijit:function(a){return a.validate()?a.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},_onDateTypeSelectChanged:function(){"dateTime"===this.dateTypeSelect.get("value")&&
this.showDateTimePopup();this.emit("change")},showDateTimePopup:function(){if(this.dateTimePopup)this.resize(),this.dateTimePicker.reset(),this.dateTimePopup.show();else{this.dateTimeObj||(this.dateTimeObj={date:null});this.dateTimePicker=new h({runtime:this.runtime,value:this.dateTimeObj.date,fieldInfo:this.fieldInfo,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy});this.own(k(this.dateTimePicker,"created",m.hitch(this,function(a){this.dateTypeSelect.textDirNode.innerText=a.value;this.dateTypeSelect.textDirNode.title=
a.value;this.dateTimeObj=a})));this.own(k(this.dateTimePicker,"timeChange",m.hitch(this,function(a){a&&(this.dateTypeSelect.textDirNode.innerText=a.value,this.dateTypeSelect.textDirNode.title=a.value,this.enableTime=a.enableTime,this.timeAccuracy=a.timeAccuracy,this.dateTimeObj=a,this.emit("change"))})));this.own(k(this.dateTimePicker,"timeStatusChanged",m.hitch(this,function(){this.popupH=this.enableTime?353:309})));this.own(k(this.dateTimePicker,"close",m.hitch(this,function(){this.dateTimePopup.hide();
this.dateTypeSelect.focus()})));this.runtime?this._isOnlyShowDate()?(this.popupH=265,this.own(k(this.dateTimePicker,"calendarChange",m.hitch(this,function(a){a&&this.dateTypeSelect.textDirNode.innerText!==a.value&&(this.dateTypeSelect.textDirNode.innerText=a.value,this.dateTypeSelect.textDirNode.title=a.value,this.enableTime=a.enableTime,this.timeAccuracy=a.timeAccuracy,this.dateTimeObj=a,this.emit("change"))})))):this.popupH=320:this.popupH=this.enableTime?353:309;var a=this._calculatePopup();this.dateTimePopup=
new n({width:this.popupW,autoHeight:!0,classNames:["dijitCalendarPopup","jimu-popup-date-time-picker"],content:this.dateTimePicker.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:a.left,top:a.top},useFocusLogic:!1,onClose:m.hitch(this,function(){this.dateTimePopup.hide();return!1}),buttons:[]});this._isOnlyShowDate()&&r.setStyle(this.dateTimePopup.contentContainerNode,{marginBottom:"-3px"});this.own(k(this.dateTimePopup.domNode,"click",
m.hitch(this,function(){this.dateTimePopupClick=!0})));this.own(k(this.dateTimePopup.domNode,"keydown",m.hitch(this,function(a){a.keyCode===q.ESCAPE?(this.dateTimePopup.hide(),this.dateTypeSelect.focus()):this.runtime&&a.keyCode===q.TAB&&(a.preventDefault(),this._isOnlyShowDate()||(r.hasClass(a.target,"dijitCalendarSelectedDate")?this.dateTimePicker.timeTextBox.focusNode:this.dateTimePicker.calendar).focus())})))}},_getLastBtnFromDTPopup:function(){for(var a=null,b=e(".jimu-btn",this.dateTimePopup.buttonContainer),
c=b.length-1;0<=c;c--)if("none"!==r.getStyle(b[c],"display")){a=b[c];break}return a},_isOnlyShowDate:function(){return this.runtime&&!this.enableTime?!0:!1},_calculatePopup:function(){var a=r.getStyle(this.domNode,"width");this.popupW=210<a?a:210;var b=r.position(this.domNode),c=r.position(document.body).h,d=b.y+30;c-d<this.popupH&&(d=b.y-this.popupH,d=0<d?d:(c-this.popupH)/2);c=r.position(document.body).w;b.x+this.popupW>c&&(b.x-=this.popupW-a);return{left:b.x,top:d-1}},resize:function(){var a=this._calculatePopup();
this.dateTimePopup.setCustomPosition(a.left,a.top,this.popupW,this.popupH)},destroy:function(){this.dateTimePopup&&(this.dateTimePopup.onClose=m.hitch(this,function(){return!0}),this.dateTimePopup.close())}})})},"jimu/dijit/dateTimePicker":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang jimu/utils dijit/Calendar dijit/form/TimeTextBox dojo/text!./templates/dateTimePicker.html dojo/on dojo/Evented jimu/dijit/CheckBox".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c){return t([k,q,e,c],{baseClass:"jimu-datetimepicker",declaredClass:"jimu.datetimepicker",templateString:p,value:null,fieldInfo:null,enableTime:!1,timeAccuracy:"",runtime:!1,postMixInProperties:function(){this.timeNls=window.apiNls.widgets.imageFilter.imageFilterSettings;this.timeUnit=window.jimuNls.timeUnit},postCreate:function(){this._initSelf()},_initSelf:function(){this.calendar=new l({value:this.value,"class":"jimu-calendar"},this.calendarDiv);this.own(d(this.calendar,
"change",r.hitch(this,function(){this._valueChange();this.runtime&&!this.enableTime&&this.emit("close")})));this.calendar.startup();if(this.runtime)if(f.setStyle(this.timeTextContainerSetting,"display","none"),this.enableTime){f.setStyle(this.timeTextContainerRuntime,"display","block");var c={constraints:{timePattern:"s"===this.timeAccuracy?"HH:mm:ss":"m"===this.timeAccuracy?"HH:mm":"HH",clickableIncrement:"T00:30:00",visibleIncrement:"T01:00:00",visibleRange:"T01:00:00"}};"h"===this.timeAccuracy&&
(c.constraints.clickableIncrement="T01:00:00");this.timeTextBox=new g(c,this.timeTextBoxDiv);this.own(d(this.timeTextBox,"change",r.hitch(this,function(){this.enableTime=""===this.timeTextBox.displayedValue?!1:!0;this._valueChange()})));this.timeTextBox.startup();this.timeTextBox.set("value",this.value)}else f.setStyle(this.timeTextContainerRuntime,"display","none");else f.setStyle(this.timeTextContainerRuntime,"display","none"),f.setStyle(this.timeTextContainerSetting,"display","block"),this._initTimePickers();
this._enableTime=this.enableTime;this.emit("created",this.getValueObj())},_initTimePickers:function(){this.timeCheckbox.setValue(this.enableTime);this.enableTime&&(f.setStyle(this.timeTableContainer,"display","block"),this.value&&this._setTimeBox_HMS(this.value));this.own(d(this.timeCheckbox,"change",r.hitch(this,function(){this._changeTimeCheckStatus();this._valueChange();this.emit("timeStatusChanged")})));this.own(d(this.hourSelect,"change",r.hitch(this,function(){this._valueChange()})));this.own(d(this.minuteSelect,
"change",r.hitch(this,function(){this._valueChange()})));this.own(d(this.secondSelect,"change",r.hitch(this,function(){this._valueChange()})))},_changeTimeCheckStatus:function(){(this._enableTime=this.timeCheckbox.checked)?f.setStyle(this.timeTableContainer,"display","block"):f.setStyle(this.timeTableContainer,"display","none")},_valueChange:function(){this.emit("timeChange",this.getValueObj())},isValid:function(){if(null===this.calendar.value)return!1;if(this.runtime){if(this._enableTime&&!this.timeTextBox.isValid())return!1}else if(this.timeCheckbox.checked){if(!this.hourSelect.isValid()||
!this.minuteSelect.isValid()||!this.secondSelect.isValid()||""===this.hourSelect.displayedValue||""!==this.hourSelect.displayedValue&&""!==this.secondSelect.displayedValue&&""===this.minuteSelect.displayedValue)return!1}else this.hourSelect.isValid()||this.hourSelect.set("value",null),this.minuteSelect.isValid()||this.minuteSelect.set("value",null),this.secondSelect.isValid()||this.secondSelect.set("value",null);return!0},getValueObj:function(){if(!this.isValid())return!1;var c=new Date(this.calendar.value.toDateString());
if(this.runtime){if(this.enableTime){var b=this.timeTextBox.get("value");b&&(c.setHours(b.getHours()),c.setMinutes(b.getMinutes()),c.setSeconds(b.getSeconds()))}}else if(this.enableTime=this._enableTime){var b=this.hourSelect.get("value"),d=this.minuteSelect.get("value"),a=this.secondSelect.get("value");this.timeAccuracy=a?"s":d?"m":"h";c.setHours(b?b.getHours():null);c.setMinutes(d?d.getMinutes():null);c.setSeconds(a?a.getSeconds():null)}else this.timeAccuracy="";b=m.localizeDateTimeByFieldInfo(c,
this.fieldInfo,this.enableTime,this.timeAccuracy);this.value=c;return{date:c,value:b,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy}},validate:function(){this.set("DisplayedValue",this.calendar.value?1:0);return!0},reset:function(){var c=this.calendar.get("value");c&&this.value&&this.value.toDateString()===c.toDateString()||this.calendar.set("value",this.value);this.timeCheckbox.setValue(this.enableTime);this.runtime?this.enableTime&&this.timeTextBox.set("value",this.value):this._setTimeBox_HMS(this.enableTime?
this.value:null)},_setTimeBox_HMS:function(c){var b=null,d=null,a=null;"h"===this.timeAccuracy?b=c:"m"===this.timeAccuracy?b=d=c:"s"===this.timeAccuracy&&(b=d=a=c);this.hourSelect.set("value",b);this.minuteSelect.set("value",d);this.secondSelect.set("value",a)}})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u){var v=q("dijit.Calendar",[n,b,h],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){l.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new v._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:p.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(d(this.domNode,"keydown",p.hitch(this,"_onKeyDown")),d(this.dateRowsNode,"mouseover",p.hitch(this,"_onDayMouseOver")),d(this.dateRowsNode,"mouseout",p.hitch(this,"_onDayMouseOut")),d(this.dateRowsNode,"mousedown",p.hitch(this,"_onDayMouseDown")),d(this.dateRowsNode,"mouseup",p.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=
new this.dateClassObj(this.currentFocus);b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var c=this.currentFocus.getDate();b.setDate(Math.min(c,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=r.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!r.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(r.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||
a.relatedTarget&&a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",r.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),r.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!r.contains(a,"dijitCalendarDisabledDate")&&(r.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&r.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,c,d=this.currentFocus;switch(a.keyCode){case g.RIGHT_ARROW:b=1;case g.LEFT_ARROW:c="day";this.isLeftToRight()||(b*=-1);break;case g.DOWN_ARROW:b=1;case g.UP_ARROW:c="week";break;case g.PAGE_DOWN:b=1;case g.PAGE_UP:c=a.ctrlKey||a.altKey?"year":"month";break;case g.END:d=this.dateModule.add(d,"month",1),c="day";case g.HOME:d=new this.dateClassObj(d);d.setDate(1);break;default:return!0}c&&(d=this.dateModule.add(d,c,b));this._setCurrentFocusAttr(d);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});v._MonthDropDownButton=q("dijit.Calendar._MonthDropDownButton",u,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new v._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",
b);this.containerNode.innerHTML=(6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});v._MonthDropDown=q("dijit.Calendar._MonthDropDown",[b,a,h],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";t.forEach(a,function(a,b){m.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(e.get(a.target,"month"))},onChange:function(){}});return v})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a){var u=f("dijit.CalendarLite",[b,h],{templateString:a,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=r.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),c=this.dateModule.getDaysInMonth(a),d=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),f=new this.dateClassObj,h=0<=this.dayOffset?this.dayOffset:k.getFirstDayOfWeek(this.lang);h>
b&&(h-=7);if(!this.summary){var n=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",n[a.getMonth()])}this._date2cell={};t.forEach(this.dateCells,function(n,k){var l=k+h,p=new this.dateClassObj(a),m="dijitCalendar",q=0;l<b?(l=d-b+l+1,q=-1,m+="Previous"):l>=b+c?(l=l-b-c+1,q=1,m+="Next"):(l=l-b+1,m+="Current");q&&(p=this.dateModule.add(p,"month",q));p.setDate(l);this.dateModule.compare(p,f,"date")||(m="dijitCalendarCurrentDate "+m);this.isDisabledDate(p,
this.lang)?(m="dijitCalendarDisabledDate "+m,n.setAttribute("aria-disabled","true")):(m="dijitCalendarEnabledDate "+m,n.removeAttribute("aria-disabled"),n.setAttribute("aria-selected","false"));(q=this.getClassForDate(p,this.lang))&&(m=q+" "+m);n.className=m+"Month dijitCalendarDateTemplate";m=p.valueOf();this._date2cell[m]=n;n.dijitDateValue=m;m=p.getDateLocalized?p.getDateLocalized(this.lang):p.getDate();this._setText(this.dateLabels[k],m);g.set(n,"aria-label",e.format(p,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,c=new this.dateClassObj;t.forEach(["previous","current","next"],function(a){c.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(c,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?p.getObject(a.datePackage,
!1):q;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?p.getObject(a.datePackage+".locale",!1):e},_createMonthWidget:function(){return u._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,b=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),c=0<=this.dayOffset?this.dayOffset:k.getFirstDayOfWeek(this.lang);this.dayCellsHtml=n.substitute([a,
a,a,a,a,a,a].join(""),{d:""},function(){return b[c++%7]});a=n.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);m.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=p.hitch(this,function(a,
b,c){this[a].dojoClick=!0;return d(this[a],"click",p.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,c))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,b){var d=this.currentFocus,e=this._getNodeByDate(d);a=this._patchDate(a);this._set("currentFocus",a);this._date2cell&&0==this.dateModule.difference(d,a,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));a=this._getNodeByDate(a);a.setAttribute("tabIndex",this.tabIndex);(this.focused||b)&&a.focus();e&&e!=a&&(c("webkit")?e.setAttribute("tabIndex","-1"):e.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!l.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){l.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}t.forEach(this._selectedCells||[],p.partial(b,!1));this._selectedCells=t.filter(t.map(a,this._getNodeByDate,this),function(a){return a});t.forEach(this._selectedCells,p.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
u._MonthWidget=f("dijit.CalendarLite._MonthWidget",b,{_setMonthAttr:function(a){var b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a),d=6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+t.map(b,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=d+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+b[a.getMonth()]+"\x3c/div\x3e"}});return u})},"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),
function(t,f,k,q,e,r){return t("dijit.form.TimeTextBox",r,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:e,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(e){this.inherited(arguments);var f=k(".dijitTimePickerItemSelected",this.dropDown.domNode),g=this.dropDown.domNode.parentNode;g.scrollTop=f[0]?f[0].offsetTop-(g.clientHeight-f[0].clientHeight)/2:(g.scrollHeight-g.clientHeight)/2;this.dropDown.on("input",q.hitch(this,function(){this.set("value",this.dropDown.get("value"),
!1)}))},_onInput:function(){this.inherited(arguments);var e=this.get("displayedValue");this.filterString=e&&!this.parse(e,this.constraints)?e.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a){return e("dijit._TimePicker",[h,a],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:q.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(a){l.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",a)},_setValueAttr:function(a){this._set("value",a);this._showText()},_setFilterStringAttr:function(a){this._set("filterString",a);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(a,b,c,d){a=this.ownerDocument.createDocumentFragment();for(b=0;b<this._maxIncrement;b++)(c=this._createOption(b))&&a.appendChild(c);return a},_showText:function(){var a=q.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=a(this.clickableIncrement);
this._visibleIncrementDate=a(this.visibleIncrement);var b=function(a){return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds()},c=b(this._clickableIncrementDate),b=b(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=a(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=b/c;a=a(this.pickerMax);a.setFullYear(1970,0,1);a=.001*(a.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((a+1)/c);c=this._getFilteredNodes();
!c.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(c)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(a){for(var b in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})b in a&&(this[b]=a[b]);a.locale||(a.locale=this.lang)},_createOption:function(a){var b=new Date(this._refDate),c=this._clickableIncrementDate;b.setHours(b.getHours()+
c.getHours()*a,b.getMinutes()+c.getMinutes()*a,b.getSeconds()+c.getSeconds()*a);"time"==this.constraints.selector&&b.setFullYear(1970,0,1);var d=k.format(b,this.constraints);if(this.filterString&&0!==d.toLowerCase().indexOf(this.filterString))return null;c=this.ownerDocument.createElement("div");c.className=this.baseClass+"Item";c.date=b;c.idx=a;m.create("div",{"class":this.baseClass+"ItemInner",innerHTML:d},c);d=1>a%this._visibleIncrement&&-1<a%this._visibleIncrement;a=!d&&!(a%this._clickableIncrement);
d?c.className+=" "+this.baseClass+"Marker":a&&(c.className+=" "+this.baseClass+"Tick");this.isDisabledDate(b)&&(c.className+=" "+this.baseClass+"ItemDisabled");this.value&&!f.compare(this.value,b,this.constraints.selector)&&(c.selected=!0,c.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=c,d?c.className+=" "+this.baseClass+"MarkerSelected":a&&(c.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(c,!0));return c},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(a,b){(a=a.target.date||a.target.parentNode.date)&&!this.isDisabledDate(a)&&(this._set("value",a),this.emit("input"),b&&(this._highlighted_option=null,this.set("value",a),this.onChange(a)))},onChange:function(){},_highlightOption:function(a,b){if(a){if(b)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=a;else{if(this._highlighted_option!==a)return;this._highlighted_option=null}r.toggle(a,this.baseClass+
"ItemHover",b);r.contains(a,this.baseClass+"Marker")?r.toggle(a,this.baseClass+"MarkerHover",b):r.toggle(a,this.baseClass+"TickHover",b)}},handleKey:function(a){if(a.keyCode==g.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==g.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==g.ENTER||
a.keyCode===g.TAB){if(!this._keyboardSelected&&a.keyCode===g.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return a.keyCode===g.TAB}},onHover:function(a){this._highlightOption(a,!0)},onUnhover:function(a){this._highlightOption(a,!1)},onSelect:function(a){this._highlightOption(a,!0)},onDeselect:function(a){this._highlightOption(a,!1)},onClick:function(a){this._onOptionSelected({target:a},!0)}})})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(t,f,k,q,e,r,m,l){new Date("X");return q("dijit.form._DateTimeTextBox",[r,m],{templateString:l,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:f.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(e,f){var d=this._isInvalidDate(e),c=this._isInvalidDate(f);if(d||c)return d&&c?0:d?-1:1;e=this.format(e,this._unboundedConstraints);f=this.format(f,this._unboundedConstraints);
d=this.parse(e,this._unboundedConstraints);c=this.parse(f,this._unboundedConstraints);return e==f?0:t.compare(d,c,this._selector)},autoWidth:!0,format:function(e,f){return e?this.dateLocaleModule.format(e,f):""},parse:function(e,f){return this.dateLocaleModule.parse(e,f)||(this._isEmpty(e)?null:void 0)},serialize:function(e,f){e.toGregorian&&(e=e.toGregorian());return k.toISOString(e,f)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(g){g=
g||{};this.dateModule=g.datePackage?e.getObject(g.datePackage,!1):t;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=g.datePackage?e.getObject(g.datePackage+".locale",!1):f;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(f){f.selector=this._selector;f.fullYear=!0;var g=k.fromISOString;"string"==typeof f.min&&(f.min=g(f.min),this.dateClassObj instanceof Date||(f.min=new this.dateClassObj(f.min)));"string"==typeof f.max&&(f.max=g(f.max),this.dateClassObj instanceof Date||(f.max=new this.dateClassObj(f.max)));this.inherited(arguments);this._unboundedConstraints=e.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(e){return!e||
isNaN(e)||"object"!=typeof e||e.toString()==this._invalidDate},_setValueAttr:function(e,f,d){void 0!==e&&("string"==typeof e&&(e=k.fromISOString(e)),this._isInvalidDate(e)&&(e=null),e instanceof Date&&!(this.dateClassObj instanceof Date)&&(e=new this.dateClassObj(e)));this.inherited(arguments,[e,f,d]);this.value instanceof Date&&(this.filterString="");!1!==f&&this.dropDown&&this.dropDown.set("value",e,!1)},_set:function(e,f){if("value"==e){f instanceof Date&&!(this.dateClassObj instanceof Date)&&
(f=new this.dateClassObj(f));var d=this._get("value");if(d instanceof this.dateClassObj&&0==this.compare(f,d))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(e){this._isInvalidDate(e)&&(e=new this.dateClassObj);this._set("dropDownDefaultValue",e)},openDropDown:function(f){this.dropDown&&this.dropDown.destroy();var g=e.isString(this.popupClass)?e.getObject(this.popupClass,!1):this.popupClass,d=this,c=this.get("value");this.dropDown=new g({onChange:function(c){d.set("value",
c,!0)},id:this.id+"_popup",dir:d.dir,lang:d.lang,value:c,textDir:d.textDir,currentFocus:this._isInvalidDate(c)?this.dropDownDefaultValue:c,constraints:d.constraints,filterString:d.filterString,datePackage:d.datePackage,isDisabledDate:function(c){return!d.rangeCheck(c,d.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(e,f){this._setValueAttr(this.parse(e,this.constraints),f,e)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/lang dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox jimu/utils".split(" "),
function(t,f,k,q,e,r,m,l,g){return k([q,e,r],{templateString:m,customId:null,postCreate:function(){this.inherited(arguments);t.addClass(this.domNode,"jimu-two-numbers-filter-value-provider");this.customId=this.partObj.vpId;var e={required:!1,intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},d=f.clone(e),c;if(this.customId){e.id=this.customId+"_between";c=this.customId;var n=t.toDom('\x3clabel for\x3d"'+e.id+'" class\x3d"screen-readers-only"\x3e'+this.partObj.interactiveObj.prompt+
" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e");t.place(n,this._dijit1_container)}else c=g.getUUID();d.id=c+"_and";c=t.toDom('\x3clabel for\x3d"'+d.id+'" class\x3d"screen-readers-only"\x3e'+this.nls.and+"\x3c/label\x3e");t.place(c,this._dijit2_container);this._dijit1=new l(e);this._dijit2=new l(d);this._dijit1.startup();this._dijit2.startup();this._dijit1.on("blur",function(){this._onRangeNumberBlur()}.bind(this));this._dijit2.on("blur",function(){this._onRangeNumberBlur()}.bind(this));t.setStyle(this._dijit1.domNode,
"width","100%");t.setStyle(this._dijit2.domNode,"width","100%");this._dijit1.placeAt(this._dijit1_container);this._dijit2.placeAt(this._dijit2_container)},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var e=parseFloat(this._dijit1.get("value")),d=parseFloat(this._dijit2.get("value"));e>d&&(this._dijit1.set("value",d),this._dijit2.set("value",e))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(e){this.isDefined(e.value1)&&this._dijit1.set("value",
e.value1);this.isDefined(e.value2)&&this._dijit2.set("value",e.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var e={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(e.value1)&&(e.value1=null);isNaN(e.value2)&&(e.value2=null);return e}return null},setRequired:function(e){this._dijit1.set("required",e);this._dijit2.set("required",e)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/declare dojo/_base/lang ./ValueProvider dijit/_WidgetsInTemplateMixin ./DateValueSelector dojo/text!./TwoDatesValueProvider.html jimu/utils".split(" "),function(t,f,k,q,e,r,m,l,g){return k([e,r,t],{templateString:l,customId:null,
postCreate:function(){this.inherited(arguments);this.customId=this.partObj.vpId;f.addClass(this.domNode,"jimu-two-dates-filter-value-provider");var e={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},d=q.clone(e),c;this.customId?(e.customId=this.customId+"_between",e.prompt=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint,c=this.customId):c=g.getUUID();d.customId=c+"_and";d.prompt=this.nls.and;this._dijit1=new m(e,this._dijitDiv1);
this._dijit2=new m(d,this._dijitDiv2)},_initDateSelectors:function(){},_onDateValueSelectorChanged:function(){this.emit("change")},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(e){this._setValueObject(this._dijit1,e,1);this._setValueObject(this._dijit2,e,2)},_setValueObject:function(e,d,c){var f="value"+c;if(this.isDefined(d[f])){var b={enableTime:d["enableTime"+c],timeAccuracy:d["timeAccuracy"+c],value:null,virtualDate:""};b.value=d[f];b.virtualDate=d["virtualDate"+
c];e.setValueObject(b)}},getValueObject:function(){if(this.isValidValue()){var e=this._dijit1.getValueObject(),d=this._dijit2.getValueObject();if(e.value&&d.value)return{isValid:!0,type:this.partObj.valueObj.type,enableTime1:e.enableTime?!0:!1,timeAccuracy1:e.timeAccuracy?e.timeAccuracy:"",enableTime2:d.enableTime?!0:!1,timeAccuracy2:d.timeAccuracy?d.timeAccuracy:"",value1:e.value,value2:d.value,virtualDate1:e.virtualDate,virtualDate2:d.virtualDate}}return null},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:null,value2:null,virtualDate1:null,virtualDate2:null}:null},getStatus:function(){return 1===this._dijit1.getStatus()&&1===this._dijit2.getStatus()?1:-1===this._dijit1.getStatus()||-1===this._dijit2.getStatus()?-1:0},setRequired:function(e){this._dijit1.set("required",e);this._dijit2.set("required",e)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/_base/declare ./ValueProvider dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d){return m([l],{templateString:"\x3cdiv\x3e\x3c/div\x3e",codedValues:null,staticValues:null,showNullValues:!1,layerDataChanged:!1,ifDropDown:!1,customId:null,postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-filter-list-value-provider");this.customId=this.partObj.vpId;this._initValueSelect();this._uniqueValueCache={};this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";var c=new g({idProperty:"id",data:[]});this.valuesSelect.set("store",c);this.isNumberField=p.isNumberField(this.fieldInfo.type);!this.staticValues&&"function"===typeof this.valuesSelect._onDropDownMouseDown&&(!this.codedValues||this.codedValues&&this.filterCodedValue)&&(this.own(t.before(this.valuesSelect,"_onDropDownMouseDown",k.hitch(this,this._onBeforeDropDownMouseDown))),this.own(r(document.body,"click",k.hitch(this,this._onBodyClick))),this.layerInfo&&
this.layerInfo.getLayerObject().then(k.hitch(this,function(c){c.on("edits-complete",k.hitch(this,function(){this.layerDataChanged=!0}))})))},_initValueSelect:function(){var c={searchAttr:"label",required:!1,intermediateChanges:!0};this.customId&&(c["aria-label"]=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint);this.valuesSelect=new d(c);this.valuesSelect.startup();this.valuesSelect.on("input",k.hitch(this,this._onFilteringSelectInput));q.setStyle(this.valuesSelect.domNode,
"width","100%");this.valuesSelect.placeAt(this.domNode)},_onFilteringSelectInput:function(){this.emit("change")},_getCodedValueLabelsBySubTypeId:function(){var c=this.getDropdownFilterPartsObj();return this.getCodedValueListByPartsObj(this.layerDefinition,this.fieldName,c,this.codedValues)},_onBeforeDropDownMouseDown:function(){this.ifDropDown=!0;this._tryUpdatingUniqueValues(void 0,!0);return arguments},_onBodyClick:function(c){c=c.target||c.srcElement;c===this.domNode||q.isDescendant(c,this.domNode)||
this.msgDiv&&q.setStyle(this.msgDiv,"display","none")},getDijits:function(){return[this.valuesSelect]},isValidValue:function(){return 0<this.getStatus()},getStatus:function(){var c=this.valuesSelect.get("item");if(c&&void 0!==c.value){if(this.isNumberField&&!p.isValidNumber(c.value)&&"value"===this.partObj.valueObj.type){var d=parseFloat(c.value);return p.isValidNumber(d)?(c.value=d,this._getStatusForDijit(this.valuesSelect)):-1}return this._getStatusForDijit(this.valuesSelect)}return 0},_getStatusForDijit:function(c){return c.validate()?
c.get("DisplayedValue")?1:0:-1},setValueObject:function(c){return this.staticValues?this._setValueForStaticValues(c.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(c.value,!1):this._setValueForStaticValues(c.value,this.codedValues):this._tryUpdatingUniqueValues(c.value,!1)},getValueObject:function(){if(this.isValidValue()){var c=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:c}}return null},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(c){this.valuesSelect.set("required",c)},_setValueForStaticValues:function(c,d){var b=null,f=-1,b=null;d&&(b=e.map(d,k.hitch(this,function(a,b){a={id:b,value:a.value,label:a.label};a.value+""===c+""&&(f=b);return a})),this.valuesSelect.store.setData(b),0<=f&&(b=this.valuesSelect.store.get(f))&&this.valuesSelect.set("item",b),this._checkIfNoData())},
_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(c,d){var b=new f;if(this.valuesSelect._opened)this._checkIfNoData(),b.resolve();else{var e=this.getDropdownFilterExpr();e!==this._uniqueValueLoadingExpr||this.layerDataChanged?(this.valuesSelect.readOnly=!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=e,this._uniqueValueLoadingDef=this._getUniqueValues(e),
this._uniqueValueLoadingDef.then(k.hitch(this,function(a){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(c,a),this._hideLoadingIcon(),d&&this.valuesSelect.toggleDropDown(),this._checkIfNoData(),b.resolve())}),k.hitch(this,function(a){console.error(a);this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),this._checkIfNoData(),b.reject(a))}))):(this._checkIfNoData(),b.resolve())}return b},_setValueForUniqueValues:function(c,
d){d.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});this.showNullValues||(d=e.filter(d,k.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===c){var b=this.getValueObject();b&&(c=b.value)}var f=-1,b=null;d=e.map(d,k.hitch(this,function(a,b){var d={id:b,value:a.value,label:a.label};a.value+""===c+""&&(f=b);return d}));this.valuesSelect.store.setData(d);0<=f&&(b=this.valuesSelect.store.get(f));this.valuesSelect.set("item",b)},_checkIfNoData:function(){this.runtime&&
this.ifDropDown&&(this.ifDropDown=!1,0===this.valuesSelect.store.data.length&&(this.msgDiv?q.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),q.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.valuesSelect.domNode.parentNode.appendChild(this.msgDiv))))},_showLoadingIcon:function(){q.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){q.removeClass(this.valuesSelect.domNode,"loading")},
_getUniqueValues:function(c){var d=new f;this._uniqueValueCache[c]&&!this.layerDataChanged?d.resolve(this._uniqueValueCache[c]):(this._showLoadingIcon(),p.getUniqueValues(this.url,this.fieldName,c,this.layerDefinition,this.fieldPopupInfo).then(k.hitch(this,function(b){this.domNode&&(this._uniqueValueCache[c]=b,d.resolve(b),this._hideLoadingIcon())}),k.hitch(this,function(b){this.domNode&&(d.reject(b),this._hideLoadingIcon())})));this.layerDataChanged=!1;return d}})})},"jimu/dijit/_filter/AdvancedListValueProvider":function(){define("dojo/Deferred dojo/_base/lang dojo/on dojo/keys dojo/Evented dojo/_base/html dojo/_base/array dojo/_base/declare dojo/query ./ValueProvider ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueProvider.html jimu/utils jimu/dijit/_filter/pageControlForQuery jimu/dijit/Popup".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u){return l([p,c,n,e],{templateString:b,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";r.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"ADVANCED_LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="multipleDynamic",this.checkedNumDiv.style.display="block"):"LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="uniqueDynamic",this.checkedNameDiv.style.display="block"):(this.runtime&&"dropdown"===this.selectUI&&("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?this.checkedNameDiv.style.display=
"block":this.checkedNumDiv.style.display="block"),this.controlType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiplePredefined":"uniquePredefined");this.selectType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiple":"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"unique":"LIST_VALUE_PROVIDER"===this.providerType?"unique":"multiple";this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel=
"alias");!this.runtime||"multipleDynamic"!==this.controlType&&"uniqueDynamic"!==this.controlType||(this.isLoadDataAdvanced=!0);this.runtime&&"esriFieldTypeDate"===this.fieldInfo.type&&this.partObj.fieldObj&&(this.fieldPopupInfo={format:{dateFormat:this.partObj.fieldObj.dateFormat}});this.isNumberField=h.isNumberField(this.fieldInfo.type);this.pageControlForQuery||(this.pageControlForQuery=new a({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,
fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}),this.pageControlForQuery.on("query_getNewExpr",f.hitch(this,this._resetPageControlNewExpr)));this.listSelect||(this._resetPromptLabel(!1),this.listSelectDataList=this.partObj&&this.partObj.valueObj&&this.partObj.valueObj.value?this.partObj.valueObj.value:[],this.listSelect=new d({label:this.promptLabel.innerHTML,emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectUI:this.selectUI,controlType:this.controlType,
selectType:this.selectType,dataList:this.listSelectDataList,selectedDataList:[],isNumberField:this.isNumberField}),f.isArray(this.listSelectDataList)?this.getCheckedList(this.listSelectDataList):(this.listSelect.checkedList=[this.listSelectDataList],this.listSelect._updateCheckedLabelListFromCheckedList()),this.listSelect.on("advancedListValueSelect_itemChecked",f.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",f.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",
f.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",f.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",f.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemsConfirmed",f.hitch(this,function(){this.cbxPopup&&this.cbxPopup.domNode&&("block"===r.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide()),this.checkedBtn.focus())})),this.own(k(this.checkedBtn,
"keydown",f.hitch(this,function(a){r.hasClass(a.target||a.srcElement,"checkBtn")&&a.keyCode===q.ENTER&&this._checkedBtnEvent()}))),this.staticValues||"function"!==typeof this._checkedBtnEvent||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.layerInfo&&this.layerInfo.getLayerObject().then(f.hitch(this,function(a){a.on("edits-complete",f.hitch(this,function(){this.layerDataChanged=!0}))})));"dropdown"===this.selectUI?(r.setStyle(this.checkedBtn,"display","block"),this._multipleSelectProviderEventHandler=
f.hitch(this,this._multipleSelectProviderEvent),document.addEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0})):this.listSelect.placeAt(this.listContent)},_resetPromptLabel:function(a){this.promptLabel.innerHTML=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+(a?this.nls.noFilterValueTip+" ":"")},filterExpr:null,_resetPageControlNewExpr:function(){var a=this.getDropdownFilterExpr();return this.filterExpr!==a?(this.pageControlForQuery.reset(),this.filterExpr=
this.pageControlForQuery.cascadeFilterExprs=a,!0):!1},_multipleSelectProviderEvent:function(a){a=a.target||a.srcElement;if(this.cbxPopup&&this.cbxPopup.domNode){if(r.isDescendant(a,this.cbxPopup.domNode)||r.isDescendant(a,this.checkedBtn))return;"block"===r.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide())}else!r.isDescendant(a,this.checkedBtn)&&this.isPopupLoading&&(this.isLoadDataAdvanced=!0);this.msgDiv&&r.setStyle(this.msgDiv,"display","none")},
_checkedBtnEvent:function(){this._showPopup()},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},_isRestSelectList:!1,_resetListSelectState:function(a){"block"===r.getStyle(a.listSelect.searchKeyInput,"display")&&("multipleDynamic"===this.controlType&&this.listSelect.showAllList(),a.listSelect.listContainer.scrollTop=0,a.listSelect.queryState=!0,a.listSelect.valueInput.set("value",""),this._isRestSelectList=!0)},_createTarget:function(a){this._checkedChanged(1,
a);this.cbxPopup&&("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this.cbxPopup.domNode&&(this._resetListSelectState(this),this.cbxPopup.close())},_destoryTarget:function(a){this._checkedChanged(-1,a)},_checkedChanged:function(a,b){if("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)b&&(a=parseInt(this.checkedNum.innerText,10)+a,this.checkedNum.innerText=0<a?a:0);else if("uniqueDynamic"===this.controlType||
"uniquePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)"uniqueDynamic"===this.controlType&&(b===this.emptyStr?r.addClass(this.checkedNameDiv,"checkedEmptyNameDiv"):r.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv")),a=b?b:this._getCheckedNameDivText(),this._setCheckedNameDivText(a);this.listSelect.set("displayedValue","12345678");this.emit("change")},_clearCheckedTxt:function(){this.runtime&&"dropdown"===this.selectUI&&("multipleDynamic"===this.controlType||"multiplePredefined"===
this.controlType?this.checkedNum.textContent?this.checkedNum.textContent=0:this.checkedNum.innerText=0:"uniqueDynamic"!==this.controlType&&"uniquePredefined"!==this.controlType||this._setCheckedNameDivText(""),this.valueList=[],this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[],this.listSelect.valueInput.set("value",""),"multipleDynamic"===this.controlType&&this.listSelect.showAllList());this.listSelect.set("displayedValue","12345678");this.emit("change")},_layerDataChangedCallback:function(){this.layerDataChanged&&
(this.pageControlForQuery.reset(),this.listSelect.ifFristPage=!0,this.layerDataChanged=!1)},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(f.hitch(this,function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.ifFristPage&&this._checkIfNoData(a)||(this.listSelect.setCBXData(a,!0,this.listSelect.ifFristPage),this._hideLoadingIcon())}),
f.hitch(this,function(a){console.log(a);this.listSelect.queryState=!1;this._hideLoadingIcon()})))},_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery._searchKey(a).then(f.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._resetPopupStyles(!a.length);this._hideLoadingIcon()}),f.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a,b){if(this.listSelect){"uniqueDynamic"===
this.controlType&&this._isRestSelectList&&(this.listSelect.keyQueryMode=!1,this._isRestSelectList=this.listSelect.cacheQueryMode=!1);this._showLoadingIcon();var c=this.pageControlForQuery._searchKeyLocal(a);""===a&&0===c.length?(this.layerDataChanged=!0,this._layerDataChangedCallback(),this._addNextPage()):this.listSelect.setCBXContentBySearch(c,b);this._resetPopupStyles(!0);this._hideLoadingIcon()}},queryByPage:function(){var a=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(f.hitch(this,
function(b){a.resolve(b)}),f.hitch(this,function(b){console.log(b);a.reject(b)}))},getCheckedList:function(a){this.listSelect.checkedList=[];this.listSelect.checkedLabelList=[];m.forEach(a,f.hitch(this,function(a){var b;f.isObject(a)?a.isChecked&&(b=a.value):b=a;if(b||0===b)b=this.isNumberField?parseFloat(b):b,this.listSelect.checkedList.push(b)}))},getCheckedStrsList:function(a){var b=[];m.forEach(a,f.hitch(this,function(a){var c;f.isObject(a)?a.isChecked&&(c=a[this.disPlayLabel]):c=a;(c||0===c)&&
b.push(c)}));return b},showContent:function(a){var b=new t;this.getCheckedList(this.valueList);this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="value";var c;if("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)return this.runtime&&(this.listSelect.disPlayLabel="alias"),c=this._checkIfNoData(this.valueList),c||(this.listSelect.setCBXData(this.valueList,!0,a),this.listSelect._updateCheckedLabelListFromCheckedList()),this._hideLoadingIcon(),b.resolve(c),b;if(this.staticValues)return c=
this._setValueForStaticValues(this.staticValues),b.resolve(c),b;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return c=this._setValueForStaticValues(this.codedValues),b.resolve(c),b;this._showLoadingIcon();if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(a).then(f.hitch(this,function(d){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;
d=this._handleCodedValue(d);(c=this._checkIfNoData(d))||this.listSelect.setCBXData(d,!0,a);this._hideLoadingIcon();b.resolve(c)}),f.hitch(this,function(a){console.log(a);this._hideLoadingIcon();b.reject(a)}));return b},_handleCodedValue:function(a){this.listSelect.disPlayLabel="label";if(!this.codedValues)return this.listSelect._updateCheckedLabelListFromCheckedList(),a;this.pageControlForQuery._codedvalueCache=a;"uniqueDynamic"===this.controlType&&this._setCheckedName(this.listSelect.checkedList?
this.listSelect.checkedList[0]:"",a);this.listSelect._updateCheckedLabelList(this.codedValues);return a},_showDropdown:function(a){var b=r.position(a.target),c;c=this.isInFilterSet?this.domNode.parentNode.parentNode.parentNode:this.domNode.parentNode;var d=r.position(c);if("none"!==r.getStyle(this.listContentPopup,"display"))r.setStyle(this.listContentPopup,"display","none");else{m.forEach(g(".value-type-popup",c),function(a){r.setStyle(a,"display","none")},this);r.place(this.listContentPopup,c);
var e;e=r.hasClass(g(".desktop-add-section",c.parentNode)[0],"hidden")?-5:30;e=b.y-d.y-c.parentNode.scrollTop+e;e+170>c.parentNode.scrollHeight&&(e=c.parentNode.scrollHeight-170-40);window.isRTL?b=b.x-d.x+20:(b=b.x-d.x-100-90,b+150>c.clientWidth&&(b=c.clientWidth-150));r.setStyle(this.listContentPopup,{display:"block",left:b+"px",top:e+"px"});a.stopPropagation()}},_calculatePopup:function(){var a=r.position(this.domNode.parentNode),b=r.position(document.body).h,c=a.y+30;b-c<this._cbxHeight&&(c=a.y-
this._cbxHeight);return{left:a.x,top:c}},_cbxWidth:210,_cbxHeight:362,popupIsNoData:!1,isPopupLoading:!1,isLoadDataAdvanced:!1,_showPopup:function(){if(!this.isPopupLoading)if(this.cbxPopup&&this.cbxPopup.domNode&&"block"===r.getStyle(this.cbxPopup.domNode,"display"))this._resetListSelectState(this),this.cbxPopup.hide();else{var a=this._resetPageControlNewExpr();a&&this.cbxPopup&&(this.cbxPopup.close(),this._clearCheckedTxt());if(a||this.cbxPopup){var b=this._calculatePopup();this._cbxWidth=r.getStyle(this.checkedBtn,
"width");if(!a&&this.cbxPopup&&this.cbxPopup.domNode&&!this.layerDataChanged)this.popupIsNoData?this._checkIfNoData([]):(this.cbxPopup.show(),this._resetPopupStyles(),this.listSelect.valueInput&&"block"===r.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus(),this.listSelect.queryState=!1);else{this.isPopupLoading=!0;this.isLoadDataAdvanced||this._showDataQueryingIcon();var c=this.showContent(!0);c.then(f.hitch(this,function(a){this.isPopupLoading=
!1;this._hideDataQueryingIcon();(this.popupIsNoData=a)?this._clearCheckedTxt():(this.cbxPopup=new u({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:b.left,top:b.top},hiddenAfterInit:this.isLoadDataAdvanced,useFocusLogic:!1,onClose:f.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"}),
this.cbxPopup.on("popupHasInitedSuccessfully",f.hitch(this,function(a){this._resetPopupStyles(!1,!0);a||(this.listSelect.valueInput&&"block"===r.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus())})));this.isLoadDataAdvanced&&(this.isLoadDataAdvanced=!1)}),f.hitch(this,function(a){this.isPopupLoading=!1;console.log(a);c.reject(a)}))}}else r.setStyle(this.msgDiv,"display","block")}},_itemContainerH:300,_resetPopupStyles:function(a,
b){var c=this._itemContainerH,d=r.getStyle(this.listSelect.listContent,"height");0===d&&this.cbxPopup&&this.cbxPopup.domNode&&"none"===r.getStyle(this.cbxPopup.domNode,"display")&&(d=this.popupInitHeight);b&&(this.popupInitHeight=d);!a||this.listSelect.codedValues||this.pageControlForQuery._isUniqueValueCacheFinish||(d+=25);this.pageControlForQuery._isUniqueValueCacheFinish&&"block"===r.getStyle(this.listSelect.noDataTips,"display")&&(d+=30);c=d<c?d:c;r.setStyle(this.listSelect.listContainer,"height",
c+"px");r.setStyle(this.listSelect.selectedContainer,"height",c+30+"px");"multipleDynamic"===this.controlType?c=c+30+30:"uniqueDynamic"===this.controlType&&(c+=30);this._cbxHeight=c+10;a=this._calculatePopup();this._cbxWidth=r.getStyle(this.checkedBtn,"width");this.cbxPopup.setCustomPosition(a.left,a.top,this._cbxWidth,this._cbxHeight);this._resetItemWidth()},_resetItemWidth:function(){var a=this._cbxWidth-20;"uniqueDynamic"===this.controlType||this.runtime&&"uniquePredefined"===this.controlType&&
"dropdown"===this.selectUI||!this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)||(a=!this.runtime||"dropdown"===this.selectUI||"uniquePredefined"!==this.controlType&&"multiplePredefined"!==this.controlType?a-30:a-15);window.isRTL&&(a-=3);this.listSelect._itemLabelW=a;g(".item .label",this.listSelect.listContent).style({"max-width":a+"px"})},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;this.listSelect._updateCheckedLabelList(this.codedValues);
if(a){this.pageControlForQuery._codedvalueCache=a;var b=this._checkIfNoData(a);b||(this.listSelect.disPlayLabel="label",this.listSelect.setCBXData(a,!0,!0));return b}return!1},_checkIfNoData:function(a){if(this.runtime&&"dropdown"===this.selectUI){if(a&&0<a.length)return this._resetPromptLabel(!1),!1;this.msgDiv?r.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),r.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,
this.checkedBtn.parentNode.appendChild(this.msgDiv));this._resetPromptLabel(!0);return!0}this._resetPromptLabel(!1);return!1},getDijits:function(){return[this.listSelect]},_setCheckedName:function(a,b){var c=a;if(b=b?b:this.codedValues){for(var d=!1,e=0;e<b.length;e++){var f=b[e];if(f.value===a){c=f.label;d=!0;break}}d||(c=this.emptyStr,this.valueList=[],this.listSelect&&(this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[]))}else void 0===a?(c=this.emptyStr,r.addClass(this.checkedNameDiv,
"checkedEmptyNameDiv")):r.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv");this._setCheckedNameDivText(c)},setValueObject:function(a){a.value=a.value||0===a.value?a.value:[];this.valueList=a.value;this.enableEmpty=a.enableEmpty;this.listSelect.enableEmpty=a.enableEmpty;if("multipleDynamic"===this.controlType)this.checkedNum.innerText=this.valueList.length,this.isLoadDataAdvanced&&this._checkedBtnEvent();else if("uniqueDynamic"===this.controlType){a=this.valueList;f.isArray(a)&&0===a.length&&
(a=void 0);this._setCheckedName(a);this.valueList=[this.valueList];if(a&&"esriFieldTypeDate"===this.fieldInfo.type){var b=h.getDateByDateTimeStrAndFormat(a,this.fieldPopupInfo);a=h.getDateTimeStrByFieldInfo(b,this.fieldPopupInfo);b=h.localizeDateByFieldInfo(b,this.fieldPopupInfo);this._setCheckedName(b);this.valueList=[a]}this.isLoadDataAdvanced&&this._checkedBtnEvent()}else this.emptyStr=a.emptyLabel?a.emptyLabel:this.emptyStr,this.listSelect.emptyStr=this.emptyStr,this.runtime&&"dropdown"===this.selectUI&&
(b=[],"value"===this.disPlayLabel?(this.getCheckedList(this.valueList),b=this.listSelect.checkedList):b=this.getCheckedStrsList(this.valueList),"uniquePredefined"===this.controlType?0<this.listSelect.checkedList.length?this._setCheckedNameDivText(b[0]):this._setCheckedNameDivText(a.enableEmpty?this.emptyStr:""):this.checkedNum.innerText=b.length),this.showContent(!0),setTimeout(f.hitch(this,function(){this._cbxWidth=r.getStyle(this.listSelect.listContent,"width");this._resetItemWidth()}),50)},_getCheckedNameDivText:function(){return this.checkedNameDiv.textContent||
this.checkedNameDiv.innerText||""},_setCheckedNameDivText:function(a){this.isNumberField&&"number"===typeof a&&(a=h._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,[a])[0].label);this.checkedNameDiv.textContent?this.checkedNameDiv.textContent=a:this.checkedNameDiv.innerText=a},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var a=null,a="multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?[]:"string"===
this.shortType?"":null;return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},getValueObject:function(){if(this.isValidValue()){var a;a="multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.listSelect.getListCheckedValues():this.listSelect.getListValues();"uniqueDynamic"===this.controlType&&(a=f.isArray(a)?a[0]:a);return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},setRequired:function(a){this.listSelect.set("required",a)},_showDataQueryingIcon:function(){this._validatingNode||
(this._validatingNode=r.create("div",{"class":"jimu-circle-loading"},this.checkedBtn));r.setStyle(this._validatingNode,"display","block")},_hideDataQueryingIcon:function(){this._validatingNode&&r.setStyle(this._validatingNode,"display","none")},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&r.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&r.removeClass(this.listSelect.listContainer,
"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0});this.cbxPopup&&this.cbxPopup.domNode&&(this.cbxPopup.onClose=f.hitch(this,function(){return!0}),this.cbxPopup.close());this.inherited(arguments)},destroyProvider:function(){this.listSelect&&this.listSelect.destroy();this.listSelect=null}})})},"jimu/dijit/_filter/AdvancedListValueSelect":function(){define("dojo/_base/lang dojo/Evented dojo/_base/html dojo/_base/declare dijit/_WidgetBase dojo/on dojo/keys dojo/query dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueSelect.html jimu/utils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c){return q([e,g,p,f],{templateString:d,selectType:null,dataList:[],checkedList:[],checkedLabelList:[],_itemLabelW:215,ifFristPage:!0,queryState:!0,isCacheFinish:!1,keyQueryMode:!1,cacheQueryMode:!1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.jimuCommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.noDataNls=window.apiNls.widgets.FeatureTable.noData},postCreate:function(){this.inherited(arguments);this.inputType="unique"===
this.selectType?"radio":"checkbox";if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)k.addClass(this.listContainer,"items-setting-dropdown-content"),this.searchKeyInput.style.display="block";"uniqueDynamic"===this.controlType&&k.addClass(this.listContainer,"items_content_no_selected_toggle");this.runtime?(k.addClass(this.listContainer,"items-widget-content"),"dropdown"!==this.selectUI&&(k.addClass(this.listContainer,"items-widget-expaned-content"),k.addClass(this.listContent,
"jimu-multiple-items-expanded-list"),k.setAttr(this.listContent,"aria-label",this.label),k.addClass(this.listContent,c.lastFocusNodeClassInDOM),k.removeAttr(this.multipleSelect,"tabindex"))):(k.addClass(this.listContainer,"items-setting-popup-content"),this.searchKeyInput.style.display="block");this.runtime||"predefined"!==this.controlType||(k.addClass(this.listContainer,"items-setting-dropdown-content"),k.addClass(this.listContainer,"items_content_no_selected_toggle"),this.searchKeyInput.style.display=
"block");this._addCBXClickEvent();this._addCBXHoverEvent();this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel="alias");"multipleDynamic"===this.controlType&&(this.selectedToggleDiv.style.display="block",this.selectedToggle=l(".showAllIcon",this.selectedToggleDiv)[0],this.own(r(this.selectedToggleDiv,"click",t.hitch(this,"_toggleFilter"))),this.own(r(this.selectedToggleDiv,"keydown",t.hitch(this,function(c){c.keyCode===
m.ENTER&&this._toggleFilter(c)}))),this._addSelectedContainerEvent());this._addKeyDownEvent()},_addKeyDownEvent:function(){this.own(r(this.multipleSelect,"keydown",t.hitch(this,function(c){var b=c.which||c.keyCode,d=c.target;if(b===m.ESCAPE||"dropdown"===this.selectUI&&("INPUT"===d.tagName&&c.shiftKey&&b===m.TAB||("multipleDynamic"===this.controlType&&k.hasClass(d,"clearAllSelectedIcon")||"multipleDynamic"!==this.controlType&&k.hasClass(d,"item"))&&!c.shiftKey&&b===m.TAB))c.preventDefault(),this.currentHoverItem&&
(k.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed")})));this.own(r(this.listContent,"focus",t.hitch(this,function(){c.isInNavMode()&&(this.currentItem=(this.currentItem=this.getCurrentItem())?this.currentItem:this._getCheckInputItems()[0],this.currentHoverItem=this.currentItem.parentNode,"dropdown"===this.selectUI?this.currentHoverItem.focus():this._isFocusFirstItem=!0,k.addClass(this.currentHoverItem,"active"),setTimeout(t.hitch(this,
function(){k.addClass(this.currentHoverItem,"active")}),10))})));this.own(r(this.listContent,"blur",t.hitch(this,function(){this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active")})));this.own(r(this.showAllIconBtn,"keydown",t.hitch(this,function(c){c.shiftKey&&c.keyCode===m.TAB&&(c.preventDefault(),"block"===k.getStyle(this.selectedContainer,"display")?this.selectedListContent.focus():this.listContent.focus())})));this.own(r(this.listContent,"keydown",t.hitch(this,function(d){if(c.isInNavMode()){var b=
d.which||d.keyCode;-1<[m.SPACE,m.UP_ARROW,m.DOWN_ARROW].indexOf(b)&&d.preventDefault();if(b===m.TAB&&k.hasClass(d.target,"item"))d.preventDefault(),this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active"),"dropdown"===this.selectUI?(this.currentHoverItem=null,d.shiftKey?"block"===this.searchKeyInput.style.display?this.valueInput.focus():this.emit("advancedListValueSelect_itemsConfirmed"):"multipleDynamic"===this.controlType&&this.showAllIconBtn.focus()):this.listContent.focus();else if(b===
m.SPACE||b===m.ENTER)d=l(".checkInput",this.currentHoverItem)[0],b=l(".label",this.currentHoverItem)[0],this._setCBXChecked(d,this._getNodeText(b)),"radio"===this.inputType&&("dropdown"===this.selectUI&&(k.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed"));else if(b===m.UP_ARROW||b===m.DOWN_ARROW)if("dropdown"!==this.selectUI&&this._isFocusFirstItem)this._isFocusFirstItem=!1,this.currentHoverItem.focus(),setTimeout(t.hitch(this,
function(){k.addClass(this.currentHoverItem,"active")}),5);else{d=(d=b===m.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?d:this.currentHoverItem;if(this.listContainer.scrollHeight>this.listContainer.clientHeight){var b=this.listContainer.clientHeight+this.listContainer.scrollTop,e=d.offsetTop+d.offsetHeight,e=e-30;e>b?this.listContainer.scrollTop=e-this.listContainer.clientHeight:d.offsetTop<this.listContainer.scrollTop+30&&(this.listContainer.scrollTop=d.offsetTop-
30)}k.removeClass(this.currentHoverItem,"active");this.currentHoverItem=d;k.addClass(this.currentHoverItem,"active");this.currentHoverItem.focus()}}})));this.own(r(this.selectedListContent,"focus",t.hitch(this,function(){if(c.isInNavMode()){var d=l(".item",this.selectedListContent);d.length&&(this.currentHoverItem=d[0],this.currentHoverItem.focus(),k.addClass(this.currentHoverItem,"active"),setTimeout(t.hitch(this,function(){k.addClass(this.currentHoverItem,"active")}),50))}})));this.own(r(this.selectedListContent,
"blur",t.hitch(this,function(){c.isInNavMode()&&this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active")})));this.own(r(this.selectedContainer,"keydown",t.hitch(this,function(d){if(c.isInNavMode()){var b=d.which||d.keyCode;if(b===m.TAB)d.preventDefault(),this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active"),this.showAllIconBtn.focus();else if(0!==l(".item",this.selectedListContent).length)if(-1<[m.SPACE,m.UP_ARROW,m.DOWN_ARROW].indexOf(b)&&d.preventDefault(),b===m.SPACE||
b===m.ENTER)d=l(".checkInput",this.currentHoverItem)[0],b=l(".label",this.currentHoverItem)[0],this._setCBXSelectedChecked(d,this._getNodeText(b));else if(b===m.UP_ARROW||b===m.DOWN_ARROW)d=(d=b===m.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?d:this.currentHoverItem,this.selectedContainer.scrollHeight>this.selectedContainer.clientHeight&&(b=d.offsetTop+d.offsetHeight,b>this.selectedContainer.clientHeight+this.selectedContainer.scrollTop?this.selectedContainer.scrollTop=
b-this.selectedContainer.clientHeight:d.offsetTop<this.selectedContainer.scrollTop&&(this.selectedContainer.scrollTop=d.offsetTop)),k.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=d,k.addClass(this.currentHoverItem,"active"),this.currentHoverItem.focus()}})))},_toggleFilter:function(c){var b=c.target;k.hasClass(b,"clearAllSelectedIcon")?(this._clearAllSelected(),this.currentHoverItem=this.currentItem=null):k.hasClass(b,"iconHover")||k.hasClass(b,"selectedToggleDiv")||(k.hasClass(b,
"showAllIcon")?(this.selectedContainer.style.display="none",this.listContent.focus()):(this._initSelectedContainerItems(),this.selectedContainer.style.display="block",this.selectedListContent.focus()),k.removeClass(this.selectedToggle,"iconHover"),this.selectedToggle=b,k.addClass(this.selectedToggle,"iconHover"),c.stopPropagation())},showAllList:function(){k.hasClass(this.selectedToggle,"showSelectedIcon")&&k.hasClass(this.selectedToggle,"iconHover")&&(k.removeClass(this.selectedToggle,"iconHover"),
this.selectedToggle=l(".showAllIcon",this.selectedToggleDiv)[0],k.addClass(this.selectedToggle,"iconHover"),k.setStyle(this.selectedContainer,"display","none"))},_clearAllSelected:function(){var c;c=k.hasClass(this.selectedToggle,"showAllIcon")?this.listContainer:this.selectedListContent;c=l(".item .checkInput.checked",c);for(var b=0;b<c.length;b++)c[b].click()},_initSelectedContainerItems:function(){for(var c=this.selectedListContent.innerHTML="",b=this.runtime?" labelRuntime":"",d=0;d<this.checkedList.length;d++)var a=
this.checkedList[d],e="value"===this.disPlayLabel?a:this.checkedLabelList[d],a='data\x3d"'+(this.isNumberField?a:encodeURIComponent(a))+'"',c=c+('\x3cdiv role\x3d"option" class\x3d"item" tabindex\x3d"-1" aria-selected\x3d"true" aria-checked\x3d"true"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+' checked" '+a+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label jimu-ellipsis-Blanks'+b+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+e+"\x3c/div\x3e\x3c/div\x3e");this.selectedListContent.innerHTML=c},_addSelectedContainerEvent:function(){this.own(r(this.selectedListContent,
"click",t.hitch(this,function(c){var b=c.target,d;if(k.hasClass(b,"item"))d=b.firstElementChild,b=b.firstElementChild.nextSibling;else if(k.hasClass(b,"checkInput"))d=b,b=b.nextSibling;else if(k.hasClass(b,"label"))d=b.previousSibling;else{c.stopPropagation();return}this._setCBXSelectedChecked(d,this._getNodeText(b));c.stopPropagation()})))},_setCBXSelectedChecked:function(c,b){var d=b;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)d=decodeURIComponent(k.getAttr(c,"data"));k.hasClass(c,
"checked")?(k.setAttr(c.parentNode,"aria-checked","false"),"radio"!==this.inputType&&(k.removeClass(c,"checked"),this._updateCheckedList("remove",d,b),this.checkCBXItems(),this.emit("advancedListValueSelect_itemUnChecked",b))):(k.setAttr(c.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),k.removeClass(this.currentItem,"checked")),k.addClass(c,"checked"),this._updateCheckedList("add",d,b),this.checkCBXItems(),
this.emit("advancedListValueSelect_itemChecked",b))},_getNodeText:function(c){return c.textContent||c.innerText||""},_updateCheckedList:function(c,b,d){b!==this.emptyStr&&(b=this.isNumberField?parseFloat(b):b);if("remove"===c)for(var a in this.checkedList){if(this.checkedList[a]===b||this.isNumberField&&isNaN(this.checkedList[a])&&isNaN(b)){this.checkedList.splice(a,1);this.checkedLabelList.splice(a,1);break}}else"radio"===this.inputType?(this.checkedList=[b],this.checkedLabelList=[d]):(this.checkedList.push(b),
this.checkedLabelList.push(d));this._updateListContentLabel()},_updateListContentLabel:function(){if("dropdown"!==this.selectUI&&this.runtime){var c=this.checkedLabelList.join(" "),c=c?c:this.emptyStr;k.setAttr(this.listContent,"aria-label",this.label+c)}},_updateCheckedLabelList:function(c){this.checkedLabelList=[];for(var b=0;b<this.checkedList.length;b++)for(var d=0;d<c.length;d++)this.checkedList[b]===c[d].value&&this.checkedLabelList.push(c[d].label)},_updateCheckedLabelListFromCheckedList:function(){for(var c=
0;c<this.checkedList.length;c++)this.checkedLabelList.push(this.checkedList[c]+"");this._updateListContentLabel()},_createTarget:function(c){c=this._getNodeText(c.target).split(": ")[1];this.emit("advancedListValueSelect_itemChecked",c)},_deleteCBXItem:function(){},_getCheckInputItems:function(){return l(".item .checkInput",this.listContent)},getListCheckedValuesOrigin:function(){for(var c=[],b=this._getCheckInputItems(),d=0;d<b.length;d++){var a=b[d],e=this._getNodeText(a.nextSibling);k.hasClass(a,
"checked")&&c.push(e)}return c},getListCheckedValues:function(){for(var c=[],b=t.clone(this.checkedList),d=0;d<b.length;d++){var a=b[d],a=this.isNumberField?parseFloat(a):a;c.push(a)}return c},getListValues:function(){var c=[],b=this._getCheckInputItems();if(0===b.length)return this.dataList;for(var d=0;d<b.length;d++){var a=b[d],e=this._getNodeText(a.nextSibling);if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)e=decodeURIComponent(k.getAttr(a,"data"));e=this.isNumberField?parseFloat(e):
e;e={value:e,isChecked:!1};k.hasClass(a,"checked")&&(e.isChecked=!0);c.push(e)}return c},getIfValueExist:function(c){for(var b=this._getCheckInputItems(),d=0;d<b.length;d++){var a=this._getNodeText(b[d].nextSibling);if(c===a)return!0}return!1},getCurrentItem:function(){for(var c=this._getCheckInputItems(),b=0;b<c.length;b++){var d=c[b];if(k.hasClass(d,"checked"))return d}return null},checkCBXItems:function(c){c=c?"":this.valueInput.get("value");this.valueInput.set("value",c);c=l(".item .label",this.listContent);
for(var b=0;b<c.length;b++){var d=c[b],a="value"===this.disPlayLabel?this._getNodeText(d):decodeURIComponent(k.getAttr(d.previousSibling,"data")),a=this.isNumberField?parseFloat(a):a;0<=this.checkedList.indexOf(a)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(a))?k.addClass(d.previousSibling,"checked"):k.removeClass(d.previousSibling,"checked")}},reset:function(){this.listContent.innerHTML=""},setCBXData:function(c,b,d,a){a||(this.queryState=!1);c=c?c:[];if(this.listContent){k.setStyle(this.noDataTips,
"display","none");var e=0,f="radio"===this.inputType?" labelBig":"",g=this.runtime?" labelRuntime":"";a=this.listContent.innerHTML;if(d){a=this.listContent.innerHTML="";if("uniquePredefined"===this.controlType&&this.enableEmpty||"uniqueDynamic"===this.controlType&&!this.keyQueryMode)d=a="",this.checkedList[0]===this.emptyStr&&(a=" checked",d=" active",e=1),0===this.checkedList.length&&(a=" checked",this.currentItem=!0,e=1),a='\x3cdiv role\x3d"option" class\x3d"item emptyItem'+d+'" aria-selected\x3d"true" tabindex\x3d"-1" '+
(a?'aria-checked\x3d"true"':'aria-checked\x3d"false"')+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+a+'" '+("data\x3d'"+this.emptyStr+"'")+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+f+" jimu-ellipsis-Blanks"+g+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+this.emptyStr+"\x3c/div\x3e\x3c/div\x3e";this.listContainer.scrollTop=0}if(0===c.length)return c=this.listContent.innerHTML.replace(/(^\s*)|(\s*$)/g,""),""!==c||this.cacheQueryMode&&!this.isCacheFinish||k.setStyle(this.noDataTips,"display",
"block"),""===c&&(this.listContent.innerHTML=a),this.listContent;d="";for(var h=0;h<c.length;h++){var l=c[h],n="";if(b)if(this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType))l.isChecked&&(n=" checked",this.currentItem=!0,e++);else if(0<=this.checkedList.indexOf(l.value)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(l.value)))n=" checked",this.currentItem=!0,e++;var m="",m=n?'aria-checked\x3d"true"':'aria-checked\x3d"false"',p='data\x3d"'+(this.isNumberField?
l.value:encodeURIComponent(l.value))+'"';d+='\x3cdiv class\x3d"item" role\x3d"option" tabindex\x3d"-1" aria-selected\x3d"true" '+m+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+n+'" '+p+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+f+" jimu-ellipsis-Blanks"+g+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+l[this.disPlayLabel]+"\x3c/div\x3e\x3c/div\x3e"}c=this.checkedList.length-e;if(this.runtime&&0<c)for(b=0;b<c;b++)this.emit("advancedListValueSelect_itemUnChecked","");this.listContent.innerHTML=
a+d;return this.listContent}},setCBXContentBySearch:function(c,b){0===c.length?this.setCBXData([],!1,!0,b):this.setCBXData(c,!0,!0,b)},_onSearchKeyChange:function(){var c=this.valueInput.get("value");this.searchName=c;this.listContainer.scrollTop=0;this.reset();this.cacheQueryMode=this.keyQueryMode=this.ifFristPage=!0;this.emit("advancedListValueSelect_searchKeyLocal",c);this.codedValues||(this.isCacheFinish||k.setStyle(this.loadMoreDataBtn,"display","block"),0===c.length&&(this.queryState=this.cacheQueryMode=
this.keyQueryMode=!1,k.setStyle(this.loadMoreDataBtn,"display","none")))},_loadMoreDataFromServer:function(){this.keyQueryMode=this.ifFristPage=!0;this.cacheQueryMode=!1;this.queryState=!0;k.setStyle(this.loadMoreDataBtn,"display","none");var c=this.valueInput.get("value");this.searchName=c;this.listContainer.scrollTop=0;"multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.emit("advancedListValueSelect_searchKey",c):this.runtime||this.emit("advancedListValueSelect_searchKey",
c)},currentHoverItem:null,_addCBXHoverEvent:function(){this.own(r(this.listContent,"mouseover",t.hitch(this,function(d){d=d.target||d.srcElement;if(d=k.hasClass(d,"item")?d:c.getAncestorDom(d,function(b){return k.hasClass(b,"item")},3))this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active"),k.addClass(d,"active"),this.currentHoverItem=d})));this.own(r(this.listContent,"mouseout",t.hitch(this,function(){this.currentHoverItem&&k.removeClass(this.currentHoverItem,"active");this.currentHoverItem=
null})))},_addCBXClickEvent:function(){this.own(r(this.valueInput,"change",t.hitch(this,function(){this._onSearchKeyChange()})));this.own(r(this.loadMoreDataBtn,"click",t.hitch(this,function(){this._loadMoreDataFromServer()})));this.own(r(this.listContainer,"scroll",t.hitch(this,this.dropDownScroll)));this.own(r(this.searchKeyInput,"click",t.hitch(this,function(c){c.stopPropagation()})));this.own(r(this.listContainer,"click",t.hitch(this,function(c){var b=c.target,d;if(k.hasClass(b,"item"))d=b.firstElementChild,
b=b.firstElementChild.nextSibling;else if(k.hasClass(b,"checkInput"))d=b,b=b.nextSibling;else if(k.hasClass(b,"label"))d=b.previousSibling;else{c.stopPropagation();return}this._setCBXChecked(d,this._getNodeText(b));c.stopPropagation()})))},scrollDiff:100,dropDownScroll:function(c){this.runtime&&("uniquePredefined"===this.controlType||"multiplePredefined"===this.controlType)||this.cacheQueryMode||this.codedValues||(this.queryState?this.listContainer.scrollTop=this.containerScrollTop:(c=c.target,c.scrollHeight-
c.clientHeight-c.scrollTop<=this.scrollDiff&&!this.queryState&&(this.containerScrollTop=this.listContainer.scrollTop,this.queryState=!0,this.ifFristPage=!1,this.emit("advancedListValueSelect_addNextPage"))))},_setCBXChecked:function(c,b){var d=b;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)d=decodeURIComponent(k.getAttr(c,"data"));k.hasClass(c,"checked")?(k.setAttr(c.parentNode,"aria-checked","false"),"radio"===this.inputType?this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",
b):this.emit("advancedListValueSelect_itemCheckedForPredefined",d,b):(k.removeClass(c,"checked"),this._updateCheckedList("remove",d,b),this.emit("advancedListValueSelect_itemUnChecked",b))):(k.setAttr(c.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),this.currentItem&&(k.removeClass(this.currentItem,"checked"),k.setAttr(this.currentItem.parentNode,"aria-checked","false"))),k.addClass(c,"checked"),this.currentItem=
c,this._updateCheckedList("add",d,b),this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",b):this.emit("advancedListValueSelect_itemCheckedForPredefined",d,b))},initDoms:function(c,b){this.setCBXData(c,b)},getData:function(){},refreshData:function(){this.checkCBXItems()},validate:function(){var c=this.checkedList.length?"12345678":null;1===this.checkedList.length&&this.checkedList[0]===this.emptyStr&&(c=null);if(this.isNumberField)for(var b=0;b<this.checkedList.length;b++){var d=
this.checkedList[b];if(d!==this.emptyStr&&isNaN(d)){c=null;break}}this.set("DisplayedValue",c);return!0},setRequired:function(c){this.mutiValuesSelect.set("required",c)},destroy:function(){k.destroy(this.domNode);this.inherited(arguments)}})})},"jimu/dijit/_filter/pageControlForQuery":function(){define("dojo/Deferred esri/tasks/query dojo/_base/array dojo/_base/lang dojo/_base/declare jimu/Query jimu/LayerStructure dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./pageControlForQuery.html jimu/utils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c){return e([l,g,p],{templateString:d,layerUrl:null,fieldInfo:null,fieldPopupInfo:null,spatialReference:null,layerDefinition:null,isNumberField:!1,showNullValues:!1,_isUniqueValueCacheFinish:!1,_uniqueValueCache:{},_uniqueValueCacheForOtherTypes:{},_codedvalueCache:[],cascadeFilterExprs:"1\x3d1",numbericFieldLength:{esriFieldTypeOID:32,esriFieldTypeSmallInteger:16,esriFieldTypeInteger:32,esriFieldTypeSingle:128,esriFieldTypeDouble:1024},pageIndex:1,pageSize:1E3,postCreate:function(){this.inherited(arguments);
this.spatialReference=m.getInstance().map.spatialReference;this.reset();this.queryType=r.getQueryType(this.layerDefinition);this.isNumberField&&(this.fieldLength=this.numbericFieldLength[this.fieldInfo.type])},reset:function(){this.pageIndex=1;this._isUniqueValueCacheFinish=!1;this._uniqueValueCache={};this._uniqueValueCacheForOtherTypes={};this._codedvalueCache=[]},isKeyQueryLoader:!1,_searchKey:function(c){var b=new t,d=new f,a="",a=this.isNumberField?"CAST("+this.fieldInfo.name+" AS CHAR("+this.fieldLength+
")) LIKE '%"+c+"%'":this.fieldInfo.name+" LIKE '%"+c+"%'";d.where="(("+this.cascadeFilterExprs+") AND ("+a+"))";d.geometry=null;d.outSpatialReference=this.spatialReference;d.outFields=[this.fieldInfo.name];d.returnDistinctValues=!0;d.returnGeometry=!1;d.orderByFields=d.outFields;this.layerLoaderForKey=new r({url:this.layerUrl,query:d,pageSize:this.pageSize});this.isKeyQueryLoader=!0;this._uniqueValueCacheForOtherTypes={};this.queryByPage(!0).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,
function(a){b.reject("reject:"+a)}));return b},_searchKeyLocal:function(c){c=c.toUpperCase();this.isKeyQueryLoader=!1;var b=[],d=this._codedvalueCache,a;if(0<d.length)for(var e=0;e<d.length;e++)a=d[e],a.label&&0<=a.label.toString().toUpperCase().indexOf(c)&&b.push(a);else for(e in d=this._uniqueValueCache,d)for(var f=d[e],g=0;g<f.length;g++){a=f[g];var k=a.label;k&&0<=k.toString().toUpperCase().indexOf(c)&&b.push(a)}return b},queryByPage:function(c){var b=new t;this.layerLoader&&this.layerLoader.query.where!==
this.cascadeFilterExprs&&(this.layerLoader=null,this.isKeyQueryLoader=!1,this.reset());if(!this.layerLoader){var d=new f;d.where=this.cascadeFilterExprs;d.geometry=null;d.outSpatialReference=this.spatialReference;d.outFields=[this.fieldInfo.name];d.returnDistinctValues=!0;d.returnGeometry=!1;d.orderByFields=d.outFields;this.layerLoader=new r({url:this.layerUrl,query:d,pageSize:this.pageSize})}c&&(this.pageIndex=1);c=[];if(this.isKeyQueryLoader){if(this._uniqueValueCacheForOtherTypes[this.pageIndex])return c=
this._resolveValueLabelsFromCache(this._uniqueValueCacheForOtherTypes),b.resolve(c),b;c=this.layerLoaderForKey}else{if(this._uniqueValueCache[this.pageIndex])return c=this._resolveValueLabelsFromCache(this._uniqueValueCache),b.resolve(c),b;c=this.layerLoader}1===this.queryType?c.queryByPage(this.pageIndex).then(q.hitch(this,function(a){if(a){var c=a.features||[];a=c.length;this.showNullValues||(c=this._getNotNullValues(c));c=this._getValueLabelsFromFeatures(c);this.isKeyQueryLoader?(this._uniqueValueCacheForOtherTypes[this.pageIndex-
1]=c,a<this.pageSize&&(this._uniqueValueCacheForOtherTypes[this.pageIndex]=[])):(this._uniqueValueCache[this.pageIndex-1]=c,a<this.pageSize&&(this._uniqueValueCache[this.pageIndex]=[],this._isUniqueValueCacheFinish=!0));0===c.length&&this.pageIndex--;b.resolve(c)}else b.reject("Can't get features from current layer")}),q.hitch(this,function(a){b.reject(a)})):c.getAllFeatures().then(q.hitch(this,function(a){if(a){var c=a.features||[];this.showNullValues||(c=this._getNotNullValues(c));a=0<c.length?
!0:!1;c=this._getDistinctValues(c);c=this._getValueLabelsFromFeatures(c);c=this.isKeyQueryLoader?this._getAndStoreValueLabelsForOtherTypes(c,this._uniqueValueCacheForOtherTypes):this._getAndStoreValueLabelsForOtherTypes(c,this._uniqueValueCache);this._isUniqueValueCacheFinish=!0;b.resolve(a?c:[])}else b.reject("Can't get features from current layer")}),q.hitch(this,function(a){b.reject(a)}));this.pageIndex++;return b},_resolveValueLabelsFromCache:function(c){c=c[this.pageIndex];0!==c.length&&this.pageIndex++;
return c},_getAndStoreValueLabelsForOtherTypes:function(c,b){for(var d=0;d<c.length;d+=this.pageSize)b[parseInt(d/this.pageSize,10)+1]=c.slice(d,d+this.pageSize);for(var a in b)c=parseInt(a,10)+1,b[c]||(b[c]=[]);return b[1]},_getDistinctValues:function(c){var b={},d=[],a;for(a in c){var e=c[a],f=e.attributes[this.fieldInfo.name];b[f]||(b[f]=!0,d.push(e))}return d},_getNotNullValues:function(c){return c=k.filter(c,q.hitch(this,function(b){b=b.attributes[this.fieldInfo.name];return"\x3cNull\x3e"!==
b&&null!==b}))},_getValueLabelsFromFeatures:function(d){var b=this.fieldInfo.name;d=k.map(d,function(c){return c.attributes[b]});d=c._getValues(this.layerDefinition,this.fieldPopupInfo,b,d);"esriFieldTypeDate"===this.fieldInfo.type&&(d=this._getDistinctValueLabelsByFormat(d));return d},_getDistinctValueLabelsByFormat:function(c){var b={},d=[],a;for(a in c){var e=c[a].value;b[e]||(b[e]=!0,d.push(c[a]))}return d}})})},"jimu/LayerStructure":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/Evented ./LayerInfos/LayerInfos".split(" "),
function(t,f,k,q,e,r){var m=t([e],{declaredClass:"jimu.LayerStructure",map:null,_layerInfos:null,_eventHandles:null,constructor:function(e){this._layerInfos=e;this.map=this._layerInfos.map;this._eventHandles=[];this._bindEvents()},getLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArray())},getTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArray())},getBasemapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getBasemapLayerInfoArray())},
getWebmapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArrayOfWebmap())},getWebmapTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArrayOfWebmap())},addTable:function(e){var f=null;if(e=this._layerInfos.addTable(e))f=e._adaptor;return f},removeTable:function(e){(e=this.getNodeById(e))&&this._layerInfos.removeTable(e._layerInfo)},_traversal:function(e,f){for(var d=0;d<f.length;d++)if(f[d].traversal(e))return!0;
return!1},traversal:function(e){return this._traversal(e,this.getLayerNodes().concat(this.getBasemapLayerNodes().concat(this.getTableNodes())))},traversalWithNodes:function(e,f){return this._traversal(e,f)},getNodeById:function(e){var f=null;this.traversal(function(d){if(d.id===e)return f=d,!0});return f},getBasemapLayerObjects:function(){return this._layerInfos.getBasemapLayers()},restoreState:function(e){this._layerInfos.restoreState(e)},destroy:function(){f.forEach(this._eventHandles,function(e){e.remove()});
this.inherited(arguments)},_getNodesArrayFromInfosArray:function(e){var g=[];f.forEach(e,function(d){g.push(d._adaptor)},this);return g},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(g){console.warn(g)}},_bindEvents:function(){var e;e=q(this._layerInfos,"layerInfosChanged",k.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(e);e=q(this._layerInfos,"basemapLayerInfosChanged",k.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(e);e=q(this._layerInfos,
"tableInfosChanged",k.hitch(this,this._onTableNdoesStructureChanged));this._eventHandles.push(e);e=q(this._layerInfos,"layerInfosReorder",k.hitch(this,this._onLayerReordered));this._eventHandles.push(e);e=q(this._layerInfos,"layerInfosIsShowInMapChanged",k.hitch(this,this._onVisibilityChanged));this._eventHandles.push(e);e=q(this._layerInfos,"layerInfosIsVisibleChanged",k.hitch(this,this._onToggleChanged));this._eventHandles.push(e);e=q(this._layerInfos,"layerInfosFilterChanged",k.hitch(this,this._onFilterChanged));
this._eventHandles.push(e);e=q(this._layerInfos,"layerInfosRendererChanged",k.hitch(this,this._onRendererChanged));this._eventHandles.push(e);e=q(this._layerInfos,"layerInfosOpacityChanged",k.hitch(this,this._onOpacityChanged));this._eventHandles.push(e);e=q(this._layerInfos,"layerInfosTimeExtentChanged",k.hitch(this,this._onTimeExtentChanged));this._eventHandles.push(e)},_onLayerNodesStructureChanged:function(e,f,d){this._emitEvent(m.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:[d._adaptor],rootLayerNodes:[e._adaptor]})},
_onTableNdoesStructureChanged:function(e,f){e=this._getNodesArrayFromInfosArray(e);this._emitEvent(m.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:e,rootLayerNodes:e})},_onLayerReordered:function(e,f){e=[e._adaptor];this._emitEvent(m.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:e,rootLayerNodes:e})},_onVisibilityChanged:function(e){e={layerNodes:this._getNodesArrayFromInfosArray(e)};this._emitEvent(m.EVENT_VISIBILITY_CHANGE,e)},_onToggleChanged:function(e){e={layerNodes:this._getNodesArrayFromInfosArray(e)};
this._emitEvent(m.EVENT_TOOGLE_CHANGE,e)},_onFilterChanged:function(e){e={layerNodes:this._getNodesArrayFromInfosArray(e)};this._emitEvent(m.EVENT_FILTER_CHANGE,e)},_onRendererChanged:function(e){e={layerNodes:this._getNodesArrayFromInfosArray(e)};this._emitEvent(m.EVENT_RENDERER_CHANGE,e)},_onOpacityChanged:function(e){e={layerNodes:this._getNodesArrayFromInfosArray(e)};this._emitEvent(m.EVENT_OPACITY_CHANGE,e)},_onTimeExtentChanged:function(e){e={layerNodes:this._getNodesArrayFromInfosArray(e)};
this._emitEvent(m.EVENT_TIME_EXTENT_CHANGE,e)}}),l=null;m.getInstance=function(){l&&l._layerInfos._objectId===r.getInstanceSync()._objectId||(l&&l.destroy(),l=new m(r.getInstanceSync()));return l};m.createInstance=function(e){return new m(r.createInstance(e))};k.mixin(m,{STRUCTURE_CHANGE_ADD:r.ADDED,STRUCTURE_CHANGE_REMOVE:r.REMOVED,STRUCTURE_CHANGE_SUBNODE_ADD:r.SUBLAYER_ADDED,STRUCTURE_CHANGE_SUBNODE_REMOVE:r.SUBLAYER_REMOVED,STRUCTURE_CHANGE_NODE_UPDATE:r.UPDATED,STRUCTURE_CHANGE_REORDER:r.REORDERED,
EVENT_STRUCTURE_CHANGE:"structure-change",EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return m})},"jimu/dijit/_filter/PredefinedValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/text!./PredefinedValueProvider.html dojo/_base/lang dojo/on jimu/dijit/Popup ./PredefinedValuePopup ./ValueProvider".split(" "),
function(t,f,k,q,e,r,m,l){return f([l],{templateString:k,nls:null,url:"",layerDefinition:null,partObj:null,fieldInfo:null,codedValues:null,staticValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,runtime:!1,providerType:null,valueProvider:null,postCreate:function(){this.inherited(arguments);this.jimuNls=window.jimuNls;t.addClass(this.domNode,"jimu-filter-indexBtn-value-provider");t.addClass(this.valueProviderPopupNode,"value-type-popup");t.setStyle(this.valueProviderPopupNode,
"display","none");var e="";"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?e=this.nls.predefinedUniqueTips:"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(e=this.nls.predefinedMultipleTips);this.indexBtnTips.title=e;this.indexBtnTips.innerText=e+" ...";this._initProvider();this._bindEvent()},_initProvider:function(){var e={preDefinedTips:this.indexBtnTips,nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:this.partObj,fieldInfo:this.fieldInfo,codedValues:this.codedValues,
staticValues:this.staticValues,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:this.operatorInfo,filterCodedValueIfPossible:this.filterCodedValueIfPossible,runtime:this.runtime,selectUI:this.selectUI,providerType:this.providerType};if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType)this.valueProvider=new m(e);this.valueProvider.on("predefinedValuePopup_setApplyBtnState",q.hitch(this,function(e){this.popup&&(e?this.popup.enableButton(0):
this.popup.disableButton(0))}))},_bindEvent:function(){this.own(e(this.indexBtn,"click",q.hitch(this,function(){this.valueProvider&&this.destroyProvider();this._initProvider();this.setValueObject(this.valueObjEnd,this.valueObjEnd.type);this.popup=new r({width:800,height:600,content:this.valueProvider,titleLabel:this.indexBtnTips.title,useFocusLogic:!1,onClose:q.hitch(this,function(){this.getValueObject(!1);this._closeCBXPopup();this.destroyProvider()}),buttons:[{label:this.nls.apply,disable:!0,onClick:q.hitch(this,
function(){this.getValueObject(!0)?this.popup.close():alert("please configurate some items")})},{label:this.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:q.hitch(this,function(){this.popup.close()})}]});t.addClass(this.popup.domNode,"widget-at-filter-popup");setTimeout(q.hitch(this,function(){this.valueProvider._setApplyState(this.getValueObject(!0));this.valueProvider._setDisplayTypeStyle()}),100)})))},_closeCBXPopup:function(){this.valueProvider.cbxPopup&&this.valueProvider.cbxPopup.domNode&&
(this.valueProvider.cbxPopup.onClose=q.hitch(this,function(){return!0}),this.valueProvider.cbxPopup.close())},_saveData:function(){this.valueProvider.saveData()},reset:function(){},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(e){e&&(this.valueObjEnd=e);this.valueProvider.setValueObject(e,!0)},valueObj:null,getValueObject:function(e){if(e)return this.valueObjEnd=e=this.valueProvider.getValueObject(),e.value.length;delete this.valueObjEnd.valueList;return 0===
this.valueObjEnd.value.length?0:this.valueObjEnd},destroyProvider:function(){this.valueProvider&&this.valueProvider.destroyProvider();this.valueProvider=null}})})},"jimu/dijit/_filter/PredefinedValuePopup":function(){define("dojo/_base/lang dojo/Deferred dojo/_base/html dojo/_base/array dojo/_base/declare dojo/Evented dojo/query ./ValueProvider ./EditTable ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PredefinedValuePopup.html dojo/store/Memory jimu/utils jimu/dijit/Popup jimu/dijit/_filter/pageControlForQuery dojox/form/CheckedMultiSelect".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v){return e([l,d,c,r],{templateString:n,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,selectUI:null,postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.selectUI=this.selectUI?this.selectUI:"dropdown";k.addClass(this.domNode,
"jimu-filter-mutcheck-list-value-provider");this.controlType="unique";"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(this.controlType="multiple");this.isNumberField=h.isNumberField(this.fieldInfo.type);this.editTable||(this.editTable=new g({tableType:this.controlType,dataList:[],codedValues:this.codedValues,emptyStr:this.emptyStr,customValue:this.Nls.addValuePlaceHolder,customLabel:this.Nls.addLabelPlaceHolder,isNumberField:this.isNumberField}),this.editTable.placeAt(this.tableContent),
this.editTable.on("editTable_openListSelectByName",t.hitch(this,this._showListSelectByTable)),this.editTable.on("editTable_itemChanged",t.hitch(this,this._editTableItemChanged)),this.editTable.on("editTable_getValLabelsArrayForNumber",t.hitch(this,this._getValLabelsArrayForNumber)));this.supportPaing=!0;this.pageControlForQuery||(this.pageControlForQuery=new u({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,
isNumberField:this.isNumberField}));this.listSelect||(this.listSelect=new p({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField}),this.listSelect.on("advancedListValueSelect_itemChecked",t.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",t.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",t.hitch(this,
this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",t.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",t.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",t.hitch(this,this._createTargetForPredefined)));this.mutiValuesSelect||(this.mutiValuesSelect=new v({multiple:!0,required:!1,intermediateChanges:!0,style:{width:"100%"}}));this._multipleSelectProviderEventHandler=t.hitch(this,this._multipleSelectProviderEvent);
document.addEventListener("click",this._multipleSelectProviderEventHandler);var a=new b({idProperty:"id",data:[]});this.listSelect.set("store",a)},_multipleSelectProviderEvent:function(a){var b=a.target||a.srcElement,c=k.isDescendant(b,this.editTable.searchBtn);this.editTable&&this.cbxPopup&&this.cbxPopup.domNode?(c?"block"===k.getStyle(this.cbxPopup.domNode,"display")?k.setStyle(this.cbxPopup.domNode,"display","none"):k.setStyle(this.cbxPopup.domNode,"display","block"):k.isDescendant(b,this.cbxPopup.domNode)||
this._createTargetForPredefined(),a.stopPropagation()):this._isInSelectPopup(b)||this.runtime?a.stopPropagation():k.setStyle(this.valuesPopupNode,"display","none")},_initAdvancedListValueSelect:function(){this.pageControlForQuery.pageIndex=1;this.pageControlForQuery.isKeyQueryLoader=!1;this.listSelect=new p({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,isCacheFinish:this.pageControlForQuery._isUniqueValueCacheFinish,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],
isNumberField:this.isNumberField});this.listSelect.on("advancedListValueSelect_itemChecked",t.hitch(this,this._createTarget));this.listSelect.on("advancedListValueSelect_itemUnChecked",t.hitch(this,this._destoryTarget));this.listSelect.on("advancedListValueSelect_addNextPage",t.hitch(this,this._addNextPage));this.listSelect.on("advancedListValueSelect_searchKey",t.hitch(this,this._searchKey));this.listSelect.on("advancedListValueSelect_searchKeyLocal",t.hitch(this,this._searchKeyLocal));this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",
t.hitch(this,this._createTargetForPredefined))},_isInSelectPopup:function(a){for(var b="dijitCheckBoxInput dojoxMultiSelectItemLabel dojoxMultiSelectItemBox dojoxMultiSelectItem dojoxCheckedMultiSelectWrapper dojoxCheckedMultiSelect value-type-popup popupOper pageItem".split(" "),c=!1,d=0;d<=b.length;d++)if(k.hasClass(a,b[d])){c=!0;break}return c},_createTarget:function(){this.editTable._createTarget("","","","",!0);this._editTableItemChanged()},_createTargetForPredefined:function(a,b){this.editTable._setNewLabel(a,
b);this.cbxPopup.close();this._editTableItemChanged()},_destoryTarget:function(a){this.editTable._destroyTarget(a);this._editTableItemChanged()},_editTableItemChanged:function(){if(!this.runtime){var a=this.getValueObject();this._setApplyState(a.value.length)}},_setApplyState:function(a){this.emit("predefinedValuePopup_setApplyBtnState",a)},_cbxWidth:245,_cbxHeight:340,isPopupLoading:!1,_showListSelectByTable:function(b){if(!this.isPopupLoading){this._initAdvancedListValueSelect();this.valueList=
[b];this.getCheckedList(this.valueList);b=k.position(this.editTable.searchBtn);var c=b.x-226,d=b.y+30;window.isRTL&&(c=b.x);this.cbxPopup=new a({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:c,top:d},useFocusLogic:!1,buttons:[]});this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"});this.cbxPopup.on("popupHasInitedSuccessfully",t.hitch(this,function(){var a=
k.position(this.editTable.searchBtn),b=a.x-226,c=a.y+30;window.isRTL&&(b=a.x);this.cbxPopup.setCustomPosition(b,c)}));this.listSelect.valueInput&&this.listSelect.valueInput.focus();this._showLoadingIcon();this.isPopupLoading=!0;this._valueLabels().then(t.hitch(this,function(a){this.isPopupLoading=!1;this._hideLoadingIcon();if(!0!==a){var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)}}))}},_valueLabels:function(){var a=new f;this.listSelect.codedValues=!1;this.listSelect.disPlayLabel=
"label";if(this.staticValues)return this._setValueForStaticValues(this.staticValues),a.resolve(!0),a;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return this._setValueForStaticValues(this.codedValues),a.resolve(!0),a;this.pageControlForQuery.queryByPage(!0).then(t.hitch(this,function(b){a.resolve(b)}),t.hitch(this,function(b){console.log(b);this._hideLoadingIcon();a.reject(b)}));return a},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;a&&(this.pageControlForQuery._codedvalueCache=
a,a=0<a.length?a:[],this.listSelect.setCBXData(a,!0,!0))},_changeDisplayType:function(a){a=a.target||a.srcElement;a=k.hasClass(a,"option")?a:h.getAncestorDom(a,function(a){return k.hasClass(a,"option")},2);k.hasClass(a,"checked")||(k.addClass(a,"checked"),a=m("."+this.selectUI+"Option ",this.displayTypes)[0],k.removeClass(a,"checked"),this.selectUI="expanded"===this.selectUI?"dropdown":"expanded")},_setDisplayTypeStyle:function(){var a=m(".title",this.displayTypes)[0],b=m(".label",this.displayTypes),
a=(k.getStyle(this.displayTypes,"width")-k.getStyle(a,"width")-80)/2,c=k.getStyle(b[0],"width"),c=c<a?c:a,d=k.getStyle(b[1],"width"),d=d<a?d:a;k.setStyle(b[0],"width",c+"px");k.setStyle(b[1],"width",d+"px")},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(t.hitch(this,function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.setCBXData(a,!0);this._hideLoadingIcon()}),
t.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._searchKey(a).then(t.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._hideLoadingIcon()}),t.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a){this.listSelect&&(this._showLoadingIcon(),a=this.pageControlForQuery._searchKeyLocal(a),this.listSelect.setCBXContentBySearch(a),this._hideLoadingIcon())},
_handlerPageValues:function(){},getCheckedList:function(a){this.listSelect.checkedList=[];this.isNumberField?q.forEach(a,t.hitch(this,function(a){this.listSelect.checkedList.push(parseFloat(a))})):this.listSelect.checkedList=a},_showPopup:function(){var b=this.getValueObject().valueList;this.valueList=null===b?void 0:b;this.getCheckedList(this.valueList);this.cbxPopup?(this.listSelect.checkCBXItems(!1),this.cbxPopup.show()):(this.cbxPopup=new a({width:355,height:596,content:this.listSelect.domNode,
titleLabel:this.layerDefinition.name+"("+this.fieldName+")",isResize:!1,useFocusLogic:!1,onClose:t.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this._showLoadingIcon(),this.pageControlForQuery.queryByPage().then(t.hitch(this,function(a){this._hideLoadingIcon();var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)})))},getDijits:function(){return[this.mutiValuesSelect]},setValueObject:function(a){a.value=a.value?a.value:[];var b=m("."+(a.selectUI?
a.selectUI:this.selectUI)+"Option ",this.displayTypes)[0];k.addClass(b,"checked");b=null;if(this.isNumberField){for(var b=[],c=0;c<a.value.length;c++)b.push(a.value[c].value);b=this._getValLabelsArrayForNumber(!1,b)}this.editTable.emptyLabel=a.emptyLabel;this.editTable.enableEmpty=a.enableEmpty;this.editTable.setListValues(a.value,b)},_getValLabelsArrayForNumber:function(a,b){b=h._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,b);a&&(this.editTable.currentValLabel=b[0].label);return b},
tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:[],valueList:[]}:null},getValueObject:function(){if(this.isValidValue()){var a=this.editTable.getListValues(),b={isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:a.list,valueList:a.valueList};"unique"===this.controlType&&(b.emptyLabel=a.emptyLabel,b.enableEmpty=a.enableEmpty);return b}return null},setRequired:function(a){this.mutiValuesSelect.set("required",
a)},queryByPage:function(){var a=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(t.hitch(this,function(b){a.resolve(b)}),t.hitch(this,function(b){console.log(b);a.reject(b)}))},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&k.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&k.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&
document.removeEventListener("click",this._multipleSelectProviderEventHandler);this.inherited(arguments)},destroyProvider:function(){this.editTable&&this.editTable.destroy();this.listSelect&&this.listSelect.destroy();this.listSelect=null;this.destroy();k.destroy(this.domNode)}})})},"jimu/dijit/_filter/EditTable":function(){define("dojo/_base/lang dojo/_base/html dojo/Evented dojo/on dojo/keys dojo/dom-attr dojo/_base/declare dijit/_WidgetBase dojo/query dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./EditTable.html jimu/utils".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){return m([l,c,n,k],{templateString:b,currentItem:null,dataList:[],codedValues:null,isNumberField:!0,tableType:"unique",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"unique"===this.tableType?(this.inputType="radio",f.addClass(this.listContent,"radio-items-list-content")):
this.inputType="checkbox"},_onListContentDblClicked:function(a){this.isSearch=!1;var b=a.target||a.srcElement,c=h.getAncestorDom(b,function(a){return f.hasClass(a,"item")},3);if(c&&(f.hasClass(b,"name")||f.hasClass(b,"alias"))&&(!f.hasClass(c,"empty")||!f.hasClass(b,"name"))){this._dijit?(this.editState="active",this.updateInputDivPre=this.updateInputDiv,this._dijitPre=this._dijit):this.editState="negative";a=this._getNodeText(b);var k=decodeURIComponent(f.getAttr(b,"data")),c=f.hasClass(c,"custom");
this.placeHolder=f.hasClass(b,"name")&&!this.codedValues?k:a;c?f.hasClass(b,"alias")&&this.placeHolder!==this.customLabel?this.currentLabel=a:this.currentLabel=NaN:this.currentLabel=this.isNumberField&&f.hasClass(b,"name")&&!this.codedValues?parseFloat(this.placeHolder):this.placeHolder;r.set(b,"innerHTML","");a="";f.hasClass(b,"name")&&(a='\x3cdiv class\x3d"searchBtn"\x3e\x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\x3c/div\x3e');this.updateInputDiv=f.create("div",{"class":"updateInputDiv",
innerHTML:'\x3cdiv class\x3d"inputDiv"\x3e\x3c/div\x3e'+a},b);a=g(".inputDiv",this.updateInputDiv)[0];this.searchBtn=g(".searchBtn",this.updateInputDiv)[0];this.own(q(this.updateInputDiv,"dblclick",t.hitch(this,function(a){a.stopPropagation();a.preventDefault()})));k={required:!1,intermediateChanges:!1,value:this.currentLabel};this.codedValues&&f.hasClass(b,"name")&&(k.disabled=!0);this.isNumberField&&f.hasClass(b,"name")?(k.constraints={pattern:"#####0.##########"},this._dijit=new d(k)):(k.trim=
!0,this._dijit=new p(k));this._dijit.startup();this._dijit.on("keydown",function(a){(a.keyCode||a.which)===e.ENTER&&this._dijit.emit("blur")}.bind(this));this._dijit.on("blur",t.hitch(this,function(){if(this._dijit){var a="Error"!==this._dijit.state?this._dijit.displayedValue:this.currentLabel;this.isNumberField&&f.hasClass(b,"name")&&"Error"===this._dijit.state&&this._dijit.setValue(parseFloat(a));var a=h.sanitizeHTML(a),c=this._dijit.get("value");""!==c&&c?f.hasClass(b,"name")&&(this.placeHolder===
this.customValue||"NaN"===this.placeHolder&&""!==this._dijit.displayedValue)&&(c=h.getAncestorDom(this._dijit.domNode,function(a){return f.hasClass(a,"item")},4),f.removeClass(c,"custom"),this.emit("editTable_itemChanged")):a=this.placeHolder;this.newLabel=a;setTimeout(t.hitch(this,function(){var a,b;if(this.isSearch||"active"===this.editState)"active"===this.editState&&(c=this.updateInputDivPre.parentNode,b=decodeURIComponent(f.getAttr(c,"data")),f.hasClass(c,"name")?this.currentValLabel=""===this._dijitPre.displayedValue?
b===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(b):b:this.isNumberField?this._getLocalNumber(this._dijitPre.value):this._dijitPre.value:this.currentValLabel=""===this._dijitPre.displayedValue?b===this.customLabel?this.customLabel:b:this._dijitPre.displayedValue,!f.hasClass(c,"name")||"NaN"===this.newLabel||this.newLabel===this.customValue||this._getNodeText(c.nextSibling)!==this.customLabel&&this._dijit.value!==this.customLabel||(f.isDescendant(this.updateInputDiv,c.nextSibling)?
this._dijit.set("value",this.currentValLabel):(a=this.isNumberField?this.currentValLabel:this.newLabel,f.setAttr(c.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(c.nextSibling,a),f.setAttr(c.nextSibling,"title",a))),a=f.hasClass(c,"name")?""===this._dijitPre.displayedValue?b===this.customValue?this.customValue:b:this._dijitPre.value:this.newLabel,f.setAttr(c,"data",encodeURIComponent(a)),a=f.hasClass(c,"name")?this.currentValLabel:this.newLabel,this._setNodeText(c,a),f.setAttr(c,"title",
a),this._dijitPre=this.updateInputDivPre=null,this.editState="negative");else{var c=this.updateInputDiv.parentNode;b=decodeURIComponent(f.getAttr(c,"data"));f.hasClass(c,"name")?this.currentValLabel=""===this._dijit.displayedValue?b===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(b):b:this.isNumberField?this._getLocalNumber(this._dijit.value):this._dijit.value:this.currentValLabel=""===this._dijit.displayedValue?b===this.customLabel?this.customLabel:b:this._dijit.displayedValue;
f.hasClass(c,"name")&&"NaN"!==this.newLabel&&this.newLabel!==this.customValue&&this._getNodeText(c.nextSibling)===this.customLabel&&(a=this.isNumberField?this.currentValLabel:this.newLabel,f.setAttr(c.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(c.nextSibling,a),f.setAttr(c.nextSibling,"title",a));a=f.hasClass(c,"name")?""===this._dijit.displayedValue?b===this.customValue?this.customValue:b:this._dijit.value:this.newLabel;f.setAttr(c,"data",encodeURIComponent(a));a=f.hasClass(c,"name")?
this.currentValLabel:this.newLabel;this._setNodeText(c,a);f.setAttr(c,"title",a);this._dijit=null;this.isSearch=!1}}),300);this.placeHolder=""}}));f.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(a);g("input",this._dijit.domNode)[1].focus();this.searchBtn&&(this.own(q(this.searchBtn,"click",t.hitch(this,function(a){this.isSearch||(this.isSearch=!0,this.searchTarget=a.target||a.srcElement,this.emit("editTable_openListSelectByName",this.newLabel),a.stopPropagation(),a.preventDefault())}))),
this.codedValues&&this.searchBtn.click())}},_getLocalNumber:function(a){"string"===typeof a&&(a=parseFloat(a));this.emit("editTable_getValLabelsArrayForNumber",!0,[a]);return this.currentValLabel},_setNewLabel:function(a,b){var c;void 0===a&&void 0===b&&(""!==this._dijit.displayedValue?this.codedValues?(b=this._dijit.displayedValue,a=this._getCodeFromCodevalueLabel(b)):(b=a=this._dijit.value,this.isNumberField&&this.newLabel!==this.customValue&&(b=this._getLocalNumber(a))):(a=b=this.customValue,this.updateInputDiv&&
this.updateInputDiv.parentNode&&(c=this.updateInputDiv.parentNode,c=decodeURIComponent(f.getAttr(c,"data")),c!==this.customValue&&(a=this.isNumberField?parseFloat(c):c,b=this.codedValues?this._getLabelFromCodevalue(a):this.isNumberField?this._getLocalNumber(a):a))));this.updateInputDiv&&this.updateInputDiv.parentNode&&(c=this.updateInputDiv.parentNode,b!==this.customValue&&this._getNodeText(c.nextSibling)===this.customLabel&&(f.setAttr(c.nextSibling,"data",encodeURIComponent(b)),this._setNodeText(c.nextSibling,
b),f.setAttr(c.nextSibling,"title",b)),this.codedValues||(a=a?a:decodeURIComponent(f.getAttr(c,"data"))),f.setAttr(c,"data",encodeURIComponent(a)),a=c.parentNode,b!==this.customValue&&f.removeClass(a,"custom"),this._setNodeText(c,b),f.setAttr(c,"title",b));this._dijit=this.updateInputDiv=null},_onListContentClicked:function(a){a=a.target||a.srcElement;var b=h.getAncestorDom(a,function(a){return f.hasClass(a,"item")},3);b&&(f.hasClass(a,"checkboxEmpty")?f.hasClass(a,"checked")?f.removeClass(a,"checked"):
f.addClass(a,"checked"):f.hasClass(a,this.inputType)?("radio"===this.inputType&&!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),f.hasClass(a,"checked")?"radio"!==this.inputType?f.removeClass(a,"checked"):f.hasClass(this.currentItem,"checked")||f.removeClass(a,"checked"):("radio"===this.inputType&&this.currentItem&&f.removeClass(this.currentItem,"checked"),f.addClass(a,"checked"),this.currentItem=a)):f.hasClass(a,"action")&&(f.hasClass(a,"up")?b.previousElementSibling&&f.place(b,b.previousElementSibling,
"before"):f.hasClass(a,"down")?b.nextElementSibling&&f.place(b,b.nextElementSibling,"after"):f.hasClass(a,"delete")&&(f.destroy(b),this.emit("editTable_itemChanged"))))},_getLabelFromCodevalue:function(a){for(var b=a,c=0;c<this.codedValues.length;c++){var d=this.codedValues[c];if(d.value===a){b=d.label;break}}return b},_getCodeFromCodevalueLabel:function(a){for(var b=a,c=0;c<this.codedValues.length;c++){var d=this.codedValues[c];if(d.label===a){b=d.value;break}}return b},_createEmptyTarget:function(a){for(var b=
this.emptyStr,c=this.emptyLabel?this.emptyLabel:b,d=" checked",e=0;e<a.length;e++)if(a[e].isChecked){d="";break}" checked"===d&&(this.currentItem=!0);var e='data\x3d"'+encodeURIComponent(b)+'"',g="",h=this.Nls.emptyValueTips;if(0===a.length||this.enableEmpty)g=" checked";return f.create("div",{"class":"item empty",innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis" style\x3d"cursor: default;"'+e+"\x3e"+b+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+c+'"\x3e'+c+'\x3c/div\x3e\x3cdiv class\x3d"label '+
this.inputType+d+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"label checkbox checkboxEmpty'+g+' jimu-ellipsis jimu-flipx" title\x3d"'+h+'"\x3e\x3c/div\x3e'},this.listContent)},_createTarget:function(a,b,c,d,e){var h="item";e&&(a=b=this.customValue,c=this.customLabel,h="item custom");a=a||0===a?a:"";b=b||"";c=c?c:a;d=d?d:"";var k=a;(this.codedValues||this.isNumberField)&&a!==this.Nls.addValuePlaceHolder&&(k=this.codedValues?this._getLabelFromCodevalue(a):b);b=this.isNumberField?a:encodeURIComponent(a);
d=f.create("div",{"class":h,innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis-Blanks" '+('data\x3d"'+b+'"')+"\x3e"+k+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+c+'"\x3e'+c+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+d+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"actions jimu-float-trailing"\x3e\x3cdiv class\x3d"delete action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"down action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"up action jimu-float-trailing"\x3e\x3c/div\x3e\x3c/div\x3e'},
this.listContent);e&&(e=g(".name",d)[0],f.setAttr(e,"title",a),f.setAttr(e.nextSibling,"title",c));return d},_destroyTarget:function(a){for(var b=g(".item .name",this.listContent),c=0;c<b.length;c++){var d=b[c];if(r.get(this._dijit.domNode.parentNode,"innerHTML")===a){f.destroy(d.parentNode);break}}},getCurrentItem:function(){for(var a=g(".item .radio",this.listContent),b=0;b<a.length;b++){var c=a[b];if(f.hasClass(c,"checked"))return c}return null},_getEmptyLabel:function(){var a=g(".label.alias",
this.listContent.firstChild)[0],b=this._getNodeText(a);a.children.length&&(b="Error"===this._dijit.state?decodeURIComponent(f.getAttr(a,"data")):this._dijit.value);return b=h.sanitizeHTML(b)},_getEmptyStatus:function(){var a=g(".checkboxEmpty",this.listContent.firstChild)[0];return f.hasClass(a,"checked")?!0:!1},_getNodeText:function(a){return a.textContent||a.innerText||""},_setNodeText:function(a,b){a.innerHTML="\x26nbsp;";a.textContent?a.textContent=b:a.innerText=b},getListValues:function(){this.listItemsArray=
[];this.listValuesArray=[];for(var a=g(".item .name",this.listContent),b="radio"===this.inputType?1:0;b<a.length;b++){var c=a[b],d=h.getAncestorDom(c,function(a){return f.hasClass(a,"item")},3);if(!f.hasClass(d,"custom")){var d=this._getNodeText(c),e=decodeURIComponent(f.getAttr(c,"data"));if(this.isNumberField||this.codedValues)d=e;c.children.length&&(d="Error"===this._dijit.state?e:this._dijit.value,this.codedValues&&(d=this._getCodeFromCodevalueLabel(d),d=void 0!==d?d:e));d=this.isNumberField?
parseFloat(d):h.sanitizeHTML(d);e=this._getNodeText(c.nextSibling);e===this.customLabel&&(e=d.toString(),this.isNumberField&&(e=this._getLocalNumber(e)));c.nextSibling.children.length&&(e="Error"===this._dijit.state?decodeURIComponent(f.getAttr(c.nextSibling,"data")):this._dijit.value);e=h.sanitizeHTML(e);e={value:d,alias:e,isChecked:!1};this.listItemsArray.push(e);this.listValuesArray.push(d);f.hasClass(c.nextSibling.nextSibling,"checked")&&(e.isChecked=!0)}}a={list:this.listItemsArray,valueList:this.listValuesArray};
"radio"===this.inputType&&(a.emptyLabel=this._getEmptyLabel(),a.enableEmpty=this._getEmptyStatus());return a},setListValues:function(a,b){r.set(this.listContent,"innerHTML","");"radio"===this.inputType&&this._createEmptyTarget(a);for(var c=0;c<a.length;c++){var d=a[c],e="";d.isChecked&&(e=" checked",this.currentItem=!0);this._createTarget(d.value,b?b[c].label:d.value,d.alias,e)}a=g(".name",this.listContent);for(b=0;b<a.length;b++)c=a[b],f.setAttr(c,"title",this._getNodeText(c)),c=c.nextSibling,f.setAttr(c,
"title",this._getNodeText(c))},_initTable:function(){},getDijits:function(){return[this.mutiValuesSelect]},destroy:function(){this.inherited(arguments)}})})},"dojox/form/CheckedMultiSelect":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/dom-geometry dojo/dom-class dojo/dom-construct dojo/i18n dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/_FormSelectWidget dijit/form/ComboButton dojo/text!dojox/form/resources/_CheckedMultiSelectMenuItem.html dojo/text!dojox/form/resources/_CheckedMultiSelectItem.html dojo/text!dojox/form/resources/CheckedMultiSelect.html dojo/i18n!dojox/form/nls/CheckedMultiSelect dijit/form/CheckBox".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,z,E){var C=t("dojox.form._CheckedMultiSelectItem",[g,p,d],{templateString:x,baseClass:"dojoxMultiSelectItem",option:null,parent:null,disabled:!1,readOnly:!1,postMixInProperties:function(){this._type=this.parent.multiple?{type:"checkbox",baseClass:"dijitCheckBox"}:{type:"radio",baseClass:"dijitRadio"};this.disabled||(this.disabled=this.option.disabled=this.option.disabled||!1);this.readOnly||(this.readOnly=this.option.readOnly=this.option.readOnly||!1);
this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.labelNode.innerHTML=this.option.label},_changeBox:function(){this.get("disabled")||this.get("readOnly")||(this.parent.multiple?this.option.selected=this.checkBox.get("value")&&!0:this.parent.set("value",this.option.value),this.parent._updateSelection(),this.parent.focus())},_onClick:function(a){this.get("disabled")||this.get("readOnly")?q.stop(a):this.checkBox._onClick(a)},_updateBox:function(){this.checkBox.set("value",
this.option.selected)},_setDisabledAttr:function(a){this.disabled=a||this.option.disabled;this.checkBox.set("disabled",this.disabled);r.toggle(this.domNode,"dojoxMultiSelectDisabled",this.disabled)},_setReadOnlyAttr:function(a){this.checkBox.set("readOnly",a);this.readOnly=a}}),A=t("dojox.form._CheckedMultiSelectMenu",n,{multiple:!1,buildRendering:function(){this.inherited(arguments);var a=this.menuTableNode=this.domNode,b=this.domNode=m.create("div",{style:{overflowX:"hidden",overflowY:"scroll"}});
a.parentNode&&a.parentNode.replaceChild(b,a);r.remove(a,"dijitMenuTable");b.className=a.className+" dojoxCheckedMultiSelectMenu";a.className="dijitReset dijitMenuTable";a.setAttribute("role","listbox");b.setAttribute("role","presentation");b.appendChild(a)},resize:function(a){a&&(e.setMarginBox(this.domNode,a),"w"in a&&(this.menuTableNode.style.width="100%"))},onClose:function(){this.inherited(arguments);this.menuTableNode&&(this.menuTableNode.style.width="")},onItemClick:function(a,b){"undefined"==
typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled||a.readOnly)return!1;if(!this.multiple)this.onExecute();a.onClick(b)}}),w=t("dojox.form._CheckedMultiSelectMenuItem",b,{templateString:v,option:null,parent:null,iconClass:"",postMixInProperties:function(){this.parent.multiple?(this._iconClass="dojoxCheckedMultiSelectMenuCheckBoxItemIcon",this._type={type:"checkbox"}):(this._iconClass="",this._type={type:"hidden"});this.disabled=this.option.disabled;this.checked=this.option.selected;
this.label=this.option.label;this.readOnly=this.option.readOnly;this.inherited(arguments)},onChange:function(a){},_updateBox:function(){r.toggle(this.domNode,"dojoxCheckedMultiSelectMenuItemChecked",!!this.option.selected);this.domNode.setAttribute("aria-checked",this.option.selected);this.inputNode.checked=this.option.selected;this.parent.multiple||r.toggle(this.domNode,"dijitSelectSelectedOption",!!this.option.selected)},_onClick:function(a){this.disabled||this.readOnly||(this.parent.multiple?(this.option.selected=
!this.option.selected,this.parent.onChange(),this.onChange(this.option.selected)):this.option.selected||(k.forEach(this.parent.getChildren(),function(a){a.option.selected=!1}),this.option.selected=!0,this.parent.onChange(),this.onChange(this.option.selected)));this.inherited(arguments)}});return t("dojox.form.CheckedMultiSelect",a,{templateString:z,baseClass:"dojoxCheckedMultiSelect",required:!1,invalidMessage:"$_unset_$",_message:"",dropDown:!1,labelText:"",tooltipPosition:[],postMixInProperties:function(){this.inherited(arguments);
this._nlsResources=l.getLocalization("dojox.form","CheckedMultiSelect",this.lang);"$_unset_$"==this.invalidMessage&&(this.invalidMessage=this._nlsResources.invalidMessage)},_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this.value=this.options[0<=a?a:0].value}this.dropDown&&(r.toggle(this.selectNode,"dojoxCheckedMultiSelectHidden"),this.dropDownMenu=new A({id:this.id+"_menu",style:"display: none;",multiple:this.multiple,
onChange:f.hitch(this,"_updateSelection")}))},startup:function(){this.dropDown&&(this.dropDownButton=new u({label:this.labelText,dropDown:this.dropDownMenu,baseClass:"dojoxCheckedMultiSelectButton",maxHeight:this.maxHeight},this.comboButtonNode));this.inherited(arguments)},_onMouseDown:function(a){a.preventDefault()},validator:function(){return this.required?k.some(this.getOptions(),function(a){return a.selected&&null!=a.value&&0!=a.value.toString().length}):!0},validate:function(a){h.hide(this.domNode);
(a=this.isValid(a))||this.displayMessage(this.invalidMessage);return a},isValid:function(a){return this.validator()},getErrorMessage:function(a){return this.invalidMessage},displayMessage:function(a){h.hide(this.domNode);a&&h.show(a,this.domNode,this.tooltipPosition)},onAfterAddOptionItem:function(a,b){},_addOptionItem:function(a){var b;this.dropDown?(b=new w({option:a,parent:this.dropDownMenu}),this.dropDownMenu.addChild(b)):(b=new C({option:a,parent:this,disabled:this.disabled,readOnly:this.readOnly}),
this.wrapperDiv.appendChild(b.domNode));this.onAfterAddOptionItem(b,a)},_refreshState:function(){this.validate(this.focused)},onChange:function(a){this._refreshState()},reset:function(){this.inherited(arguments);h.hide(this.domNode)},_updateSelection:function(){this.inherited(arguments);this._handleOnChange(this.value);k.forEach(this._getChildren(),function(a){a._updateBox()});m.empty(this.containerNode);var a=this;k.forEach(this.value,function(b){b=m.create("option",{value:b,label:b,selected:"selected"});
m.place(b,a.containerNode)});if(this.dropDown&&this.dropDownButton){var b=0,c="";k.forEach(this.options,function(a){a.selected&&(b++,c=a.label)});this.dropDownButton.set("label",this.multiple?f.replace(this._nlsResources.multiSelectLabelText,{num:b}):c)}},_getChildren:function(){return this.dropDown?this.dropDownMenu.getChildren():k.map(this.wrapperDiv.childNodes,function(a){return c.byNode(a)})},invertSelection:function(a){this.multiple&&(k.forEach(this.options,function(a){a.selected=!a.selected}),
this._updateSelection())},_setDisabledAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDownButton.set("disabled",a);k.forEach(this._getChildren(),function(b){b&&b.set&&b.set("disabled",a)})},_setReadOnlyAttr:function(a){this.inherited(arguments);"readOnly"in this.attributeMap&&this[this.attributeMap.readOnly].setAttribute("readonly",a);this.readOnly=a;k.forEach(this._getChildren(),function(b){b&&b.set&&b.set("readOnly",a)})},uninitialize:function(){h.hide(this.domNode);k.forEach(this._getChildren(),
function(a){a.destroyRecursive()});this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a){d("dijit-legacy-requires")&&a(0,function(){t(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return k("dijit.Menu",
h,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):f.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return n.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||
a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=q.byId(a,this.ownerDocument);var b;if("iframe"==a.tagName.toLowerCase()){var d=a;b=this._iframeContentWindow(d);b=c.body(b.document)}else b=a==c.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var f={node:a,iframe:d};e.set(a,"_dijitMenu"+this.id,this._bindings.push(f));var h=g.hitch(this,function(a){var b=this.selector,c=b?function(a){return p.selector(b,
a)}:function(a){return a},e=this;return[p(a,c(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<e._lastKeyDown+500||e._scheduleOpen(this,d,{x:a.pageX,y:a.pageY},a.target)}),p(a,c("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==l.F10||e.leftClickToOpen&&a.keyCode==l.SPACE)a.stopPropagation(),a.preventDefault(),e._scheduleOpen(this,d,null,a.target),e._lastKeyDown=(new Date).getTime()})]});f.connects=b?h(b):[];d&&(f.onloadHandler=
g.hitch(this,function(){var a=this._iframeContentWindow(d),a=c.body(a.document);f.connects=h(a)}),d.addEventListener?d.addEventListener("load",f.onloadHandler,!1):d.attachEvent("onload",f.onloadHandler))},unBindDomNode:function(a){var b;try{b=q.byId(a,this.ownerDocument)}catch(C){return}a="_dijitMenu"+this.id;if(b&&e.has(b,a)){for(var c=e.get(b,a)-1,d=this._bindings[c],f;f=d.connects.pop();)f.remove();(f=d.iframe)&&(f.removeEventListener?f.removeEventListener("load",d.onloadHandler,!1):f.detachEvent("onload",
d.onloadHandler));e.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function c(){p.refocus&&t&&t.focus();b.close(p)}var e=a.target,f=a.iframe,g=a.coords,h=!g;this.currentTarget=a.delegatedTarget;if(g){if(f){a=r.position(f,!0);var e=this._iframeContentWindow(f),e=r.docScroll(e.document),k=m.getComputedStyle(f),
l=m.toPixelValue,n=(d("ie")&&d("quirks")?0:l(f,k.paddingLeft))+(d("ie")&&d("quirks")?l(f,k.borderLeftWidth):0),f=(d("ie")&&d("quirks")?0:l(f,k.paddingTop))+(d("ie")&&d("quirks")?l(f,k.borderTopWidth):0);g.x+=a.x+n-e.x;g.y+=a.y+f-e.y}}else g=r.position(e,!0),g.x+=10,g.y+=10;var p=this,f=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var t=!a||q.isDescendant(a,this.domNode)?f:a;b.open({popup:this,x:g.x,y:g.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?"L":"R"});this.focus();
h||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);b.close(this)}},destroy:function(){f.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(t,f,k,q,e,r,m,l,g){q("dijit-legacy-requires")&&
r(0,function(){t(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[m,l],{templateString:g,baseClass:"dijitCheckBox",_setValueAttr:function(e,d){"string"==typeof e&&(this.inherited(arguments),e=!0);this._created&&this.set("checked",e,d)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&
e("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&e("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(t,f){return t("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(k){this._set("readOnly",k);f.set(this.focusNode,"readOnly",
k)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(k){k=this._getSubmitValue(k);this._set("value",k);f.set(this.focusNode,"value",k)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),
function(t,f,k,q,e,r,m,l){return q([e,r,m],{templateString:l,postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());k.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),t.hitch(this,function(e){this.rangeSelect.addOption({value:e,label:this.nls[e]})}));this.rangeSelect.set("value","dateOperatorDays")},
getDijits:function(){return[this._dijit1,this.rangeSelect]},setValueObject:function(e){this.isDefined(e.value)&&this._dijit1.set("value",e.value);this.isDefined(e.range)&&this.rangeSelect.set("value",e.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var e=this.rangeSelect.get("value");"none"===e&&(e=null);return e},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var e={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(e.value)&&(e.value=null);return e}return null},setRequired:function(e){this._dijit1.set("required",e);this.rangeSelect.set("required",e)}})})},"jimu/dijit/_filter/DateIsInValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/text!./DateIsInValueProvider.html ./ValueProvider jimu/filterUtils jimu/utils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(t,f,k,q,e,r,m,l,g){return q([m,e,t],{templateString:r,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},virtualDates:null,postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-date-is-in-value-provider");this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});return["thisWeek","thisMonth","thisQuarter","thisYear"].forEach(k.hitch(this,function(e){this.dateTypeSelect.addOption({value:e,label:this.nls[e]})}))},getDijits:function(){return[this.dateTypeSelect]},
_setValueObject:function(e,d,c,f){if(this.isDefined(d[c])){var b={value:null,virtualDate:""};b.value=d[c];b.virtualDate=d[f];e.setValueObject(b)}},setValueObject:function(e){this.dateTypeSelect.set("value",e.virtualDate)},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var e={isValid:!0,type:this.partObj.valueObj.type,value:null,virtualDate:this.dateTypeSelect.get("value")},d=this.dateTypeSelect.get("value"),
c=l.getRealDateByVirtualDate(d);e.virtualDate=d;c&&(e.value1=g.getDateTimeStr(c[0],"YYYY-MM-DD"),e.value2=g.getDateTimeStr(c[1],"YYYY-MM-DD"));return e},setRequired:function(e){this.dateTypeSelect.set("required",e)},getStatus:function(){return this.dateTypeSelect.get("value")?1:0},_onDateTypeSelectChanged:function(){this.emit("change")}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(t,f,k){return t("dijit.form.DateTextBox",k,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",
popupClass:f,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"jimu/dijit/_SingleFilter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/keys dijit/a11yclick dijit/focus dojo/query dojo/store/Memory jimu/utils jimu/dijit/_filter/ValueProviderFactory dijit/popup jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v){return f([k,q,e,t],{templateString:r,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,runtime:!1,postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);
this.supportFieldTypes.push(this.dateFieldType);this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText},postCreate:function(){this.inherited(arguments);this._initSelf();this.own(p(this.valueTypeSetNode,c,m.hitch(this,this._onValueTypeSetClick)));this.own(p(this.btnDelete,c,m.hitch(this,function(){this._destroySelf()})));this.own(p(document,"click",m.hitch(this,function(a){a=a.target;l.isDescendant(a,
this.valueTypePopupNode)&&!l.hasClass(a,"value-type-popup-icon")||this._closeEsriPopup()})));this.customDijit&&this.own(p(window,"resize",m.hitch(this,function(){this._closeEsriPopup()})))},toJson:function(){var a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},b=this._getFieldObjByUI();if(!b)return null;a.fieldObj=b;b=this._getOperatorByUI();if(!b)return null;a.operator=b;a.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();var b=this._getValueTypeByUI(),
c=this._isUseAskForValues();if(c){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),null;a.interactiveObj={prompt:this.promptTB.get("value"),hint:this.hintTB.get("value"),cascade:"none"};if("unique"===b||"multiple"===b)a.interactiveObj.cascade=this.cascadeSelect.get("value")}a.valueObj={isValid:!0,type:""};c=c?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!c)return null;c.type=b;a.valueObj=c;return a},_getFieldObjByUI:function(){var b=
this._getSelectedFilteringItem(this.fieldsSelect);if(!b)return null;var c="";0!==this.popupFieldsInfo.length&&(c=a.getDateFieldFormatByFieldName(this.popupFieldsInfo,b.name));return{name:b.name,label:b.name,dateFormat:c,shortType:b.shortType,type:b.type}},_getOperatorByUI:function(){var a=this.operatorsSelect.get("value");"none"===a&&(a=null);return a},showDelteIcon:function(){l.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){l.setStyle(this.btnDelete,"display","none")},
_showCaseSensitive:function(){l.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},_hideCaseSensitive:function(){l.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);this._showCaseSensitive()},_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);this._hideCaseSensitive()},_initSelf:function(){this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),
this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(p(this.fieldsSelect,"MouseEnter",m.hitch(this,this._updateFieldsSelectTitle)));this.own(p(this.operatorsSelect,"MouseEnter",m.hitch(this,this._updateOperatorsSelectTitle)));this.enableAskForValues?(l.setStyle(this.cbxAskValues.domNode,"display","inline-block"),l.setStyle(this.promptSection,"display","block"),this.own(p(this.cbxAskValues,"status-change",m.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=
m.hitch(this,this._onCbxAskValuesClicked)):(l.setStyle(this.cbxAskValues.domNode,"display","none"),l.setStyle(this.promptSection,"display","none"));var a=this.layerInfo.fields;a&&0<a.length&&(a=g.filter(a,m.hitch(this,function(a){return 0<=this.supportFieldTypes.indexOf(a.type)})),0<a.length&&(this._initValueTypeUI(),this._enableAllValueTypeOptions(),this._initFieldsSelect(a),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(m.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),
10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._handle1=p(this.fieldsSelect,"change",m.hitch(this,this._onFieldsSelectChange));this._handle2=p(this.operatorsSelect,"change",m.hitch(this,this._onOperatorsSelectChange))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(a,
b){if(this._isStreamServer(a))return!1;a=b.currentVersion?b:b.toJson().layerDefinition;return 10.1<=parseFloat(a.currentVersion)},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title="";var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.fieldsSelect.domNode.title=a.displayName||a.alias||a.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var a=
this.operatorsSelect.get("value");a&&(a=this.operatorsSelect.getOptions(a),this.operatorsSelect.domNode.title=a.label,l.setAttr(this.operatorsSelect.domNode,"aria-label",a.label))},_showValidationErrorTip:function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())}catch(z){console.error(z)}},_getSelectedFilteringItem:function(a){if(a.validate()){var b=a.get("item");if(b)return b}this._showValidationErrorTip(a);return null},_getShortTypeByFieldType:function(a){return a===
this.stringFieldType?"string":a===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(a)?"number":null},_initFieldsSelect:function(a){a=g.map(a,m.hitch(this,function(a,b){var c=m.mixin({},a);c.id=b;c.shortType=this._getShortTypeByFieldType(a.type);c.alias||(c.alias=c.name);a="";"string"===c.shortType?a=this.nls.string:"number"===c.shortType?a=this.nls.number:"date"===c.shortType&&(a=this.nls.date);c.displayName=c.alias+" ("+a+")";return c}));if(0<a.length){var b=new h({data:a});this.fieldsSelect.set("store",
b);this.fieldsSelect.set("value",a[0].id)}setTimeout(m.hitch(this,function(){this.fieldsSelect.focusNode.focus()}),2);this._updateOperatorsByFieldsSelect()},_showPart:function(a){if((this.part=a)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var b=this.part.fieldObj.name;a=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;b=this.fieldsSelect.store.query({name:b});0!==b.length&&(b=b[0])&&(this.fieldsSelect.set("value",
b.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",a),this._resetByFieldAndOperator(this.part),a=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),this.promptTB.set("value",a.prompt||""),this.hintTB.set("value",a.hint||""),"unique"===this.part.valueObj.type||"multiple"===this.part.valueObj.type?this.cascadeSelect.set("value",a.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();
this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",label:this.nls.none});var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.operatorsSelect.shortType=a.shortType,a=u.getOperatorsByShortType(a.shortType,this.isHosted),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),g.forEach(a,m.hitch(this,function(a){this.operatorsSelect.addOption({value:a,
label:this.nls[a]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_updateValueTypeClass:function(){l.removeClass(this.domNode,"value-type");l.removeClass(this.domNode,"field-type");l.removeClass(this.domNode,"unique-type");l.removeClass(this.domNode,"support-cascade");var b=this._getValueTypeByUI();"value"===b?(l.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none")):"field"===b?(l.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value",
"none")):(l.addClass(this.domNode,"unique-type"),this.cascadeSelect.set("value","previous"),b=!0,b=this._getSelectedFilteringItem(this.fieldsSelect),b=a.getCodedValuesOrTypesCount(b,this.layerInfo),(b=0<b?a.isCodedValuesSupportFilter(this.layerInfo,b):!0)?(this.cascadeSelect.set("value","previous"),l.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none"))},_enableValueTypeSelectOption:function(a,c){a=b("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0];c?(l.removeClass(a,
"disabled"),l.setAttr(a,"aria-disabled","false")):(l.addClass(a,"disabled"),l.setAttr(a,"aria-disabled","true"))},_setVisibleValueTypeSelectOption:function(a,c){a=b("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0];c?l.setStyle(a,"display","block"):l.setStyle(a,"display","none")},_calcValueTypePosition:function(a){var b,c;a=l.position(a.target);b=l.position(document.body).w;c=l.position(document.body).h;var d=l.getStyle(this.valueTypePopupNode,"width"),e=l.getStyle(this.valueTypePopupNode,"height");
c=c-a.y-16-10>=e?a.y+16+10:a.y-e-10;b=b-a.x>=d?a.x:a.x+16-d;window.isRTL&&(b=a.x+16>=d?a.x+16-d:a.x);return{left:b,top:c}},_onValueTypeSetClick:function(b){v.open({popup:this.customDijit,around:b.target});var c=this._calcValueTypePosition(b);v.open({x:c.left,y:c.top,popup:this.customDijit});b.stopPropagation();a.isInNavMode()&&n.focus(this.valueTypePopupDelBtn)},_onValueTypeClick:function(a){var c=l.getAttr(a.currentTarget,"data-type");l.hasClass(a.currentTarget,"disabled")?a.stopPropagation():(b("li",
this.valueTypePopupNode).forEach(function(a){l.removeClass(a,"selected")}),l.addClass(a.currentTarget,"selected"),this._resetByFieldAndOperator(null,c),this._closeEsriPopup())},_enableValueTypeOption:function(a){this._enableValueTypeSelectOption("value",a)},_enableFieldTypeOption:function(a){this._enableValueTypeSelectOption("field",a)},_enableUniqueTypeOption:function(a){this._enableValueTypeSelectOption("unique",a)},_enableUniquePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("uniquePredefined",
!1):this._enableValueTypeSelectOption("uniquePredefined",a)},_enableValuesTypeOption:function(a){this._enableValueTypeSelectOption("values",a)},_enableMultipleTypeOption:function(a){this._enableValueTypeSelectOption("multiple",a)},_enableMultiplePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("multiplePredefined",!1):this._enableValueTypeSelectOption("multiplePredefined",a)},_enableAllValueTypeOptions:function(){this._enableValueTypeOption(!0);this._enableFieldTypeOption(!0);
this._enableUniqueTypeOption(!0);this._enableUniquePredefinedTypeOption(!0);this._enableMultipleTypeOption(!0);this._enableMultiplePredefinedTypeOption(!0)},_disableAllValueTypeOptions:function(){this._enableValueTypeOption(!1);this._enableFieldTypeOption(!1);this._enableUniqueTypeOption(!1);this._enableUniquePredefinedTypeOption(!1);this._enableMultipleTypeOption(!1);this._enableMultiplePredefinedTypeOption(!1)},_resetByFieldAndOperator:function(a,b){this._updateOperatorsSelectTitle();this.valueProvider&&
this.valueProvider.destroy();this._hideCaseSensitive();this._disableAllValueTypeOptions();a||(a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},a.fieldObj=this._getFieldObjByUI(),a.operator=this._getOperatorByUI());var c=[],d=null;a.fieldObj&&a.operator&&(c=this.valueProviderFactory.getSupportedValueTypes(a.fieldObj.name,a.operator),a.valueObj?d=a.valueObj.type:(d=b&&0<=c.indexOf(b)?b:c[0],a.valueObj={type:d}),0<=c.indexOf("value")&&this._enableValueTypeOption(!0),0<=c.indexOf("field")&&
this._enableFieldTypeOption(!0),0<=c.indexOf("unique")&&this._enableUniqueTypeOption(!0),0<=c.indexOf("values")&&this._enableValuesTypeOption(!0),0<=c.indexOf("uniquePredefined")&&this._enableUniquePredefinedTypeOption(!0),0<=c.indexOf("multiple")&&this._enableMultipleTypeOption(!0),0<=c.indexOf("multiplePredefined")&&this._enableMultiplePredefinedTypeOption(!0),"value"===d?this._enableValueTypeOption(!0):"field"===d?this._enableFieldTypeOption(!0):"unique"===d?this._enableUniqueTypeOption(!0):"values"===
d?this._enableValuesTypeOption(!0):"uniquePredefined"===d?this._enableUniquePredefinedTypeOption(!0):"multiple"===d?this._enableMultipleTypeOption(!0):"multiplePredefined"===d&&this._enableMultiplePredefinedTypeOption(!0),this._updateValueTypeUI(d));0<c.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(a,this.runtime),this.valueProvider.placeAt(this.valueProviderContainer),this.valueProvider.setValueObject(a.valueObj),this.own(p(this.valueProvider,"change",m.hitch(this,function(){this.emit("change")}))),
this.valueProvider.bindChangeEvents(),this.valueProvider.isBlankValueProvider()?(l.addClass(this.valueProvider.domNode,"hidden"),l.addClass(this.attributeValueContainer,"hidden")):l.removeClass(this.attributeValueContainer,"hidden"),(b=u.getOperatorInfo(a.operator))&&d&&(b[d]&&b[d].supportCaseSensitive&&this._showCaseSensitive(),a&&this.cbxCaseSensitive.setValue(a.caseSensitive))):l.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged();this.emit("change")},_updateWhenValueRadioChanged:function(){this._updatePrompt(!1,
!0);this._updateValueTypeClass()},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();this._updatePrompt(!0)},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){var a=this._getValueTypeByUI();return"uniquePredefined"===a||"multiplePredefined"===a?!0:this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var a=this._isValueRequired();this.valueProvider.setRequired(a)},
_getValueTypeByUI:function(){var a=b("li.selected",this.valueTypePopupNode)[0];return a?l.getAttr(a,"data-type"):null},_closeEsriPopup:function(){this.customDijit&&v.close(this.customDijit)},_destroyEsriPopup:function(){this.customDijit&&(this.customDijit.destroy(),v.close(this.customDijit))},_initValueTypeUI:function(){if(!this.valueTypePopupNode){this.valueTypePopupNode=document.createElement("DIV");l.addClass(this.valueTypePopupNode,"value-type-popup");this.valueTypePopupNode.innerHTML='\x3cdiv class\x3d"value-type-popup-header"\x3e\x3cspan class\x3d"value-type-popup-title jimu-ellipsis" title\x3d"'+
this.nls.setInputType+'"\x3e'+this.nls.setInputType+'\x3c/span\x3e\x3cspan role\x3d"button" tabindex\x3d"0" aria-label\x3d"'+this.nls.deleteText+'" class\x3d"value-type-popup-icon jimu-icon jimu-icon-delete"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul role\x3d"listbox" tabindex\x3d"0"\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"value" title\x3d"'+this.nls.value+'"\x3e\x3cspan\x3e'+this.nls.value+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"field" title\x3d"'+
this.nls.field+'"\x3e\x3cspan\x3e'+this.nls.field+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"unique" title\x3d"'+this.nls.unique+'"\x3e\x3cspan\x3e'+this.nls.unique+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"uniquePredefined" title\x3d"'+this.nls.uniquePredefined+'"\x3e\x3cspan\x3e'+this.nls.uniquePredefined+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiple" title\x3d"'+
this.nls.multiple+'"\x3e\x3cspan\x3e'+this.nls.multiple+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiplePredefined" title\x3d"'+this.nls.multiplePredefined+'"\x3e\x3cspan\x3e'+this.nls.multiplePredefined+"\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e";this.customDijit=new k({baseClass:"jimu-filter-valueType",domNode:this.valueTypePopupNode});this.valueTypePopupDelBtn=b(".value-type-popup-icon",this.valueTypePopupNode)[0];
this.own(p(this.valueTypePopupDelBtn,"click",m.hitch(this,function(a){this._closeEsriPopup();a.stopPropagation()})));this.own(p(this.valueTypePopupDelBtn,"keydown",m.hitch(this,function(b){b.keyCode===d.ENTER||b.keyCode===d.SPACE||b.keyCode===d.ESCAPE?(b.stopPropagation(),this._closeEsriPopup(),a.isInNavMode()&&n.focus(this.valueTypeSetNode)):b.shiftKey||b.keyCode!==d.TAB||this.valueTypeList.focus()})));this.valueTypeList=b("ul",this.valueTypePopupNode)[0];var c=b("li",this.valueTypePopupNode);this.own(p(this.valueTypeList,
"focus",m.hitch(this,function(){this.selectedValueType=b("li.selected",this.valueTypePopupNode)[0];this.selectedValueType.focus()})));this.own(p(this.valueTypeList,"keydown",m.hitch(this,function(b){if(b.keyCode===d.TAB)b.shiftKey?(b.preventDefault(),this.valueTypePopupDelBtn.focus()):(b.preventDefault(),this._closeEsriPopup(),a.isInNavMode()&&n.focus(this.valueTypeSetNode));else{var e,f=!1;if(b.keyCode===d.DOWN_ARROW)for(e=this.selectedValueType,b=0;b<c.length-1;b++)if(f){if("none"!==l.getStyle(c[b],
"display")){e=c[b];break}}else c[b]===this.selectedValueType&&(f=!0);else if(b.keyCode===d.UP_ARROW)for(e=this.selectedValueType,b=c.length-1;0<=b;b--)if(f){if("none"!==l.getStyle(c[b],"display")){e=c[b];break}}else c[b]===this.selectedValueType&&(f=!0);else if(b.keyCode===d.HOME)e=c[0];else if(b.keyCode===d.END)for(b=c.length-1;0<=b;b--)if("none"!==l.getStyle(c[b],"display")){e=c[b];break}e&&(this.selectedValueType=e,e.focus())}})));this.own(p(c,"click",m.hitch(this,function(a){this._onValueTypeClick(a)})));
this.own(p(c,"keydown",m.hitch(this,function(a){a.keyCode===d.ENTER&&(this._onValueTypeClick(a),l.hasClass(a.target,"disabled")||this.valueTypeSetNode.focus())})));this.own(p(this.valueTypePopupNode,"keydown",m.hitch(this,function(a){a.keyCode===d.ESCAPE&&(a.stopPropagation(),n.focus(this.valueTypePopupDelBtn))})))}},_updateValueTypeUI:function(a){b("li",this.valueTypePopupNode).forEach(function(a){l.removeClass(a,"selected")});if(a=b("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0])return l.addClass(a,
"selected")},_updatePrompt:function(a,b){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);!a&&b&&this.cbxAskValues.uncheck(!0);l.setStyle(this.promptTable,"display","table");b=this.operatorsSelect.get("value");var c=this.nls[b],d=!1,e=this._getValueTypeByUI(),f=u.getOperatorInfo(b);f&&e&&(f=f[e])&&f.supportAskForValue&&(d=!0);d||(this.cbxAskValues.uncheck(!0),this.cbxAskValues.setStatus(!1));f=this.cbxAskValues.getValue();(e=0<=["uniquePredefined","multiplePredefined"].indexOf(e)?
!0:!1)?this.cbxAskValues.check(!0):a?f?this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0):d?this.cbxAskValues.status||this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0);this.cbxAskValues.status&&this.cbxAskValues.checked?(l.setStyle(this.promptTable,"display","table"),(a=this._getSelectedFilteringItem(this.fieldsSelect))&&"none"!==b&&this.promptTB.set("value",(a.alias||a.name)+" "+c)):l.setStyle(this.promptTable,"display","none");e?(this.cbxAskValues.setStatus(!1),this.cascadeSelect.setDisabled(!0)):
this.cascadeSelect.setDisabled(!1)},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._destroyEsriPopup();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/aspect dojo/query ./_SingleFilter".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h){return f([k,q,e,t],{templateString:r,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,runtime:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText;this.nls.addText=window.jimuNls.common.add;this.inherited(arguments)},
postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var a=b(".jimu-single-filter",this.allExpsBox),a=p.map(a,l.hitch(this,function(a){return m.byNode(a).toJson()}));return p.every(a,l.hitch(this,function(a){return!!a}))&&0<a.length?{logicalOperator:this.allAnySelect.value,parts:a}:null},showDelteIcon:function(){g.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){g.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(d(this.btnDelete,
c,l.hitch(this,function(){this._destroySelf()})));this.own(d(this.btnAdd,c,l.hitch(this,function(){this._addSingleFilter();this.emit("change")})));if(this.partsObj){this.allAnySelect.value=this.partsObj.logicalOperator;var a=this.partsObj.parts||[];0===a.length?(this._addSingleFilter(),this._addSingleFilter()):1===a.length?(this._addSingleFilter(a[0]),this._addSingleFilter()):p.forEach(a,l.hitch(this,function(a){this._addSingleFilter(a)}))}else this._addSingleFilter(),this._addSingleFilter();setTimeout(l.hitch(this,
function(){this.allAnySelect.focus()}),5)},_addSingleFilter:function(a){a=new h({url:this.url,layerInfo:this.layerInfo,popupFieldsInfo:this.popupFieldsInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,part:a,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,isInFilterSet:!0,runtime:this.runtime});a.placeAt(this.allExpsBox);a.startup();this.own(n.after(a,
"_destroySelf",l.hitch(this,function(){this._checkFilterNumbers();this.allAnySelect.focus()})));this.own(d(a,"change",l.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_checkFilterNumbers:function(){var a=b(".jimu-single-filter",this.allExpsBox),c=2<a.length;p.forEach(a,l.hitch(this,function(a){a=m.byNode(a);c?a.showDelteIcon():a.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter ./_filter/ValueProviderFactory".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u){return e([r,m,l,f],{baseClass:"jimu-filter-parameters",templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',_filterUtils:null,_spObj:null,nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,featureLayerId:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new b;this.OPERATORS=g.clone(this._filterUtils.OPERATORS);
this._spObj={}},destroy:function(){this.clear();this._filterUtils=null;this.inherited(arguments)},getFilterExpr:function(a){var b=this._getNewValidPartsObj(this.partsObj,!0),c=b?this._getFilterExprByPartsObj(b):null;return a&&a.ifDisplaySQL?void 0===b.displaySQL?c:b.displaySQL:c},getValueProviders:function(){for(var a=[],b=this._getAllInteractiveSinglePartArray(this.partsObj),c=0;c<b.length;c++){var d=b[c].spId;d&&(d=this._getSingleFilterParameterBySpId(d),a.push(d))}return a},_getNewValidPartsObj:function(a,
b){a=g.clone(a);for(var c={logicalOperator:a.logicalOperator,parts:[]},e=g.hitch(this,function(a){if(a.spId){var b=this._getSingleFilterParameterBySpId(a.spId),c=b.getValueObject();a.valueObj=c;if(!c||"uniquePredefined"!==c.type&&"multiplePredefined"!==c.type)return c&&"multipleDynamic"===c.type?0<c.value.length?1:-1:c&&"unique"===c.type?null===c.value||void 0===c.value||""===c.value?-1:1:b.getStatus();var b=[],d;for(d in c.value)c.value[d].isChecked&&b.push(c.value[d]);if(0<b.length)return a.valueObj.value=
b,1;a.valueObj.value="";return-1}return a.valueObj?1:-1}),f=g.hitch(this,function(a){var b=e(a);0<b&&c.parts.push(a);return b}),h=g.hitch(this,function(a){var b=[];a.parts=d.filter(a.parts,g.hitch(this,function(a){a=e(a);b.push(a);return 0<a}));1===a.parts.length?c.parts.push(a.parts[0]):2<=a.parts.length&&c.parts.push(a);return Math.min.apply(b,b)}),k=0;k<a.parts.length;k++){var l=a.parts[k];if(l.parts){if(0>h(l)&&b)return null}else if(0>f(l)&&b&&l.valueObj&&"uniquePredefined"!==l.valueObj.type&&
"multiplePredefined"!==l.valueObj.type&&"unique"!==l.valueObj.type)return null}return c},_getFilterExprByPartsObj:function(a){this._filterUtils.isHosted=h.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(a)},_getSingleFilterParameterBySpId:function(a){return this._spObj[a]},_getCascadeFilterPartsObj:function(a){var b={logicalOperator:this.partsObj.logicalOperator,parts:[]},c=g.clone(this.partsObj),e,f,h;e="none";a.interactiveObj&&a.interactiveObj.cascade&&(e=a.interactiveObj.cascade);
if("previous"===e)for(e=0;e<c.parts.length;e++)f=c.parts[e],f.majorCascadeIndex<a.majorCascadeIndex?b.parts.push(f):f.parts&&f.majorCascadeIndex===a.majorCascadeIndex&&(h=g.clone(f),h.parts=d.filter(h.parts,g.hitch(this,function(b){return b.minorCascadeIndex<a.minorCascadeIndex})),b.parts.push(h));else if("all"===e)for(e=0;e<c.parts.length;e++)f=c.parts[e],f.majorCascadeIndex!==a.majorCascadeIndex?b.parts.push(f):f.majorCascadeIndex===a.majorCascadeIndex&&f.parts&&(h=g.clone(f),d.some(f.parts,g.hitch(this,
function(b){return b.spId===a.spId}))&&(h.parts=d.filter(h.parts,g.hitch(this,function(b){return b.minorCascadeIndex!==a.minorCascadeIndex})),b.parts.push(h)));return b=this._getNewValidPartsObj(b,!1)},_getCascadeFilterExpr:function(a){var b="1\x3d1";(a=this._getCascadeFilterPartsObj(a))&&(b=this._getFilterExprByPartsObj(a));b||(b="1\x3d1");return b},clear:function(){this.featureLayerId=this.url=null;var a=c(".jimu-single-filter-parameter",this.tbody);d.forEach(a,g.hitch(this,function(a){n.byNode(a).destroy()}));
p.empty(this.tbody);this.layerInfo=this.partsObj=null},build:function(b,e,f,h){var l=new k;this.clear();this.url=b;this.layerInfo=e;this.partsObj=g.clone(f);this.partsObj=this._updatePartsObj(this.partsObj);this.featureLayerId=h;this._setCascadeIndexForPartsObj(this.partsObj);b=this._getAllInteractiveSinglePartArray(this.partsObj);var n=this.partsObj.wId;if(0<b.length){var m=new u({url:this.url,layerDefinition:e,featureLayerId:this.featureLayerId});b=d.map(b,g.hitch(this,function(b,d){n&&(b.vpId=
n+"_"+d);d=p.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},this.tbody);d=c("td",d)[0];var f=this._getFieldInfo(b.fieldObj.name,this.layerInfo),f=new a({nls:this.nls,url:this.url,layerDefinition:e,fieldInfo:f,part:b,valueProviderFactory:m});this.own(t(f,"change",g.hitch(this,this._onSingleFilterParameterChanged)));this.own(t(f,"enter",g.hitch(this,this._catchSingleFilterParameterEnter)));f.placeAt(d);f.startup();b.spId=f.id;return this._spObj[f.id]=f}));d.forEach(b,g.hitch(this,function(a){a.valueProvider.getCascadeFilterExpr=
g.hitch(this,this._getCascadeFilterExpr,a.part);a.valueProvider.getCascadeFilterPartsObj=g.hitch(this,this._getCascadeFilterPartsObj,a.part)}));b=d.map(b,g.hitch(this,function(a){return a.init()}));q(b).then(g.hitch(this,function(a){l.resolve(a)}),g.hitch(this,function(){l.reject()}))}else l.resolve();return l},_updatePartsObj:function(a){d.forEach(a,g.hitch(this,function(a){a.parts?d.forEach(a.parts,g.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade=
"previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},_setCascadeIndexForPartsObj:function(a){for(var b=0;b<a.parts.length;b++){var c=a.parts[b];c.majorCascadeIndex="AND"===a.logicalOperator?b:0;c.minorCascadeIndex=0;c.cascadeIndex=c.majorCascadeIndex;if(c.parts)for(var d=0;d<c.parts.length;d++){var e=c.parts[d];
e.majorCascadeIndex=c.majorCascadeIndex;e.minorCascadeIndex="AND"===c.logicalOperator?d:0;e.cascadeIndex=parseFloat(e.majorCascadeIndex+"."+e.minorCascadeIndex)}}},_getFieldInfo:function(a,b){b=b.fields;for(var c=0;c<b.length;c++){var d=b[c];if(a===d.name)return d}return null},_getAllInteractiveSinglePartArray:function(a){for(var b=[],c=0;c<a.parts.length;c++){var d=a.parts[c];if(d.parts)for(var e=0;e<d.parts.length;e++){var f=d.parts[e];f.interactiveObj&&b.push(f)}else d.interactiveObj&&b.push(d)}return b},
_catchSingleFilterParameterEnter:function(){this.emit("enter")},_onSingleFilterParameterChanged:function(){this.emit("change",this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang".split(" "),function(t,f,k,q,e,r,m,l,g){return q([e,r,m,f],{baseClass:"jimu-single-filter-parameter",
templateString:l,valueProvider:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,part:null,valueProviderFactory:null,postCreate:function(){this.inherited(arguments);this.valueProvider=this.valueProviderFactory.getValueProvider(this.part,!0);this.valueProvider.placeAt(this.valueProviderTd);this.own(t(this.valueProvider,"change",g.hitch(this,this._onValueProviderChanged)));this.own(t(this.valueProvider,"enter",g.hitch(this,this._onValueProviderEnter)));this.valueProvider.bindChangeEvents()},
getValueObject:function(){return this.valueProvider.getValueObject()},init:function(){return this.build(this.fieldInfo,this.part)},build:function(e,d){var c=null;this.fieldInfo=e;this.part=d;if(e=d.interactiveObj)this.promptNode.innerHTML=e.prompt||"",this.hintNode.innerHTML=e.hint||"";(e=this.valueProvider.setValueObject(this.part.valueObj))&&"function"===typeof e.then?c=e:(c=new k,c.resolve(this.valueProvider));return c},disable:function(){this.valueProvider.disable()},enable:function(){this.valueProvider.enable()},
isEnabled:function(){return this.valueProvider.isEnabled()},getStatus:function(){return this.valueProvider.getStatus()},_showValidationErrorTip:function(e){!e.validate()&&e.domNode&&e.focusNode&&(e.focusNode.focus(),e.focusNode.blur())},_onValueProviderEnter:function(){this.emit("enter")},_onValueProviderChanged:function(){this.emit("change")}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(t,f,k,q,e,r,m,l,g){return r("dijit.layout._LayoutWidget",[f,k,q],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);m.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var f=this.getParent&&this.getParent();f&&f.isLayoutContainer||(this.resize(),this.own(e.on("resize",t.hitch(this,"resize"))))}},resize:function(e,d){var c=this.domNode;e&&l.setMarginBox(c,e);d=d||{};
t.mixin(d,e||{});"h"in d&&"w"in d||(d=t.mixin(l.getMarginBox(c),d));e=g.getComputedStyle(c);var f=l.getMarginExtents(c,e),b=l.getBorderExtents(c,e);d=this._borderBox={w:d.w-(f.w+b.w),h:d.h-(f.h+b.h)};f=l.getPadExtents(c,e);this._contentBox={l:g.toPixelValue(c,e.paddingLeft),t:g.toPixelValue(c,e.paddingTop),w:d.w-f.w,h:d.h-f.h};this.layout()},layout:function(){},_setupChild:function(e){m.add(e.domNode,this.baseClass+"-child "+(e.baseClass?this.baseClass+"-"+e.baseClass:""))},addChild:function(e,d){this.inherited(arguments);
this._started&&this._setupChild(e)},removeChild:function(e){m.remove(e.domNode,this.baseClass+"-child"+(e.baseClass?" "+this.baseClass+"-"+e.baseClass:""));this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(t,f,k){return t("dgrid.OnDemandGrid",[f,k],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),
function(t,f,k,q,e,r,m){function l(d,c){c&&c.nodeType&&d.appendChild(c)}function g(d,c,e,b){if(this.formatter){b=this.formatter;var f=this.grid.formatterScope;e.innerHTML="string"===typeof b&&f?f[b](c,d):this.formatter(c,d)}else null!=c&&e.appendChild(document.createTextNode(c))}var p=8>q("ie")&&!q("quirks");f=f("dgrid.Grid",r,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(d){return"object"!=typeof d?this.columns[d]:this.cell(d).column},listType:"grid",cell:function(d,
c){if(d.column&&d.element)return d;d.target&&d.target.nodeType&&(d=d.target);var e;if(d.nodeType){do{if(this._rowIdToObject[d.id])break;var b=d.columnId;if(b){c=b;e=d;break}d=d.parentNode}while(d&&d!=this.domNode)}if(!e&&"undefined"!=typeof c){var f=this.row(d);if(b=f&&f.element)for(var b=b.getElementsByTagName("td"),a=0;a<b.length;a++)if(b[a].columnId==c){e=b[a];break}}if(null!=d)return{row:f||this.row(d),column:c&&this.column(c),element:e}},createRowCells:function(d,c,f,b){var g=e("table.dgrid-row-table[role\x3dpresentation]"),
a=9>q("ie")||q("quirks")?e(g,"tbody"):g,k,l,n,r,t,C,A,w,B,F;f=f||this.subRows;l=0;for(n=f.length;l<n;l++)for(C=f[l],k=e(a,"tr"),C.className&&e(k,"."+C.className),r=0,t=C.length;r<t;r++){A=C[r];w=A.id;B=A.field?".field-"+m.escapeCssIdentifier(A.field,"-"):"";(F="function"===typeof A.className?A.className(b):A.className)&&(B+="."+F);B=e(d+(".dgrid-cell.dgrid-cell-padding"+(w?".dgrid-column-"+m.escapeCssIdentifier(w,"-"):"")+B.replace(/ +/g,"."))+"[role\x3d"+("th"===d?"columnheader":"gridcell")+"]");
B.columnId=w;p?(w=e(B,"!dgrid-cell-padding div.dgrid-cell-padding"),B.contents=w):w=B;if(F=A.colSpan)B.colSpan=F;if(F=A.rowSpan)B.rowSpan=F;c(w,A);k.appendChild(B)}return g},left:function(d,c){d.element||(d=this.cell(d));return this.cell(this._move(d,-(c||1),"dgrid-cell"))},right:function(d,c){d.element||(d=this.cell(d));return this.cell(this._move(d,c||1,"dgrid-cell"))},renderRow:function(d,c){var f=this.createRowCells("td",function(b,e){var a=d;e.get?a=e.get(d):"field"in e&&"_item"!=e.field&&(a=
a[e.field]);e.renderCell?l(b,e.renderCell(d,a,b,c)):g.call(e,d,a,b,c)},c&&c.subRows,d);return e("div[role\x3drow]\x3e",f)},renderHeader:function(){var d=this,c=this.headerNode,f=c.childNodes.length;for(c.setAttribute("role","row");f--;)e(c.childNodes[f],"!");f=this.createRowCells("th",function(b,c){var a=c.headerNode=b;p&&(b=b.parentNode);var d=c.field;d&&(b.field=d);c.renderHeaderCell?l(a,c.renderHeaderCell(a)):("label"in c||c.field)&&a.appendChild(document.createTextNode("label"in c?c.label:c.field));
!1!==c.sortable&&d&&"_item"!=d&&(b.sortable=!0,b.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[f.id=this.id+"-header"]=this.columns;c.appendChild(f);this._sortListener&&this._sortListener.remove();this._sortListener=k(f,"click,keydown",function(b){if("click"==b.type||32==b.keyCode||!q("opera")&&13==b.keyCode){var e=b.target,a,f,g;do if(e.sortable){g=[{attribute:a=e.field||e.columnId,descending:(f=d._sort[0])&&f.attribute==a&&!f.descending}];a={bubbles:!0,
cancelable:!0,grid:d,parentType:b.type,sort:g};k.emit(b.target,"dgrid-sort",a)&&(d._sortNode=e,d.set("sort",g));break}while((e=e.parentNode)&&e!=c)}})},resize:function(){var d=this.headerNode.firstChild,c=this.contentNode,e;this.inherited(arguments);if(!q("ie")||7<q("ie")&&!q("quirks"))c.style.width="",c&&d&&(e=d.offsetWidth)!=c.offsetWidth&&(c.style.width=e+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(d,
c){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(d){var c=this.columns,e;for(e in c){var b=c[e];if(b.field==d)return b.headerNode}},updateSortArrow:function(d,c){this._lastSortedArrow&&(e(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),e(this._lastSortedArrow,"!"),delete this._lastSortedArrow);c&&(this._sort=d);if(d[0]){c=d[0].attribute;d=d[0].descending;c=this._sortNode||this._findSortArrowParent(c);var f;delete this._sortNode;c&&(c=c.contents||
c,f=this._lastSortedArrow=e("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),f.innerHTML="\x26nbsp;",c.insertBefore(f,c.firstChild),e(c,d?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(d,c){return this.addCssRule("#"+m.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+m.escapeCssIdentifier(d,"-"),c)},_configColumns:function(d,c){var e=[],b=c instanceof Array;m.each(c,function(f,a){"string"==typeof f&&(c[a]=f={label:f});b||f.field||(f.field=a);a=f.id=f.id||(isNaN(a)?
a:d+a);this._configColumn&&(this._configColumn(f,a,c,d),a=f.id);b&&(this.columns[a]=f);f.grid=this;"function"===typeof f.init&&f.init();e.push(f)},this);return b?c:e},_destroyColumns:function(){var d=this.subRows,c=d&&d.length,e,b,f,a;this.cleanup();for(e=0;e<c;e++)for(b=0,a=d[e].length;b<a;b++)f=d[e][b],"function"===typeof f.destroy&&f.destroy()},configStructure:function(){var d=this.subRows,c=this._columns=this.columns;this.columns=!c||c instanceof Array?{}:c;if(d)for(c=0;c<d.length;c++)d[c]=this._configColumns(c+
"-",d[c]);else this.subRows=[this._configColumns("",c)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(d){this._destroyColumns();this.subRows=null;this.columns=d;this._updateColumns()},_setSubRows:function(d){this._destroyColumns();this.subRows=d;this._updateColumns()},setColumns:function(d){t.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",d)},setSubRows:function(d){t.deprecated("setSubRows(...)",'use set("subRows", ...) instead',
"dgrid 0.4");this.set("subRows",d)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});f.appendIfNode=l;f.defaultRenderCell=g;return f})},"put-selector/put":function(){(function(t){var f,k=/[-+,> ]/;t([],f=function(q,e){function r(d){function c(){t&&a&&t!=a&&(a==d&&(e||(e=k.test(E)&&q.createDocumentFragment()))?
e:a).insertBefore(t,f||null)}for(var e,b,f,a,t,v=arguments,x=v[0],z=0;z<v.length;z++){var E=v[z];if("object"==typeof E){b=!1;if(E instanceof Array){t=q.createDocumentFragment();for(var C=0;C<E.length;C++)t.appendChild(r(E[C]));E=t}if(E.nodeType)t=E,c(),a=E,f=0;else for(C in E)t[C]=E[C]}else if(b)b=!1,t.appendChild(q.createTextNode(E));else{1>z&&(d=null);b=!0;if(x=E.replace(m,function(b,e,h,k,n,m){e&&(c(),"-"==e||"+"==e?(a=(f=t||a).parentNode,t=null,"+"==e&&(f=f.nextSibling)):("\x3c"==e?a=t=(t||a).parentNode:
(","==e?a=d:t&&(a=t),t=null),f=0),t&&(a=t));if((b=!h&&k)||!t&&(h||n))"$"==b?(b=v[++z],a.appendChild(q.createTextNode(b))):(b=b||r.defaultTag,(e=p&&v[z+1]&&v[z+1].name)&&(b="\x3c"+b+' name\x3d"'+e+'"\x3e'),t=g&&~(l=b.indexOf("|"))?q.createElementNS(g[b.slice(0,l)],b.slice(l+1)):q.createElement(b));if(h)if("$"==k&&(k=v[++z]),"#"==h)t.id=k;else if(e=(b=t.className)&&(" "+b+" ").replace(" "+k+" "," "),"."==h)t.className=b?(e+k).substring(1):k;else if("!"==E){var u;p?r("div",t,"\x3c").innerHTML="":(u=
t.parentNode)&&u.removeChild(t)}else e=e.substring(1,e.length-1),e!=b&&(t.className=e);n&&("$"==m&&(m=v[++z]),"style"==n?t.style.cssText=m:(h="!"==n.charAt(0)?(n=n.substring(1))&&"removeAttribute":"setAttribute",m=""===m?n:m,g&&~(l=n.indexOf("|"))?t[h+"NS"](g[n.slice(0,l)],n.slice(l+1),m):t[h](n,m)));return""}))throw new SyntaxError("Unexpected char "+x+" in "+E);c();a=x=t||a}}d&&e&&d.appendChild(e);return x}k=e||k;var m=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,
l,g=!1;q=q||document;var p="object"==typeof q.createElement;r.addNamespace=function(d,c){q.createElementNS?(g||(g={}))[d]=c:q.namespaces.add(d,c)};r.defaultTag="div";r.forDocument=f;return r})})(function(t,f,k){k=k||f;"function"===typeof define?define([],function(){return k()}):"undefined"==typeof window?require("./node-html")(module,k):put=k()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),
function(t,f,k,q,e,r,m,l,g){function p(a,b){g(document.body,a,".dgrid-scrollbar-measure");b=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return b}function d(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+b);g(this.domNode,b);this._class=a}function c(){return this._class}function n(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function b(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&
(this.bodyNode.scrollTop=a.y)}l("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var h,a;e.add("dom-scrollbar-width",function(a,b,c){return p(c,"Width")});e.add("dom-scrollbar-height",function(a,b,c){return p(c,"Height")});e.add("dom-rtl-scrollbar-left",function(a,b,c){a=g("div");g(document.body,c,".dgrid-scrollbar-measure[dir\x3drtl]");g(c,a);b=!!e("ie")||!!e("trident")||a.offsetLeft>=e("dom-scrollbar-width");c.className="";document.body.removeChild(c);g(a,"!");c.removeAttribute("dir");
return b});var u=0,v=/ +/g,x=7>e("ie")&&!e("quirks")?function(){var a,b,c;this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a)&&(this.resize(),this._prevWinDims=[b,a])}:function(){this._started&&this.resize()};return f("dgrid.List",e("touch")?m:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,
postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||g("div");var c;a?(this.params=a,f.safeMixin(this,a),c=a["class"]||a.className||b.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject=
{};this.postMixInProperties&&this.postMixInProperties();this.id=b.id=b.id||this.id||"dgrid_"+u++;null===this.useTouchScroll&&(this.useTouchScroll=!e("dom-scrollbar-width"));this.buildRendering();c&&d.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,c=this,d,f,h,k;k=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className=
"";g(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));d=this.headerNode=g(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(e("quirks")||8>e("ie"))&&g(a,"div.dgrid-spacer");f=this.bodyNode=g(a,"div.dgrid-scroller");e("ff")&&(f.tabIndex=-1);this.headerScrollNode=g(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));h=this.footerNode=g("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));
g(a,h);k&&(a.className+=" dgrid-rtl"+(e("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));q(f,"scroll",function(b){c.showHeader&&(d.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();q.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=g(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=q(window,"resize",r.throttleDelayed(x,this)))},postCreate:e("touch")?function(){this.useTouchScroll&&
this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var b=this.bodyNode,c=this.headerNode,d=this.footerNode,f=c.offsetHeight,g=this.showFooter?d.offsetHeight:0,k=e("quirks")||7>e("ie");this.headerScrollNode.style.height=b.style.marginTop=f+"px";b.style.marginBottom=g+"px";k&&(b.style.height="",b.style.height=Math.max(this.domNode.offsetHeight-
f-g,0)+"px",g&&(d.style.bottom="1px",setTimeout(function(){d.style.bottom=""},0)));h||(h=e("dom-scrollbar-width"),a=e("dom-scrollbar-height"),e("ie")&&(h++,a++),r.addCssRule(".dgrid-scrollbar-width","width: "+h+"px"),r.addCssRule(".dgrid-scrollbar-height","height: "+a+"px"),17==h||k||(r.addCssRule(".dgrid-header-row","right: "+h+"px"),r.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+h+"px")));k&&(c.style.width=b.clientWidth+"px",setTimeout(function(){c.scrollLeft=b.scrollLeft},0))},addCssRule:function(a,
b){a=r.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(a);return a},on:function(a,b){a=q(this.domNode,a,b);e("dom-addeventlistener")||this._listeners.push(a);return a},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();
delete this._listeners}this._started=!1;this.cleanup();g(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,c,d,e){if(b){var f=this.insertRow(a,b,c,d,e);g(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){g(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=
a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&g(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<q)for(var d=0;d<b.length;d++){var f=b[d],g=m[f?0:m.length-1];if(g=g&&e(g)){var k=g[f?"previousSibling":"nextSibling"];k&&(k=h.row(k));k&&k.element!=g&&(f=f?"unshift":"push",a[f](k.data),
m[f](k.element),c.count++)}}}function e(a){return!k.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function f(a){u=h.insertRow(a,t,null,l++,c);u.observerIndex=q;return u}function g(a){v=a.slice(0);(p=b?b.parentNode:h.contentNode)&&p.parentNode&&(p!==h.contentNode||a.length)?(p.insertBefore(t,b||null),(u=a[a.length-1])&&h.adjustRowIndices(u)):n[q]&&h.cleanEmptyObservers&&"undefined"!==typeof q&&(n[q].cancel(),n[q]=0,h._numObservers--);m=a;r&&(r.rows=
m)}c=c||{};var h=this,l=c.start||0,n=this.observers,m,p,q;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var r=a.observe(function(f,g,k){var l,n,r;-1<g&&m[g]&&(l=m.splice(g,1)[0],l.parentNode==p&&((n=l.nextSibling)&&g!=k&&n.rowIndex--,h.removeRow(l)),c.count--,h._processScroll&&h._processScroll());if(-1<k){if(m.length)if(0===k)r=(r=m[k])&&e(r);else{if(r=m[k-1])r=e(r),r=(r.connected||r).nextSibling}else r=h._getFirstRowSibling&&h._getFirstRowSibling(p);l&&r&&l.id===
r.id&&(r=(r.connected||r).nextSibling);r&&!r.parentNode&&(r=document.getElementById(r.id));l=b&&b.parentNode||r&&r.parentNode||h.contentNode;if(l=h.newRow(f,l,r,c.start+k,c))if(l.observerIndex=q,m.splice(k,0,l),!n||k<g)n=(n=l.previousSibling)&&n.rowIndex+1!=l.rowIndex&&0!=l.rowIndex?n:l;c.count++}0===g?d(1,1):g===a.length-(-1===k?0:1)&&d(0,0);g!=k&&n&&h.adjustRowIndices(n);h._onNotification(m,f,g,k)},!0);q=n.push(r)-1}var t=document.createDocumentFragment(),u,v;if(a.map){if(m=a.map(f,console.error),
m.then)return a.then(function(b){a=b;return m.then(function(a){g(a);d(1,1,0,0);return v})})}else{m=[];for(var x=0,z=a.length;x<z;x++)m[x]=f(a[x])}g(m);d(1,1,0,0);return v},_onNotification:function(a,b,c,d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));
g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);h&&this.adjustRowIndices(h);g.rowIndex=d;return g},renderRow:function(a,b){return g("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||g(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=
a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?
1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:e("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):b.call(this,a)}:b,getScrollPosition:e("touch")?function(){return this.useTouchScroll?
this.inherited(arguments):n.call(this)}:n,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:c,_setClass:d,_getClassName:c,_setClassName:d,_setSort:function(a,b){this._sort=
"string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,d){c=c[a];d=d[a];void 0===c&&(c="");void 0===d&&(d="");return c==d?0:c>d==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){t.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=
this.headerNode;this.showHeader=a;g(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){t.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;g(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(t,f){t.add("dom-contains",
function(e,f,d){return!!d.contains});var k=[],q,e,r,m=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,l={defaultDelay:15,throttle:function(e,f,d){var c=!1;d=d||l.defaultDelay;return function(){c||(c=!0,e.apply(f,arguments),setTimeout(function(){c=!1},d))}},throttleDelayed:function(e,f,d){var c=!1;d=d||l.defaultDelay;return function(){if(!c){c=!0;var g=arguments;setTimeout(function(){c=!1;e.apply(f,g)},d)}}},debounce:function(e,f,d){var c;d=d||l.defaultDelay;return function(){c&&(clearTimeout(c),c=null);var g=arguments;
c=setTimeout(function(){e.apply(f,g)},d)}},each:function(e,f,d){var c,g;if(e)if("number"===typeof e.length)for(c=0,g=e.length;c<g;c++)f.call(d,e[c],c,e);else for(c in e)f.call(d,e[c],c,e)},contains:function(e,f){return t("dom-contains")?e.contains(f):e.compareDocumentPosition(f)&8},addCssRule:function(g,l){q||(q=f(document.getElementsByTagName("head")[0],"style"),q=q.sheet||q.styleSheet,e=q.deleteRule?"deleteRule":"removeRule",r=q.cssRules?"cssRules":"rules");var d=k.length;k[d]=(q.cssRules||q.rules).length;
q.addRule?q.addRule(g,l):q.insertRule(g+"{"+l+"}",k[d]);return{get:function(c){return q[r][k[d]].style[c]},set:function(c,e){"undefined"!==typeof k[d]&&(q[r][k[d]].style[c]=e)},remove:function(){var c=k[d],f,b;if(void 0!==c)for(q[e](c),k[d]=void 0,f=d+1,b=k.length;f<b;f++)k[f]>c&&k[f]--}}},escapeCssIdentifier:function(e,f){return"string"===typeof e?e.replace(m,f||"\\$1"):e}};return l})},"xstyle/has-class":function(){define(["dojo/has"],function(t){var f={};return function(){for(var k,q=arguments,
e=0;e<q.length;e++)if(k=q[e],!f[k]){f[k]=!0;var r=k.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),m=t(r[2]),l=-r[4];(0<l?l<=m&&(-r[5]||l)>=m:!!m)==!r[1]&&(document.documentElement.className+=" has-"+k)}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(t,f,k,q,e,r,m,l,g){return k("dgrid.OnDemandList",[t,f],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,
bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:l.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var e=this;m(this.bodyNode,"scroll",l[this.pagingMethod](function(d){e._processScroll(d)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(f,d){function c(a){g(r,"!");if(a)throw k._refreshDeferred&&(k._refreshDeferred.reject(a),
delete k._refreshDeferred),a;}var k=this,b=d&&d.container||this.contentNode,h={query:f,count:0,options:d},a,l=this.preload,m,p={node:g(b,"div.dgrid-preload",{rowIndex:0}),count:0,query:f,next:h,options:d};p.node.style.height="0";h.node=a=g(b,"div.dgrid-preload");h.previous=p;a.rowIndex=this.minRowsPerPage;l?((h.next=l.next)&&a.offsetTop>=l.node.offsetTop?h.previous=l:(h.next=l,h.previous=l.previous),h.previous.next=h,h.next.previous=h):this.preload=h;var r=g(a,"-div.dgrid-loading");g(r,"div.dgrid-below").innerHTML=
this.loadingMessage;d=q.mixin(this.get("queryOptions"),d,{start:0,count:this.minRowsPerPage},"level"in f?{queryLevel:f.level}:null);this._trackError(function(){return m=f(d)});if("undefined"===typeof m)c();else return e.when(k.renderArray(m,a,d),function(b){return e.when("undefined"===typeof m.total?m.length:m.total,function(c){var e=b.length,f=a.parentNode,l=k.noDataNode;g(r,"!");"queryLevel"in d||(k._total=c);0===c&&f&&(l&&(g(l,"!"),delete k.noDataNode),k.noDataNode=l=g("div.dgrid-no-data"),f.insertBefore(l,
k._getFirstRowSibling(f)),l.innerHTML=k.noDataMessage);for(l=f=0;l<e;l++)f+=k._calcRowHeight(b[l]);e&&f&&(k.rowHeight=f/e);f=k.rowHeight*k.bufferRows;f>k.farOffRemoval&&(k.farOffRemoval=f);c-=e;h.count=c;a.rowIndex=e;c?a.style.height=Math.min(c*k.rowHeight,k.maxEmptySpace)+"px":(a.style.display="none",d.count++);k._previousScrollPosition&&(k.scrollTo(k._previousScrollPosition),delete k._previousScrollPosition);k._processScroll();k._refreshDeferred&&(k._refreshDeferred.resolve(m),delete k._refreshDeferred);
return b},c)},c),m},refresh:function(f){var d=this,c=f&&f.keepScrollPosition,g;"undefined"===typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return c=this._refreshDeferred=new e,g=d.renderQuery(function(b){return d.store.query(d.query,b)}),"undefined"===typeof g&&c.reject(),c.then(function(b){d._refreshTimeout=setTimeout(function(){m.emit(d.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:d,results:b});
d._refreshTimeout=null},0);delete d._refreshDeferred;return b},function(b){delete d._refreshDeferred;throw b;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(e){return e.lastChild},_calcRowHeight:function(e){var d=e.nextSibling;return d&&!/\bdgrid-preload\b/.test(d.className)?d.offsetTop-e.offsetTop:e.offsetHeight},lastScrollTop:0,_processScroll:function(f){function d(a,d,e,f){var h=b.farOffRemoval,k=a.node;if(d>2*h){for(var l,n=k[e],m=0,p=0,q=[];l=
n;){var r=b._calcRowHeight(l);if(m+r+h>d||0>n.className.indexOf("dgrid-row")&&0>n.className.indexOf("dgrid-loading"))break;n=l[e];m+=r;p+=l.count||1;b.removeRow(l,!0);q.push(l)}a.count+=p;f?(k.rowIndex-=p,c(a)):k.style.height=k.offsetHeight+m+"px";var t=g("div",q);setTimeout(function(){g(t,"!")},1)}}function c(a,c){a.node.style.height=Math.min(a.count*b.rowHeight,c?Infinity:b.maxEmptySpace)+"px"}function k(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var b=this,h=b.bodyNode;
f=f&&f.scrollTop||this.getScrollPosition().y;var h=h.offsetHeight+f,a,l,m=b.preload,p=b.lastScrollTop,r=b.bufferRows*b.rowHeight,t=r-b.rowHeight,C,A,w,B=!0;for(b.lastScrollTop=f;m&&!m.node.offsetWidth;)m=m.previous;for(;m&&m!=a;){a=b.preload;b.preload=m;l=m.node;var F=l.offsetTop;if(h+1+t<F)m=k(m,B=!1);else if(f-1-t>F+l.offsetHeight)m=k(m,B=!0);else{var D=((l.rowIndex?f-r:h)-F)/b.rowHeight,F=(h-f+2*r)/b.rowHeight,F=F+Math.min(Math.abs(Math.max(Math.min((f-p)*b.rowHeight,b.maxRowsPerPage/2),b.maxRowsPerPage/
-2)),10);0==l.rowIndex&&(D-=F);D=Math.max(D,0);10>D&&0<D&&F+D<b.maxRowsPerPage&&(F+=Math.max(0,D),D=0);F=Math.min(Math.max(F,b.minRowsPerPage),b.maxRowsPerPage,m.count);if(0==F)m=k(m,B);else{var F=Math.ceil(F),D=Math.min(Math.floor(D),m.count-F),G=q.mixin(b.get("queryOptions"),m.options);m.count-=F;var H=l,M,L=b.queryRowsOverlap,J=(0<l.rowIndex||l.offsetTop>f)&&m;if(J){var K=m.previous;K&&(d(K,f-(K.node.offsetTop+K.node.offsetHeight),"nextSibling"),0<D&&K.node==l.previousSibling?(D=Math.min(m.count,
D),m.previous.count+=D,c(m.previous,!0),l.rowIndex+=D,L=0):F+=D,m.count-=D);G.start=l.rowIndex-L;G.count=Math.min(F+L,b.maxRowsPerPage);l.rowIndex=G.start+G.count}else m.next&&(d(m.next,m.next.node.offsetTop-h,"previousSibling",!0),H=l.nextSibling,H==m.next.node?(m.next.count+=m.count-D,m.next.node.rowIndex=D+F,c(m.next),m.count=D,L=0):M=!0),G.start=m.count,G.count=Math.min(F+L,b.maxRowsPerPage);M&&H&&H.offsetWidth&&(M=H.offsetTop);c(m);"level"in m.query&&(G.queryLevel=m.query.level);if("queryLevel"in
G||!(G.start>b._total||0>G.count)){l=g(H,"-div.dgrid-loading[style\x3dheight:"+F*b.rowHeight+"px]");g(l,"div.dgrid-"+(J?"below":"above")).innerHTML=b.loadingMessage;l.count=F;var N=m.query(G);if(void 0===b._trackError(function(){return N})){g(l,"!");return}(function(a,d,f,h){w=e.when(b.renderArray(h,a,G),function(k){A=h;H=a.nextSibling;g(a,"!");if(f&&H&&H.offsetWidth){var l=b.getScrollPosition();b.scrollTo({x:l.x,y:l.y+H.offsetTop-f,preserveMomentum:!0})}e.when(h.total||h.length,function(a){"queryLevel"in
G||(b._total=a);d&&(d.count=a-d.node.rowIndex,0===d.count&&G.count++,c(d))});b._processScroll();return k},function(b){g(a,"!");throw b;})}).call(this,l,J,M,N);m=m.previous}}}}w&&(C=this._refreshDeferred)&&(delete this._refreshDeferred,e.when(w,function(){C.resolve(A)}))},removeRow:function(e,d){if(e){var c=e.previousSibling,f=e.nextSibling,b;if(b=c)b=c.observerIndex,b=null!=b?b:c.previousObserverIndex;c=b;if(b=f)b=f.observerIndex,b=null!=b?b:f.nextObserverIndex;f=e.observerIndex;e.observerIndex=void 0;
d&&(e.nextObserverIndex=b,e.previousObserverIndex=c);if(this.cleanEmptyObservers&&-1<f&&f!==c&&f!==b&&(c=this.observers,b=c[f])){if(!d)for(var g=b.rows,a=0;a<g.length;a++)if(g[a]!=e&&r.isDescendant(g[a],this.domNode))return this.inherited(arguments);b.cancel();this._numObservers--;c[f]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(t,f,k,q,e,
r,m){function l(e){return e}function g(f){if("object"!==typeof f)f=Error(f);else if("cancel"===f.dojoType)return;f.grid=this;e.emit(this.domNode,"dgrid-error",{grid:this,error:f,cancelable:!0,bubbles:!0})&&console.error(f)}return f("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};r.before(this,"configStructure",k.hitch(this,
function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(e){e.set&&(this._columnsWithSet[e.field]=e);this.inherited(arguments)},_updateNotifyHandle:function(e){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);e&&"function"===typeof e.notify&&this.shouldObserveStore&&(this._notifyHandle=
r.after(e,"notify",k.hitch(this,"_onNotify"),!0),(e=this.get("sort"))&&e.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(e,d,c){this._updateNotifyHandle(e);this.store=e;this.dirty={};this.set("query",d,c)},_setQuery:function(e,d){var c=d&&d.sort;this.query=void 0!==e?e:this.query;this.queryOptions=d||this.queryOptions;this._started&&
(c?this.set("sort",c):this.refresh())},setStore:function(e,d,c){t.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",e,d,c)},setQuery:function(e,d){t.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",e,d)},_getQueryOptions:function(){var e=k.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)e.sort=this._sort;return e},_getQuery:function(){var e=this.query;return"object"==typeof e&&null!=
e?k.delegate(e,{}):e},_setSort:function(e,d){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(e,d){this.inherited(arguments);e&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var e=this.inherited(arguments);this.store||(this.noDataNode=m(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return e},renderArray:function(){var e=this,d=this.inherited(arguments);this.store||q.when(d,function(c){c.length&&
e.noDataNode&&m(e.noDataNode,"!")});return d},insertRow:function(e,d,c,f,b){var g=this.store,a=this.dirty,g=g&&g.getIdentity(e),l;g in a&&!(g in this._updating)&&(l=a[g]);l&&(e=k.delegate(e,l));return this.inherited(arguments)},updateDirty:function(e,d,c){var f=this.dirty,b=f[e];b||(b=f[e]={});b[d]=c},setDirty:function(e,d,c){t.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(e,d,c)},save:function(){function e(a,b){return function(e){var g=d._columnsWithSet,h=d._updating,
k,l;if("function"===typeof e.set)e.set(b);else for(k in b)e[k]=b[k];for(k in g)l=g[k].set(e),void 0!==l&&(e[k]=l);h[a]=!0;return q.when(c.put(e),function(){delete f[a];delete h[a]})}}var d=this,c=this.store,f=this.dirty,b=new q,g=b.promise,a=function(a){var b;return d.getBeforePut||!(b=d.row(a).data)?function(){return c.get(a)}:function(){return b}},k;for(k in f)var l=e(k,f[k]),g=g.then(a(k)).then(l);b.resolve();return g},revert:function(){this.dirty={};this.refresh()},_trackError:function(e){var d;
"string"==typeof e&&(e=k.hitch(this,e));try{d=e()}catch(c){g.call(this,c)}return q.when(d,l,k.hitch(this,g))},newRow:function(){var e=this.inherited(arguments);this.noDataNode&&(m(this.noDataNode,"!"),delete this.noDataNode);return e},removeRow:function(e,d){var c={element:e};!d&&this.noDataMessage&&this.up(c).element===e&&this.down(c).element===e&&(this.noDataNode=m(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(t,f,k,q,e,r,m,l,g){function p(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function d(a,b){var c=a.bodyNode,d=b?"text":21>e("ff")?"-moz-none":"none";n&&"msUserSelect"!==n?c.style[n]=d:e("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=q(c,"selectstart",function(a){var b=a.target&&
a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(p(c,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=r.after(a,"renderRow",function(a){p(a,!0);return a})}e.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});e.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});e.add("css-user-select",function(a,b,c){a=c.style;
b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});e.add("dom-selectstart","undefined"!==typeof document.onselectstart);var c=e("mac")?"metaKey":"ctrlKey",n=e("css-user-select"),b=(m=e("pointer"))&&"MS"===m.slice(0,2),h=m?m+(b?"Down":"down"):"mousedown",a=m?m+(b?"Up":"up"):"mouseup";"WebkitUserSelect"===n&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(n=!1);return f("dgrid.Selection",
null,{selectionDelegate:".dgrid-row",selectionEvents:h+","+a+",dgrid-cellfocusin",selectionTouchEvents:e("touch")?l.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){t.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");
this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?d(this,a):d(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(b,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&("dgrid-cellfocusin"!==b.type||"mousedown"!==b.parentType)&&(b.type!==a||c==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=b;if(!b.keyCode||!b.ctrlKey||32==b.keyCode)if(!b.shiftKey&&b.type===h&&this.isSelected(c))this._waitForMouseUp=
c;else this[this._selectionHandlerName](b,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a[c];this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var d=this._lastSelected,e=a.keyCode?a.ctrlKey:a[c],f;a.shiftKey||(f=e?null:!0,d=null);this.select(b,d,f);d||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):
a.keyCode?a.ctrlKey:a[c])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,d=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};e("touch")&&!e("pointer")&&this.selectionTouchEvents?(q(d,l.selector(f,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),q(d,q.selector(f,this.selectionEvents),function(c){b._ignoreMouseSelect!==
this?b._handleSelect(c,this):c.type===a&&(b._ignoreMouseSelect=null)})):q(d,q.selector(f,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(a){a[c]&&65==a.keyCode&&!/\bdgrid-input\b/.test(a.target.className)&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&r.after(this,"_setStore",function(){b._updateDeselectionAspect()});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,d){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[d](a,null,c)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=r.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=r.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=r.before(this,"removeRow",function(a,b){b||
(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];q.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},
_select:function(a,b,c){var d,e,f;"undefined"===typeof c&&(c=!0);a.element||(a=this.row(a));if(!1===c||this.allowSelect(a))if(d=this.selection,e=!!d[a.id],null===c&&(c=!e),f=a.element,c||this.allSelected?d[a.id]=c:delete this.selection[a.id],f&&(c?g(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):g(f,"!dgrid-selected!ui-state-active")),c!==e&&f&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(d=this._determineSelectionDirection(f,
b),d||(b=document.getElementById(b.id),d=this._determineSelectionDirection(f,b));a.element!=b&&(a=this[d](a));)this._select(a,null,c)}else this._lastSelected=f,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:e("dom-comparedocumentposition")?function(a,
b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);k.when(b,function(b){var c=a.selection,
d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(t,f,k,q,e){function r(e){e=document.getElementsByTagName(e);for(var d=0;d<e.length;d++)l(e[d])}function m(){r("link");r("style")}function l(e,d,c){function f(){t(["xstyle/core/load-imports"],function(a){a(e,
function(){l(e,d,!0)})})}function b(b){for(var c=b.cssRules,e=0;e<c.length;e++){var f=c[e];if(f.selectorText&&"x-"==f.selectorText.substring(0,2)&&(a=!0,/^'/.test(f.style.content)))return g(eval(f.style.content),b,d),!0}}var h=e.sheet||e.styleSheet;if(h&&(!h.processed||c)){h.processed=!0;var a=h.needsParsing,k=h.rules||h.cssRules;if((h.href||h.imports&&h.imports.length)&&!c)return f();if(!a)for(var m=0;m<k.length;m++){var p=k[m];if(p.href&&!c){if(!b(p.styleSheet))return f();return}}g(h.localSource||
(h.ownerNode||h.owningElement).innerHTML,h,d)}}function g(e,d,c){d.addRule||(d.addRule=function(b,c,a){return this.insertRule(b+"{"+c+"}",0<=a?a:this.cssRules.length)});d.deleteRule||(d.deleteRule=d.removeRule);var g=1;(d.href||location.href).replace(/[^\/]+$/,"");k.css=e;f(k,e,d);0==--g&&c&&c(d);return k}q.ready(m);f.getStyleSheet=function(e,d){return e.styleSheet||e};return{process:l,processAll:m,parse:g,generate:e,update:q.update,load:function(e,d,c,f){d(["xstyle/css"],function(b){b.load(e,d,function(b){b?
l({sheet:b},c):(m(),c())},f)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function t(){this.push.apply(this,arguments)}function f(c){this.value=c}function k(){var c,d=this.args[0];if("string"==typeof d)c=d.split(/\s*,\s*/);else if(d){c=[];for(var b=0,e=0;e<d.length+1;e++){var a=d[e];if("string"==typeof a||void 0===a)if(a=a&&a.split(/\s*,\s*/),1<c.length||void 0===a){var f=d.slice(b,e);0<b&&f.unshift(c.pop());b=e+1;c.push(f);a&&c.push.apply(c,a.slice(1))}}}else return[];
return c}function q(c,d,b){function h(b,d){function u(a){z=!1;var b=n.lastIndex;a.then(function(){z=!0;c&&(n.lastIndex=b,x())});var c=!0}function x(){function c(a){a&&"string"==typeof a&&B&&(a=B+a);I?I.push?"string"==typeof I[I.length-1]&&"string"==typeof a?I[I.length-1]+=a:a&&I.push(a):"string"==typeof I&&"string"==typeof a?I+=a:I=new t(I,a):I=a}for(z=!0;z;){var m=n.exec(b);if(!m)break;var x=m[5],B=m[1],C=m[2],E=m[3],Q=m[4],O,R,I,V,Q=Q&&p(Q),C=C&&p(C);H?(E?(R=C,O=E.charAt(0),V="?"==E.charAt(1),-1<
E.indexOf("\n")&&(Q=E.slice(1))):Q=C,I=Q,H=!1):(Q=E?C+E:C,c(Q));"{"!=x&&(G+=m[0]);switch(x){case "'":case '"':var Y="'"==x?e:r;Y.lastIndex=n.lastIndex;(x=Y.exec(b))||A("unterminated string");C=x[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});n.lastIndex=Y.lastIndex;c(new f(C));G+=x[0];continue;case "\\":x=Y.lastIndex++;c(b.charAt(x));continue;case "(":case "{":case "[":if("{"==x){H=!0;":"==O&&E&&(C+=E);C&&B&&(C=B+C);G=p((G+C).replace(/\s+/g,
" "));c(E=w.newRule(G));"\x3d"==O&&(D=!1,I.creating=!0);var S=null,Z=F;m[6]&&(Q=d.cssRules||d.rules,E.cssRule=S=Q[m[6].slice(1)])&&(G=S.selectorText);if(w.root&&D)for(Q=d.cssRules||d.rules;S=Q[F++];)if(S.selectorText==G||S.selectorText&&S.selectorText.replace(/::/g,":").replace(/'/g,'"')==G.replace(/::/g,":").replace(/'/g,'"')){E.cssRule=S;break}S||(E.ruleIndex=F=Z);E.styleSheet=d;I.creating?(E.selector="."+("\x3d"==O?C.match(/[\w-]*$/g,"")[0]:"")+"-x-"+g++,E.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(G)?
E.setMediaSelector(G):E.selector=w.root?G:w.selector+" "+G;G=""}else C=Q.match(/(.*?)([\w-]*)$/),c(E=w.newCall(C[2],I,w)),E.ref=w.getDefinition(C[2]),E.getArgs=k,(I.calls||(I.calls=[])).push(E);w.currentName=R;w.currentSequence=I;w.assignmentOperator=O;var aa;"{"==x&&(aa=E.selector.match(/[@:]\w+/))&&(aa=aa[0],(R=w.getDefinition(aa))&&R.selector&&R.selector(E));v.push(w=E);w.operator=x;w.start=n.lastIndex;I=R=null;continue}if(I)if(C="string"==typeof I?I:I[0],C.charAt&&"@"==C.charAt(0))if(m=C.match(/\w+/)[0],
"import"==m)C=q.getStyleSheet((d.cssRules||d.imports)[F++],I,d),m=n.lastIndex,h(C.localSource,C),n.lastIndex=m;else{if("xstyle"==m){if("start"==C.slice(8,13))E=w?w.newRule(""):ba,E.root=w.root,v.push(w=E);else{var ba=w||ba;v.pop();w=v[v.length-1]}n=w?a:/(@[\w\s])/g}}else if("\x3d"===O)try{var W=w.declareDefinition(R,I,V);W&&W.then&&u(W)}catch(U){A(U)}switch(x){case ":":"\x3d"==O?(H=!0,O=":"):c(":");break;case "}":if(R&&!w.root&&!w.isMediaBlock)try{w[":"==O?"setValue":"declareDefinition"](R,I,V)}catch(U){A(U)}case ")":case "]":l[w.operator]!=
x&&A("Incorrect opening operator "+w.operator+" with closing operator "+x);R=null;R=b.slice(w.start,n.lastIndex-1);w.cssText=w.cssText?w.cssText+";"+R:R;if("}"==x){"}"==X&&(X=w.parent.selector)&&"@"==!X.charAt(0)&&A("A nested rule must end with a semicolon");if(w.root)A("Unmatched "+x);else{try{w.onRule(w.selector,w)}catch(U){A(U)}D=!0}G=""}if(")"==x||"]"==x)w.args=[I];if(")"==x&&!O){try{W=v[v.length-2].onArguments&&v[v.length-2].onArguments(w)}catch(U){A(U)}W&&W.then&&u(W)}v.pop();w=v[v.length-1];
I=w.currentSequence;R=w.currentName;O=w.assignmentOperator;if(w.root&&"}"==x){if(O)try{w[":"==O?"setValue":"declareDefinition"](R,I,V)}catch(U){A(U)}H=!0;O=!1}break;case "":case void 0:return;case ";":if(w&&R){try{(W=w[":"==O?"setValue":"declareDefinition"](R,I,V))&&W.then&&u(W)}catch(U){A(U)}R}I=null;H=!0;O=D=!1;G=""}var X=x}}function A(a){var c=b.slice(0,n.lastIndex).split("\n"),e=c[c.length-1],c=(d.href||"in-page stylesheet")+":"+c.length+":"+e.length+" near:\n"+e.slice(-40);if(h.onerror)h.onerror(a,
c);console.error(a.message||a,c);a.stack&&console.error(a.stack)}b=b.replace(m,function(a){return a.replace(/[^\n]/g,"")});var w=c;n.lastIndex=0;var z,F=0,D=!0,G="",H=!0;x()}b=b||{addRule:function(){},cssRules:[]};var a,n=a=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,v=[c];c.parse=h;h(d,b)}var e=/((?:\\.|[^'])*)'/g,r=/((?:\\.|[^"])*)"/g,m=/\/\*[\w\W]*?\*\//g,l={"{":"}","[":"]","(":")"},
g=0,p="".trim?function(c){return c.trim()}:function(c){return c.replace(/^\s+|\s+$/g,"")},d=t.prototype=[];d.toString=function(){return this.join("")};d.isSequence=!0;f.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};f.prototype.isLiteralString=!0;return q})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),
function(t,f,k,q,e,r,m){function l(a,b,d){function e(b){return{selectElement:function(c){d.newElement&&(c=c.parentNode);if(b&&b.selector)for(;!u(c,b);)if(c=c.parentNode,!c)throw Error("Rule not found");if(d.inherit)for(;!(a in c);)if(c=c.parentNode,!c)throw Error(a?a+" not found":"Property was never defined");return c},forElement:function(e){var f=e;e=this.selectElement(e);d.newElement&&(e["_"+a+"Node"]=f);e=d.get?d.get(e,a):e[a];return void 0===e&&b?c(a).valueOf().forRule(b):e},forRule:d.inherit&&
function(a){return e(a)}}}var f=new k(function(){return e(b)});f.define=function(b,c){return l(a||c,b,d)};f.keepCSSValue=!0;f.put=d.inherit?function(b,d){return c(a).put(b,d,a)}:function(c){return{forElement:function(e){if(b&&b.selector)for(;!u(e,b);)if(e=e.parentNode,!e)throw Error("Rule not found");d.set?d.set(e,a,c):e[a]=c;f.invalidate({elements:[e]})}}};return f}function g(a,b,c,d){return q.when(f.evaluate(a,c),function(b){b.forElement?t.addRenderer(a,function(a){d(b.forElement(a),a)}):d(b)})}
function p(a,b){return{apply:function(c,d,e){g(c,e,d[0],function(d,f){d.observe(function(d){d=d?a:b;value.toString().replace(new RegExp(a+"\\([^)]+\\)","g"),d);f?f.style[e]=d:c.setStyle(e,d)})})}}}function d(a,b){var c=a.variables;if(c&&b in c)return c[b];if(a=a.bases)for(c=0;c<a.length;c++){var e=d(a[c],b);if(void 0!==e)return e}}function c(a){var b=v[a];b||(b=v[a]=new k(function(){return{forRule:function(b){a:{do{var c=d(b,a);if(void 0!==c){b=c;break a}b=b.parent}while(b);b=void 0}return b}}}),
b.put=function(a,c,d){return{forRule:function(c){function e(a){f.push(a);for(var b in a.rules)e(a.rules[b])}(c.variables||(c.variables={}))[d]=a;for(var f=[];c;)e(c),c=c.parent;b.invalidate({rules:f})}}});return b}var n=e("div"),b=navigator.userAgent,h=-1<b.indexOf("WebKit")?"-webkit-":-1<b.indexOf("Firefox")?"-moz-":-1<b.indexOf("MSIE")?"-ms-":-1<b.indexOf("Opera")?"-o-":"",a;r=new r;var u=t.matchesRule;r.root=!0;var v={};r.definitions={Math:Math,window:window,global:window,module:f.selfResolving(function(a,
b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new m.Promise(function(b){require([a],function(a){b(a)})})).then(b)}}}),item:l("item",null,{inherit:!0}),pageContent:new k,content:l("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:l(null,null,{}),elementClass:l(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,c){this.get(a,b)!=c&&(a.className=c?a.className+(" "+b):(" "+a.className+" ").replace(" "+
b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(b){for(;!u(b,a);)if(b=b.parentNode,!b)throw Error("Rule not found");return b}}}},event:{observe:function(b){b(a)},valueOf:function(){return a}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(a,b,c){return{forRule:function(b){if("string"==typeof n.style[h+c])return b._setStyleFromValue(h+c,a),!0}}}},"var":{define:function(a,b){return c(b)},
selfResolving:!0,apply:function(a,b){return c(q.convertCssNameToJs(b[0]))}},inline:p("inline","none"),block:p("block","none"),visible:p("visible","hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return q.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){f.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(b,c,d){return{forRule:function(c){t.on(document,
d.charAt(2).toLowerCase()+d.slice(3),c,function(e){a=e;try{q.when(f.evaluate(c,b).valueOf(),function(b){b&&b.forRule&&(b=b.forRule(c));b&&b.forElement&&(b=b.forElement(e.target));a=null},function(a){console.error("Error in "+d+" event handler, executing "+b,a)})}catch(w){console.error("Error in "+d+" event handler, executing "+b,w)}})}}}},title:{put:function(a){return{forRule:function(b){f.observe(f.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function b(a){var c;
if(c=a.match(/^\s*not(.*)/))return!b(c[1]);if(c=a.match(/\((.*)\)/))return b(c[1]);if(c=a.match(/([^:]*):(.*)/))return a=q.convertCssNameToJs(c[1]),c=n.style[a]=c[2],n.style[a]==c;if(c=a.match(/\w+\[(.*)=(.*)\]/))return e(c[0])[c[1]]==c[2];if(c=a.match(/\w+/))return q.isTagSupported(c);throw Error("can't parse @supports string");}b(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};r.elementProperty=l;return r})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",
["put-selector/put","xstyle/core/utils"],function(t,f){function k(a,b,d,e){function f(a){if(!d)return e(a);var b=a.target;do if(C(b,d))return e(a);while((b=b.parentNode)&&1===b.nodeType)}c?a.addEventListener(b,f,!!n[b]):q(a,n[b]||b,f)}function q(a,b,c){b="on"+b;var d=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;d&&d(a);c(a)}}function e(a){/e/.test(p.readyState||"")?a():p.addEventListener("DOMContentLoaded",a)}function r(a){for(var b=p.querySelectorAll(a.selector),c=a.name,
d=0,e=b.length;d<e;d++){var f=b[d],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities={});var h=f.renderings;h||(h=f.renderings=[],x.push(f));h.push({name:c,rendered:g[c]==a.propertyValue,renderer:a});g[c]=a.propertyValue}}function m(){for(;x.length;){for(var a=x.shift(),b=a.renderings,c=a.elementalStyle;b.length;){var d=b.shift(),e=d.renderer,f=e.rendered;E=c[d.name]==e.propertyValue;if(!f&&E)try{e.render(a)}catch(H){console.error(H,H.stack),t(a,"div.error",H.toString())}f&&!E&&
e.unrender&&e.unrender(a)}a.renderings=void 0}}function l(a,b){for(var c=0,d=u.length;c<d;c++){var e=u[c];b&&b!=e.selector||!C(a,e.rule)||e.render(a)}}function g(a,b){var c={selector:a.selector,rule:a,render:b};u.push(c);z&&r(c);m();return{remove:function(){u.splice(u.indexOf(c),1)}}}var p=document,d=1,c=!!p.addEventListener,n={blur:"focusout",focus:"focusin"};k(p,"change",null,function(a){a=a.target;for(var b=0,c=v.length;b<c;b++){var d=v[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var e=
d.definition.valueOf();e&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&(e=e.forElement(a));var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=d.definition.put(f))&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&k(p,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});
var b=p.createElement("div"),h={"dom-qsa2.1":!!b.querySelectorAll},a=b.matches||b.matchesSelector||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector||b.oMatchesSelector,u=[],v=[],x=[],z;e(function(){if(!z)if(z=!0,h["dom-qsa2.1"]){for(var a=0,b=u.length;a<b;a++)r(u[a]);m()}else for(var c=p.all,a=0,b=c.length;a<b;a++)l(c[a])});var E,C=a?function(b,c){return a.call(b,c.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+d++,"true");return!!a.currentStyle[b.ieId]};return{ready:e,
on:k,matchesRule:C,addRenderer:g,addInputConnector:function(a,b){v.push({rule:a,definition:b})},update:l,clearRenderers:function(){u=[]},observeForElement:function(a,b,c){return f.when(a,function(a){function d(a){a.observe?a.observe(c):c(a)}a.forElement?g(b,function(b){d(a.forElement(b))}):d(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function t(e,f){for(var k=0,l=e.length;k<l;k++){var g=e[k];if(g&&"object"==typeof g&&f in g)return!0}}function f(e,f){return f.toUpperCase()}
var k="div"==document.createElement("div").tagName,q={};return{when:function(e,f,k){return e&&e.then?e.then(f,k)||e:f(e)},whenAll:function(e,f){return t(e,"then")?{then:function(k,l){function g(){m--;m||k(f(d))}for(var m=1,d=[],c=0;c<e.length;c++){var n=e[c];m++;n&&n.then?function(b){n.then(function(c){d[b]=c;g()},l)}(c):(d[c]=n,g())}g()},inputs:e}:f(e)},convertCssNameToJs:function(e){return e.replace(/-(\w)/g,f)},isTagSupported:function(e){if(e in q)return q[e];var f=document.createElement(e);k?
(f=f.toString(),f=!("[object HTMLUnknownElement]"==f||"[object]"==f)):f=f.tagName==e.toUpperCase();return q[e]=f},extend:function(e,f){var k=f.split(".");f=k[0];var l=e.getDefinition(f,"rules");k[0]="";e.selector+=e.extraSelector=k.join(".");if(l)return this.when(l,function(f){if(f.extend)f.extend(e,!0);else for(var g in f)e[g]=f[g]});e.tagName=f;if(!this.isTagSupported(f))throw Error("Extending undefined definition "+f);},someHasProperty:t}})},"xstyle/core/expression":function(){define("xstyle/core/expression",
["xstyle/core/utils","xstyle/core/Definition"],function(t,f){function k(b,c){var a=c[0];return a&&b?(a=g(a),k(b.property?b.property(a):b[a],c.slice(1))):b}function q(b,c,a){if(p(c,b)){var d={};d[b]=function(d){for(var e=[],f=0,g=c.length;f<g;f++){var h=c[f];h&&"function"==typeof h[b]&&(h=h[b](d));e[f]=h}return a(e)};return d}return a(c)}function e(b,c){return{apply:function(a,d,e){for(var f=0,g=d.length;f<g;f++){var h=d[f];h.dependencyOf&&h.dependencyOf(e)}f=function(){var c=[];if(b.selfExecuting)return b.apply(a,
d,e);for(var f=0,g=d.length;f<g;f++)c[f]=d[f].valueOf();if(b.selfWaiting)return b.apply(a,c,e);c.push(a);return t.whenAll(c,function(a){var c=a.pop();return q("forRule",a,function(a){return q("forElement",a,function(a){return b.apply(c,a,e)})})})};f.reverse=function(a){return c(a,d)};return f}}}function r(b){return c[b]||(c[b]=new Function("a","b","return "+b))}function m(b,c,a,f,g){function h(a){a.skipResolve=!0;a.precedence=c;a.infix=!1!==g}var k=function(a,b){var c=b[0];b=b[1];if(c&&c.put)a=f(a,
b&&b.valueOf()),a!==d&&c.put(a);else if(b&&b.put)b.put(g(a,c&&c.valueOf()));else throw new TypeError("Can not put");},l={apply:function(c,d,l){var m;a=r(a);f=f&&r(f);g=g&&r(g);n[b]=m=e(a,k);h(m);return m.apply(c,d,l)}};h(l);n[b]=l}function l(b,c){function a(a){for(;m<=a.precedence;){var b=p.pop(),c=n[p.pop()],d=new f;d.setCompute(c.apply(null,c.infix?[p.pop(),b]:[b],d));q=p.length?p[p.length-1]:void 0;p.push(d);m=q&&n[q]&&n[q].precedence}}var d,g;c=c.join?c.slice():[c];for(d=0;d<c.length;d++)if(g=
c[d],"string"==typeof g){var h=g.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);g=[d,1];h&&g.push.apply(g,h);c.splice.apply(c,g);d+=g.length-3}var m,p=[],q,h={};for(d=0;d<c.length;d++){g=c[d];if("("==g.operator){var r=p[p.length-1];void 0===r||n.hasOwnProperty(r)?g=l(b,g.getArgs()[0]):(p.pop(),g=function(a,c){function d(d){return t.when(a.valueOf(),function(f){var n=a.parent&&a.parent.valueOf();if(!f.selfResolving){if(!g){g=[];for(var m=0,p=c.length;m<p;m++)g[m]=l(b,c[m]);h=f.selfReacting?
f.apply(n,g,k):e(f).apply(n,g,k)}return h()}f=f.apply(n,c,k);return d?f:f.valueOf()})}var g,h,k=new f(d);k.setReverseCompute(function(){var a=arguments;return t.when(d(!0),function(b){return b.put.apply(b,a)})});return k}(r,g.getArgs()))}else if(n.hasOwnProperty(g))r=n[g],a(r),m=(q||r).precedence;else if(-1<g)g=+g;else if(g.isLiteralString)g=g.value;else{g=g.split(/\s*\/\s*/);var r=g[0],w=b.getDefinition(r);if("string"==typeof w||w instanceof Array)w=l(b,w);else if(void 0===w)throw Error('Could not find reference "'+
r+'"');h[r]=w;1<g.length&&(w=k(w,g.slice(1)));g=w}p.push(g)}a({precedence:100});if(1<p.length)throw Error("Could not reduce expression");g=p[0];g.inputs=h;return g}var g=t.convertCssNameToJs,p=t.someHasProperty,d={},c={},n={};m("+",6,"a+b","a-b","a-b");m("-",6,"a-b","a+b","b-a");m("*",5,"a*b","a/b","a/b");m("/",5,"a/b","a*b","b/a");m("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");m(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");m("!",4,"!a","!a",!1);m("%",5,"a%b");m("\x3e",
8,"a\x3eb");m("\x3e\x3d",8,"a\x3e\x3db");m("\x3c",8,"a\x3cb");m("\x3c\x3d",8,"a\x3c\x3db");m("\x3d\x3d",9,"a\x3d\x3d\x3db");m("\x26",8,"a\x26\x26b");m("|",8,"a||b");return{react:e,evaluate:l,selfResolving:function(b){b.selfResolving=!0;return b}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(t,f){function k(e){(this.computeValue=e)&&e.reverse&&this.setReverseCompute(e.reverse)}function q(k,g,m){if(g&&g.forElement)return{forElement:function(d){d=g.selectElement?
g.selectElement(d):d;var c=["_cache_"+k.id];if(c in d){var l=d[c+"observe"];l.addKey&&l.addKey(m);return d[c][m]}var b=d[c]=g.forElement(d),h=d[c+"observe"]=e(k,b,m,{elements:[d]});d.xcleanup=function(a){a&&f.unobserve(b,h)};return b[m]}}}function e(e,g,k,d){var c=e._properties,l;"object"==typeof g&&(l=function(b){for(var e=0;e<b.length;e++){var a=c[b[e].name];a&&a.invalidate&&a.invalidate(d)}},f.observe(g,l),l.addKey&&l.addKey(k));return l}var r={},m=1;k.prototype={id:"x-variable-"+m++,cache:r,valueOf:function(){if((this.dependents||
this._properties)&&this.cache!==r)return this.cache;var e=this,f=this.computeValue;if(f.then)return this.cache=f.then(function(f){e.computeValue=f;(f=e.cache=f())&&f.then&&f.then(function(d){e.cache=d});return f});(f=e.cache=f())&&f.then&&f.then(function(f){e.cache=f});return f},property:function(f){var g=this._properties||(this._properties={}),l=g[f];if(!l){var d=this,l=g[f]=new k(function(){return t.when(d.valueOf(),function(c){if(c&&c.forRule)return{forRule:function(b){b=c.selectRule?c.selectRule(b):
b;var g=["_cache_"+d.id],a;if((a=g in b?b[g]:b[g]=c.forRule(b))&&a.forElement)return q(d,a,f);var k=b[g+"observe"];k&&(k.addKey?k.addKey(f):b[g+"observe"]=e(d,a,f,{rules:[b]}));return a[f]}};if(c&&c.forElement)return q(d,c,f);var g=d.cacheObserve;g?g.addKey&&g.addKey(f):g=d.cacheObserve=e(d,c,f);return c[f]})});l.key=f;l.parent=this;l.put=function(c){return t.when(d.valueOf(),function(d){function b(b){if(b.forElement)return{forElement:function(a){b.forElement(a)[f]=c}};b[f]=c}if(d.forRule)return{forRule:function(c){return b(d.forRule(c))}};
b(d)})};l.id=this.id+"-"+f}return l},invalidate:function(e){var g=this.cacheObserve;g&&(f.unobserve(this.cache,g),this.cacheObserve=null);this.cache=r;var k,g=this._properties;for(k in g)g[k].invalidate(e);var d=this.dependents||0;k=0;for(g=d.length;k<g;k++)try{d[k].invalidate(e)}catch(c){console.error(c,"invalidating a definition")}},dependencyOf:function(e){(this.dependents||(this.dependents=[])).push(e)},notDependencyOf:function(e){for(var f=this.dependents||0,k=0;k<f.length;k++)f[k]===e&&f.splice(k--,
1)},setReverseCompute:function(e){this.put=function(){var f=e.apply(this,arguments);this.invalidate();return f}},setCompute:function(e){(this.computeValue=e)&&e.reverse&&this.setReverseCompute(e.reverse);this.invalidate()},setSource:function(e){this.computeValue=function(){return e};this.invalidate()},observe:function(e){this.computeValue&&e(this.valueOf());var f=this;return this.dependencyOf({invalidate:function(){e(f.valueOf())}})},newElement:function(){return t.when(this.valueOf(),function(e){return e&&
e.newElement&&e.newElement()})}};return k})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function t(c,b,d){r?-1===r.indexOf(c)&&r.push(c):(r=[c],setTimeout(function(){r.forEach(function(a){var b=[];a.properties.forEach(function(c){b.push({target:a.object,name:c})});a(b);a.object=null;a.properties=null});r=null},0));c.object=b;c=c.properties||(c.properties=[]);-1===c.indexOf(d)&&c.push(d)}function f(){return f}var k=Object.observe,q;if(q=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});q=!0;break a}catch(n){}q=void 0}var e={observe:k,defineProperty:q,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},k=e.observe?Object.observe:e.defineProperty?function(c,b){b.addKey=function(d){var a="key"+d;if(!this[a]){this[a]=!0;var e=c[d];if((a=Object.getOwnPropertyDescriptor(c,d))&&a.set){var f=a.set,g=a.get;Object.defineProperty(c,d,{get:function(){return e=g.call(this)},set:function(a){f.call(this,a);e!==a&&(e=a,b&&t(b,this,d))}})}else Object.defineProperty(c,
d,{get:function(){return e},set:function(a){e!==a&&(e=a,b&&t(b,this,d))}})}};b.remove=function(){b=null}}:function(c,b){p||(p=!0,setInterval(function(){for(var a=0,b=m.length;a<b;a++){var c=l[a],d=m[a],e=g[a],f=void 0,h=void 0;for(h in c)c.hasOwnProperty(h)&&c[h]!==d[h]&&(c[h]=d[h],(f||(f=[])).push({name:h}));for(h in d)d.hasOwnProperty(h)&&!c.hasOwnProperty(h)&&(c[h]=d[h],(f||(f=[])).push({name:h}));f&&e(f)}},20));var d={},a;for(a in c)c.hasOwnProperty(a)&&(d[a]=c[a]);m.push(c);l.push(d);g.push(b)},
r;q=e.observe?Object.unobserve:function(c,b){b.remove&&b.remove();for(var d=0,a=m.length;d<a;d++)if(m[d]===c&&g[d]===b){m.splice(d,1);l.splice(d,1);g.splice(d,1);break}};var m=[],l=[],g=[],p=!1,d=1,c=function(){};c.prototype.toJSON=f;return{Promise:e.promise?Promise:function(){function c(b){function d(b){b&&b.then?b.then(d,a):(g=b,e())}function a(a){k=a;e()}function e(){f=!0;for(var a=0,b=l.length;a<b;a++)l[a]();l=0}var f,g,k,l=0;b(d,a);return{then:function(a,b){return new c(function(c,d){function e(){try{k&&
!b?d(k):c(k?b(k):a?a(g):g)}catch(D){d(D)}}f?e():(l||(l=[])).push(e)})}}}return c}(),WeakMap:e.WeakMap?WeakMap:function(f,b){var g="__"+(b||"")+d++;return e.defineProperty?{get:function(a){return a[g]},set:function(a,b){Object.defineProperty(a,g,{value:b,enumerable:!1})}}:{get:function(a){return(a=a[g])&&a.value},set:function(a,b){(a[g]||(a[g]=new c)).value=b}}},observe:k,unobserve:q,copy:function(c,b){for(var d in b)c[d]=b[d];return c}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(t,f,k,q,e){function r(a,b,c){try{a[b]=c}catch(z){}}function m(){}function l(a,b,d,e){if(a.calls){var h;for(d=0;d<a.length;d++){var k=a[d];if(k instanceof g){a.hasOwnProperty(d)||(a[d]=k=c(k));var l=k.ref&&(k.ref.selfResolving?k.ref.apply(b,k.getArgs(),b):t.evaluate(b,[k.caller,k]));void 0!==l&&((h||(h=[])).push(l),k.evaluated=!0)}}}if(h)return b=t.react(function(){for(var b=0,c=a.slice(),d=0;d<a.length;d++){var e=
a[d];e instanceof g&&e.evaluated&&(c[d-1]=a[d-1].slice(0,-e.caller.length),c[d]=arguments[b++])}return c.join("")}),b.skipResolve=!0,e=new f,e.setCompute(b.apply(e,h,e)),e;if(!e)return a.toString()}function g(a){this.caller=a;this.args=[]}function p(a,b,c,f){return e.when(b,function(b){var e=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=e.forRule(a,!0);b&&b.forElement?d(a,b,f):c&&c(b)}),b=b.forRule(a));if(b&&b.forElement)return d(a,b,f);c&&c(b)})}function d(a,
b,c){return require(["xstyle/core/elemental"],function(d){d.addRenderer(a,function(a){var d=b.forElement(a);c&&c(d,a)})})}var c=Object.create||function(a){function b(){}b.prototype=a;return new b},n=e.convertCssNameToJs,b={"{":"}","[":"]","(":")"},h=k("div").style;m.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",
b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new m;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new g(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;try{c.addRule(a,b||" ",e)}catch(C){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,b)}return d[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];r(a.style,c[0],c[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?r(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var b=this;require(["xstyle/core/elemental"],function(c){c.addRenderer(b,function(b){a(b)})})},declareDefinition:function(a,b,c){a=a&&n(a);if(!this.disabled){var d=this;if(b.length)if("\x3e"==b[0].toString().charAt(0))a||(this.generator=b,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,c){b=a.forSelector(b,d);c.addRenderer(d,b)}));else{var f=a in h||this.getDefinition(a);if(!c||!f){c=this.definitions||(this.definitions={});var g=b[0];if(g.indexOf&&-1<g.indexOf(","))for(var g=
b.join("").split(/\s*,\s*/),k=[],l=0;l<g.length;l++)k[l]=t.evaluate(this,g[l]);b[0]&&"{"==b[0].operator?k=b[0]:b[1]&&"{"==b[1].operator&&(k=b[1],e.extend(k,b[0]));k=k||t.evaluate(this,b);if(k.then)var m=k,k={then:function(a){return m.then(function(b){return a(p(b))})}};var p=function(b){b.define&&(b=b.define(d,a));return b};f&&console.warn('Overriding existing property "'+a+'"');return c[a]=p(k)}}else return c=this.definitions||(this.definitions={}),c[a]=b}},onArguments:function(a){var b=a.ref;return b&&
b.apply(this,a.getArgs(),this)},setValue:function(a,b,c){var d=n(a);if(!this.disabled){var e=this.values||(this.values=[]);e.push(a);e[a]=b;if(a){do{e=(c||this).getDefinition(a);if(void 0!==e){if(this.cssRule&&(!e||!e.keepCSSValue)){var f=this.cssRule.style;d in f&&r(f,d,"")}p(this,e.put(b,this,d))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}d in h&&this._setStyleFromValue(d,b,!0)}},_setStyleFromValue:function(a,b,c){var f=b[0];if(f instanceof m)for(c=f.values,f=0;f<c.length;f++){var g=c[f];this._setStyleFromValue(a+
("main"==g?"":g.charAt(0).toUpperCase()+g.slice(1)),c[g])}else{if(b.calls){var h=this;if(b.expression=l(b,this,a,!0)){var k=b.expression&&b.expression.valueOf(),n=function(b,c){var e=k&&k.forRule?k.forRule(b,!0):k;if(e&&e.forElement)if(c=c&&c.elements)for(var f=0;f<c.length;f++)for(var g=c[f].querySelectorAll(b.selector),h=0;h<g.length;h++){var l=g[h];r(l.style,a,e.forElement(l))}else d(b,e,function(b,c){r(c.style,a,b)});else b.setStyle(a,e)},p=[h];e.when(k,function(a){(k=a)&&k.forRule&&(h._subRuleListeners||
(h._subRuleListeners=[])).push(function(a){p.push(a);n(a)});n(h)});b.expression.dependencyOf({invalidate:function(a){e.when(b.expression.valueOf(),function(b){k=b;for(b=0;b<p.length;b++){var c=!0,d=p[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&n(d,a)}})}})}}c||this.setStyle(a,b)}},put:function(a){var b=this;return{forRule:function(c){b.extend(c);if("defaults"!=a&&a&&"string"==typeof a&&b.values)for(var d=a.toString().split(/,\s*/),e=0;e<d.length;e++){var f=
b.values[e];f&&c.setValue(f,d[e],b)}}}},extend:function(a,b){(this.derivatives||(this.derivatives=[])).push(a);var d=this.extraSelector;d&&(a.selector+=d);for(var e=this.cssRule.style,f=a.getCssRule().style,g=a.inheritedStyles||(a.inheritedStyles={}),d=0;d<e.length;d++){var k=n(e[d]);if(!f[k]||g[k])f[k]=e[k],g[k]=!0}if(d=this.values){var d=c(d),l=a.values;a.values=l?q.copy(d,l):d}if(b){if(d=this.definitions){var d=c(d),m=a.definitions;a.definitions=m?q.copy(d,m):d}a.tagName=this.tagName||a.tagName}(a.bases||
(a.bases=[])).push(this);b=this._subRuleListeners||0;for(d=0;d<b.length;d++)b[d](a);var p=a.getCssRule().style;this.eachProperty(function(b,d){b=n(b);"object"==typeof d&&(d=c(d));b in h&&!p[b]&&a._setStyleFromValue(b,d)});if(l&&a.definitions)for(d=0,b=l.length;d<b;d++)k=l[d],e=n(k),a.definitions[e]!==(m&&m[e])&&a.setValue(k,l[e]);if(l=this.generator){if(l instanceof Array)for(l=l.slice(0),d=0;d<l.length;d++)m=l[d],"{"===m.operator&&(b=a.newRule(),b.selector=m.selector+a.selector.slice(1),b.styleSheet=
a.styleSheet||a.cssRule.parentStyleSheet,m.extend(b,!0),l[d]=b);a.declareDefinition(null,l)}},getDefinition:function(a,b){a=n(a);var c=this;do{var d=c.definitions&&c.definitions[a];void 0===d&&b&&c[b]&&(d=c[b][a]);c=c.parent}while(void 0===d&&c);return d},newElement:function(){return k((this.tagName||"span")+(this.selector||""))},cssText:""};t.evaluateText=l;var a=g.prototype=new m;a.declareDefinition=a.setValue=function(a,b){this.args.push(b)};a.toString=function(){var a=this.operator;return a+this.args+
b[a]};m.updateStaleProperties=function(){};return m})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(t,f,k,q,e){function r(a,b){a=a.sort?a:[a];return function(c,d,e){var l=c,n;"content"in c||(c.content=void 0);if(void 0===e){var q=(c._contentNode||c).childNodes||0,r=q[0];if(r){var u=h.createDocumentFragment();do u.appendChild(r);while(r=q[0]);c.content=u}if(c._contentNode){c._contentNode=
void 0;try{c.innerHTML=""}catch(I){}}}for(var v=0,x=[c],z=[],q=0,r=a.length;q<r;q++){var E=L,L=a[q];try{if(L.eachProperty){if(L.args)if("("==L.operator){var J=a[q+1];m(L,J,l,function(a,c,d){p(a,c,d,b)})}else{var K=L.args[0];if("string"===typeof K){var N=K.split("\x3d");try{l.setAttribute(N[0],N[1])}catch(I){console.error(I)}}else{var P=K[0].replace(/=$/,""),Q=K[1];"("==Q.operator?m(K[1],P,l,function(a,c,d){g(a,c,d,b)}):l.setAttribute(P,Q.value)}}}else if("string"==typeof L){"\x3d"==L.charAt(0)&&(L=
L.slice(1));var O=l,J=a[q+1],N=[];L.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){N.push(arguments)});for(var R=0;R<N.length;R++)(function(a,g,h,m,p,q,r){function t(){var a=O._contentNode;a&&(a.innerHTML="",O=a)}g?(a=h?h.length:0,a>v?(t(),x[a]=O):O=x[a]||O,v=a):t();var u;if(m)u=(E&&E.args?"":"span")+m+p;else{m=p.match(/^[-\w]+/);if(!m)throw new SyntaxError("Unable to parse selector",p);m=m[0];var w;R===N.length-1&&J&&J.selector?(J.bases||k.extend(J,
m),w=J):w=b.getDefinition(m);w&&(w.then||w.newElement)?O=function(a,b,c,d){var e,g;k.when(w&&w.newElement&&w.newElement(),function(a){(e=a)?(c=c.slice(d.length))&&f(e,c):e=f(c);if(g){g.parentNode.replaceChild(e,g);a=g.childNodes;var b;for(e=e._contentNode||e;b=a[0];)e.appendChild(b)}});if(e)return a.insertBefore(e,b||null);g=f("span");return a.insertBefore(g,b||null)}(O,e,p,m):u=p}u&&(O=f(e||O,(e?"-":"")+u));e=null;q&&O.setAttribute(q,""===r?q:r);d&&(O.item=d);n=n||O;(R<N.length-1||O!=l&&O!=c)&&z.push(R==
N.length-1&&J&&J.selector,O);l=O}).apply(this,N[R])}else l.appendChild(h.createTextNode(L.value))}catch(I){console.error(I,I.stack),l.innerHTML&&(l.innerHTML=""),l.appendChild(h.createTextNode(I))}}for(;L=z.pop();)t.update(L,z.pop());return n}}function m(b,c,d,e){var g,h;c&&c.eachProperty?(f(d,g=c.selector),h=c):(f(d,g=b.selector||(b.selector=".-xbind-"+a++)),h=b);var k=b.getArgs()[0],l=b.expressionResult,m=b.expressionDefinition;m||(m=b.expressionDefinition=q.evaluate(b.parent,k),l=m.valueOf(),t.addInputConnector(h,
m),function(a,c,d){b.expressionResult=l;d.dependencyOf&&d.dependencyOf({invalidate:function(b){b=b?t.matchesRule(b.elements[0],h)?b.elements:b.elements[0].querySelectorAll(c):document.querySelectorAll(c);for(var f=0,g=b.length;f<g;f++)e(b[f],a,d.valueOf())}})}(c,g,m));e(d,c,l)}function l(a,b,c,d){return k.when(a,function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(c));d(a)})}function g(a,b,c,d){l(c,d,a,function(c){a.setAttribute(b,c)})}function p(a,c,e,g){a._defaultBinding=
!0;if(e&&e.then&&"INPUT"!==a.tagName)try{a.appendChild(h.createTextNode("Loading"))}catch(E){}l(e,g,a,function(e){if(a._defaultBinding)if(d(a),a.childNodes.length&&(a.innerHTML=""),e&&e.sort)if(e.isSequence)r(e,g)(a);else{var k=c&&c.definitions&&c.definitions.each,l=g.newRule(),k=k?r(k,l):function(a,b,c){return f(c||a,(c?"-":"")+(n[a.tagName]||"span"),""+b)},m=[],p;e.track&&(e=e.track(),p=e.tracking);e.forEach(function(b){m.push(k(a,b,null))});if(e.on)var q=e.on("add,delete,update",function(b){var c=
b.target,e=b.previousIndex;b=b.index;if(-1<e){var f=m[e];d(f,!0);f.parentNode.removeChild(f);m.splice(e,1)}-1<b&&m.splice(b,0,k(a,c,m[b]||null))});if(p=p||q)a.xcleanup=function(){p.remove()}}else e&&e.nodeType?a.appendChild(e):(e=void 0===e?"":e,a.tagName in b?"checkbox"===a.type?a.checked=e:a.value=e:a.appendChild(h.createTextNode(e)))})}function d(a,b){a.xcleanup&&a.xcleanup(b);a=a.getElementsByTagName("*");b=0;for(var c=a.length;b<c;b++){var d=a[b];d.xcleanup&&d.xcleanup(!0)}}function c(a,b){return r(b,
e)(a)}var n={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},b={INPUT:1,TEXTAREA:1,SELECT:1},h=document,a=1;c.forSelector=r;return c})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c){k.isAsync||l(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var n=f("dojo.dnd.Source",d,{isSource:!0,
horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(b,c){q.mixin(this,q.mixin({},c));b=this.accept;if(b.length)for(this.accept={},c=0;c<b.length;++c)this.accept[b[c]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&e.add(this.node,"dojoDndSource");this.targetState="";this.accept&&e.add(this.node,"dojoDndTarget");
this.horizontal&&e.add(this.node,"dojoDndHorizontal");this.topics=[g.subscribe("/dnd/source/over",q.hitch(this,"onDndSourceOver")),g.subscribe("/dnd/start",q.hitch(this,"onDndStart")),g.subscribe("/dnd/drop",q.hitch(this,"onDndDrop")),g.subscribe("/dnd/cancel",q.hitch(this,"onDndCancel"))]},checkAcceptance:function(b,c){if(this==b)return!this.copyOnly||this.selfAccept;for(var a=0;a<c.length;++a){for(var d=b.getItem(c[a].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},
copyState:function(b,d){if(b)return!0;2>arguments.length&&(d=this==c.manager().target);if(d){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){n.superclass.destroy.call(this);t.forEach(this.topics,function(b){b.remove()});this.targetAnchor=null},onMouseMove:function(b){if(!this.isDragging||"Disabled"!=this.targetState){n.superclass.onMouseMove.call(this,b);var d=c.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(b.pageX-this._lastX)>
this.delay||Math.abs(b.pageY-this._lastY)>this.delay)){var a=this.getSelectedNodes();a.length&&d.startDrag(this,a,this.copyState(p.getCopyKeyState(b),!0))}this.isDragging&&(a=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=r.position(this.current,!0)),a=this.horizontal?b.pageX-this.targetBox.x<this.targetBox.w/2==r.isBodyLtr(this.current.ownerDocument):b.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||a!=this.before)&&(this._markTargetAnchor(a),
d.canDrop(!this.current||d.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(b){this.mouseDown||!this._legalMouseDown(b)||this.skipForm&&p.isFormElement(b)||(this.mouseDown=!0,this._lastX=b.pageX,this._lastY=b.pageY,n.superclass.onMouseDown.call(this,b))},onMouseUp:function(b){this.mouseDown&&(this.mouseDown=!1,n.superclass.onMouseUp.call(this,b))},onDndSourceOver:function(b){this!==b?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(b=c.manager(),
b.canDrop("Disabled"!=this.targetState&&(!this.current||b.source!=this||!(this.current.id in this.selection))))},onDndStart:function(b,d,a){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==b?a?"Copied":"Moved":"");d=this.accept&&this.checkAcceptance(b,d);this._changeState("Target",d?"":"Disabled");this==b&&c.manager().overSource(this);this.isDragging=!0},onDndDrop:function(b,c,a,d){if(this==d)this.onDrop(b,c,a);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(b,c,a){if(this!=b)this.onDropExternal(b,c,a);else this.onDropInternal(c,a)},onDropExternal:function(b,c,a){var d=this._normalizedCreator;this._normalizedCreator=this.creator?function(a,c){return d.call(this,b.getItem(a.id).data,c)}:a?function(a){var c=b.getItem(a.id);a=a.cloneNode(!0);a.id=p.getUniqueId();return{node:a,
data:c.data,type:c.type}}:function(a){var c=b.getItem(a.id);b.delItem(a.id);return{node:a,data:c.data,type:c.type}};this.selectNone();a||this.creator||b.selectNone();this.insertNodes(!0,c,this.before,this.current);!a&&this.creator&&b.deleteSelectedNodes();this._normalizedCreator=d},onDropInternal:function(b,c){var a=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(c)this._normalizedCreator=this.creator?function(b,c){return a.call(this,this.getItem(b.id).data,c)}:function(a){var b=
this.getItem(a.id);a=a.cloneNode(!0);a.id=p.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,b,this.before,this.current);this._normalizedCreator=a}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){n.superclass.onOverEvent.call(this);c.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){n.superclass.onOutEvent.call(this);c.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(b){if(this.current!=this.targetAnchor||this.before!=b)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=b,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(b){this._changeState("Source",b?"Copied":"Moved")},_legalMouseDown:function(b){if("touchstart"!=b.type&&!m.isLeft(b))return!1;if(!this.withHandles)return!0;for(b=b.target;b&&b!==this.node;b=b.parentNode){if(e.contains(b,"dojoDndHandle"))return!0;if(e.contains(b,"dojoDndItem")||e.contains(b,
"dojoDndIgnore"))break}return!1}});return n})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c){var n=f("dojo.dnd.Selector",c,{constructor:function(b,c){c||(c={});this.singular=c.singular;this.autoSync=c.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(g(this.node,p.press,q.hitch(this,
"onMouseDown")),g(this.node,p.release,q.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new l,c=d._empty,a;for(a in this.selection)a in c||b.push(e.byId(a));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(b,c){this._addItemClass(e.byId(c),"Selected");this.selection[c]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var b=d._empty,c;for(c in this.selection)if(!(c in b)){var a=
e.byId(c);this.delItem(c);r.destroy(a)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(b,c){c=c||k.global;var a=this.selection,e=d._empty,f;for(f in a)f in e||b.call(c,this.getItem(f),f,this)},sync:function(){n.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var b=[],c=d._empty,a;for(a in this.selection)a in c||this.getItem(a)||b.push(a);t.forEach(b,function(a){delete this.selection[a]},this);return this},insertNodes:function(b,
c,a,d){var e=this._normalizedCreator;this._normalizedCreator=function(a,c){a=e.call(this,a,c);b?(this.anchor?this.anchor!=a.node&&(this._removeItemClass(a.node,"Anchor"),this._addItemClass(a.node,"Selected")):(this.anchor=a.node,this._removeItemClass(a.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[a.node.id]=1):(this._removeItemClass(a.node,"Selected"),this._removeItemClass(a.node,"Anchor"));return a};n.superclass.insertNodes.call(this,c,a,d);this._normalizedCreator=e;
return this},destroy:function(){n.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(b){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!d.getCopyKeyState(b)&&!b.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,m.isLeft(b)&&(b.stopPropagation(),b.preventDefault());else{if(!this.singular&&b.shiftKey){d.getCopyKeyState(b)||this._removeSelection();var c=this.getAllNodes();if(c.length&&(this.anchor||(this.anchor=c[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var a=0,e;a<c.length&&(e=c[a],e!=this.anchor&&e!=this.current);++a);for(++a;a<c.length;++a){e=c[a];if(e==this.anchor||e==this.current)break;this._addItemClass(e,"Selected");this.selection[e.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?d.getCopyKeyState(b)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):d.getCopyKeyState(b)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);b.stopPropagation();b.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=g(this.node,p.move,q.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var b=d._empty,c;for(c in this.selection)if(!(c in b)){var a=e.byId(c);a&&this._removeItemClass(a,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return n})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){f=f("dojo.dnd.Container",g,{skipForm:!1,allowNested:!1,constructor:function(b,a){this.node=r.byId(b);a||(a={});this.creator=a.creator||null;this.skipForm=a.skipForm;this.parent=a.dropParent&&r.byId(a.dropParent);this.map={};this.current=null;this.containerState="";m.add(this.node,"dojoDndContainer");a&&a._skipStartup||this.startup();this.events=[d(this.node,n.over,q.hitch(this,"onMouseOver")),d(this.node,n.out,q.hitch(this,"onMouseOut")),d(this.node,"dragstart",
q.hitch(this,"onSelectStart")),d(this.node,"selectstart",q.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(b){return this.map[b]},setItem:function(b,a){this.map[b]=a},delItem:function(b){delete this.map[b]},forInItems:function(c,a){a=a||k.global;var d=this.map,e=b._empty,f;for(f in d)f in e||c.call(a,d[f],f,this);return a},clearItems:function(){this.map={}},getAllNodes:function(){return c((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var c={};this.getAllNodes().forEach(function(a){if(a.id){var d=
this.getItem(a.id);if(d){c[a.id]=d;return}}else a.id=b.getUniqueId();var d=a.getAttribute("dndType"),e=a.getAttribute("dndData");c[a.id]={data:e||a.innerHTML,type:d?d.split(/\s*,\s*/):["text"]}},this);this.map=c;return this},insertNodes:function(b,a,c){this.parent.firstChild?a?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(a=0;a<b.length;++a)d=this._normalizedCreator(b[a]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(a=0;a<
b.length;++a)d=this._normalizedCreator(b[a]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){t.forEach(this.events,function(b){b.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(b,a,c){b._skipStartup=!0;return new c(a,b)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var c=this.parent.getElementsByTagName("tbody");c&&c.length&&(this.parent=
c[0])}this.defaultCreator=b._defaultCreator(this.parent);this.sync()},onMouseOver:function(b){for(var a=b.relatedTarget;a&&a!=this.node;)try{a=a.parentNode}catch(u){a=null}a||(this._changeState("Container","Over"),this.onOverEvent());a=this._getChildByEvent(b);this.current!=a&&(this.current&&this._removeItemClass(this.current,"Over"),a&&this._addItemClass(a,"Over"),this.current=a)},onMouseOut:function(b){for(b=b.relatedTarget;b;){if(b==this.node)return;try{b=b.parentNode}catch(a){b=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(c){this.withHandles||this.skipForm&&b.isFormElement(c)||(c.stopPropagation(),c.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(b,a){var c="dojoDnd"+b;b=b.toLowerCase()+"State";m.replace(this.node,c+a,c+this[b]);this[b]=a},_addItemClass:function(b,a){m.add(b,"dojoDndItem"+a)},_removeItemClass:function(b,a){m.remove(b,"dojoDndItem"+
a)},_getChildByEvent:function(b){if(b=b.target)for(var a=b.parentNode;a;b=a,a=b.parentNode)if((a==this.parent||this.allowNested)&&m.contains(b,"dojoDndItem"))return b;return null},_normalizedCreator:function(c,a){c=(this.creator||this.defaultCreator).call(this,c,a);q.isArray(c.type)||(c.type=["text"]);c.node.id||(c.node.id=b.getUniqueId());m.add(c.node,"dojoDndItem");return c}});b._createNode=function(c){return c?function(a){return l.create(c,{innerHTML:a})}:b._createSpan};b._createTrTd=function(b){var a=
l.create("tr");l.create("td",{innerHTML:b},a);return a};b._createSpan=function(b){return l.create("span",{innerHTML:b})};b._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};b._defaultCreator=function(c){c=c.tagName.toLowerCase();var a="tbody"==c||"thead"==c?b._createTrTd:b._createNode(b._defaultCreatorNodes[c]);return function(c,d){var e=c&&q.isObject(c),f;e&&c.tagName&&c.nodeType&&c.getAttribute?(f=c.getAttribute("dndData")||c.innerHTML,e=(e=c.getAttribute("dndType"))?e.split(/\s*,\s*/):["text"]):
(f=e&&c.data?c.data:c,e=e&&c.type?c.type:["text"],c=("avatar"==d?b._createSpan:a)(String(f)));c.id||(c.id=b.getUniqueId());return{node:c,data:f,type:e}}};return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b){var h=f("dojo.dnd.Manager",[r],{constructor:function(){this.source=this.avatar=null;this.nodes=
[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:m("touch")?4:16,OFFSET_Y:m("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());p.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),p.publish("/dnd/source/over",null)):p.publish("/dnd/source/over",null)},startDrag:function(a,b,c){function f(a){a.preventDefault();
a.stopPropagation()}n.autoScrollStart(q.doc);this.source=a;this.nodes=b;this.copy=!!c;this.avatar=this.makeAvatar();q.body().appendChild(this.avatar.node);p.publish("/dnd/start",a,b,this.copy);this.events=[g(q.doc,d.move,k.hitch(this,"onMouseMove")),g(q.doc,d.release,k.hitch(this,"onMouseUp")),g(q.doc,"keydown",k.hitch(this,"onKeyDown")),g(q.doc,"keyup",k.hitch(this,"onKeyUp")),g(q.doc,"dragstart",f),g(q.body(),"selectstart",f)];a="dojoDnd"+(c?"Copy":"Move");e.add(q.body(),a)},canDrop:function(a){a=
!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){e.remove(q.body(),["dojoDndCopy","dojoDndMove"]);t.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new b(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(n.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=
a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(c.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));m("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var b=!!this.source.copyState(c.getCopyKeyState(a));p.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);p.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else p.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case l.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case l.ESCAPE:p.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==l.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();e.replace(q.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});c._manager=null;h.manager=c.manager=function(){c._manager||
(c._manager=new h);return c._manager};return h})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(t,f,k,q,e,r,m,l){return t("dojo.dnd.Avatar",null,{constructor:function(e){this.manager=e;this.construct()},construct:function(){var e=r.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),f=this.manager.source,d,c=r.create("tbody",null,e),k=r.create("tr",
null,c),b=r.create("td",null,k),h=Math.min(5,this.manager.nodes.length),a=0;m("highcontrast")&&r.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},b);r.create("span",{innerHTML:f.generateText?this._generateText():""},b);for(q.set(k,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});a<h;++a)f.creator?d=f._normalizedCreator(f.getItem(this.manager.nodes[a].id).data,"avatar").node:(d=this.manager.nodes[a].cloneNode(!0),"tr"==d.tagName.toLowerCase()&&(k=r.create("table"),r.create("tbody",
null,k).appendChild(d),d=k)),d.id="",k=r.create("tr",null,c),b=r.create("td",null,k),b.appendChild(d),q.set(k,{"class":"dojoDndAvatarItem",style:{opacity:(9-a)/10}});this.node=e},destroy:function(){r.destroy(this.node);this.node=!1},update:function(){e.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(m("highcontrast")){var f=k.byId("a11yIcon"),p="+";this.manager.canDropFlag&&!this.manager.copy?p="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(p="x"):
p="o";f.innerHTML=p}l("tr.dojoDndAvatarHeader td span"+(m("highcontrast")?" span":""),this.node).forEach(function(d){d.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(t,f,k,q){return t("dijit.CheckedMenuItem",k,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:q,checked:!1,_setCheckedAttr:function(e){this.domNode.setAttribute("aria-checked",e?"true":"false");this._set("checked",e)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(e){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(e)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(t,f,k,q,e,r,m,l,g,p,d){var c=g("dijit.ColorPalette",[k,q,e],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(c,b,d,a){return new this._dyeClass(c,
b,d,a)},buildRendering:function(){this.inherited(arguments);this._dyeClass=g(c._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],m.getLocalization("dojo","colors",this.lang))}});c._Color=g("dijit._Color",l,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":t.toUrl("./themes/a11y/colors7x10.png"),"3x4":t.toUrl("./themes/a11y/colors3x4.png")},constructor:function(c,b,d,a){this._title=a;this._row=b;this._col=d;this.setColor(l.named[c])},getValue:function(){return this.toHex()},fillCell:function(c,b){b=d.substitute(r("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:b,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});p.place(b,c)}});return c})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(t,f,k,q,e,r,m,l,g,p,d){return t("dijit._PaletteMixin",l,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(c){return new ("string"==
typeof this.dyeClass?r.getObject(this.dyeClass):this.dyeClass)(c)},_preparePalette:function(c,f){this._cells=[];var b=this._blankGif;this.own(m(this.gridNode,g,r.hitch(this,"_onCellClick")));for(var h=0;h<c.length;h++)for(var a=q.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),k=0;k<c[h].length;k++){var l=c[h][k];if(l){var n=this._dyeFactory(l,h,k,f[l]),l=q.create("td",{"class":this.cellClass,tabIndex:"-1",title:f[l],role:"gridcell"},a);n.fillCell(l,b);l.idx=this._cells.length;this._cells.push({node:l,
dye:n})}}this._xDim=c[0].length;this._yDim=c.length;var p={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},t;for(t in p)this.own(d.addKeyListener(this.domNode,{keyCode:e[t],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=p[t];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){p.focus(this._currentFocus)},
_onCellClick:function(c){for(var d=c.target;"TD"!=d.tagName;){if(!d.parentNode||d==this.gridNode)return;d=d.parentNode}var b=this._getDye(d).getValue();this._setCurrent(d);p.focus(d);this._setValueAttr(b,!0);c.stopPropagation();c.preventDefault()},_setCurrent:function(c){"_currentFocus"in this&&f.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=c)&&f.set(c,"tabIndex",this.tabIndex)},_setValueAttr:function(c,d){0<=this._selectedCell&&k.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(c)for(var b=0;b<this._cells.length;b++)if(c==this._cells[b].dye.getValue()){this._selectedCell=b;k.add(this._cells[b].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?c:null);if(d||void 0===d)this.onChange(c)},onChange:function(){},_navigateByKey:function(c,d){-1!=d&&(c=this._currentFocus.idx+c,c<this._cells.length&&-1<c&&(c=this._cells[c].node,this._setCurrent(c),this.defer(r.hitch(p,"focus",c))))},_getDye:function(c){return this._cells[c.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(t){return t})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(t,f,k){return t("dijit.form.ComboBox",[f,k],{})})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(t,f,k,q){t=function(e){function r(d,c){var f=e[d];f&&(e[d]=function(b){var g;"put"===d&&(g=e.getIdentity(b));if(p)return f.apply(this,arguments);
p=!0;try{var a=f.apply(this,arguments);k(a,function(a){c("object"==typeof a&&a||b,g)});return a}finally{p=!1}})}var m=[],l=0;e=f.delegate(e);e.notify=function(d,c){l++;for(var e=m.slice(),b=0,f=e.length;b<f;b++)e[b](d,c)};var g=e.query;e.query=function(d,c){c=c||{};var n=g.apply(this,arguments);if(n&&n.forEach){var b=f.mixin({},c);delete b.start;delete b.count;var h=e.queryEngine&&e.queryEngine(d,b),a=l,p=[],r;n.observe=function(b,d){1==p.push(b)&&m.push(r=function(b,f){k(n,function(g){var k=g.length!=
c.count,m,n;if(++a!=l)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var r,t=-1,u=-1;if(void 0!==f){var v=[].concat(g);h&&!b&&(v=h(g));m=0;for(n=g.length;m<n;m++){var w=g[m];if(e.getIdentity(w)==f&&!(0>v.indexOf(w))){r=w;t=m;!h&&b||g.splice(m,1);break}}}h?b&&(h.matches?h.matches(b):h([b]).length)&&(m=-1<t?t:g.length,g.splice(m,0,b),u=q.indexOf(h(g),b),g.splice(m,1),c.start&&0==u||!k&&u==g.length?u=-1:g.splice(u,0,b)):b&&(void 0!==f?u=t:c.start||(u=
e.defaultIndex||0,g.splice(u,0,b)));if((-1<t||-1<u)&&(d||!h||t!=u))for(k=p.slice(),m=0;g=k[m];m++)g(b||r,t,u)})});var f={};f.remove=f.cancel=function(){var a=q.indexOf(p,b);-1<a&&(p.splice(a,1),p.length||m.splice(q.indexOf(m,r),1))};return f}}return n};var p;r("put",function(d,c){e.notify(d,c)});r("add",function(d){e.notify(d)});r("remove",function(d){e.notify(void 0,d)});return e};f.setObject("dojo.store.Observable",t);return t})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare",
"dojo/dom-class","dojo/sniff","./TextBox"],function(t,f,k,q){return t("dijit.form.SimpleTextarea",q,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);k("ie")&&this.cols&&
f.add(this.textbox,"dijitTextAreaCols")},filter:function(e){e&&(e=e.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(e){if(this.maxLength){var f=parseInt(this.maxLength),m=this.textbox.value.replace(/\r/g,""),f=m.length-f;if(0<f){var l=this.textbox;if(l.selectionStart){var g=l.selectionStart,p=0;k("opera")&&(p=(this.textbox.value.substring(0,g).match(/\r/g)||[]).length);this.textbox.value=m.substring(0,g-f-p)+m.substring(g-p);l.setSelectionRange(g-f,g-f)}else this.ownerDocument.selection&&
(l.focus(),m=this.ownerDocument.selection.createRange(),m.moveStart("character",-f),m.text="",m.select())}}this.inherited(arguments)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(t,f,k){return t("dijit.form.RadioButton",[f,k],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),function(t,f,k,q,e,r){return f("dijit.form._RadioButtonMixin",
null,{type:"radio",_getRelatedWidgets:function(){var f=[];e("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(q.hitch(this,function(e){e.name==this.name&&e.form==this.focusNode.form&&(e=r.getEnclosingWidget(e))&&f.push(e)}));return f},_setCheckedAttr:function(e){this.inherited(arguments);this._created&&e&&t.forEach(this._getRelatedWidgets(),q.hitch(this,function(e){e!=this&&e.checked&&e.set("checked",!1)}))},_getSubmitValue:function(e){return null==e?"on":e},_onClick:function(e){if(this.checked||
this.disabled)return e.stopPropagation(),e.preventDefault(),!1;if(this.readOnly)return e.stopPropagation(),e.preventDefault(),t.forEach(this._getRelatedWidgets(),q.hitch(this,function(e){k.set(this.focusNode||this.domNode,"checked",e.checked)})),!1;var f=!1,g;t.some(this._getRelatedWidgets(),function(e){return e.checked?(g=e,!0):!1});this.checked=!0;g&&(g.checked=!1);if(!1===this.onClick(e)||e.defaultPrevented)f=!0;this.checked=!1;g&&(g.checked=!0);f?e.preventDefault():this.set("checked",!0);return!f}})})},
"url:jimu/dijit/templates/AGOLLoading.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv class\x3d"symbol-chooser" style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.markerCategory}" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" style\x3d"position:relative"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-symbolSize"\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" data-a11y-label-by\x3d"point-symbol-section-symbolSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"point-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner"  data-a11y-label-by\x3d"point-symbol-section-outlineWidth" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"line-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-style"\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"jimu/dijit/formSelect" data-a11y-label-by\x3d"line-symbol-section-style" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"line-symbol-section-transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-width"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"line-symbol-section-width" data-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"fill-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"fill-symbol-section-outlineWidth" data-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-text"\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text"  data-a11y-label-by\x3d"text-symbol-section-text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontColor"\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"text-symbol-section-fontColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontSize"\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"text-symbol-section-fontSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n  \x3cimg class\x3d"tmp-image" style\x3d"display:none" data-dojo-attach-point\x3d"tmpImg"\x3e--\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\r\n\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" width\x3d"100%" height\x3d"100%" style\x3d"display:none;width:100%;height:100%"\x3e\r\n\x3c/div\x3e\r\n',"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e${_nls0}\x3c/li\x3e\r\n      \x3cli\x3e${_nls50}\x3c/li\x3e\r\n      \x3cli\x3e${_nls100}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"desktopAddSection" class\x3d"desktop-add-section hidden"\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddExpDesktop" class\x3d"add-with-icon add-expression jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddSetDesktop" class\x3d"add-with-icon add-set jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"matchMsg" class\x3d"match-msg"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"oneOrZeroMsg" tabindex\x3d"0" style\x3d"display:none;"\x3e${nls.oneOrZeroMsg}\x3c/div\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect" data-dojo-type\x3d"jimu/dijit/formSelect" class\x3d"dijit-form-Select restrict-select-width" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgAll}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgAny}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" class\x3d"hidden"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mobileAddSection" class\x3d"mobile-add-section hidden"\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addAnotherExpression}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddExpMobile"\x3e\r\n\t\t\t+ ${nls.addAnotherExpression}\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addSet}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddSetMobile"\x3e\r\n\t\t\t+ ${nls.addSet}\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip hidden" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/dateTimePicker.html":'\x3cdiv data-dojo-attach-point\x3d"dateTimeBox" class\x3d"jimu-dateTimeBox"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"calendarDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerRuntime" class\x3d"timeTextContainer timeTextContainerRuntime"\x3e\r\n\t\t\x3cdiv class\x3d"timeTextIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTextBoxDiv"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerSetting" class\x3d"timeTextContainer" style\x3d"display:none;"\x3e\r\n\t\t\x3cdiv class\x3d"timeCheckbox" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"timeCheckbox" data-dojo-props\x3d"checked:true, label:\'${timeNls.showTime}\'"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTableContainer" style\x3d"display:none;"\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.hour}"\x3e${timeUnit.hour}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.minute}"\x3e${timeUnit.minute}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.second}"\x3e${timeUnit.second}\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"hourSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'HH\', clickableIncrement: \'T01:00:00\', visibleIncrement: \'T01:00:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"minuteSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'mm\', clickableIncrement: \'T00:05:00\', visibleIncrement: \'T00:05:00\',pickerMin: \'T01:00:00\',pickerMax: \'T01:59:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"secondSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'ss\', clickableIncrement: \'T00:00:05\', visibleIncrement: \'T00:00:05\',pickerMin: \'T01:00:00\',pickerMax: \'T01:00:59\'}"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit1_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit2_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv1"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv2"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueSelect.html":'\x3cdiv class\x3d"jimu-list-multiple-select" data-dojo-attach-point\x3d"multipleSelect" tabindex\x3d"0"\x3e\r\n  \x3cdiv class\x3d"selectedContainer" data-dojo-attach-point\x3d"selectedContainer"\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-items-list items-content" data-dojo-attach-point\x3d"selectedListContent" tabindex\x3d"0"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv\x3e\r\n    \x3c!-- \x3cdiv style\x3d"position:absolute;height:345px;width:100%;z-index:1;display:none;" data-dojo-attach-point\x3d"listContainerOverlay"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"searchKeyInput" data-dojo-attach-point\x3d"searchKeyInput" style\x3d"display:none;"\x3e\r\n      \x3cinput value\x3d"" placeholder\x3d"${jimuCommonNls.search}" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n       data-dojo-attach-point\x3d"valueInput" data-dojo-props\x3d\'"required":false,intermediateChanges:true\' style\x3d"width:100%;" tabindex\x3d"0"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"items-content loading-center" data-dojo-attach-point\x3d"listContainer"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listContentStore"style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\r\n      \x3c/div\x3e --\x3e\r\n      \x3cdiv class\x3d"jimu-multiple-items-list" data-dojo-attach-point\x3d"listContent" tabindex\x3d"0"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadMoreDataBtn" class\x3d"jimu-list-multiple-select-Tips load-more-data-Tips"\x3e${jimuCommonNls.searchMore}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${Nls.noData}\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${noDataNls}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv class\x3d"createNewItem" data-dojo-attach-point\x3d"createNewItem" data-dojo-attach-event\x3d"click:_createTarget"\x3e\x26nbsp;\x3c/div\x3e --\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n    \x3cspan class\x3d"selectedToggle" data-dojo-attach-point\x3d"selectedToggle"\x3e\x3c/span\x3e\r\n    \x3cspan class\x3d"toggleTxt" title\x3d"${Nls.showSelected}"\x3e${Nls.showSelected}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n      \x3cdiv class\x3d"showAllIcon iconHover jimu-flipx" title\x3d"${Nls.showAll}" data-dojo-attach-point\x3d"showAllIconBtn"  tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"showSelectedIcon jimu-flipx" title\x3d"${Nls.showSelected}" data-dojo-attach-point\x3d"showSelectedIconBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"clearAllSelectedIcon jimu-flipx" title\x3d"${Nls.unCheckAll}" data-dojo-attach-point\x3d"clearAllSelectedBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueProvider.html":'\x3cdiv\x3e\r\n   \x3cdiv role\x3d"button" class\x3d"checkBtn" tabindex\x3d"0" data-dojo-attach-point\x3d"checkedBtn" style\x3d"display:none;" data-dojo-attach-event\x3d"click:_checkedBtnEvent"\x3e\r\n       \x3cspan class\x3d"screen-readers-only" data-dojo-attach-point\x3d"promptLabel"\x3e\x3c/span\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNumDiv" class\x3d"checkedNumDiv"\x3e\x3cspan class\x3d"checkedNum" data-dojo-attach-point\x3d"checkedNum"\x3e\x3c/span\x3e${CommonNls.selected}\x3c/div\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNameDiv" class\x3d"checkedNum checkedNameDiv jimu-ellipsis-Blanks"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8 checkBtnDownIcon"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n   \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3cdiv class\x3d"value-multiple-popup" data-dojo-attach-point\x3d"listContentPopup"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/pageControlForQuery.html":'\x3cdiv class\x3d"pageControl pageItem"\x3e\r\n  \x3c!--\r\n  \x3cdiv data-dojo-attach-point\x3d"prevPage" class\x3d"pageBtn pageDisabled pageItem"\x3e\x3c-prevPage\x3c/div\x3e\r\n  \x3cdiv class\x3d"pageItem" data-dojo-attach-point\x3d"currentPage"\x3e1\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"nextPage" class\x3d"pageBtn pageItem"\x3enextPage-\x3e\x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3c!-- \x3cdiv data-dojo-attach-point\x3d"addNextPage"\x3eLoad more data(Test)\x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValueProvider.html":'\x3cdiv\x3e\r\n    \x3c!-- \x3cdiv data-dojo-attach-point\x3d"valueproviderStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3cdiv class\x3d"predefined-btn"  data-dojo-attach-point\x3d\'indexBtn\'\x3e\r\n        \x3cdiv class\x3d"tip jimu-ellipsis" title\x3d"predefined" data-dojo-attach-point\x3d\'indexBtnTips\'\x3epredefined\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d\'valueProviderPopupNode\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/EditTable.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${Nls.value}"\x3e${Nls.value}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${CommonNls.label}"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"${CommonNls.defaults}"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis" title\x3d"${CommonNls.actions}"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked, dblclick:_onListContentDblClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValuePopup.html":'\x3cdiv\x3e\r\n   \x3c!--\r\n    \x3cselect data-dojo-attach-point\x3d"valProviderSelect" class\x3d"dijit-form-Select multiple-Select"  data-dojo-attach-event\x3d"onclick:_showPopup"\x3e\r\n    \x3c/select\x3e\r\n    --\x3e\r\n    \x3c!-- \x3cdiv class\x3d"subTitle"\x3e${CommonNls.layer}: \x3cspan data-dojo-attach-point\x3d"layerName"\x3e\x3c/span\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listSelectStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n\r\n      \x3c!-- for list select popup --\x3e\r\n      \x3c!-- \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e --\x3e\r\n      \x3c!-- for eidtTable --\x3e\r\n      \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"add-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e\r\n        \x3cdiv class\x3d"tip"\x3eopenLayer-temp\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"add-btn add-btn-right" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n       --\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"tableContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"displayTypes" data-dojo-attach-point\x3d"displayTypes" data-dojo-attach-event\x3d"click:_changeDisplayType"\x3e\r\n      \x3cdiv class\x3d"title jimu-ellipsis"\x3e${Nls.displayAs}\x3c/div\x3e\r\n      \x3cspan class\x3d"option dropdownOption"\x3e\r\n        \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aDrowdownList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n      \x3cspan class\x3d"option expandedOption"\x3e\r\n      \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aExpandedList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.name}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"set default?"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    --\x3e\r\n\r\n    \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valuesPopupNode" style\x3d"display:none;"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"mutiValuesSelect" multiple\x3d"true" data-dojo-type\x3d"dojox/form/CheckedMultiSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" \x3e\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"pageControlContainer"\x3eLoad more data\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- \x3ca data-dojo-attach-event\x3d"onclick:_setSelectType" class\x3d"popupOper" style\x3d"display:none;"\x3etype\x3c/a\x3e --\x3e\r\n  \x3c/div\x3e',
"url:dojox/form/resources/_CheckedMultiSelectMenuItem.html":'\x3ctr class\x3d"dijitReset dijitMenuItem" dojoAttachPoint\x3d"focusNode" role\x3d"menuitemcheckbox" tabIndex\x3d"-1"\r\n\tdojoAttachEvent\x3d"ondijitclick:_onClick"\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\r\n\t\t\x3e\x3cdiv src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitMenuItemIcon ${_iconClass}" dojoAttachPoint\x3d"iconNode"\r\n\t\t\t\x3e\x3cinput class\x3d"dojoxCheckedMultiSelectCheckBoxInput" dojoAttachPoint\x3d"inputNode" type\x3d"${_type.type}"\r\n\t\t/\x3e\x3c/div\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" dojoAttachPoint\x3d"containerNode,labelNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" dojoAttachPoint\x3d"accelKeyNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26nbsp;\x3c/td\r\n\x3e\x3c/tr\x3e',
"url:dojox/form/resources/_CheckedMultiSelectItem.html":'\x3cdiv class\x3d"dijitReset ${baseClass}"\r\n\t\x3e\x3cinput class\x3d"${baseClass}Box" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"checkBox" \r\n\t\tdata-dojo-attach-event\x3d"_onClick:_changeBox" type\x3d"${_type.type}" data-dojo-props\x3d\'disabled:${disabled}, readOnly:${readOnly}\' baseClass\x3d"${_type.baseClass}"\r\n\t/\x3e\x3cdiv class\x3d"dijitInline ${baseClass}Label" data-dojo-attach-point\x3d"labelNode" data-dojo-attach-event\x3d"onclick:_onClick"\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/form/resources/CheckedMultiSelect.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"comboButtonNode"\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"selectNode" class\x3d"dijit dijitReset dijitInline ${baseClass}Wrapper" data-dojo-attach-event\x3d"onmousedown:_onMouseDown,onclick:focus"\r\n\t\t\x3e\x3cselect class\x3d"${baseClass}Select dojoxCheckedMultiSelectHidden" multiple\x3d"true" data-dojo-attach-point\x3d"containerNode,focusNode"\x3e\x3c/select\r\n\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"wrapperDiv"\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateIsInValueProvider.html":'\x3cdiv\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"settings-container"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"fields-select dijit-form-FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n      \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n    \x3c/select\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"attribute-value-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueProviderContainer" class\x3d"value-provider-container"\x3e\x3c/div\x3e\r\n      \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"valueTypeSetNode" title\x3d"${nls.setInputType}" class\x3d"value-type-set jimu-icon jimu-icon-setting"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"askvalues"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n              \x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgSetAll}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgSetAny}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-delete"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnDelete" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-add"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnAdd" aria-label\x3d"\'${nls.addText}\'" class\x3d"jimu-icon jimu-icon-add" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox" class\x3d"jimu-filter-exps-box"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"valueProviderTd"\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"*now":function(t){t(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager ./DataSourceManager ./FilterManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/keys dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main esri/main dojo/ready".split(" "),function(t,f,k,q,e,r,m,l,g,p,d,c,n,b,h,a,u,v,x,
z,E,C,A,w,B,F,D,G,H,M){function L(){var a=window.location.search,b={query:!0};if(""===a)return{};var a=x.queryToObject(a.substr(1)),c;for(c in a)b[c]||(a[c]=B.sanitizeHTML(a[c]));return a}function J(a,b){K=a;"loadingPageChange"!==b&&g.setStyle(jimuConfig.mainPageId,"display","block")}u={};var K;window.topic=h;z.defaults.io.timeout=18E4;"function"!==typeof a.getAll&&(a.getAll=function(b){var c=[];(b=a(b))&&c.push(b);return c});window.jimuNls=G;window.apiNls=H.bundle;A.setProtocolErrorHandler(function(){return!0});
A=B.getAncestorWindow();var N=!1,P=/^http(s?):\/\//gi;try{N=0===A.location.href.indexOf("https://")}catch(Q){}E.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);N&&(a.url=a.url.replace(P,"//"));if(-1!==a.url.indexOf("/queryRelatedRecords?")){var b=a.url,c=z.defaults.io.proxyUrl;c&&0===a.url.indexOf(c+"?")&&(b=a.url.replace(c+"?",""));B.isHostedService(b)||(a.url=a.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(a.url)&&(a.preventCache=(new Date).getTime());
window.isBuilder||!K||K.mode||(K.appProxies&&0<K.appProxies.length&&d.some(K.appProxies,function(b){var c=b.sourceUrl;b=b.proxyUrl;N&&(c=c.replace(P,"//"),b=b.replace(P,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),!0}),K.map.appProxy&&d.some(K.map.appProxy.proxyItems,function(b){if(!b.useProxy||!b.proxyUrl)return!1;var c=b.sourceUrl;b=b.proxyUrl;N&&(c=c.replace(P,"//"),b=b.replace(P,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),!0}));return a});c(window,"mousedown",
function(a){B.isInNavMode()&&(g.removeClass(document.body,"jimu-nav-mode"),window.isMoveFocusWhenInit=!1);if(b.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});c(window,"keydown",function(a){a.keyCode!==n.TAB||B.isInNavMode()||g.addClass(document.body,"jimu-nav-mode")});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};Number.isNaN=Number.isNaN||
function(a){return a!==a};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=p.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.13";window.productVersion="Online 7.2";window.isBuilder?(h.subscribe("app/appConfigLoaded",J),h.subscribe("app/appConfigChanged",J)):(h.subscribe("appConfigLoaded",J),h.subscribe("appConfigChanged",
J));if(p=B.has("ie"))9<p?g.addClass(document.body,"ie-nav-mode"):g.addClass(document.body,"ie-low-nav-mode"),10<p&&g.addClass(document.body,"ie-gte-10");u.initApp=function(){var a,b;console.log("jimu.js init...");a=L();if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(R){console.error("mobileBreakPoint URL parameter must be a number.",R)}a.mode&&(g.setStyle(jimuConfig.loadingId,"display","none"),g.setStyle(jimuConfig.mainPageId,"display","block"));k.getInstance(q.getInstance());
e.getInstance();r.getInstance();m.getInstance();l.getInstance();b=f.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=t.getInstance(a);b.startup();a.loadConfig();F(["dynamic-modules/preload"]);M(function(){setTimeout(function(){g.removeClass(document.body,"dj_a11y")},50)})};return u});