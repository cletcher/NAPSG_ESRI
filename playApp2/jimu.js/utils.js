// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang moment/moment esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils ./shared/utils ./accessibleUtils ./zoomToUtils libs/caja-html-sanitizer-minified".split(" "),
function(k,h,m,z,v,M,w,ra,q,Y,A,B,E,N,Z,aa,O,C,F,P,G,ba,ca,da,ea,fa,Q,ga,R,ha,S,ia,t,x,ja,ka,la,H,ma,u,I,na,oa){function pa(a,b){a=a||"";var c=0,d=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!e.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){c++;c===d.length&&b()}}];for(a=0;a<d.length;a++)testLoad(d[a])}function T(a,b){var c=a.match(/url\([^)]+\)/gi),d,f;if(null===c||""===b)return a;for(d=0;d<c.length;d++)if(f=c[d].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),
4<=f.length){var e=f[2];/^data:image\/.*;/.test(e)||(b.endWith("/")||(b+="/"),a=a.replace(f[1]+e+f[3],f[1]+b+e+f[3]))}return a}function J(a,b){var c=Array.isArray(b),d=c&&[]||{};c?(a=a||[],d=d.concat(a),b.forEach(function(b,c){"undefined"===typeof a[c]?d[c]=b:"object"===typeof b?d[c]=J(a[c],b):-1===a.indexOf(b)&&d.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){d[b]=a[b]}),Object.keys(b).forEach(function(c){d[c]="object"===typeof b[c]&&b[c]?a[c]?J(a[c],b[c]):b[c]:b[c]}));return d}
function U(a,b){var c=a.map(function(a){return a.id});h.forEach(b,function(b){0>c.indexOf(b)&&a.push({id:b,widgets:[]})},this);var d=[];a=h.filter(a,function(a){return 0>b.indexOf(a.id)?(d.push(a),!1):!0},this);if(0===a.length)return[];var f=a[a.length-1];h.forEach(d,function(a){f.widgets=f.widgets.concat(a.widgets)},this);return a=a.sort(function(a,c){return b.indexOf(a.id)-b.indexOf(c.id)})}function K(a,b,c){function d(a,b){return k.isArray(a[b.key])?a[b.key][b.index]:a[b.key]}b=function(a){var b=
[];a.split("_").forEach(function(a){var c=!1,d;"--"===a.slice(a.length-2)&&(c=!0,a=a.slice(0,a.length-2));d=a.search(/\[[0-9]+\]/);-1===d&&(d=a.length);b.push({key:a.slice(0,d),index:Number(a.slice(d+1,-1)),deleteFlag:c})});return b}(b);for(var f=1;f<b.length-1;f++)if(a=d(a,b[f]),!a)return;if(b[b.length-1].deleteFlag)!0===c&&(k.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(k.isArray(a[b[b.length-1].key])){if(void 0===c)return a[b[b.length-
1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=c}else{if(void 0===c)return a[b[b.length-1].key];a[b[b.length-1].key]=c}}function V(a,b,c){function d(c){c=e.template.getSearchRange(b,c,"]");var d=b.slice(c.firstPos,c.lastPos);return-1!==c.firstPos?(d=b.slice(c.firstPos+d.indexOf("[")+1,c.lastPos-1),c=b.slice(c.lastPos+1),(d=e.getConfigElementById(a,d))?{object:d,key:"section_"+c,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var f=a,g=b=b.replace(/\//g,"_"),l=
d("groups\\[.+\\]");if("deleted"!==l.state&&("isSection"===l.state&&(f=l.object,g=l.key),l=d("widgets\\[.+\\]"),"delete"!==l.state))return"isSection"===l.state&&(f=l.object,g=l.key),K(f,g,c)}var e={},W={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};k.mixin(e,I);k.mixin(e,na);k.mixin(e,oa);window.atob||(window.atob=function(a){a=O.decode(a);for(var b="",c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);return b});window.btob||(window.btob=function(a){for(var b=
[],c=0,d=a.length;c<d;c++)b.push(String.charCodeAt(a[c]));return O.encode(b)});var D="unload",X=[];require.on("error",function(a){h.forEach(X,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var c in a.info)-1<c.indexOf(b.resKey)&&b.def.reject(a)})});e.checkError=function(a,b){X.push({resKey:a,def:b})};e.replacePlaceHolder=function(a,b){var c=B.stringify(a),d=c.match(/\$\{(\w)+\}/g);if(null===d)return a;for(a=0;a<d.length;a++){var f=d[a].match(/(\w)+/g)[0];b[f]&&(c=c.replace(d[a],
b[f]))}return B.parse(c)};e.changeUnit=function(a){var b=Math.abs(a),c;a=Math.floor(b);c=Math.floor(60*(b-a));b=(60*(60*(b-a)-c)).toFixed(2);return a+"\u00b0"+(10>c?"0"+c:c)+"'"+(10>b?"0"+b:b)+'"'};e.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};e.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+
parseInt(a[3],10)/10)};e.preloadImg=function(a,b){var c=[],c="string"===typeof a?[a]:a;h.forEach(c,function(a){(new Image).src=b?b+a:a})};e.setWABLogoDefaultAlt=function(a){if(a){a=w("img",a);for(var b=["img_1412759111499","img_1545621838463","img_1560482577021"],c=0,d=a.length;c<d;c++){var f=a[c];-1<b.indexOf(m.getAttr(f,"id"))&&!m.getAttr(f,"alt")&&m.setAttr(f,"alt","Web AppBuilder for ArcGIS.png")}}};var y=null;e.getImagesSize=function(a){var b=new q;if(!a||0!==a.indexOf("http"))return b.reject(),
b;null===y&&(y=m.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var c=A(y,"load",function(){clearTimeout(d);d=null;c.remove();var a=m.getContentBox(y);1===a.w&&1===a.h||0===a.w||0===a.h?b.reject():b.resolve([a.w,a.h])},{}),d=setTimeout(function(){clearTimeout(d);d=null;b.reject()},5E3);m.setAttr(y,"src",a);return b};e.getPositionStyle=function(a){var b={};if(!a)return b;a=k.clone(a);if(window.isRTL){var c;"undefined"!==typeof a.left&&
"undefined"!==typeof a.right?(c=a.left,a.left=a.right,a.right=c):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(c=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=c):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight);"undefined"!==
typeof a.marginLeft&&"undefined"!==typeof a.marginRight?(c=a.marginLeft,a.marginLeft=a.marginRight,a.marginRight=c):"undefined"!==typeof a.marginLeft?(a.marginRight=a.marginLeft,delete a.marginLeft):"undefined"!==typeof a.marginRight&&(a.marginLeft=a.marginRight,delete a.marginRight)}c="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var d=0;d<c.length;d++){var f=c[d];"number"===typeof a[f]?
b[f]=a[f]+"px":"undefined"!==typeof a[f]?b[f]=a[f]:"padding"===f.substr(0,7)||"margin"===f.substr(0,7)?b[f]=0:b[f]="auto"}b.zIndex="undefined"===typeof a.zIndex?"auto":a.zIndex;return b};e.isEqual=function(a,b){function c(a,b){var e;if(null===a&&null===b||"undefined"===typeof a&&"undefined"===typeof b)return!0;if(null===a&&null!==b||null===b&&null!==a||"undefined"===typeof a&&"undefined"!==typeof b||"undefined"===typeof b&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&
"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof RegExp&&b instanceof RegExp||a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<d.indexOf(a)||-1<f.indexOf(b))return!1;if(null!==b){for(e in b)if(b.hasOwnProperty(e)!==a.hasOwnProperty(e)||typeof b[e]!==typeof a[e])return!1;for(e in a){if(b.hasOwnProperty(e)!==a.hasOwnProperty(e)||typeof b[e]!==
typeof a[e])return!1;switch(typeof a[e]){case "object":case "function":d.push(a);f.push(b);if(!c(a[e],b[e]))return!1;d.pop();f.pop();break;default:if(!(isNaN(a[e])&&isNaN(b[e])&&"number"===typeof a[e]&&"number"===typeof b[e]||a[e]===b[e]))return!1}}}return!0}var d,f;d=[];f=[];return c(a,b)?!0:!1};e.file={loadFileAPI:function(){var a=new q;if("unload"===D){var b=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:b+"libs/polyfills/fileAPI/",flashUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.swf",
flashImageUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};pa(b,k.hitch(this,function(){D="loaded";a.resolve()}));D="loading"}else"loaded"===D&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return z("safari")&&6>z("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(b){a=
null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-e.file.getNameFromPath(a).length)},readFile:function(a,b,c,d){if(this.supportHTML5()){var f=a.target.files[0];f&&(f.type.match(b)?f.size>=
c?d({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){d(null,f.name,a.target.result)},a.readAsDataURL(f)):d({errCode:"invalidType"}))}else if(this.supportFileAPI()){var e=window.FileAPI.getFiles(a);e[0].type.match(b)?e[0].size>=c?d({errCode:"exceed"}):window.FileAPI.readAsDataURL(e[0],function(a){a&&a.result?d(null,e[0].name,a.result):d({errCode:"readError"})}):d({errCode:"invalidType"})}}};e.getUriInfo=function(a){var b,c={};b=a.indexOf("/");a.substring(0,b);b=a.substring(0,a.lastIndexOf("/")+
1);c.folderUrl=require(e.getRequireConfig()).toUrl(b);c.amdFolder=b;c.url=c.folderUrl;if(/^http(s)?:\/\//.test(a)||/^\/\//.test(a))c.isRemote=!0;return c};e.widgetJson=function(){var a={addManifest2WidgetJson:function(a,c){k.mixin(a,c.properties);a.name=c.name;a.label||(a.label=c.label);a.manifest=c;a.isRemote=c.isRemote;a.isRemote&&(a.itemId=c.itemId);c.featureActions&&(a.featureActions=c.featureActions);a.icon||(a.icon=c.icon);a.thumbnail||(a.thumbnail=c.thumbnail);a.folderUrl=c.folderUrl;a.amdFolder=
c.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var b in a.manifest.properties)a[b]=void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}},getUriFromItem:function(b){return b.url?a.getFolderUrlFromItem(b)+"Widget":null},getFolderUrlFromItem:function(a){if(!a.url)return null;a=/manifest\.json$/.test(a.url)?a.url.substring(0,a.url.length-13):/\/$/.test(a.url)?a.url:a.url+"/";"https:"===window.location.protocol&&(a=a.replace(/^http:\/\//,"https://"));
return a}};return a}();e.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};e.getTypeByGeometryType=function(a){var b="",c="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),d=["esriGeometryRing",
"esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=c.indexOf(a)?b="polyline":0<=d.indexOf(a)&&(b="polygon");return b};e.getSymbolTypeByGeometryType=function(a){var b=null;a=e.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b="fill");return b};e.getServices=function(){return W};e.getArcGISDefaultGeometryService=function(){return new R(W.geometryService)};e.restoreToDefaultWebMapExtent=function(a,
b,c){var d=new q;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){d.reject("Invalid map.")},0),d;b=b&&b.itemInfo;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo")},0),d;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){d.reject("Invalid itemInfo.item.extent")}),d;var f=new ba({wkid:4326}),f=new ca(b[0][0],b[0][1],b[1][0],b[1][1],f);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(f);if(a.spatialReference.isWebMercator())return f=ga.geographicToWebMercator(f),
a.setExtent(f);b=new ha;b.geometries=[f];b.outSR=a.spatialReference;f=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;f&&"esri.tasks.GeometryService"===f.declaredClass||(c&&"string"===typeof c&&k.trim(c)?(c=k.trim(c),f=new R(c)):f=e.getArcGISDefaultGeometryService());f.project(b).then(function(b){if(b=b&&b[0])return a.setExtent(b);d.reject("Invalid projected geometry.");return d},function(a){console.error(a);d.reject(a);return d});return d};e.getAncestorWindow=function(){for(var a=
window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};e.getAncestorDom=function(a,b,c){if(a&&1===a.nodeType&&b&&"function"===typeof b){var d=100,e=document.body;c&&("number"===typeof c?(c=parseInt(c,10),0<c&&(d=c)):1===c.nodeType&&(e=c));for(c=0;a.parentNode&&c<d&&m.isDescendant(a.parentNode,e);){if(b(a.parentNode))return a.parentNode;a=a.parentNode;c++}}return null};e.bindClickAndDblclickEvents=function(a,b,c,d){var e=null;if(a&&1===a.nodeType&&b&&"function"===typeof b&&c&&"function"===typeof c){var g=
200;d&&"number"===typeof d&&(d=parseInt(d,10),0<d&&(g=d));var l=0,e=A(a,"click",function(a){l++;1===l?setTimeout(function(){1===l&&(l=0,b(a))},g):2===l&&(l=0,c(a))})}return e};e.isScrollToBottom=function(a){var b=m.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+b.h)};e.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};e.getItemQueryStringByTypes=function(a){var b="",c=e.getAllItemTypes();if(a&&0<a.length&&0<a.length){var d="";h.forEach(a,function(b,c){d+=' type:"'+b+'" ';c!==a.length-1&&(d+=" OR ")});b=" ( "+d+" ) ";c=a.concat(c);c=h.filter(c,function(b){return h.every(a,
function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});h.forEach(c,function(a){b+=' -type:"'+a+'" '})}return b};e.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};e.isNotEmptyString=function(a,b){var c=a&&"string"===typeof a;return c?b?c&&k.trim(a):!0:!1};e.isNotEmptyStringArray=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(!e.isNotEmptyString(d.value?d.value:d,b))return!1}return!0};e.isValidNumber=function(a){return"number"===
typeof a&&!isNaN(a)};e.isValidNumberArray=function(a){for(var b=0;b<a.length;b++){var c=a[b],c=c.value||0===c.value?c.value:c;if(!e.isValidNumber(c))return!1}return!0};e.isValidDate=function(a){if(a)try{var b=e.getDateByDateTimeStr(a);return!isNaN(b.getTime())}catch(c){return console.error(c),!1}else return!1};e.isObject=function(a){return a&&"object"===typeof a};e.createWebMap=function(a,b,c,d){a=u.getStandardPortalUrl(a);a=u.getBaseItemUrl(a);P.arcgisUrl=a;return P.createMap(b,c,d)};e.getRandomString=
function(){var a=Math.random().toString();return a=a.slice(2,a.length)};e._getDomainsByServerName=function(a){var b=a.split("."),c=b.length;return h.map(b,k.hitch(this,function(a,e){a=b.slice(e,c);var d="",f=a.length-1;h.forEach(a,k.hitch(this,function(a,b){d+=a;b!==f&&(d+=".")}));return d}))};e.removeCookie=function(a,b){var c=this._getDomainsByServerName(window.location.hostname);h.forEach(c,k.hitch(this,function(c){E(a,null,{expires:-1,path:b});E(a,null,{expires:-1,path:b,domain:c});E(a,null,{expires:-1,
path:b,domain:"."+c})}))};e.isLocaleChanged=function(a,b){return!a.startWith(b)};e.hashToObject=function(a){a=a.replace("#","");a=M.queryToObject(a);for(var b in a)if(a.hasOwnProperty(b))try{a[b]=B.parse(a[b])}catch(c){}return a};e.reCreateObject=function(a){function b(a){var d=[];a.forEach(function(a){Array.isArray(a)?d.push(b(a)):"object"===typeof a?d.push(c(a)):d.push(a)});return d}function c(a){var d={},e;for(e in a)a.hasOwnProperty(e)&&(null===a[e]?d[e]=null:Array.isArray(a[e])?d[e]=b(a[e]):
d[e]="object"===typeof a[e]?c(a[e]):a[e]);return d}return Array.isArray(a)?b(a):c(a)};e.setVerticalCenter=function(a){setTimeout(function(){var b=w(".jimu-vcenter-text",a),c,d;h.forEach(b,function(a){c=m.getContentBox(a).h;m.setStyle(a,{lineHeight:c+"px"})},this);b=w(".jimu-vcenter",a);h.forEach(b,function(a){c=m.getContentBox(a).h;d=m.getContentBox(w(a).parent()[0]).h;m.setStyle(a,{marginTop:(d-c)/2+"px"})},this)},10)};e.merge=J;e.loadStyleLink=function(a,b,c){var d=new q,f,g=require(e.getRequireConfig()).toUrl(b);
if(require.cache["url:"+g]){f=require.cache["url:"+g];var l=g.split("/").pop(),g=g.substr(0,g.length-l.length);f=T(f,g);a=c?m.create("style",{id:a,type:"text/css"},m.byId(c),"before"):m.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=f:a.appendChild(m.toDom(f));d.resolve("load");return d}f=c?m.create("link",{id:a,rel:"stylesheet",type:"text/css",href:g+"?wab_dv\x3d"+window.deployVersion},m.byId(c),"before"):m.create("link",
{id:a,rel:"stylesheet",type:"text/css",href:g+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);A(f,"load",function(){d.resolve("load")});var p=setInterval(function(){var a;if(h.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(b),c.href.length)===b)return a=c,!0}))try{!d.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&d.resolve("load"),clearInterval(p)}catch(r){}},50);return d};e.changeLocation=function(a){window.history.pushState&&
window.history.pushState({path:a},"",encodeURI(a))};e.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=t.urlToObject(a),b.hash=null):(a=a.split("#"),b=t.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?M.queryToObject(a[1]):a[1]:null);return b};e.manifest=function(){function a(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon=
"layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}return{addManifestProperies:function(b){b.icon||(b.icon=b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);b.thumbnail||(b.thumbnail=b.folderUrl+"images/thumbnail.png");"theme"===b.category?a(b):("undefined"!==typeof b["2D"]&&(b.support2D=b["2D"]),"undefined"!==typeof b["3D"]&&(b.support3D=b["3D"]),"undefined"===typeof b["2D"]&&"undefined"===typeof b["3D"]&&(b.support2D=!0),delete b["2D"],delete b["3D"],"undefined"===
typeof b.properties&&(b.properties={}),I.processWidgetProperties(b))},processManifestLabel:function(a,c){var b=c.split("-")[0];a.label=a.i18nLabels&&(a.i18nLabels[c]||a.i18nLabels[b]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&h.forEach(a.layouts,function(b){var d="i18nLabels_layout_"+b.name;b.label=a[d]&&(a[d][c]||a[d].defaultLabel)||b.label||b.name});a.styles&&h.forEach(a.styles,function(b){var d="i18nLabels_style_"+b.name;b.label=a[d]&&(a[d][c]||a[d].defaultLabel)||b.label||b.name})},
addI18NLabel:function(a){var b=new q;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var d;d=a.isRemote?a.amdFolder+"nls/strings.js":a.amdFolder+"nls/strings";require(e.getRequireConfig(),["dojo/i18n!"+d],function(c){var d={};d[dojoConfig.locale]=c;I.addI18NLabelToManifest(a,null,d);b.resolve(a)});return b}}}();e.isNumberField=function(a){return 0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"].indexOf(a)};e.getTime=function(a){var b=a.getTimezoneOffset(),b=0>b?"+"+Math.abs(b)/60:"-"+b/60;return a.getTime()+36E5*b};e.getUniqueValues=function(a,b,c,d,f){return function(){var b=new q,c={};d?(c.layerDefinition=d,f&&(c.fieldPopupInfo=f),b.resolve(c)):b=x({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(a){c.layerDefinition=a;return c},function(a){console.log("Error: ",a.message)});return b}().then(function(d){return e._getUniqueValues(a,
b,c,d.layerDefinition).then(function(a){return e._getValues(d.layerDefinition,d.fieldPopupInfo,b,a)})})};e._getValues=function(a,b,c,d){var f=[],f=e.getFieldInfoByFieldName(a.fields,c),g=null,l=e.isNumberField(f.type),p="esriFieldTypeDate"===f.type?!0:!1;if(f){if(l)d=h.map(d,function(a){a=parseFloat(a);isNaN(a)&&(a=null);return a});else if(p)return f=h.map(d,k.hitch(this,function(a){var c=a,d=a;e.isValidDate(a)&&(c=e.getDateTimeStrByFieldInfo(a,b),d=e.localizeDateByFieldInfo(a,b));return{value:c,
label:d}}));a=e.getCodedValueListForCodedValueOrSubTypes(a,c);if(null!==a)for(g={},c=0;c<a.length;c++)g[a[c].value]=a[c].label}return f=h.map(d,function(a){var c=null,c=null===a||void 0===a?"\x3cNull\x3e":g&&g.hasOwnProperty(a)?g[a]:l?b?e.localizeNumberByFieldInfo(a,b):e.localizeNumber(a):p?e.localizeDateByFieldInfo(new Date(a),b):a;return{value:a,label:c}})};e._getUniqueValues=function(a,b,c,d){var f=new q;a=a.replace(/\/*$/g,"");c||(c="1\x3d1");var f=/\/ImageServer$/gi.test(a),g=-1<a.indexOf("MapServer/dynamicLayer");
f||g?f=e._getUniqueValuesByQueryTask(a,b,c):(f=e.getFieldInfoByFieldName(d.fields,b),f=0<e.getCodedValuesOrTypesCount(f,d)?e._getUniqueValuesByQueryTask(a,b,c):e._getUniqueValuesByGenerateRenderer(a,b,c));return f};e.getCodedValuesOrTypesCount=function(a,b){return a?b.typeIdField&&b.typeIdField.toUpperCase()===a.name.toUpperCase()&&b.types?b.types.length:(a=e._getAllCodedValue(b,a))?a.length:0:0};e._getUniqueValuesByQueryTask=function(a,b,c){var d=new ja;d.where=c;d.returnDistinctValues=!0;d.returnGeometry=
!1;d.outFields=[b];return(new ka(a)).execute(d).then(function(a){var c=[];a.features&&0<a.features.length&&h.forEach(a.features,function(a){a&&a.attributes&&c.push(a.attributes[b])});return c})};e._getUniqueValuesByGenerateRenderer=function(a,b,c){var d=new q,e=a.split("?");a=1<e.length?e[0].replace(/\/*$/g,"")+"/generateRenderer?"+e[1]:a.replace(/\/*$/g,"")+"/generateRenderer";b=B.stringify({type:"uniqueValueDef",uniqueValueFields:[b]});x({url:a,content:{classificationDef:b,f:"json",where:c},handleAs:"json",
callbackParamName:"callback"}).then(k.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=h.map(a,k.hitch(this,function(a){return a.value})));d.resolve(b)}),k.hitch(this,function(a){d.reject(a)}));return d};e.isCodedValuesSupportFilter=function(a,b){a=a.currentVersion?a:a.toJson().layerDefinition;var c=parseFloat(a.currentVersion);return b<=parseFloat(a.maxRecordCount)&&10.1<c};e.combineRadioCheckBoxWithLabel=function(a,b){var c=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var d=
a.getAttribute("type")||"",d=d.toLowerCase();if("radio"===d||"checkbox"===d)c=!0}d=!1;b&&1===b.nodeType&&"label"===b.tagName.toLowerCase()&&(d=!0);c&&d&&(c=a.getAttribute("id"),c||(c="input_"+e.getRandomString(),a.setAttribute("id",c)),b.setAttribute("for",c),m.setStyle(b,"cursor","pointer"))};e.groupRadios=function(a,b){var c=[],d="radiogroup_"+e.getRandomString();h.forEach(a,function(a){a.name=d;b&&(a=A(a,"change",b),c.push(a))});return c};e.convertExtentToPolygon=function(a){var b=a.xmin,c=a.xmax,
d=a.ymin,e=a.ymax;return new Q({rings:[[[b,e],[c,e],[c,d],[b,d],[b,e]]],spatialReference:a.toJson()})};e.combineGeometries=function(a){function b(a){var b={points:[],spatialReference:a[0].spatialReference.toJson()};h.forEach(a,function(a){"point"===a.type?b.points=b.points.concat([[a.x,a.y]]):"multipoint"===a.type&&(b.points=b.points.concat(a.points))});return new ea(b)}function c(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};h.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});
return new fa(b)}function d(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};h.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=e.convertExtentToPolygon(a),b.rings=b.rings.concat(a.rings))});return new Q(b)}var f=null;if(a&&0<a.length)if(1===a.length)f=a[0];else{for(var g=null,l=null,p=null,n=null,r=0;r<a.length;r++){g=a[r];switch(g.type){case "point":case "multipoint":n="point";break;case "polyline":n="polyline";break;case "polygon":case "extent":n=
"polygon";break;default:return null}if(0===r)p=n;else if(p!==n)return null;if(r!==a.length-1&&(l=a[r+1],!g.spatialReference.equals(l.spatialReference)))return null}"point"===n?f=b(a):"polyline"===n?f=c(a):"polygon"===n&&(f=d(a))}return f};e.combineGeometriesByGraphics=function(a){var b=null;a&&0<a.length&&(a=h.map(a,function(a){return a.geometry}),b=e.combineGeometries(a));return b};e.isFeaturelayerUrlSupportQuery=function(a,b){var c=!1,d=/\/featureserver\//gi.test(a);a=/\/mapserver\//gi.test(a);
b=(b||"").toLowerCase();d?c=0<=b.indexOf("query"):a&&(c=0<=b.indexOf("data"));return c};e.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};e.isStringEndWith=function(a,b){return a.lastIndexOf(b)+b.length===a.length};e.localizeNumber=function(a,b){var c=(a.toString().split(".")[1]||"").length,d="",d=b&&isFinite(b.places)&&b.places,d=0<d||0<c?"#,###,###,##0.0"+Array.prototype.join.call({length:0<d?d+1:c},"0"):"#,###,###,##0",c={locale:v.locale,pattern:d};k.mixin(c,
b||{});try{return N.format(a,c)}catch(f){return console.error(f),a.toLocaleString()}};e.parseNumber=function(a,b){var c={locale:v.locale};k.mixin(c,b||{});try{return N.parse(a,c)}catch(d){return console.error(d),a}};e.localizeDate=function(a,b){var c={locale:v.locale,fullYear:!0};k.mixin(c,b||{});"ar"===v.locale&&"long"!==c.formatLength&&"full"!==c.formatLength&&(c.formatLength="long");try{return Z.format(a,c)}catch(d){return console.error(d),"date"===c.selector?a.toLocaleDateString():"time"===c.selector?
a.toLocaleTimeString():a.toLocaleString()}};e.localizeNumberByFieldInfo=function(a,b){var c=null,c=k.exists("format.places",b)&&b.format.places,c=e.localizeNumber(a,{places:c});return k.exists("format.digitSeparator",b)&&!b.format.digitSeparator?c.toString().replace(new RegExp("\\"+aa.group,"g"),""):c};e.localizeDateByFieldInfo=function(a,b){var c=null;try{var d={date:a instanceof Date?a.getTime():a},e=k.exists("format.dateFormat",b)?b.format.dateFormat:"longMonthDayYear",c=C.substitute(d,"${date}",
{dateFormat:{properties:["date"],formatter:"DateFormat"+G.prototype._dateFormats[e]}})}catch(g){console.error(g),c=a}return c};e.getDatePatternsByFormat=function(a){return G.prototype._dateFormatsJson[a]};e.localizeDateTimeByFieldInfo=function(a,b,c,d){var f={h:"h",m:"h:mm",s:"h:mm:ss"},g={h:"H",m:"H:mm",s:"H:mm:ss"},l=function(a,b,c){a=e.getDatePatternsByFormat(a).datePattern;var d=f[b],d=c||"h"===b?f[b]+" a":g[b];return"(datePattern: '"+a+"', timePattern: '"+d+"', selector: 'date and time')"},p,
n,h=null;try{var L={date:a instanceof Date?a.getTime():a};if(k.exists("format.dateFormat",b)){var m=b.format.dateFormat;c?n=0<m.indexOf("Time")?l(m,d,0>m.indexOf("24")):l(m,d):p=m.split("ShortTime")[0].split("LongTime")[0]}else c?n=l("longMonthDayYear",d):p="longMonthDayYear";n=n?n:G.prototype._dateFormats[p];h=C.substitute(L,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+n}})}catch(qa){console.error(qa),h=a}return h};e.getDateTimeStr=function(a,b){b=b?b:"YYYY-MM-DD HH:mm:ss";return F(a).format(b)};
e.getDateByDateTimeStr=function(a){return F(a).toDate()};e.getDateByDateTimeStrAndFormat=function(a,b){a=e.getDateByDateTimeStr(a);k.exists("format.dateFormat",b)&&(b=b.format.dateFormat,0<=b.indexOf("ShortTime")?a.setSeconds(0):0>b.indexOf("Time")&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0)));return a};e.getDateTimeStrByFieldInfo=function(a,b){var c="YYYY-MM-DD";k.exists("format.dateFormat",b)&&(b=b.format.dateFormat,0<=b.indexOf("LongTime")?c+=" HH:mm:ss":0<=b.indexOf("ShortTime")&&(c+=" HH:mm"));
return F(a).format(c)};e.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var c=a.indexOf(" ",b);-1===c&&(c=a.length);var d=-1<a.indexOf("\r\n",b)?a.indexOf("\r\n",b):-1<a.indexOf("\n",b)?a.indexOf("\n",b):c,c=d<c?d:c,d=a.substring(b,c);a=a.substring(0,b)+'\x3cA href\x3d"'+d+'" target\x3d"_blank"\x3e'+d+"\x3c/A\x3e"+a.substring(c,a.length)}}return null===a?"":a},getFormattedNumber:function(a,
b){if("number"===typeof a){var c=(a.toString().split(".")[1]||"").length;a=e.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):c,digitSeparator:b&&b.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a,b){if("number"===typeof a||a instanceof Date)a=e.localizeDateByFieldInfo(a,{format:b});return a||""},getCodedValue:function(a,b){if(a&&a.codedValues){for(var c=0,d=a.codedValues.length;c<
d;c++){var e=a.codedValues[c];if(C.isDefined(b)&&k.exists("code",e)&&b.toString()===e.code.toString())return e.name}return b}return b||null},getTypeName:function(a,b){for(var c=b.length,d=0;d<c;d++)if(a===b[d].id)return b[d].name;return a}};e.addRelativePathInCss=T;e.url={isAbsolute:function(a){return a?a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,b){a=t.urlToObject(a);a.query&&delete a.query[b];b=a.path;for(var c in a.query)b=b===a.path?b+"?"+c+"\x3d"+a.query[c]:b+
"\x26"+c+"\x3d"+a.query[c];return b},addQueryParamToUrl:function(a,b,c){a=t.urlToObject(a);a.query||(a.query={});a.query[b]=c;b=a.path;for(var d in a.query)b=b===a.path?b+"?"+d+"\x3d"+a.query[d]:b+"\x26"+d+"\x3d"+a.query[d];return b},compareUrl:function(a,b){a=this.getUrlPath(a);b=this.getUrlPath(b);a=u.removeProtocol(a.toString().toLowerCase()).replace(/\/+/g,"/");b=u.removeProtocol(b.toString().toLowerCase()).replace(/\/+/g,"/");return a===b},getUrlPath:function(a){return t.urlToObject(a).path}};
e.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};e.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};e.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=t.urlToObject(a.href);a.query&&a.query.apiurl&&(b=e.url.addQueryParamToUrl(b,
"apiurl",a.query.apiurl));return b};e.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};e.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};e.isLightColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?!0:!1};e.mixinAppConfigPosition=
function(a,b){var c=k.clone(a);if(!b)return c;b=k.clone(b);var d=c.widgetOnScreen,e=b.widgetOnScreen;e&&e.widgets&&("[object Object]"===Object.prototype.toString.call(e.widgets)?h.forEach(d.widgets,function(a,b){b=a.uri?a.uri:"ph_"+b;e.widgets[b]&&e.widgets[b].position&&(e.widgets[b].position.relativeTo||(e.widgets[b].position.relativeTo="map"),a.position=e.widgets[b].position)},this):h.forEach(e.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");d.widgets[b]&&
a.position&&(d.widgets[b].position=a.position)}));e&&e.groups&&("[object Object]"===Object.prototype.toString.call(e.groups)?h.forEach(d.groups,function(a,b){b=a.label?a.label:"g_"+b;e.groups[b]&&e.groups[b].panel&&e.groups[b].panel.position&&(e.groups[b].panel.position.relativeTo||(e.groups[b].panel.position.relativeTo="map"),a.panel.position=e.groups[b].panel.position)},this):(a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===
a?h.forEach(e.groups,function(a,b){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");d.groups[b]&&a.panel&&a.panel.position&&(d.groups[b].panel.position=a.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===a&&(d.groups=U(d.groups,e.groups.map(function(a){return a.id})))));b.map&&b.map.position&&(c.map?c.map.position=b.map.position:c.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&
(b.widgetPool.panel.position.relativeTo="map"),c.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(c.mobileLayout=b.mobileLayout);return c};e.handleGridLayoutOnScreenGroupChange=U;e.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,b,c){var d=-1;b=a.search(new RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(c),d=b+a+c.length);return{firstPos:b,lastPos:d}},setConfigValue:function(a,b,c){K(a,b,c)},getConfigValue:function(a,
b){return K(a,b)},setConfigValueWithId:function(a,b,c){V(a,b,c)},getConfigValueWithId:function(a,b){return V(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var b=e.template.getSearchRange(a,e.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-
1)}return a},getGroupIdByKey:function(a){var b=e.template.getSearchRange(a,e.template.groupIdentification,"]");if(-1===b.firstPos)a=null;else{var c=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+c.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=[],c=e.template.widgetIdentification+"_config",d;h.forEach(a.configurationSettings,function(a){h.forEach(a.fields,function(a){a.fieldName&&(d=e.template.getSearchRange(a.fieldName,c,"]"),0<=d.firstPos&&(a=e.template.getWidgetIdByKey(a.fieldName),
-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,b,c){function d(a){var b=[];h.forEach(a,function(a){a&&b.push(a)},this);return b}var f=a.widgetOnScreen,g=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);c&&(a.map.mapOptions&&e.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=g,b.values.app_title||(b.values.app_title=c.title),b.values.app_subtitle||(b.values.app_subtitle=c.snippet));for(var l in b.values)"webmap"!==l&&e.template.setConfigValueWithId(a,
l,b.values[l]);a.widgetPool.widgets=d(a.widgetPool.widgets);f.widgets=d(f.widgets);if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=d(a.widgetPool.groups[b].widgets);if(f.groups)for(b=0;b<f.groups.length;b++)f.groups[b].widgets=d(f.groups[b].widgets);return a}};e.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};e.sanitizeHTML=
function(a){return html_sanitize(a,function(a){return a},function(a){return a})};e.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};e.encodeHTML=function(a){return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};e.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};e.getBestDisplayAttributes=function(a,b){var c={},d=null,f;for(f in a)d=e.getBestDisplayValue(f,
a,b),c[f]=d;return c};e.getBestDisplayValue=function(a,b,c){var d="",f=null;k.isArrayLike(c)?f=e.getFieldInfoByFieldName(c,a):"object"===typeof c&&c.name===a&&(f=c);f&&(d=b[a],"esriFieldTypeDate"===f.type?d&&(a=new Date(parseInt(d,10)),d=e._tryLocaleDate(a)):"number"===typeof d&&(f.domain&&"codedValue"===f.domain.type?h.some(f.domain.codedValues,function(a){if(a.code===d)return d=a.name,!0}):d=e._tryLocaleNumber(d)));if(null===d||void 0===d)d="";return d};e._getCodedValues=function(a){var b=null;
(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length&&(b=a.codedValues,b=h.map(b,k.hitch(this,function(a){return{value:a.code,label:a.name}})));return b};e._getSubTypes=function(a){var b=null;a.subtypeField&&a.subtypes&&0<a.subtypes.length&&(b=h.map(a.subtypes,k.hitch(this,function(a){return{value:a.id,label:a.name}})));return b};e._getRenderTypes=function(a){var b=null;a.typeIdField&&a.types&&0<a.types.length&&(b=h.map(a.types,k.hitch(this,function(a){return{value:a.id,label:a.name}})));
return b};e._getCodedValueOrSubtypes=function(a,b,c){var d=e.getFieldInfoByFieldName(a.fields,b);return void 0!==c&&null!==c?e._getCodedValueBySubTypeId(a,b,c,d):e._getAllCodedValue(a,d)};e._getDisplayValueForCodedValueOrSubtype=function(a,b,c,d){var f={isCodedValueOrSubtype:!1,displayValue:c+""};(a=e._getCodedValueOrSubtypes(a,b,d))&&0<a.length&&h.some(a,k.hitch(this,function(a){return a.value===c?(f={isCodedValueOrSubtype:!0,displayValue:a.label},!0):!1}));return f};e._deleteSubtypePropertiesTemp=
function(a){delete a.subtypeField;delete a.subtypes};e.getDisplayValueForCodedValueOrSubtype=function(a,b,c){e._deleteSubtypePropertiesTemp(a);var d=c[b],f,g=a.typeIdField;c.hasOwnProperty(g)&&(f=c[g]);(g=a.subtypeField)&&a.subtypes&&0<a.subtypes.length&&c.hasOwnProperty(g)&&(f=c[g]);d=e._getDisplayValueForCodedValueOrSubtype(a,b,d,f);a.typeIdField===b&&(d.displayValue=e._updateCodedValueListFromRender(a,[{value:c[b],label:d.displayValue}])[0].label);return d};e._getDisplayValueFromCodedValues=function(a,
b){var c={isCodedValueOrSubtype:!1,displayValue:a+""};b&&0<b.length&&h.some(b,k.hitch(this,function(b){return b.value===a?(c={isCodedValueOrSubtype:!0,displayValue:b.label},!0):!1}));c.value=a;return c};e.getDisplayValueForCodedValueOrSubtypeBatch=function(a,b,c){e._deleteSubtypePropertiesTemp(a);var d={},f=a.typeIdField,g=a.subtypeField,l=e.getFieldInfoByFieldName(a.fields,b);g&&a.subtypes&&0<a.subtypes.length?(d.subType=e._getSubTypes(a),f=g,d.all=e._getAllCodedValueNew(a,l)):(d.all=e._getAllCodedValue(a,
l),d.subType=e._getRenderTypes(a));if(d.subType&&0<d.subType.length){var g=d.subType,p;for(p in g){var n=g[p].value,h=e._getCodedValueBySubTypeId(a,b,n,l);d[n]=a.typeIdField===b?e._updateCodedValueListFromRender(a,h):h}}a.typeIdField===b&&(d.subType=e._updateCodedValueListFromRender(a,d.subType),d.all=e._updateCodedValueListFromRender(a,d.all));n=[];p=[];for(var k in c)n=c[k],g=n[b],f===b?n=d.subType:n.hasOwnProperty(f)?(n=n[f],n=d[n],n||(n=e._getCodedValues(l),a.typeIdField===b&&(n=e._updateCodedValueListFromRender(a,
n)))):n=d.all,g=e._getDisplayValueFromCodedValues(g,n),p.push(g);return p};e._getUniquCodedValue=function(a,b,c){a[b]?c!==a[b]&&(a[b]=a[b]+", "+c):a[b]=c;return a};e._getAllCodedValue=function(a,b){var c=b.name,d={},f=null,g=!0;if(a.typeIdField&&a.types&&0<a.types.length)h.map(a.types,k.hitch(this,function(a){a.domains&&a.domains[c]&&(a=a.domains[c],"inherited"===a.type?g&&(g=!1,a=e._getCodedValues(b),h.map(a,k.hitch(this,function(a){d=e._getUniquCodedValue(d,a.value,a.label)}))):a.codedValues&&0<
a.codedValues.length&&h.map(a.codedValues,k.hitch(this,function(a){d=e._getUniquCodedValue(d,a.code,a.name)})))})),f||(f=e._getCodedValues(b));else return this._getCodedValues(b);a=[];var l=e.isNumberField(b.type),p;for(p in d){var n=l?parseFloat(p):p;a.push({value:n,label:d[p]})}0<a.length&&(f=a);return f};e._getAllCodedValueNew=function(a,b){var c=b.name,d={},f=null,g=!0;if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)h.map(a.subtypes,k.hitch(this,function(a){a.domains&&a.domains[c]&&(a=a.domains[c],
"inherited"===a.type?g&&(g=!1,a=e._getCodedValues(b),h.map(a,k.hitch(this,function(a){d=e._getUniquCodedValue(d,a.value,a.label)}))):a.codedValues&&0<a.codedValues.length&&h.map(a.codedValues,k.hitch(this,function(a){d=e._getUniquCodedValue(d,a.code,a.name)})))})),f||(f=e._getCodedValues(b));else return this._getCodedValues(b);a=[];var l=e.isNumberField(b.type),p;for(p in d){var n=l?parseFloat(p):p;a.push({value:n,label:d[p]})}0<a.length&&(f=a);return f};e._getCodedValueBySubTypeId=function(a,b,c,
d){var f="typeIdField",g="types";a.subtypeField&&a.subtypes&&0<a.subtypes.length&&(f="subtypeField",g="subtypes");var l=null;d=d?d:e.getFieldInfoByFieldName(a.fields,b);a[f]&&a[g]&&0<a[g].length?(h.map(a[g],k.hitch(this,function(g){if(g.id===c){if(b===a[f])return l=[{value:g.id,label:g.name}],!0;g.domains&&g.domains[b]?(g=g.domains[b],"inherited"===g.type?l=e._getCodedValues(d):g.codedValues&&0<g.codedValues.length&&(l=h.map(g.codedValues,k.hitch(this,function(a){return{value:a.code,label:a.name}})))):
g.domains&&(l=e._getCodedValues(d))}})),l||(l=e._getCodedValues(d))):l=e._getCodedValues(d);return l};e.getCodedValueListForCodedValueOrSubTypes=function(a,b,c){e._deleteSubtypePropertiesTemp(a);var d=null,d=e.getFieldInfoByFieldName(a.fields,b),f,g;c&&(f=c[a.typeIdField],g=c[a.subtypeField]);if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)return b===a.subtypeField?(d=e._getSubTypes(a),void 0!==g&&(c=e._getDisplayValueFromCodedValues(g,d),d=[{value:c.value,label:c.displayValue}])):d=void 0===g?
e._getAllCodedValueNew(a,d):e._getCodedValueBySubTypeId(a,b,g,d),b===a.typeIdField&&(d=e._updateCodedValueListFromRender(a,d)),d;a.subtypeField="";a.subtypes=[];a.typeIdField&&a.typeIdField.toUpperCase()===b.toUpperCase()?(d=e._getRenderTypes(a),c&&void 0!==f&&null!==f&&(c=e._getDisplayValueFromCodedValues(f,d),d=[{value:c.value,label:c.displayValue}])):d=c&&void 0!==f&&null!==f?e._getCodedValueBySubTypeId(a,b,f,d):e._getAllCodedValue(a,d);b===a.typeIdField&&(d=e._updateCodedValueListFromRender(a,
d));return d};e._verifyIfFieldIsSubtypeField=function(a,b){var c={isSubtypeField:!1,subtypeField:""};if(a.subtypeField)return c={isSubtypeField:a.subtypeField===b.name,subtypeField:a.subtypeField};["esriFieldTypeSmallInteger","esriFieldTypeInteger"].indexOf(b.type)&&a.typeIdField===b.name&&a.types&&0<a.types.length&&(void 0===a.types[0].domains[b.name]?c={isSubtypeField:!0,subtypeField:b.name}:c.isSubtypeField=!1);return!1};e._getRendererFromLayerDef=function(a){var b=null;a.drawingInfo&&a.drawingInfo.renderer&&
"uniqueValue"===a.drawingInfo.renderer.type&&(b=a.drawingInfo.renderer);return b};e._getRenderValueLabelsForUnique=function(a){var b=null,c=null,d=e._getRendererFromLayerDef(a);d?(b={},c=d.uniqueValueInfos):a.renderer&&(d=a.toJson().layerDefinition,d=e._getRendererFromLayerDef(d),a=a.renderer.toJson(),"uniqueValue"===a.type&&d&&d.field1===a.field1?(b={},c=a.uniqueValueInfos):d&&(b={},c=d.uniqueValueInfos));if(c)for(a=0;a<c.length;a++)d=c[a],b[d.value]=d.label;return b};e._updateCodedValueListFromRender=
function(a,b){if((a=e._getRenderValueLabelsForUnique(a))&&b)for(var c=0;c<b.length;c++){var d=b[c];a[d.value]&&(d.label=a[d.value])}return b};e.getDefaultPortalFieldInfo=function(a){var b=a.name,b={fieldName:b,label:a.alias||b,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":b.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":b.format={places:2,digitSeparator:!0};
break;case "esriFieldTypeDate":b.format={dateFormat:"longMonthDayYear"}}return b};e.getDefaultPopupInfo=function(a,b,c){var d=null;a&&a.fields&&(d={title:b,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},h.forEach(a.fields,function(a){var b=!1;c?h.some(c,k.hitch(this,function(b){return b&&a.name.toLowerCase()===b.toLowerCase()}))&&(b=!0):b=!0;b&&(b=this.getDefaultPortalFieldInfo(a),b.visible=!0,b.isEditable=a.editable,d.fieldInfos.push(b))},this));return d};e._tryLocaleNumber=function(a){var b=
e.localizeNumber(a);if(null===b||void 0===b)b=a;return b};e._tryLocaleDate=function(a){var b=e.localizeDate(a);b||(b=a.toLocaleDateString());return b};e.getFieldInfoByFieldName=function(a,b){var c=null;a&&0<a.length&&h.some(a,k.hitch(this,function(a){return a.name===b?(c=a,!0):!1}));return c};e.getDateFieldFormatByFieldName=function(a,b){if(a&&0<a.length)for(var c=0;c<a.length;c++){var d=a[c];if(d.fieldName===b){if(d.format&&d.format.dateFormat)return d.format.dateFormat;break}}return""};e.completePopupFieldFromLayerField=
function(a,b){if(!b)return a;for(var c in a){var d=a[c].name,f=!1,g;for(g in b)if(b[g].fieldName===d){f=!0;break}f||(d=e.getPopupFieldFromLayerField(a[c]),b.push(d))}return b};e.getPopupFieldFromLayerField=function(a){return{fieldName:a.name,isEditable:a.editable,label:a.alias,visible:a.visible?a.visible:!1,stringFieldOption:"esriFieldTypeString"===a.type?"textbox":null,tooltips:"",domain:a.domain?a.domain:null}};e.containsNonLatinCharacter=function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;
return!1};e.has=function(a){var b=z(a);if(b)return b;if("ie"===a.toLowerCase()){a=0;var c=/MSIE (\d+\.\d+);/.test(navigator.userAgent),d=!!navigator.userAgent.match(/Trident\/7.0/),e=navigator.userAgent.indexOf("rv:11.0");c&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);d&&-1!==e&&(a=11);return 11===a&&11||b}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||b};e.detectUserAgent=function(){return window.userAgent};e.isMobileUa=function(){return window.isMobileUa};
e.inMobileSize=function(){var a=m.getMarginBox(document.body);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return m.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;m.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};e.getObjectIdField=function(a){if(a.objectIdField)return a.objectIdField;a=a.fields;for(var b=0;b<a.length;b++){var c=a[b];if("esriFieldTypeOID"===c.type)return c.name}return null};e.isNeedHttpsButNot=function(){var a=navigator.geolocation,
b=window.hasOwnProperty("isSecureContext");return(b&&window.isSecureContext||!b&&"https:"===window.location.protocol)&&a?!1:!0};e.toFeatureSet=function(a){var b=new S;"[object Object]"===Object.prototype.toString.call(a)&&(a=[a]);b.features=a;if(0<a.length){var c;h.some(a,function(a){if(a.geometry)return c=a,!0});if(c){a=c.getLayer();var d={};a&&(b.displayFieldName=a.displayField,h.forEach(a.fields,k.hitch(this,function(a){var b=a.name;d[b]=a.alias||b})),b.fieldAliases=d);b.geometryType=c.geometry.type;
b.spatialReference=c.geometry.spatialReference}}return b};e.showValidationErrorTipForFormDijit=function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),setTimeout(k.hitch(this,function(){a.focusNode.blur()}),100))}catch(b){console.error(b)}};e.getFeatureLayerDefinition=function(a){var b=null,c=a.graphics;a.graphics=[];var d=a.toJson();a.graphics=c;d&&(b=d.layerDefinition);return b};e.simulateClickEvent=function(a){if(z("safari")){var b=document.createEvent("MouseEvents");b.initEvent("click",
!0,!0);a.dispatchEvent(b)}else a.click()};e.getFeatureSetByLayerAndFeatures=function(a,b){var c=new S;c.fields=k.clone(a.fields);c.features=b;c.geometryType=a.geometryType;c.fieldAliases={};h.forEach(c.fields,k.hitch(this,function(a){var b=a.name;c.fieldAliases[b]=a.alias||b}));return c};e.featureAction=function(){return{zoomTo:function(a,b,c){c||(c={});if(a&&b&&0<b.length){var d=h.every(b,function(a){return a&&a.spatialReference&&a.type});if(h.every(b,function(a){return a&&a.geometry&&a.geometry.spatialReference&&
a.geometry.type})||d)d&&(b=h.map(b,function(a){return{geometry:a}})),e.zoomToFeatureSet(a,{features:b},c.extentFactor)}},flash:function(a,b){function c(a,b){h.forEach(e,function(c,d){c.setSymbol(b?a:g[d]||l)})}function d(a){return function(){setTimeout(function(){c(p,!0);e[0]&&b&&b.redraw();setTimeout(function(){c(null,!1);e[0]&&b&&b.redraw();a()},200)},200)}}if(h.every(a||[],function(a){return a&&a.geometry})){var e=a;a=e[0];var g=h.map(e,function(a){return a.symbol}),l=a.symbol||k.getObject("renderer.symbol",
!1,b),p=null;b&&"esriGeometryPoint"===b.geometryType?p=new ia(require.toUrl("jimu")+"/images/flash.gif",20,20):(p=k.clone(l))&&(p.outline?p.outline.setColor("#ffc500"):p.setColor("#ffc500"));a&&l&&p&&b&&("esriGeometryPoint"===b.geometryType?(c(p,!0),b.redraw(),setTimeout(function(){c(null,!1);b.redraw()},2E3)):d(d(d(function(){})))())}},panTo:function(a,b){h.every(b||[],function(a){return a&&a.geometry})&&(0<b.length?b=la.graphicsExtent(b).getCenter():(b=b[0].geometry,b="polyline"===b.type||"polygon"===
b.type?b.getExtent().getCenter():"extent"===b.type?b.getCenter():"multipoint"===b.type?1<b.points.length?b.getExtent().getCenter():b.getPoint(0):b),a.centerAt(b))},showPopup:function(a,b){h.every(b||[],function(a){return a&&a.geometry})&&(a=a.infoWindow,a.setFeatures(b),b=b[0],"point"===b.geometry.type?a.show(b.geometry,{closetFirst:!0}):a.show(b.geometry.getExtent().getCenter(),{closetFirst:!0}))}}}();e.isInConfigOrPreviewWindow=function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==
window&&window.parent.isBuilder}catch(b){a=!1}return!!a};e.getAppHref=function(){var a="";return a=e.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};e.getAppIdFromUrl=function(){var a=!0,b=e.getAppHref();if(-1!==b.indexOf("id\x3d")||-1!==b.indexOf("appid\x3d")||-1!==b.indexOf("apps"))a=!1;if(!0===a)return b;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;
if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};e.getEditorContentHeight=function(a,b,c){var d=new q;this._content=a;this._dom=b;this._domParam=c;var e=setTimeout(k.hitch(this,function(){clearTimeout(e);e=null;var a=0,b=this._domParam.contentWidth;try{var c=document.createElement("div");c.setAttribute("id","fakeContent");m.setStyle(c,"background-size","contain");c.innerHTML=this._content;this._dom.appendChild(c);
if(c){var f=w("img",c);f&&f.length&&f.style({maxWidth:b-20+"px"});m.setStyle(c,"position","absolute");m.setStyle(c,"width",b+"px");m.setStyle(c,"left","-99999px");m.setStyle(c,"top","-99999px");m.setStyle(c,"visibility","hidden");var h=m.getContentBox(c);h.h&&(a=h.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(L){console.error("can't getEditorContentHeight"+L),a=200}d.resolve(a)}),1500);return d};e.getBase64Data=function(a){var b=new q;if(a&&a.startWith("data:image"))b.resolve(a);
else try{x({url:a,handleAs:"arraybuffer"}).then(function(a){var c=new FileReader;c.onloadend=function(){b.resolve(c.result)};c.onerror=function(){b.resolve(null)};c.readAsDataURL(new Blob([a],{type:"image/png"}))},function(){b.resolve(null)})}catch(c){console.warn(c),b.resolve(null)}return b};e.getEditorTextColor=function(a,b){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:e.getColorRecordName(a),forceAttr:b}}};e.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",
custom:{recordUID:e.getColorRecordName(a)}}};e.getColorRecordName=function(a){return"wab_cr_"+(a||"")};e.b64toBlob=function(a,b,c){b=b||"";c=c||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var d=[],e=0;e<a.length;e+=c){for(var g=a.slice(e,e+c),l=Array(g.length),h=0;h<g.length;h++)l[h]=g.charCodeAt(h);g=new Uint8Array(l);d.push(g)}return new Blob(d,{type:b})};e.subtractionArray=function(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c],e=b.length-1;0<=e;e--)if(d===
b[e]){a.splice(c,1);b.splice(e,1);break}return a};e.resourcesUrlToBlob=function(a){return x({url:a,handleAs:"blob"})};e.processItemResourceOfAppConfig=function(a,b){function c(a){var b=a.obj,c=a.key,d={obj:b,key:c};"number"===typeof a.i?(d.i=a.i,d.value=b[c][a.i]):d.value=b[c];return d}function d(a){for(var b in a)if("object"===typeof a[b])if(Array.isArray(a[b]))for(var c=a,f=b,g=0;g<c[f].length;g++)"string"===typeof c[f][g]?e(c,f,g):"object"===typeof c[f][g]&&d(c[f][g]);else d(a[b]);else"string"===
typeof a[b]&&e(a,b)}function e(a,d,e){"number"===typeof e?b.test(a[d][e])&&(k=b.func(c({obj:a,key:d,i:e})),"function"===typeof k.then?h.push(k):g.push(k)):b.test(a[d])&&(k=b.func(c({obj:a,key:d})),"function"===typeof k.then?h.push(k):g.push(k))}var g=[],h=[],k;d(a);return 0<h.length?Y(h).then(function(b){0<g.length&&(b=b.concat(g));return{appConfig:a,result:b}}):{appConfig:a,result:g}};e.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};e.uniqueArray=function(a){for(var b=
[],c=0;c<a.length;c++)-1===b.indexOf(a[c])&&b.push(a[c]);return b};e.isNotEmptyObject=function(a,b){return b?e.isObject(a)&&0<Object.keys(a).length&&Array.isArray(a):e.isObject(a)&&0<Object.keys(a).length};e.getMinOfArray=function(a){return Number(Math.min.apply(Math,a))};e.getDataSchemaFromLayerDefinition=function(a){var b=a.fields.filter(function(a){return"esriFieldTypeOID"===a.type}),b=0<b.length?b[0]:null;return{geometryType:a.geometryType,fields:a.fields,displayField:a.displayField,objectIdField:b,
typeIdField:a.typeIdField}};e.isValidPointGeometry=function(a){return a&&"point"===a.type&&e.isTrueOrZero(a.x)&&e.isTrueOrZero(a.y)};e.isVaildPointGeometry=e.isValidPointGeometry;e.isNumberOrNumberString=function(a){return/^-?[1-9]\d*$/.test(a)||/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/.test(a)};e.convertNumberToPercentage=function(a,b,c){if(!e.isNumberOrNumberString(a))return a;"undefined"===typeof c&&(c=!0);"undefined"===typeof b&&(b=2);b={format:{places:b,digitSeparator:c}};var d=v.locale;
c="ar"===d||"tr"===d;d="ar"===d||"he"===d;a=Number(a);var f=!1;0>a&&(f=!0,a=Math.abs(a));a=e.localizeNumberByFieldInfo(100*a,b);a=c?"%"+a:a+"%";f&&(a=d?a+"-":"-"+a);return a};e.getClientFeaturesFromMap=function(a,b,c,d){var f=[],g=!1;if(b){c?0<b.getSelectedFeatures().length?(f=b.getSelectedFeatures(),g=!0):f=b.graphics:f=b.graphics;d&&(f=e.filterFeaturesByExtent(a.extent,f));if(f&&0<f.length){var h=e.getObjectIdField(b);h&&(a=f[0])&&a.attributes&&a.attributes.hasOwnProperty(h)&&f.sort(function(a,
b){a.attributes||(a.attributes={});b.attributes||(b.attributes={});a=a.attributes[h];b=b.attributes[h];return a<b?-1:a>b?1:0})}f.isSelectedFeatures=g;return f}};e.filterFeaturesByExtent=function(a,b){var c=a.normalize();return b=h.filter(b,k.hitch(this,function(a){try{if(a.geometry){var b="point"===a.geometry.type||"multipoint"===a.geometry;return h.some(c,k.hitch(this,function(c){return b?c.contains(a.geometry):da.intersects(c,a.geometry)}))}}catch(g){console.error(g)}return!1}))};e.upperCaseString=
function(a){return a&&"string"===typeof a?a.toUpperCase():a};e.lowerCaseString=function(a){return a&&"string"===typeof a?a.toLowerCase():a};e.getSubstituteString=function(a,b){return C.substitute({value:a},b)};e.getUUID=function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return a()+a()+"_"+a()+"_"+a()+"_"+a()+"_"+a()+a()+a()};e.checkEssentialAppsLicense=function(a,b,c){var d=u.getStandardPortalUrl(window.portalUrl),e=u.getSharingUrl(d),d=new ma({appId:"arcgisWebApps",
portalUrl:d});H.registerOAuthInfos([d]);return c?H.checkAppAccess(e,"arcgisWebApps"):b.getItemById(a).then(function(a){if("public"!==a.access)return H.checkAppAccess(e,"arcgisWebApps")})};e.getStyleColorInTheme=function(a){var b=new q,c,d;window&&window.isBuilder?(d="./stemapp/themes/",c=window.appConfig):(d="./themes/",c=window.getAppConfig());if(c&&c.theme.customStyles&&c.theme.customStyles.mainBackgroundColor)return b.resolve(c.theme.customStyles.mainBackgroundColor),b.promise;var e=c.theme.name,
g=c.theme.styles[0];a&&(g=a);x({url:d+e+"/manifest.json",handleAs:"json"}).then(k.hitch(this,function(a){if(a&&a.styles){a=a.styles;for(var c=0;c<a.length;c++){var d=a[c];d.name===g&&b.resolve(d.styleColor)}}}),k.hitch(this,function(a){console.error(a);b.reject(null)}));return b.promise};return e});