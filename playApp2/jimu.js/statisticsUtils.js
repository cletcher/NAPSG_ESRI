// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(r,h,t,u,v,w,l,x,g){function y(a){var b;b=new v;b.outFields=[a.fieldName];b.outStatistics=[];b.geometry=a.geometry;var c=m(a);r.forEach(c,function(d){var c=new t;c.statisticType=d;c.displayFeildName=a.fieldName;c.onStatisticField=a.fieldName;c.outStatisticFieldName=z[d];b.outStatistics.push(c)});b.where=a.filterExpression?
a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(b.geometry=a.geometry);return(new u(a.layer.url)).execute(b).then(function(b){return b&&b.features&&0<b.features.length?(b=b.features[0].attributes,n(a,b),b):[]})}function k(a){var b={countField:0,sumField:0},c=m(a),d=0,f=0;a.featureSet.features.forEach(function(A){var e=A.attributes[a.fieldName];null!==e&&"undefined"!==typeof e&&c.forEach(function(a){switch(a){case "count":b.countField++;
break;case "sum":b.sumField+=e;break;case "min":b.minField="undefined"===typeof b.minField?e:Math.min(b.minField,e);break;case "max":b.maxField="undefined"===typeof b.maxField?e:Math.max(b.maxField,e);break;case "avg":d++,f+=e}})});b.avgField=0===d?0:0===d?"":f/d;var B=a.featureSet.features.filter(function(b){b=b.attributes[a.fieldName];return null===b||"undefined"===typeof b?!1:!0}).map(function(b){return b.attributes[a.fieldName]});b.stddevField=p(B);n(a,b);return b}function m(a){return a.statisticTypes&&
0<a.statisticTypes.length?q.filter(function(b){return-1<a.statisticTypes.indexOf(b)}):q}function p(a){var b=a.length;if(1>=b)return 0;var c=0;a.forEach(function(a){c+=a});var d=c/b,f=0;a.forEach(function(a){f+=Math.pow(a-d,2)});return Math.sqrt(1/(b-1)*f)}function C(a){var b=x.getInstanceSync();return a.layer?b.getLayerOrTableInfoById(a.layer.id).loadInfoTemplate().then(function(a){var b={};a.info&&a.info.fieldInfos&&a.info.fieldInfos.forEach(function(a){b[a.fieldName]=a});return b}):h({})}function n(a,
b){if(a.fieldInfos&&a.fieldInfos[a.fieldName])for(var c in b)"countField"!==c&&w.isDefined(b[c])&&(b[c]=null===b[c]||"undefined"===typeof b[c]?"":l.localizeNumberByFieldInfo(b[c],a.fieldInfos[a.fieldName]))}var q="count sum min max avg stddev".split(" "),z={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};g.getStatisticsResult=function(a){return C(a).then(function(b){a.fieldInfos=b;if(a.featureSet)return h(k(a));if(a.layer){if(a.layer.url)return y(a);
a.featureSet=l.toFeatureSet(a.layer.graphics);return h(k(a))}})};g.isStatFromServer=function(a){return a.layer&&a.layer.url};g.getStddevVal=p;g.getStatisticsResultFromClientSync=k});